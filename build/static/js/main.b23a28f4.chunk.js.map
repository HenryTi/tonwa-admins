{"version":3,"sources":["tonva/index.ts","tonva/components/index.ts","tonva/net/guestApi.ts","tonva/net/caller.ts","tonva/components/nav.tsx","tonva/net/netToken.ts","tonva/components/fetchErrorView.tsx","tonva/components/reloadPage.tsx","tonva/tool/cacheIds.ts","tonva/tool/local.ts","tonva/tool/getObjPropIgnoreCase.ts","tonva/tool/rules.ts","tonva/vm/controller.tsx","tonva/vm/view.tsx","tonva/vm/vpage.tsx","tonva/vm/components/CStringEdit.tsx","tonva/components/page/page.tsx","tonva/net/appBridge.ts","tonva/uq/entity.ts","tonva/components/edit/itemEdit.tsx","tonva/uq/caller.ts","tonva/net/httpChannel.ts","tonva/net/httpChannelUI.ts","tonva/net/uqApi.ts","tonva/uq/index.ts","tonva/res/res.ts","tonva/tool/uid.ts","tonva/uq/query.ts","tonva/net/wsChannel.ts","tonva/components/image.tsx","tonva/tool/user.ts","tonva/net/host.ts","tonva-form/index.ts","tonva/components/page/scrollView.tsx","tonva/uq/action.ts","tonva/components/simple/Badge.tsx","tonva/components/simple/LMR.tsx","tonva/components/simple/FA.tsx","tonva/components/simple/Muted.tsx","tonva/components/simple/IconText.tsx","tonva/tool/localDb.ts","tonva/uq/tuid/reactBoxId.tsx","tonva/components/loading.tsx","tonva-form/form/control/control.tsx","tonva-form/form/control/checkControl.tsx","tonva-form/form/control/radioControl.tsx","tonva-form/form/control/charsControl.tsx","tonva-form/form/control/textAreaControl.tsx","tonva-form/form/control/selectControl.tsx","tonva-form/form/control/unknownControl.tsx","tonva-form/form/control/stringControl.tsx","tonva-form/form/control/numberControl.tsx","tonva-form/form/control/pickIdControl.tsx","tonva-form/form/control/pickTuidControl.tsx","tonva-form/form/control/pickControl.tsx","tonva-form/form/control/buttonsControl.tsx","tonva-form/form/control/index.ts","tonva/tool/env.ts","tonva/uq/tuid/index.ts","tonva-form/form/rowContainer/index.tsx","model/index.ts","tonva/net/apiBase.ts","tonva/components/edit/imageItemEdit.tsx","tonva/tool/pageItems.ts","tonva/net/messageHub.ts","tonva/components/navigo.ts","tonva/components/page/pageHeader.tsx","tonva/components/page/tabs.tsx","tonva/components/resUploader.tsx","tonva/uq/uqMan.ts","tonva/uq/sheet.ts","tonva/uq/book.ts","tonva/uq/history.ts","tonva/uq/map.ts","tonva/uq/pending.ts","tonva/uq/enum.ts","tonva-form/form/index.ts","tonva-form/form/formView.tsx","tonva/auth/meInfo.tsx","tonva/auth/createLogin.ts","tonva/uq/tag/tagView.tsx","tonva/uq/tag/tag.ts","tonva/res/formRes.ts","tonva/res/listRes.ts","tonva/components/page/index.ts","tonva/components/schema/index.ts","tonva/components/dropDownActions/index.tsx","tonva/components/easyDate/index.tsx","tonva/components/media.tsx","tonva/components/searchBox.tsx","tonva/components/userIcon.tsx","tonva/components/ax/index.tsx","tonva/components/autoHideTips.tsx","tonva/uq/tuid/tuidsCache.ts","tonva/uq/uqsMan.ts","tonva/uq/buildUqApp.ts","model/id.ts","tonva-form/form/TonvaForm.tsx","tonva-form/multiStep/index.tsx","tonva/components/form/rules/index.ts","tonva/components/form/widgets/widget.tsx","tonva/components/form/widgets/textWidget.tsx","tonva/components/form/widgets/textareaWidget.tsx","tonva/components/form/widgets/passwordWidget.tsx","tonva/components/form/widgets/numberWidget.tsx","tonva/components/form/widgets/updownWidget.tsx","tonva/components/form/widgets/dateWidget.tsx","tonva/components/form/widgets/checkBoxWidget.tsx","tonva/components/form/widgets/selectWidget.tsx","tonva/components/form/widgets/radioWidget.tsx","tonva/components/form/widgets/rangeWidget.tsx","tonva/components/form/widgets/idWidget.tsx","tonva/components/form/widgets/unknown.tsx","tonva/components/form/widgets/buttonWidget.tsx","tonva/components/form/context.tsx","tonva/components/form/widgets/arrComponent.tsx","tonva/components/form/widgets/imageWidget.tsx","tonva/components/form/widgets/tagWidget.tsx","tonva/components/form/widgets/factory.tsx","tonva/components/form/form.tsx","tonva/components/form/field.tsx","tonva/auth/VLogout.tsx","tonva/img/logo.svg","tonva/auth/tools.tsx","tonva/auth/VLogin.tsx","tonva/auth/VChangePassword.tsx","tonva/auth/register/VStart.tsx","tonva/auth/register/VVerify.tsx","tonva/auth/register/VPassword.tsx","tonva/auth/register/VSuccess.tsx","tonva/auth/register/CRegister.ts","tonva/auth/CLogin.tsx","tonva/components/edit/stringItemEdit.tsx","tonva/components/edit/radioItemEdit.tsx","tonva/components/edit/selectItemEdit.tsx","tonva/components/edit/idItemEdit.tsx","tonva/components/edit/tagItemEdit.tsx","tonva/components/edit/textAreaItemEdit.tsx","tonva/components/edit/checkBoxItemEdit.tsx","tonva/components/edit/rangeItemEdit.tsx","tonva/components/edit/numberItemEdit.tsx","tonva/components/edit/edit.tsx","tonva/app/centerApi.ts","tonva/app/vMain.tsx","tonva/app/CAppBase.ts","tonva/app/start.ts","tonva/app/CBase.ts","tonva/components/list/base.tsx","tonva/components/list/clickable.tsx","tonva/components/list/static.tsx","tonva/components/list/selectable.tsx","tonva/components/list/index.tsx","tonva/components/propGrid/row.tsx","tonva/components/propGrid/propView.tsx","tonva/components/propGrid/PropGrid.tsx","tonva/uq/tuid/idCache.ts","tonva/uq/tuid/tuid.ts","api/mainApi.ts","api/devApi.ts","store/cacheIds.ts","store/dev.ts","store/store.ts","UqApp/CBase.ts","tools/idDates.tsx","tools/span.tsx","tools/unitSpan.tsx","consts.ts","tools/uqSpan.tsx","tools/appSpan.tsx","tools/busSpan.tsx","tools/serverSpan.tsx","tools/stringValueEdit.tsx","tools/idPickPage.tsx","tools/createIdPick.tsx","Apps/info.tsx","Apps/new.tsx","Apps/index.tsx","Dev/apps/appsPage.tsx","Dev/apps/editPage.tsx","Dev/apps/appUqs.tsx","Dev/apps/appPage.tsx","Dev/apps/uqBindPage.tsx","Dev/apps/index.tsx","Dev/uqs/resultSections.tsx","Dev/uqs/compileResultPage.tsx","Dev/uqs/uqUpload.tsx","Dev/uqs/newServicePage.tsx","Dev/uqs/servicePage.tsx","Dev/uqs/editPage.tsx","Dev/uqs/uqPage.tsx","Dev/uqs/listPage.tsx","Dev/uqs/VUqDevsAdmin.tsx","Dev/uqs/CPickServer.tsx","store/admins.ts","Dev/uqs/CPickUnit.tsx","Dev/uqs/CUq.tsx","Dev/buses.tsx","Dev/servers.tsx","Dev/ObjView.tsx","Home/VUnit.tsx","Home/VHome.tsx","XAccount/VApp.tsx","XAccount/VDetail.tsx","XAccount/VUser.tsx","XAccount/VAdmins.tsx","XAccount/VRoleUsers.tsx","XAccount/VNoRoleUsers.tsx","XAccount/VAddUserPage.tsx","XAccount/VUserList.tsx","tools/userSpan.tsx","XAccount/VEditUserPage.tsx","XAccount/CAppXAccount.ts","Dev/developers/VDevelopers.tsx","Dev/developers/VUqsBuses.tsx","Dev/developers/VUqs.tsx","Dev/developers/VBuses.tsx","Dev/developers/VAddDeveloper.tsx","Dev/developers/CDevelopers.ts","store/adminDevs.ts","UqRoles/VUqRoles.tsx","UqRoles/VAddUser.tsx","UqRoles/VRoleAdmin.tsx","UqRoles/CUqRoles.ts","Admins/VEditAdmin.tsx","Admins/VAddAdmin.tsx","Admins/VAdmins.tsx","Admins/CAdmins.ts","Users/VApps.tsx","Users/VUsers.tsx","Users/VApp.tsx","Users/VUser.tsx","Users/VAppEditUsers.tsx","Users/VUserEditApps.tsx","Users/VAddUser.tsx","Users/CUsers.tsx","Home/CHome.tsx","UqApp/CApp.ts","App.tsx","reportWebVitals.ts","index.tsx"],"names":["guestApi","this","get","ret","decodeGuestToken","guest","token","unitName","unit","CenterApiBase","undefined","Caller","params","waiting","_params","method","logMark","netToken","userId","setCenterToken","WSChannel","FetchErrorView","reApi","a","props","clearError","channel","url","options","resolve","reject","refetchApi","close","errContent","error","err","i","push","style","wordWrap","className","type","onClick","React","SystemNotifyPage","message","header","ReloadPage","timerHandler","reload","clearInterval","nav","seconds","state","setInterval","setState","title","msg","ConfirmReloadPage","back","confirm","isMobile","RegExp","test","navigator","userAgent","logs","stackKey","NavView","stack","waitCount","waitTimeHandler","upgradeUq","start","isHistoryBack","navBack","tick","Date","now","console","log","length","len","window","self","top","postMessage","confirmClose","pop","fetchError","wait","set","addEventListener","init","env","setTimeout","clearTimeout","unauthorized","showLogin","uq","version","show","view","disposer","clear","removeCeased","history","pushState","key","ceased","refresh","item","dispose","level","p","backLevel","popAndDispose","find","v","elWait","elError","testing","left","zIndex","name","map","index","visibility","position","navView","wsHost","local","LocalData","navigo","navSettings","language","culture","resUrl","hashParam","centerHost","arrs","windowOnError","event","source","lineno","colno","windowOnUnhandledRejection","ev","reason","windowOnClick","windowOnMouseMove","x","y","windowOnScroll","forceDevelopment","navLogin","user","navLogout","showLogout","navRegister","showRegister","navForget","showForget","navPageRoutes","doneSysRoutes","sysRoutes","isWebNav","backIcon","closeIcon","pageWebNav","showPrivacyPage","privacy","getPrivacyContent","privacyPage","htmlString","content","__html","dangerouslySetInnerHTML","createLogin","login","Promise","race","serviceWorker","ready","registration","unregister","document","location","plus","webview","webView","resetAll","ok","showReloadPage","localStorage","lang","resOptions","district","messageHub","dispatch","unitJsonPath","fetch","unitRes","json","res","remove","el","getElementById","innerText","loadUnitJson","innerHTML","JSON","parse","envUnit","process","REACT_APP_UNIT","Number","isDevelopment","id","getPredefinedUnitName","unitFromName","unitId","settings","origin","pathname","toLowerCase","endsWith","substr","host","hash","pos","getExHashPos","substring","ws","resHost","resUrlFromHost","setCenterUrl","Error","setGuest","exHash","getExHash","appInFrame","setAppInFrame","parent","loadPredefinedUnit","predefinedUnit","onerror","onunhandledrejection","onselectstart","oncontextmenu","startWait","notLogined","logined","endWait","Navigo","historyAPIUpdateMethod","on","navigate","navPage","alert","queryStr","routeFromNavPage","internalOnNavRoutes","_","merge","navOns","route","absolute","showPage","isUserLogin","onLogined","userApi","me","icon","nick","callback","logoutApis","stringify","saveLocalUser","showAppView","internalLogined","defaultTop","loginTop","withBack","getLogin","logoutClear","showChangePassword","onError","showUpgradeUq","replace","topKey","popTo","ceaseTop","regConfirmClose","confirmBox","apiId","sheetType","sheetId","sheet","includes","uh","appUrl","src","String","open","date","getTime","toTimeString","step","href","indexOf","text","r","parser","DOMParser","htmlDoc","parseFromString","elHtml","getElementsByTagName","newVersion","getAttribute","g","oem","observable","CacheIds","maxCount","arr","ids","dict","loadId","shift","delete","_loadIds","items","_loadId","setItem","e","Map","localDb","child","_user","_guest","_unit","forEach","d","getObjPropIgnoreCase","obj","prop","keys","Object","mobileRegex","emailRegex","Controller","_t","t","label","isDev","receiveHandlerId","unregisterReceiveHandler","onDispose","onMessageReceive","onMessage","_resolve_$","topPageKey","str","internalT","beforeInit","getPageWebNav","afterInit","webNav","$lang","$district","l","vp","param","afterBack","replaceOpen","render","value","onEvent","openPage","registerReceiveHandler","beforeStart","internalStart","afterStart","page","onClosePage","go","caption","yes","no","classNames","closePage","buttons","View","controller","isMe","vm","vCall","returnCall","imageClassName","textClassName","renderUser","replacePage","backPage","ceasePage","popToTopPage","VPage","retOnClosePage","_onClosePage","openPageElement","renderPage","replacePageElement","logout","right","footer","onScroll","onPageScroll","onScrollTop","scroller","onPageScrollTop","onScrollBottom","onPageScrollBottom","headerClassName","tabsProps","onChange","evt","newValue","target","preValue","isChanged","onBlur","verifyValue","onFocus","onEdit","maxLength","placeholder","onValueChange","onSave","createElement","observer","disabled","onKeyDown","keyCode","defaultValue","renderValue","renderPencil","Page","tabsView","TabsView","inWebNav","pageHeaderProps","center","rph","renderPageHeader","elFooter","errorInfo","children","renderHeader","renderFooter","uqTokens","logoutUqTokens","appsInFrame","val","isBridged","subFrameStarted","data","subWin","setSubAppWindow","hidden","hideFrameBack","clone","initSubWin","onReceiveAppApiMessage","apiName","db","parts","split","uqOwner","uqName","appOwner","appName","uqTokenApi","onAppApiReturn","urlTest","action","uqTokenActions","realUrl","getUrlOrTest","appHash","slice","lastIndexOf","u","uid","getUnit","realUnit","onReceive","callCenterApiFromMessage","bridgeCenterApiReturn","startsWith","buildAppUq","uqToken","centerToken","at","opener","appUq","brideCenterApis","bridgeCenterApi","body","callId","from","callCenterapi","directCall","result","bca","ln","chars","codeBackSlash","charCodeAt","codeN","codeT","codeB","codeF","codeV","codeR","codes","codeBN","codeBT","codeBB","codeBF","codeBV","codeBR","Entity","typeId","jName","schema","ver","sys","cache","uqApi","fields","arrFields","returns","face","fieldMaps","localMap","f","loadEntitySchema","buildSchema","loadValues","setSchema","buildFieldsTuid","setJName","buildFieldTuid","buildArrFieldsTuid","fieldName","arrName","entities","fn","getTuid","an","fieldArr","tuid","buildFieldsParams","arrResult","pa","rowResult","field","buildDateTimeParam","getFullYear","getMonth","getDate","_tuid","getIdFromObj","dt","Math","floor","toISOString","packRow","arrData","packArr","join","row","ch","escape","values","boxId","unpackRow","unpackArr","ch0","c","fLen","to","reverseNT","n","isNaN","p0","vals","ItemEdit","edit","itemSchema","uiItem","_itemSchema","_uiItem","internalEnd","divValue","labelHide","templet","Templet","widget","list","rules","nv","Array","isArray","verifyRule","rule","EntityCaller","entity","tries","_entity","loadSchema","innerRequest","xcall","innerCall","jsonResult","$uq","$modify","pullModify","xresult","retry","rebuildSchema","buildEntities","uqVersion","en","ActionCaller","QueryQueryCaller","unpackReturns","buildParams","QueryPageCaller","pageStart","pageSize","methodsWithBody","HttpChannel","hostUrl","apiToken","ui","timeout","showError","post","urlPrefix","caller","buildOptions","headers","path","h","encodeURI","innerFetch","k","innerFetchResult","buildError","ex","retErr","that","timeOutHandler","statusText","ct","then","retJson","retError","catch","buildHeaders","CenterHttpChannel","UqHttpChannel","HttpChannelNavUI","channelUIs","channelNoUIs","channels","UqApi","basePath","access","showWaiting","channelUI","acc","s","trim","theUser","roles","ApiBase","UnitxApi","buildChannel","centerAppApi","CenterAppApi","unitxUq","centerChannel","centerChannelUI","loginedUserId","uqTokensName","un","localCache","nowTick","appUqParams","call","loadAppUqs","uqs","decodeUserToken","account","verify","password","resLang","languages","toUpperCase","setResOptions","resGlobal","setRes","setGlobalRes","ALPHABET","rtn","charAt","random","Query","PageItems","more","startField","isPaged","size","$page","array","deep","pageCaller","request","queryCaller","query","table","subAppWindow","postWsToSubApp","win","WsBase","wsBaseSeed","wsBaseId","WebSocket","onopen","onmessage","wsMessage","onclose","receive","netThis","connect","send","Image","altImage","alt","currentTarget","jwtDecode","uqDebugHost","hosts","centerhost","reshost","uqhost","unitxhost","httpArr","urlFromHost","isAbsoluteUrl","centerUrlFromHost","centerWsFromHost","https","fetchOptions","mode","tryLocal","getCenterHost","getResHost","promises","hostArr","findIndex","fetchUrl","debugHostUrl","localCheck","all","results","j","hostValue","debugHost","getUrlOrDebug","urlDebug","fetchLocalCheck","Scroller","scrollTo","scrollTop","offsetHeight","scrollTimeGap","ScrollViewBase","bottomTime","topTime","div","refDiv","onResize","removeEventListener","sh","scrollHeight","direct","Children","_$scroll","toString","eachChild","Component","ScrollView","ref","WebNavScrollView","vHeader","vFooter","navHeader","navRawHeader","navFooter","navRawFooter","Action","ActionSubmitCaller","SubmitReturnsCaller","SubmitConvertCaller","pack","Badge","b","badge","color","badgeAlign","badgeVertical","cn","LMR","cursor","FA","spin","fixWidth","border","pull","pulse","rotate","flip","inverse","Muted","__ls","getItem","removeItem","LocalCache","removeLocal","Local","caches","locals","keyForGet","keyForSet","sk","LocalArr","LocalMap","keyForRemove","removeAll","ks","unshift","splice","saveIndex","max","ls","TuidContent","tuidName","uqStringify","ReactBoxId","isUndefined","boxName","assureBox","valueFromId","tuidValue","nullUI","ttv","divObj","bi","logContent","boxIdContent","Loading","ControlBase","formView","renderControl","validate","hasError","computed","Control","_field","_face","element","setProps","bind","clearErrors","clearValue","isOK","getValueFromElement","isOk","notes","CheckControl","trueValue","falseValue","assign","checked","RadioControl","CharsControl","required","parseValue","renderInput","renderError","TextAreaControl","rows","SelectControl","selectedOptions","default","UnknownControl","role","EmptyControl","StringControl","PasswordControl","NumberControl","extraChars","min","parseFloat","onKeyPress","charCode","onKeyDot","onKeyNeg","preventDefault","PickIdControl","pick","fromPicked","readValues","onPicked","itemFromId","initCaption","input","controlContent","component","PickTuidControl","onIdChanged","onFormValues","buildContent","PickControl","Content","ButtonsControl","otherClick","onOther","nothing","btnOther","submitButton","otherButton","createControl","form","group","groupRow","createGroupControl","fieldRow","fieldType","defaultFaces","controlTypes","createFieldControl","help","tag","ms","args","global","handle","RowContainer","control","cc","setError","setInitValues","filled","ElementRowContainer","BootStrapRowContainer","bootstrapCreateRow","elementCreateRow","getHttpChannel","callFetch","put","ImageItemEdit","resId","onSaved","itemObservable","isFirst","pageItemAction","itemConverter","_items","scrollToTop","scrollIntoView","topDiv","scrollToBottom","bottomDiv","firstSize","appendPosition","sortOrder","changing","divId","getPageId","loadResults","pageList","beforeLoad","loaded","allLoaded","reset","isAsc","endItem","scrollToEnd","pushItem","endIndex","startId","pid","sum","load","setLoaded","loading","onLoad","setPageStart","onLoaded","reverse","handlerSeed","anyHandlers","msgHandlers","handler","seed","args0","handlerId","$type","useHash","root","_routes","_useHash","_hash","_paused","_destroyed","_lastRouteResolved","_notFoundHandler","_defaultHandler","_usePushState","_genericHooks","_historyUpdateMethod","timout","_onLocationChange","isPushStateAvailable","_cLoc","_listen","updatePageLinks","cleanUrl","match","names","reduce","decodeURIComponent","paramNames","regexp","PARAMETER_REGEXP","full","dots","REPLACE_VARIABLE_REGEXP","WILDCARD_REGEXP","REPLACE_WILDCARD","FOLLOWED_BY_SLASH_REGEXP","MATCH_REGEXP_FLAGS","urlA","urlB","getUrlDepth","routes","replaceDynamicURLParts","clean","regExpResultToParams","filter","m","findMatchedRoutes","colonExp","matched","routeExp","fallbackURL","matched0","cleanGETParam","hooks","exHooks","before","shouldRoute","after","_getRoot","_historyUpdate","arg0","arg1","orderedRoutes","sort","compareUrlDepth","uses","_add","current","GETParameters","extractGETParameters","onlyURL","getOnlyURL","already","manageHooks","_callLeave","isHashedRoot","_findLinks","link","hasListenerAttached","ctrlKey","metaKey","tagName","getLinkPath","status","pause","destroy","as","replaceState","cLocRoot","isHashChangeAPIAvailable","cached","check","querySelectorAll","lastRouteResolved","leave","onBack","vBack","debugLogout","rightView","Tab","contentBuilder","notify","onShown","_content","selected","tabBg","sep","tabClick","tab","selectedTab","tabArr","shown","tabs","bsCur","bsTab","tabPosition","borderColor","borderStyle","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","notifyCircle","num","displayNone","pageHeader","pageFooter","tabBack","isSelected","display","ResUploader","fileInput","upload","formData","buildFormData","Headers","append","onFilesChange","files","fileName","maxSize","FormData","file","multiple","formatSize","pointLength","units","toFixed","xlargeSize","mediumSize","ImageUploader","imgBaseSize","imageTypes","suffix","resUploader","onFileChange","fileError","uploaded","enableUploadButton","reader","FileReader","readAsDataURL","onload","srcImage","setSize","desImgSize","desImage","compress","img","width","height","srcImgWidth","srcImgHeight","w","scale","desImgWidth","round","desImgHeight","canvas","ctx","getContext","anw","createAttribute","nodeValue","anh","setAttributeNode","drawImage","base64","toDataURL","blob","convertBase64UrlToBlob","showOrgImage","maxWidth","urlData","mime","bstr","atob","u8arr","Uint8Array","Blob","defaultChecked","levelDiv","padding","AudioUploader","audioTypes","fileSize","uploading","UqMan","uqData","createBoxId","tvs","enums","actions","sheets","queries","books","maps","histories","pendings","tags","tuidsCache","localAccess","localModifyMax","tuids","createBoxIdFromTVs","tuidArr","actionArr","enumArr","sheetArr","queryArr","bookArr","mapArr","historyArr","pendingArr","tagArr","TuidsCache","accesses","loadAccess","buildTuids","buildAccess","newTuid","entityName","allSchemas","fromType","fromObj","defer","cacheTuids","enm","UqEnum","TuidImport","TuidInner","book","Book","Tag","History","pending","Pending","Sheet","newAction","newQuery","newBook","newMap","newHistory","newSheet","newPending","newTag","newEnum","buildSheet","build","mainFields","buildTuidBox","owner","ownerField","buildTuidDivBox","modifyMax","states","ops","op","discription","app","SaveCaller","SaveDirectCaller","flow","ActionDirectCaller","brief","unpackSheet","flows","GetSheetCaller","getArchive","unpack","SheetArchiveCaller","SheetArchivesCaller","StateSheetsCaller","PageStateItems","StateSheetCountCaller","UserSheetsCaller","MySheetsCaller","SheetCaller","resVerify","count","getStateSheets","queryApiName","BookQueryCaller","schemaFrom","actionSchema","querySchema","AddCaller","DelCaller","AllCaller","PageCaller","qc","QueryCaller","MapCaller","getCaller","MapAddCaller","add","MapDelCaller","MapAllCaller","MapPageCaller","MapQueryCaller","FormView","buttonsRow","buildRows","onSubmit","initValues","formRows","createRow","buildRow","readOnly","createButtons","formRow","formRowCreator","some","every","uiSchema","onItemChanged","userSetProp","importCLogin","CLogin","radioStyle","TagView","nameFromId","namesFromIds","renderRadio","renderView","renderCheck","wrapClassName","inputs","inputName","onInputChange","coll","_view","lines","line","ext","formRes","number","integer","zh","listRes","none","DropdownActions","menu","button","handleDocumentClick","dropdownOpen","contains","toggle","isRight","itemIconClass","itemCaptionClass","hasIcon","data-toggle","aria-expanded","iconClass","captionClass","aria-hidden","onTouchStart","timeRes","md","month","ymd","year","yesterday","today","tomorrow","$zh","$en","tt","renderDate","vDate","withTime","always","nDate","_date","nowYear","hour","getHours","minute","getMinutes","appendTime","dPart","hm","EasyDate","EasyTime","Media","disp","main","px","py","SearchBox","allowEmptySearch","initKey","onSearch","inputSize","inputClassName","buttonText","userCache","loader","UserView","noneImage","getValue","idProp","useUser","use","Ax","axProps","aClassName","naClassName","openSysPage","cacheTimer","loadIds","clearCacheTimer","cacheIds","tuidCached","innerPullModify","tuidLists","queueModify","queue","modify","modifyIds","UQsMan","tonvaAppName","collection","localData","buildTVs","uqsMan","uqAppData","retErrors","setTuidImportsLocal","_uqs","buildUQs","errors","uqTVs","lj","uqsData","promiseInits","uqFullName","lower","loadEntities","uqMan","uqKey","proxy","Proxy","receiver","showReload","isImport","setInner","tuidImport","fromName","iName","setFrom","unitCaptions","1","2","3","unitCaption","TonvaForm","MultiStep","stepViews","topView","onPrev","onNext","nextStepName","next","setStep","first","stepName","steps","ButtonConten","prefix","btnContent","formProps","pIcon","sIcon","Rule","RuleCustom","func","defy","RulePredefined","RuleRequired","RuleNum","minMsg","maxMsg","template","checkMore","RuleInt","isInteger","Widget","context","fieldProps","_ui","isChanging","changeValue","container","visible","inNode","requiredFlag","FieldContainer","renderBody","getUiItem","contextErrors","buildRules","removeErrorWidget","addErrorWidget","initData","fromElement","onChanging","onChanged","prev","allowChange","setDataValue","setElementValue","elDiscription","discriptionClassName","errorList","fieldClass","FieldClass","uiLabel","TextWidget","inputType","internalOnKeyDown","onEnter","blur","checkRules","checkContextRules","hasFocus","renderTemplet","renderErrors","TextAreaWidget","setValue","PasswordWidget","UrlWidget","EmailWidget","NumberWidget","UpdownWidget","returnValue","isValidKey","DateWidget","DateTimeWidget","TimeWidget","MonthWidget","CheckBoxWidget","SelectWidget","select","option","RadioWidget","rowKey","isRow","RangeWidget","IdWidget","pickId","clearContextError","Unknown","dataType","uiType","dataTypes","ButtonWidget","submit","observerRender","widgetType","ButtonClass","Context","subContexts","widgets","arrRowContexts","itemName","getDisabled","setDisabled","getReadOnly","setReadOnly","getVisible","setVisible","buttonName","errorWidgets","ew","onButtonClick","checkFieldRules","rowContext","setContextError","clearWidgetsErrors","clearContextErrors","checkHasError","rowKeySeed","RowContext","parentContext","arrSchema","uiArr","itemSchemas","FormContext","ContextContainer","ArrComponent","selectable","deletable","restorable","getArrRowContexts","onDeleted","onRestored","arrLabel","ArrContainer","RowSeperator","formSelectable","formDeletable","formRestorable","arrSelectable","arrDeletable","arrRestorable","ac","rc","rs","rowContent","typeofTemplet","factory","selectCheck","deleteIcon","$isSelected","$source","isDeleted","$isDeleted","editContainer","Provider","ImageWidget","imageSrc","end","TagWidget","widgetsFactory","textarea","datetime","time","email","updown","checkbox","image","checkboxes","radio","tagSingle","valuesView","renderRadios","tagMulti","defaultArr","def","renderChecks","range","typeWidget","getItemSchema","getTypeWidget","WidgetClass","Form","formContext","Container","watch","calcSelectOrDelete","DefaultContainer","DefaultFieldContainer","fieldLabelSize","labelView","fieldCol","DefaultFieldClass","DefaultButtonClass","DefaultRes","autorun","dv","initDataItem","arrItem","arrItems","arrDict","arrItemOperated","formArrVal","beforeShow","renderContent","contextType","VLogout","onLogout","tonvaTop","logo","senders","regex","getSender","VLogin","onLogin","username","pwd","sender","margin","privacyEntry","VChangePassword","orgPassword","newPassword","newPassword1","VStart","checkAccount","accountLable","pageCaption","marginLeft","marginRight","VRegisterStart","VForgetStart","VVerify","onVerifyChanged","onVerify","typeText","extra","VPassword","onButtonSubmit","rePwd","onPasswordSubmit","submitCaption","VRegisterPassword","VForgetPassword","VSuccess","VRegisterSuccess","VForgetSuccess","CRegBase","retUser","userLogined","openVPage","checkVerify","toPassword","isExists","accountError","sendVerify","toVerify","CRegister","country","mobile","mobileCountry","register","toSuccess","regReturn","registerReturn","CForget","resetPassword","cRegister","cForget","vPage","getVChangePassword","changePassword","StringItemEdit","inputOptions","RadioItemEdit","SelectItemEdit","IdItemEdit","TagItemEdit","renderInputs","TagSingleItemEdit","TagMultiItemEdit","TextAreaItemEdit","CheckBoxItemEdit","RangeItemEdit","NumberItemEdit","Edit","defaultSepClassName","defaultRowContainerClassName","topBorder","bottomBorder","rowContainerClassName","rowClick","itemEdit","editInRow","onItemClick","stopEdit","topBorderClassName","bottomBorderClassName","sepClassName","ie","createItemEdit","divLabel","requireFlag","centerApi","userName","VUnsupportedUnit","VUnitSelect","renderRow","onRowClick","appUnit","setAppUnit","appUnits","VErrorsPage","VStartError","CAppBase","config","appConfig","noUnit","roleDefines","nRole","roleDefs","onNavRoutes","userAppUnits","showUnsupport","appUnitId","resolveRoute","userFromId","CApp","htmlTitle","html","html0","cApp","CBase","_cApp","hasRole","wn","getWebNav","CSub","_owner","ownerWNs","own","ListBase","pageItems","Clickable","Static","Selectable","inputItems","buildItems","itemsArray","isItemSelected","selectedItems","compare","retItems","labelId","comp","selectItem","si","obItem","onSelect","flex","marginBottom","htmlFor","listenArraySplice","isObservableArray","observe","change","removedCount","added","_added","checkAll","anySelected","List","listBase","buildBase","prevProps","prevState","isEqual","forceUpdate","selectAll","unselectAll","waitingMore","tabIndex","isLoading","staticRow","PropRow","PropBorder","borderTop","PropGap","valueAlignStart","valueAlignCenter","valueAlignEnd","LabeledPropRow","gridProps","_prop","col","labelFixLeft","bk","renderLabel","renderProp","align","vAlign","alignValue","renderPropBody","renderPropContent","StringPropRow","NumberPropRow","ListPropRow","borderBottom","ComponentPropRow","PropView","isGap","setValues","PropGrid","propView","IdCache","tuidLocal","localArr","waitingIds","tuidInner","divName","initLocalArr","isNumber","has","moveToHead","_id","useId","tuidValues","cacheIdValues","unpackTuidIds","cacheValue","cacheTuidFieldValues","loadTuidIdsOrLocal","localedValues","netIds","loadTuidIds","netRet","IdDivCache","Tuid","noCache","typeName","idName","unique","TuidBox","id1","id2","idValue","divs","cacheFields","idCache","tuidDiv","TuidDiv","resetCache","assureObj","IdsCaller","GetCaller","cacheFieldsInValue","arrValues","$create","$update","stampOnMain","unpackTuidIdsOfFields","SavePropCaller","searchArr","SearchCaller","LoadArrCaller","SaveArrCaller","order","ArrPosCaller","TuidNoCaller","TuidCaller","$id","transParams","arrParams","arrValue","buildDateParam","bid","$order","loadMain","save","saveProp","search","loadArr","saveArr","posArr","hasDiv","TuidBoxDiv","mainApi","toUser","fromUnit","fromApp","fellow","isOwner","isAdmin","dev","deleted","apps","member","assigned","devApi","uqsText","service","CacheUnits","CacheUqs","CacheApps","CacheBuses","bus","CacheUsers","CacheServers","server","buses","servers","users","ObjItems","store","_load","cur","_save","_inc","_del","_dec","Apps","saveApp","delApp","counts","searchUq","searchPageSize","searchedUqs","Uqs","saveUq","delUq","Buses","saveBus","delBus","busName","checkBusName","checkBusFace","checkBusQuery","faceReplaceStringWithFace","busTypes","refNameOk","faceName","hasFaceReplace","newFace","pushFaceField","faceFromName","parseField","delArr","parsed","checkBusQueryParam","refArrayOk","Servers","saveServer","delServer","Services","services","saveService","delService","changeServiceProp","loadUqServices","SearchItems","Dev","searchApp","searchServer","uqServer","unitAdmins","accUnits","devUnits","bothUnits","memberCount","roleApps","roleMember","roleMembers","memberRoles","userUnitAdmins","loadUnit","ua","unitChangeProp","unitApps","unitMemberCount","uqBuilderUrl","appId","unitDeleteApp","inUnit","unitAddApp","unitRoles","unitAddRole","unitRoleChangeProp","unitRoleApps","unitRoleSetApps","unitMembers","unitAssignMember","unitMemberRoles","rId","unitSetMemberRoles","org","CUqBase","IdDates","date_init","date_update","span","isLink","UnitSpan","disc","UnitName","UnitInfo","appIcon","REACT_APP_ICON","UqSpan","REACT_APP_ITEM_ICON","api","UqInfo","AppRow","AppInfo","apis","BusSpan","BusInfo","ServerSpan","ip","ServerInfo","StringValueEdit","errorDiv","info","IdPickPage","itemClick","idFromItem","candidateItems","searchPlaceHolder","createIdPick","Info","renderUqRow","uqAccess","act","appActed","newInUnit","restoreUnitApp","stopUnitApp","newApp","addUnitApp","uqAccesses","faName","PageApps","NewApp","appClick","renderApp","AppsPage","loadApps","ban","newItem","itemRender","appList","listRowClick","showNewApp","appRow","spanCaption","ServerCaption","cloud","EditBasePage","moreCandidates","pickServerId","renderServerInput","itemId","EditPage","NewPage","SearchUqPage","onUq","AppPage","editItem","deleteItem","deleteApp","menuItems","btnAddUq","uqClick","isMain","UqBindPage","saveUqBind","removeUqBind","setMainUQ","saveSetUqMain","btnLeft","btnRight","isBinded","AppController","uqMainId","uqMain","service_count","mainIdex","appSetUqMain","setUqMain","getMyUqs","appBindUq","groupStart","groupEnd","Section","rowId","ReactDOMServer","renderToStaticMarkup","StringSection","GroupSection","collaps","setCollaps","titleIcon","cId","whiteSpace","elId","elIcon","firstElementChild","fa","createRange","selectNode","createContextualFragment","parentNode","insertBefore","nextSibling","removeChild","EndSection","ErrorSection","Fragment","ResultSections","containerElement","stop","sectionId","addToGroup","addText","appendChild","section","sections","renderHtml","addHtml","afterMount","mayStart","sec","addSection","CompileResultPage","resultSections","timeHandler","autoScrollEnd","autoScroll","doubleClick","pane","getParent","topIntoView","bottomIntoView","lastScrollTop","pauseAutoScrollToBottom","startAutoScrollToBottom","startTime","total","renderText","parentElement","uintArray","encodedString","fromCharCode","read","done","compile_time","deploy_time","buf","uintToString","byteLength","actionName","abortController","abort","getReader","pump","endAutoScrollToBottom","finish","onDoubleClick","fontWeight","UqUpload","upFiles","fileClick","fr","readAsText","onUpload","lastModifiedDate","trunc","sz","AbortController","signal","fileList","fileRender","encType","click","compiled","compile","description","deploy","UqDeploy","onCompile","UqPage","idPickServerProps","serverRow","testServerRow","UnitCaption","uqUniqueUnitRow","dbRow","NewServicePage","uqId","ServicePage","onDbChanged","orgValue","changeProp","onUnitPick","pickUnit","uqUniqueUnit","onServerPick","pickServer","onServerTestPick","serverTest","onDeleteClick","UQPage","deleteUq","adminDev","btnAddService","onServiceClick","onUqUpload","onUqTest","onUqDeploy","onUqDevsAdmin","serviceClick","angle","cnIcon","showNewServicePage","devList","uqDevs","renderService","ListPage","batchCompile","batchCompilePage","uqList","listRow","listCompileRow","cnBtn","bar","thoroughly","selectItems","VUqDevsAdmin","admin","devChanged","admins","devs","listHeader","loadAdmins","CPickServer","PageServerItems","VPickServer","renderServer","clickServer","onClickNullServer","searchBox","Admins","owners","unitAdmin","removeOneUnitAdmin","fellowId","unitSetAdmin","removeUnitAdmin","unitAddAdmin","unitDelAdmin","CPickUnit","unitItems","VPickUnit","renderUnit","clickUnit","CUq","loadUqEntities","cPickServer","newC","cPickUnit","uqGetEntities","r0","devUser","adminDevAdd","adminDevDel","svc","mine","SchemaView","busesProps","repeated","canEdit","serversProps","ObjView","New","tonvaForm","saveCur","stepHeader","del","extraMenuActions","defaultIconClass","rArrow","VUnit","appsAction","newUsersAction","cUsers","adminsAction","cAdmins","uqRolesAction","cUqRoles","noneAction","backgroundColor","mid","iconClassName","P","objProps","showAppXAccount","onClickUnitProps","vice","appRender","developersAction","onShowDevelopers","uqAction","startUq","busAction","serverAction","appItemRender","UnitProps","isRoot","readMe","divReadMe","VHome","onClickUnit","onShowUnit","selectUnitPage","renderUnitAdmin","noUnitPage","isProduction","VApp","appXAccount","showDetail","showUserList","calcUserColl","renderAdmins","renderRoles","renderUsers","showAdmins","showRoles","roleUserCount","roleUsers","showUsers","VDetail","onTurnOnOff","appTurnOnOff","VUser","roleBins","uqRoles","showEditUserPage","divRoles","box","VAddUser","roleNum","showAddUserPage","VAdmins","renderVm","VRoleUsers","renderRole","VNoRoleUsers","VAddUserPage","addUser","roleCaption","getRoleCaption","VUserList","UserSpan","UserInfo","VEditUserPage","isChecked","isMeAdmin","onAdminChanged","setAppAdmin","onRoleChanged","setAppRole","onDelUer","delUser","btnDel","onAdminChange","onRoleChange","CAppXAccount","isUser","isRole","mask","rus","setAppRoles","unitOnly","loadAppAdmins","unitAppAdmins","uq_main","insertUser","userRoles","roleBit","renewUser","VDevelopers","renderUserUqsBuses","userUqsBuses","adminDevs","getUserUqsBuses","userObj","onClickUserUqsBuses","showUserUqsBuses","onAddUser","showAddDeveloper","VUqsBuses","renderUq","onChangeUq","showUserUqs","renderBus","onChangeBus","showUserBuses","onDelDev","delDev","btnUqAdd","uqHeader","btnBusAdd","busHeader","VUqs","onCheckChanged","changeUserDev","renderUqItem","onClickUq","uqItems","VBuses","renderBusItem","onClickBusItem","userBuses","VAddDeveloper","onSubmitClick","addDev","CDevelopers","AdminDevs","VUqRoles","renderDevUQ","devUQs","onDevUQ","newUser","VRoleAdmin","renderItem","userRole","onRightClick","rightIcon","allRoles","vUser","restoreUser","deleteUser","vCap","VItem","VUserRoles","MeItem","meRoles","iRole","setUserRole","CUqRoles","myRolesChanged","getAllRoleUsers","allUserRoles","runInAction","rolesBool","meId","ur","loadUQs","unitUQs","setUserRoles","fireMyRolesChanged","newRoles","roleNames","userFromKey","buildRolesText","deleteUserRoles","VEditAdmin","setAdmin","Fellow","VAddAdmin","addAdmin","onNewFellow","onItemSelect","disableDel","onSelectAll","onClearAll","onDel","delAdmins","onAddAdmin","adminsView","CAdmins","VApps","appUsers","appUsersList","onAppsClick","VUsers","userApps","userAppsList","searchUser","onUsersClick","curApp","curAppUsers","onAppEditUsers","curUser","curUserApps","onUserEditApps","VAppEditUsers","appEditUsers","renderUserItem","editUser","onUserChanged","bindAppUser","VUserEditApps","userEditApps","editApp","onAppChanged","bindUserApp","onSearchFocus","divUser","addedPage","onAddApps","onContinueAddUser","CUsers","onAppUsers","loadAppUsers","onUserApps","loadUserApps","unitOneAppUsers","unitOneUserApps","unitAppEditUsers","unitUserEditApps","unitAddUser","unitAppUsers","unitUsers","CHome","startApp","loadCounts","cAppXAccount","loadAdminUnits","cHome","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode"],"mappings":"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","file":"static/js/main.b23a28f4.chunk.js","sourcesContent":["export * from './tool';\r\nexport * from './net';\r\nexport * from './components';\r\nexport * from './auth';\r\nexport * from './uq';\r\nexport * from './app';\r\nexport * from './vm';\r\n","export * from './navigo';\r\nexport * from './nav';\r\nexport * from './page';\r\nexport * from './schema';\r\nexport * from './form';\r\nexport * from './edit';\r\nexport * from '../res/res';\r\nexport * from './loading';\r\nexport * from './image';\r\nexport * from './resUploader';\r\nexport * from './list';\r\nexport * from './dropDownActions';\r\nexport * from './easyDate';\r\nexport * from './propGrid';\r\nexport * from './simple';\r\nexport * from './media';\r\nexport * from './searchBox';\r\nexport * from './userIcon';\r\nexport * from './ax';\r\nexport * from './autoHideTips';\r\nexport * from './login';","import { decodeGuestToken } from '../tool/user';\r\nimport { CenterApiBase } from './uqApi';\r\n\r\nexport class GuestApi extends CenterApiBase {\r\n    async guest(): Promise<any> {\r\n        //let guest = nav.local.guest.get();\r\n        let ret = await this.get('', {});\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeGuestToken(ret);\r\n            case 'object':\r\n                let guest = decodeGuestToken(ret.token);\r\n                return guest;\r\n        }\r\n    }\r\n\r\n    async unitFromName(unitName:string): Promise<number> {\r\n        let ret = await this.get(unitName);\r\n        return ret && ret.unit;\r\n    }\r\n}\r\n\r\nexport const guestApi = new GuestApi('tv/guest/', undefined);\r\n","export abstract class Caller<T> {\r\n    protected readonly _params: T;\r\n    constructor(params: T, waiting: boolean) {\r\n        this._params = params;\r\n        this.waiting = waiting;\r\n    }\r\n    protected get params():any {return this._params;}\r\n    buildParams():any {return this.params;}\r\n    method: string  = 'POST';\r\n    abstract get path(): string;\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    waiting: boolean;\r\n}\r\n","import * as React from 'react';\r\nimport {observable} from 'mobx';\r\nimport _ from 'lodash';\r\nimport {User, Guest/*, UserInNav*/} from '../tool/user';\r\nimport {Page} from './page/page';\r\nimport {netToken} from '../net/netToken';\r\nimport FetchErrorView, { SystemNotifyPage } from './fetchErrorView';\r\nimport {FetchError} from '../net/fetchError';\r\nimport {appUrl, setAppInFrame, getExHash, getExHashPos} from '../net/appBridge';\r\nimport {LocalData, env} from '../tool';\r\nimport {guestApi, logoutApis, setCenterUrl, setCenterToken, appInFrame, host, resUrlFromHost, messageHub} from '../net';\r\nimport { resOptions } from '../res/res';\r\nimport { Loading } from './loading';\r\nimport { Navigo, RouteFunc, Hooks, NamedRoute } from './navigo';\r\n\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport '../css/va-form.css';\r\nimport '../css/va.css';\r\nimport '../css/animation.css';\r\nimport { FA } from './simple';\r\nimport { userApi } from '../net';\r\nimport { ReloadPage, ConfirmReloadPage } from './reloadPage';\r\nimport { PageWebNav } from './page';\r\nimport { Login } from './login';\r\nimport { createLogin } from '../auth';\r\n\r\nconst regEx = new RegExp('Android|webOS|iPhone|iPad|' +\r\n    'BlackBerry|Windows Phone|'  +\r\n    'Opera Mini|IEMobile|Mobile' , \r\n    'i');\r\nconst isMobile = regEx.test(navigator.userAgent);\r\n\r\n/*\r\nexport const mobileHeaderStyle = isMobile? {\r\n    minHeight:  '3em'\r\n} : undefined;\r\n*/\r\n//const logo = require('../img/logo.svg');\r\nlet logMark: number;\r\nconst logs:string[] = [];\r\nexport type NavPage = (params:any) => Promise<void>;\r\n\r\nexport interface Props\r\n{\r\n    onLogined: (isUserLogin?:boolean)=>Promise<void>;\r\n    notLogined?: ()=>Promise<void>;\r\n};\r\nlet stackKey = 1;\r\nexport interface StackItem {\r\n    key: number;\r\n    view: JSX.Element;\r\n    ceased: boolean;\r\n    confirmClose?: ()=>Promise<boolean>;\r\n    disposer?: ()=>void;\r\n}\r\nexport interface NavViewState {\r\n    stack: StackItem[];\r\n    wait: 0|1|2;\r\n    fetchError: FetchError\r\n}\r\n\r\nexport class NavView extends React.Component<Props, NavViewState> {\r\n    private stack: StackItem[];\r\n    private waitCount: number = 0;\r\n    private waitTimeHandler?: NodeJS.Timer;\r\n\r\n    constructor(props:Props) {\r\n        super(props);\r\n        this.stack = [];\r\n        this.state = {\r\n            stack: this.stack,\r\n            wait: 0,\r\n            fetchError: undefined\r\n        };\r\n        nav.set(this);\r\n    }\r\n    async componentDidMount()\r\n    {\r\n\t\twindow.addEventListener('popstate', this.navBack);\r\n\t\t//if (nav.isRouting === false) {\r\n\t\tawait nav.init();\r\n\t\t//}\r\n        await nav.start();\r\n    }\r\n\r\n    get level(): number {\r\n        return this.stack.length;\r\n    }\r\n\r\n    startWait() {\r\n        if (this.waitCount === 0) {\r\n            this.setState({wait: 1});\r\n            this.waitTimeHandler = env.setTimeout(\r\n                'NavView.startWait',\r\n                () => {\r\n                    this.waitTimeHandler = undefined;\r\n                    this.setState({wait: 2});\r\n                },\r\n                1000) as NodeJS.Timer;\r\n        }\r\n        ++this.waitCount;\r\n        this.setState({\r\n            fetchError: undefined,\r\n        });\r\n    }\r\n\r\n    endWait() {\r\n        env.setTimeout(\r\n            undefined, //'NavView.endWait',\r\n            () => {\r\n            /*\r\n            this.setState({\r\n                fetchError: undefined,\r\n            });*/\r\n            --this.waitCount;\r\n            if (this.waitCount === 0) {\r\n                if (this.waitTimeHandler !== undefined) {\r\n                    env.clearTimeout(this.waitTimeHandler);\r\n                    this.waitTimeHandler = undefined;\r\n                }\r\n                this.setState({wait: 0});\r\n            }\r\n        },100);\r\n    }\r\n\r\n    async onError(fetchError: FetchError)\r\n    {\r\n        let err = fetchError.error;\r\n        if (err !== undefined) {\r\n            if (err.unauthorized === true) {\r\n\t\t\t\tawait nav.showLogin(undefined);\r\n\t\t\t\t//nav.navigateToLogin();\r\n                return;\r\n            }\r\n            switch (err.type) {\r\n                case 'unauthorized':\r\n                    await nav.showLogin(undefined);\r\n\t\t\t\t\t//nav.navigateToLogin();\r\n                    return;\r\n                case 'sheet-processing':\r\n                    nav.push(<SystemNotifyPage message=\"单据正在处理中。请重新操作！\" />);\r\n                    return;\r\n            }\r\n        }\r\n        this.setState({\r\n            fetchError: fetchError,\r\n        });\r\n    }\r\n\r\n    private upgradeUq = () => {\r\n        nav.start();\r\n    }\r\n\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        this.show(<Page header={false}>\r\n            <div>\r\n                UQ升级了，请点击按钮升级 <br />\r\n                <small className=\"text-muted\">{uq} ver-{version}</small>\r\n                <button className=\"btn btn-primary\" onClick={this.upgradeUq}>升级</button>\r\n            </div>\r\n        </Page>)\r\n    }\r\n\r\n    show(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.clear();\r\n        return this.push(view, disposer);\r\n    }\r\n\r\n    push(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.removeCeased();\r\n        if (this.stack.length > 0) {\r\n            window.history.pushState('forward', null, null);\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key,\r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        this.refresh();\r\n        //console.log('push: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    replace(view: JSX.Element, disposer?: ()=>void): number {\r\n        let item:StackItem = undefined;\r\n        let stack = this.stack;\r\n        if (stack.length > 0) {\r\n            item = stack.pop();\r\n            //this.popAndDispose();\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key, \r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        if (item !== undefined) this.dispose(item.disposer);\r\n        this.refresh();\r\n        //console.log('replace: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    ceaseTop(level:number = 1) {\r\n        let p = this.stack.length - 1;\r\n        for (let i=0; i<level; i++, p--) {\r\n            if (p < 0) break;\r\n            let item = this.stack[p];\r\n            item.ceased = true;\r\n        }\r\n    }\r\n\r\n    pop(level:number = 1) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        //console.log('pop start: %s pages level=%s', len, level);\r\n        if (level <= 0 || len <= 1) return;\r\n        if (len < level) level = len;\r\n        let backLevel = 0;\r\n        for (let i = 0; i < level; i++) {\r\n            if (stack.length === 0) break;\r\n            //stack.pop();\r\n            this.popAndDispose();\r\n            ++backLevel;\r\n        }\r\n        if (backLevel >= len) backLevel--;\r\n        this.refresh();\r\n        if (this.isHistoryBack !== true) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(backLevel);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n        //console.log('pop: %s pages', stack.length);\r\n    }\r\n\r\n    popTo(key: number) {\r\n        if (key === undefined) return;\r\n        if (this.stack.find(v => v.key === key) === undefined) return;\r\n        while (this.stack.length >0) {\r\n            let len = this.stack.length;\r\n            let top = this.stack[len-1];\r\n            if (top.key === key) break;\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    topKey():number {\r\n        let len = this.stack.length;\r\n        if (len === 0) return undefined;\r\n        return this.stack[len-1].key;\r\n    }\r\n\r\n    removeCeased() {\r\n        for (;;) {\r\n            let p=this.stack.length-1;\r\n            if (p < 0) break;\r\n            let top = this.stack[p];\r\n            if (top.ceased === false) break;\r\n            let item = this.stack.pop();\r\n            let {disposer} = item;\r\n            this.dispose(disposer);\r\n        }\r\n        this.refresh();\r\n    }\r\n\r\n    private popAndDispose() {\r\n        this.removeCeased();\r\n        let item = this.stack.pop();\r\n\t\tif (item === undefined) return;\r\n\t\t//if (nav.isRouting) {\r\n\t\t//\twindow.history.back();\r\n\t\t//}\r\n        let {disposer} = item;\r\n        this.dispose(disposer);\r\n        this.removeCeased();\r\n        return item;\r\n    }\r\n\r\n    private dispose(disposer:()=>void) {\r\n        if (disposer === undefined) return;\r\n        let item = this.stack.find(v => v.disposer === disposer);\r\n        if (item === undefined) disposer();\r\n    }\r\n\r\n    clear() {\r\n        let len = this.stack.length;\r\n        while (this.stack.length > 0) this.popAndDispose();\r\n        //this.refresh();\r\n        if (len > 1) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(len-1);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n    }\r\n\r\n    regConfirmClose(confirmClose:()=>Promise<boolean>) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        let top = stack[len-1];\r\n        top.confirmClose = confirmClose;\r\n    }\r\n\r\n    private isHistoryBack:boolean = false;\r\n    navBack = () => {\r\n        //nav.log('backbutton pressed - nav level: ' + this.stack.length);\r\n        let tick = Date.now();\r\n        this.isHistoryBack = true;\r\n        this.back(true);\r\n        this.isHistoryBack = false;\r\n        console.log(`///\\\\\\\\ ${Date.now()-tick}ms backbutton pressed - nav level: ${this.stack.length}`);\r\n    }\r\n\r\n    back = async (confirm:boolean = true) => {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        if (len === 1) {\r\n            if (window.self !== window.top) {\r\n                window.top.postMessage({type:'pop-app'}, '*');\r\n            }\r\n            return;\r\n        }\r\n        let top = stack[len-1];\r\n        if (confirm===true && top.confirmClose) {\r\n            if (await top.confirmClose()===true) this.pop();\r\n        }\r\n        else {\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    confirmBox(message?:string): boolean {\r\n        return window.confirm(message);\r\n    }\r\n    clearError = () => {\r\n        this.setState({fetchError: undefined});\r\n    }\r\n    render() {\r\n        const {wait, fetchError} = this.state;\r\n        let {stack} = this.state;\r\n        let top = stack.length - 1;\r\n        let elWait = null, elError = null;\r\n        switch (wait) {\r\n            case 1:\r\n                elWait = <div className=\"va-wait va-wait1\">\r\n                </div>;\r\n                break;\r\n            case 2:\r\n                elWait = <div className=\"va-wait va-wait2\">\r\n                    <Loading />\r\n                </div>;\r\n                break;\r\n        }\r\n        if (fetchError)\r\n            elError = <FetchErrorView clearError={this.clearError} {...fetchError} />;\r\n        let test = nav.testing===true && \r\n\t\t\t<span className=\"cursor-pointer position-fixed\" style={{top:0,left:'0.2rem',zIndex:90001}}>\r\n                <FA className=\"text-warning\" name=\"info-circle\" />\r\n\t\t\t</span>;\r\n        return <>\r\n\t\t\t{stack.map((item, index) => {\r\n\t\t\t\tlet {key, view} = item;\r\n\t\t\t\treturn <div key={key} style={index<top? {visibility: 'hidden', position: 'absolute'}:undefined}>\r\n\t\t\t\t\t{view}\r\n\t\t\t\t</div>\r\n\t\t\t})}\r\n\t\t\t{elWait}\r\n\t\t\t{elError}\r\n\t\t\t{test}\r\n\t\t</>;\r\n    }\r\n\r\n    private refresh() {\r\n        this.setState({stack: this.stack });\r\n    }\r\n}\r\n\r\nexport interface NavSettings {\r\n    oem?: string;\r\n    loginTop?: JSX.Element;\r\n    privacy?: string;\r\n}\r\n\r\nexport class Nav {\r\n    private navView:NavView;\r\n    //private ws: WsBase;\r\n\tprivate wsHost: string;\r\n    private local: LocalData = new LocalData();\r\n\tprivate navigo: Navigo;\r\n\t//isRouting: boolean = false;\r\n\tnavSettings: NavSettings;\r\n    @observable user: User/*InNav*/ = undefined;\r\n    testing: boolean;\r\n    language: string;\r\n    culture: string;\r\n    resUrl: string;\r\n\r\n    constructor() {\r\n        let {lang, district} = resOptions;\r\n        this.language = lang;\r\n        this.culture = district;\r\n\t\tthis.testing = false;\r\n    }\r\n\r\n    get guest(): number {\r\n        let guest = this.local.guest;\r\n        if (guest === undefined) return 0;\r\n        let g = guest.get();\r\n        if (g === undefined) return 0;\r\n        return g.guest;\r\n    }\r\n\r\n    set(navView:NavView) {\r\n        //this.logo = logo;\r\n        this.navView = navView;\r\n\t}\r\n\t/*\r\n    registerReceiveHandler(handler: (message:any)=>Promise<void>):number {\r\n        //if (this.ws === undefined) return;\r\n        return messageHub.onReceiveAny(handler);\r\n    }\r\n\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        //if (this.ws === undefined) return;\r\n        if (handlerId === undefined) return;\r\n        messageHub.endReceive(handlerId);\r\n    }\r\n\t*/\r\n    async onReceive(msg:any) {\r\n        //if (this.ws === undefined) return;\r\n        await messageHub.dispatch(msg);\r\n    }\r\n\r\n\tprivate async loadUnitJson() {\r\n\t\ttry {\r\n\t\t\tlet unitJsonPath = this.unitJsonPath();\r\n\t\t\tlet unitRes = await fetch(unitJsonPath, {});\r\n\t\t\tlet res = await unitRes.json();\r\n\t\t\treturn res.unit;\r\n\t\t}\r\n\t\tcatch (err1) {\r\n\t\t\tthis.local.unit.remove();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n    private async getPredefinedUnitName() {\t\t\r\n\t\tlet el = document.getElementById('unit');\r\n\t\tif (el) {\r\n\t\t\treturn el.innerText;\r\n\t\t}\r\n\t\tel = document.getElementById('unit.json');\r\n\t\tif (!el) {\r\n\t\t\treturn await this.loadUnitJson();\r\n\t\t}\r\n\t\ttry {\r\n            let json = el.innerHTML;\r\n            let res = JSON.parse(json);\r\n            return res.unit;\r\n        }\r\n        catch (err) {\r\n\t\t\treturn await this.loadUnitJson();\r\n        }\r\n    }\r\n\r\n    private async loadPredefinedUnit() {\r\n        let envUnit = process.env.REACT_APP_UNIT;\r\n        if (envUnit !== undefined) {\r\n            return Number(envUnit);\r\n        }\r\n        let unitName:string;\r\n        let unit = this.local.unit.get();\r\n        if (unit !== undefined) {\r\n            if (env.isDevelopment !== true) return unit.id;\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n            if (unit.name === unitName) return unit.id;\r\n        }\r\n        else {\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n        }\r\n        let unitId = await guestApi.unitFromName(unitName);\r\n        if (unitId !== undefined) {\r\n            this.local.unit.set({id: unitId, name: unitName});\r\n        }\r\n        return unitId;\r\n    }\r\n\r\n    setSettings(settings?: NavSettings) {\r\n        this.navSettings = settings;\r\n    }\r\n\r\n    get oem():string {\r\n        return this.navSettings && this.navSettings.oem;\r\n    }\r\n\r\n    hashParam: string;\r\n    private centerHost: string;\r\n    private arrs = ['/test', '/test/'];\r\n    private unitJsonPath():string {\r\n        let {origin, pathname} = document.location;\r\n\t\tpathname = pathname.toLowerCase();\r\n        for (let item of this.arrs) {\r\n            if (pathname.endsWith(item) === true) {\r\n                pathname = pathname.substr(0, pathname.length - item.length);\r\n                break;\r\n            }\r\n        }\r\n        if (pathname.endsWith('/') === true || pathname.endsWith('\\\\') === true) {\r\n            pathname = pathname.substr(0, pathname.length-1);\r\n        }\r\n        return origin + pathname + '/unit.json';\r\n    }\r\n    private windowOnError = (event: Event | string, source?: string, lineno?: number, colno?: number, error?: Error) => {\r\n\t\tdebugger;\r\n        console.error('windowOnError');\r\n        console.error(error);\r\n    }\r\n    private windowOnUnhandledRejection = (ev: PromiseRejectionEvent) => {\r\n\t\tdebugger;\r\n        console.error('windowOnUnhandledRejection');\r\n        console.error(ev.reason);\r\n    }\r\n    private windowOnClick = (ev: MouseEvent) => {\r\n        console.error('windowOnClick');\r\n    }\r\n    private windowOnMouseMove = (ev: MouseEvent) => {\r\n        console.log('navigator.userAgent: ' + navigator.userAgent);\r\n        console.log('mouse move (%s, %s)', ev.x, ev.y);\r\n    }\r\n    private windowOnScroll = (ev: Event) => {\r\n        console.log('scroll event');\r\n\t}\r\n\r\n\tforceDevelopment:boolean;\r\n\t\r\n\tasync init() {\r\n\t\tthis.testing = env.testing;\r\n\t\tif (this.forceDevelopment === true) {\r\n\t\t\tenv.isDevelopment = true;\r\n\t\t}\r\n\t\tawait host.start(this.testing);\r\n\t\tlet hash = document.location.hash;\r\n\t\tif (hash !== undefined && hash.length > 0) {\r\n\t\t\tlet pos = getExHashPos();\r\n\t\t\tif (pos < 0) pos = undefined;\r\n\t\t\tthis.hashParam = hash.substring(1, pos);\r\n\t\t}\r\n\t\tlet {url, ws, resHost} = host;\r\n\t\tthis.centerHost = url;\r\n\t\tthis.resUrl = resUrlFromHost( resHost);\r\n\t\tthis.wsHost = ws;\r\n\t\tsetCenterUrl(url);\r\n\r\n\t\tlet guest:Guest = this.local.guest.get();\r\n\t\tif (guest === undefined) {\r\n\t\t\tguest = await guestApi.guest();\r\n\t\t}\r\n\t\tif (!guest) {\r\n\t\t\tdebugger;\r\n\t\t\tthrow Error('guest can not be undefined');\r\n\t\t}\r\n\t\tnav.setGuest(guest);\r\n\r\n\t\tlet exHash = getExHash();\r\n\t\tlet appInFrame = setAppInFrame(exHash);\r\n\t\tif (exHash !== undefined && window !== window.parent) {\r\n\t\t\t// is in frame\r\n\t\t\tif (appInFrame !== undefined) {\r\n\t\t\t\t//this.ws = wsBridge;\r\n\t\t\t\tconsole.log('this.ws = wsBridge in sub frame');\r\n\t\t\t\t//nav.user = {id:0} as User;\r\n\t\t\t\tif (window.self !== window.parent) {\r\n\t\t\t\t\twindow.parent.postMessage({type:'sub-frame-started', hash: appInFrame.hash}, '*');\r\n\t\t\t\t}\r\n\t\t\t\t// 下面这一句，已经移到 appBridge.ts 里面的 initSubWin，也就是响应从main frame获得user之后开始。\r\n\t\t\t\t//await this.showAppView();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet predefinedUnit = await this.loadPredefinedUnit();\r\n\t\tappInFrame.predefinedUnit = predefinedUnit;\r\n\t}\r\n\r\n    async start() {\r\n        try {\r\n\t\t\twindow.onerror = this.windowOnError;\r\n            window.onunhandledrejection = this.windowOnUnhandledRejection;\r\n            //window.addEventListener('click', this.windowOnClick);\r\n            //window.addEventListener('mousemove', this.windowOnMouseMove);\r\n            //window.addEventListener('touchmove', this.windowOnMouseMove);\r\n            //window.addEventListener('scroll', this.windowOnScroll);\r\n            if (isMobile === true) {\r\n                document.onselectstart = function() {return false;}\r\n                document.oncontextmenu = function() {return false;}\r\n            }\r\n            //window.setInterval(()=>console.error('tick every 5 seconds'), 5000);\r\n\t\t\tnav.clear();\r\n\t\t\t//nav.onSysNavRoutes();\r\n\t\t\tthis.startWait();\r\n            \r\n            let user: User = this.local.user.get();\r\n            if (user === undefined) {\r\n                let {notLogined} = this.navView.props;\r\n                if (notLogined !== undefined) {\r\n                    await notLogined();\r\n                }\r\n                else {\r\n                    await nav.showLogin(undefined);\r\n\t\t\t\t\t//nav.navigateToLogin();\r\n                }\r\n                return;\r\n            }\r\n\r\n            await nav.logined(user);\r\n        }\r\n        catch (err) {\r\n\t\t\tconsole.error(err);\r\n\t\t\tdebugger;\r\n        }\r\n        finally {\r\n            this.endWait();\r\n        }\r\n\t}\r\n\r\n\tresolveRoute() {\r\n\t\t//if (this.isRouting === false) return;\r\n\t\tif (this.navigo === undefined) return;\r\n\t\tthis.navigo.resolve();\r\n\t}\r\n\r\n\ton(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\ton(...args:any[]):Navigo {\r\n\t\tif (this.navigo === undefined) {\r\n\t\t\tthis.navigo = new Navigo();\r\n\t\t\tif (this.isWebNav !== true) this.navigo.historyAPIUpdateMethod('replaceState');\r\n\t\t}\r\n\t\treturn this.navigo.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tprivate navLogin:NavPage = async (params:any) => {\r\n\t\tnav.showLogin(async (user: User) => window.history.back(), false);\r\n\t}\r\n\r\n\tprivate navLogout:NavPage = async (params:any) => {\r\n\t\tnav.showLogout(async () => window.history.back());\r\n\t}\r\n\r\n\tprivate navRegister:NavPage = async (params:any) => {\r\n\t\tnav.showRegister();\r\n\t}\r\n\r\n\tprivate navForget:NavPage = async (params:any) => {\r\n\t\tnav.showForget();\r\n\t}\r\n\r\n\tnavigateToLogin() {\r\n\t\tnav.navigate('/login');\r\n\t}\r\n\r\n\topenSysPage(url: string) {\r\n\t\tlet navPage: NavPage = this.sysRoutes[url];\r\n\t\tif (navPage === undefined) {\r\n\t\t\talert(url + ' is not defined in sysRoutes');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tnavPage(undefined);\r\n\t}\r\n\r\n\tprivate navPageRoutes: {[url:string]: NavPage};\r\n\tprivate routeFromNavPage(navPage: NavPage) {\r\n\t\treturn (params: any, queryStr: any) => {\r\n\t\t\tif (navPage) {\r\n\t\t\t\tif (this.isWebNav) nav.clear();\r\n\t\t\t\tnavPage(params);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tonNavRoute(navPage: NavPage) {\r\n\t\tthis.on(this.routeFromNavPage(navPage));\r\n\t}\r\n\tprivate doneSysRoutes:boolean = false;\r\n\tprivate sysRoutes: { [route: string]: NavPage } = {\r\n\t\t'/login': this.navLogin,\r\n\t\t'/logout': this.navLogout,\r\n\t\t'/register': this.navRegister,\r\n\t\t'/forget': this.navForget,\r\n\t}\r\n\t/*\r\n\tonSysNavRoutes() {\r\n\t\tthis.onNavRoutes(this.sysRoutes);\r\n\t}\r\n\t*/\r\n\tonNavRoutes(navPageRoutes: {[url:string]: NavPage}) {\r\n\t\tif (this.doneSysRoutes === false) {\r\n\t\t\tthis.doneSysRoutes = true;\r\n\t\t\tthis.internalOnNavRoutes(this.sysRoutes);\r\n\t\t}\r\n\t\tthis.internalOnNavRoutes(navPageRoutes);\r\n\t}\r\n\r\n\tprivate internalOnNavRoutes(navPageRoutes: {[url:string]: NavPage}) {\r\n\t\tif (!navPageRoutes) return;\r\n\t\tthis.navPageRoutes = _.merge(this.navPageRoutes, navPageRoutes);\r\n\t\tlet navOns: { [route: string]: (params: any, queryStr: any) => void } = {};\r\n\t\tfor (let route in navPageRoutes) {\r\n\t\t\tlet navPage = navPageRoutes[route];\r\n\t\t\tnavOns[route] = this.routeFromNavPage(navPage);\r\n\t\t}\r\n\t\tthis.on(navOns);\r\n\t}\r\n\r\n\t/*\r\n\tget isWebNav():boolean { \r\n\t\tif (!this.navigo) return false;\r\n\t\treturn !isMobile;\r\n\t}\r\n\t*/\r\n\tisWebNav:boolean = false;\r\n\tbackIcon = <i className=\"fa fa-angle-left\" />;\r\n\tcloseIcon = <i className=\"fa fa-close\" />;\r\n\tsetIsWebNav() {\r\n\t\tthis.isWebNav = true;\r\n\t\tthis.backIcon = <i className=\"fa fa-arrow-left\" />;\r\n\t\tthis.closeIcon = <i className=\"fa fa-close\" />;\r\n\t}\r\n\r\n\tpageWebNav: PageWebNav;\r\n\r\n\tget isMobile():boolean {return isMobile;}\r\n\r\n\tnavigate(url:string, absolute?:boolean) {\r\n\t\tif (!this.navigo) {\r\n\t\t\talert('Is not in webnav state, cannot navigate to url \"' + url + '\"');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.testing === true) {\r\n\t\t\turl += '#test';\r\n\t\t}\r\n\t\treturn this.navigo.navigate(url, absolute);\r\n\t}\r\n\r\n\tgo(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tif (this.navigo !== undefined) {\r\n\t\t\tthis.navigate(url, absolute);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tshowPage();\r\n\t\t}\r\n\t}\r\n\r\n    async showAppView(isUserLogin?: boolean) {\r\n        let {onLogined} = this.navView.props;\r\n        if (onLogined === undefined) {\r\n            nav.push(<div>NavView has no prop onLogined</div>);\r\n            return;\r\n        }\r\n        nav.clear();\r\n        await onLogined(isUserLogin);\r\n    }\r\n\r\n    setGuest(guest: Guest) {\r\n        this.local.guest.set(guest);\r\n        netToken.set(0, guest.token);\r\n    }\r\n\r\n    saveLocalUser() {\r\n        this.local.user.set(this.user);\r\n    }\r\n\r\n    async loadMe() {\r\n        let me = await userApi.me();\r\n        this.user.icon = me.icon;\r\n        this.user.nick = me.nick;\r\n    }\r\n\r\n\tprivate async internalLogined(user: User, callback: (user:User)=>Promise<void>, isUserLogin:boolean) {\r\n        logoutApis();\r\n        console.log(\"logined: %s\", JSON.stringify(user));\r\n        this.user = user;\r\n        this.saveLocalUser();\r\n\t\tnetToken.set(user.id, user.token);\r\n\t\tnav.clear();\r\n\r\n        if (callback !== undefined) //this.loginCallbacks.has)\r\n            callback(user);\r\n            //this.loginCallbacks.call(user);\r\n        else if (this.isWebNav === true) {\r\n\t\t\tthis.navigate('/index');\r\n\t\t}\r\n\t\telse {\r\n            await this.showAppView(isUserLogin);\r\n        }\r\n\t}\r\n\r\n\t// 缓冲登录\r\n    async logined(user: User, callback?: (user:User)=>Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, false);\r\n    }\r\n\r\n\t// 用户操作之后登录\r\n    async userLogined(user: User, callback?: (user:User)=>Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, true);\r\n    }\r\n\r\n    //wsConnect() {\r\n        //let ws:WSChannel = this.ws = new WSChannel(this.wsHost, this.user.token);\r\n        //ws.connect();\r\n    //}\r\n\r\n    loginTop(defaultTop:JSX.Element) {\r\n        return (this.navSettings && this.navSettings.loginTop) || defaultTop;\r\n    }\r\n\r\n    privacyEntry() {\r\n        if (!this.getPrivacyContent()) return;\r\n        return <div className=\"text-center\">\r\n            <button className=\"btn btn-sm btn-link\"\r\n                onClick={this.showPrivacyPage}>\r\n                <small className=\"text-muted\">隐私政策</small>\r\n            </button>\r\n        </div>;\r\n    }\r\n\r\n    private getPrivacyContent():string {\r\n        if (!this.navSettings) return;\r\n        let {privacy} = this.navSettings;\r\n        return privacy;\r\n    }\r\n\r\n    showPrivacyPage = () => {\r\n        let privacy = this.getPrivacyContent();\r\n        if (privacy) {\r\n            this.privacyPage(privacy);\r\n        }\r\n        else {\r\n            nav.push(<Page header=\"隐私政策\">\r\n                <div className=\"p-3\">AppConfig 中没有定义 privacy。可以定义为字符串，或者url。markdown格式</div>\r\n            </Page>);\r\n        }\r\n    }\r\n\r\n    private privacyPage = async (htmlString: string) => {\r\n        //let html = await this.getPrivacy(privacy);\r\n\t\t//let content = {__html: marked(html)};\r\n\t\tlet content = {__html: htmlString};\r\n        nav.push(<Page header=\"隐私政策\">\r\n            <div className=\"p-3\" dangerouslySetInnerHTML={content} />\r\n        </Page>);\r\n    }\r\n\r\n\tprivate createLogin = createLogin;\r\n\tsetCreateLogin(createLogin: ()=>Promise<Login>) {\r\n\t\tthis.createLogin = createLogin;\r\n\t}\r\n\r\n\tprivate login: Login;\r\n\tprivate async getLogin():Promise<Login> {\r\n\t\tif (this.login) return this.login;\r\n\t\treturn this.login = await this.createLogin();\r\n\t}\r\n\tasync showLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean) {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showLogin(callback, withBack);\r\n    }\r\n\r\n    async showLogout(callback?: ()=>Promise<void>) {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showLogout(callback);\r\n\t}\r\n\t\r\n\tasync showRegister() {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showRegister();\r\n\t}\r\n\r\n\tasync showForget() {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showForget();\r\n\t}\r\n\r\n    async logout(callback?:()=>Promise<void>) { //notShowLogin?:boolean) {\r\n        appInFrame.unit = undefined;\r\n        this.local.logoutClear();\r\n        this.user = undefined; //{} as User;\r\n        logoutApis();\r\n        let guest = this.local.guest.get();\r\n        setCenterToken(0, guest && guest.token);\r\n\t\t//this.ws = undefined;\r\n\t\tthis.clear();\r\n        if (callback === undefined)\r\n            await nav.start();\r\n        else\r\n            await callback();\r\n    }\r\n\r\n    async changePassword() {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showChangePassword();\r\n    }\r\n\r\n    get level(): number {\r\n        return this.navView.level;\r\n    }\r\n    startWait() {\r\n        this.navView?.startWait();\r\n    }\r\n    endWait() {\r\n        this.navView?.endWait();\r\n    }\r\n    async onError(error: FetchError) {\r\n        await this.navView.onError(error);\r\n    }\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await this.navView.showUpgradeUq(uq, version);\r\n    }\r\n\r\n    show (view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.show(view, disposer);\r\n    }\r\n    push(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.push(view, disposer);\r\n    }\r\n    replace(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.replace(view, disposer);\r\n    }\r\n    pop(level:number = 1) {\r\n        this.navView.pop(level);\r\n    }\r\n    topKey():number {\r\n        return this.navView.topKey();\r\n    }\r\n    popTo(key:number) {\r\n        this.navView.popTo(key);\r\n    }\r\n    clear() {\r\n        this.navView?.clear();\r\n    }\r\n    navBack() {\r\n        this.navView.navBack();\r\n    }\r\n    ceaseTop(level?:number) {\r\n        this.navView.ceaseTop(level);\r\n    }\r\n    removeCeased() {\r\n        this.navView.removeCeased();\r\n    }\r\n    async back(confirm:boolean = true) {\r\n        await this.navView.back(confirm);\r\n    }\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.navView.regConfirmClose(confirmClose);\r\n    }\r\n    confirmBox(message?:string): boolean {\r\n        return this.navView.confirmBox(message);\r\n    }\r\n    async navToApp(url: string, unitId: number, apiId?:number, sheetType?:number, sheetId?:number):Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            let sheet = this.centerHost.includes('http://localhost:') === true? 'sheet_debug':'sheet'\r\n            let uh = sheetId === undefined?\r\n                    appUrl(url, unitId) :\r\n                    appUrl(url, unitId, sheet, [apiId, sheetType, sheetId]);\r\n            console.log('navToApp: %s', JSON.stringify(uh));\r\n            nav.push(<article className='app-container'>\r\n                <span id={uh.hash} onClick={()=>this.back()} /*style={mobileHeaderStyle}*/>\r\n                    <i className=\"fa fa-arrow-left\" />\r\n                </span>\r\n                {\r\n                    // eslint-disable-next-line \r\n                    <iframe src={uh.url} title={String(sheetId)} />\r\n                }\r\n            </article>, \r\n            ()=> {\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n\r\n    navToSite(url: string) {\r\n        // show in new window\r\n        window.open(url);\r\n    }\r\n\r\n    get logs() {return logs};\r\n    log(msg:string) {\r\n        logs.push(msg);\r\n    }\r\n    logMark() {\r\n        let date = new Date();\r\n        logMark = date.getTime();\r\n        logs.push('log-mark: ' + date.toTimeString());\r\n    }\r\n    logStep(step:string) {\r\n        logs.push(step + ': ' + (new Date().getTime() - logMark));\r\n    }\r\n\r\n    showReloadPage(msg: string) {\r\n        let seconds = -1;\r\n\t\tthis.push(<ReloadPage message={msg} seconds={seconds} />);\r\n\t\t/*\r\n\t\tif (seconds > 0) {\r\n\t\t\tenv.setTimeout(undefined, this.reload, seconds*1000);\r\n\t\t}\r\n\t\t*/\r\n    }\r\n\r\n    reload = async () => {\r\n        let waiting:Promise<void> = new Promise<void>((resolve, reject) => {\r\n            setTimeout(resolve, 100);\r\n        });\r\n\r\n        if ('serviceWorker' in navigator) {\r\n            let registration =await Promise.race([waiting, navigator.serviceWorker.ready]);\r\n            if (registration) registration.unregister();\r\n        }\r\n\t\twindow.document.location.reload();\r\n\t\t// dcloud hbuilder里面的app自动升级，需要清webview的缓存\r\n\t\tlet plus = (window as any).plus;\r\n\t\tif (plus) {\r\n\t\t\tlet webview = plus.webview;\r\n\t\t\tif (webview) {\r\n\t\t\t\tif (webview.reload) webview.reload(true);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet webView = plus.webView;\r\n\t\t\t\tif (webView) {\r\n\t\t\t\t\tif (webView.reload) webView.reload(true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//plus.webview.reload(true)\r\n\t\t}\r\n    }\r\n\r\n    resetAll = () => {\r\n        this.push(<ConfirmReloadPage confirm={(ok:boolean):Promise<void> => {\r\n            if (ok === true) {\r\n                this.showReloadPage('彻底升级');\r\n\t\t\t\tlocalStorage.clear();\r\n\t\t\t\t/*\r\n                this.local.readToMemory();\r\n                env.localDb.removeAll();\r\n\t\t\t\tthis.local.saveToLocalStorage();\r\n\t\t\t\t*/\r\n            }\r\n            else {\r\n                this.pop();\r\n            }\r\n            return;\r\n        }} />);\r\n    }\r\n\r\n    async checkVersion():Promise<string> {\r\n        let {href} = document.location;\r\n        href += (href.indexOf('?')>=0? '&':'?') + '_t_t_=' + new Date().getTime();\r\n        let ret = await fetch(href);\r\n        let r = await ret.text();\r\n        let parser = new DOMParser();\r\n        let htmlDoc = parser.parseFromString(r, 'text/html');\r\n        let elHtml = htmlDoc.getElementsByTagName('html');\r\n        let newVersion = elHtml[0].getAttribute('data-version');\r\n        return newVersion;\r\n    }\r\n}\r\nexport const nav: Nav = new Nav();\r\n\r\nexport class TonvaView extends NavView {\r\n\r\n}\r\n","\r\nimport {setCenterToken} from './uqApi';\r\nimport {WSChannel} from './wsChannel';\r\n\r\nexport const netToken = {\r\n    set(userId:number, token:string) {\r\n        setCenterToken(userId, token);\r\n        WSChannel.setCenterToken(token);\r\n    },\r\n    clear() {\r\n        setCenterToken(0, undefined);\r\n        WSChannel.setCenterToken(undefined);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport {FetchError} from '../net/fetchError';\r\nimport { refetchApi } from '../net';\r\nimport { Page } from './page/page';\r\n\r\nexport interface FetchErrorProps extends FetchError {\r\n    clearError: ()=>void\r\n}\r\n\r\nexport default class FetchErrorView extends React.Component<FetchErrorProps, null> {\r\n    private reApi = async () => {\r\n        this.props.clearError();\r\n        const {channel, url, options, resolve, reject} = this.props;\r\n        await refetchApi(channel, url, options, resolve, reject);\r\n    }\r\n    private close = async () => {\r\n        this.props.clearError();\r\n    }\r\n    render() {\r\n        let {error, url} = this.props;\r\n        let errContent:any;\r\n        if (typeof error === 'object') {\r\n            let err = [];\r\n            for (let i in error) {\r\n                err.push(<li key={i}><label>{i}</label><div style={{wordWrap:\"break-word\"}}>{error[i]}</div></li>);\r\n            }\r\n            errContent = <ul>{err}</ul>;\r\n        }\r\n        else {\r\n            errContent = <div>{error}</div>;\r\n        }\r\n        return <div>\r\n            <article>\r\n\t\t\t\t<main className=\"va-error\">\r\n\t\t\t\t\t<div>网络出现问题</div>\r\n\t\t\t\t\t<div>点击重新访问</div>\r\n\t\t\t\t\t<div style={{wordWrap:\"break-word\"}}>url: {url}</div>\r\n\t\t\t\t\t{errContent}\r\n\t\t\t\t\t<div className=\"p-3\">\r\n\t\t\t\t\t\t<button type='button' onClick={this.reApi}>重新API</button>\r\n\t\t\t\t\t\t<button type='button' onClick={this.close}>关闭</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</main>\r\n            </article>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport const SystemNotifyPage = ({message}:{message:string}):JSX.Element => {\r\n    return <Page header=\"系统提醒\">\r\n        <div className=\"px-3\">{message}</div>\r\n    </Page>;\r\n}","import * as React from 'react';\r\nimport { nav } from './nav';\r\nimport { Page } from './page/page';\r\n\r\ninterface Props {\r\n    message: string,\r\n    seconds: number\r\n}\r\n\r\ninterface State {\r\n    seconds: number\r\n}\r\n\r\nexport class ReloadPage extends React.Component<Props, State> {\r\n    private timerHandler: any;\r\n    constructor(props: Props) {\r\n        super(props);\r\n        let { seconds } = props;\r\n        if (seconds === undefined) return;\r\n        this.state = { seconds };\r\n        if (seconds <= 0) return;\r\n        this.timerHandler = setInterval(() => {\r\n            let { seconds } = this.state;\r\n            seconds--;\r\n            if (seconds <= 0) {\r\n                this.reload();\r\n            }\r\n            else {\r\n                this.setState({ seconds: seconds });\r\n            }\r\n        }, 1000);\r\n    }\r\n    private reload = () => {\r\n        clearInterval(this.timerHandler);\r\n        nav.reload();\r\n    }\r\n    render() {\r\n        let { seconds } = this.state;\r\n        let title: string, msg: string;\r\n        if (seconds > 0) {\r\n            title = '程序升级中...';\r\n            msg = this.state.seconds + '秒钟之后自动重启动';\r\n        }\r\n        else {\r\n            title = '程序需要升级';\r\n            msg = '请点击下面按钮重启';\r\n        }\r\n        return <Page header={false}>\r\n            <div className=\"text-center p-5\">\r\n                <div className=\"text-info py-5\">\r\n                    <span className=\"text-danger\">{title}</span>\r\n                    <br />\r\n                    {msg}\r\n                    <br />\r\n                    <span className=\"small text-muted\">{this.props.message}</span>\r\n                </div>\r\n                <button className=\"btn btn-danger\" onClick={this.reload}>立刻重启</button>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface ConfirmReloadPageProps {\r\n    confirm: (ok: boolean) => Promise<void>;\r\n}\r\nexport const ConfirmReloadPage = (props: ConfirmReloadPageProps): JSX.Element => {\r\n    return <Page header=\"升级软件\" back=\"close\">\r\n        <div className=\"py-5 px-3 my-5 mx-2 border bg-white rounded\">\r\n            <div className=\"text-center text-info\">\r\n                升级将清除所有本机缓冲区内容，并从服务器重新安装程序！\r\n            </div>\r\n            <div className=\"text-center mt-5\">\r\n                <button className=\"btn btn-danger me-3\" onClick={() => props.confirm(true)}>确认升级</button>\r\n            </div>\r\n        </div>\r\n    </Page>;\r\n    // <button className=\"btn btn-outline-danger\" onClick={()=>props.confirm(false)}>暂不</button>\r\n}\r\n","import {observable} from 'mobx';\r\n\r\nexport interface Id {\r\n    id: number;\r\n}\r\n\r\nexport abstract class CacheIds<T extends Id> {\r\n    constructor(maxCount:number = 100) {\r\n        this.maxCount = maxCount;\r\n    }\r\n    private maxCount:number;\r\n    private arr:T[] = [];\r\n    @observable dict = new Map<number, T>();\r\n\r\n    loadIds(ids:number[]) {\r\n        let arr:number[] = [];\r\n        for (let id of ids) {\r\n            if (id === null) continue;\r\n            let item = this.dict.get(id);\r\n            if (item === undefined) {\r\n                arr.push(id);\r\n                item = {id:id} as T;\r\n                this.dict.set(id, item);\r\n            }\r\n        }                \r\n        this.loadId(arr);\r\n    }\r\n\r\n    get(id:number):T {\r\n        if (id === undefined || id === null) return null;\r\n        let item = this.dict.get(id);\r\n        if (item === undefined) {\r\n            this.dict.set(id, {id:id} as T);\r\n            this.loadId([id]);\r\n            item = this.dict.get(id);\r\n        }\r\n        return item;\r\n    }\r\n    private setItem(id:number, item:T) {\r\n        if (item === undefined) {\r\n            this.dict.set(id, null);\r\n            this.arr.push({id: id} as T);\r\n        }\r\n        else {\r\n            this.dict.set(id, item);\r\n            this.arr.push(item);\r\n        }\r\n        if (this.arr.length > this.maxCount) {\r\n            item = this.arr.shift();\r\n            this.dict.delete(item.id);\r\n        }\r\n    }\r\n    private async loadId(ids:number[]) {\r\n        let items = await this._loadIds(ids);\r\n        if (items === undefined) {\r\n            for (let id of ids) {\r\n                if (id === null) continue;\r\n                let item = await this._loadId(id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n        else {\r\n            for (let id of ids) {\r\n                let item = items.find(v => v.id === id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected abstract _loadIds(ids:number[]):Promise<T[]>;\r\n    protected abstract _loadId(id:number):Promise<T>;\r\n}\r\n","import { env } from './env';\r\n\r\nexport class LocalData {\r\n    user = env.localDb.child('user');\r\n    guest = env.localDb.child('guest');\r\n    unit = env.localDb.child('unit');\r\n\r\n    private _user:string;\r\n    private _guest:string;\r\n    private _unit:string;\r\n    readToMemory() {\r\n        this._user = this.user.get();\r\n        this._guest = this.guest.get();\r\n        this._unit = this.unit.get();\r\n    }\r\n    saveToLocalStorage() {\r\n        this.user.set(this._user);\r\n        this.guest.set(this._guest);\r\n        this.unit.set(this._unit);\r\n    }\r\n\r\n    logoutClear() {\r\n        [\r\n            this.user,\r\n            this.unit,\r\n        ].forEach(d => d.remove());\r\n    }\r\n}\r\n","export function getObjPropIgnoreCase(obj:any, prop:string):any {\r\n\tif (!obj) return;\r\n\tif (!prop) return;\r\n\tlet keys = Object.keys(obj);\r\n\tprop = prop.toLowerCase();\r\n\tfor (let key of keys) {\r\n\t\tif (key.toLowerCase() === prop) return obj[key];\r\n\t}\r\n\treturn;\r\n}\r\n","\r\nexport const mobileRegex = /^[0-9]*$/;\r\nexport const emailRegex = /\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*/;\r\n// /^([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+\\.[a-zA-Z]{2,3}$/\r\n\r\nexport const EmailFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '电子邮件格式错误';\r\n}\r\n\r\nexport const MobileFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '手机格式错误';\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport { nav, Page, resOptions, PageHeaderProps, PageWebNav } from '../components';\r\nimport { User, env } from '../tool';\r\nimport { VPage } from './vpage';\r\nimport { View } from './view';\r\nimport { messageHub } from '../net';\r\n\r\nexport interface ConfirmOptions {\r\n    caption?: string;\r\n    message: string | JSX.Element;\r\n    classNames?: string;\r\n    ok?: string;\r\n    yes?: string;\r\n    no?: string;\r\n}\r\n\r\nexport interface WebNav<C extends Controller> {\r\n    VNavHeader?: new (controller: C) => View<C>;\r\n    VNavRawHeader?: new (controller: C) => View<C>;\r\n    VNavFooter?: new (controller: C) => View<C>;\r\n    VNavRawFooter?: new (controller: C) => View<C>;\r\n    renderPageHeader?: (props: PageHeaderProps) => JSX.Element;\r\n}\r\n\r\nexport abstract class Controller {\r\n    readonly res: any;\r\n    readonly x: any;\r\n    private _t: any = {};\r\n    readonly t: (str: string) => any;\r\n    icon: string | JSX.Element;\r\n    label: string;\r\n    readonly isDev: boolean = env.isDevelopment;\r\n    pageWebNav: PageWebNav;\r\n    get user(): User { return nav.user }\r\n    get isLogined(): boolean {\r\n        let { user } = nav;\r\n        if (user === undefined) return false;\r\n        return user.id > 0;\r\n    }\r\n    constructor(res: any) {\r\n        this.res = res || {};\r\n        this.x = this.res.x || {};\r\n        this.t = (str: string): any => this.internalT(str) || str;\r\n    }\r\n\r\n    protected beforeInit() { }\r\n    protected afterInit() { }\r\n\r\n    init(...param: any[]) {\r\n        this.beforeInit();\r\n        this.pageWebNav = this.getPageWebNav();\r\n        this.afterInit();\r\n    }\r\n\r\n    internalT(str: string): any {\r\n        return this._t[str];\r\n    }\r\n\r\n    get webNav(): WebNav<any> { return undefined; }\r\n\r\n    getWebNav(): WebNav<any> { return this.webNav; }\r\n\r\n    getPageWebNav(): PageWebNav { return undefined; }\r\n\r\n    get isWebNav(): boolean { return nav.isWebNav }\r\n    navigate(url: string) {\r\n        nav.navigate(url);\r\n    }\r\n\r\n    protected setRes(res: any) {\r\n        if (res === undefined) return;\r\n        let { $lang, $district } = resOptions;\r\n        _.merge(this._t, res);\r\n        if ($lang !== undefined) {\r\n            let l = res[$lang];\r\n            if (l !== undefined) {\r\n                _.merge(this._t, l);\r\n                let d = l[$district];\r\n                if (d !== undefined) {\r\n                    _.merge(this._t, d);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private receiveHandlerId: number;\r\n    //private disposer:()=>void;\r\n\r\n    protected dispose = () => {\r\n        // message listener的清理\r\n        //nav.unregisterReceiveHandler(this.receiveHandlerId);\r\n        messageHub.unregisterReceiveHandler(this.receiveHandlerId);\r\n        this.onDispose();\r\n    }\r\n\r\n    protected onDispose() {\r\n    }\r\n\r\n    //get isRouting() {return nav.isRouting;}\r\n\r\n    isMe(id: any): boolean {\r\n        if (id === null) return false;\r\n        let { user } = this;\r\n        let userId = user.id;\r\n        switch (typeof id) {\r\n            default: return false;\r\n            case 'string': return Number(id) === userId;\r\n            case 'number': return id === userId;\r\n            case 'object': return id.id === userId;\r\n        }\r\n    }\r\n\r\n    protected async openVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C) => P, param?: any, afterBack?: (ret: any) => void): Promise<P> {\r\n        let ret = new vp((this as any) as C);\r\n        await ret.open(param, afterBack);\r\n        return ret;\r\n    }\r\n\r\n    protected async replaceVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C) => P, param?: any, afterBack?: (ret: any) => void): Promise<P> {\r\n        let ret = new vp((this as any) as C);\r\n        await ret.replaceOpen(param, afterBack);\r\n        return ret;\r\n    }\r\n\r\n    protected renderView<C extends Controller, V extends View<C>>(view: new (controller: C) => V, param?: any): JSX.Element {\r\n        let v = new view((this as any) as C);\r\n        return v.render(param);\r\n    }\r\n\r\n    async event(type: string, value: any) {\r\n        await this.onEvent(type, value);\r\n    }\r\n\r\n    protected async onEvent(type: string, value: any) {\r\n    }\r\n\r\n    protected msg(text: string) {\r\n        alert(text);\r\n    }\r\n    protected errorPage(header: string, err: any) {\r\n        this.openPage(<Page header=\"App error!\">\r\n            <pre>\r\n                {typeof err === 'string' ? err : err.message}\r\n            </pre>\r\n        </Page>);\r\n    }\r\n\r\n    protected onMessage(message: any): Promise<void> {\r\n        return;\r\n    }\r\n\r\n    private onMessageReceive = async (message: any): Promise<void> => {\r\n        await this.onMessage(message);\r\n    }\r\n\r\n    protected async beforeStart(): Promise<boolean> {\r\n        /*\r\n        console.log('this.receiveHandlerId = nav.registerReceiveHandler(this.onMessageReceive);');\r\n        this.receiveHandlerId = nav.registerReceiveHandler(this.onMessageReceive);\r\n        console.log('return true');\r\n        */\r\n        return true;\r\n    }\r\n    protected async afterStart(): Promise<void> {\r\n    }\r\n    protected registerReceiveHandler() {\r\n        this.receiveHandlerId = messageHub.registerReceiveHandler(this.onMessageReceive);\r\n    }\r\n\r\n    protected abstract internalStart(param?: any, ...params: any[]): Promise<void>;\r\n    async start(param?: any, ...params: any[]): Promise<void> {\r\n        //this.disposer = this.dispose;\r\n        this.registerReceiveHandler();\r\n        let ret = await this.beforeStart();\r\n        if (ret === false) return;\r\n        await this.internalStart(param, ...params);\r\n        await this.afterStart();\r\n    }\r\n\r\n    get isCalling(): boolean { return this._resolve_$ !== undefined }\r\n\r\n    private _resolve_$: ((value: any) => void)[];\r\n    async call<T>(param?: any, ...params: any[]): Promise<T> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<T>(async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await this.start(param, ...params);\r\n        });\r\n    }\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C) => VPage<C>, param?: any): Promise<any> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await (new vp(this as any)).open(param);\r\n        });\r\n    }\r\n\r\n    returnCall(value: any) {\r\n        if (this._resolve_$ === undefined) return;\r\n        let resolve = this._resolve_$.pop();\r\n        if (resolve === undefined) {\r\n            alert('the Controller call already returned, or not called');\r\n            return;\r\n        }\r\n        resolve(value);\r\n    }\r\n\r\n    openPage(page: JSX.Element, onClosePage?: (ret: any) => void) {\r\n        let disposer: () => void;\r\n        if (onClosePage !== undefined) {\r\n            disposer = () => {\r\n                //if (this.disposer) this.disposer();\r\n                onClosePage(undefined);\r\n            }\r\n        }\r\n\r\n        nav.push(page, disposer);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    replacePage(page: JSX.Element, onClosePage?: () => void) {\r\n        nav.replace(page, onClosePage);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    backPage() {\r\n        nav.back();\r\n    }\r\n\r\n    closePage(level?: number) {\r\n        nav.pop(level);\r\n    }\r\n\r\n    ceasePage(level?: number) {\r\n        nav.ceaseTop(level);\r\n    }\r\n\r\n    go(showPage: () => void, url: string, absolute?: boolean) {\r\n        nav.go(showPage, url, absolute);\r\n    }\r\n\r\n    removeCeased() {\r\n        nav.removeCeased();\r\n    }\r\n\r\n    regConfirmClose(confirmClose: () => Promise<boolean>) {\r\n        nav.regConfirmClose(confirmClose);\r\n    }\r\n\r\n    private topPageKey: any;\r\n    protected startAction() {\r\n        this.topPageKey = nav.topKey();\r\n    }\r\n    get TopKey() {\r\n        return this.topPageKey;\r\n    }\r\n    SetTopKey(key: any) {\r\n        this.topPageKey = key;\r\n    }\r\n    public popToTopPage() {\r\n        nav.popTo(this.topPageKey);\r\n    }\r\n\r\n    async confirm(options: ConfirmOptions): Promise<'ok' | 'yes' | 'no' | undefined> {\r\n        return new Promise<'ok' | 'yes' | 'no' | undefined>(async (resolve, reject) => {\r\n            let { caption, message, ok, yes, no, classNames } = options;\r\n            let close = (res: 'ok' | 'yes' | 'no' | undefined) => {\r\n                this.closePage();\r\n                resolve(res);\r\n            }\r\n            let buttons: any[] = [];\r\n            if (ok !== undefined) {\r\n                buttons.push(<button key=\"ok\" className=\"btn btn-primary me-3\" onClick={() => close('ok')}>{ok}</button>);\r\n            }\r\n            if (yes !== undefined) {\r\n                buttons.push(<button key=\"yes\" className=\"btn btn-success me-3\" onClick={() => close('yes')}>{yes}</button>);\r\n            }\r\n            if (no !== undefined) {\r\n                buttons.push(<button key=\"no\" className=\"btn btn-outline-danger me-3\" onClick={() => close('no')}>{no}</button>);\r\n            }\r\n            this.openPage(<Page header={caption || '请确认'} back=\"close\">\r\n                <div className={classNames || \"rounded bg-white m-5 p-3 border\"}>\r\n                    <div className=\"d-flex align-items-center justify-content-center\">\r\n                        {message}\r\n                    </div>\r\n                    <div className=\"mt-3 d-flex align-items-center justify-content-center\">\r\n                        {buttons}\r\n                    </div>\r\n                </div>\r\n            </Page>);\r\n            nav.regConfirmClose(async (): Promise<boolean> => {\r\n                resolve(undefined);\r\n                return true;\r\n            });\r\n        });\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Page, Image, UserView } from '../components';\r\nimport { env, User } from '../tool';\r\nimport { Controller } from './controller';\r\nimport { VPage } from './vpage';\r\n\r\nexport abstract class View<C extends Controller> {\r\n    protected controller: C;\r\n    protected readonly res: any;\r\n    protected readonly x: any;\r\n    protected readonly t: (str: string) => any;\r\n\r\n    constructor(controller: C) {\r\n        this.controller = controller;\r\n        this.res = controller.res;\r\n        this.x = controller.x;\r\n        this.t = controller.t;\r\n    }\r\n\r\n    protected get isDev() { return env.isDevelopment }\r\n    get isWebNav(): boolean { return this.controller.isWebNav }\r\n    navigate(url: string) { this.controller.navigate(url) }\r\n    protected isMe(id: any) { return this.controller.isMe(id) }\r\n    abstract render(param?: any): JSX.Element;\r\n\r\n    protected renderVm(vm: new (controller: C) => View<C>, param?: any) {\r\n        return (new vm(this.controller)).render(param);\r\n    }\r\n\r\n    protected async openVPage(vp: new (controller: C) => VPage<C>, param?: any, afterBack?: () => Promise<void>): Promise<void> {\r\n        await (new vp(this.controller)).open(param, afterBack);\r\n    }\r\n\r\n    protected async event(type: string, value?: any) {\r\n        await this.controller.event(type, value);\r\n    }\r\n\r\n    protected go(showPage: () => void, url: string, absolute?: boolean) {\r\n        this.controller.go(showPage, url, absolute);\r\n    }\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C) => VPage<C>, param?: any): Promise<any> {\r\n        return await this.controller.vCall(vp, param);\r\n    }\r\n\r\n    protected returnCall(value: any) {\r\n        this.controller.returnCall(value);\r\n    }\r\n\r\n    protected renderUser(user: any, imageClassName?: string, textClassName?: string) {\r\n        let renderUser = (user: User) => {\r\n            let { name, nick, icon } = user;\r\n            return <>\r\n                <Image src={icon} className={imageClassName || 'w-1c h-1c me-2'} />\r\n                <span className={textClassName}>{nick || name}</span>\r\n            </>;\r\n        }\r\n        return <UserView user={user} render={renderUser} />\r\n    }\r\n\r\n    protected renderUserText(user: any) {\r\n        let renderUser = (user: User) => {\r\n            let { name, nick } = user;\r\n            return <>{nick || name}</>;\r\n        }\r\n        return <UserView user={user} render={renderUser} />\r\n    }\r\n\r\n    protected renderMe(imageClassName?: string, textClassName?: string) {\r\n        let { user } = this.controller;\r\n        if (!user) return;\r\n        return this.renderUser(user.id, imageClassName, textClassName);\r\n    }\r\n\r\n    protected openPage(view: React.StatelessComponent<any>, param?: any, onClosePage?: (ret: any) => void) {\r\n        let type = typeof param;\r\n        if (type === 'object' || type === 'undefined') {\r\n            this.controller.openPage(React.createElement(view, param), onClosePage);\r\n        }\r\n        else {\r\n            this.controller.openPage(<Page header=\"param type error\">\r\n                View.openPage param must be object, but here is {type}\r\n            </Page>, onClosePage);\r\n        }\r\n    }\r\n\r\n    protected replacePage(view: React.StatelessComponent<any>, param?: any) {\r\n        this.controller.replacePage(React.createElement(view, param));\r\n    }\r\n\r\n    protected openPageElement(page: JSX.Element, onClosePage?: () => void) {\r\n        this.controller.openPage(page, onClosePage);\r\n    }\r\n\r\n    protected replacePageElement(page: JSX.Element, onClosePage?: () => void) {\r\n        this.controller.replacePage(page, onClosePage);\r\n    }\r\n\r\n    protected backPage() {\r\n        this.controller.backPage();\r\n    }\r\n\r\n    protected closePage(level?: number) {\r\n        this.controller.closePage(level);\r\n    }\r\n\r\n    protected ceasePage(level?: number) {\r\n        this.controller.ceasePage(level);\r\n    }\r\n\r\n    protected removeCeased() {\r\n        this.controller.removeCeased();\r\n    }\r\n\r\n    protected regConfirmClose(confirmClose: () => Promise<boolean>) {\r\n        this.controller.regConfirmClose(confirmClose);\r\n    }\r\n\r\n    protected popToTopPage() {\r\n        this.controller.popToTopPage();\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Page, Scroller, TabsProps } from \"../components\";\r\nimport { View } from \"./view\";\r\nimport { Controller } from \"./controller\";\r\n\r\nexport abstract class VPage<C extends Controller> extends View<C> {\r\n\tprotected retOnClosePage: any;\r\n\r\n    open(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.openPageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n    replaceOpen(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.replacePageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n\trender(param?:any):JSX.Element {\r\n\t\tthis.init(param);\r\n\t\treturn this.renderPage();\r\n\t}\r\n\r\n\tinit(param?:any):void {return;}\r\n\r\n\theader():string|boolean|JSX.Element {return null;}\r\n\tright():JSX.Element {return null;}\r\n\tcontent():JSX.Element {return null;}\r\n\tfooter():JSX.Element {return null;}\r\n\tlogout(): boolean | (()=>Promise<void>) {return false;}\r\n\tprotected renderPage():JSX.Element {\r\n\t\tlet header = this.header();\r\n\t\tif (!header) header = false;\r\n\t\tlet logout = this.logout();\r\n\t\treturn <Page\r\n\t\t\theader={header} right={this.right()} footer={this.footer()}\r\n\t\t\tonScroll={(e:any)=>this.onPageScroll(e)}\r\n\t\t\tonScrollTop={(scroller: Scroller) => this.onPageScrollTop(scroller)}\r\n\t\t\tonScrollBottom={(scroller: Scroller) => this.onPageScrollBottom(scroller)}\r\n\t\t\tback={this.back}\r\n\t\t\theaderClassName={this.headerClassName}\r\n\t\t\tclassName={this.className}\r\n\t\t\tafterBack={()=>this.afterBack()}\r\n\t\t\ttabsProps={this.tabsProps}\r\n\t\t\tlogout={logout}\r\n\t\t\twebNav={this.controller.pageWebNav}\r\n\t\t>\r\n\t\t\t{this.content()}\r\n\t\t</Page>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {return;}\r\n\tprotected afterBack():void {}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'back'}\r\n\tprotected get headerClassName(): string {return null;}\r\n\tprotected get className(): string {return null;}\r\n\tprotected get tabsProps(): TabsProps {return null;}\r\n}\r\n","import React from 'react';\r\nimport _ from 'lodash';\r\nimport { FA, Page } from '../../components';\r\nimport { Controller } from \"../controller\";\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport interface CStringEditProps {\r\n\tlabel?: string;\r\n\tplaceholder?: string;\r\n\tmaxLength?: number;\r\n\tonValueChange?: (value: string) => Promise<void>;\r\n}\r\n\r\nexport class CStringEdit extends Controller {\r\n\tprivate props: CStringEditProps = {\r\n\t\tlabel: '编辑'\r\n\t}\r\n\t@observable value: string;\r\n\t@observable private newValue: string;\r\n\t@observable private isChanged: boolean;\r\n\t@observable private error: string;\r\n\r\n\tprotected async internalStart() { }\r\n\trender(value: string, props?: CStringEditProps) {\r\n\t\tthis.value = value;\r\n\t\tif (props) _.merge(this.props, props);\r\n\t\treturn React.createElement(observer(() => <>{this.renderValue()}{this.renderPencil()}</>))\r\n\t}\r\n\r\n\tprotected renderValue() { return <>{this.value}</> }\r\n\tprotected renderPencil() {\r\n\t\treturn <span onClick={this.onEdit} className=\"cursor-pointer\">\r\n\t\t\t&nbsp; <FA className=\"text-info\" name=\"pencil-square-o\" /> &nbsp;\r\n\t\t</span>;\r\n\t}\r\n\r\n\tprivate onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.newValue = evt.target.value;\r\n\t\tlet preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\r\n\tprivate onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.verifyValue();\r\n\t}\r\n\r\n\tprotected verifyValue() { }\r\n\r\n\tprivate onFocus = () => {\r\n\t\tthis.error = undefined;\r\n\t}\r\n\r\n\tprivate onEdit = () => {\r\n\t\tlet { label, maxLength, placeholder, onValueChange } = this.props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tthis.value = this.newValue;\r\n\t\t\t\tthis.closePage();\r\n\t\t\t\tif (onValueChange) onValueChange(this.value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet right = React.createElement(observer(() => <button\r\n\t\t\tclassName=\"btn btn-sm btn-success align-self-center me-2\"\r\n\t\t\tdisabled={!this.isChanged}\r\n\t\t\tonClick={onSave}>保存</button>));\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\t\tif (evt.keyCode === 13) onSave();\r\n\t\t}\r\n\t\tthis.openPage(<Page header={label} right={right}>\r\n\t\t\t<div className=\"m-3\">\r\n\t\t\t\t<input type=\"text\"\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n\t\t\t\t\tonBlur={this.onBlur}\r\n\t\t\t\t\tonFocus={this.onFocus}\r\n\t\t\t\t\tclassName=\"form-control\"\r\n\t\t\t\t\tdefaultValue={this.value}\r\n\t\t\t\t\tmaxLength={maxLength} />\r\n\t\t\t\t{\r\n\t\t\t\t\tReact.createElement(observer(() => placeholder && <div className=\"small muted m-2\">{placeholder}</div>))\r\n\t\t\t\t}\r\n\t\t\t\t{this.error && <div className=\"text-danger\">{this.error}</div>}\r\n\t\t\t</div>\r\n\t\t</Page>);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {PageHeaderProps, renderPageHeader} from './pageHeader';\r\nimport { TabsProps, TabsView } from './tabs';\r\nimport { ScrollProps, ScrollView, PageWebNav, WebNavScrollView } from './scrollView';\r\nimport { nav } from '../nav';\r\n\r\nexport interface IVPage {\r\n\tcontent():JSX.Element;\r\n\theader():JSX.Element|string;\r\n\tfooter():JSX.Element;\r\n}\r\n\r\nexport interface PageProps extends ScrollProps {\r\n    back?: 'close' | 'back' | 'none';\r\n    header?: boolean | string | JSX.Element;\r\n    right?: JSX.Element;\r\n    footer?: JSX.Element;\r\n    logout?: boolean | (()=>Promise<void>);\r\n\theaderClassName?: string;\r\n\tclassName?: string;\r\n\tafterBack?: () => void;\r\n\ttabsProps?: TabsProps;\r\n\twebNav?: PageWebNav;\r\n}\r\n\r\n@observer\r\nexport class Page extends React.Component<PageProps> {\r\n\tprivate tabsView: TabsView;\r\n    constructor(props: PageProps) {\r\n\t\tsuper(props);\r\n\t\tlet {tabsProps} = props;\r\n\t\tif (tabsProps) {\r\n\t\t\tthis.tabsView = new TabsView(tabsProps);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderHeader(webNav?: PageWebNav) {\r\n\t\tconst {back, header, right, headerClassName, afterBack, logout} = this.props;\r\n\t\tif (header === false) return;\r\n\t\t//const {webNav} = this.props;\r\n\t\tlet inWebNav = false;\r\n\t\tlet pageHeaderProps:PageHeaderProps = {\r\n\t\t\tback,\r\n\t\t\tcenter: header as any,\r\n\t\t\tright,\r\n\t\t\tlogout,\r\n\t\t\tclassName: headerClassName,\r\n\t\t\tafterBack,\r\n\t\t};\r\n\t\tif (webNav !== undefined) {\r\n\t\t\tinWebNav = true;\r\n\t\t\tlet {renderPageHeader: rph} = webNav;\r\n\t\t\tif (rph) return rph(pageHeaderProps);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinWebNav = false;\r\n\t\t}\r\n\t\treturn renderPageHeader(pageHeaderProps, inWebNav);\r\n\t\t/*\r\n\t\tlet pageHeader = header !== false && <PageHeader \r\n\t\t\tback={back} \r\n\t\t\tcenter={header as any}\r\n\t\t\tright={right}\r\n\t\t\tlogout={this.props.logout}\r\n\t\t\tclassName={headerClassName}\r\n\t\t\tafterBack={afterBack}\r\n\t\t\t/>;\r\n\t\treturn pageHeader;\r\n\t\t*/\r\n\t}\r\n\r\n\tprivate renderFooter(webNav?: PageWebNav) {\r\n\t\tconst {footer} = this.props;\r\n\t\tif (!footer) return;\r\n\t\tlet elFooter = <footer>{footer}</footer>;\r\n\t\tif (webNav) return elFooter;\r\n\t\treturn <>\r\n\t\t\t<section className=\"tv-page-footer\">{elFooter}</section>\r\n\t\t\t{elFooter}\r\n\t\t</>;\r\n\t}\r\n\r\n\tcomponentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n\t\t// You can also log the error to an error reporting service\r\n\t\t//logErrorToMyService(error, errorInfo);\r\n\t\tdebugger;\r\n\t}\r\n\t\r\n    render() {\r\n\t\tif (this.tabsView) {\r\n\t\t\treturn React.createElement(this.tabsView.content);\r\n\t\t}\r\n\t\tconst {onScroll, onScrollTop, onScrollBottom, children, className, webNav} = this.props;\r\n\t\tlet pageWebNav:PageWebNav;\r\n\t\tif (!webNav) {\r\n\t\t\tpageWebNav = nav.pageWebNav;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tpageWebNav = webNav;\r\n\t\t}\r\n\t\tlet content = <>\r\n\t\t\t{this.renderHeader(pageWebNav)}\r\n\t\t\t<main>{children}</main>\r\n\t\t\t{this.renderFooter(pageWebNav)}\r\n\t\t</>;\r\n\t\tif (pageWebNav) {\r\n\t\t\treturn <WebNavScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t\twebNav={pageWebNav}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</WebNavScrollView>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn <ScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</ScrollView>;\r\n\t\t}\r\n\t}\r\n}\r\n","import _ from 'lodash';\r\nimport {nav} from '../components';\r\nimport {uid} from '../tool/uid';\r\nimport {uqTokenApi, callCenterapi, centerToken, setCenterToken} from './uqApi';\r\nimport {setSubAppWindow} from './wsChannel';\r\nimport { host } from './host';\r\n\r\nexport interface UqToken {\r\n    name: string;\r\n    db: string;\r\n    url: string;\r\n    token: string;\r\n}\r\nconst uqTokens:{[uqName:string]: UqToken}  = {};\r\nexport function logoutUqTokens() {\r\n    for (let i in uqTokens) {\r\n        uqTokens[i] = undefined;\r\n    }\r\n}\r\n\r\nexport interface AppInFrame {\r\n    hash: string;\r\n    unit: number;       // unit id\r\n    page?: string;\r\n    param?: string[];\r\n    predefinedUnit?: number;  // 比如像Cart这样的应用，直接让用户访问的，就需要在unit.json里面定义unitName\r\n}\r\nconst appsInFrame:{[key:string]:AppInFrame} = {};\r\n\r\nclass AppInFrameClass implements AppInFrame {\r\n    hash: string;\r\n    private _unit: number;\r\n    get unit(): number {return this._unit;}       // unit id\r\n    set unit(val:number) { this._unit=val;}\r\n    page?: string;\r\n    param?: string[];\r\n}\r\n\r\nexport let appInFrame:AppInFrame = new AppInFrameClass();\r\n/* {\r\n    hash: undefined,\r\n    get unit():number {return } undefined, //debugUnitId,\r\n    page: undefined;\r\n    param: undefined,\r\n}*/\r\n\r\nexport function isBridged():boolean {\r\n    return window.self !== window.parent;\r\n}\r\n\r\nwindow.addEventListener('message', async function(evt) {\r\n    var message = evt.data;\r\n    switch (message.type) {\r\n        case 'sub-frame-started':\r\n            subFrameStarted(evt);\r\n            break;\r\n        case 'ws':\r\n            //wsBridge.receive(message.msg);\r\n            await nav.onReceive(message.msg);\r\n            break;\r\n        case 'init-sub-win':\r\n            await initSubWin(message);\r\n            break;\r\n        case 'pop-app':\r\n            window.console.log('///\\\\\\\\\\\\ pop-app');\r\n            nav.navBack();\r\n            break;\r\n        case 'center-api':\r\n            await callCenterApiFromMessage(evt.source as Window, message);\r\n            break;\r\n        case 'center-api-return':\r\n            bridgeCenterApiReturn(message);\r\n            break;\r\n        case 'app-api':\r\n            let ret = await onReceiveAppApiMessage(message.hash, message.apiName);\r\n            (evt.source as Window).postMessage({\r\n                type: 'app-api-return', \r\n                apiName: message.apiName,\r\n                db: ret.db,\r\n                url: ret.url,\r\n                token: ret.token} as any, \"*\");\r\n            break;\r\n        case 'app-api-return':\r\n            console.log(\"app-api-return: %s\", JSON.stringify(message));\r\n            console.log('await onAppApiReturn(message);');\r\n            await onAppApiReturn(message);\r\n            break;\r\n        default:\r\n\t\t\tif ((message.source as string)?.startsWith('react-devtools') === true) break;\r\n            window.console.log('message: %s', JSON.stringify(message));\r\n            break;\r\n    }\r\n});\r\n\r\nfunction subFrameStarted(evt:any) {\r\n    var message = evt.data;\r\n    let subWin = evt.source as Window;\r\n    setSubAppWindow(subWin);\r\n    hideFrameBack(message.hash);\r\n    let msg:any = _.clone(nav.user);\r\n    msg.type = 'init-sub-win';\r\n    subWin.postMessage(msg, '*');\r\n}\r\nfunction hideFrameBack(hash:string) {\r\n    let el = document.getElementById(hash);\r\n    if (el !== undefined) el.hidden = true;\r\n}\r\nasync function initSubWin(message:any) {\r\n    console.log('initSubWin: set nav.user', message);\r\n    let user = nav.user = message; // message.user;\r\n    setCenterToken(user.id, user.token);\r\n    await nav.showAppView();\r\n}\r\nasync function onReceiveAppApiMessage(hash: string, apiName: string): Promise<UqToken> {\r\n    let appInFrame = appsInFrame[hash];\r\n    if (appInFrame === undefined) return {name:apiName, db:undefined, url:undefined, token:undefined};\r\n    //let unit = getUnit();\r\n    let {unit, predefinedUnit} = appInFrame;\r\n    unit = unit || predefinedUnit;\r\n    if (!unit) {\r\n        console.error('no unit defined in unit.json or in index.html, or not logined in', unit);\r\n    }\r\n    let parts = apiName.split('/');\r\n    let param = {unit: unit, uqOwner: parts[0], uqName: parts[1], appOwner: parts[2], appName:parts[3]};\r\n    console.log('uqTokenApi.uq onReceiveAppApiMessage', param);\r\n    let ret = await uqTokenApi.uq(param);\r\n    let {db, url, token} = ret;\r\n    return {name: apiName, db:db, url: url, token: token};\r\n}\r\n\r\nasync function onAppApiReturn(message:any) {\r\n    let {apiName, db, url, urlTest, token} = message;\r\n    let action = uqTokenActions[apiName];\r\n    if (action === undefined) {\r\n        throw new Error('error app api return');\r\n        //return;\r\n    }\r\n    let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n    console.log('onAppApiReturn(message:any): url=' + url + ', real=' + realUrl);\r\n    //action.url = realUrl;\r\n    //action.token = token;\r\n    action.resolve({\r\n        name: apiName,\r\n        db: db,\r\n        url: realUrl,\r\n        token: token,\r\n    } as UqToken);\r\n}\r\n\r\nexport function setAppInFrame(appHash: string):AppInFrame {\r\n    if (appHash) {\r\n        let parts = appHash.split('-');\r\n        let len = parts.length;\r\n        if (len > 0) {\r\n            let p = 1;\r\n            appInFrame.hash = parts[p++];\r\n            if (len>0) appInFrame.unit = Number(parts[p++]);\r\n            if (len>1) appInFrame.page = parts[p++];\r\n            if (len>2) appInFrame.param = parts.slice(p++);\r\n        }\r\n    }\r\n    return appInFrame;\r\n}\r\n\r\nexport function getExHashPos():number {\r\n    let hash = document.location.hash;\r\n    if (hash !== undefined && hash.length > 0) {\r\n        let pos = hash.lastIndexOf('#tv-');\r\n        if (pos < 0) pos = hash.lastIndexOf('#tvdebug-');\r\n        return pos;\r\n    }\r\n    return -1;\r\n}\r\n\r\nexport function getExHash():string {\r\n    let pos = getExHashPos();\r\n    if (pos < 0) return undefined;\r\n    return document.location.hash.substring(pos);\r\n}\r\n\r\nexport function appUrl(url: string, unitId: number, page?:string, param?:any[]):{url:string; hash:string} {\r\n    let u:string;\r\n    for (;;) {\r\n        u = uid();\r\n        let a = appsInFrame[u];\r\n        if (a === undefined) {\r\n            appsInFrame[u] = {hash:u, unit:unitId};\r\n            break;\r\n        }\r\n    }\r\n    url += '#tv-' + u + '-' + unitId;\r\n    if (page !== undefined) {\r\n        url += '-' + page;\r\n        if (param !== undefined) {\r\n            for (let i=0; i<param.length; i++) {\r\n                url += '-' + param[i];\r\n            }\r\n        }\r\n    }\r\n    return {url: url, hash: u};\r\n}\r\n\r\nfunction getUnit():number {\r\n\tlet {unit, predefinedUnit} = appInFrame;\r\n    let realUnit = unit || predefinedUnit;\r\n    if (realUnit === undefined) {\r\n        throw new Error('no unit defined in unit.json or not logined in');\r\n\t}\r\n    return realUnit;\r\n}\r\n\r\ninterface UqTokenAction {\r\n    resolve: (value?: UqToken | PromiseLike<UqToken>) => void;\r\n    reject: (reason?: any) => void;\r\n}\r\nconst uqTokenActions:{[uq:string]: UqTokenAction} = {};\r\nexport async function buildAppUq(uq:string, uqOwner:string, uqName:string, appOwner:string, appName:string):Promise<void> {\r\n    if (!isBridged()) {\r\n        let unit = getUnit();\r\n        let uqToken = await uqTokenApi.uq({unit,  uqOwner, uqName, appOwner, appName});\r\n        if (uqToken.token === undefined) uqToken.token = centerToken;\r\n        let {db, url, urlTest} = uqToken;\r\n        let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n        console.log('realUrl: %s', realUrl);\r\n        uqToken.url = realUrl;\r\n        uqTokens[uq] = uqToken;\r\n        return uqToken;\r\n    }\r\n    console.log(\"**** before buildAppUq ****\", appInFrame);\r\n    let bp = uqTokenActions[uq];\r\n    if (bp !== undefined) return;\r\n    return new Promise<void>((resolve, reject) => {\r\n        uqTokenActions[uq] = {\r\n            resolve: async (at:any) => {\r\n                let {db, url, token} = await at;\r\n                uqTokens[uq] = {\r\n                    name: uq,\r\n                    db: db,\r\n                    url: url,\r\n                    token: token,\r\n                };\r\n                uqTokenActions[uq] = undefined;\r\n                console.log(\"**** after buildAppUq ****\", appInFrame);\r\n                resolve();\r\n            },\r\n            reject: reject,\r\n        };\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'app-api',\r\n            apiName: uq,\r\n            hash: appInFrame.hash,\r\n        }, \"*\");\r\n    });\r\n}\r\n\r\nexport function appUq(uq:string):UqToken {\r\n    let uts = uqTokens;\r\n    return uts[uq];\r\n}\r\n\r\ninterface BridgeCenterApi {\r\n    id: string;\r\n    resolve: (value?:any)=>any;\r\n    reject: (reason?:any)=>void;\r\n}\r\nconst brideCenterApis:{[id:string]: BridgeCenterApi} = {};\r\nexport async function bridgeCenterApi(url:string, method:string, body:any):Promise<any> {\r\n    console.log('bridgeCenterApi: url=%s, method=%s', url, method);\r\n    return await new Promise<any>(async (resolve, reject) => {\r\n        let callId:string;\r\n        for (;;) {\r\n            callId = uid();\r\n            let bca = brideCenterApis[callId];\r\n            if (bca === undefined) {\r\n                brideCenterApis[callId] = {\r\n                    id: callId,\r\n                    resolve: resolve,\r\n                    reject: reject,\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'center-api',\r\n            callId: callId,\r\n            url: url,\r\n            method: method,\r\n            body: body\r\n        }, '*');\r\n    });\r\n}\r\n\r\nasync function callCenterApiFromMessage(from:Window, message:any):Promise<void> {\r\n    let {callId, url, method, body} = message;\r\n    let result = await callCenterapi.directCall(url, method, body);\r\n    from.postMessage({\r\n        type: 'center-api-return',\r\n        callId: callId,\r\n        result: result,\r\n    }, '*');\r\n}\r\n\r\nfunction bridgeCenterApiReturn(message:any) {\r\n    let {callId, result} = message;\r\n    let bca = brideCenterApis[callId];\r\n    if (bca === undefined) return;\r\n    brideCenterApis[callId] = undefined;\r\n    bca.resolve(result);\r\n}\r\n","import { UqApi } from '../net';\r\nimport { LocalCache } from '../tool';\r\nimport { UqMan, Field, ArrFields, FieldMap } from './uqMan';\r\nimport { Tuid } from './tuid';\r\nimport { getObjPropIgnoreCase } from '../tool';\r\n\r\nconst tab = '\\t';\r\nconst ln = '\\n';\r\nconst chars = '\\\\ntbfvr';\r\nconst codeBackSlash = chars.charCodeAt(0);\r\nconst codeN = chars.charCodeAt(1);\r\nconst codeT = chars.charCodeAt(2);\r\nconst codeB = chars.charCodeAt(3);\r\nconst codeF = chars.charCodeAt(4);\r\nconst codeV = chars.charCodeAt(5);\r\nconst codeR = chars.charCodeAt(6);\r\n\r\nconst codes = '\\n\\t\\b\\f\\v\\r';\r\nconst codeBN = codes.charCodeAt(0);\r\nconst codeBT = codes.charCodeAt(1);\r\nconst codeBB = codes.charCodeAt(2);\r\nconst codeBF = codes.charCodeAt(3);\r\nconst codeBV = codes.charCodeAt(4);\r\nconst codeBR = codes.charCodeAt(5);\r\n\r\nexport abstract class Entity {\r\n    private jName: string;\r\n    schema: any;\r\n    ver: number = 0;\r\n    sys?: boolean;\r\n    readonly uq: UqMan;\r\n    readonly name: string;\r\n    readonly typeId: number;\r\n    readonly cache: LocalCache;\r\n    readonly uqApi: UqApi;\r\n    abstract get typeName(): string;\r\n    get sName():string {return this.jName || this.name}\r\n    fields: Field[];\r\n    arrFields: ArrFields[];\r\n    returns: ArrFields[];\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        this.uq = uq;\r\n        this.name = name;\r\n        this.typeId = typeId;\r\n        this.sys = this.name.indexOf('$') >= 0;\r\n        this.cache = this.uq.localMap.item(this.name); // new EntityCache(this);\r\n        this.uqApi = this.uq.uqApi;\r\n    }\r\n\r\n    public face: any;           // 对应字段的label, placeHolder等等的中文，或者语言的翻译\r\n\r\n    //getApiFrom() {return this.entities.uqApi;}\r\n\r\n    private fieldMaps: {[arr:string]: FieldMap} = {};\r\n    fieldMap(arr?:string): FieldMap {\r\n        if (arr === undefined) arr = '$';\r\n        let ret = this.fieldMaps[arr];\r\n        if (ret === undefined) {\r\n            let fields:Field[];\r\n            if (arr === '$') fields = this.fields;\r\n            else if (this.arrFields !== undefined) {\r\n                let arrFields = this.arrFields.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            else if (this.returns !== undefined) {\r\n                let arrFields = this.returns.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            if (fields === undefined) return {};\r\n            ret = {};\r\n            for (let f of fields) ret[f.name] = f;\r\n            this.fieldMaps[arr] = ret;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public async loadSchema():Promise<void> {\r\n        if (this.schema !== undefined) return;\r\n        let schema = this.cache.get();\r\n        if (!schema) {\r\n            schema = await this.uq.loadEntitySchema(this.name);\r\n        }\r\n        //this.setSchema(schema);\r\n\t\t//this.buildFieldsTuid();\r\n\t\tthis.buildSchema(schema);\r\n\t\tawait this.loadValues();\r\n\t}\r\n\r\n\tbuildSchema(schema: any) {\r\n        this.setSchema(schema);\r\n\t\tthis.buildFieldsTuid();\r\n\t\t//await this.loadValues();\r\n\t}\r\n\t\r\n\tprotected async loadValues():Promise<any> {}\r\n\r\n    // 如果要在setSchema里面保存cache，必须先调用clearSchema\r\n    public clearSchema() {\r\n        this.schema = undefined;\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        if (schema === undefined) return;\r\n        let {name, version} = schema;\r\n        this.ver = version || 0;\r\n\t\tthis.setJName(name);\r\n        this.cache.set(schema);\r\n\t\tthis.schema = schema;\r\n\t\tthis.buildFieldsTuid();\r\n\t}\r\n\t\r\n\tprotected setJName(name:string) {\r\n        if (name !== this.name) this.jName = name;\r\n\t}\r\n\r\n    public buildFieldsTuid() {\r\n        let {fields, arrs, returns} = this.schema;\r\n        this.uq.buildFieldTuid(this.fields = fields);\r\n        this.uq.buildArrFieldsTuid(this.arrFields = arrs, fields);\r\n        this.uq.buildArrFieldsTuid(this.returns = returns, fields);\r\n    }\r\n\r\n    schemaStringify():string {\r\n        return JSON.stringify(this.schema, (key:string, value:any) => {\r\n            if (key === '_tuid') return undefined;\r\n            return value;\r\n        }, 4);\r\n    }\r\n\r\n    tuidFromName(fieldName:string, arrName?:string):Tuid {\r\n        if (this.schema === undefined) return;\r\n        let {fields, arrs} = this.schema;\r\n        let entities = this.uq;\r\n        function getTuid(fn:string, fieldArr:Field[]) {\r\n            if (fieldArr === undefined) return;\r\n            let f = fieldArr.find(v => v.name === fn);\r\n            if (f === undefined) return;\r\n            return entities.getTuid(f.tuid);\r\n        }\r\n        let fn = fieldName.toLowerCase();\r\n        if (arrName === undefined) return getTuid(fn, fields);\r\n        if (arrs === undefined) return;\r\n        let an = arrName.toLowerCase();\r\n        let arr = (arrs as ArrFields[]).find(v => v.name === an);\r\n        if (arr === undefined) return;\r\n        return getTuid(fn, arr.fields);\r\n    }\r\n\r\n    buildParams(params:any):any {\r\n        let result:any = {};\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.buildFieldsParams(result, fields, params);\r\n        let arrs = this.arrFields;\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let {name, fields} = arr;\r\n                let paramsArr:any[] = params[name];\r\n                if (paramsArr === undefined) continue;\r\n                let arrResult:any[] = [];\r\n                result[name] = arrResult;\r\n                for (let pa of params) {\r\n                    let rowResult = {};\r\n                    this.buildFieldsParams(rowResult, fields, pa);\r\n                    arrResult.push(rowResult);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private buildFieldsParams(result:any, fields:Field[], params:any) {\r\n        for (let field of fields) {\r\n            let {name, type} = field;            \r\n            let d = params[name];\r\n            let val:any;\r\n            switch (type) {\r\n\t\t\t\tcase 'datetime':\r\n                \tval = this.buildDateTimeParam(d);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'date':\r\n\t\t\t\t\tif (d instanceof Date) {\r\n\t\t\t\t\t\tval = `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tval = d;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tswitch (typeof d) {\r\n\t\t\t\t\t\tdefault: val = d; break;\r\n\t\t\t\t\t\tcase 'object':\r\n\t\t\t\t\t\t\tif (d instanceof Date) {\r\n\t\t\t\t\t\t\t\tval = d;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlet tuid = field._tuid;\r\n\t\t\t\t\t\t\tif (tuid === undefined) val = d.id;\r\n\t\t\t\t\t\t\telse val = tuid.getIdFromObj(d);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n            }\r\n            result[name] = val;\r\n        }\r\n    }\r\n\r\n    buildDateTimeParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return undefined;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'string':\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        return Math.floor(dt.getTime()/1000);\r\n    }\r\n\r\n    buildDateParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return '';\r\n            case 'string': return val;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        let ret = dt.toISOString();\r\n        let p = ret.indexOf('T');\r\n        return p>0? ret.substr(0, p) : ret;\r\n    }\r\n\r\n    pack(data:any):string {\r\n        let ret:string[] = [];\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.packRow(ret, fields, data);\r\n        let arrs = this.arrFields; \r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n\t\t\t\tlet {name, fields} = arr;\r\n\t\t\t\tlet arrData = getObjPropIgnoreCase(data, name);\r\n\t\t\t\t//if (!arrData) arrData = data[name.toLowerCase()];\r\n                this.packArr(ret, fields, arrData);\r\n            }\r\n        }\r\n        return ret.join('');\r\n    }\r\n\r\n    private escape(row:any, field:Field):any {\r\n        let d = row[field.name];\r\n        switch (field.type) {\r\n            case 'datetime':\r\n                return this.buildDateTimeParam(d);\r\n            default:\r\n                switch (typeof d) {\r\n                    default: return d;\r\n                    case 'object':\r\n                        let tuid = field._tuid;\r\n                        if (tuid === undefined) return d.id;\r\n                        return tuid.getIdFromObj(d);\r\n                    case 'string':\r\n                        let len = d.length;\r\n                        let r = '', p = 0;\r\n                        for (let i=0;i<len;i++) {\r\n                            let c:number = d.charCodeAt(i), ch:string;\r\n                            switch(c) {\r\n\t\t\t\t\t\t\t\tdefault: continue;\r\n\t\t\t\t\t\t\t\tcase codeBackSlash: ch = '\\\\\\\\'; break;\r\n                                case codeBT: ch = '\\\\t'; break;\r\n\t\t\t\t\t\t\t\tcase codeBN: ch = '\\\\n'; break;\r\n\t\t\t\t\t\t\t\tcase codeBF: ch = '\\\\f'; break;\r\n\t\t\t\t\t\t\t\tcase codeBV: ch = '\\\\v'; break;\r\n\t\t\t\t\t\t\t\tcase codeBB: ch = '\\\\b'; break;\r\n\t\t\t\t\t\t\t\tcase codeBR: ch = '\\\\r'; break;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tr += d.substring(p, i) + ch;\r\n\t\t\t\t\t\t\tp = i+1;\r\n                        }\r\n                        return r + d.substring(p);\r\n                    case 'undefined': return '';\r\n                }\r\n        }\r\n    }\r\n\r\n    private packRow(result:string[], fields:Field[], data:any) {\r\n        let len = fields.length;\r\n        if (len === 0) return;\r\n        let ret = '';\r\n        ret += this.escape(data, fields[0]);\r\n        for (let i=1;i<len;i++) {\r\n            let f = fields[i];\r\n            ret += tab + this.escape(data, f);\r\n        }\r\n        result.push(ret + ln);\r\n    }\r\n\r\n    private packArr(result:string[], fields:Field[], data:any[]) {\r\n        if (data !== undefined) {\r\n\t\t\tif (data.length === 0) {\r\n\t\t\t\tresult.push(ln);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (let row of data) {\r\n\t\t\t\t\tthis.packRow(result, fields, row);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tresult.push(ln);\r\n\t\t}\r\n        result.push(ln);\r\n    }\r\n    protected cacheFieldsInValue(values:any, fields:Field[]) {\r\n        for (let f of fields as Field[]) {\r\n            let {name, _tuid} = f;\r\n            if (_tuid === undefined) continue;\r\n            let id = values[name];\r\n            //_tuid.useId(id);\r\n            values[name] = _tuid.boxId(id);\r\n        }\r\n    }\r\n\r\n    protected unpackTuidIdsOfFields(values:string[], fields: Field[]):any[] {\r\n        if (fields === undefined) return values as any[];\r\n        //if (this.fields === undefined) return values as any[];\r\n        let ret:any[] = []\r\n        for (let ln of values) {\r\n            if (!ln) continue;\r\n            let len = ln.length;\r\n            let p = 0;\r\n            while (p<len) {\r\n                let ch = ln.charCodeAt(p);\r\n                if (ch === 10) {\r\n                    ++p;\r\n                    break;\r\n                }\r\n                let row = {};\r\n                p = this.unpackRow(row, fields, ln, p);\r\n                ret.push(row);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    unpackSheet(data:string):any {\r\n        let ret = {} as any; //new this.newMain();\r\n        //if (schema === undefined || data === undefined) return;\r\n        let fields = this.fields;\r\n        let p = 0;\r\n        if (fields !== undefined) p = this.unpackRow(ret, fields, data, p);\r\n        let arrs = this.arrFields; //schema['arrs'];\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                p = this.unpackArr(ret, arr, data, p);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n\tunpackReturns(data:string, returns?:ArrFields[]):{[name:string]:any[]} {\r\n\t\tif (data === undefined) debugger;\r\n\t\tlet ret = {} as any;\r\n\t\tlet p = 0;\r\n\t\tlet arrs = returns || this.returns;\r\n\t\tif (arrs !== undefined) {\r\n\t\t\tfor (let arr of arrs) {\r\n\t\t\t\tp = this.unpackArr(ret, arr, data, p);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n    protected unpackRow(ret:any, fields:Field[], data:string, p:number):number {\r\n        let ch0 = 0, ch = 0, c = p, i = 0, len = data.length, fLen = fields.length;\r\n        for (;p<len;p++) {\r\n            ch0 = ch;\r\n            ch = data.charCodeAt(p);\r\n            if (ch === 9) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                c = p+1;\r\n                ++i;\r\n                if (i>=fLen) {\r\n                    p = data.indexOf('\\n', c);\r\n                    if (p >= 0) ++p;\r\n                    else p = len;\r\n                    return p;\r\n                }\r\n            }\r\n            else if (ch === 10) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                ++p;\r\n                ++i;\r\n                return p;\r\n            }\r\n        }\r\n        let f = fields[i];\r\n        let {name} = f;\r\n        if (ch0 !== 8) {\r\n            let v = data.substring(c);\r\n            ret[name] = this.to(ret, v, f);\r\n        }\r\n        return len;\r\n    }\r\n\r\n    private to(ret:any, v:string, f:Field):any {\r\n        switch (f.type) {\r\n\t\t\tdefault: return v;\r\n\t\t\tcase 'text':\r\n\t\t\tcase 'char':\r\n\t\t\t\treturn this.reverseNT(v);\r\n            case 'datetime':\r\n            case 'time':\r\n\t\t\tcase 'timestamp':\r\n                let n = Number(v);\r\n                let date = isNaN(n) === true? new Date(v) : new Date(n*1000);\r\n                return date;\r\n            case 'date':\r\n                let parts = v.split('-');\r\n                return new Date(Number(parts[0]), Number(parts[1])-1, Number(parts[2]));\r\n            case 'tinyint':\r\n            case 'smallint':\r\n            case 'int':\r\n            case 'bigint':\r\n            case 'dec':\r\n                return Number(v);\r\n            case 'id':\r\n                let id = Number(v);\r\n                let {_tuid} = f;\r\n                if (_tuid === undefined) return id;\r\n                return _tuid.boxId(id);\r\n        }\r\n\t}\r\n\t\r\n\tprivate reverseNT(text:string):string {\r\n\t\tif (text === undefined) return;\r\n\t\tif (text === null) return;\r\n\t\tlet len = text.length;\r\n\t\tlet r = '';\r\n\t\tlet p = 0;\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet c = text.charCodeAt(i);\r\n\t\t\tif (c === codeBackSlash) {\r\n\t\t\t\tif (i===len-1) break;\r\n\t\t\t\tlet c1 = text.charCodeAt(i+1);\r\n\t\t\t\tlet ch:string;\r\n\t\t\t\tswitch (c1) {\r\n\t\t\t\t\tdefault: continue;\r\n\t\t\t\t\tcase codeBackSlash: ch = '\\\\'; break;\r\n\t\t\t\t\tcase codeN: ch = '\\n'; break;\r\n\t\t\t\t\tcase codeT: ch = '\\t'; break;\r\n\t\t\t\t\tcase codeB: ch = '\\b'; break;\r\n\t\t\t\t\tcase codeF: ch = '\\f'; break;\r\n\t\t\t\t\tcase codeV: ch = '\\v'; break;\r\n\t\t\t\t\tcase codeR: ch = '\\r'; break;\r\n\t\t\t\t}\r\n\t\t\t\tr += text.substring(p, i) + ch;\r\n\t\t\t\tp = i+2;\r\n\t\t\t\t++i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tr += text.substring(p, len);\r\n\t\treturn r;\r\n\t}\r\n\r\n    private unpackArr(ret:any, arr:ArrFields, data:string, p:number):number {\r\n\t\tlet p0 = p;\r\n        let vals:any[] = [], len = data.length;\r\n        let {name, fields} = arr;\r\n        while (p<len) {\r\n            let ch = data.charCodeAt(p);\r\n            if (ch === 10) {\r\n\t\t\t\tif (p === p0) {\r\n\t\t\t\t\tch = data.charCodeAt(p);\r\n\t\t\t\t\tif (ch !== 10) {\r\n\t\t\t\t\t\tthrow new Error('upackArr: arr第一个字符是10，则必须紧跟一个10，表示整个arr的结束')\r\n\t\t\t\t\t}\r\n\t\t\t\t\t++p;\r\n\t\t\t\t}\r\n                ++p;\r\n                break;\r\n            }\r\n            let val = {} as any; //new creater();\r\n            vals.push(val);\r\n            p = this.unpackRow(val, fields, data, p);\r\n        }\r\n        ret[name] = vals;\r\n        return p;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { ItemSchema, UiItem, UiSelectBase } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { observable } from 'mobx';\r\nimport { FieldRule } from '../form/rules';\r\nimport { Image } from '../image';\r\nimport { Edit } from './edit';\r\n\r\nexport abstract class ItemEdit {\r\n\tprotected edit: Edit;\r\n\tprotected name: string;\r\n\tprotected _itemSchema: ItemSchema;\r\n    get itemSchema(): ItemSchema {return this._itemSchema}\r\n    protected _uiItem:UiItem;\r\n    get uiItem():UiItem {return this._uiItem}\r\n    value: any;\r\n\tlabel: string;\r\n\tget editInRow(): boolean {return false;}\r\n\r\n    @observable protected error: string;\r\n    @observable protected isChanged: boolean = false;\r\n    protected newValue: any;\r\n\r\n    constructor(edit:Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string, value: any) {\r\n\t\tthis.edit = edit;\r\n        this._itemSchema = itemSchema;\r\n        this._uiItem = uiItem\r\n        this.value = value;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this.label = label;\r\n\t}\r\n\t\r\n\tinit() {\t\t\r\n\t}\r\n\r\n    async start():Promise<any> {\r\n        return await this.internalStart();\r\n    }\r\n\r\n    protected abstract internalStart():Promise<any>;\r\n\r\n    async end():Promise<any> {\r\n        await this.internalEnd()\r\n    }\r\n\r\n\trenderContent() {\r\n        let {name, type} = this._itemSchema;\r\n        let divValue:any;\r\n        let uiItem = this._uiItem;\r\n        let label:string, labelHide:boolean;\r\n        if (uiItem === undefined) {\r\n            label = name;\r\n        }\r\n        else {\r\n\t\t\tlabel = uiItem.label;\r\n\t\t\tlabelHide = uiItem.labelHide;\r\n            let templet = uiItem.Templet;\r\n            if (templet !== undefined) {\r\n                if (typeof templet === 'function') {\r\n\t\t\t\t\tif (this.value !== undefined) divValue = templet(this.value);\r\n\t\t\t\t}\r\n                else {\r\n\t\t\t\t\tdivValue = {templet};\r\n\t\t\t\t}\r\n            }\r\n            else if (this.value !== undefined) {\r\n                switch (uiItem.widget) {\r\n                    case 'radio':\r\n                    case 'select':\r\n                        let {list} = uiItem as UiSelectBase;\r\n                        divValue = <b>{list.find(v => v.value === this.value).title}</b>;\r\n                        break;\r\n                    case 'id':\r\n                        divValue = <b>no templet for {name}={this.value}</b>\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        if (divValue === undefined) {\r\n            switch (type) {\r\n                default:\r\n                    divValue = this.value? \r\n\t\t\t\t\t\t<b>{this.value}</b> \r\n\t\t\t\t\t\t:\r\n\t\t\t\t\t\t<small className=\"text-muted\">[{labelHide===true? label:'无'}]</small>;\r\n                    break;\r\n                case 'image':\r\n                    divValue = <Image className=\"w-4c h-4c\" src={this.value} />;\r\n                    break;\r\n            }\r\n\t\t}\r\n\t\treturn divValue;\r\n\t}\r\n\r\n    protected async internalEnd():Promise<void> {nav.pop()}\r\n\r\n    protected verifyValue() {\r\n        if (this.uiItem === undefined) return;\r\n        let {rules} = this.uiItem;\r\n        if (rules === undefined) return;\r\n        let nv = this.newValue;\r\n        function verifyRule(rule:FieldRule, value: any):string {\r\n            let error = rule(nv);\r\n            if (error !== undefined) {\r\n                if (typeof error !== 'object')\r\n                    return error;\r\n                else\r\n                    return JSON.stringify(error);\r\n            }\r\n        }\r\n        if (Array.isArray(rules)) {\r\n            for (let rule of rules) {\r\n                let error = verifyRule(rule as FieldRule, nv);\r\n                if (error !== undefined) {\r\n                    this.error = error;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.error = verifyRule(rules as FieldRule, nv);\r\n        }\r\n    }\r\n}\r\n","//import _ from 'lodash';\r\nimport { Caller } from '../net';\r\nimport { Entity } from './entity';\r\nimport { Action } from './action';\r\nimport { Query } from './query';\r\n\r\ninterface UqResponseSchema {\r\n    uq: any;\r\n    entity: any;\r\n}\r\n\r\nexport abstract class EntityCaller<T> extends Caller<T> {\r\n    private tries: number;\r\n    protected _entity: Entity;\r\n\r\n    constructor(entity: Entity, params:T, waiting: boolean = true) {\r\n        super(params, waiting);\r\n        this.tries = 0;\r\n        this._entity = entity;\r\n    }\r\n\r\n    protected get entity(): Entity {return this._entity;}\r\n\r\n    //大多的entityCaller都不需要这个\r\n    //buildParams() {return this.entity.buildParams(this.params);}\r\n    \r\n    async request(): Promise<any> {\r\n        await this.entity.loadSchema();\r\n        let ret = await this.innerRequest();\r\n        return ret;\r\n    }\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        return await this.entity.uqApi.xcall(this);\r\n    }\r\n\r\n    async innerRequest(): Promise<any> {\r\n        let jsonResult = await this.innerCall();\r\n        let {$uq, $modify, res} = jsonResult;\r\n        this.entity.uq.pullModify($modify);\r\n        if ($uq === undefined) {\r\n            //if (res === undefined) debugger;\r\n            let ret = this.xresult(res);\r\n            //if (ret === undefined) debugger;\r\n            return ret;\r\n        }\r\n        return await this.retry($uq);\r\n    }\r\n\r\n    xresult(res:any):any {return res}\r\n\r\n    get headers(): {[header:string]: string} {\r\n        let {ver, uq} = this.entity;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }\r\n\r\n    private async retry(schema: UqResponseSchema) {\r\n        ++this.tries;\r\n        if (this.tries > 5) throw new Error('can not get right uq response schema, 5 tries');\r\n        this.rebuildSchema(schema);\r\n        return await this.innerRequest();\r\n    }\r\n\r\n    private rebuildSchema(schema: UqResponseSchema) {\r\n        let {uq, entity} = schema;\r\n        if (uq !== undefined) {\r\n\t\t\tthis.entity.uq.buildEntities(uq);\r\n\t\t}\r\n        if (entity !== undefined) {\r\n\t\t\tthis.entity.setSchema(entity);\r\n\t\t}\r\n    }\r\n}\r\n\r\nexport abstract class ActionCaller extends EntityCaller<any> {\r\n    protected get entity(): Action {return this._entity as Action;}\r\n}\r\n\r\nexport class QueryQueryCaller extends EntityCaller<any> {\r\n    protected get entity(): Query {return this._entity as Query};\r\n    get path():string {return `query/${this.entity.name}`;}\r\n    xresult(res:any) {\r\n        let data = this.entity.unpackReturns(res);\r\n        return data;\r\n    }\r\n    buildParams() {return this.entity.buildParams(this.params);}\r\n}\r\n\r\nexport class QueryPageCaller extends EntityCaller<any> {\r\n    protected get params(): {pageStart:any; pageSize:number, params:any} {return this._params};\r\n\tprotected get entity(): Query {return this._entity as Query};\r\n\t//results: {[name:string]:any[]};\r\n\tget path():string {return `query-page/${this.entity.name}`;}\t\r\n    buildParams() {\r\n        let {pageStart, pageSize, params} = this.params;\r\n        let p:any;\r\n        if (params === undefined) {\r\n            p = {key: ''};\r\n        }\r\n        else {\r\n            p = this.entity.buildParams(params);\r\n        }\r\n        /*\r\n        switch (typeof params) {\r\n            case 'undefined': p = {key: ''}; break;\r\n            default: p = _.clone(params); break;\r\n        }\r\n        */\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        return p;\r\n    };\r\n    xresult(res:any): {[name:string]:any[]} {\r\n        let ret = this.entity.unpackReturns(res);\r\n\t\t//return this.results.$page;// as any[];\r\n\t\treturn ret;\r\n    }\r\n}\r\n","import {bridgeCenterApi, isBridged} from './appBridge';\r\nimport {FetchError} from './fetchError';\r\nimport {HttpChannelUI} from './httpChannelUI';\r\nimport {nav} from '../components/nav';\r\nimport { Caller } from './caller';\r\nimport { env } from '../tool';\r\n\r\n/*\r\nexport async function httpGet(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.get('', params);\r\n    return ret;\r\n}\r\n\r\nexport async function httpPost(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.post('', params);\r\n    return ret;\r\n}\r\n*/\r\n\r\nconst methodsWithBody = ['POST', 'PUT'];\r\n\r\nexport abstract class HttpChannel {\r\n    private timeout: number;\r\n    protected ui?: HttpChannelUI;\r\n    protected hostUrl: string;\r\n    protected apiToken: string;\r\n\r\n    constructor(hostUrl: string, apiToken:string, ui?: HttpChannelUI) {\r\n        this.hostUrl = hostUrl;\r\n        this.apiToken = apiToken;\r\n        this.ui = ui;\r\n        this.timeout = env.isDevelopment === true? 500000:50000;\r\n    }\r\n\r\n    private startWait = (waiting: boolean) => {\r\n        if (waiting === true) {\r\n            if (this.ui !== undefined) this.ui.startWait();\r\n        }\r\n    }\r\n\r\n    private endWait = (url?:string, reject?:(reason?:any)=>void) => {\r\n        if (this.ui !== undefined) this.ui.endWait();\r\n        if (reject !== undefined) reject('访问webapi超时 ' + url);\r\n    }\r\n\r\n    private showError = async (error:FetchError) => {\r\n        if (this.ui !== undefined) await this.ui.showError(error);\r\n    }\r\n\r\n    used() {\r\n        this.post('', {});\r\n    }\r\n\r\n    async xcall(urlPrefix:string, caller:Caller<any>): Promise<void> {\r\n        let options = this.buildOptions();\r\n        let {headers, path, method} = caller;\r\n        if (headers !== undefined) {\r\n            let h = options.headers;\r\n            for (let i in headers) {\r\n\t\t\t\t//h.append(i, encodeURI(headers[i]));\r\n\t\t\t\th[i] = encodeURI(headers[i]);\r\n            }\r\n        }\r\n        options.method = method;\r\n        let p = caller.buildParams();\r\n        if (methodsWithBody.indexOf(method) >= 0 && p !== undefined) {\r\n            options.body = JSON.stringify(p)\r\n        }\r\n        return await this.innerFetch(urlPrefix + path, options, caller.waiting);\r\n    }\r\n\r\n    private async innerFetchResult(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let ret = await this.innerFetch(url, options, waiting);\r\n        return ret.res;\r\n    }\r\n\r\n    async get(url: string, params: any = undefined, waiting?: boolean): Promise<any> {\r\n        if (params) {\r\n            let keys = Object.keys(params);\r\n            if (keys.length > 0) {\r\n                let c = '?';\r\n                for (let k of keys) {\r\n                    let v = params[k];\r\n                    if (v === undefined) continue;\r\n                    url += c + k + '=' + params[k];\r\n                    c = '&';\r\n                }\r\n            }\r\n        }\r\n        let options = this.buildOptions();\r\n        options.method = 'GET';\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async post(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'POST';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async put(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'PUT';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async delete(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'DELETE';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n    async fetch(url: string, options: any, waiting: boolean, resolve:(value?:any)=>any, reject:(reason?:any)=>void):Promise<void> {\r\n        let that = this;\r\n        this.startWait(waiting);\r\n        let path = url;\r\n        function buildError(err: any, ex?: string) {\r\n            switch (typeof err) {\r\n                case 'string':\r\n                    if (ex !== undefined) err += ' ' + ex;\r\n                    break;\r\n                case 'object':\r\n                    let keys = Object.keys(err);\r\n                    let retErr:any = {\r\n                        ex: ex,\r\n                    };\r\n                    for (let key of keys) {\r\n                        retErr[key] = err[key];\r\n                    }\r\n                    err = retErr;\r\n                    break;\r\n            }\r\n            return {\r\n                channel: that,\r\n                url: path,\r\n                options: options,\r\n                resolve: resolve,\r\n                reject: reject,\r\n                error: err,\r\n            }\r\n        }\r\n        try {\r\n            console.log('%s-%s %s', options.method, path, options.body || '');\r\n            let now = Date.now();\r\n            let timeOutHandler = env.setTimeout(\r\n                undefined, //'httpChannel.fetch',\r\n                () => {\r\n                    that.endWait(url + ' timeout endWait: ' + (Date.now() - now) + 'ms', reject);\r\n                },\r\n                this.timeout);\r\n            let res = await fetch(encodeURI(path), options);\r\n            if (res.ok === false) {\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('ok false endWait');       \r\n                that.endWait();\r\n                console.log('call error %s', res.statusText);\r\n                throw res.statusText;\r\n            }\r\n            let ct = res.headers.get('content-type');\r\n            if (ct && ct.indexOf('json')>=0) {\r\n                return res.json().then(async retJson => {\r\n                    env.clearTimeout(timeOutHandler);\r\n                    that.endWait();\r\n                    if (retJson.ok === true) {\r\n                        if (typeof retJson !== 'object') {\r\n                            debugger;\r\n                        }\r\n                        else if (Array.isArray(retJson) === true) {\r\n                            debugger;\r\n                        }\r\n                        return resolve(retJson);\r\n                    }\r\n                    let retError = retJson.error;\r\n                    if (retError === undefined) {\r\n                        await that.showError(buildError('not valid tonva json'));\r\n                    }\r\n                    else {\r\n                        await that.showError(buildError(retError, 'retJson.error'));\r\n                        reject(retError);\r\n                    }\r\n                }).catch(async error => {\r\n                    await that.showError(buildError(error, 'catch res.json()'));\r\n                });\r\n            }\r\n            else {\r\n                let text = await res.text();\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('text endWait');\r\n                that.endWait();\r\n                resolve(text);\r\n            }\r\n        }\r\n        catch(error) {\r\n            this.endWait(url, reject);\r\n            if (typeof error === 'string') {\r\n                let err = error.toLowerCase();\r\n                if (err.startsWith('unauthorized') === true) {\r\n                    nav.logout();\r\n                    return;\r\n                }\r\n            }\r\n            console.error('fecth error (no nav.showError): ' + url);\r\n            // await this.showError(buildError(error, 'catch outmost'));\r\n        };\r\n    }\r\n\r\n    protected abstract innerFetch(url: string, options: any, waiting: boolean): Promise<any>;\r\n\r\n    async callFetch(url:string, method:string, body:any):Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = method;\r\n        options.body = body;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(url, options, true, resolve, reject);\r\n        });\r\n    }\r\n\r\n    //private buildOptions(): {method:string; headers:Headers; body:any} {\r\n\t\tprivate buildOptions(): {method:string; headers:{[name:string]: string}; body:any} {\r\n        let headers = this.buildHeaders();\r\n        let options = {\r\n            headers: headers,\r\n            method: undefined as any,\r\n            body: undefined as any,\r\n            // cache: 'no-cache',\r\n        };\r\n        return options;\r\n    }\r\n\r\n\t/*\r\n    protected buildHeaders():Headers {\r\n        let {language, culture} = nav;\r\n        let headers = new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        headers.append('Accept-Language', lang);\r\n        if (this.apiToken) { \r\n            headers.append('Authorization', this.apiToken); \r\n        }\r\n        return headers;\r\n\t}\r\n\t*/\r\n\tprotected buildHeaders():{[name:string]: string} { \r\n        let {language, culture} = nav;\r\n        let headers:{[name:string]: string} = {}; //new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n\t\t//headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n\t\theaders['Content-Type'] = 'application/json;charset=UTF-8';\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n\t\t//headers.append('Accept-Language', lang);\r\n\t\theaders['Accept-Language'] = lang;\r\n        if (this.apiToken) { \r\n\t\t\t//headers.append('Authorization', this.apiToken); \r\n\t\t\theaders['Authorization'] = this.apiToken;\r\n        }\r\n        return headers;\r\n\t}\r\n}\r\n\r\nexport class CenterHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        if (this.apiToken === undefined && isBridged())\r\n            return await bridgeCenterApi(u, options.method, options.body);\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n\r\nexport class UqHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n","import {nav} from '../components/nav';\r\nimport {FetchError} from './fetchError';\r\n\r\nexport interface HttpChannelUI {\r\n    startWait():void;\r\n    endWait():void;\r\n    showError(error:FetchError):Promise<void>;\r\n    showUpgradeUq(uq:string, version:number):Promise<void>;\r\n}\r\n\r\nexport class HttpChannelNavUI implements HttpChannelUI {\r\n    startWait() {\r\n        nav.startWait();\r\n    }\r\n    endWait() {\r\n        nav.endWait();\r\n    }\r\n    async showError(error:FetchError):Promise<void> {\r\n        nav.endWait();\r\n        /*\r\n        if (error.name === 'SyntaxError') {\r\n            error = {\r\n                name: error.name,\r\n                message: error.message,\r\n            }\r\n        }*/\r\n        await nav.onError(error);\r\n    }\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await nav.showUpgradeUq(uq, version);\r\n    }\r\n}\r\n\r\n","import _ from 'lodash';\r\nimport {HttpChannel, CenterHttpChannel, UqHttpChannel} from './httpChannel';\r\nimport {HttpChannelNavUI} from './httpChannelUI';\r\nimport {appUq, logoutUqTokens, buildAppUq} from './appBridge';\r\nimport {ApiBase} from './apiBase';\r\nimport { host } from './host';\r\nimport { LocalMap, env } from '../tool';\r\nimport {decodeUserToken} from '../tool/user';\r\n\r\ninterface PromiseValue<T> {\r\n\tresolve: (value?: T | PromiseLike<T>) => void;\r\n\treject: (reason?: any) => void;\r\n}\r\nlet channelUIs:{[name:string]: HttpChannel|(PromiseValue<any>[])} = {};\r\nlet channelNoUIs:{[name:string]: HttpChannel|(PromiseValue<any>[])} = {};\r\n\r\nexport function logoutApis() {\r\n    channelUIs = {};\r\n    channelNoUIs = {};\r\n    logoutUnitxApis();\r\n    logoutUqTokens();\r\n}\r\n\r\ninterface UqLocal {\r\n    user: number;\r\n    unit: number;\r\n    value: any;\r\n    tick?: number;\r\n    isNet?: boolean;\r\n}\r\n/*\r\ninterface UqLocals {\r\n    user: number;\r\n    unit: number;\r\n    uqs: {[uq:string]: UqLocal};\r\n}\r\n*/\r\n/*\r\nconst uqLocalEntities = 'uqLocalEntities';\r\nclass CacheUqLocals {\r\n    private local:UqLocals;\r\n\r\n    async loadAccess(uqApi: UqApi):Promise<any> {\r\n        try {\r\n            let {uqOwner, uqName} = uqApi;\r\n            if (this.local === undefined) {\r\n                let ls = null; // localStorage.getItem(uqLocalEntities);\r\n                if (ls !== null) {\r\n                    this.local = JSON.parse(ls);\r\n                }\r\n            }\r\n            if (this.local !== undefined) {\r\n                let {user, uqs} = this.local;\r\n                if (user !== loginedUserId || uqs === undefined) {\r\n                    this.local = undefined;\r\n                }\r\n                else {\r\n                    for (let i in uqs) {\r\n                        let ul = uqs[i];\r\n                        ul.isNet = undefined;\r\n                    }\r\n                }\r\n            }\r\n            if (this.local === undefined) {\r\n                this.local = {\r\n                    user: loginedUserId,\r\n                    unit: undefined,\r\n                    uqs: {}\r\n                };\r\n            }\r\n\r\n            let ret: any;\r\n            let un = uqOwner+'/'+uqName;\r\n            let uq = this.local.uqs[un];\r\n            if (uq !== undefined) {\r\n                let {value} = uq;\r\n                ret = value;\r\n            }\r\n            if (ret === undefined) {\r\n                ret = await uqApi.__loadAccess();\r\n                //this.saveLocal(un, ret);\r\n            }\r\n            return _.cloneDeep(ret);\r\n        }\r\n        catch (err) {\r\n            this.local = undefined;\r\n            localStorage.removeItem(uqLocalEntities);\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    private saveLocal(uqName:string, accessValue: any) {\r\n        this.local.uqs[uqName] = {\r\n            value: accessValue,\r\n            isNet: true,\r\n        }\r\n        let str = JSON.stringify(this.local);\r\n        localStorage.setItem(uqLocalEntities, str);\r\n    }\r\n\r\n    async checkAccess(uqApi: UqApi):Promise<boolean> {\r\n        if (this.local === undefined) return false;\r\n        let {uqOwner, uqName} = uqApi;\r\n        let un = uqOwner+'/'+uqName;\r\n        let uq = this.local.uqs[un];\r\n        if (uq === undefined) return false;\r\n        let {isNet, value} = uq;\r\n        if (isNet === true) return true;\r\n        let ret = await uqApi.__loadAccess();\r\n        let isMatch = _.isMatch(value, ret);\r\n        if (isMatch === false) {\r\n            this.saveLocal(un, ret);\r\n            return false;\r\n        }\r\n        uq.isNet = true;\r\n        return true;\r\n    }\r\n}\r\n\r\nconst localUqs = new CacheUqLocals;\r\n*/\r\nexport class UqApi extends ApiBase {\r\n    private access:string[];\r\n    appOwner:string;\r\n    appName:string;\r\n    uqOwner: string;\r\n    uqName: string;\r\n    uq: string;\r\n\r\n    constructor(basePath:string, appOwner:string, appName:string, uqOwner:string, uqName:string, access:string[], showWaiting?: boolean) {\r\n        super(basePath, showWaiting);\r\n        this.appOwner = appOwner;\r\n        this.appName = appName;\r\n        if (uqName) {\r\n            this.uqOwner = uqOwner;\r\n            this.uqName = uqName;\r\n            this.uq = uqOwner + '/' + uqName;\r\n        }\r\n        this.access = access;\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    //setUqVersion(uqVersion:number) {this.uqVersion = undefined}\r\n\r\n    async init() {\r\n        await buildAppUq(this.uq, this.uqOwner, this.uqName, this.appOwner, this.appName);\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channels: {[name:string]: HttpChannel|(PromiseValue<any>[])};\r\n        let channelUI: HttpChannelNavUI;\r\n        if (this.showWaiting === true || this.showWaiting === undefined) {\r\n            channels = channelUIs;\r\n            channelUI = new HttpChannelNavUI();\r\n        }\r\n        else {\r\n            channels = channelNoUIs;\r\n        }\r\n        let channel = channels[this.uq];\r\n\t\tif (channel !== undefined) {\r\n\t\t\tif (Array.isArray(channel) === false) return channel as HttpChannel;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tchannel = channels[this.uq] = [];\r\n\t\t}\r\n\t\tlet arr = channel as PromiseValue<any>[];\r\n\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\tarr.push({resolve, reject});\r\n\t\t\tif (arr.length !== 1) return;\r\n\t\t\tlet uqToken = appUq(this.uq); //, this.uqOwner, this.uqName);\r\n\t\t\tif (!uqToken) {\r\n\t\t\t\t//debugger;\r\n\t\t\t\tawait this.init();\r\n\t\t\t\tuqToken = appUq(this.uq);\r\n\t\t\t}\r\n\t\t\tlet {url, token} = uqToken;\r\n\t\t\tthis.token = token;\r\n\t\t\tchannel = new UqHttpChannel(url, token, channelUI);\r\n\t\t\tchannels[this.uq] = channel;\r\n\t\t\tfor (let pv of arr) {\r\n\t\t\t\tpv.resolve(channel);\r\n\t\t\t}\r\n\r\n\t\t});\r\n    }\r\n\r\n    async loadAccess():Promise<any> {\r\n        //return await localUqs.loadAccess(this);\r\n        let acc = this.access === undefined?\r\n            '' :\r\n            this.access.join('|');\r\n        let ret = await this.get('access', {acc:acc});\r\n        return ret;\r\n    }\r\n\r\n\tasync allSchemas(): Promise<any> {\r\n\t\treturn await this.get('all-schemas');\r\n\t}\r\n\r\n    async schema(name:string):Promise<any> {\r\n        return await this.get('schema/' + name);\r\n    }\r\n\r\n    async queueModify(start:number, page:number, entities:string) {\r\n        return await this.post('queue-modify', {start:start, page:page, entities:entities});\r\n    }\r\n\r\n\tasync getRoles():Promise<string[]> {\r\n\t\tlet ret = await this.get('get-roles',);\r\n\t\tif (!ret) return null;\r\n\t\tlet parts:string[] = (ret as string).split('|');\r\n\t\tlet s:string[] = [];\r\n\t\tfor (let p of parts) {\r\n\t\t\tp = p.trim();\r\n\t\t\tif (!p) continue;\r\n\t\t\ts.push(p);\r\n\t\t}\r\n\t\tif (s.length === 0) return null;\r\n\t\treturn s;\r\n\t}\r\n\t\r\n\tasync getAllRoleUsers():Promise<{user:number, admin:number, roles:string}[]> {\r\n\t\tlet ret = await this.get('get-all-role-users');\r\n\t\treturn ret;\r\n\t}\r\n\tasync setUserRoles(theUser:number, roles:string):Promise<void> {\r\n\t\tawait this.post('set-user-roles', {theUser, roles});\r\n\t}\r\n\tasync deleteUserRoles(theUser:number):Promise<void> {\r\n\t\tawait this.get('delete-user-roles', {theUser});\r\n\t}\r\n}\r\n\r\nlet channels:{[unitId:number]: HttpChannel} = {};\r\n\r\nexport function logoutUnitxApis() {\r\n    channels = {};\r\n}\r\n\r\nexport class UnitxApi extends UqApi {\r\n    private unitId:number;\r\n    constructor(unitId:number) {\r\n        super('tv/', undefined, undefined, undefined, undefined, undefined, true);\r\n        this.unitId = unitId;\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channel = channels[this.unitId];\r\n        if (channel !== undefined) return channel;\r\n        return channels[this.unitId] = await this.buildChannel();\r\n    }\r\n\r\n    private async buildChannel():Promise<HttpChannel> {\r\n        let channelUI = new HttpChannelNavUI();\r\n        let centerAppApi = new CenterAppApi('tv/', undefined);\r\n        let ret = await centerAppApi.unitxUq(this.unitId);\r\n        let {token, db, url, urlTest} = ret;\r\n        let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n        this.token = token;\r\n        return new UqHttpChannel(realUrl, token, channelUI);\r\n    }\r\n}\r\n\r\nlet centerHost:string;\r\n\r\nexport function setCenterUrl(url:string) {\r\n    console.log('setCenterUrl %s', url);\r\n    centerHost = url;\r\n    //centerToken = undefined;\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nexport let centerToken:string|undefined = undefined;\r\n\r\nlet loginedUserId:number = 0;\r\nexport function setCenterToken(userId:number, t?:string) {\r\n    loginedUserId = userId;\r\n    centerToken = t;\r\n    console.log('setCenterToken %s', t);\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nlet centerChannelUI:HttpChannel;\r\nlet centerChannel:HttpChannel;\r\nfunction getCenterChannelUI():HttpChannel {\r\n    if (centerChannelUI !== undefined) return centerChannelUI;\r\n    return centerChannelUI = new CenterHttpChannel(centerHost, centerToken, new HttpChannelNavUI());\r\n}\r\nfunction getCenterChannel():HttpChannel {\r\n    if (centerChannel !== undefined) return centerChannel;\r\n    return centerChannel = new CenterHttpChannel(centerHost, centerToken);\r\n}\r\n\r\nexport abstract class CenterApiBase extends ApiBase {\r\n    /*\r\n    constructor(path: string, showWaiting?: boolean) {\r\n        super(path, showWaiting);\r\n    }*/\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        return (this.showWaiting === true || this.showWaiting === undefined)?\r\n            getCenterChannelUI():\r\n            getCenterChannel();\r\n    }\r\n}\r\n\r\nconst uqTokensName = 'uqTokens';\r\nexport class UqTokenApi extends CenterApiBase {\r\n    private localMap: LocalMap = env.localDb.map(uqTokensName);\r\n\r\n    async uq(params: {unit:number, uqOwner:string, uqName:string, appOwner:string, appName:string}):Promise<any> {\r\n        let {uqOwner, uqName} = params;\r\n        let un = uqOwner+'/'+uqName;\r\n        let localCache = this.localMap.child(un);\r\n        try {\r\n            let uqToken:UqLocal = localCache.get();\r\n            if (uqToken !== undefined) {\r\n                let {unit, user} = uqToken;\r\n                if (unit !== params.unit || user !== loginedUserId) {\r\n                    localCache.remove();\r\n                    uqToken = undefined;\r\n                }\r\n            }\r\n            let nowTick = Math.floor(Date.now() / 1000);\r\n            if (uqToken !== undefined) {\r\n                let {tick, value} = uqToken;\r\n                if (value !== undefined && (nowTick - tick) < 24*3600) {\r\n                    return _.clone(value);\r\n                }\r\n            }\r\n            let appUqParams:any = _.clone(params);\r\n            appUqParams.testing = host.testing;\r\n            let ret = await this.get('app-uq', appUqParams);\r\n            if (ret === undefined) {\r\n                let {unit, uqOwner, uqName} = params;\r\n                let err = `center get app-uq(unit=${unit}, '${uqOwner}/${uqName}') - not exists or no unit-service`;\r\n                throw err;\r\n            }\r\n\r\n            uqToken = {\r\n                unit: params.unit,\r\n                user: loginedUserId,\r\n                tick: nowTick,\r\n                value: ret,\r\n            }\r\n            localCache.set(uqToken);\r\n            return _.clone(ret);\r\n        }\r\n        catch (err) {\r\n            localCache.remove();\r\n            throw err;\r\n        }\r\n    }\r\n}\r\n\r\nexport const uqTokenApi = new UqTokenApi('tv/tie/', undefined);\r\n\r\nexport class CallCenterApi extends CenterApiBase {\r\n    directCall(url:string, method:string, body:any):Promise<any> {\r\n        return this.call(url, method, body);\r\n    }\r\n}\r\nexport const callCenterapi = new CallCenterApi('', undefined);\r\n\r\nexport interface UqAppData {\r\n    appName: string;\r\n    appOwner: string;\r\n    id: number;\r\n    version: string;        // AppUI version\r\n    uqs: UqData[];\r\n}\r\n\r\nexport interface UqData {\r\n    id: number;\r\n    uqOwner: string;\r\n    uqName: string;\r\n    access: string;\r\n    newVersion: boolean;\r\n}\r\n\r\nexport interface UqServiceData {\r\n    id: number;\r\n    db: string;\r\n    url: string;\r\n    urlTest: string;\r\n    token: string;\r\n}\r\n\r\n//const appUqsName = 'appUqs';\r\n\r\nexport class CenterAppApi extends CenterApiBase {\r\n    //private local: LocalCache = env.localDb.item(appUqsName);\r\n    //private cachedUqs: UqAppData;\r\n    async uqs(appOwner:string, appName:string):Promise<UqAppData> {\r\n        let ret:UqAppData = await this.get('tie/app-uqs', {appOwner:appOwner, appName:appName});\r\n        return ret;\r\n        /*\r\n        let ret:UqAppData;\r\n        let appUqs = this.local.get();\r\n        if (appUqs) {\r\n            let {appOwner:rAppOwner, appName:rAppName} = appUqs;\r\n            if (appOwner === rAppOwner && appName === rAppName) ret = appUqs;\r\n        }\r\n        if (ret === undefined) {\r\n            ret = await this.uqsPure(appOwner, appName);\r\n            ret.appName = appName;\r\n            ret.appOwner = appOwner;\r\n            //localStorage.setItem(JSON.stringify(obj));\r\n            this.local.set(ret);\r\n        }\r\n        //return this.cachedUqs = _.cloneDeep(ret);\r\n        return ret;\r\n        */\r\n    }\r\n    private async uqsPure(appOwner:string, appName:string):Promise<UqAppData> {\r\n        return await this.get('tie/app-uqs', {appOwner:appOwner, appName:appName});\r\n    }\r\n    /*\r\n    private async isOkCheckUqs(appOwner:string, appName:string):Promise<boolean> {\r\n        let ret = await this.uqsPure(appOwner, appName);\r\n        let {id:cachedId, uqs:cachedUqs} = this.local.get(); //.cachedUqs;\r\n        let {id:retId, uqs:retUqs} = ret;\r\n        if (cachedId !== retId) return false;\r\n        if (cachedUqs.length !== retUqs.length) return false;\r\n        let len = cachedUqs.length;\r\n        for (let i=0; i<len; i++) {\r\n            if (_.isMatch(cachedUqs[i], retUqs[i]) === false) return false;\r\n        }\r\n        return true;\r\n    }\r\n    async checkUqs(appOwner:string, appName:string):Promise<boolean> {\r\n        let ret = await this.isOkCheckUqs(appOwner, appName);\r\n        if (ret === false) {\r\n            this.local.remove();\r\n            nav.start();\r\n        }\r\n        return ret;\r\n    }\r\n    */\r\n    async unitxUq(unit:number):Promise<UqServiceData> {\r\n        return await this.get('tie/unitx-uq', {unit:unit});\r\n    }\r\n    async changePassword(param: {orgPassword:string, newPassword:string}) {\r\n        return await this.post('tie/change-password', param);\r\n    }\r\n}\r\n\r\nexport async function loadAppUqs(appOwner:string, appName:string): Promise<UqAppData> {\r\n    let centerAppApi = new CenterAppApi('tv/', undefined);\r\n    //let unit = meInFrame.unit;\r\n    let ret = await centerAppApi.uqs(appOwner, appName);\r\n    //await centerAppApi.checkUqs(appOwner, appName);\r\n    /*\r\n    .then(v => {\r\n        if (v === false) {\r\n            localStorage.removeItem(appUqs);\r\n            nav.start();\r\n        }\r\n    });\r\n    */\r\n    return ret;\r\n}\r\n\r\n//import { nav } from '../ui';\r\n\r\nexport interface RegisterParameter {\r\n    nick:string, \r\n    user:string, \r\n    pwd:string,\r\n    country:number, \r\n    mobile:number, \r\n    mobileCountry:number,\r\n    email:string,\r\n    verify:string,\r\n};\r\n\r\nexport class UserApi extends CenterApiBase {\r\n    async login(params: {user: string, pwd: string, guest: number}): Promise<any> {\r\n        //(params as any).device = nav.local.device.get();\r\n        let ret = await this.get('user/login', params);\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeUserToken(ret);\r\n            case 'object':\r\n                let token = ret.token;\r\n                let user = decodeUserToken(token);\r\n                let {nick, icon} = ret;\r\n                if (nick) user.nick = nick;\r\n                if (icon) user.icon = icon;\r\n                return user;\r\n        }\r\n        // !== undefined) return decodeToken(token);\r\n    }\r\n    async register(params: RegisterParameter): Promise<any>\r\n    {\r\n        return await this.post('user/register', params);\r\n    }\r\n\r\n    async sendVerify(account:string, type:'mobile'|'email', oem:string) {\r\n        return await this.post('user/set-verify', {account:account, type:type, oem:oem});\r\n    }\r\n\r\n    async checkVerify(account:string, verify:string) {\r\n        return await this.post('user/check-verify', {account:account, verify:verify});\r\n    }\r\n\r\n    async isExists(account:string) {\r\n        return await this.get('user/is-exists', {account:account});\r\n    }\r\n\r\n    async resetPassword(account:string, password:string, verify:string, type:'mobile'|'email'):Promise<any[]> {\r\n        return await this.post('user/reset-password', {account:account, password, verify, type});\r\n    }\r\n    \r\n    async userSetProp(prop:string, value:any) {\r\n        await this.post('tie/user-set-prop', {prop:prop, value:value});\r\n    }\r\n\r\n    async me():Promise<any> {\r\n        return await this.get('tie/me');\r\n    }\r\n\r\n    async user(id:number): Promise<any> {\r\n        return await this.get('tie/user', {id:id});\r\n\t}\r\n\t\r\n\tasync fromKey(key:string): Promise<{id:number, name:string, nick:string, icon:string}> {\r\n\t\treturn await this.get('tie/user-from-key', {key});\r\n\t}\r\n}\r\n\r\nexport const userApi = new UserApi('tv/', undefined);\r\n","export * from './uqMan';\r\nexport * from './entity';\r\nexport * from './action';\r\nexport * from './query';\r\nexport * from './sheet';\r\nexport * from './tuid';\r\nexport * from './book';\r\nexport * from './map';\r\nexport * from './history';\r\nexport * from './pending';\r\nexport * from './uqsMan';\r\nexport * from './tag/tag';\r\nexport * from './enum';\r\nexport * from './buildUqApp';\r\n","import _ from 'lodash';\r\n\r\nexport interface KeyValueRes {\r\n    [key:string]: any;\r\n}\r\n\r\nexport interface Res<T extends KeyValueRes> {\r\n    [lang:string]: T | {[district:string]: T};\r\n}\r\n\r\nexport const resOptions:{\r\n\tlang: string;\r\n\t$lang: string;\r\n\tdistrict: string;\r\n\t$district: string;\r\n} = {\r\n\tlang: undefined,\r\n\t$lang: undefined,\r\n\tdistrict: undefined,\r\n\t$district: undefined,\r\n}\r\n\r\nexport function setResOptions(lang:string, district:string) {\r\n\tresOptions.lang = lang;\r\n\tresOptions.$lang = '$' + lang;\r\n    resOptions.district = district;\r\n    resOptions.$district = '$' + district;\r\n}\r\n\r\n(function() {\r\n    let lang: string, district: string;\r\n    let language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\r\n        || navigator.language; // ||   // All browsers\r\n    //navigator.userLanguage; // IE <= 10\r\n    if (!language) {\r\n        lang = 'zh';\r\n        district = 'CN';\r\n    }\r\n    else {\r\n        let parts = language.split('-');\r\n        lang = parts[0];\r\n        if (parts.length > 1) district = parts[1].toUpperCase();\r\n    }\r\n    setResOptions(lang, district);\r\n}());\r\n\r\nexport function resLang<T extends KeyValueRes>(res:Res<T>):T {\r\n    let {lang, district} = resOptions;\r\n    let ret:T = {} as T;\r\n    if (res === undefined) return ret;\r\n    _.merge(ret, res._);\r\n    let l = res[lang];\r\n    if (l === undefined) return ret;\r\n    _.merge(ret, l._);\r\n    let d = l[district];\r\n    if (d === undefined) return ret;\r\n    _.merge(ret, d);\r\n    let {entity} = ret;\r\n    if (entity !== undefined) {\r\n        for (let i in entity) {\r\n            entity[i.toLowerCase()] = entity[i];\r\n        }\r\n    }\r\n    return ret;\r\n}\r\n\r\nconst resGlobal:any = {};\r\nexport function setRes(target: any, res: any):(str:string)=>any {\r\n\tif (res === undefined) return;\r\n\tlet {$lang, $district} = resOptions;\r\n\t_.merge(target, res);\r\n\tif ($lang !== undefined) {\r\n\t\tlet l = res[$lang];\r\n\t\tif (l !== undefined) {\r\n\t\t\t_.merge(target, l);\r\n\t\t\tlet d = l[$district];\r\n\t\t\tif (d !== undefined) {\r\n\t\t\t\t_.merge(target, d);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn function(str:string) {\r\n\t\treturn target[str] || str;\r\n\t}\r\n}\r\nexport function setGlobalRes(res: any) {\r\n\tsetRes(resGlobal, res);\r\n}\r\nexport function t(str:string):any {\r\n\treturn resGlobal[str] || str;\r\n}\r\n","const ALPHABET = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\nconst ID_LENGTH = 8;\r\n\r\nexport function uid():string {\r\n    let len = ALPHABET.length;\r\n    let rtn = '';\r\n    for (let i = 0; i < ID_LENGTH; i++) {\r\n        rtn += ALPHABET.charAt(Math.floor(Math.random() * len));\r\n    }\r\n    return rtn;\r\n}\r\n","import _ from 'lodash';\r\nimport {observable, IObservableArray} from 'mobx';\r\nimport { PageItems } from '../tool';\r\nimport {Field, ArrFields} from './uqMan';\r\nimport {Entity} from './entity';\r\nimport { QueryQueryCaller, QueryPageCaller } from './caller';\r\n\r\nexport type QueryPageApi = (name:string, pageStart:any, pageSize:number, params:any) => Promise<string>;\r\n\r\nexport class QueryPager<T extends any> extends PageItems<T> {\r\n\tprivate query: Query;\r\n\tprivate $page: any;\r\n\tprotected idFieldName: any;\r\n    constructor(query: Query, pageSize?: number, firstSize?: number, itemObservable?:boolean) {\r\n        super(itemObservable);\r\n        this.query = query;\r\n        if (pageSize !== undefined) this.pageSize = pageSize;\r\n\t\tif (firstSize !== undefined) this.firstSize = firstSize;\r\n\t}\r\n\r\n\tsetReverse() {\r\n\t\tthis.appendPosition = 'head';\r\n\t}\r\n\r\n    protected async onLoad() {\r\n\t\tif (this.$page) return;\r\n        let {schema} = this.query;\r\n        if (schema === undefined) {\r\n\t\t\tawait this.query.loadSchema();\r\n\t\t\tschema = this.query.schema;\r\n\t\t}\r\n\t\tif (schema === undefined) return;\r\n\t\tlet $page = this.$page = (schema.returns as any[]).find(v => v.name === '$page');\r\n\t\tif ($page === undefined) return;\r\n\t\tthis.sortOrder = $page.order;\r\n\t\tlet fields = $page.fields;\r\n\t\tif (fields !== undefined) {\r\n\t\t\tlet field = fields[0];\r\n\t\t\tif (field) this.idFieldName = field.name;\r\n\t\t}\r\n    }\r\n\r\n    protected async loadResults(param:any, pageStart:number, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.query.page(param, pageStart, pageSize);\r\n\t\treturn ret;\r\n\t}\r\n\tprotected getPageId(item:T) {\r\n\t\tif (item === undefined) return;\r\n\t\tif (typeof item === 'number') return item;\r\n\t\tlet start = (item as any)[this.idFieldName];\r\n\t\tif (start === null) return;\r\n\t\tif (start === undefined) return;\r\n\t\tif (typeof start === 'object') {\r\n\t\t\tlet id = start.id;\r\n\t\t\tif (id !== undefined) return id;\r\n\t\t}\r\n\t\treturn start;\r\n\t}\r\n\tasync refreshItems(item:T) {\r\n\t\tlet index = this._items.indexOf(item);\r\n\t\tif (index < 0) return;\r\n\t\tlet startIndex:number;\r\n\t\tif (this.appendPosition === 'tail') {\r\n\t\t\tstartIndex = index - 1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstartIndex = index + 1;\r\n\t\t}\r\n\t\tlet pageStart = this.getPageId(this._items[startIndex]);\r\n\t\tlet pageSize = 1;\r\n        let ret = await this.load(\r\n\t\t\tthis.param, \r\n\t\t\tpageStart,\r\n\t\t\tpageSize);\r\n\t\tlet len = ret.length;\r\n\t\tif (len === 0) {\r\n\t\t\tthis._items.splice(index, 1);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet newItem = ret[i];\r\n\t\t\tif (!newItem) continue;\r\n\t\t\tlet newId = newItem[this.idFieldName];\r\n\t\t\tif (newId === undefined || newId === null) continue;\r\n\t\t\tif (typeof newId === 'object') newId = newId.id;\r\n\t\t\tlet oldItem = this._items.find(v => {\r\n\t\t\t\tlet oldId = (v as any)[this.idFieldName];\r\n\t\t\t\tif (oldId === undefined || oldId === null) return false;\r\n\t\t\t\tif (typeof oldId === 'object') oldId = oldId.id;\r\n\t\t\t\treturn oldId = newId;\r\n\t\t\t});\r\n\t\t\tif (oldItem) {\r\n\t\t\t\t_.merge(oldItem, newItem);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class UqQuery<P, R> extends Entity {\r\n    get typeName(): string { return 'query';}\r\n    private pageStart: any;\r\n    private pageSize:number;\r\n    private params:any;\r\n    private more: boolean;\r\n    private startField: Field;\r\n    @observable list:IObservableArray; // = observable.array([], {deep: false});\r\n    returns: ArrFields[];\r\n    isPaged: boolean;\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {returns} = schema;\r\n        //this.returns = returns;\r\n        this.isPaged = returns && (returns as any[]).find(v => v.name === '$page') !== undefined;\r\n    }\r\n\r\n    resetPage(size:number, params:any) {\r\n        this.pageStart = undefined;\r\n        this.pageSize = size;\r\n        this.params = params;\r\n        this.more = false;\r\n        this.list = undefined;\r\n    }\r\n    get hasMore() {return this.more;}\r\n    async loadPage():Promise<void> {\r\n        if (this.pageSize === undefined) {\r\n            throw new Error('call resetPage(size:number, params:any) first');\r\n        }\r\n        let pageStart:any;\r\n        if (this.pageStart !== undefined) {\r\n            switch (this.startField.type) {\r\n                default: pageStart = this.pageStart; break;\r\n                case 'date':\r\n                case 'time':\r\n                case 'datetime': pageStart = (this.pageStart as Date).getTime(); break;\r\n            }\r\n        }\r\n\t\tlet ret = await this.page(this.params, pageStart, this.pageSize+1);\r\n\t\tlet page = (ret as any).$page;\r\n        /*\r\n        await this.loadSchema();\r\n        let res = await this.tvApi.page(this.name, pageStart, this.pageSize+1, this.params);\r\n        let data = await this.unpackReturns(res);\r\n        let page = data['$page'] as any[];\r\n        */\r\n        this.list = observable.array([], {deep: false});\r\n        if (page !== undefined) {\r\n            if (page.length > this.pageSize) {\r\n                this.more = true;\r\n                page.pop();\r\n                let ret = this.returns.find(r => r.name === '$page');\r\n                this.startField = ret.fields[0];\r\n                this.pageStart = page[page.length-1][this.startField.name];\r\n            }\r\n            else {\r\n                this.more = false;\r\n            }\r\n            this.list.push(...page);\r\n        }\r\n        //this.loaded = true;\r\n    }\r\n\r\n    protected pageCaller(params: any, showWaiting: boolean = true): QueryPageCaller {\r\n        return new QueryPageCaller(this, params, showWaiting);\r\n    }\r\n\r\n    async page(params:P, pageStart:any, pageSize:number, showWaiting: boolean = true):Promise<R> {\r\n        let p = {pageStart, pageSize, params};\r\n        let res = await this.pageCaller(p, showWaiting).request();\r\n        return res;\r\n    }\r\n    protected queryCaller(params: P, showWaiting: boolean = true): QueryQueryCaller {\r\n        return new QueryQueryCaller(this, params, showWaiting);\r\n    }\r\n    async query(params:P, showWaiting:boolean = true):Promise<R> {\r\n        let res = await this.queryCaller(params, showWaiting).request();\r\n        return res;\r\n    }\r\n    async table(params:P, showWaiting:boolean = true): Promise<any[]> {\r\n        let ret = await this.query(params, showWaiting);\r\n        for (let i in ret) {\r\n            return (ret as any)[i];\r\n        }\r\n    }\r\n    async obj(params:P, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.table(params, showWaiting);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:P, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.obj(params, showWaiting);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nexport class Query extends UqQuery<any, any> {\r\n}\r\n","import { messageHub } from \"./messageHub\";\r\n\r\nlet subAppWindow:Window;\r\nfunction postWsToSubApp(msg:any) {\r\n    if (subAppWindow === undefined) return;\r\n    subAppWindow.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport function setSubAppWindow(win:Window) {\r\n    subAppWindow = win;\r\n}\r\n\r\nexport function postWsToTop(msg:any) {\r\n    window.top.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport abstract class WsBase {\r\n\tprivate messageHub = messageHub;\r\n\t/*\r\n    wsBaseId:string;\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n\tprivate msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n\t*/\r\n\t/*\r\n    onWsReceiveAny(handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.anyHandlers[seed] = handler;\r\n        return seed;\r\n    }\r\n    onWsReceive(type:string, handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.msgHandlers[seed] = {type:type, handler: handler};\r\n        return seed;\r\n    }\r\n    endWsReceive(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n\t}\r\n\t*/\r\n    async receive(msg:any) {\r\n\t\tthis.messageHub.dispatch(msg);\r\n\t\t/*\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n\t\t}\r\n\t\t*/\r\n    }\r\n}\r\n\r\nlet wsBaseSeed = 1;\r\nexport class WsBridge extends WsBase {\r\n    wsBaseId:string = 'WsBridge seed ' + wsBaseSeed++;\r\n}\r\n\r\nexport const wsBridge = new WsBridge();\r\n\r\nexport class WSChannel extends WsBase {\r\n    wsBaseId:string = 'WSChannel seed ' + wsBaseSeed++;\r\n    static centerToken:string;\r\n    private wsHost: string;\r\n    private token: string;\r\n    private ws: WebSocket;\r\n\r\n    constructor(wsHost: string, token: string) {\r\n        super();\r\n        this.wsHost = wsHost;\r\n        this.token = token;\r\n    }\r\n\r\n    static setCenterToken(token?: string) {\r\n        WSChannel.centerToken = token;\r\n    }\r\n    \r\n    connect():Promise<void> {\r\n        //this.wsHost = wsHost;\r\n        //this.token = token || WSChannel.centerToken;\r\n        if (this.ws !== undefined) return;\r\n        let that = this;\r\n        return new Promise((resolve, reject) => {\r\n            let ws = new WebSocket(this.wsHost, this.token || WSChannel.centerToken);\r\n            console.log('connect webSocket %s', this.wsHost);\r\n            ws.onopen = (ev) => {\r\n                console.log('webSocket connected %s', this.wsHost);\r\n                that.ws = ws;\r\n                resolve();\r\n            };\r\n            ws.onerror = (ev) => {\r\n                reject('webSocket can\\'t open!');\r\n            };\r\n            ws.onmessage = async (msg) => await that.wsMessage(msg);\r\n            ws.onclose = (ev) => {\r\n                that.ws = undefined;\r\n                console.log('webSocket closed!');\r\n            }\r\n        });\r\n    }\r\n    close() {\r\n        if (this.ws !== undefined) {\r\n            this.ws.close();\r\n            this.ws = undefined;\r\n        }\r\n    }\r\n    private async wsMessage(event:any):Promise<void> {\r\n        try {\r\n            console.log('websocket message: %s', event.data);\r\n            let msg = JSON.parse(event.data);\r\n            postWsToSubApp(msg);\r\n            await this.receive(msg);\r\n        }\r\n        catch (err) {\r\n            console.log('ws msg error: ', err);\r\n        }\r\n    }\r\n    sendWs(msg:any) {\r\n        let netThis = this;\r\n        this.connect().then(() => {\r\n            netThis.ws.send(msg);\r\n        });\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { nav } from './nav';\r\n\r\nexport interface ImageProps {\r\n    src: string;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    altImage?: string;\r\n}\r\n\r\n// src = .src, 表示fontawesome Icon\r\nexport function Image(props: ImageProps) {\r\n\tlet {className, style, src, altImage} = props;\r\n\tlet icon:string;\r\n    if (src) {\r\n\t\tif (src.indexOf('.') !== 0) {\r\n\t\t\tif (src.startsWith(':') === true) {\r\n\t\t\t\tsrc = nav.resUrl + src.substr(1);\r\n\t\t\t}\r\n\t\t\treturn <img src={src} className={className} alt=\"img\"\r\n\t\t\t\tstyle={style}\r\n\t\t\t\tonError={evt=>{\r\n\t\t\t\t\tif (altImage) evt.currentTarget.src=altImage;\r\n\t\t\t\t\telse evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n\t\t\t\t}} />;\r\n\t\t}\r\n\t\ticon = src.substr(1);\r\n\t}\r\n\telse {\r\n\t\ticon = 'file-o'\r\n\t}\r\n\treturn <span className={classNames(className, 'image-none')} style={style}>\r\n\t\t<i className={'fa fa-' + icon} />\r\n\t</span>;\r\n}\r\n","import jwtDecode from 'jwt-decode';\r\n\r\nexport interface Unit {\r\n    id: number;\r\n    name: string;\r\n}\r\n\r\nexport interface Guest {\r\n    id: number;             // id = 0\r\n    guest: number;\r\n    token: string;\r\n}\r\n\r\nexport interface User extends Guest {\r\n    id: number;\r\n    name: string;\r\n    nick?: string;\r\n    icon?: string;\r\n}\r\n\r\nexport function decodeUserToken(token: string): User {\r\n    let ret:any = jwtDecode(token);\r\n    let user: User = {\r\n        id: ret.id,\r\n        name: ret.name,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return user;\r\n}\r\n\r\nexport function decodeGuestToken(token: string): Guest {\r\n    let ret:any = jwtDecode(token);\r\n    let guest: Guest = {\r\n        id: 0,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return guest;\r\n}\r\n","import { env } from '../tool';\r\n\r\nconst centerHost = process.env['REACT_APP_CENTER_HOST'];\r\nconst centerDebugHost = 'localhost:3000'; //'192.168.86.64';\r\nconst resHost = process.env['REACT_APP_RES_HOST'] || centerHost;\r\nconst resDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugBuilderHost = 'localhost:3009';\r\ninterface HostValue {\r\n    value: string;\r\n\tlocal: boolean;\r\n}\r\nconst hosts:{[name:string]:HostValue} = {\r\n    centerhost: {\r\n        value: process.env['REACT_APP_CENTER_DEBUG_HOST'] || centerDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    reshost: {\r\n        value: process.env['REACT_APP_RES_DEBUG_HOST'] || resDebugHost,\r\n\t\tlocal: false,\r\n    },\r\n    uqhost: {\r\n        value: process.env['REACT_APP_UQ_DEBUG_HOST'] || uqDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    unitxhost: {\r\n        value: process.env['REACT_APP_UQ_DEBUG_HOST'] || uqDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    \"uq-build\": {\r\n        value: process.env['REACT_APP_UQ_DEBUG_BUILDER_HOST'] || uqDebugBuilderHost, \r\n\t\tlocal: false,\r\n    }\r\n}\r\n\r\nconst httpArr = ['https://', 'http://'];\r\nfunction isAbsoluteUrl(url:string):boolean {\r\n    for (let str of httpArr) {\r\n        if (url.startsWith(str) === true) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction urlFromHost(host:string):string {\r\n    if (isAbsoluteUrl(host) === true) {\r\n        if (host.endsWith('/')) return host;\r\n        return host + '/';\r\n    }\r\n    return `http://${host}/`;\r\n}\r\n\r\nfunction centerUrlFromHost(host:string):string {\r\n    return urlFromHost(host);\r\n}\r\nfunction centerWsFromHost(host:string) {\r\n    let https = 'https://';\r\n    if (host.startsWith(https) === true) {\r\n        host = host.substr(https.length);\r\n        if (host.endsWith('/') === true) host = host.substr(0, host.length-1);\r\n        return 'wss://' + host + '/tv/';\r\n    }\r\n    return `ws://${host}/tv/`\r\n}\r\nexport function resUrlFromHost(host:string) {\r\n\tif (!host) return;\r\n    let url = urlFromHost(host);\r\n    return url + 'res/';\r\n}\r\n\r\nconst fetchOptions = {\r\n    method: \"GET\",\r\n    mode: \"no-cors\", // no-cors, cors, *same-origin\r\n    headers: {\r\n        \"Content-Type\": \"text/plain\"\r\n    },\r\n};\r\n\r\nclass Host {\r\n    testing: boolean;\r\n    url: string;\r\n    ws: string;\r\n    resHost: string;\r\n\r\n    async start(testing:boolean) {\r\n\t\tif (!centerHost) debugger;\r\n        this.testing = testing;\r\n        if (env.isDevelopment === true) {\r\n            await this.tryLocal();\r\n        }\r\n        let host = this.getCenterHost();\r\n        this.url = centerUrlFromHost(host);\r\n        this.ws = centerWsFromHost(host);\r\n\t\tthis.resHost = this.getResHost();\r\n    }\r\n\r\n    private debugHostUrl(host:string) {return `http://${host}/hello`}\r\n    private async tryLocal() {\r\n        let promises:PromiseLike<any>[] = [];\r\n        let hostArr:string[] = [];\r\n        for (let i in hosts) {\r\n            let hostValue = hosts[i];\r\n            let {value} = hostValue;\r\n            if (hostArr.findIndex(v => v === value) < 0) hostArr.push(value);\r\n        }\r\n\r\n        for (let host of hostArr) {\r\n            let fetchUrl = this.debugHostUrl(host);\r\n            promises.push(localCheck(fetchUrl));\r\n        }\r\n        let results = await Promise.all(promises);\r\n        let len = hostArr.length;\r\n        for (let i=0; i<len; i++) {\r\n            let local = results[i];\r\n            let host = hostArr[i];\r\n            for (let j in hosts) {\r\n                let hostValue = hosts[j];\r\n                if (hostValue.value === host) {\r\n                    hostValue.local = local;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private getCenterHost():string {\r\n        let {value, local} = hosts.centerhost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return centerHost;\r\n    }\r\n\r\n    private getResHost():string {\r\n        let {value, local} = hosts.reshost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return resHost;\r\n    }\r\n\r\n    getUrlOrDebug(url:string, debugHost:string = 'uqhost'):string {\r\n        if (env.isDevelopment === false) return url;\r\n        let host = hosts[debugHost];\r\n        if (host === undefined) return url;\r\n        let {value, local} = host;\r\n        if (local === false) return url;\r\n        return `http://${value}/`;\r\n    }\r\n    getUrlOrTest(db:string, url:string, urlTest:string):string {\r\n\t\tlet path:string;\r\n\t\tif (!urlTest) {\r\n\t\t\turlTest = url;\r\n\t\t\tif (!urlTest) {\r\n\t\t\t\tconsole.error('no server set for ' + db);\r\n\t\t\t\tdebugger;\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (!url) {\r\n\t\t\turl = urlTest;\r\n\t\t\tthis.testing = true\r\n\t\t}\r\n        if (this.testing === true) {\r\n            if (urlTest !== '-') url = urlTest;\r\n            path = 'uq/test/' + db + '/';\r\n        }\r\n        else {\r\n            path = 'uq/prod/' + db + '/';\r\n        }\r\n\t\turl = this.getUrlOrDebug(url);\r\n\t\tif (url.endsWith('/') === false) {\r\n\t\t\turl += '/';\r\n\t\t}\r\n        return url + path;\r\n    }\r\n\r\n    async localCheck(urlDebug: string):Promise<boolean> {\r\n        return await localCheck(urlDebug);\r\n    }\r\n}\r\n\r\nexport const host:Host = new Host();\r\n\r\n// 因为测试的都是局域网服务器，甚至本机服务器，所以一秒足够了\r\n// 网上找了上面的fetch timeout代码。\r\n// 尽管timeout了，fetch仍然继续，没有cancel\r\n\r\n// 实际上，一秒钟不够。web服务器会自动停。重启的时候，可能会比较长时间。也许两秒甚至更多。\r\n//const timeout = 2000;\r\nconst timeout = 2000;\r\n\r\nfunction fetchLocalCheck(url:string):Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n      fetch(url, fetchOptions as any)\r\n      .then(v => {\r\n          v.text().then(resolve).catch(reject);\r\n      })\r\n      .catch(reject);\r\n      const e = new Error(\"Connection timed out\");\r\n      env.setTimeout('fetchLocalCheck', reject, timeout, e);\r\n    });\r\n}\r\n\r\nasync function localCheck(url:string):Promise<boolean> {\r\n    try {\r\n\t\tawait fetchLocalCheck(url);\r\n        return true;\r\n    }\r\n    catch (err) {\r\n        return false;\r\n    }\r\n}\r\n\r\n/*\r\nexport interface IUqForChannel {\r\n    uq: string;\r\n    uqVersion: number;\r\n}\r\n*/","export * from './form';\r\nexport * from './multiStep';","import React from 'react';\r\nimport { PageHeaderProps } from './pageHeader';\r\n\r\nconst scrollAfter = 20; // 20ms之后，scroll执行\r\nexport class Scroller {\r\n    private el: HTMLBaseElement;\r\n    constructor(el: HTMLBaseElement) {\r\n        this.el = el;\r\n    }\r\n\r\n    scrollToTop():void {\r\n        setTimeout(() => this.el.scrollTo(0, 0), scrollAfter);\r\n    }\r\n    scrollToBottom():void {\r\n        setTimeout(() => this.el.scrollTo(0, this.el.scrollTop + this.el.offsetHeight), scrollAfter);\r\n    }\r\n}\r\n\r\nexport interface ScrollProps {\r\n    onScroll?: (e:any) => void;\r\n    onScrollTop?: (scroller: Scroller) => Promise<boolean>;\r\n\tonScrollBottom?: (scroller: Scroller) => Promise<void>;\r\n\tclassName?: string;\r\n}\r\ninterface ScrollViewProps extends ScrollProps {\r\n\tclassName?: string;\r\n\tstyle?: React.CSSProperties;\r\n}\r\nconst scrollTimeGap = 100;\r\nabstract class ScrollViewBase<T extends ScrollViewProps> extends React.Component<T, null> {\r\n    private bottomTime:number = 0;\r\n\tprivate topTime:number = 0;\r\n\tprivate div: HTMLDivElement;\r\n\r\n\tprotected refDiv = (div:HTMLDivElement) => {\r\n\t\tif (!div) {\r\n\t\t\tif (this.div) {\r\n\t\t\t\tthis.div.removeEventListener('resize', this.onResize)\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.div = div;\r\n\t\tthis.div.addEventListener('resize', this.onResize);\r\n\t}\r\n\r\n\tprivate onResize = (ev:UIEvent) => {\r\n\t\tconsole.error('div resize');\r\n\t};\r\n\r\n    protected onScroll = async (e:any) => {\r\n        let {onScroll, onScrollTop, onScrollBottom} = this.props;\r\n        if (onScroll) onScroll(e);\r\n        let el = e.target as HTMLBaseElement;\r\n        let scroller = new Scroller(el);\r\n        if (el.scrollTop < 30) {\r\n            if (onScrollTop !== undefined) {\r\n                let topTime = new Date().getTime();\r\n                if (topTime-this.topTime > scrollTimeGap) {\r\n                    this.topTime = topTime;\r\n\t\t\t\t\tonScrollTop(scroller).then(ret => {\r\n\t\t\t\t\t\t // has more\r\n\t\t\t\t\t\tif (ret === true) {\r\n\t\t\t\t\t\t\tlet sh = el.scrollHeight;\r\n\t\t\t\t\t\t\tlet top = 200;\r\n\t\t\t\t\t\t\tif (top > sh) top = sh;\r\n\t\t\t\t\t\t\tel.scrollTop = top;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n                }\r\n            }\r\n        }\r\n        if (el.scrollTop + el.offsetHeight > el.scrollHeight - 30) {\r\n            //this.eachChild(this, 'bottom');\r\n            if (onScrollBottom !== undefined) {\r\n                let bottomTime = new Date().getTime();\r\n                if (bottomTime - this.bottomTime > scrollTimeGap) {\r\n                    this.bottomTime = bottomTime;\r\n                    onScrollBottom(scroller);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    private eachChild(c:any, direct:'top'|'bottom') {\r\n        let { props } = c;\r\n        if (props === undefined)\r\n            return;\r\n        let { children } = props;\r\n        if (children === undefined)\r\n            return;\r\n        React.Children.forEach(children, (child, index) => {\r\n            let {_$scroll} = child as any;\r\n            if (_$scroll) _$scroll(direct);\r\n            console.log(child.toString());\r\n            this.eachChild(child, direct);\r\n        });\r\n\t}\r\n}\r\n\r\nexport class ScrollView extends ScrollViewBase<ScrollViewProps> {\r\n    render() {\r\n\t\tlet {className, style} = this.props;\r\n\t\treturn <div ref={this.refDiv} className=\"tv-page\"\r\n\t\t\tonScroll={this.onScroll} style={style}>\r\n\t\t\t<article className={className}>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</article>\r\n\t\t</div>;\r\n    }\r\n}\r\n\r\nexport interface PageWebNav {\r\n\tnavHeader?: JSX.Element; \r\n\tnavRawHeader?: JSX.Element; \r\n\tnavFooter?: JSX.Element; \r\n\tnavRawFooter?: JSX.Element; \r\n\trenderPageHeader?: (props:PageHeaderProps)=>JSX.Element;\r\n}\r\ninterface WebNavScrollViewProps extends ScrollViewProps {\r\n\twebNav: PageWebNav;\r\n}\r\n\r\nexport class WebNavScrollView extends ScrollViewBase<WebNavScrollViewProps> {\r\n    render() {\r\n\t\tlet {className, style, webNav} = this.props;\r\n\t\tlet {navHeader, navRawHeader, navFooter, navRawFooter} = webNav;\r\n\t\tlet vHeader:any, vFooter:any;\r\n\t\tif (navRawHeader) vHeader = navRawHeader;\r\n\t\telse if (navHeader) vHeader = <header><main>{navHeader}</main></header>\r\n\t\tif (navRawFooter) vFooter = navRawFooter;\r\n\t\telse if (navFooter) vFooter = <footer><main>{navFooter}</main></footer>\r\n\r\n\t\treturn <div ref={this.refDiv} className=\"tv-page-webnav\"\r\n\t\t\tonScroll={this.onScroll} style={style}>\r\n\t\t\t{vHeader}\r\n\t\t\t<article className={className}>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</article>\r\n\t\t\t{vFooter}\r\n\t\t</div>;\r\n    }\r\n}\r\n","import { Entity } from './entity';\r\nimport { ActionCaller } from './caller';\r\n\r\nexport class UqAction<P, R> extends Entity {\r\n    get typeName(): string { return 'action';}\r\n    async submit(data:P, waiting: boolean = true) {\r\n\t\tlet caller = new ActionSubmitCaller(this, data)\r\n\t\tlet ret = await caller.request();\r\n\t\treturn ret;\r\n    }\r\n    async submitReturns(data:P):Promise<R> {\r\n       return await new SubmitReturnsCaller(this, data).request();\r\n    }\r\n    async submitConvert(data:P) {\r\n        return await new SubmitConvertCaller(this, data).request();\r\n    }\r\n}\r\n\r\nexport class Action extends UqAction<any, any> {\r\n}\r\n\r\nexport class ActionSubmitCaller extends ActionCaller {\r\n    get path():string {return 'action/' + this.entity.name;}\r\n    buildParams():any {\r\n\t\treturn {data: this.entity.pack(this.params)}\r\n\t}\r\n}\r\n\r\nclass SubmitReturnsCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action/' + this.entity.name + '/returns';}\r\n    xresult(res:any):any {\r\n        let {returns} = this.entity;\r\n        let len = returns.length;\r\n        let ret:{[r:string]:any[]} = {};\r\n        for (let i=0; i<len; i++) {\r\n            let retSchema = returns[i];\r\n            ret[retSchema.name] = res[i];\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass SubmitConvertCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action-convert/' + this.entity.name;}\r\n    buildParams():any {\r\n        return {\r\n            data: this.params\r\n        };\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-badge.css';\r\n\r\nexport interface BadgeProps {\r\n    className?: string;\r\n    badge?: string|number;\r\n    size?: 'xs' | 'sm' | 'lg';\r\n    color?: 'secondary'|'success'|'danger'|'primary'|'info'|'warning';\r\n    badgeAlign?: 'left'|'center'|'right';\r\n    badgeVertical?: 'top'|'middle'|'bottom';\r\n}\r\n\r\n@observer\r\nexport class Badge extends React.Component<BadgeProps> {\r\n    render() {\r\n        let {className, badge, size, color, badgeAlign, badgeVertical, children} = this.props;\r\n        let cn = classNames(\r\n            className,\r\n            'va-badge',\r\n            size && 'va-badge-'+size,\r\n            'va-badge-' + (color||'secondary'),\r\n            badgeAlign && 'va-badg-'+badgeAlign,\r\n            badgeVertical && 'va-badg-'+badgeVertical,\r\n        );\r\n        let b;\r\n        if (badge) b = <b>{badge}</b>;\r\n        return <div className={cn}>\r\n            {children}\r\n            {b}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-lmr.css';\r\n\r\nexport interface LMRProps {\r\n    className?: string | string[];\r\n    left?: string|JSX.Element;\r\n    right?: string|JSX.Element;\r\n    onClick?: ()=>void;\r\n}\r\n\r\n@observer\r\nexport class LMR extends React.Component<LMRProps> {\r\n    render() {\r\n        let {className, left, children, right, onClick} = this.props;\r\n        let l, r;\r\n        if (left !== undefined) l = <header>{left}</header>;\r\n        if (right !== undefined) r = <footer>{right}</footer>;\r\n        let cursor;\r\n        if (onClick !== undefined) cursor = 'cursor-pointer';\r\n        return <div className={classNames('va-lmr', className, cursor)} onClick={onClick}>\r\n            {l}\r\n            <div>{children}</div>\r\n            {r}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface FAProps {\r\n    name: string;\r\n    className?: string;\r\n    size?: 'lg'|'2x'|'3x'|'4x'|'5x';\r\n    spin?: boolean;\r\n    fixWidth?: boolean;\r\n    border?: boolean;\r\n    pull?: 'left'|'right';\r\n    pulse?: boolean;\r\n    rotate?: 90|180|270;\r\n    flip?: 'horizontal'|'vertical';\r\n    inverse?: boolean;\r\n}\r\n\r\nexport class FA extends React.Component<FAProps> {\r\n    render() {\r\n        let {name, className, size, spin, fixWidth, border, pull, pulse, rotate, flip, inverse} = this.props;\r\n        let cn = classNames(className, 'fa',\r\n            name && ('fa-' + name),\r\n            size && 'fa-'+size,\r\n            fixWidth && 'fa-fw',\r\n            border && 'fa-border',\r\n            pull && 'fa-pull-' + pull,\r\n            spin && 'fa-spin',\r\n            pulse && 'fa-pulse',\r\n            rotate && 'fa-rotate-' + rotate,\r\n            flip && 'fa-flip-' + flip,\r\n            inverse && 'fa-inverse',\r\n        );\r\n        return <i className={cn} />\r\n    }\r\n}\r\n\r\nexport interface StackedFAProps {\r\n    className?: string;\r\n    size?: 'lg',\r\n}\r\nexport class StackedFA extends React.Component<StackedFAProps> {\r\n    render() {\r\n        let {className, size, children} = this.props;\r\n        let cn = classNames(\r\n            'fa-stack',\r\n            className,\r\n            size && 'fa-' + size);\r\n        return <span className={cn}>\r\n            {children}\r\n        </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport const Muted = (props:any) => \r\n<small className={classNames('text-muted', props.className)} style={props.style}>\r\n    {props.children}\r\n</small>;\r\n","import * as React from 'react';\r\nimport {FA} from './FA';\r\n\r\nexport interface IconTextProps {\r\n    icon: string;\r\n    iconClass?: string;\r\n    text: string;\r\n    textClass?: string;\r\n}\r\n\r\nexport class IconText extends React.Component<IconTextProps> {\r\n    render() {\r\n        let {icon, iconClass, text, textClass} = this.props;\r\n        return <div className=\"py-2\">\r\n            <FA className={iconClass} name={icon} fixWidth={true} />\r\n            <span className={textClass}>{text}</span>\r\n        </div>;\r\n    }\r\n}\r\n","import _ from 'lodash';\r\n\r\nclass _LocalStorage {\r\n    getItem(key:string) {\r\n        return localStorage.getItem(key)\r\n    }\r\n    setItem(key:string, value:string) {\r\n        localStorage.setItem(key, value);\r\n    }\r\n    removeItem(key:string) {\r\n        localStorage.removeItem(key);\r\n    }\r\n}\r\n\r\nconst __ls = new _LocalStorage(); // new Ls;\r\n\r\nexport class LocalCache {\r\n    private readonly local: Local;\r\n    //private value: T;\r\n    readonly key: string|number;\r\n\r\n    constructor(local:Local, key:string|number) {\r\n        this.local = local;\r\n        this.key = key;\r\n    }\r\n    get():any {\r\n        try {\r\n            // 下面缓冲的内容不能有，可能会被修改，造成circular引用\r\n            //if (this.value !== undefined) return this.value;\r\n            let text = this.local.getItem(this.key);\r\n            if (text === null) return;\r\n            if (text === undefined) return undefined;\r\n            //return this.value = \r\n            return JSON.parse(text);\r\n        }\r\n        catch (err) {\r\n            this.local.removeItem(this.key);\r\n            return;\r\n        }\r\n    }\r\n    set(value:any) {\r\n\t\tlet t = JSON.stringify(value, (key, value) => {\r\n\t\t\tif (key !== '_tuid') return value;\r\n\t\t});\r\n\t\tthis.local.setItem(this.key, t);\r\n    }\r\n    remove(local?:Local) {\r\n        if (local === undefined) {\r\n            this.local.removeItem(this.key);\r\n        }\r\n        else {\r\n            this.local.removeLocal(local);\r\n        }\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        return this.local.child(key);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        return this.local.arr(key);\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        return this.local.map(key);\r\n    }\r\n}\r\n\r\nabstract class Local {\r\n    private readonly caches: {[key:string]:LocalCache};\r\n    private readonly locals: {[key:string]:Local};\r\n    protected readonly name: string;\r\n    constructor(name: string) {\r\n        this.name = name;\r\n        this.caches = {};\r\n        this.locals = {};\r\n    }\r\n\r\n    protected abstract keyForGet(key:string|number):string;\r\n    protected abstract keyForSet(key:string|number):string;\r\n    protected abstract keyForRemove(key:string|number):string;\r\n    abstract removeAll():void;\r\n    getItem(key:string|number):string {\r\n        let k = this.keyForGet(key);\r\n        if (k === undefined) return;\r\n        return __ls.getItem(k);\r\n    }\r\n    setItem(key:string|number, value: string):void {\r\n        let k = this.keyForSet(key);\r\n        __ls.setItem(k, value);\r\n    }\r\n    removeItem(key:string|number):void {\r\n        let k = this.keyForSet(key);\r\n        if (k === undefined) return;\r\n        localStorage.removeItem(k);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        let sk = String(key);\r\n        let arr = this.locals[sk] as LocalArr;\r\n        if (arr === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = arr = new LocalArr(k);\r\n        }\r\n        return arr;\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        let sk = String(key);\r\n        let map = this.locals[sk] as LocalMap;\r\n        if (map === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = map = new LocalMap(k);\r\n        }\r\n        return map;\r\n    }\r\n    removeLocal(local:Local) {\r\n        let sk = local.name;\r\n        let k = this.keyForRemove(sk);\r\n        if (k === undefined) return;\r\n        let arr = this.locals[sk];\r\n        if (arr === undefined) arr = new LocalArr(k);\r\n        else this.locals[sk] = undefined;\r\n        arr.removeAll();\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        let ks = String(key);\r\n        let ret = this.caches[ks];\r\n        if (ret !== undefined) return ret;\r\n        return this.caches[ks] =ret = new LocalCache(this, key);\r\n    }\r\n}\r\n\r\nconst maxArrSize = 500;\r\nexport class LocalArr extends Local {\r\n    private readonly index: number[];\r\n    constructor(name: string) {\r\n        super(name);\r\n        let index = __ls.getItem(this.name);\r\n        this.index = index === null? [] : index.split('\\n').map(v => Number(v));\r\n    }\r\n    private saveIndex() {\r\n        __ls.setItem(this.name, this.index.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i < 0) return undefined;\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i<0) {\r\n            this.index.unshift(key);\r\n            if (this.index.length > maxArrSize) this.index.pop();\r\n        }\r\n        else {\r\n            this.index.splice(i, 1);\r\n            this.index.unshift(key)\r\n        }\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForRemove(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i<0) return;\r\n        this.index.splice(i, 1);\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i of this.index) {\r\n            __ls.removeItem(`${this.name}.${i}`);\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.index.splice(0);\r\n    }\r\n    item(index:number):LocalCache {\r\n        return this.child(index);\r\n    }\r\n}\r\n\r\nexport class LocalMap extends Local {\r\n    private readonly index: {[key:string]:number};\r\n    private max: number;\r\n    constructor(name: string) {\r\n        super(name);\r\n        this.max = 0;\r\n        this.index = {};\r\n        let index = __ls.getItem(this.name);\r\n        if (index !== null) {\r\n            let ls = index.split('\\n');\r\n            ls.forEach(l => {\r\n                let p = l.indexOf('\\t');\r\n                if (p<0) return;\r\n                let key = l.substr(0, p);\r\n                let i = Number(l.substr(p+1));\r\n                if (isNaN(i) === true) return;\r\n                this.index[key] = i;\r\n                if (i>this.max) this.max = i;\r\n            });\r\n        }\r\n    }\r\n    private saveIndex() {\r\n        let ls:string[] = [];\r\n        for (let k in this.index) {\r\n            let v = this.index[k];\r\n            if (v === undefined) continue;\r\n            ls.push(`${k}\\t${v}`);\r\n        }\r\n        __ls.setItem(this.name, ls.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) return undefined;\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) {\r\n            ++this.max;\r\n            i = this.max;\r\n            this.index[key] = i;\r\n            this.saveIndex();\r\n        }\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForRemove(key:string|number):string {\r\n        let i = this.index[key];\r\n        if (i===undefined) return;\r\n        this.index[key] = undefined;\r\n        this.saveIndex();\r\n        return `${this.name}.${i}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i in this.index) {\r\n            __ls.removeItem(`${this.name}.${this.index[i]}`);\r\n            this.index[i] = undefined;\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.max = 0;\r\n    }\r\n    item(key:string):LocalCache {\r\n        return this.child(key);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { BoxId } from './boxId';\r\nimport { Tuid } from './tuid';\r\nimport { observer } from 'mobx-react';\r\n\r\nconst TuidContent = (tuidName:string, values:any, x?:any) => {\r\n    return <>{tuidName}: {uqStringify(values)}</>;\r\n};\r\n\r\nexport function uqStringify(values: any): string {\r\n    let s = '{';\r\n    if (values === undefined) return 'undefined';\r\n    for (let i in values) {\r\n        let v = values[i];\r\n        s += i + ': ';\r\n        if (v === undefined) {\r\n            s += 'undefined';\r\n        }\r\n        else if (v === null) {\r\n            s += 'null';\r\n        }\r\n        else {\r\n            switch (typeof v) {\r\n                default:\r\n                    s += v;\r\n                    break;\r\n                case 'function':\r\n                    s += 'function';\r\n                    break;\r\n                case 'object':\r\n                    s += '{obj}';\r\n                    break;\r\n            }\r\n        }\r\n        s += ', ';\r\n    }\r\n    return s + '}';\r\n}\r\n\r\nexport class ReactBoxId implements BoxId {\r\n    readonly id: number;\r\n    protected tuid: Tuid;\r\n    protected ui: (values:any) => JSX.Element;\r\n    readonly isUndefined:boolean;\r\n    constructor(id: number, tuid: Tuid, ui: (values:any) => JSX.Element) {\r\n        this.id = Number(id);\r\n        this.tuid = tuid;\r\n        this.ui = ui;\r\n        this.isUndefined = (this.tuid === undefined);\r\n    }\r\n\r\n    get obj():any {\r\n        return this.tuid.valueFromId(this.id);\r\n    }\r\n\r\n    equ(id:BoxId|number): boolean {\r\n        if (id === undefined || id === null) return false;\r\n        if (typeof id === 'object') return this.id === id.id;\r\n        return this.id === id;\r\n    }\r\n\r\n    render(ui:TvTemplet, x:any):JSX.Element {\r\n        if (this.id === undefined || this.id === null || isNaN(this.id) === true) return;\r\n        let boxName = this.boxName; // this.tuid.name;\r\n        let val = this.obj; // this.tuid.valueFromId(this.id);\r\n        if (this.isUndefined === true) {\r\n            if (ui !== undefined) return ui(val, x);\r\n            return TuidContent(boxName, val, x);\r\n        }\r\n        switch (typeof val) {\r\n            case 'undefined':\r\n                return <span className=\"text-black-50\">{boxName} undefined</span>;\r\n            case 'number':\r\n                return <span className=\"text-light\">{boxName} {this.id}</span>;\r\n        }\r\n        if (ui === undefined) {\r\n            ui = this.ui;\r\n        }\r\n        if (ui !== undefined) {\r\n            if (typeof ui !== 'function') {\r\n                ui = (ui as any).content;\r\n            }\r\n            if (ui !== undefined) {\r\n                let ret = ui(val/*, this.tuidUR.res*/);\r\n                if (ret !== undefined) return ret;\r\n                return <span className=\"text-danger\">{boxName} {this.id}</span>;\r\n            }\r\n        }\r\n\r\n        return TuidContent(boxName, val);\r\n    }\r\n\r\n    get boxName():string {return this.tuid.name}\r\n    // ui(): TvTemplet {return this.tuid.ui}\r\n    // res(): any {return this.tuid.res}\r\n\r\n    async assure(): Promise<BoxId> {\r\n        await this.tuid.assureBox(this.id);\r\n        return this;\r\n    }\r\n}\r\n\r\nfunction boxIdContent(bi: number|BoxId, ui:TvTemplet, x:any) {\r\n    let logContent:any;\r\n    let boxId:ReactBoxId = bi as ReactBoxId;\r\n    switch(typeof bi) {\r\n        case 'undefined': logContent = <>boxId undefined</>; break;\r\n        case 'number': logContent = <>id:{bi}</>; break;\r\n        default:\r\n            if (typeof boxId.render !== 'function') {\r\n                if (ui === undefined) {\r\n                    logContent = TuidContent(boxId.boxName, bi, x);\r\n                }\r\n                else {\r\n                    return ui(bi, x);\r\n                }\r\n            }\r\n            break;\r\n    }\r\n    if (logContent !== undefined) {\r\n        return <del className=\"text-danger\">{logContent}</del>;\r\n    }\r\n    return boxId.render(ui, x);\r\n}\r\n\r\nexport type TvTemplet = (values?:any, x?:any) => JSX.Element;\r\n\r\ninterface Props {\r\n    tuidValue: number|BoxId, \r\n    ui?: TvTemplet,\r\n    x?: any,\r\n    nullUI?: ()=>JSX.Element\r\n}\r\n\r\nconst Tv = observer(({tuidValue, ui, x, nullUI}:Props) => {\r\n    if (tuidValue === undefined) {\r\n        if (nullUI === undefined) return <small className=\"text-muted\">[无]</small>;\r\n        return nullUI();\r\n    }\r\n    if (tuidValue === null) {\r\n        if (nullUI === undefined) return <>[null]</>;\r\n        return nullUI();\r\n    }\r\n    let ttv = typeof tuidValue;\r\n    switch (ttv) {\r\n        default:\r\n            if (ui === undefined)\r\n                return <>{ttv}-{tuidValue}</>;\r\n            else {\r\n                let ret = ui(tuidValue, x);\r\n                if (ret !== undefined) return ret;\r\n                return <>{tuidValue}</>;\r\n            }\r\n        case 'object':\r\n            let divObj = boxIdContent(tuidValue, ui, x);\r\n            if (divObj !== undefined) return divObj;\r\n            return nullUI === undefined? <>id null</>: nullUI();\r\n        case 'number':\r\n            return <>id...{tuidValue}</>;\r\n    }\r\n});\r\n\r\nexport const tv = (tuidValue:number|BoxId, ui?:TvTemplet, x?:any, nullUI?:()=>JSX.Element):JSX.Element => {\r\n    return <Tv tuidValue={tuidValue} ui={ui} x={x} nullUI={nullUI} />;\r\n};\r\n","import * as React from 'react';\r\n\r\nexport function Loading() {\r\n    return <div className=\"d-flex h-100 align-items-center justify-content-center\">\r\n        <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />\r\n    </div>;\r\n}\r\n","import * as React from 'react';\r\nimport {observable, computed} from 'mobx';\r\nimport {FormView} from '../formView';\r\nimport {Field} from '../field';\r\nimport {Face} from '../face';\r\nimport {Rule} from '../rule';\r\n\r\nexport abstract class ControlBase {\r\n    protected formView: FormView;\r\n    constructor(formView:FormView) {\r\n        this.formView = formView;\r\n    }\r\n    render():JSX.Element {\r\n        return <div className=\"col-sm-10\">\r\n            {this.renderControl()}\r\n        </div>;\r\n    }\r\n    protected abstract renderControl():JSX.Element;\r\n    @computed get hasError():boolean {return false;}\r\n    @computed get filled():boolean {return false;}\r\n    clear() {}\r\n    clearErrors() {}\r\n    readValues(values:any):any {}\r\n    setError(fieldName:string, error:string) {}\r\n    setInitValues(values: any) {}\r\n    isOk():boolean {this.validate(); return !this.hasError;}\r\n    protected validate() {}\r\n}\r\n\r\nexport abstract class Control extends ControlBase {\r\n    protected _field: Field;\r\n    protected _face: Face;\r\n    protected props: any;\r\n    protected rules: Rule[];\r\n\r\n    protected element: HTMLElement;\r\n    @observable protected isOK?: boolean;\r\n    @observable protected error: string;\r\n    @observable protected value: any;\r\n\r\n    constructor(formView:FormView, field:Field, face:Face) {\r\n        super(formView);\r\n        if (field === undefined) debugger;\r\n        this._field = field;\r\n        this._face = face;\r\n        this.init();\r\n        this.setProps();\r\n    }\r\n    protected ref(element: HTMLElement) {\r\n        this.element = element;\r\n    }\r\n    protected init() {\r\n        this.rules = [];\r\n        let r = this._field.rules;\r\n        if (r !== undefined) {\r\n            if (Array.isArray(r) === true) this.rules.push(...(r as Rule[]));\r\n            else this.rules.push(r as Rule);\r\n        }\r\n    };\r\n    protected setProps():any {\r\n        return this.props = {\r\n            ref: this.ref.bind(this),\r\n            name: this._field.name,\r\n        }\r\n    };\r\n    @computed get hasError():boolean {return this.error !== undefined;}\r\n    @computed get filled():boolean {\r\n        let ret = this.value !== undefined && this.value !== this._field.defaultValue;\r\n        return ret;\r\n    }\r\n    clearValue() { this.value = undefined; }\r\n    clear() { this.clearErrors(); this.clearValue(); }\r\n    clearErrors() { this.isOK = undefined; this.error = undefined; }\r\n    readValues(values:any):any {\r\n        values[this._field.name] = this.value;\r\n    }\r\n    setError(fieldName:string, error:string) {}\r\n    setInitValues(values: any) {}\r\n    protected getValueFromElement():any {return this.value;}\r\n    protected validate() {\r\n        try {\r\n            let v = this.getValueFromElement();\r\n            if (this.rules.length > 0) {\r\n                let isOk:boolean;\r\n                for (let rule of this.rules) {\r\n                    console.log('validate: %s', v);\r\n                    let err = rule(v);\r\n                    console.log('validate: %s err: %s', v, err);\r\n                    if (err === true) {\r\n                        this.error = undefined;\r\n                        isOk = true;\r\n                    }\r\n                    else if (err !== undefined) {\r\n                        //console.log('field %s onBlur v=%s rule=%s err=%s', \r\n                        //    this.field.name, JSON.stringify(v), rule, err);\r\n                        this.error = err;\r\n                        this.isOK = false;\r\n                        return;\r\n                    }\r\n                }\r\n                this.isOK = isOk;\r\n            }\r\n            this.value = v;\r\n        }\r\n        catch (e:any) {\r\n            this.error = e.message;\r\n        }\r\n    }\r\n    render():JSX.Element {\r\n        let n:any;\r\n        if (this._face !== undefined) {\r\n            let {notes} = this._face;\r\n            if (notes !== undefined) n = <small className=\"text-muted\">{notes}</small>;\r\n        }\r\n        return <div className=\"col-sm-10\">\r\n            {this.renderControl()}\r\n            {n}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport {BoolField} from '../field';\r\nimport {CheckBoxFace} from '../face';\r\nimport {Control} from './control';\r\n\r\nexport class CheckControl extends Control {    \r\n    protected element: HTMLInputElement;\r\n    private trueValue: any;\r\n    private falseValue: any;\r\n\r\n    protected get field(): BoolField {return this._field as BoolField}\r\n    protected get face(): CheckBoxFace {return this._face as CheckBoxFace}\r\n\r\n    protected init() {\r\n        super.init();\r\n        let {trueValue, falseValue} = this.field;\r\n        if (trueValue === undefined) this.trueValue = 1;\r\n        if (falseValue === undefined) this.falseValue = 0;\r\n    }\r\n\r\n    setProps() {\r\n        super.setProps();\r\n        _.assign(this.props, {\r\n            onChange: this.onChange.bind(this),\r\n        });\r\n    }\r\n\r\n    clearValue() {\r\n        this.element.checked = this._field.defaultValue === this.trueValue;\r\n        this.value = this.getValueFromElement();\r\n    }\r\n\r\n    setInitValues(values: any) {\r\n        let v = values[this._field.name];\r\n        if (v === undefined) {\r\n            v = this._field.defaultValue;\r\n        }\r\n        if (v !== undefined) {\r\n            //this.element.checked = v === this.trueValue;\r\n            //this.value = this.getValueFromElement();\r\n        }\r\n    }\r\n\r\n    protected getValueFromElement():any { return this.element.checked? this.trueValue:this.falseValue; }\r\n\r\n    private onChange() {\r\n        this.value = this.getValueFromElement();\r\n    }\r\n\r\n    renderControl():JSX.Element {\r\n        return <div className=\"form-control-static\">\r\n            <label className=\"form-control\">\r\n                <label className=\"custom-control custom-checkbox mb-0\">\r\n                    <input type='checkbox'\r\n                        name={this._field.name}\r\n                        ref={this.props.ref}\r\n                        onChange={this.props.onChange}\r\n                        className=\"custom-control-input\" />\r\n                    <span className=\"custom-control-indicator\" />\r\n                    <span className=\"custom-control-description\">{this.face.label}</span>\r\n                </label>\r\n            </label>\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {RadioFace} from '../face';\r\nimport {Control} from './control';\r\n\r\nexport class RadioControl extends Control {\r\n    protected get face(): RadioFace {return this._face as RadioFace}\r\n    renderControl():JSX.Element {\r\n        return <div className=\"form-control-static\">\r\n            <div className=\"form-control\">\r\n            {\r\n                this.face.list.map((item, index) => {\r\n                    let t:any; //, v:any;\r\n                    if (typeof item !== 'object') t = item;\r\n                    else {\r\n                        t = item.text;\r\n                        //v = item.value;\r\n                    }\r\n                    return <label key={index} className=\"custom-control custom-radio w-25\">\r\n                        <input type='radio'\r\n                            name={this._field.name} \r\n                            className=\"custom-control-input\" />\r\n                        <span className=\"custom-control-indicator\"></span>\r\n                        <span className=\"custom-control-description\">{t}</span>\r\n                    </label>;\r\n                })\r\n            }\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport _ from 'lodash';\r\nimport {Placeholder} from '../face';\r\nimport {Control} from './control';\r\n\r\nconst TxtRequired = '必须填入要求内容';\r\n\r\nexport abstract class CharsControl extends Control {\r\n    protected init() {\r\n        super.init();\r\n        if (this._field.required === true) {\r\n            this.rules.push((v) => {\r\n                if (v===null || v===undefined || (v as string).trim().length === 0) return TxtRequired;\r\n                return true;\r\n            });\r\n        }\r\n    }\r\n\r\n    protected element: HTMLInputElement;\r\n    protected getValueFromElement():any {return this.parseValue(this.element.value)}\r\n\r\n    protected setProps() {\r\n        super.setProps();\r\n        _.assign(this.props, {\r\n            onBlur: this.onBlur.bind(this),\r\n            onFocus: this.onFocus.bind(this),\r\n            onChange: this.onChange.bind(this),\r\n        });\r\n        let face = this._face as Placeholder;\r\n        if (face !== undefined) {\r\n            _.assign(this.props, {\r\n                placeholder: face.placeholder,\r\n            });\r\n        }\r\n        return this.props;\r\n    };\r\n    protected parseValue(value?:string):any {return value;}\r\n    private onBlur() {\r\n        //console.log('field %s onBlure', this.field.name);\r\n        this.validate();\r\n    }\r\n    private onChange() {\r\n        console.log('onChange');\r\n        this.validate();\r\n    }\r\n    private onFocus() {\r\n        this.clearErrors();\r\n        //this.error = undefined;\r\n        //this.formView.clearErrors();\r\n    }\r\n    protected className() {\r\n        return classNames({\r\n            \"form-control\": true,\r\n            \"has-success\": this.isOK === true,\r\n            \"is-invalid\": this.error !== undefined,\r\n            \"is-valid\": this.error === undefined && this.isOK === true,\r\n        });\r\n    }\r\n    protected renderInput():JSX.Element {\r\n        return <input className={this.className()} {...this.props} />;\r\n    }\r\n    protected ref(element: HTMLInputElement) {\r\n        super.ref(element);\r\n        if (element) {\r\n            element.value = this.value === undefined? '':this.value;\r\n        }\r\n    }\r\n    protected renderError():JSX.Element {\r\n        //if (this.field.name === 'name') console.log('charsControl renderControl');\r\n        if (this.error === undefined) return null;\r\n        return <div className=\"invalid-feedback\">{this.error}</div>\r\n    }\r\n    clearValue() { super.clearValue(); this.element.value = ''; }\r\n    setError(fieldName:string, error:string) {\r\n        if (this._field.name === fieldName) this.error = error;\r\n    }\r\n    setInitValues(values: any) {\r\n        let v = values[this._field.name];\r\n        if (v === undefined) return;\r\n        //this.element.value = v;\r\n        this.value = v;\r\n    }\r\n    renderControl():JSX.Element {\r\n        return <React.Fragment>\r\n            {this.renderInput()}\r\n            {this.renderError()}\r\n        </React.Fragment>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport * as _ from 'lodash';\r\nimport {CharsControl} from './charsControl';\r\nimport {StringField} from '../field';\r\nimport {TextAreaFace} from '../face';\r\n\r\nexport class TextAreaControl extends CharsControl {\r\n    protected get face(): TextAreaFace {return this._face as TextAreaFace}\r\n    private el: HTMLTextAreaElement;\r\n\r\n    protected get field(): StringField {return this._field as StringField}\r\n\r\n    protected setProps() {\r\n        let p = super.setProps();\r\n        let {maxLength} = this.field;\r\n        let {rows} = this.face;\r\n        _.assign(p, {\r\n            maxLength: maxLength,\r\n            rows: rows,\r\n        });\r\n        return p;\r\n    };\r\n    protected renderInput():JSX.Element {\r\n        return <textarea ref={t=>{this.el = t;if (t!==undefined) t.value=''}} className={this.className()} {...this.props} />;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {FormView} from '../formView';\r\nimport {Field} from '../field';\r\nimport {Face, SelectFace} from '../face';\r\nimport {Control} from './control';\r\n\r\nexport class SelectControl extends Control {\r\n    constructor (formView:FormView, field:Field, face:Face) {\r\n        super(formView, field, face);\r\n        this.ref = this.ref.bind(this);\r\n    }\r\n    protected get face(): SelectFace {return this._face as SelectFace}\r\n    protected element: HTMLSelectElement;\r\n    protected getValueFromElement():any {\r\n        let {selectedOptions} = this.element;\r\n        let v:any = selectedOptions[0].value;\r\n        switch (this._field.type) {\r\n            case 'number': v = Number(v); break;\r\n            case 'date': v = new Date(v); break;\r\n            case 'bool': \r\n                if (typeof v === 'string') {\r\n                    v = ((v as string).toLowerCase() === 'true');\r\n                }\r\n                break;\r\n        }\r\n        return v;\r\n    }\r\n    renderControl():JSX.Element {\r\n        let {list} = this.face;\r\n        let def = this.face.default;\r\n        let options: any[] = [];\r\n        if (def === undefined)\r\n            options.push(<option key={-1} value={undefined}>请选择</option>);\r\n        options.push(...list.map((item, index) => {\r\n            let t, v;\r\n            if (typeof item !== 'object') t = v = item;\r\n            else {\r\n                t = item.text;\r\n                v = item.value;\r\n            }\r\n            return <option key={index} value={v}>{t}</option>;\r\n        }));\r\n        return <div className=\"form-control-static\">\r\n            <select name={this._field.name} className=\"form-control\" ref={this.ref}>\r\n                {options}\r\n            </select>\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {Control, ControlBase} from './control';\r\nimport {FormView} from '../formView';\r\n\r\nexport class UnknownControl extends Control {\r\n    renderControl():JSX.Element {\r\n        return <div className=\"form-control-plaintext\">\r\n            <div className=\"alert alert-primary\" role=\"alert\">\r\n            don't know how to create control<br/>\r\n            field: {JSON.stringify(this._field)} must be object <br/>\r\n            face: {JSON.stringify(this._face)} must be object <br/>\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class EmptyControl extends ControlBase {\r\n    private element:JSX.Element;\r\n    constructor(formView:FormView, element:JSX.Element) {\r\n        super(formView);\r\n        this.element = element;\r\n    }\r\n    renderControl():JSX.Element {\r\n        return <div className=\"form-control-plaintext\">\r\n            {this.element}\r\n        </div>;\r\n    }\r\n}\r\n","import _ from 'lodash';\r\nimport {CharsControl} from './charsControl';\r\nimport {StringField} from '../field';\r\n\r\nexport class StringControl extends CharsControl {\r\n    protected get field(): StringField {return this._field as StringField}\r\n\r\n    protected setProps() {\r\n        let p = super.setProps();\r\n        _.assign(p, {\r\n            type: 'text',\r\n            maxLength: this.field.maxLength,\r\n        });\r\n        return p;\r\n    };\r\n    protected parseValue(value?:string):any {\r\n        if (value === undefined) return undefined;\r\n        if (value.trim().length === 0) return undefined;\r\n        return value;\r\n    }\r\n}\r\n\r\nexport class PasswordControl extends StringControl {\r\n    protected setProps() {\r\n        let p = super.setProps();\r\n        _.assign(p, {\r\n            type: 'password',\r\n            maxLength: this.field.maxLength,\r\n        });\r\n        return p;\r\n    };\r\n}","import _ from 'lodash';\r\nimport {IntField, DecField, NumberField} from '../field';\r\nimport {CharsControl} from './charsControl';\r\n\r\nconst ErrInvalidNumber = '无效的数字';\r\nconst ErrMin = '最小值为';\r\nconst ErrMax = '最大值为';\r\n\r\nconst KeyCode_Neg = 45;\r\nconst KeyCode_Dot = 46;\r\n\r\nexport class NumberControl extends CharsControl {\r\n    protected value: number;\r\n    protected extraChars: number[];\r\n\r\n    protected get field(): IntField | DecField | NumberField {return this._field as IntField | DecField | NumberField}\r\n    \r\n    protected init() {\r\n        super.init();\r\n        this.extraChars = [];\r\n        let {min, max} = this.field;\r\n        if (min !== undefined) {\r\n            this.rules.push((v:number) => {if (v === undefined) return; if (v<min) return ErrMin + min; return true;});\r\n            if (min < 0) this.extraChars.push(KeyCode_Neg);\r\n        }\r\n        else {\r\n            this.extraChars.push(KeyCode_Neg);\r\n        }\r\n\r\n        if (max !== undefined) {\r\n            this.rules.push((v:number) => {if (v === undefined) return; if (v>max) return ErrMax + max; return true});\r\n        }\r\n        switch (this._field.type) {\r\n            case 'dec':\r\n            case 'number': this.extraChars.push(KeyCode_Dot); break;\r\n        }\r\n    }\r\n\r\n    protected parseValue(value?:string):any {\r\n        if (value === undefined) return undefined;\r\n        if (value.trim().length === 0) return undefined;\r\n        let n = Number.parseFloat(value);\r\n        if (isNaN(n)) throw new Error(ErrInvalidNumber);\r\n        return n;\r\n    }\r\n\r\n    protected setProps() {\r\n        super.setProps();\r\n        _.assign(this.props, {\r\n            type: 'number',\r\n            step: (this._field as DecField).step,\r\n            onKeyPress: this.onKeyPress.bind(this),\r\n        });\r\n    }\r\n\r\n    onKeyPress(event:KeyboardEvent) {\r\n        let ch = event.charCode;\r\n        if (ch === 8 || ch === 0 || ch === 13 || (ch >= 48 && ch <= 57)) return;\r\n        if (this.extraChars !== undefined) {\r\n            if (this.extraChars.indexOf(ch) >= 0) {\r\n                switch (ch) {\r\n                    case KeyCode_Dot: this.onKeyDot(); break;\r\n                    case KeyCode_Neg: this.onKeyNeg(); event.preventDefault(); break;\r\n                }\r\n                return;\r\n            }\r\n        }\r\n        event.preventDefault();\r\n    }\r\n\r\n    private onKeyDot() {\r\n        let v = this.element.value;\r\n        let p = v.indexOf('.');\r\n        if (p >= 0) this.element.value = v.replace('.', '');\r\n    }\r\n    private onKeyNeg() {\r\n        let v = this.element.value;\r\n        let p = v.indexOf('-');\r\n        if (p >= 0) v = v.replace('-', '');\r\n        else v = '-'+v;\r\n        this.element.value = v;\r\n    }\r\n}\r\n","import {computed, observable} from 'mobx';\r\nimport {IdPickFace} from '../face';\r\nimport {Control} from './control';\r\n\r\nexport class PickIdControl extends Control {\r\n    protected get face(): IdPickFace {return this._face as IdPickFace}\r\n    @observable private caption: string|JSX.Element;\r\n\r\n    private onClick = async () => {\r\n        let {pick, fromPicked} = this.face;\r\n        let item = await pick(this.face, this.formView.props, this.formView.readValues());\r\n        if (item === undefined) {\r\n            this.value = undefined;\r\n            return;\r\n        }\r\n        if (fromPicked === undefined) {\r\n            this.value = item.id;\r\n            return;\r\n        }\r\n        let {id, caption} = fromPicked(item);\r\n        this.value = id;\r\n        this.caption = caption;\r\n    }\r\n    @computed get hasError():boolean {\r\n        return this._field.required === true && this.value === undefined;\r\n    }\r\n    onPicked = (value: any) => {\r\n        this.value = value.id;\r\n    }\r\n    setInitValues(values: any) {\r\n        let v = values[this._field.name];\r\n        this.value = v;\r\n    }\r\n    private controlContent():string|JSX.Element {\r\n        let {itemFromId, fromPicked, initCaption} = this.face;\r\n        if (this.value === undefined) {\r\n            return initCaption || '请选择Id';\r\n        }\r\n        if (this.caption !== undefined) {\r\n            return this.caption;\r\n        }\r\n        if (itemFromId !== undefined) {\r\n            if (fromPicked !== undefined) {\r\n                let item = itemFromId(this.value);\r\n                if (item) {\r\n                    let ret = fromPicked(item);\r\n                    if (ret !== undefined) return ret.caption;\r\n                }\r\n            }\r\n        }\r\n        return String(this.value);\r\n    }\r\n    renderControl():JSX.Element {\r\n        let {tuid, input} = this.face;\r\n        if (input === undefined) {\r\n            return <div className=\"form-control-plaintext px-2 border text-primary rounded cursor-pointer\"\r\n                onClick={this.onClick}>\r\n                {this.controlContent()}\r\n            </div>;\r\n        }\r\n        return <div className=\"form-control-static \">\r\n            <input.component id={this.value} \r\n                ui={tuid}\r\n                />\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observable} from 'mobx';\r\nimport {FormView} from '../formView';\r\nimport {Field} from '../field';\r\nimport {Face, TuidPickFace} from '../face';\r\nimport {Control} from './control';\r\n\r\nexport class PickTuidControl extends Control {\r\n    protected get face(): TuidPickFace {return this._face as TuidPickFace}\r\n    // protected value: number;\r\n    @observable private caption: string|JSX.Element;\r\n    constructor(formView:FormView, field:Field, face:Face) {\r\n        super(formView, field, face);\r\n        this.onIdChanged = this.onIdChanged.bind(this);\r\n        //this.onClick = this.onClick.bind(this);\r\n    }\r\n    /*\r\n    private async onClick() {\r\n        let {pick, fromPicked} = this.face;\r\n        let item = await pick(this.face, this.formView.props, this.formView.readValues());\r\n        if (item === undefined) {\r\n            this.value = undefined;\r\n            return;\r\n        }\r\n        if (fromPicked === undefined) {\r\n            this.value = item.id;\r\n            return;\r\n        }\r\n        let {id, caption} = fromPicked(item);\r\n        this.value = id;\r\n        this.caption = caption;\r\n    }*/\r\n    onIdChanged(id: any) {\r\n        this.value = id.id;\r\n    }\r\n    setInitValues(values: any) {\r\n        let v = values[this._field.name];\r\n        this.value = v;\r\n    }\r\n    private buildContent():JSX.Element {\r\n\t\t/*\r\n        return <this.face.input.component \r\n            {...this.face}\r\n            id={this.value}\r\n            onFormValues={()=>this.formView.readValues()}\r\n\t\t\tonIdChanged={this.onIdChanged} />;\r\n\t\t*/\r\n\t\treturn React.createElement(this.face.input.component, {\r\n\t\t\tid: this.value,\r\n            onFormValues: ()=>this.formView.readValues(),\r\n\t\t\tonIdChanged: this.onIdChanged,\r\n\t\t\t...this.face\r\n\t\t})\r\n    }\r\n    renderControl():JSX.Element {\r\n        return <div className=\"form-control-static \">\r\n            {this.buildContent()}\r\n        </div>;\r\n    }\r\n}\r\n/*\r\n<button className=\"form-control btn btn-outline-info\"\r\ntype=\"button\"\r\nstyle={{textAlign:'left', paddingLeft:'0.75rem'}}\r\nonClick={this.onClick}>\r\n{this.buildContent()}\r\n</button>\r\n*/","import * as React from 'react';\r\nimport {observable} from 'mobx';\r\nimport {PickFace} from '../face';\r\nimport {Control} from './control';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class PickControl extends Control {\r\n    protected get face(): PickFace {return this._face as PickFace}\r\n\r\n    @observable private caption: string|JSX.Element;\r\n\r\n    private onClick = async () => {\r\n        let {pick, fromPicked} = this.face;\r\n        let item = await pick(this.face, this.formView.props, this.formView.readValues());\r\n        if (item === undefined) {\r\n            this.value = undefined;\r\n            return;\r\n        }\r\n        let {id, caption} = fromPicked(item);\r\n        this.value = id;\r\n        this.caption = caption;\r\n    }\r\n    setInitValues(values: any) {\r\n        let v = values[this._field.name];\r\n        this.value = v;\r\n    }\r\n    /*\r\n    private controlContent():string|JSX.Element {\r\n        let {content: Content} = this.face;\r\n        if (this.value === undefined) {\r\n            return '请选择';\r\n        }\r\n        \r\n        if (this.caption !== undefined) {\r\n            return this.caption;\r\n        }\r\n        return <Content id={this.value} />;\r\n    }*/\r\n    /*\r\n    private buildContent():string|JSX.Element {\r\n        let {tuid, input} = this.face;\r\n        if (input === undefined) {\r\n            //return <div>no input on idpick</div>;\r\n            return <div onClick={this.onClick}>{this.controlContent()}</div>;\r\n        }\r\n        return <input.component id={this.value} \r\n            tuid={tuid}\r\n            input={input}\r\n            entitiesUI={this.formView.props.context} \r\n            params={this.formView.readValues()}\r\n            onPicked={this.onPicked} />;\r\n    }*/\r\n    renderControl():JSX.Element {\r\n        return React.createElement(this.view);\r\n        /*\r\n        let {content:Content} = this.face;\r\n        //if (this.value === undefined) {\r\n            //return <div>no input on idpick</div>;\r\n        //}\r\n        //return <div className=\"form-control-static \">\r\n        //    <Content />\r\n        //</div>;\r\n        */\r\n    }\r\n\r\n    private view = observer(() => {\r\n        let content:any;\r\n        let {content: Content} = this.face;\r\n        if (this.value === undefined || this.value === null) {\r\n            content = '请选择';\r\n        }\r\n        /*\r\n        else if (this.caption !== undefined) {\r\n            content = this.caption;\r\n        }*/\r\n        else {\r\n            content = <Content id={this.value} />;\r\n        } \r\n        return <div\r\n            className=\"form-control-plaintext px-2 border text-primary rounded cursor-pointer bg-light\"\r\n            onClick={this.onClick}>\r\n            {content}\r\n        </div>\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport { ControlBase } from './control';\r\n\r\nexport class ButtonsControl extends ControlBase {\r\n    constructor(props) {\r\n        super(props);\r\n        this.otherClick = this.otherClick.bind(this);\r\n    }\r\n    private otherClick() {\r\n        let onOther = this.formView.props.onOther;\r\n        if (onOther === undefined) return;\r\n        let values = this.formView.readValues();\r\n        onOther(values);\r\n    }\r\n    renderControl(): JSX.Element {\r\n        console.log('buttons.renderControl');\r\n        let nothing = this.formView.nothing;\r\n        let hasError = this.formView.hasError;\r\n        let props = this.formView.props;\r\n        console.log('buttons.renderControl nothing:%s hasError:%s', nothing, hasError);\r\n        let { submitButton, otherButton } = props;\r\n        let btnOther: any;\r\n        if (otherButton !== undefined) {\r\n            btnOther = <button className=\"btn btn-outline-info ms-auto\" onClick={this.otherClick}>\r\n                {otherButton}\r\n            </button>\r\n        }\r\n        return <div className=\"d-flex justify-content-start\">\r\n            <button\r\n                className=\"btn btn-primary\"\r\n                type=\"submit\"\r\n                disabled={nothing || hasError}>\r\n                {submitButton || '提交'}\r\n            </button>\r\n            {btnOther}\r\n        </div>;\r\n    }\r\n}\r\n","import {Field} from '../field';\r\nimport {Face} from '../face';\r\nimport {Control, ControlBase} from './control';\r\nimport {CheckControl} from './checkControl';\r\nimport {RadioControl} from './radioControl';\r\nimport {TextAreaControl} from './textAreaControl';\r\nimport {SelectControl} from './selectControl';\r\nimport {UnknownControl, EmptyControl} from './unknownControl';\r\nimport {StringControl, PasswordControl} from './stringControl';\r\nimport {NumberControl} from './numberControl';\r\n\r\nimport {FormView, FormRow, GroupRow, FieldRow, LabelFormRow} from '../formView';\r\nimport { PickIdControl } from './pickIdControl';\r\nimport { PickTuidControl } from './pickTuidControl';\r\nimport { PickControl } from './pickControl';\r\n\r\nexport * from './control';\r\nexport * from './buttonsControl';\r\nexport * from './stringControl';\r\nexport * from './numberControl';\r\n\r\nexport type CreateControl = (form:FormView, row: FormRow) => ControlBase\r\n\r\nexport const createControl:CreateControl = ((form:FormView, row: LabelFormRow):ControlBase => {\r\n    let control:ControlBase;\r\n    let label = row.label;\r\n    if ((row as GroupRow).group !== undefined) {\r\n        control = createGroupControl(form, label, row as GroupRow);\r\n    }\r\n    else if ((row as FieldRow).field !== undefined) {\r\n        control = createFieldControl(form, label, row as FieldRow);\r\n    }\r\n    else {\r\n        control = new EmptyControl(form, row.help);\r\n    }\r\n    return control;\r\n}) as CreateControl;\r\n\r\nconst controlTypes:{[type:string]: new (formView:FormView, field:Field, face:Face) => Control} = {\r\n    \"string\": StringControl,\r\n    \"password\": PasswordControl,\r\n    \"number\": NumberControl,\r\n    \"checkbox\": CheckControl,\r\n    \"radiobox\": RadioControl,\r\n    \"select\": SelectControl,\r\n    \"pick-id\": PickIdControl,\r\n    \"pick-tuid\": PickTuidControl,\r\n    \"textarea\": TextAreaControl,\r\n    \"pick\": PickControl,\r\n};\r\nconst defaultFaces:{[type:string]: Face} = {\r\n    \"string\": {type:'string'},\r\n    \"number\": {type:'number'},\r\n    \"int\": {type:'number'},\r\n    \"dec\": {type:'number'},\r\n    \"bool\": {type:'checkbox'},\r\n}\r\nfunction createFieldControl(form:FormView, label:string, fieldRow: FieldRow):Control {\r\n    let {field, face} = fieldRow;\r\n    switch (typeof field) {\r\n        case 'string':\r\n            field = {\r\n                name: (field as any) as string,\r\n                type: 'string',\r\n            }\r\n            break;\r\n        case 'object':\r\n            break;\r\n        default:\r\n            return new UnknownControl(form, field, face);\r\n    }\r\n    let fieldType = field.type || 'string';\r\n    if (face === undefined) {\r\n        face = defaultFaces[fieldType];\r\n        if (face === undefined) return new UnknownControl(form, field, face);\r\n    }\r\n    else if (face.type === undefined) {\r\n        let f = defaultFaces[fieldType];\r\n        face.type = f===undefined? 'string' : f.type;\r\n    }\r\n    let controlType = controlTypes[face.type || fieldType] || UnknownControl;\r\n    let c = new controlType(form, field, face);\r\n    return c;\r\n}\r\n\r\nfunction createGroupControl(form:FormView, label:string, groupRow: GroupRow):Control {\r\n    return new UnknownControl(form, groupRow as any, undefined);\r\n}\r\n","import { LocalMap } from './localDb';\r\n\r\n// 如果路径上有独立的test单词，则是test环境\r\nfunction isTesting():boolean {\r\n\tlet ret = /(\\btest\\b)/i.test(document.location.href);\r\n\treturn ret;\r\n}\r\n\r\nexport const env = (function () {\r\n    let testing = isTesting();\r\n    let localDb = new LocalMap(testing===true? '$$':'$');\r\n    return {\r\n        testing: testing,\r\n        isDevelopment: process.env.NODE_ENV === 'development',\r\n        localDb: localDb,\r\n        setTimeout: (tag:string, callback: (...args: any[]) => void, ms: number, ...args: any[]):NodeJS.Timer => {\r\n            //if (tag !== undefined) console.log('setTimeout ' + tag);\r\n            return global.setTimeout(callback, ms, ...args);\r\n        },\r\n        clearTimeout: (handle:NodeJS.Timer):void => {\r\n            global.clearTimeout(handle);\r\n        },\r\n        setInterval: (callback: (...args: any[]) => void, ms: number, ...args: any[]): NodeJS.Timer => {\r\n            return global.setInterval(callback, ms, ...args);\r\n        },\r\n        clearInterval: (handle:NodeJS.Timer):void => {\r\n            global.clearInterval(handle);\r\n        }\r\n    }\r\n}());\r\n","\r\nexport * from './boxId';\r\nexport * from './tuid';\r\nexport { TuidsCache } from './tuidsCache';\r\nexport { tv, ReactBoxId, uqStringify } from './reactBoxId';","import * as React from 'react';\r\nimport {FormView, FormRow, FieldRow, GroupRow, LabelFormRow} from '../formView';\r\nimport {ControlBase, createControl, CreateControl} from '../control';\r\n\r\nexport type CreateRow = (form:FormView, row: FormRow)=>RowContainer;\r\n\r\nexport abstract class RowContainer {\r\n    protected form:FormView;\r\n    protected row: FormRow;\r\n    protected control: ControlBase;\r\n    constructor(form:FormView, row: FormRow) {\r\n        this.form = form;\r\n        this.row = row;\r\n        if ((row as JSX.Element).type === undefined) {\r\n            let cc:CreateControl = (row as LabelFormRow).createControl;\r\n            if (cc === undefined) cc = form.createControl;\r\n            if (cc === undefined) cc = createControl;\r\n            this.control = cc(form, row);\r\n        }\r\n    }\r\n    abstract render(key:string):JSX.Element;\r\n    \r\n    isOk():boolean {\r\n        if (this.control === undefined) return true;\r\n        return this.control.isOk();\r\n    }\r\n\r\n    contains(fieldName:string):boolean {\r\n        let field = (this.row as FieldRow).field;\r\n        if (field !== undefined) return fieldName === field.name;\r\n        let group = (this.row as GroupRow).group;\r\n        if (group !== undefined) return group.find(g => g.field.name === fieldName)!==undefined;\r\n        return false;\r\n    }\r\n    get hasError():boolean {return this.control.hasError;}\r\n    get filled():boolean {return this.control.filled;}\r\n    clear() {\r\n        if (this.control !== undefined) this.control.clear();\r\n    }\r\n    clearErrors() {\r\n        if (this.control !== undefined) this.control.clearErrors();\r\n    }\r\n    readValues(values:any):any {\r\n        if (this.control !== undefined) this.control.readValues(values);\r\n    }\r\n    setError(fieldName:string, error:string) {\r\n        if (this.control !== undefined) this.control.setError(fieldName, error);\r\n    }\r\n    setInitValues(values:any) {\r\n        if (this.control !== undefined) this.control.setInitValues(values);\r\n    }\r\n}\r\n\r\nclass ElementRowContainer extends RowContainer {\r\n    render(key:string):JSX.Element {\r\n        return <div key={key} className=\"form-group\">{this.row as JSX.Element}</div>;\r\n    }\r\n    get hasError():boolean {return false;}\r\n    get filled():boolean {return false;}\r\n}\r\n\r\nclass BootStrapRowContainer extends RowContainer {\r\n    render(key:string):JSX.Element {\r\n        return <div key={key} className='form-group row'>\r\n            <label className='col-sm-2 col-form-label'>\r\n                {(this.row as LabelFormRow).label}\r\n            </label>\r\n            {this.control.render()}\r\n        </div>;\r\n\r\n        //has-success is-valid\r\n    }\r\n}\r\n\r\nexport function bootstrapCreateRow(form:FormView, row: FormRow):RowContainer {\r\n    return new BootStrapRowContainer(form, row);\r\n}\r\n\r\nexport function elementCreateRow(form:FormView, row: FormRow):RowContainer {\r\n    return new ElementRowContainer(form, row);\r\n}\r\n","export * from './id';\r\nexport * from './dev';\r\nexport * from './unitApp';","import {HttpChannel} from './httpChannel';\r\nimport { Caller } from './caller';\r\n\r\nexport async function refetchApi(channel:HttpChannel, url:string, options:any, \r\n    resolve:(values:any)=>any, reject:(reason:any)=>void)\r\n{\r\n    await channel.fetch(url, options, false, resolve, reject);\r\n}\r\n\r\nexport abstract class ApiBase {\r\n    protected token: string;\r\n    protected path: string;\r\n    protected showWaiting: boolean;\r\n\r\n    constructor(path: string, showWaiting: boolean) {\r\n        this.path = path || '';\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    protected abstract getHttpChannel(): Promise<HttpChannel>;\r\n\r\n    async xcall(caller:Caller<any>):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.xcall(this.path, caller);\r\n    }\r\n\r\n    public async call(url:string, method:string, body:any):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.callFetch(url, method, body);\r\n    }\r\n\r\n    public async get(path:string, params:any=undefined): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.get(this.path + path, params);\r\n    }\r\n\r\n    public async post(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.post(this.path + path, params);\r\n    }\r\n\r\n    public async put(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.put(this.path + path, params);\r\n    }\r\n\r\n    public async delete(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.delete(this.path + path, params);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { UiImageItem } from '../schema';\r\nimport { ImageUploader } from '../resUploader';\r\nimport { nav } from '../nav';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class ImageItemEdit extends ItemEdit {\r\n    get uiItem(): UiImageItem { return this._uiItem as UiImageItem }\r\n    @observable private resId: string;\r\n\r\n    protected async internalStart(): Promise<any> {\r\n        this.resId = this.value;\r\n        return new Promise<any>((resolve, reject) => {\r\n            nav.push(React.createElement(this.page, { resolve: resolve, reject: reject }), () => reject());\r\n        });\r\n    }\r\n\r\n    /*\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let ret = await this.resUploader.upload();\r\n        if (ret === null) {\r\n            this.overSize = true;\r\n            env.setTimeout('imageItemEdit upload', () => this.overSize = false, 3000);\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.value);\r\n    }\r\n    */\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let size: any = this.uiItem && this.uiItem.size;\r\n\r\n        /*\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>resolve(this.resId)}>保存</button>;\r\n        let overSize:any;\r\n        if (this.overSize === true) {\r\n            overSize = <div className=\"text-danger\">\r\n                <i className=\"fa fa-times-circle\" /> 图片文件大小超过2M，无法上传\r\n            </div>;\r\n        }\r\n        */\r\n        return <ImageUploader\r\n            label={'更改' + this.label}\r\n            id={this.resId}\r\n            size={size}\r\n            onSaved={(resId): Promise<void> => { resolve(resId); return; }} />;\r\n        /*\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div>上传图片：</div>\r\n                    <div className=\"my-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} multiple={false} maxSize={2048} />\r\n                    </div>\r\n                    <div>\r\n                        <button className=\"btn btn-primary\" onClick={this.upload}>上传</button>\r\n                    </div>\r\n                </div>\r\n                {overSize}\r\n                <div className=\"small muted my-4\">支持JPG、GIF、PNG格式图片，不超过2M。</div>\r\n                <div className=\"d-flex\">\r\n                    <div className=\"w-12c h-12c me-4\"\r\n                        style={{border: '1px dotted gray', padding: '8px'}}>\r\n                        <Image className=\"w-100 h-100\" src={this.resId} />\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"small\">图片预览</div>\r\n                        <Image className=\"w-4c h-4c mt-3\" src={this.resId} />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n        */\r\n    })\r\n}\r\n","import _ from 'lodash';\r\nimport {observable, IObservableArray, computed} from 'mobx';\r\n\r\nexport abstract class PageItems<T> {\r\n    constructor(itemObservable:boolean = false) {\r\n\t\tif (itemObservable === undefined) itemObservable = false;\r\n        this._items = observable.array<T>([], {deep:itemObservable});\r\n    }\r\n\tprivate isFirst: boolean = true;\r\n\tprivate pageItemAction: (item:T, results:{[name:string]:any[]}) => void;\r\n\tprivate itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T;\r\n    @observable loading: boolean = false;\r\n    @observable private beforeLoad: boolean = true;\r\n    @observable protected loaded: boolean = false;\r\n    protected _items:IObservableArray<T>;\r\n    @observable allLoaded: boolean = false;\r\n    @computed get items():IObservableArray<T> {\r\n        if (this.beforeLoad === true) return null;\r\n        if (this.loaded === false) return undefined;\r\n        return this._items;\r\n\t}\r\n\t\r\n\tsetEachPageItem(pageItemAction: (item:T, results:{[name:string]:any[]}) => void) {\r\n\t\tthis.pageItemAction = pageItemAction;\r\n\t}\r\n\r\n\tsetItemConverter(itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T) {\r\n\t\tthis.itemConverter = itemConverter;\r\n\t}\r\n\r\n    @observable topDiv:string = '$$top';\r\n    @observable bottomDiv:string = '$$bottom';\r\n    scrollToTop = () => {\r\n\t\tthis.scrollIntoView(this.topDiv);\r\n\t\t//let id = '$$top'+uid();\r\n\t\t//this.topDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.topDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n    }\r\n    scrollToBottom = () => {\r\n\t\tthis.scrollIntoView(this.bottomDiv);\r\n\t\t//let id = '$$bottom'+uid();\r\n\t\t//this.bottomDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.bottomDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n\t}\r\n\tprivate scrollIntoView(divId:string) {\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(divId);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t}\r\n\r\n    protected param: any;\r\n    protected firstSize = 100;\r\n    protected pageStart:any = undefined;\r\n    protected pageSize = 30;\r\n    protected appendPosition:'head'|'tail' = 'tail';\r\n\r\n\tprotected sortOrder:'asc'|'desc';\r\n\tprotected abstract loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}>;\r\n\tprotected getPageId(item:T):any {return;}\r\n\tprotected setPageStart(item:T) {\r\n\t\tthis.pageStart = this.getPageId(item);\r\n\t}\r\n\t\r\n\tprotected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n\t\tlet results = await this.loadResults(param, pageStart, pageSize);\r\n\t\tlet pageList = results.$page;\r\n\t\tif (this.itemConverter) {\r\n\t\t\tlet ret:T[] = [];\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = this.itemConverter(pageList[i], results);\r\n\t\t\t\tret.push(item);\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\tif (this.pageItemAction !== undefined) {\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tthis.pageItemAction(pageList[i], results);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn pageList;\r\n\t}\r\n\r\n    reset() {\r\n        this.isFirst = true;\r\n        this.beforeLoad = true;\r\n        this.loaded = false;\r\n        this.param = undefined;\r\n\t\tthis.allLoaded = false;\r\n\t\tthis.pageStart = undefined;\r\n        this._items.clear();\r\n        //this.setPageStart(undefined);\r\n    }\r\n\r\n    append(item:T) {\r\n        if (this.appendPosition === 'tail')\r\n            this._items.unshift(item);\r\n        else\r\n            this._items.push(item);\r\n    }\r\n\r\n    async first(param:any):Promise<void> {\r\n        this.reset();\r\n        this.beforeLoad = false;\r\n        this.param = param;\r\n        await this.more();\r\n\t}\r\n\r\n\tprivate changing = false;\r\n\tasync attach(): Promise<void> {\r\n\t\tif (this.sortOrder === undefined) {\r\n\t\t\tconsole.error('没有定义增减序，无法attach');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet items = this._items;\r\n\t\tlet isAsc = this.sortOrder === 'asc';\r\n\t\t//let isTail:boolean, \r\n\t\tlet endItem:T;\r\n\t\tlet scrollToEnd:() => void;\r\n\t\tlet pushItem:(item:T) => void;\r\n\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t//isTail = true;\r\n\t\t\tendItem = items[0];\r\n\t\t\tscrollToEnd = this.scrollToTop;\r\n\t\t\tpushItem = (item:T) => items.unshift(item);\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//isTail = false;\r\n\t\t\tlet endIndex = items.length;\r\n\t\t\tendItem = items[endIndex-1];\r\n\t\t\tscrollToEnd = this.scrollToBottom;\r\n\t\t\tpushItem = (item:T) => items.splice(endIndex, 0, item);\r\n\t\t}\r\n\t\tlet startId = this.getPageId(endItem);\r\n\t\tlet pid = undefined;\r\n\t\tlet sum = 0, max = 50;\r\n\t\tfor (;sum < max;) {\r\n\t\t\tlet ret = await this.load(this.param, pid, 3);\r\n\t\t\tlet len = ret.length;\r\n\t\t\tif (len === 0) break;\r\n\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = ret[i];\r\n\t\t\t\tpid = this.getPageId(item);\r\n\t\t\t\tif (isAsc === true) {\r\n\t\t\t\t\tif (pid >= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pid <= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpushItem(item);\r\n\t\t\t\t/*\r\n\t\t\t\tif (isTail === true) {\r\n\t\t\t\t\tthis._items.unshift(item);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._items.push(item);\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\t++sum;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.changing = false;\r\n\t\tif (sum > 0) {\r\n\t\t\tscrollToEnd();\r\n\t\t\t/*\r\n\t\t\tif (isTail === true) this.scrollToTop();\r\n\t\t\telse this.scrollToBottom();\r\n\t\t\t*/\r\n\t\t}\r\n\t}\r\n\r\n\tasync refresh(): Promise<void> {\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet ret = await this.load(this.param, undefined, this.firstSize>this.pageSize? this.firstSize:this.pageSize);\r\n\t\tthis._items.clear();\r\n\t\tthis.setLoaded(ret);\r\n\t\t/*\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet item = ret[i];\r\n\t\t\tlet pid = this.getRefreshPageId(item);\r\n\t\t\tlet index = this._items.findIndex(v => this.getRefreshPageId(v) === pid);\r\n\t\t\t//let index = _.sortedIndexBy(this._items, item, v=>this.getRefreshPageId(v));\r\n\t\t\t//let oldItem = this._items[index];\r\n\t\t\t//let oid = this.getRefreshPageId(oldItem);\r\n\t\t\tif (index >= 0) {\r\n\t\t\t\t_.merge(this._items[index], item);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.splice(0, 0, item);\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t\tthis.changing = false;\r\n\t}\r\n\r\n\tprotected getRefreshPageId(item:T) {\r\n\t\treturn this.getPageId(item);\r\n\t}\r\n\r\n    protected async onLoad(): Promise<void> {}\r\n    protected async onLoaded(): Promise<void> {}\r\n\r\n    async more():Promise<boolean> {\r\n        if (this.allLoaded === true) return false;\r\n\t\tif (this.loading === true) return true;\r\n\t\tif (this.changing === true) return true;\r\n\t\tthis.loading = true;\r\n\t\tthis.changing = true;\r\n        await this.onLoad();\r\n        if (this.pageStart === undefined) this.setPageStart(undefined);\r\n        let pageSize = this.pageSize + 1;\r\n        if (this.isFirst === true) {\r\n            if (this.firstSize > this.pageSize) pageSize = this.firstSize+1;\r\n        }\r\n        let ret = await this.load(\r\n                this.param, \r\n                this.pageStart,\r\n\t\t\t\tpageSize);\r\n        this.loaded = true;\r\n\t\tlet len = ret.length;\r\n        if ((this.isFirst===true && len>this.firstSize) ||\r\n            (this.isFirst===false && len>this.pageSize))\r\n        {\r\n            this.allLoaded = false;\r\n            --len;\r\n            ret.splice(len, 1);\r\n        }\r\n        else {\r\n            this.allLoaded = true;\r\n\t\t}\r\n\t\t/*\r\n        if (len === 0) {\r\n\t\t\tthis.setPageStart(undefined);\r\n            this._items.clear();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setPageStart(ret[len-1]);\r\n\t\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t\tthis._items.push(...ret);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.unshift(...ret.reverse());\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t\tthis.setLoaded(ret);\r\n\t\tthis.isFirst = false;\r\n\t\tthis.onLoaded();\r\n\t\tthis.changing = false;\r\n\t\tthis.loading = false;\r\n\t\treturn !this.allLoaded;\r\n\t}\r\n\t\r\n\tprivate setLoaded(data:any[]) {\r\n\t\tlet len = data.length;\r\n        if (len === 0) {\r\n\t\t\tthis.setPageStart(undefined);\r\n            this._items.clear();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setPageStart(data[len-1]);\r\n\t\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t\tthis._items.push(...data);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.unshift(...data.reverse());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfindItem(item:any):T {\r\n\t\tlet pid = this.getPageId(item);\r\n\t\tlet index = _.findIndex(this._items, v => this.getPageId(v) === pid);\r\n\t\tif (index < 0) return;\r\n\t\treturn this._items[index];\r\n\t\t//let oldItem = this._items[index];\r\n\t\t//let oid = this.getPageId(oldItem);\r\n\t\t//if (pid === oid) return oldItem;\r\n\t}\r\n}\r\n","class MessageHub {\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n    private msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n\tregisterReceiveHandler(handler:(msg:any)=>Promise<void>):number;\r\n\tregisterReceiveHandler(type:string, handler:(msg:any)=>Promise<void>):number;\t\r\n    registerReceiveHandler(...args:any[]):number {\r\n\t\tlet seed = this.handlerSeed++;\r\n\t\tlet args0 = args[0];\r\n\t\tlet handler:(msg:any)=>Promise<void>;\r\n\t\tswitch (typeof args0) {\r\n\t\t\tcase 'string':\r\n\t\t\t\thandler = args[1];\r\n\t\t\t\tthis.msgHandlers[seed] = {type:args0, handler};\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis.anyHandlers[seed] = args0;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn seed;\r\n    }\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n    }\r\n    async dispatch(msg:any) {\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n        }\r\n    }\r\n}\r\n\r\nexport const messageHub = new MessageHub();\r\n","// typescript version of krasimir/navigo\r\n\r\nexport type RouteFunc = (params?:string|{[name:string]:string}, query?:string) => void;\r\n\r\nexport interface NamedRoute {\r\n\tas: string;\r\n\tuses: RouteFunc;\r\n\thooks?: Hooks;\r\n}\r\nexport interface Hooks {\r\n\tbefore: (done:()=>void, params:object) => void;\r\n\tafter: (params:object) => void;\r\n\tleave: (params:object) => void;\r\n\talready: (params:object) => void;\r\n}\r\ninterface Handler {\r\n\thandler: RouteFunc;\r\n\thooks: Hooks;\r\n}\r\ninterface LastResolved {\r\n\turl: string;\r\n\tquery: string;\r\n\thooks: Hooks;\r\n\tparams?: {[name:string]:string};\r\n\tname?: string;\r\n}\r\ninterface Route {\r\n\troute: string|RegExp;\r\n\thandler: RouteFunc,\r\n\tname: string,\r\n\thooks: Hooks\r\n}\r\n\r\nexport class Navigo {\r\n\tprivate static PARAMETER_REGEXP = /([:*])(\\w+)/g;\r\n\tprivate static WILDCARD_REGEXP = /\\*/g;\r\n\tprivate static REPLACE_VARIABLE_REGEXP = '([^\\\\/]+)';   \t// 单\\，编译错误 ([^\\/]+)\r\n\tprivate static REPLACE_WILDCARD = `(?:.*)`;\r\n\tprivate static FOLLOWED_BY_SLASH_REGEXP = '(?:\\\\/$|$)';\t\t// 单\\，编译错误 (?:\\/$|$)\r\n\tprivate static MATCH_REGEXP_FLAGS = '';\r\n\r\n\tprivate static isPushStateAvailable() {\r\n\t\treturn !!(\r\n\t\t  typeof window !== 'undefined' &&\r\n\t\t  window.history &&\r\n\t\t  window.history.pushState\r\n\t\t);\r\n\t}\r\n\t\r\n\tprivate static clean(s:string|RegExp) {\r\n\t\tif (s instanceof RegExp) return s;\r\n\t\treturn Navigo.cleanUrl(s);\r\n\t}\r\n\tprivate static cleanUrl(s:string) {\r\n\t\treturn s.replace(/\\/+$/, '').replace(/^\\/+/, '^/');\r\n\t}\r\n\r\n\tprivate static regExpResultToParams(match:any[], names:string[]) {\r\n\t\tif (names.length === 0) return null;\r\n\t\tif (!match) return null;\r\n\t\treturn match\r\n\t\t  .slice(1, match.length)\r\n\t\t  .reduce((params, value, index) => {\r\n\t\t\t\tif (params === null) params = {};\r\n\t\t\t\tparams[names[index]] = decodeURIComponent(value);\r\n\t\t\t\treturn params;\r\n\t\t  }, null);\r\n\t}\r\n\t  \r\n\tprivate static replaceDynamicURLParts(route:string|RegExp) {\r\n\t\tlet paramNames:string[] = [], regexp:RegExp;\r\n\t  \r\n\t\tif (route instanceof RegExp) {\r\n\t\t\tregexp = route;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tregexp = new RegExp(\r\n\t\t\t\troute.replace(Navigo.PARAMETER_REGEXP, function (full, dots, name) {\r\n\t\t\t\t\t\tparamNames.push(name);\r\n\t\t\t\t\t\treturn Navigo.REPLACE_VARIABLE_REGEXP;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.replace(Navigo.WILDCARD_REGEXP, Navigo.REPLACE_WILDCARD) + Navigo.FOLLOWED_BY_SLASH_REGEXP\r\n\t\t\t\t, Navigo.MATCH_REGEXP_FLAGS);\r\n\t\t}\r\n\t\treturn { regexp, paramNames };\r\n\t}\r\n\t  \r\n\tprivate static getUrlDepth(url:string):number {\r\n\t\treturn url.replace(/\\/$/, '').split('/').length;\r\n\t}\r\n\t  \r\n\tprivate static compareUrlDepth(urlA:string, urlB:string) {\r\n\t\treturn Navigo.getUrlDepth(urlB) - Navigo.getUrlDepth(urlA);\r\n\t}\r\n\t  \r\n\tprivate static findMatchedRoutes(url:string, routes:Route[] = []) {\r\n\t\treturn routes.map(route => {\r\n\t\t\tlet { regexp, paramNames } = Navigo.replaceDynamicURLParts(Navigo.clean(route.route));\r\n\t\t\tlet match = url.replace(/^\\/+/, '/').match(regexp);\r\n\t\t\tlet params = Navigo.regExpResultToParams(match, paramNames);\r\n\t\t\treturn match ? { match, route, params } : false;\r\n\t\t}).filter(m => m);\r\n\t}\r\n\t  \r\n\tprivate static match(url:string, routes:Route[]) {\r\n\t\treturn Navigo.findMatchedRoutes(url, routes)[0] || false;\r\n\t}\r\n\t  \r\n\tprivate static root(url:string, routes:Route[]) {\r\n\t\tconst colonExp = RegExp('\\\\/:\\\\D(\\\\w*)', 'g');\r\n\t\tconst exp = ''; // '($|\\\\/)';  // 单\\，编译报错 ($|\\/)\r\n\t\tlet matched = routes.map(\r\n\t\t\troute => {\r\n\t\t\t\tlet r = route.route;\r\n\t\t\t\tif (r === '' || r === '*') return url;\r\n\t\t\t\tif (typeof r === 'string') {\r\n\t\t\t\t\tr = r.replace(colonExp, '\\\\/(\\\\w|%|[\\u4E00-\\u9FCC])+');\r\n\t\t\t\t}\r\n\t\t\t\tlet routeExp = r + exp;\r\n\t\t\t\tlet ret = url.split(new RegExp(routeExp))[0];\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t);\r\n\t\tlet fallbackURL = Navigo.cleanUrl(url);\r\n\t\tlet len = matched.length;\r\n\t\tif (len === 0) return fallbackURL;\r\n\t\tlet matched0 = matched[0];\r\n\t\tif (len === 1) return matched0;\r\n\t\treturn matched.reduce((result, url) => {\r\n\t\t\tif (result.length > url.length) result = url;\r\n\t\t\treturn result;\r\n\t\t}, matched0);\r\n\t}\r\n\t  \r\n\tprivate static isHashChangeAPIAvailable() {\r\n\t\treturn typeof window !== 'undefined' && 'onhashchange' in window;\r\n\t}\r\n\t  \r\n\tprivate static extractGETParameters(url:string):string {\r\n\t\treturn url.split(/\\?(.*)?$/).slice(1).join('');\r\n\t}\r\n\t  \r\n\tprivate static getOnlyURL(url:string, useHash:boolean, hash:string) {\r\n\t\tlet onlyURL = url, split:string[];\r\n\t\tvar cleanGETParam = (str:string) => str.split(/\\?(.*)?$/)[0];\r\n\t  \r\n\t\tif (typeof hash === 'undefined') {\r\n\t\t\t// To preserve BC\r\n\t\t\thash = '#';\r\n\t\t}\r\n\t  \r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t  \tonlyURL = cleanGETParam(url).split(hash)[0];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsplit = url.split(hash);\r\n\t\t\tonlyURL = split.length > 1 ? cleanGETParam(split[1]) : cleanGETParam(split[0]);\r\n\t\t}\r\n\t\treturn onlyURL;\r\n\t}\r\n\t  \r\n\tprivate static manageHooks(handler:RouteFunc, hooks:Hooks, params?:any, exHooks?:Hooks) {\r\n\t\tif (hooks && typeof hooks === 'object') {\r\n\t\t\tif (hooks.before) {\r\n\t\t\t\thooks.before((shouldRoute = true) => {\r\n\t\t\t\tif (!shouldRoute) return;\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\t}, params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if (hooks.after) {\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\thandler();\r\n\t}\r\n\t  \r\n\tprivate static isHashedRoot(url:string, useHash:boolean, hash:string) {\r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t  return false;\r\n\t\t}\r\n\t  \r\n\t\tif (!url.match(hash)) {\r\n\t\t  return false;\r\n\t\t}\r\n\t  \r\n\t\tlet split = url.split(hash);\r\n\t  \r\n\t\treturn split.length < 2 || split[1] === '';\r\n\t}\r\n\t\r\n\tprivate root:string;\r\n\tprivate _routes:Route[] = [];\r\n\tprivate _useHash:boolean;\r\n\tprivate _hash:string;\r\n\tprivate _paused:boolean;\r\n\tprivate _destroyed:boolean;\r\n\tprivate _lastRouteResolved:LastResolved;\r\n\tprivate _notFoundHandler:Handler;\r\n\tprivate _defaultHandler:Handler;\r\n\tprivate _usePushState:boolean;\r\n\tprivate _genericHooks:Hooks;\r\n\tprivate _historyUpdateMethod: 'pushState' | 'replaceState'; // HistoryUpdateMethod;\r\n\tprivate timout: any; //NodeJS.Timeout;\r\n\r\n\tconstructor(r:string = null, useHash:boolean = false, hash:string = '#') {\r\n\t\tthis.root = null;\r\n\t\tthis._useHash = useHash;\r\n\t\tthis._hash = (!hash)? '#' : hash;\r\n\t\tthis._paused = false;\r\n\t\tthis._destroyed = false;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._notFoundHandler = null;\r\n\t\tthis._defaultHandler = null;\r\n\t\tthis._usePushState = !useHash && Navigo.isPushStateAvailable();\r\n\t\t//this._onLocationChange = this._onLocationChange.bind(this);\r\n\t\tthis._genericHooks = null;\r\n\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\r\n\t\tif (r) {\r\n\t\t\tthis.root = useHash ? r.replace(/\\/$/, '/' + this._hash) : r.replace(/\\/$/, '');\r\n\t\t} else if (useHash) {\r\n\t\t\tthis.root = this._cLoc().split(this._hash)[0].replace(/\\/$/, '/' + this._hash);\r\n\t\t}\r\n\t\r\n\t\tthis._listen();\r\n\t\tthis.updatePageLinks();\r\n\t}\r\n  \r\n\tnavigate(path:string, absolute:boolean = false):Navigo {\r\n\t\tlet to:string;\r\n\t\tpath = path || '';\r\n\t\tif (this._usePushState) {\r\n\t\t\tto = (!absolute ? this._getRoot() + '/' : '') + path.replace(/^\\/+/, '/');\r\n\t\t\tto = to.replace(/([^:])(\\/{2,})/g, '$1/');\r\n\t\t\tto = to.replace('/#test/', '/');\r\n\t\t\tthis._historyUpdate({}, '', to);\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t\telse if (typeof window !== 'undefined') {\r\n\t\t\tpath = path.replace(new RegExp('^' + this._hash), '');\r\n\t\t\tlet {location} = window;\r\n\t\t\tlocation.href = location.href\r\n\t\t\t\t.replace(/#$/, '')\r\n\t\t\t\t.replace(new RegExp(this._hash + '.*$'), '') + this._hash + path;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\ton(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\ton(...args:any[]):Navigo {\r\n\t\tlet arg0 = args[0];\r\n\t\tlet arg1 = args[1];\r\n\t\tswitch (typeof arg0) {\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis._defaultHandler = { handler: arg0, hooks: arg1 };\r\n\t\t\t\tif (!this._notFoundHandler) {\r\n\t\t\t\t\tthis._notFoundHandler = this._defaultHandler;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'object':\r\n\t\t\t\tlet orderedRoutes = Object.keys(arg0).sort(Navigo.compareUrlDepth);\r\n\t\t\t\torderedRoutes.forEach(route => this.on(route, arg0[route]));\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tif (args.length < 2) break;\r\n\t\t\t\tif (arg0 === '/') {\r\n\t\t\t\t\tthis._defaultHandler = { \r\n\t\t\t\t\t\thandler: typeof arg1 === 'object'? arg1.uses : arg1, \r\n\t\t\t\t\t\thooks: args[2],\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tthis._add(arg0, arg1, args[2]);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\toff(handler:RouteFunc):Navigo {\r\n\t\tif (this._defaultHandler !== null && handler === this._defaultHandler.handler) {\r\n\t\t\tthis._defaultHandler = null;\r\n\t\t}\r\n\t\telse if (this._notFoundHandler !== null && handler === this._notFoundHandler.handler) {\r\n\t\t\tthis._notFoundHandler = null;\r\n\t\t}\r\n\t\tthis._routes = this._routes.reduce((result, r) => {\r\n\t\t\tif (r.handler !== handler) result.push(r);\r\n\t\t\treturn result;\r\n\t\t}, []);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tnotFound(handler:RouteFunc, hooks:Hooks):Navigo {\r\n\t\tthis._notFoundHandler = { handler, hooks };\r\n\t\treturn this;\r\n\t}\r\n\r\n\tresolve(current?:string) {\r\n\t\tlet c = current || this._cLoc();\r\n\t\tlet root = this._getRoot();\r\n\t\tlet url = c.replace(root, '');\r\n\t\r\n\t\tif (this._useHash) {\r\n\t\t\tconst exp = '^\\\\/';  // 单\\，编译报错 ^\\/\r\n\t\t\turl = url.replace(new RegExp(exp + this._hash), '/');\r\n\t\t}\r\n\t\r\n\t\tlet GETParameters = Navigo.extractGETParameters(current || this._cLoc());\r\n\t\tlet onlyURL = Navigo.getOnlyURL(url, this._useHash, this._hash);\r\n\t\tif (onlyURL.startsWith('/') === false) {\r\n\t\t\tonlyURL = '/' + onlyURL;\r\n\t\t}\r\n\t\r\n\t\tif (this._paused) return false;\r\n\t\r\n\t\tif (\r\n\t\t\tthis._lastRouteResolved &&\r\n\t\t\tonlyURL === this._lastRouteResolved.url &&\r\n\t\t\tGETParameters === this._lastRouteResolved.query\r\n\t\t) {\r\n\t\t\tif (this._lastRouteResolved.hooks && this._lastRouteResolved.hooks.already) {\r\n\t\t\t\tthis._lastRouteResolved.hooks.already(this._lastRouteResolved.params);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\r\n\t\tlet matched = Navigo.match(onlyURL, this._routes);\r\n\t\r\n\t\tlet manageHooks = (handler:Handler) => {\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\thooks: handler.hooks\r\n\t\t\t\t\t};\r\n\t\t\t\t\thandler.handler(GETParameters);\r\n\t\t\t\t}, handler.hooks);\r\n\t\t\t}, this._genericHooks);\r\n\t\t}\r\n\r\n\t\tif (matched === false) {\r\n\t\t\tif (this._defaultHandler && (\r\n\t\t\t\tonlyURL === '' ||\r\n\t\t\t\tonlyURL === '/' ||\r\n\t\t\t\tonlyURL === this._hash ||\r\n\t\t\t\tNavigo.isHashedRoot(onlyURL, this._useHash, this._hash)\r\n\t\t\t)) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\t\thooks: this._defaultHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._defaultHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._defaultHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._defaultHandler);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse if (this._notFoundHandler) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters,\r\n\t\t\t\t\t\t\thooks: this._notFoundHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._notFoundHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._notFoundHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._notFoundHandler);\r\n\t\t\t}\r\n\t\t\treturn false;\t\r\n\t\t}\r\n\t\tlet m = matched;\r\n\t\tif (m) {\r\n\t\t\tthis._callLeave();\r\n\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\turl: onlyURL,\r\n\t\t\t\tquery: GETParameters,\r\n\t\t\t\thooks: m.route.hooks,\r\n\t\t\t\tparams: m.params,\r\n\t\t\t\tname: m.route.name\r\n\t\t\t};\r\n\t\t\tlet handler = m.route.handler;\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tm.route.route instanceof RegExp ?\r\n\t\t\t\t\thandler(...(m.match.slice(1, m.match.length))) :\r\n\t\t\t\t\thandler(m.params, GETParameters);\r\n\t\t\t\t}, m.route.hooks, m.params, this._genericHooks);\r\n\t\t\t}, this._genericHooks, m.params);\r\n\t\t\treturn m;\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis._routes = [];\r\n\t\tthis._destroyed = true;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._genericHooks = null;\r\n\t\tclearTimeout(this.timout);\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\twindow.removeEventListener('popstate', this._onLocationChange);\r\n\t\t\twindow.removeEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t}\r\n\r\n\tupdatePageLinks() {\r\n\t\t//var self = this;\r\n\t\tif (typeof document === 'undefined') return;\r\n\t\t\tthis._findLinks().forEach(link => {\r\n\t\t\tif (!link.hasListenerAttached) {\r\n\t\t\t\tlink.addEventListener('click', (e: React.MouseEvent<HTMLElement>) => {\r\n\t\t\t\t\tif((e.ctrlKey || e.metaKey) && e.currentTarget.tagName.toLowerCase() === 'a'){ return false; }\r\n\t\t\t\t\tvar location = this.getLinkPath(link);\r\n\t\t\r\n\t\t\t\t\tif (!this._destroyed) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tthis.navigate(location.replace(/\\/+$/, '').replace(/^\\/+/, '/'));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tlink.hasListenerAttached = true;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgenerate(name:string, data:any = {}) {\r\n\t\tlet result = this._routes.reduce((result, route) => {\r\n\t\t\tif (route.name === name) {\r\n\t\t\t\tresult = route.route.toString();\r\n\t\t\t\tfor (let key in data) {\r\n\t\t\t\t\tresult = result.replace(':' + key, data[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}, '');\r\n\t\r\n\t\treturn this._useHash ? this._hash + result : result;\r\n\t}\r\n\r\n\tlink(path:string) {\r\n\t\treturn this._getRoot() + path;\r\n\t}\r\n\r\n\tpause(status:boolean = true) {\r\n\t\tthis._paused = status;\r\n\t\tif (status) {\r\n\t\t\tthis._historyUpdateMethod = 'replaceState';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\t}\r\n\t}\r\n\r\n\tresume() {\r\n\t\tthis.pause(false);\r\n\t}\r\n\r\n\thistoryAPIUpdateMethod(value:'pushState' | 'replaceState') {\r\n\t\tif (typeof value === 'undefined') return this._historyUpdateMethod;\r\n\t\tthis._historyUpdateMethod = value;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tdisableIfAPINotAvailable() {\r\n\t\tif (!Navigo.isPushStateAvailable()) {\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tlastRouteResolved() {\r\n\t\treturn this._lastRouteResolved;\r\n\t}\r\n\r\n\tgetLinkPath(link:any) {\r\n\t\treturn link.getAttribute('href');\r\n\t}\r\n\r\n\thooks(hooks:Hooks) {\r\n\t\tthis._genericHooks = hooks;\r\n\t}\r\n\r\n\tprivate _add(route:string|RegExp, handler:RouteFunc|NamedRoute, hooks:Hooks) {\r\n\t\tif (typeof route === 'string') {\r\n\t\t\troute = encodeURI(route);\r\n\t\t}\r\n\t\tthis._routes.push(\r\n\t\t\ttypeof handler === 'object' ?\r\n\t\t\t{\r\n\t\t\t\troute,\r\n\t\t\t\thandler: handler.uses,\r\n\t\t\t\tname: handler.as,\r\n\t\t\t\thooks: hooks || handler.hooks\r\n\t\t\t} \r\n\t\t\t:\r\n\t\t\t{\r\n\t\t\t\troute,\r\n\t\t\t\thandler, \r\n\t\t\t\tname: undefined,\r\n\t\t\t\thooks,\r\n\t\t\t}\r\n\t\t);\r\n\t\treturn this._add;\r\n\t}\r\n\r\n\tprivate _historyUpdate(data:any, title:string, url?:string) {\r\n\t\tswitch (this._historyUpdateMethod) {\r\n\t\t\tdefault: throw Error('unknow history method ' + this._historyUpdateMethod);\r\n\t\t\tcase 'pushState': window.history.pushState(data, title, url); return;\r\n\t\t\tcase 'replaceState': window.history.replaceState(data, title, url); return;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _getRoot() {\r\n\t\tif (this.root === null) {\r\n\t\t\tlet cLoc = this._cLoc();\r\n\t\t\tlet cLocRoot = cLoc.split('?')[0];\r\n\t\t\tthis.root = Navigo.root(cLocRoot, this._routes);\r\n\t\t}\r\n\t\tlet root = this.root.replace('#test', '');\r\n\t\treturn root;\r\n\t}\r\n\r\n\tprivate _listen() {\r\n\t\tif (this._usePushState) {\r\n\t\t\twindow.addEventListener('popstate', this._onLocationChange);\r\n\t\t}\r\n\t\telse if (Navigo.isHashChangeAPIAvailable()) {\r\n\t\t\twindow.addEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet cached = this._cLoc();\r\n\t\r\n\t\t\tlet check = () => {\r\n\t\t\t\tlet current = this._cLoc();\r\n\t\t\t\tif (cached !== current) {\r\n\t\t\t\t\tcached = current;\r\n\t\t\t\t\tthis.resolve();\r\n\t\t\t\t}\r\n\t\t\t\tif (this.timout) clearTimeout(this.timout);\r\n\t\t\t\tthis.timout = setTimeout(check, 200);\r\n\t\t\t};\r\n\t\t\tcheck();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _cLoc() {\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\t//if (typeof window.__NAVIGO_WINDOW_LOCATION_MOCK__ !== 'undefined') {\r\n\t\t\t//\treturn window.__NAVIGO_WINDOW_LOCATION_MOCK__;\r\n\t\t\t//}\r\n\t\t\tlet {href} = window.location;\r\n\t\t\treturn Navigo.cleanUrl(href);\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate _findLinks() {\r\n\t\treturn [].slice.call(document.querySelectorAll('[data-navigo]'));\r\n\t}\r\n\r\n\tprivate _onLocationChange = () => {\r\n\t\tconsole.log('_onLocationChange');\r\n\t\tthis.resolve();\r\n\t}\r\n\r\n\tprivate _callLeave() {\r\n\t\tconst lastRouteResolved = this._lastRouteResolved;\t\r\n\t\tif (lastRouteResolved) {\r\n\t\t\tlet {params, hooks} = lastRouteResolved;\r\n\t\t\tif (hooks) {\r\n\t\t\t\tif (hooks.leave) {\r\n\t\t\t\t\thooks.leave(params);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//export default Navigo;\r\nexport const navigo = new Navigo();\r\n","import * as React from 'react';\r\nimport { nav } from '../nav';\r\n\r\nexport interface PageHeaderProps {\r\n\tback?: 'back' | 'close' | 'none';\r\n\tcenter: string | JSX.Element;\r\n\tright?: JSX.Element;\r\n\tlogout?: boolean | (() => Promise<void>);\r\n\tclassName?: string;\r\n\tafterBack?: () => void;\r\n\tex?: JSX.Element;\r\n}\r\n\r\nexport function renderPageHeader(props: PageHeaderProps, inWebNav?: boolean) {\r\n\tlet onBack = async () => {\r\n\t\tawait nav.back(); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet { afterBack } = props;\r\n\t\tif (afterBack) afterBack();\r\n\t}\r\n\tlet onLogoutClick = () => {\r\n\t\tlet logout = async () => {\r\n\t\t\tlet { logout } = props;\r\n\t\t\tif (typeof logout === 'function') {\r\n\t\t\t\tawait logout();\r\n\t\t\t}\r\n\t\t\tawait nav.logout(undefined);\r\n\t\t}\r\n\t\tnav.showLogout(logout);\r\n\t}\r\n\r\n\tlet b = nav.level > 1 || window.self !== window.top;\r\n\tlet { back, right, center, logout, className, ex } = props;\r\n\tif (inWebNav === true && !back && !right && !center) return;\r\n\tlet vBack: any, debugLogout: any;\r\n\tif (logout !== undefined && window.self === window.top) {\r\n\t\tif ((typeof logout === 'boolean' && logout === true)\r\n\t\t\t|| typeof logout === 'function') {\r\n\t\t\tlet { user } = nav;\r\n\t\t\tif (user !== undefined) {\r\n\t\t\t\tlet { nick, name } = user;\r\n\t\t\t\tdebugLogout = <div className=\"d-flex align-items-center\">\r\n\t\t\t\t\t<small className=\"text-light\">{nick || name}</small>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\t\t<div className=\"ms-2 py-2 px-3 cursor-pointer\"\r\n\t\t\t\t\t\t\trole=\"button\"\r\n\t\t\t\t\t\t\tonClick={onLogoutClick}>\r\n\t\t\t\t\t\t\t<i className=\"fa fa-sign-out fa-lg\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (b) {\r\n\t\tswitch (props.back) {\r\n\t\t\tcase 'none':\r\n\t\t\t\tvBack = undefined;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\tcase 'back':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{nav.backIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'close':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{nav.backIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (window.self !== window.top) {\r\n\t\tconsole.log(document.location.href);\r\n\t\t// pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n\t}\r\n\tif (vBack === undefined && typeof center === 'string') {\r\n\t\tcenter = <div className=\"px-3\">{center}</div>;\r\n\t}\r\n\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\tlet header = <header className={className}>\r\n\t\t<nav>\r\n\t\t\t{vBack}\r\n\t\t\t{/*pop 弹出window暂时停止作用 */}\r\n\t\t\t<div>{center}</div>\r\n\t\t\t{rightView}\r\n\t\t</nav>\r\n\t\t{ex}\r\n\t</header>;\r\n\tif (inWebNav === true) return header;\r\n\treturn <>\r\n\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t{header}\r\n\t</>;\r\n}\r\n\r\nexport class PageHeader extends React.Component<PageHeaderProps> {\r\n\trender() { return renderPageHeader(this.props) }\r\n\t/*\r\n\tprivate back = async () => {\r\n\t\tawait nav.back(); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet {afterBack} = this.props;\r\n\t\tif (afterBack) afterBack();\r\n\t}\r\n\topenWindow() {\r\n\t\twindow.open(document.location.href);\r\n\t}\r\n\tprivate logoutClick = () => {\r\n\t\tnav.showLogout(this.logout);\r\n\t}\r\n\tprivate logout = async () => {\r\n\t\tlet {logout} = this.props;\r\n\t\tif (typeof logout === 'function') {\r\n\t\t\tawait logout(); \r\n\t\t}\r\n\t\tawait nav.logout(undefined);\r\n\t}\r\n\trender() {\r\n\t\tlet b = nav.level > 1 || window.self !== window.top;\r\n\t\tlet {right, center, logout, className, ex} = this.props;\r\n\t\tlet back:any, debugLogout:any;\r\n\t\tif (logout !== undefined && window.self === window.top) {\r\n\t\t\tif ((typeof logout === 'boolean' && logout === true)\r\n\t\t\t\t|| typeof logout === 'function')\r\n\t\t\t{\r\n\t\t\t\tlet {user} = nav;\r\n\t\t\t\tif (user !== undefined) {\r\n\t\t\t\t\tlet {nick, name} = user;\r\n\t\t\t\t\tdebugLogout = <div className=\"d-flex align-items-center\">\r\n\t\t\t\t\t\t<small className=\"text-light\">{nick || name}</small>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\t\t\t<div className=\"ms-2 py-2 px-3 cursor-pointer\"\r\n\t\t\t\t\t\t\t\trole=\"button\"\r\n\t\t\t\t\t\t\t\tonClick={this.logoutClick}>\r\n\t\t\t\t\t\t\t\t<i className=\"fa fa-sign-out fa-lg\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (b) {\r\n\t\t\tswitch (this.props.back) {\r\n\t\t\t\tcase 'none':\r\n\t\t\t\t\tback = undefined;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tcase 'back':\r\n\t\t\t\t\tback = <nav onClick={this.back}><i className=\"fa fa-angle-left\" /></nav>;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'close':\r\n\t\t\t\t\tback = <nav onClick={this.back}><i className=\"fa fa-close\" /></nav>;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (window.self !== window.top) {\r\n\t\t\tconsole.log(document.location.href);\r\n\t\t\t// pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n\t\t}\r\n\t\tif (back === undefined && typeof center === 'string') {\r\n\t\t\tcenter = <div className=\"px-3\">{center}</div>;\r\n\t\t}\r\n\t\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\t\tlet header = <header className={className}>\r\n\t\t\t<nav>\r\n\t\t\t\t{back}\r\n\t\t\t\t<div>{center}</div>\r\n\t\t\t\t{rightView}\r\n\t\t\t</nav>\r\n\t\t\t{ex}\r\n\t\t</header>;\r\n\t\treturn <>\r\n\t\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t\t{header}\r\n\t\t</>;\r\n\t}\r\n\t*/\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport { IVPage } from './page';\r\nimport { IObservableValue } from 'mobx';\r\nimport '../../css/va-tab.css';\r\nimport { ScrollView } from './scrollView';\r\n\r\nexport type TabCaption = (selected:boolean) => JSX.Element;\r\n\r\nexport interface TabProp {\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontent?: () => JSX.Element;\r\n\tpage?: IVPage;\r\n    notify?: IObservableValue<number>;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tisSelected?: boolean;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n}\r\n\r\nexport interface TabsProps {\r\n    tabs: TabProp[];\r\n    tabPosition?: 'top' | 'bottom';\r\n    size?: 'sm' | 'lg' | 'md';\r\n    tabBg?: string;\r\n    contentBg?: string;\r\n    sep?: string;\r\n    selected?: string;\r\n    borderColor?: string;\r\n    borderWidth?: string;\r\n}\r\n\r\nclass Tab {\r\n\t@observable private loaded: boolean = false;\r\n    name: string;\r\n    @observable selected: boolean;\r\n    caption: TabCaption;\r\n\tcontentBuilder: ()=>JSX.Element;\r\n\tpage: IVPage;\r\n    notify: IObservableValue<number>;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n\r\n    private _content: JSX.Element;\r\n    \r\n    get content(): JSX.Element {\r\n\t\tif (this.load && this.loaded === false) return null;\r\n\t\tif (this.selected === false) return this._content;\r\n\t\tif (!this._content) {\r\n\t\t\tif (this.contentBuilder !== undefined) {\r\n\t\t\t\tthis._content = this.contentBuilder();\r\n\t\t\t}\r\n\t\t\telse if (this.page !== undefined) {\r\n\t\t\t\tthis._content = this.page.content();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._content = <div className=\"p-5\">tab 应该定义content或者page</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._content;\r\n    }\r\n\r\n    async shown() {\r\n        if (this.onShown !== undefined) {\r\n            await this.onShown();\r\n        }\r\n        if (this.load !== undefined) {\r\n\t\t\tif (this.loaded === false) {\r\n\t\t\t\tawait this.load();\r\n\t\t\t\tthis.loaded = true;\r\n\t\t\t}\r\n        }\r\n    }\r\n}\r\n\r\nexport const TabCaptionComponent = (label:string, icon:string, color:string) => <div \r\n    className={'d-flex justify-content-center align-items-center flex-column cursor-pointer ' + color}>\r\n    <div><i className={'fa fa-lg fa-' + icon} /></div>\r\n    <small>{label}</small>\r\n</div>;\r\n\r\n//export const TabCaption = TabCaptionComponent;\r\n\r\nexport class TabsView {\r\n\tprivate props: TabsProps;\r\n    private size: string;\r\n    private tabBg: string;\r\n    //private contentBg: string;\r\n    private sep: string;\r\n    @observable private selectedTab: Tab;\r\n    @observable private tabArr: Tab[];\r\n\r\n    constructor(props: TabsProps) {\r\n\t\tthis.props = props;\r\n\t\tlet {size, tabs, tabBg: tabBack, sep, selected} = props;\r\n\t\tthis.size = size || 'md';\r\n        this.tabArr = tabs.map(v => {\r\n            let tab = new Tab();\r\n            let {name, caption, content, page, notify, load, onShown, isSelected, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\ttab.name = name;\r\n\t\t\tif (isSelected === true || name === selected) {\r\n\t\t\t\tthis.selectedTab = tab;\r\n\t\t\t}\r\n\t\t\ttab.selected = false;\r\n\t\t\ttab.caption = caption;\r\n\t\t\tif (content !== undefined) {\r\n\t\t\t\ttab.contentBuilder = content;\r\n\t\t\t}\r\n\t\t\telse if (page !== undefined) {\r\n\t\t\t\ttab.page = page;\r\n\t\t\t\t//contentBuilder = () => {return page.content()};\r\n\t\t\t}\r\n            tab.notify = notify;\r\n            tab.load = load;\r\n\t\t\ttab.onShown = onShown;\r\n\t\t\ttab.onScroll = onScroll;\r\n\t\t\ttab.onScrollTop = onScrollTop;\r\n\t\t\ttab.onScrollBottom = onScrollBottom;\r\n\t\t\ttab.className = className;\r\n            return tab;\r\n        });\r\n        this.tabBg = tabBack;\r\n        //this.contentBg = contentBack;\r\n        this.sep = sep;\r\n        if (this.selectedTab === undefined) {\r\n\t\t\tthis.selectedTab = this.tabArr[0];\r\n\t\t}\r\n        this.selectedTab.selected = true;\r\n    }\r\n\r\n    tabClick = async (tab:Tab) => {\r\n\t\tif (!tab) {\r\n\t\t\ttab = this.selectedTab;\r\n\t\t\tif (tab === undefined) {\r\n\t\t\t\tif (this.tabArr === undefined) return;\r\n\t\t\t\tif (this.tabArr.length === 0) return;\r\n\t\t\t\ttab = this.tabArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\r\n        this.selectedTab.selected = false;\r\n        tab.selected = true;\r\n\t\tthis.selectedTab = tab;\r\n\t\t\r\n\t\tawait tab.shown();\r\n    }\r\n\r\n\t/*\r\n    showTab(tabName: string) {\r\n        let tab = this.tabs.find(v => v.name === tabName);\r\n        if (tab === undefined) return;\r\n        if (this.selectedTab !== undefined) this.selectedTab.selected = false;\r\n        tab.selected = true;\r\n        this.selectedTab = tab;\r\n\t}\r\n\t*/\r\n\r\n\tprivate tabs = observer(() => {\r\n        let {tabPosition, borderColor} = this.props;\r\n        let bsCur:React.CSSProperties, bsTab:React.CSSProperties\r\n        if (borderColor) {\r\n            bsCur = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderLeftWidth: 1,\r\n                borderRightWidth: 1,\r\n                borderBottomWidth: 1,\r\n            }\r\n            bsTab = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderBottomWidth: 1,\r\n                borderLeftWidth: 0,\r\n                borderRightWidth: 0,\r\n            }\r\n            if (tabPosition === 'top') {\r\n                bsCur.borderBottomWidth = 0;\r\n                bsCur.borderTopLeftRadius = 10;\r\n                bsCur.borderTopRightRadius = 10;\r\n                bsTab.borderTopWidth = 0;\r\n            }\r\n            else {\r\n                bsCur.borderTopWidth = 0;\r\n                bsCur.borderBottomLeftRadius = 10;\r\n                bsCur.borderBottomRightRadius = 10;\r\n                bsTab.borderBottomWidth = 0;\r\n            }\r\n        }\r\n\t\tlet cn = classNames('tv-tabs', this.tabBg, this.sep, 'tv-tabs-' + this.size);\r\n\t\tlet tabs = <div className={cn}>\r\n            {this.tabArr.map((v,index) => {\r\n                let {selected, caption, notify} = v;\r\n                let notifyCircle:any;\r\n                if (notify !== undefined) {\r\n                    let num = notify.get();\r\n                    if (num !== undefined) {\r\n                        if (num > 0) notifyCircle = <u>{num>99?'99+':num}</u>;\r\n                        else if (num < 0) notifyCircle = <u className=\"dot\" />;\r\n                    }\r\n                }\r\n                return <div key={index} onClick={()=>this.tabClick(v)} style={selected===true? bsCur:bsTab}>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t{notifyCircle}\r\n\t\t\t\t\t{caption(selected)}\r\n\t\t\t\t\t</div>\r\n                </div>\r\n            })}\r\n\t\t</div>;\r\n\t\treturn tabs;\r\n\t});\r\n\r\n\tcontent = observer(() => {\r\n\t\tlet displayNone:React.CSSProperties = {visibility: 'hidden'};\r\n\t\treturn <>\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet {tabPosition} = this.props;\r\n\t\t\t\tlet {content, page, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\t\tlet tabs = React.createElement(this.tabs);\r\n\t\t\t\tlet pageHeader:any, pageFooter:any;\r\n\t\t\t\tif (page !== undefined) {\r\n\t\t\t\t\tpageHeader = page.header();\r\n\t\t\t\t\tpageFooter = page.footer();\r\n\t\t\t\t}\r\n\t\t\t\tlet header:any, footer:any;\r\n\t\t\t\tlet visibility:React.CSSProperties = {visibility:'hidden'};\r\n\t\t\t\tif (tabPosition === 'top') {\r\n\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t<section className=\"tv-page-header\">\r\n\t\t\t\t\t\t\t<header>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<header style={visibility}>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t\tif (pageFooter !== undefined) {\r\n\t\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t\t<footer style={visibility}>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t<section className=\"tv-page-footer\">\r\n\t\t\t\t\t\t\t\t<footer>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pageHeader !== undefined) {\r\n\t\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t\t<section className='tv-page-header'>\r\n\t\t\t\t\t\t\t\t<header>{pageHeader}</header>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t\t<header style={visibility}>{pageHeader}</header>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t<footer style={visibility}>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t<section className='tv-page-footer'>\r\n\t\t\t\t\t\t\t<footer>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = displayNone;\r\n\t\t\t\treturn <ScrollView key={index} className={className}\r\n\t\t\t\t\tstyle={style}\r\n\t\t\t\t\tonScroll={onScroll} onScrollTop={onScrollTop} onScrollBottom={onScrollBottom}>\r\n\t\t\t\t\t{header}\r\n\t\t\t\t\t{content}\r\n\t\t\t\t\t{footer}\r\n\t\t\t\t</ScrollView>;\r\n\t\t\t})}\r\n\t\t</>;\r\n\t});\r\n\r\n    render() {\r\n\t\tlet {tabPosition} = this.props;\r\n\t\tlet tabs = React.createElement(this.tabs);\r\n\t\tlet header:any, footer:any;\r\n\t\tlet visibility:React.CSSProperties = {display:'none'};\r\n\t\tif (tabPosition === 'top') {\r\n\t\t\theader = <header>{tabs}</header>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfooter = <footer>{tabs}</footer>;\r\n\t\t}\r\n\t\treturn <>\r\n\t\t\t{header}\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = visibility;\r\n\t\t\t\treturn <div key={index} className={classNames(v.className)} style={style}>\r\n\t\t\t\t\t{v.content}\r\n\t\t\t\t</div>;\r\n\t\t\t})}\r\n\t\t\t{footer}\r\n\t\t</>;\r\n    }\r\n};\r\n\r\n@observer export class Tabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n    }\r\n\r\n    render() {\r\n\t\treturn this.tabsView.render();\r\n    }\r\n};\r\n\r\n@observer export class RootTabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n    }\r\n\r\n    render() {\r\n\t\treturn React.createElement(this.tabsView.content);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport { nav } from './nav';\r\nimport { Loading } from './loading';\r\nimport { Image as ImageControl } from './image';\r\nimport { Page } from './page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { LMR } from './simple';\r\n\r\nexport interface ResUploaderProps {\r\n    className?: string;\r\n    label?: string;\r\n    multiple?: boolean;\r\n    maxSize?: number;\r\n    onFilesChange?: (evt: React.ChangeEvent<HTMLInputElement>) => void;\r\n}\r\n\r\n@observer\r\nexport class ResUploader extends React.Component<ResUploaderProps> {\r\n    private fileInput: HTMLInputElement;\r\n    @observable private fileName: string;\r\n\r\n    buildFormData(): FormData {\r\n        let { maxSize } = this.props;\r\n        if (maxSize === undefined || maxSize <= 0)\r\n            maxSize = 100000000000;\r\n        else\r\n            maxSize = maxSize * 1024;\r\n        var files: FileList = this.fileInput.files;\r\n        var data = new FormData();\r\n        let len = files.length;\r\n        for (let i = 0; i < len; i++) {\r\n            let file = files[i];\r\n            if (file.size > maxSize) return null;\r\n            data.append('files[]', file, file.name);\r\n        }\r\n    }\r\n\r\n    getFile0(): File {\r\n        return this.fileInput.files[0];\r\n    }\r\n\r\n    upload = async (formData?: FormData): Promise<string | { error: any }> => {\r\n        let resUrl = nav.resUrl + 'upload';\r\n        if (!formData) formData = this.buildFormData();\r\n        try {\r\n            nav.startWait();\r\n            let headers = new Headers();\r\n            headers.append('Access-Control-Allow-Origin', '*');\r\n            //2019-12-18：因为 vivo按oppo某些版本不支持，暂时先不要 \r\n            //let abortController = new AbortController();\r\n            let res = await fetch(resUrl, {\r\n                method: \"POST\",\r\n                body: formData,\r\n                headers: headers,\r\n                //signal: abortController.signal,\r\n            });\r\n            let json = await res.json();\r\n            return ':' + json.res.id;\r\n        }\r\n        catch (err) {\r\n            console.error('%s %s', resUrl, err);\r\n            return { error: err };\r\n        }\r\n        finally {\r\n            nav.endWait();\r\n        }\r\n    }\r\n\r\n    private onFilesChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let { onFilesChange } = this.props;\r\n        if (onFilesChange) onFilesChange(evt);\r\n        let files = evt.target.files;\r\n        let len = files.length;\r\n        let names: string[] = [];\r\n        for (let i = 0; i < len; i++) {\r\n            names.push(files.item(i).name);\r\n        }\r\n        this.fileName = names.join(', ');\r\n    }\r\n\r\n    render() {\r\n        let { className, multiple, label } = this.props;\r\n        return <div>\r\n            <label className=\"btn btn-outline-success\">\r\n                {label || '选择文件'}\r\n                <input\r\n                    className={className}\r\n                    ref={t => this.fileInput = t}\r\n                    onChange={this.onFilesChange}\r\n                    type='file' name='file'\r\n                    multiple={multiple} style={{ display: 'none' }} />\r\n            </label>\r\n            &nbsp;\r\n            {this.fileName}\r\n        </div>\r\n    }\r\n}\r\n\r\nfunction formatSize(size: number, pointLength: number = 2, units?: string[]) {\r\n    var unit;\r\n    units = units || ['B', 'K', 'M', 'G', 'TB'];\r\n    while ((unit = units.shift()) && size > 1024) {\r\n        size = size / 1024;\r\n    }\r\n    return (unit === 'B' ? size : size.toFixed(pointLength === undefined ? 2 : pointLength)) + unit;\r\n}\r\n\r\ninterface ImageUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw';\r\n    onSaved?: (imageId: string) => Promise<void>;\r\n    imageTypes?: string[];\r\n}\r\n\r\nconst xlargeSize = 1600;\r\nconst largeSize = 800;\r\nconst mediumSize = 400;\r\nconst smallSize = 180;\r\n\r\n@observer\r\nexport class ImageUploader extends React.Component<ImageUploaderProps> {\r\n    private static imageTypes = ['gif', 'jpg', 'jpeg', 'png', 'svg', 'apng', 'bmp', 'ico', 'cur', 'tiff', 'tif', 'webp'];\r\n    private imgBaseSize: number;\r\n    private imageTypes: string[];\r\n    private suffix: string;\r\n    private resUploader: ResUploader;\r\n    @observable private file: File;\r\n    @observable private desImgWidth: number;\r\n    @observable private desImgHeight: number;\r\n    @observable private desImgSize: number;\r\n    @observable private srcImgWidth: number;\r\n    @observable private srcImgHeight: number;\r\n    @observable private isChanged: boolean = false;\r\n    @observable private resId: string;\r\n    @observable private enableUploadButton: boolean = false;\r\n    @observable private srcImage: string;\r\n    @observable private desImage: string;\r\n    @observable private fileError: string;\r\n    @observable private uploaded: boolean = false;\r\n\r\n    constructor(props: ImageUploaderProps) {\r\n        super(props);\r\n        this.resId = props.id;\r\n        this.imageTypes = props.imageTypes || ImageUploader.imageTypes;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos + 1).toLowerCase();\r\n            if (this.imageTypes.indexOf(this.suffix) < 0) {\r\n                this.fileError = `图片类型必须是 ${this.imageTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n                this.srcImage = reader.result as string;\r\n                switch (this.suffix) {\r\n                    default:\r\n                        await this.setSize(this.props.size);\r\n                        break;\r\n                    case 'svg':\r\n                        this.imgBaseSize = mediumSize;\r\n                        this.desImgSize = this.srcImage.length;\r\n                        this.desImage = this.srcImage;\r\n                        break;\r\n                }\r\n            };\r\n        }\r\n    }\r\n\r\n    private async setSize(size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw') {\r\n        switch (size) {\r\n            default:\r\n            case 'sm':\r\n                this.imgBaseSize = smallSize; break;\r\n            case 'md':\r\n                this.imgBaseSize = mediumSize; break;\r\n            case 'lg':\r\n                this.imgBaseSize = largeSize; break;\r\n            case 'xl':\r\n                this.imgBaseSize = xlargeSize; break;\r\n            case 'raw':\r\n                this.imgBaseSize = -1; break;\r\n        }\r\n        this.desImage = await this.compress();\r\n    }\r\n\r\n    private compress = (): Promise<string> => {\r\n        return new Promise<string>((resolve, reject) => {\r\n            var img = new Image();\r\n            img.src = this.srcImage;\r\n            img.onload = () => {\r\n                //var that = this;\r\n                // 默认按比例压缩\r\n                let { width, height } = img;\r\n                this.srcImgWidth = width;\r\n                this.srcImgHeight = height;\r\n                let scale = width / height;\r\n                let w: number, h: number;\r\n                if (this.imgBaseSize < 0) {\r\n                    w = width;\r\n                    h = height;\r\n                }\r\n                else if (width <= this.imgBaseSize && height <= this.imgBaseSize) {\r\n                    w = width;\r\n                    h = height;\r\n                }\r\n                else if (scale < 0) {\r\n                    w = this.imgBaseSize;\r\n                    h = w / scale;\r\n                }\r\n                else {\r\n                    h = this.imgBaseSize;\r\n                    w = h * scale;\r\n                }\r\n                this.desImgWidth = Math.round(w);\r\n                this.desImgHeight = Math.round(h);\r\n                var quality = 0.7;  // 默认图片质量为0.7\r\n                //生成canvas\r\n                var canvas = document.createElement('canvas');\r\n                var ctx = canvas.getContext('2d');\r\n                // 创建属性节点\r\n                var anw = document.createAttribute(\"width\");\r\n                anw.nodeValue = String(w);\r\n                var anh = document.createAttribute(\"height\");\r\n                anh.nodeValue = String(h);\r\n                canvas.setAttributeNode(anw);\r\n                canvas.setAttributeNode(anh);\r\n                ctx.drawImage(img, 0, 0, w, h);\r\n                let base64 = canvas.toDataURL('image/' + this.suffix, quality);\r\n                let blob = this.convertBase64UrlToBlob(base64);\r\n                this.desImgSize = blob.size;\r\n                if (this.desImgSize > 3 * 1024 * 1024) {\r\n                    this.fileError = \"图片大于3M，无法上传\";\r\n                    this.enableUploadButton = false;\r\n                }\r\n                resolve(base64);\r\n            }\r\n        });\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string): Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while (n--) {\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], { type: mime });\r\n    }\r\n\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.desImage);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let { error } = ret;\r\n            let type = typeof error;\r\n            let err: string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let { onSaved } = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    private showOrgImage = () => {\r\n        nav.push(<Page header=\"原图\">\r\n            <div className=\"p-3 text-center\">\r\n                <ImageControl className=\"h-min-4c\" style={{ maxWidth: '100%' }} src={this.srcImage} />\r\n            </div>\r\n        </Page>);\r\n    }\r\n\r\n    private levelDiv() {\r\n        if (this.props.size) return;\r\n        let arr = [{ caption: '小图', size: 'sm' }];\r\n        if (this.srcImgHeight > mediumSize || this.srcImgWidth > mediumSize) {\r\n            arr.push({ caption: '中图', size: 'md' });\r\n        }\r\n        if (this.srcImgHeight > largeSize || this.srcImgWidth > largeSize) {\r\n            arr.push({ caption: '大图', size: 'lg' });\r\n        }\r\n        if (this.srcImgHeight > xlargeSize || this.srcImgWidth > xlargeSize) {\r\n            arr.push({ caption: '超大图', size: 'xl' });\r\n            arr.push({ caption: '原图', size: 'raw' });\r\n        }\r\n        if (arr.length < 2) return;\r\n        return <div>{arr.map((v, index) => {\r\n            let { caption, size } = v;\r\n            return <label key={index} className=\"me-3\"><input type=\"radio\" name=\"size\"\r\n                onChange={() => this.setSize(size as any)}\r\n                defaultChecked={index === 0} /> {caption}</label>;\r\n        })}</div>\r\n    }\r\n\r\n    render() {\r\n        let { label } = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改图片'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v => this.resUploader = v}\r\n                            multiple={false} maxSize={2048}\r\n                            label=\"选择图片文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {this.imageTypes.join(', ')} 格式图片。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                    <LMR left=\r\n                        {\r\n                            this.uploaded === true ?\r\n                                <div className=\"text-success p-2\">上传成功！</div>\r\n                                :\r\n                                this.file && this.desImgSize > 0 && <div className=\"mb-3 d-flex align-items-end\">\r\n                                    <div className=\"me-5\">\r\n                                        {this.levelDiv()}\r\n                                        <div>分辨率：{this.desImgWidth} x {this.desImgHeight}\r\n                                            &nbsp; &nbsp;\r\n                                            文件大小：{formatSize(this.desImgSize)}\r\n                                        </div>\r\n                                    </div>\r\n                                    <button className=\"btn btn-primary\"\r\n                                        disabled={!this.enableUploadButton}\r\n                                        onClick={this.upload}>上传</button>\r\n                                </div>\r\n                        }\r\n                        right={this.desImage &&\r\n                            <button className=\"btn btn-link btn-sm text-end mb-3\" onClick={this.showOrgImage}>\r\n                                原图大小: {formatSize(this.file.size)}<br />\r\n                                分辨率：{this.srcImgWidth} x {this.srcImgHeight}\r\n                            </button>\r\n                        }\r\n                    ></LMR>\r\n                </div>\r\n                <div className=\"text-center\"\r\n                    style={{\r\n                        border: (this.uploaded === true ? '2px solid green' : '1px dotted gray'),\r\n                        padding: '8px'\r\n                    }}>\r\n                    <ImageControl className=\"h-min-4c\" style={{ maxWidth: '100%' }} src={this.desImage} />\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface AudioUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    onSaved?: (imageId: string) => Promise<void>;\r\n}\r\n\r\n@observer\r\nexport class AudioUploader extends React.Component<AudioUploaderProps> {\r\n    private static audioTypes = ['mp3', 'wav'];\r\n\r\n    private suffix: string;\r\n    private resUploader: ResUploader;\r\n    @observable private content: string;\r\n    @observable private file: File;\r\n    @observable private fileSize: number;\r\n\r\n    @observable private isChanged: boolean = false;\r\n    @observable private resId: string;\r\n    @observable private enableUploadButton: boolean = false;\r\n    @observable private fileError: string;\r\n    @observable private uploaded: boolean = false;\r\n    @observable private uploading: boolean = false;\r\n\r\n    constructor(props: AudioUploaderProps) {\r\n        super(props);\r\n        this.resId = props.id;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos + 1).toLowerCase();\r\n            if (AudioUploader.audioTypes.indexOf(this.suffix) < 0) {\r\n                this.fileError = `音频类型必须是 ${AudioUploader.audioTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n                this.content = reader.result as string;\r\n                this.fileSize = this.content.length;\r\n            };\r\n        }\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string): Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while (n--) {\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], { type: mime });\r\n    }\r\n\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        this.uploading = true;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.content);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let { error } = ret;\r\n            let type = typeof error;\r\n            let err: string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let { onSaved } = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    render() {\r\n        let { label } = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改文件'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v => this.resUploader = v}\r\n                            multiple={false} maxSize={2048}\r\n                            label=\"选择音频文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {AudioUploader.audioTypes.join(', ')} 格式。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <LMR left=\r\n                {\r\n                    this.uploaded === true ?\r\n                        <div className=\"text-success p-2\">上传成功！</div>\r\n                        :\r\n                        this.uploading === true ?\r\n                            <div className=\"m-3\"><Loading /></div>\r\n                            :\r\n                            this.file && this.content && <div className=\"m-3\">\r\n                                <div className=\"mb-3\">\r\n                                    文件大小：{formatSize(this.fileSize)}\r\n                                </div>\r\n                                <button className=\"btn btn-primary\"\r\n                                    disabled={!this.enableUploadButton}\r\n                                    onClick={this.upload}>上传</button>\r\n                            </div>\r\n                }\r\n            />\r\n        </Page>;\r\n    }\r\n}\r\n","import _ from 'lodash';\r\nimport { UqApi, UqData, UnitxApi, appInFrame } from '../net';\r\nimport { Tuid, TuidDiv, TuidImport, TuidInner, TuidBox, TuidsCache } from './tuid';\r\nimport { Action } from './action';\r\nimport { Sheet } from './sheet';\r\nimport { Query } from './query';\r\nimport { Book } from './book';\r\nimport { History } from './history';\r\nimport { Map } from './map';\r\nimport { Pending } from './pending';\r\nimport { CreateBoxId, BoxId } from './tuid';\r\nimport { LocalMap, LocalCache } from '../tool';\r\nimport { UQsMan } from './uqsMan';\r\nimport { ReactBoxId } from './tuid/reactBoxId';\r\nimport { Tag } from './tag/tag';\r\nimport { UqEnum } from './enum';\r\nimport { Entity } from './entity';\r\n\r\nexport type FieldType = 'id' | 'tinyint' | 'smallint' | 'int' | 'bigint' | 'dec' | 'char' | 'text'\r\n    | 'datetime' | 'date' | 'time' | 'timestamp';\r\n\r\nexport function fieldDefaultValue(type:FieldType) {\r\n    switch (type) {\r\n        case 'tinyint':\r\n        case 'smallint':\r\n        case 'int':\r\n        case 'bigint':\r\n        case 'dec':\r\n            return 0;\r\n        case 'char':\r\n        case 'text':\r\n            return '';\r\n        case 'datetime':\r\n        case 'date':\r\n            return '2000-1-1';\r\n        case 'time':\r\n            return '0:00';\r\n    }\r\n}\r\n\r\nexport interface Field {\r\n    name: string;\r\n    type: FieldType;\r\n    tuid?: string;\r\n    arr?: string;\r\n    null?: boolean;\r\n    size?: number;\r\n    owner?: string;\r\n    _tuid: TuidBox;\r\n}\r\nexport interface ArrFields {\r\n    name: string;\r\n    fields: Field[];\r\n    id?: string;\r\n    order?: string;\r\n}\r\nexport interface FieldMap {\r\n    [name:string]: Field;\r\n}\r\nexport interface SchemaFrom {\r\n    owner:string;\r\n    uq:string;\r\n}\r\nexport interface TuidModify {\r\n    max: number;\r\n    seconds: number;\r\n}\r\n\r\nexport class UqMan {\r\n\tprivate readonly enums: {[name:string]: UqEnum} = {};\r\n    private readonly actions: {[name:string]: Action} = {};\r\n    private readonly sheets: {[name:string]: Sheet} = {};\r\n    private readonly queries: {[name:string]: Query} = {};\r\n    private readonly books: {[name:string]: Book} = {};\r\n    private readonly maps: {[name:string]: Map} = {};\r\n    private readonly histories: {[name:string]: History} = {};\r\n\tprivate readonly pendings: {[name:string]: Pending} = {};\r\n\tprivate readonly tags: {[name:string]: Tag} = {};\r\n    private readonly tuidsCache: TuidsCache;\r\n    private readonly localAccess: LocalCache;\r\n    private readonly tvs:{[entity:string]:(values:any)=>JSX.Element};\r\n    readonly localMap: LocalMap;\r\n    readonly localModifyMax: LocalCache;\r\n    readonly tuids: {[name:string]: Tuid} = {};\r\n    readonly createBoxId: CreateBoxId;\r\n    readonly newVersion: boolean;\r\n    readonly uqOwner: string;\r\n    readonly uqName: string;\r\n    readonly name: string;\r\n    readonly uqApi: UqApi;\r\n    readonly id: number;\r\n\r\n    uqVersion: number;\r\n\r\n    constructor(uqs:UQsMan, uqData: UqData, createBoxId:CreateBoxId, tvs:{[entity:string]:(values:any)=>JSX.Element}) {\r\n        this.createBoxId = createBoxId;\r\n        if (createBoxId === undefined) {\r\n            this.createBoxId = this.createBoxIdFromTVs;\r\n            this.tvs = tvs || {};\r\n        }\r\n        let {id, uqOwner, uqName, access, newVersion} = uqData;\r\n        this.newVersion = newVersion;\r\n        this.uqOwner = uqOwner;\r\n        this.uqName = uqName;\r\n        this.id = id;\r\n        this.name = uqOwner + '/' + uqName;\r\n        this.uqVersion = 0;\r\n        this.localMap = uqs.localMap.map(this.name);\r\n        this.localModifyMax = this.localMap.child('$modifyMax');\r\n        this.localAccess = this.localMap.child('$access');\r\n        //let hash = document.location.hash;\r\n        let baseUrl = 'tv/';\r\n\r\n        let acc: string[];\r\n        if (access === null || access === undefined || access === '*') {\r\n            acc = [];\r\n        }\r\n        else {\r\n            acc = access.split(';').map(v => v.trim()).filter(v => v.length > 0);\r\n        }\r\n        if (this.name === '$$$/$unitx') {\r\n            // 这里假定，点击home link之后，已经设置unit了\r\n            // 调用 UnitxApi会自动搜索绑定 unitx service\r\n            this.uqApi = new UnitxApi(appInFrame.unit);\r\n        }\r\n        else {\r\n            let {appOwner, appName} = uqs;\r\n            this.uqApi = new UqApi(baseUrl, appOwner, appName, uqOwner, uqName, acc, true);\r\n        }\r\n        this.tuidsCache = new TuidsCache(this);\r\n    }\r\n\r\n    get entities() {\r\n        return _.merge({}, \r\n            this.actions, this.sheets, this.queries, this.books,\r\n\t\t\tthis.maps, this.histories, this.pendings, this.tuids,\r\n\t\t\tthis.tags,\r\n        );\r\n    }\r\n\r\n    private createBoxIdFromTVs:CreateBoxId = (tuid:Tuid, id:number):BoxId =>{\r\n        let {name} = tuid;\r\n        /*\r\n        let tuidUR = this.tuidURs[name];\r\n        if (tuidUR === undefined) {\r\n            let {ui, res} = this.getUI(tuid);\r\n            this.tuidURs[name] = tuidUR = new TuidWithUIRes(tuid, ui, res);\r\n        }\r\n        */\r\n        return new ReactBoxId(id, tuid, this.tvs[name]);\r\n    }\r\n\r\n    tuid(name:string):Tuid {return this.tuids[name.toLowerCase()]}\r\n    tuidDiv(name:string, div:string):TuidDiv {\r\n        let tuid = this.tuids[name.toLowerCase()]\r\n        return tuid && tuid.div(div.toLowerCase());\r\n    }\r\n    action(name:string):Action {return this.actions[name.toLowerCase()]}\r\n    sheet(name:string):Sheet {return this.sheets[name.toLowerCase()]}\r\n    query(name:string):Query {return this.queries[name.toLowerCase()]}\r\n    book(name:string):Book {return this.books[name.toLowerCase()]}\r\n    map(name:string):Map {return this.maps[name.toLowerCase()]}\r\n    history(name:string):History {return this.histories[name.toLowerCase()]}\r\n    pending(name:string):Pending {return this.pendings[name.toLowerCase()]}\r\n\r\n    sheetFromTypeId(typeId:number):Sheet {\r\n        for (let i in this.sheets) {\r\n            let sheet = this.sheets[i];\r\n            if (sheet.typeId === typeId) return sheet;\r\n        }\r\n    }\r\n\r\n    readonly tuidArr: Tuid[] = [];\r\n    readonly actionArr: Action[] = [];\r\n    readonly enumArr: UqEnum[] = [];\r\n    readonly sheetArr: Sheet[] = [];\r\n    readonly queryArr: Query[] = [];\r\n    readonly bookArr: Book[] = [];\r\n    readonly mapArr: Map[] = [];\r\n    readonly historyArr: History[] = [];\r\n    readonly pendingArr: Pending[] = [];\r\n    readonly tagArr: Tag[] = [];\r\n\r\n    async init() {\r\n        await this.uqApi.init();\r\n    }\r\n\r\n    async loadEntities(): Promise<string> {\r\n        try {\r\n            let accesses = this.localAccess.get();\r\n            if (!accesses) {\r\n                accesses = await this.uqApi.loadAccess();\r\n            }\r\n            if (!accesses) return;\r\n            this.buildEntities(accesses);\r\n        }\r\n        catch (err) {\r\n            return err;\r\n        }\r\n    }\r\n\r\n\tbuildEntities(entities:any) {\r\n        if (entities === undefined) {\r\n            debugger;\r\n        }\r\n        this.localAccess.set(entities);\r\n        let {access, tuids, version} = entities;\r\n        this.uqVersion = version;\r\n        this.buildTuids(tuids);\r\n        this.buildAccess(access);\r\n\t}\r\n\t\r\n    private buildTuids(tuids:any) {\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let {typeId, from} = schema;\r\n            let tuid = this.newTuid(i, typeId, from);\r\n            tuid.sys = true;\r\n        }\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let tuid = this.getTuid(i);\r\n            tuid.setSchema(schema);\r\n        }\r\n        for (let i in this.tuids) {\r\n            let tuid = this.tuids[i];\r\n            tuid.buildFieldsTuid();\r\n        }\r\n\t}\r\n\r\n    async loadEntitySchema(entityName: string): Promise<any> {\r\n        return await this.uqApi.schema(entityName);\r\n    }\r\n\r\n\tasync loadAllSchemas():Promise<void> {\r\n\t\tlet ret = await this.uqApi.allSchemas();\r\n\t\tlet entities: Entity[][] = [\r\n\t\t\tthis.actionArr, \r\n\t\t\tthis.enumArr,\r\n\t\t\tthis.sheetArr,\r\n\t\t\tthis.queryArr,\r\n\t\t\tthis.bookArr,\r\n\t\t\tthis.mapArr,\r\n\t\t\tthis.historyArr,\r\n\t\t\tthis.pendingArr,\r\n\t\t\tthis.tagArr,\r\n\t\t];\r\n\t\tentities.forEach(arr => {\r\n\t\t\tarr.forEach(v => {\r\n\t\t\t\tlet entity = ret[v.name.toLowerCase()];\r\n\t\t\t\tif (!entity) return;\r\n\t\t\t\tlet schema = entity.call;\r\n\t\t\t\tif (!schema) return;\r\n\t\t\t\tv.buildSchema(schema);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n    getTuid(name:string): Tuid {\r\n        return this.tuids[name];\r\n    }\r\n\r\n    private buildAccess(access:any) {\r\n        for (let a in access) {\r\n            let v = access[a];\r\n            switch (typeof v) {\r\n                case 'string': this.fromType(a, v); break;\r\n                case 'object': this.fromObj(a, v); break;\r\n            }\r\n        }\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.tuidsCache.cacheTuids(defer);\r\n    }\r\n\r\n    newEnum(name:string, id:number):UqEnum {\r\n        let enm = this.enums[name];\r\n        if (enm !== undefined) return enm;\r\n        enm = this.enums[name] = new UqEnum(this, name, id)\r\n        this.enumArr.push(enm);\r\n        return enm;\r\n    }\r\n\tnewAction(name:string, id:number):Action {\r\n        let action = this.actions[name];\r\n        if (action !== undefined) return action;\r\n        action = this.actions[name] = new Action(this, name, id)\r\n        this.actionArr.push(action);\r\n        return action;\r\n    }\r\n    private newTuid(name:string, id:number, from:SchemaFrom):Tuid {\r\n        let tuid = this.tuids[name];\r\n        if (tuid !== undefined) return tuid;\r\n        if (from !== undefined)\r\n            tuid = new TuidImport(this, name, id, from);\r\n        else\r\n            tuid = new TuidInner(this, name, id);\r\n        this.tuids[name] = tuid;\r\n        this.tuidArr.push(tuid);\r\n        return tuid;\r\n    }\r\n    newQuery(name:string, id:number):Query {\r\n        let query = this.queries[name];\r\n        if (query !== undefined) return query;\r\n        query = this.queries[name] = new Query(this, name, id)\r\n        this.queryArr.push(query);\r\n        return query;\r\n    }\r\n    private newBook(name:string, id:number):Book {\r\n        let book = this.books[name];\r\n        if (book !== undefined) return book;\r\n        book = this.books[name] = new Book(this, name, id);\r\n        this.bookArr.push(book);\r\n        return book;\r\n    }\r\n    private newMap(name:string, id:number):Map {\r\n        let map = this.maps[name];\r\n        if (map !== undefined) return map;\r\n        map = this.maps[name] = new Map(this, name, id)\r\n        this.mapArr.push(map);\r\n        return map;\r\n    }\r\n    private newTag(name:string, id:number):Tag {\r\n        let tag = this.tags[name];\r\n        if (tag !== undefined) return tag;\r\n        tag = this.tags[name] = new Tag(this, name, id)\r\n        this.tagArr.push(tag);\r\n        return tag;\r\n    }\r\n    private newHistory(name:string, id:number):History {\r\n        let history = this.histories[name];\r\n        if (history !== undefined) return;\r\n        history = this.histories[name] = new History(this, name, id)\r\n        this.historyArr.push(history);\r\n        return history;\r\n    }\r\n    private newPending(name:string, id:number):Pending {\r\n        let pending = this.pendings[name];\r\n        if (pending !== undefined) return;\r\n        pending = this.pendings[name] = new Pending(this, name, id)\r\n        this.pendingArr.push(pending);\r\n        return pending;\r\n    }\r\n    newSheet(name:string, id:number):Sheet {\r\n        let sheet = this.sheets[name];\r\n        if (sheet !== undefined) return sheet;\r\n        sheet = this.sheets[name] = new Sheet(this, name, id);\r\n        this.sheetArr.push(sheet);\r\n        return sheet;\r\n    }\r\n    private fromType(name:string, type:string) {\r\n        let parts = type.split('|');\r\n        type = parts[0];\r\n        let id = Number(parts[1]);\r\n        switch (type) {\r\n            //case 'uq': this.id = id; break;\r\n            case 'tuid':\r\n                // Tuid should not be created here!;\r\n                //let tuid = this.newTuid(name, id);\r\n                //tuid.sys = false;\r\n                break;\r\n            case 'action': this.newAction(name, id); break;\r\n            case 'query': this.newQuery(name, id); break;\r\n            case 'book': this.newBook(name, id); break;\r\n            case 'map': this.newMap(name, id); break;\r\n            case 'history': this.newHistory(name, id); break;\r\n            case 'sheet':this.newSheet(name, id); break;\r\n\t\t\tcase 'pending': this.newPending(name, id); break;\r\n\t\t\tcase 'tag': this.newTag(name, id); break;\r\n\t\t\tcase 'enum': this.newEnum(name, id); break;\r\n        }\r\n    }\r\n    private fromObj(name:string, obj:any) {\r\n        switch (obj['$']) {\r\n            case 'sheet': this.buildSheet(name, obj); break;\r\n        }\r\n    }\r\n    private buildSheet(name:string, obj:any) {\r\n        let sheet = this.sheets[name];\r\n        if (sheet === undefined) sheet = this.newSheet(name, obj.id);\r\n        sheet.build(obj);\r\n    }\r\n    buildFieldTuid(fields:Field[], mainFields?:Field[]) {\r\n        if (fields === undefined) return;\r\n        for (let f of fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            f._tuid = t.buildTuidBox();\r\n        }\r\n        for (let f of fields) {\r\n            let {owner} = f;\r\n            if (owner === undefined) continue;\r\n            let ownerField = fields.find(v => v.name === owner);\r\n            if (ownerField === undefined) {\r\n                if (mainFields !== undefined) {\r\n                    ownerField = mainFields.find(v => v.name === owner);\r\n                }\r\n                if (ownerField === undefined) {\r\n                    debugger;\r\n                    throw new Error(`owner field ${owner} is undefined`);\r\n                }\r\n            }\r\n            let {arr, tuid} = f;\r\n            let t = this.getTuid(ownerField._tuid.tuid.name);\r\n            if (t === undefined) continue;\r\n            let div = t.div(arr || tuid);\r\n            f._tuid = div && div.buildTuidDivBox(ownerField);\r\n            if (f._tuid === undefined) {\r\n                debugger;\r\n                throw new Error(`owner field ${owner} is not tuid`);\r\n            }\r\n        }\r\n    }\r\n    buildArrFieldsTuid(arrFields:ArrFields[], mainFields:Field[]) {\r\n        if (arrFields === undefined) return;\r\n        for (let af of arrFields) {\r\n            let {fields} = af;\r\n            if (fields === undefined) continue;\r\n            this.buildFieldTuid(fields, mainFields);\r\n        }\r\n    }\r\n\r\n    pullModify(modifyMax:number) {\r\n        this.tuidsCache.pullModify(modifyMax);\r\n    }\r\n}\r\n","import { Entity } from './entity';\r\nimport { PageItems } from '../tool/pageItems';\r\nimport { EntityCaller } from './caller';\r\nimport { ArrFields } from './uqMan';\r\n\r\nexport interface SheetState {\r\n    name: string;\r\n    actions: SheetAction[];\r\n}\r\n\r\nexport interface SheetAction {\r\n    name: string;\r\n}\r\n\r\nexport interface StateCount {\r\n    state: string;\r\n    count: number;\r\n}\r\n\r\nexport interface SheetSaveReturnV<V> {\r\n    id: number;\r\n    flow: number;\r\n    state: string;\r\n    verify: V[];\r\n}\r\n\r\nexport interface SheetSaveReturn extends SheetSaveReturnV<any> {\r\n}\r\n\r\ninterface GetSheetReturn<M> {\r\n    brief: any;\r\n    data: M;\r\n    flows: any[];\r\n}\r\n\r\nexport class UqSheet<M, V> extends Entity {\r\n    get typeName(): string { return 'sheet'; }\r\n    states: SheetState[];\r\n    verify: { returns: ArrFields[] };\r\n\r\n    /*\r\n    setStates(states: SheetState[]) {\r\n        for (let state of states) {\r\n            this.setStateAccess(this.states.find(s=>s.name==state.name), state);\r\n        }\r\n    }*/\r\n    setSchema(schema: any) {\r\n        super.setSchema(schema);\r\n        this.states = schema.states;\r\n        this.verify = schema.verify;\r\n    }\r\n    build(obj: any) {\r\n        this.states = [];\r\n        for (let op of obj.ops) {\r\n            this.states.push({ name: op, actions: undefined });\r\n        }\r\n        /*\r\n        for (let p in obj) {\r\n            switch(p) {\r\n                case '#':\r\n                case '$': continue;\r\n                default: this.states.push(this.createSheetState(p, obj[p])); break;\r\n            }\r\n        }*/\r\n    }\r\n    private createSheetState(name: string, obj: object): SheetState {\r\n        let ret: SheetState = { name: name, actions: [] };\r\n        let actions = ret.actions;\r\n        for (let p in obj) {\r\n            let action: SheetAction = { name: p };\r\n            actions.push(action);\r\n        }\r\n        return ret;\r\n    }\r\n    async save(discription: string, data: M): Promise<SheetSaveReturn> {\r\n        let { id } = this.uq;\r\n        let params = { app: id, discription: discription, data: data };\r\n        return await new SaveCaller(this, params).request();\r\n    }\r\n    async saveDebugDirect(discription: string, data: M): Promise<SheetSaveReturn> {\r\n        let { id } = this.uq;\r\n        let params = { app: id, discription: discription, data: data };\r\n        return await new SaveDirectCaller(this, params).request();\r\n    }\r\n    async action(id: number, flow: number, state: string, action: string) {\r\n        return await new ActionCaller(this, { id: id, flow: flow, state: state, action: action }).request();\r\n    }\r\n    async actionDebugDirect(id: number, flow: number, state: string, action: string) {\r\n        return await new ActionDirectCaller(this, { id: id, flow: flow, state: state, action: action }).request();\r\n    }\r\n    private unpack(data: any): GetSheetReturn<M> {\r\n        //if (this.schema === undefined) await this.loadSchema();\r\n        let ret = data[0];\r\n        let brief = ret[0];\r\n        let sheetData = this.unpackSheet(brief.data);\r\n        let flows = data[1];\r\n        return {\r\n            brief: brief,\r\n            data: sheetData,\r\n            flows: flows,\r\n        }\r\n    }\r\n    async getSheet(id: number): Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.getSheet(this.name, id);\r\n        */\r\n        let ret = await new GetSheetCaller(this, id).request();\r\n        if (ret[0].length === 0) return await this.getArchive(id);\r\n        return this.unpack(ret);\r\n    }\r\n    async getArchive(id: number): Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchive(this.name, id)\r\n        return this.unpack(ret);\r\n        */\r\n        let ret = await new SheetArchiveCaller(this, id).request();\r\n        return this.unpack(ret);\r\n    }\r\n\r\n    async getArchives(pageStart: number, pageSize: number) {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchives(this.name, {pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = { pageStart: pageStart, pageSize: pageSize };\r\n        return await new SheetArchivesCaller(this, params).request();\r\n    }\r\n\r\n    async getStateSheets(state: string, pageStart: number, pageSize: number): Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.stateSheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = { state: state, pageStart: pageStart, pageSize: pageSize };\r\n        return await new StateSheetsCaller(this, params).request();\r\n    }\r\n    createPageStateItems<T>(): PageStateItems<T> { return new PageStateItems<T>(this); }\r\n\r\n    async stateSheetCount(): Promise<StateCount[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret:StateCount[] = await this.uqApi.stateSheetCount(this.name);\r\n        return this.states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = ret.find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n        */\r\n        return await new StateSheetCountCaller(this, undefined).request();\r\n    }\r\n\r\n    async userSheets(state: string, user: number, pageStart: number, pageSize: number): Promise<any[]> {\r\n        let params = { state: state, user: user, pageStart: pageStart, pageSize: pageSize };\r\n        return await new UserSheetsCaller(this, params).request();\r\n    }\r\n\r\n    async mySheets(state: string, pageStart: number, pageSize: number): Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.mySheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = { state: state, pageStart: pageStart, pageSize: pageSize };\r\n        return await new MySheetsCaller(this, params).request();\r\n    }\r\n}\r\n\r\nexport class Sheet extends UqSheet<any, any> {\r\n}\r\n\r\nabstract class SheetCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Sheet { return this._entity as Sheet; }\r\n    protected readonly suffix: string;\r\n    get path(): string { return `sheet/${this.entity.name}/${this.suffix}`; }\r\n}\r\n\r\nclass SaveCaller extends SheetCaller<{ app: number; discription: string; data: any }> {\r\n    get path(): string { return `sheet/${this.entity.name}`; }\r\n    buildParams() {\r\n        let { app, discription, data } = this.params;\r\n        return {\r\n            app: app,\r\n            discription: discription,\r\n            data: this.entity.pack(data)\r\n        };\r\n    }\r\n    xresult(res: any): any {\r\n        let { verify } = this.entity;\r\n        if (verify === undefined) return res;\r\n        let resVerify = res.verify;\r\n        if (resVerify === undefined || resVerify.length === 0) {\r\n            res.verify = undefined;\r\n            return res;\r\n        }\r\n        let { returns } = verify;\r\n        res.verify = this.entity.unpackReturns(resVerify, returns);\r\n        return res;\r\n    }\r\n}\r\n\r\nclass SaveDirectCaller extends SaveCaller {\r\n    get path(): string { return `sheet/${this.entity.name}/direct`; }\r\n}\r\n\r\nclass ActionCaller extends SheetCaller<{ id: number, flow: number, state: string, action: string }> {\r\n    method = 'PUT';\r\n    get path(): string { return `sheet/${this.entity.name}`; }\r\n}\r\n\r\nclass ActionDirectCaller extends ActionCaller {\r\n    get path(): string { return `sheet/${this.entity.name}/direct`; }\r\n}\r\n\r\nclass GetSheetCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //private id:number;\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() { }\r\n    get path(): string { return `sheet/${this.entity.name}/get/${this.params}`; }\r\n}\r\n\r\nclass SheetArchiveCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() { }\r\n    get path(): string { return `sheet/${this.entity.name}/archive/${this.params}`; }\r\n}\r\n\r\nclass SheetArchivesCaller extends SheetCaller<{ pageStart: number, pageSize: number }> {\r\n    protected readonly suffix = 'archives';\r\n}\r\n\r\nclass StateSheetsCaller extends SheetCaller<{ state: string, pageStart: number, pageSize: number }> {\r\n    protected readonly suffix = 'states';\r\n}\r\n\r\nclass StateSheetCountCaller extends SheetCaller<undefined> {\r\n    method = 'GET';\r\n    protected readonly suffix = 'statecount';\r\n    xresult(res: any): any {\r\n        let { states } = this.entity;\r\n        return states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = (res as any[]).find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return { state: n, count: count }\r\n        });\r\n    }\r\n}\r\n\r\nclass UserSheetsCaller extends SheetCaller<{ state: string, user: number, pageStart: number, pageSize: number }> {\r\n    protected readonly suffix = 'user-sheets';\r\n    xresult(res: any): any {\r\n        return res;\r\n    }\r\n}\r\n\r\nclass MySheetsCaller extends SheetCaller<{ state: string, pageStart: number, pageSize: number }> {\r\n    protected readonly suffix = 'my-sheets';\r\n    xresult(res: any): any {\r\n        return res;\r\n    }\r\n}\r\n\r\nexport class PageStateItems<T> extends PageItems<T> {\r\n    private sheet: Sheet;\r\n    constructor(sheet: Sheet) {\r\n        super(true);\r\n        this.sheet = sheet;\r\n        this.pageSize = 10;\r\n    }\r\n    protected async loadResults(param: any, pageStart: any, pageSize: number): Promise<{ [name: string]: any[] }> {\r\n        let ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n        return { $page: ret };\r\n    }\r\n    /*\r\n    protected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n        let ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n        return ret;\r\n    }\r\n    */\r\n    protected getPageId(item: T) {\r\n        return item === undefined ? 0 : (item as any).id;\r\n    }\r\n    /*\r\n    protected setPageStart(item:any) {\r\n        this.pageStart = item === undefined? 0 : item.id;\r\n    }\r\n    */\r\n}\r\n","import {Query} from './query';\r\nimport { QueryQueryCaller } from './caller';\r\n\r\nexport class Book extends Query {\r\n    get typeName(): string { return 'book';}\r\n    protected queryApiName = 'book';\r\n\r\n    protected queryCaller(params: any): QueryQueryCaller {\r\n        return new BookQueryCaller(this, params);\r\n    }\r\n}\r\n\r\nexport class BookQueryCaller extends QueryQueryCaller {\r\n    get path():string {return `book/${this.entity.name}`;}\r\n}\r\n","import {Query} from './query';\r\n\r\nexport class History extends Query {\r\n    get typeName(): string { return 'history';}\r\n    protected queryApiName = 'history';\r\n}\r\n","import { Entity } from './entity';\r\nimport { Action, ActionSubmitCaller } from './action';\r\nimport { Query } from './query';\r\nimport { Field } from './uqMan';\r\nimport { EntityCaller, QueryPageCaller, QueryQueryCaller } from './caller';\r\n\r\ninterface MapActions {\r\n    add: Action;\r\n    del: Action;\r\n}\r\ninterface MapQueries {\r\n    all: Query;\r\n    page: Query;\r\n    query: Query;\r\n}\r\n\r\nexport class Map extends Entity {\r\n    get typeName(): string { return 'map';}\r\n    keys: Field[];\r\n    actions: MapActions = {} as any;\r\n    queries: MapQueries = {} as any;\r\n    schemaFrom: {owner:string; uq:string};\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.schemaFrom = this.schema.from;\r\n        let {actions, queries, keys} = schema;\r\n        this.uq.buildFieldTuid(this.keys = keys);\r\n        for (let i in actions) {\r\n            let actionSchema = actions[i];\r\n            let {name} = actionSchema;\r\n            let action = this.uq.newAction(name, undefined);\r\n            action.setSchema(actionSchema);\r\n            action.buildFieldsTuid();\r\n            (this.actions as any)[i] = action;\r\n        }\r\n        for (let i in queries) {\r\n            let querySchema = queries[i];\r\n            let {name} = querySchema;\r\n            let query = this.uq.newQuery(name, undefined);\r\n            query.setSchema(querySchema);\r\n            query.buildFieldsTuid();\r\n            (this.queries as any)[i] = query;\r\n        }\r\n    }\r\n\r\n    async add(param:any) {\r\n        let ret = await new AddCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async del(param:any) {\r\n        let ret = await new DelCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async all() {\r\n        let ret = await new AllCaller(this, undefined).request();\r\n        return ret;\r\n    }\r\n\r\n    async page(param:any, pageStart:any, pageSize: number) {\r\n        let ret = await new PageCaller(this, {pageStart:pageStart, pageSize:pageSize, param:param}).request();\r\n        return ret;\r\n    }\r\n\r\n    async query(param:any) {\r\n       let qc = new QueryCaller(this, param);\r\n       let ret = await qc.request();\r\n       return ret;\r\n   }\r\n    async table(params:any): Promise<any[]> {\r\n        let ret = await this.query(params);\r\n        for (let i in ret) {\r\n            return ret[i];\r\n        }\r\n    }\r\n    async obj(params:any):Promise<any> {\r\n        let ret = await this.table(params);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:any):Promise<any> {\r\n        let ret = await this.obj(params);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nabstract class MapCaller extends EntityCaller<any> {\r\n    protected get entity(): Map {return this._entity as Map;}\r\n    get path():string {return undefined;}\r\n\r\n    protected abstract getCaller(param: any):EntityCaller<any>;\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        let caller = this.getCaller(this.params);\r\n        let res = await this.entity.uqApi.xcall(caller);\r\n        let ret = caller.xresult(res.res);\r\n        return {res: ret};\r\n    }\r\n\r\n    buildParams() {\r\n        let p = super.buildParams();\r\n        return p;\r\n    }\r\n}\r\n\r\nclass AddCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAddCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass DelCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapDelCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass AllCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAllCaller(this.entity, this.entity.queries.all, param);\r\n    }\r\n}\r\n\r\nclass PageCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapPageCaller(this.entity, this.entity.queries.page, param);\r\n    }\r\n}\r\n\r\nclass QueryCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapQueryCaller(this.entity, this.entity.queries.query, param);\r\n    }\r\n}\r\n\r\nclass MapAddCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/add`}\r\n    get headers(): {[header:string]: string} {return undefined;}\r\n}\r\n\r\nclass MapDelCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/del`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapAllCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/all`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapPageCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/page`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapQueryCaller extends QueryQueryCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/query`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n","import {Query} from './query';\r\n\r\nexport class Pending extends Query {\r\n    get typeName(): string { return 'pending';}\r\n    protected queryApiName = 'pending';\r\n}\r\n","import { Entity } from \"./entity\";\r\n\r\nexport class UqEnum extends Entity {\r\n    get typeName(): string { return 'enum';}\r\n}","export * from './rule';\r\nexport * from './field';\r\nexport * from './face';\r\nexport * from './rowContainer';\r\nexport * from './formView';\r\nexport * from './TonvaForm';\r\nexport {ControlBase} from './control';\r\n","import * as React from 'react';\r\nimport {FormEvent} from 'react';\r\nimport {computed} from 'mobx';\r\nimport {uid} from 'tonva';\r\nimport {Rule} from './rule';\r\nimport {Field} from './field';\r\nimport {Face} from './face';\r\nimport {CreateControl, ButtonsControl} from './control';\r\nimport {RowContainer, CreateRow, bootstrapCreateRow, elementCreateRow} from './rowContainer';\r\n\r\nexport interface FieldView {\r\n    field: Field;\r\n    face?: Face;\r\n}\r\n\r\nexport interface LabeledRow {\r\n    label?: string;\r\n    createRow?: CreateRow;\r\n    createControl?: CreateControl;\r\n    help?: JSX.Element;\r\n}\r\n\r\nexport interface FieldRow extends LabeledRow, FieldView {\r\n}\r\n\r\nexport interface GroupRow extends LabeledRow {\r\n    group: FieldView[];\r\n}\r\n\r\nexport type LabelFormRow = FieldRow|GroupRow|LabeledRow;\r\nexport type FormRow = LabelFormRow|JSX.Element;\r\n\r\nexport interface SubmitResult {\r\n    success: boolean;\r\n    message?: string\r\n    result?: any;\r\n}\r\n\r\nexport interface FormProps {\r\n    formRows: FormRow[];\r\n    //context?: any;              // form context，比如，可以是EntitiesUI\r\n    rules?: Rule | Rule[];\r\n    onSubmit: (values:any) => Promise<SubmitResult|undefined>;\r\n    submitButton?: string|JSX.Element;\r\n    otherButton?: string|JSX.Element;\r\n    onOther?: (values:any) => void;\r\n    createRow?: CreateRow;\r\n    createControl?: CreateControl;\r\n    readOnly?: boolean;\r\n}\r\n\r\nexport class FormView {\r\n    uid:string;\r\n    private rows: RowContainer[] = [];\r\n    private buttonsRow: RowContainer;\r\n    props: FormProps;\r\n    createControl?: CreateControl;\r\n    constructor(props:FormProps) {\r\n        this.uid = uid();\r\n        this.props = props;\r\n        this.buildRows(props);\r\n        this.createControl = props.createControl;\r\n        this.onSubmit = this.onSubmit.bind(this);\r\n    }\r\n\r\n    @computed get hasError():boolean {\r\n        let ret = this.rows.map((v, index) => index + ': ' + v.hasError + '\\n');\r\n        console.log(ret);\r\n        return this.rows.some(row => row.hasError);\r\n    }\r\n    @computed get nothing():boolean {\r\n        let ret = this.rows.every(row => !row.filled);\r\n        return ret;\r\n    }\r\n\r\n    readValues():any {\r\n        let values = {} as any;\r\n        for (let row of this.rows) {\r\n            row.readValues(values);\r\n        }\r\n        return values;\r\n    }\r\n\r\n    clear() {\r\n        for (let row of this.rows) {\r\n            row.clear();\r\n        }\r\n    }\r\n\r\n    clearErrors() {\r\n        for (let row of this.rows) {\r\n            row.clearErrors();\r\n        }\r\n    }\r\n\r\n    setError(fieldName:string, error:string) {\r\n        for (let row of this.rows) {\r\n            row.setError(fieldName, error);\r\n        }\r\n    }\r\n\r\n    setInitValues(initValues:any) {\r\n        if (initValues === undefined) return;\r\n        for (let row of this.rows) {\r\n            row.setInitValues(initValues);\r\n        }\r\n    }\r\n\r\n    private buildRows(props:FormProps) {\r\n        let {formRows, createRow} = props;\r\n        if (formRows !== undefined) {\r\n            for (let row of formRows) {\r\n                this.rows.push(this.buildRow(row, createRow));\r\n            }\r\n            if (this.props.readOnly !== true) {\r\n                this.buttonsRow = this.buildRow({createControl:this.createButtons.bind(this)}, undefined);\r\n            }\r\n        }\r\n        else {\r\n            this.rows.push(elementCreateRow(this, <div className=\"text-warning\">TonvaForm need formRows defined</div>));\r\n        }\r\n    }\r\n\r\n    private buildRow(formRow: FormRow, formRowCreator: CreateRow):RowContainer {\r\n        let createRow:CreateRow;\r\n        let type = (formRow as JSX.Element).type;\r\n        if (type !== undefined) {\r\n            createRow = elementCreateRow;\r\n        }\r\n        else {\r\n            createRow = (formRow as (FieldRow | GroupRow | LabeledRow)).createRow;\r\n            if (createRow === undefined) {\r\n                createRow = formRowCreator;\r\n                if (createRow === undefined) createRow = bootstrapCreateRow;\r\n            }\r\n        }\r\n        let row = createRow(this, formRow);\r\n        return row;\r\n    }\r\n\r\n    private createButtons(form:FormView, row: FormRow) {\r\n        return new ButtonsControl(form);\r\n    }\r\n\r\n    private isOk():boolean {\r\n        let isOk = true;\r\n        for (let row of this.rows) {\r\n            if (!row.isOk()) isOk = false;\r\n        }\r\n        return isOk;\r\n    }\r\n\r\n    render():JSX.Element {\r\n        return <form onSubmit={this.onSubmit}>\r\n            {this.rows.map((row,index) => row.render(this.uid + index))}\r\n            {this.buttons()}\r\n        </form>;\r\n    }\r\n\r\n    buttons():JSX.Element {\r\n        if (this.buttonsRow === undefined) return;\r\n        return this.buttonsRow.render(this.uid + this.rows.length);\r\n    }\r\n    \r\n    async onSubmit(event:FormEvent<HTMLFormElement>) {\r\n        event.preventDefault();\r\n        if (!this.isOk()) return;\r\n        let values = this.readValues();\r\n        await this.props.onSubmit(values);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { Page, ItemSchema, UiSchema, StringSchema, UiTextItem, Edit, ImageSchema, nav, UiImageItem } from '../components';\r\nimport { userApi } from '../net';\r\n\r\nexport class EditMeInfo extends React.Component {\r\n    private schema:ItemSchema[] = [\r\n        {name:'nick', type:'string'} as StringSchema,\r\n        {name:'icon', type:'image'} as ImageSchema\r\n    ];\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            nick: {widget:'text', label:'别名', placeholder:'好的别名更方便记忆'} as UiTextItem,\r\n            icon: {widget:'image', label:'头像'} as UiImageItem,\r\n        }\r\n    }\r\n    @observable private data:any;\r\n\r\n    constructor(props:any) {\r\n        super(props);\r\n        let {nick, icon} = nav.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        }\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema:ItemSchema, newValue:any, preValue:any) => {\r\n        let {name} = itemSchema;        \r\n        await userApi.userSetProp(name, newValue);\r\n        this.data[name] = newValue;\r\n        let user:any = nav.user;\r\n        user[name] = newValue;\r\n        nav.saveLocalUser();\r\n    }\r\n\r\n    render() {\r\n        return <Page header=\"个人信息\">\r\n            <Edit schema={this.schema} uiSchema={this.uiSchema}\r\n                data={this.data}\r\n                onItemChanged={this.onItemChanged} />\r\n        </Page>;\r\n    }\r\n}\r\n","import { Login } from '../components';\r\n\r\nexport async function createLogin():Promise<Login> {\r\n\tlet importCLogin = await import('./CLogin');\r\n\treturn new importCLogin.CLogin(undefined);\r\n}\r\n","import * as React from 'react';\r\nimport { IValuesView, IValuesViewRenderOptions } from '../../components';\r\nimport { Tag, TagValue } from './tag';\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class TagView implements IValuesView {\r\n\tprivate tag: Tag;\r\n\tconstructor(tag: Tag) {\r\n\t\tthis.tag = tag;\r\n\t}\r\n\trender(values: number|string):JSX.Element {\r\n\t\tlet names:string[];\r\n\t\tif (typeof values === 'number') {\r\n\t\t\tnames = [this.tag.nameFromId(values)];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tnames = this.tag.namesFromIds(values);\r\n\t\t}\r\n\t\treturn <div className=\"d-flex flex-wrap \">{names.map((name, index)=>{\r\n\t\t\treturn <div key={index} className=\"mx-2 border border-muted rounded px-3 bg-light\">{name}</div>\r\n\t\t})}</div>;\r\n\t}\r\n\trenderRadios(value: number, options: IValuesViewRenderOptions): JSX.Element {\r\n        let content = this.tag.values.map((item,index) => {\r\n\t\t\treturn <div className=\"col\" key={index}>{this.renderRadio(item, value, options)}</div>;\r\n        });\r\n\t\treturn this.renderView(options, content);\r\n\t}\r\n\trenderChecks(values: string, options: IValuesViewRenderOptions): JSX.Element {\r\n\t\tlet arr = values===undefined? undefined : values.split('|').map(v => Number(v));\r\n\t\tlet content = this.tag.values.map((item,index) => {\r\n\t\t\tlet checked: boolean = arr===undefined? undefined : arr.indexOf(item.id)>=0;\r\n\t\t\treturn <div className=\"col\" key={index}>{this.renderCheck(item, checked, options)}</div>\r\n\t\t});\r\n\t\treturn this.renderView(options, content);\r\n\t}\r\n\tprivate renderView(options: IValuesViewRenderOptions, content:any) {\r\n\t\tlet {className, wrapClassName} = options;\r\n\t\twrapClassName = wrapClassName?\r\n\t\t\t'row ' + wrapClassName\r\n\t\t\t:\r\n\t\t\t'row row-cols-2 row-cols-sm-3 row-cols-md-4';\r\n\t\treturn <div className={className} style={radioStyle}>\r\n\t\t\t<div className={wrapClassName}>\r\n                {content}\r\n\t\t\t</div>\r\n        </div>;\r\n\t}\r\n\tprivate renderRadio(item:TagValue, value: number, options: IValuesViewRenderOptions):JSX.Element {\r\n\t\tlet {id, name} = item;\r\n\t\tlet {inputs, inputName, onInputChange} = options;\r\n\t\tlet ref = inputs && ((input:HTMLInputElement)=>inputs[id]=input);\r\n\t\treturn <label className=\"form-radio-inline\">\r\n\t\t\t<input ref={ref} type=\"radio\" name={inputName}\r\n\t\t\t\tvalue={id} defaultChecked={value===id}\r\n\t\t\t\tonChange={onInputChange} />\r\n\t\t\t{name}\r\n\t\t</label>;\r\n\t}\r\n\r\n\tprivate renderCheck(item:TagValue, checked: boolean, options: IValuesViewRenderOptions):JSX.Element {\r\n\t\tlet {id, name} = item;\r\n\t\tlet {inputs, onInputChange} = options;\r\n\t\tlet ref = inputs && ((input:HTMLInputElement)=>inputs[id]=input);\r\n\t\treturn <label className=\"form-radio-inline\">\r\n\t\t\t<input ref={ref} type=\"checkbox\"\r\n\t\t\t\tvalue={id} defaultChecked={checked}\r\n\t\t\t\tonChange={onInputChange} />\r\n\t\t\t{name}\r\n\t\t</label>;\r\n\t}\r\n}\r\n","import { Entity } from \"../entity\";\r\nimport { TagView } from \"./tagView\";\r\n\r\nexport interface TagValue {\r\n\tid: number;\r\n\tname: string;\r\n\text: string;\r\n}\r\n\r\nexport class Tag extends Entity {\r\n    get typeName(): string { return 'tag';}\r\n\tvalues: TagValue[];\r\n\tprivate coll: {[id:number]: TagValue} = {};\r\n\r\n\tprivate _view: TagView;\r\n\tget view(): TagView { \r\n\t\tif (this._view !== undefined) return this._view; \r\n\t\treturn this._view = new TagView(this);\r\n\t}\r\n\r\n\tnameFromId(id:number) {\r\n\t\tlet c = this.coll[id]; \r\n\t\treturn c===undefined? undefined : c.name;\r\n\t}\r\n\r\n\tnamesFromIds(ids:string):string[] {\r\n\t\tlet ret:string[] = [];\r\n\t\tfor (let id of ids.split('|')) {\r\n\t\t\tlet c = this.coll[Number(id)];\r\n\t\t\tlet name = c===undefined? undefined : c.name;\r\n\t\t\tif (name !== undefined) ret.push(name);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync loadValues():Promise<TagValue[]> {\r\n\t\tif (this.values !== undefined) return this.values;\r\n\t\tthis.values = [];\r\n\t\tlet ret = await this.uqApi.get('tag/values/' + this.name);\r\n\t\tif (ret === undefined) return;\r\n\t\tlet lines = (ret as string).split('\\n');\r\n\t\tfor (let line of lines) {\r\n\t\t\tif (line.length === 0) continue;\r\n\t\t\tlet parts = line.split('\\t');\r\n\t\t\tlet id = Number(parts[0]);\r\n\t\t\tlet val = {\r\n\t\t\t\tid: id,\r\n\t\t\t\tname: parts[1],\r\n\t\t\t\text: parts[2],\r\n\t\t\t};\r\n\t\t\tthis.values.push(val);\r\n\t\t\tthis.coll[id] = val;\r\n\t\t}\r\n\t\treturn this.values;\r\n\t}\r\n}\r\n","//import _ from 'lodash';\r\nimport { KeyValueRes, Res } from './res';\r\n\r\nexport interface FormRes extends KeyValueRes {\r\n    required: string;\r\n    number: string;\r\n    integer: string;\r\n    min: string;\r\n    max: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const formRes:Res<FormRes> = {\r\n    _: {\r\n        required: 'required',\r\n        number: 'not valid number',\r\n        integer: 'not valid integer',\r\n        min: 'min value is ${min}',\r\n        max: 'max value is ${max}',\r\n    },\r\n    zh: {\r\n        _: {\r\n            required: '必须填',\r\n            number: '需要数字',\r\n            integer: '需要整数',\r\n            min: '不能小于${min}',\r\n            max: '不能大于${max}',\r\n        }\r\n    },\r\n}\r\n","import { KeyValueRes, Res } from './res';\r\n\r\nexport interface ListRes extends KeyValueRes {\r\n    none: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const listRes:Res<ListRes> = {\r\n    _: {\r\n        none: '[none]',\r\n    },\r\n    zh: {\r\n        _: {\r\n            none: '[无]',\r\n        }\r\n    },\r\n}\r\n","export * from './page';\r\nexport * from './tabs';\r\nexport * from './scrollView';\r\nexport * from './pageHeader';","export * from './schema';\r\nexport * from './uiSchema';\r\nexport * from './toUiSelectItems';\r\nexport * from './IValuesView';","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface DropdownAction {\r\n    icon?: string;\r\n    caption?: string;\r\n    action?: () => void;\r\n    iconClass?: string;\r\n    captionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsProps {\r\n    icon?: string;\r\n    actions: DropdownAction[];\r\n    isRight?: boolean;\r\n    className?: string;\r\n    itemIconClass?: string;\r\n    itemCaptionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsState {\r\n    dropdownOpen: boolean;\r\n}\r\n\r\nexport class DropdownActions extends React.Component<DropdownActionsProps, DropdownActionsState> {\r\n    private menu: HTMLDivElement;\r\n    private button: HTMLElement;\r\n    constructor(props: DropdownActionsProps) {\r\n        super(props);\r\n        this.state = {\r\n            dropdownOpen: false\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        document.addEventListener('click', this.handleDocumentClick);\r\n        document.addEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.removeEventListener('click', this.handleDocumentClick);\r\n        document.removeEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\r\n    private handleDocumentClick = (evt: any) => {\r\n        if (this.state.dropdownOpen === false) return;\r\n        if (this.button && this.button.contains(evt.target)) return;\r\n        if (!this.menu) return;\r\n        //if (!this.menu.contains(evt.target)) \r\n        this.toggle();\r\n    }\r\n\r\n    private toggle = () => {\r\n        this.setState({\r\n            dropdownOpen: !this.state.dropdownOpen\r\n        });\r\n    }\r\n\r\n    render() {\r\n        let { icon, actions, isRight, className, itemIconClass, itemCaptionClass } = this.props;\r\n        if (isRight === undefined) isRight = true;\r\n        let hasIcon = actions.some(v => v.icon !== undefined);\r\n        let { dropdownOpen } = this.state;\r\n        //isOpen={this.state.dropdownOpen} toggle={this.toggle}\r\n        let cn = className || 'cursor-pointer dropdown-toggle btn btn-sm';\r\n        //if (className) cn += className;\r\n        return <div className={'dropdown'}>\r\n            <button ref={v => this.button = v}\r\n                className={cn}\r\n                data-toggle=\"dropdown\"\r\n                aria-expanded={dropdownOpen}\r\n                onClick={this.toggle}>\r\n                <i className={classNames('fa fa-fw ', 'fa-' + (icon || 'ellipsis-v'))} />\r\n            </button>\r\n            <div ref={v => this.menu = v} className={classNames({ \"dropdown-menu\": true, \"dropdown-menu-right\": isRight, \"show\": dropdownOpen })}>\r\n                {\r\n                    actions.map((v, index) => {\r\n                        if (!v) {\r\n                            return <div className=\"dropdown-divider\" key={index} />;\r\n                        }\r\n                        let { icon, caption, action, iconClass, captionClass } = v;\r\n                        if (icon === undefined && caption === undefined)\r\n                            return <div className=\"dropdown-divider\" />;\r\n                        let i: any;\r\n                        if (hasIcon === true) {\r\n                            if (icon !== undefined) icon = 'fa-' + icon;\r\n                            i = <i className={classNames('me-2', 'fa', icon, 'fa-fw', iconClass || itemIconClass)}\r\n                                aria-hidden={true}></i>;\r\n                        }\r\n                        if (action === undefined)\r\n                            return <h6 className=\"dropdown-header\">{i} {caption}</h6>;\r\n                        let onMenuItemClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n                            evt.preventDefault();\r\n                            action();\r\n                        }\r\n                        let onTouchStart = (evt: React.TouchEvent<HTMLAnchorElement>) => {\r\n                            action();\r\n                        }\r\n                        // eslint-disable-next-line\r\n                        return <a className=\"dropdown-item\" key={index} href=\"#/\"\r\n                            onClick={onMenuItemClick} onTouchStart={onTouchStart}\r\n                        >{i} <span className={captionClass || itemCaptionClass}>{caption}</span></a>\r\n                    })\r\n                }\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { setRes } from '../../components';\r\n\r\nexport interface EasyDateProps {\r\n    date: Date | number;\r\n}\r\n\r\n//type YMD = (year:number, month:number, date:number) => string;\r\n//type MD = (month:number, date:number) => string;\r\n\r\nconst timeRes:{[prop:string]:any} = {\r\n\tmd: (month:number, date:number) => `${month}-${date}`,\r\n\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\r\n\tyesterday: 'Yday',\r\n\ttoday: 'Today',\r\n\ttomorrow: 'Tmw',\r\n\t$zh: {\r\n\t\tmd: (month:number, date:number) => `${month}月${date}日`,\r\n\t\tymd: (year:number, month:number, date:number) => `${year}年${month}月${date}日`,\r\n\t\tyesterday: '昨天',\r\n\t\ttoday: '今天',\r\n\t\ttomorrow: '明天',\r\n\t},\r\n\t$en: {\r\n\t\tmd: (month:number, date:number) => `${month}-${date}`,\r\n\t\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\r\n\t\tyesterday: 'Yday',\r\n\t\ttoday: 'Today',\r\n\t\ttomorrow: 'Tmw',\r\n\t}\r\n}\r\n\r\nsetRes(timeRes, timeRes);\r\n\r\nfunction tt(str:string):any {\r\n\treturn timeRes[str];\r\n}\r\n\r\nfunction renderDate(vDate:Date|number, withTime:boolean, always:boolean = false) {\r\n    if (!vDate) return null;\r\n    let date: Date;\r\n    switch (typeof vDate) {\r\n        default: date = vDate as Date; break;\r\n        case 'string': date = new Date(vDate); break;\r\n        case 'number': date = new Date((vDate as number)*1000); break;\r\n    }\r\n\r\n    let now = new Date();\r\n    let tick:number, nDate:number, _date:number, month:number, year:number, nowYear:number;\r\n    let d = date;\r\n    tick = now.getTime() - d.getTime();\r\n    let hour=d.getHours(), minute=d.getMinutes();\r\n    nDate=now.getDate();\r\n    _date=d.getDate();\r\n    month=d.getMonth()+1;\r\n    year=d.getFullYear();\r\n\tnowYear = now.getFullYear();\r\n\r\n\tlet appendTime:boolean = false;\r\n\tlet dPart:string = (function() {\r\n\t\tif (tick < -24*3600*1000) {\r\n\t\t\tif (year === nowYear) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('md')(month, _date);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('ymd')(year, month, _date);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tick < 24*3600*1000) {\r\n\t\t\tif (_date!==nDate) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt(tick < 0? 'tomorrow' : 'yesterday');\r\n\t\t\t}\r\n\t\t\tif (withTime===true) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\treturn tt('today');\r\n\t\t}\r\n\t\tif (year === nowYear) {\r\n\t\t\treturn tt('md')(month, _date);\r\n\t\t}\r\n\t\treturn tt('ymd')(year, month, _date);\r\n\t})();\r\n\r\n\tlet hm = hour + ((minute<10?':0':':') + minute);\r\n\r\n\t/*\r\n    if (tick < -24*3600*1000) {\r\n        if (year === nowYear)\r\n            return tt('md')(month, _date) + ' ' + hm;\r\n        else\r\n            return tt('ymd')(year, month, _date) + ' ' + hm;\r\n    }\r\n    if (always === true || tick < 24*3600*1000) {\r\n        return _date!==nDate? \r\n            tt(tick < 0? 'tomorrow' : 'yesterday') + ' ' + hm \r\n            : withTime===true? hm : tt('today');\r\n    }\r\n    if (year === nowYear) {\r\n        return tt('md')(month, _date);\r\n    }\r\n\treturn tt('ymd')(year, month, _date);\r\n\t*/\r\n\tif (appendTime === true || always === true) {\r\n\t\treturn dPart + ' ' + hm;\r\n\t}\r\n\treturn dPart;\r\n}\r\n\r\n\r\nexport class EasyDate extends React.Component<EasyDateProps> {\r\n    render() {\r\n        return renderDate(this.props.date, false);\r\n    }\r\n}\r\n\r\ninterface EasyTimeProps extends EasyDateProps {\r\n\talways?: boolean;\r\n}\r\nexport class EasyTime extends React.Component<EasyTimeProps> {\r\n    render() {\r\n\t\tlet {date, always} = this.props;\r\n        return renderDate(date, true, always);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Image } from '.';\r\n\r\nexport interface MediaProps {\r\n    icon: string;\r\n    main: string | JSX.Element;\r\n    discription?: string | JSX.Element;\r\n    px?: number;\r\n    py?: number;\r\n}\r\n\r\nexport class Media extends React.Component<MediaProps> {\r\n    render() {\r\n        let { icon, main, discription, px, py } = this.props;\r\n        let disp: any;\r\n        if (typeof discription === 'string')\r\n            disp = <div>{discription}</div>;\r\n        else\r\n            disp = discription;\r\n        let cn = classNames(\r\n            'media',\r\n            px === undefined ? 'px-0' : 'px-' + px,\r\n            py === undefined ? 'py-2' : 'py-' + py);\r\n        return <div className={cn}>\r\n            <Image className=\"me-3 w-4c h-4c\" src={icon} />\r\n            <div className=\"media-body\">\r\n                <h5 className=\"mt-0\">{main}</h5>\r\n                {disp}\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observable } from 'mobx';\r\n\r\nexport interface SearchBoxProps {\r\n    className?: string;\r\n    label?: string;\r\n    initKey?: string;\r\n    placeholder?: string;\r\n    buttonText?: string;\r\n    maxLength?: number;\r\n    size?: 'sm' | 'md' | 'lg';\r\n    inputClassName?: string;\r\n    onSearch: (key: string) => Promise<void>;\r\n    onFocus?: () => void;\r\n    allowEmptySearch?: boolean;\r\n}\r\n\r\n/*\r\nexport interface SearchBoxState {\r\n    disabled: boolean;\r\n}*/\r\n\r\nexport class SearchBox extends React.Component<SearchBoxProps> { //}, SearchBoxState> {\r\n    private input: HTMLInputElement;\r\n    private key: string = null;\r\n    @observable private disabled: boolean;\r\n\r\n    private onChange = (evt: React.ChangeEvent<any>) => {\r\n        this.key = evt.target.value;\r\n        if (this.key !== undefined) {\r\n            this.key = this.key.trim();\r\n            if (this.key === '') this.key = undefined;\r\n        }\r\n        if (this.props.allowEmptySearch !== true) {\r\n            this.disabled = !this.key;\r\n        }\r\n    }\r\n    private onSubmit = async (evt: React.FormEvent<any>) => {\r\n        evt.preventDefault();\r\n        if (this.key === null) this.key = this.props.initKey || '';\r\n        if (this.props.allowEmptySearch !== true) {\r\n            if (!this.key) return;\r\n            if (this.input) this.input.disabled = true;\r\n        }\r\n        await this.props.onSearch(this.key);\r\n        if (this.input) this.input.disabled = false;\r\n    }\r\n    clear() {\r\n        if (this.input) this.input.value = '';\r\n    }\r\n    render() {\r\n        let { className, inputClassName, onFocus,\r\n            label, placeholder, buttonText, maxLength, size } = this.props;\r\n        let inputSize: string;\r\n        switch (size) {\r\n            default:\r\n            case 'sm': inputSize = 'input-group-sm'; break;\r\n            case 'md': inputSize = 'input-group-md'; break;\r\n            case 'lg': inputSize = 'input-group-lg'; break;\r\n        }\r\n        return <form className={className} onSubmit={this.onSubmit} >\r\n            <div className={classNames(\"input-group\", inputSize)}>\r\n                {label && <div className=\"input-group-addon align-self-center me-2\">{label}</div>}\r\n                <input ref={v => this.input = v} onChange={this.onChange}\r\n                    type=\"text\"\r\n                    name=\"key\"\r\n                    onFocus={onFocus}\r\n                    className={classNames('form-control', inputClassName || 'border-primary')}\r\n                    placeholder={placeholder}\r\n                    defaultValue={this.props.initKey}\r\n                    maxLength={maxLength} />\r\n                <div className=\"input-group-append\">\r\n                    <button className=\"btn btn-primary\"\r\n                        type=\"submit\"\r\n                        disabled={this.disabled}>\r\n                        <i className='fa fa-search' />\r\n                        <i className=\"fa\" />\r\n                        {buttonText}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </form>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { nav } from './nav';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { userApi } from '../net';\r\nimport { User } from '../tool';\r\n\r\nexport type UserLoader = (userId:number)=>Promise<any>;\r\n\r\nexport class UserCache<T> {\r\n\tprivate loader: UserLoader;\r\n\tprivate onLoaded: (user:User) => void;\r\n\tprivate map = observable(new Map<number, T|number>());\r\n\r\n\tconstructor(loader: UserLoader) {\r\n\t\tif (loader === undefined) loader = (userId:number)=>userApi.user(userId);\r\n\t\tthis.loader = loader;\r\n\t}\r\n\r\n\tuse(id:number|any, onLoaded?:(user:User)=>void) {\t\t\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tif (!id) return;\r\n\t\tthis.onLoaded = onLoaded;\r\n\t\tid = Number(id);\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (ret === undefined) {\r\n\t\t\tthis.map.set(id, id);\r\n\t\t}\r\n\t}\r\n\r\n\tgetValue(id:number|any):any {\r\n\t\tif (!id) return;\r\n\t\tswitch (typeof(id)) {\r\n\t\t\tcase 'object': \r\n\t\t\t\tid = id.id; \r\n\t\t\t\tif (!id) return;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (!ret) return;\r\n\t\tswitch (typeof(ret)) {\r\n\t\tdefault:\r\n\t\t\treturn ret;\r\n\t\tcase 'number':\r\n\t\t\tif (ret < 0) return id;\r\n\t\t\tthis.map.set(id, -id);\r\n\t\t\tthis.loader(id).then(v => {\r\n\t\t\t\tif (!v) v = null;\r\n\t\t\t\tthis.map.set(id, v);\r\n\t\t\t\tif (this.onLoaded) this.onLoaded(v);\r\n\t\t\t}).catch(reason => {\r\n\t\t\t\tconsole.error(reason);\r\n\t\t\t});\r\n\t\t\treturn id;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst userCache = new UserCache(undefined);\r\n\r\nexport interface UserIconProps {\r\n    id: number;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    altImage?: string;\r\n    noneImage?: any;\r\n}\r\n\r\nexport const UserIcon = observer((props: UserIconProps):JSX.Element => {\r\n    let {className, style, id, altImage, noneImage} = props;\r\n    let user = userCache.getValue(id);\r\n    switch (typeof user) {\r\n\tcase 'undefined':\r\n\tcase 'number':\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            {noneImage || <i className=\"fa fa-file-o\" />}\r\n        </div>;\r\n    }\r\n    let {icon} = user;\r\n    if (!icon) {\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            <i className=\"fa fa-file-o\" />\r\n        </div>;\r\n    }\r\n    if (icon.startsWith(':') === true) {\r\n        icon = nav.resUrl + icon.substr(1);\r\n    }\r\n    return <img src={icon} className={className} alt=\"img\"\r\n        style={style}\r\n        onError={evt=>{\r\n            if (altImage) evt.currentTarget.src=altImage;\r\n            else evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n        }} />;\r\n});\r\n\r\nexport interface UserViewProps {\r\n\tid?: number;\r\n\tuser?: number|User;\r\n\trender: (user:User) => JSX.Element;\r\n\tonLoaded?: (user:User) => void\r\n}\r\n\r\nexport const UserView = observer((props: UserViewProps):JSX.Element => {\r\n\tlet {id:idProp, user, render, onLoaded} = props;\r\n\tif (user === null) return <>null</>;\r\n\tswitch (typeof user) {\r\n\t\tcase 'undefined': \r\n\t\t\tuser = userCache.getValue(idProp);\r\n\t\t\tbreak;\r\n\t\tcase 'object': \r\n\t\t\tlet {/*obj, */id} = user as any;\r\n\t\t\t//if (typeof obj !== 'object') {\r\n\t\t\t\tuseUser(id, onLoaded);\r\n\t\t\t\tuser = userCache.getValue(id);\r\n\t\t\t//}\r\n\t\t\tbreak;\r\n\t\tcase 'number':\r\n\t\t\tuseUser(user as number, onLoaded);\r\n\t\t\tuser = userCache.getValue(user as number);\r\n\t\t\tbreak;\r\n\t\tcase 'string':\r\n\t\t\tuseUser(Number(user), onLoaded);\r\n\t\t\tuser = userCache.getValue(Number(user));\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tuser = undefined;\r\n\t\t\tbreak;\r\n\t}\r\n    switch (typeof user) {\r\n\t\tcase 'undefined':\r\n\t\tcase 'number':\r\n        \treturn <>{user}</>;\r\n    }\r\n    return render(user);\r\n});\r\n\r\nexport function useUser(id: number|object, onLoaded?: (user:User)=>void) {\r\n\tif (!id) return;\r\n\tif (typeof(id) === 'object') {\r\n\t\tid = (id as any).id;\r\n\t}\r\n\tuserCache.use(id, onLoaded);\r\n}\r\n","import React from \"react\";\r\nimport classNames from 'classnames';\r\nimport { nav } from \"../nav\";\r\n\r\nexport interface AxProps extends React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement> {\r\n\t//children: React.ReactNode;\r\n\t//href: string;\r\n\t//onClick?: (event:React.MouseEvent) => void;\r\n\t//className?: string;\r\n\taClassName?: string;\r\n\tnaClassName?: string;\r\n\t//target?: string;\r\n\t//props?: any;\r\n}\r\n\r\n// 如果是web方式，用webNav方式route网页\r\n// 如果是app方式，用click方式压栈页面\r\nexport const Ax = (axProps: AxProps) => {\r\n\tlet {href, children, className, onClick} = axProps;\r\n\tif (nav.isWebNav === true) {\r\n\t\tlet {aClassName } = axProps;\r\n\t\tif (!href) return <span className=\"text-danger\">Error: href not defined in Ax</span>;\r\n\t\tlet onAxClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\t\tevt.preventDefault();\r\n\t\t\tlet ret:boolean;\r\n\t\t\tif (onClick) {\r\n\t\t\t\tret = onClick(evt) as unknown as boolean;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tnav.navigate(href);\r\n\t\t\t\tret = false;\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\treturn <a {...axProps} className={classNames(className, aClassName)} onClick={onAxClick}>{children}</a>;\r\n\t}\r\n\telse {\r\n\t\tlet {naClassName} = axProps;\r\n\t\tif (!onClick) {\r\n\t\t\tonClick = () => {\r\n\t\t\t\tnav.openSysPage(href); //.navigate(href);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <span className={classNames(className, 'cursor-pointer', naClassName)} onClick={onClick}>{children}</span>;\r\n\t}\r\n}\r\n\r\n// 同普通的a tag\r\n// 会自动处理href，处理生产版跟测试版之间的不同\r\nexport const A = (props: React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement>) => {\r\n\tlet {children} = props;\r\n\tif (nav.isWebNav === false) {\r\n\t\treturn <a {...props}>{children}</a>;\r\n\t}\r\n\tlet {href} = props;\r\n\t//if (nav.testing === true) href += '#test';\r\n\tlet onClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\tevt.preventDefault();\r\n\t\tnav.navigate(href);\r\n\t\treturn false;\r\n\t}\r\n\treturn <a {...props} href={href} onClick={onClick}>{children}</a>;\r\n}\r\n","import React from 'react';\r\nimport { observer } from \"mobx-react\";\r\nimport { IObservableValue } from 'mobx';\r\n\r\n//export function autoHideTips(visible: IObservableValue<boolean>, tips:string|JSX.Element, timeout?:number):React.FunctionComponentElement<any>;\r\n//export function autoHideTips(tips: IObservableValue<string>, tips:string|JSX.Element, timeout?:number):React.FunctionComponentElement<any>;\r\n\r\nexport function autoHideTips(\r\n\ttips: IObservableValue<boolean|string|JSX.Element>, \r\n\ttemplet?:string|JSX.Element|((v:string|JSX.Element)=>JSX.Element), \r\n\ttimeout?:number):React.FunctionComponentElement<any> {\r\n/*\r\nexport function autoHideTips(tips: IObservableValue<boolean|string|JSX.Element>, timeout?:number):React.FunctionComponentElement<any>;\r\nexport function autoHideTips(tips: IObservableValue<boolean|string|JSX.Element>, templet:(tips: boolean|string|JSX.Element) => JSX.Element, timeout?:number):React.FunctionComponentElement<any>;\r\n\r\nexport function autoHideTips(tips: IObservableValue<boolean|string|JSX.Element>, ...params:any[]) {\r\n*/\r\n\tlet timer:any;\r\n\treturn React.createElement(observer(():JSX.Element => {\r\n\t\tif (timer) {\r\n\t\t\tclearTimeout(timer);\r\n\t\t\ttimer = undefined;\r\n\t\t}\r\n\t\tlet t = tips.get();\r\n\t\tif (!t) return null;\r\n\t\tif (timeout === undefined) timeout = 3000;\r\n\t\t//let p0 = params[0];\r\n\t\t//let timeout = 3000;\r\n\t\t//let templet: (tips: boolean|string|JSX.Element) => JSX.Element;\r\n\t\t/*\r\n\t\tswitch (typeof p0) {\r\n\t\t\tcase 'number':\r\n\t\t\t\ttimeout = p0;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'function':\r\n\t\t\t\ttemplet = p0;\r\n\t\t\t\tlet p1 = params[1];\r\n\t\t\t\tif (typeof p1 === 'number') {\r\n\t\t\t\t\ttimeout = p1;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\tif (timeout > 0) {\r\n\t\t\ttimer = setTimeout(() => {\r\n\t\t\t\ttips.set(null);\r\n\t\t\t}, timeout);\r\n\t\t}\r\n\t\tswitch (typeof templet) {\r\n\t\t\tcase 'undefined': return <>{t}</>;\r\n\t\t\tcase 'function': return templet(t as string);\r\n\t\t\tcase 'string': return <>{templet}</>;\r\n\t\t\tdefault: return templet;\r\n\t\t}\r\n\t}));\r\n};\r\n","import { UqMan, TuidModify } from '../uqMan';\r\nimport { Tuid } from \"./tuid\";\r\nimport { env } from '../../tool';\r\n\r\ninterface Modify {\r\n    id: number;\r\n    entity: string;\r\n    key: string;\r\n}\r\n\r\nexport class TuidsCache {\r\n    private readonly uq: UqMan;\r\n    private modifyMax: TuidModify;\r\n    private cacheTimer: any;\r\n    constructor(uq: UqMan) {\r\n        this.uq = uq;\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.clearCacheTimer();\r\n        this.cacheTimer = env.setTimeout('TuidsCache.cacheTuids', this.loadIds, defer);\r\n    }\r\n    private clearCacheTimer() {\r\n        if (this.cacheTimer === undefined) return;\r\n        env.clearTimeout(this.cacheTimer);\r\n        this.cacheTimer = undefined;\r\n    }\r\n    private loadIds = () => {\r\n        this.clearCacheTimer();\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            let tuid = tuids[i];\r\n            tuid.cacheIds();\r\n        }\r\n    }\r\n    \r\n    pullModify(modifyMax:number) {\r\n        if (modifyMax === undefined) return;\r\n        let now = Math.floor(Date.now() / 1000);\r\n        if (this.modifyMax === undefined) {\r\n            this.modifyMax = this.uq.localModifyMax.get();\r\n            if (this.modifyMax === undefined) {\r\n                this.modifyMax = {\r\n                    max: modifyMax,\r\n                    seconds: now,\r\n                };\r\n                this.uq.localModifyMax.set(this.modifyMax);\r\n            }\r\n        }\r\n        let {max, seconds} = this.modifyMax;\r\n        let lockGap = 3600;\r\n        if (now - seconds < lockGap) return;\r\n        if (modifyMax <= max) return;\r\n        let tuidCached:string[] = [];\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            //if (tuids[i].cached === true) \r\n            tuidCached.push(i);\r\n        }\r\n        if (tuidCached.length === 0) return;\r\n        this.modifyMax.seconds = now;\r\n        this.innerPullModify(tuidCached.join('\\t'));\r\n    }\r\n\r\n    private async innerPullModify(tuidLists:string):Promise<void> {\r\n        let {uqApi, tuids} = this.uq;\r\n        let {max} = this.modifyMax;\r\n        let ret:{queue:Modify[], queueMax:number} = await uqApi.queueModify(max, 30, tuidLists);\r\n        let group:{[entity:string]: {tuid:Tuid; ids: string[]}} = {};\r\n        let modifyMax:number = 0;\r\n        for (let modify of ret.queue) {\r\n\t\t\tlet {id, entity, key} = modify;\r\n\t\t\tif (!key) continue;\r\n            let tuid = tuids[entity];\r\n            if (tuid === undefined) continue;\r\n            let item = group[entity];\r\n            if (item === undefined) {\r\n                item = group[entity] = {tuid: tuid, ids:[]};\r\n            }\r\n            item.ids.push(key);\r\n            if (id > modifyMax) modifyMax = id;\r\n        }\r\n        for (let i in group) {\r\n            let {tuid, ids} = group[i];\r\n            await tuid.modifyIds(ids);\r\n        }\r\n        let now = Math.floor(Date.now() / 1000);\r\n        this.modifyMax = {\r\n            max: modifyMax,\r\n            seconds: now,\r\n        }\r\n        this.uq.localModifyMax.set(this.modifyMax);\r\n    }\r\n}\r\n","import { LocalMap, LocalCache, env } from '../tool';\r\nimport { UqData, UqAppData, loadAppUqs } from '../net';\r\nimport { UqMan } from './uqMan';\r\nimport { TuidImport, TuidInner } from './tuid';\r\nimport { nav } from '../components';\r\n\r\nexport interface TVs {\r\n    [uqName:string]: {\r\n        [tuidName: string]: (values: any) => JSX.Element;\r\n    }\r\n}\r\n\r\nexport class UQsMan {\r\n\tstatic _uqs: any;\r\n\tstatic value: UQsMan;\r\n\tstatic errors: string[];\r\n\r\n\tstatic async load(tonvaAppName:string, version:string, tvs:TVs) {\r\n\t\tlet uqsMan = UQsMan.value = new UQsMan(tonvaAppName, tvs);\r\n        let {appOwner, appName} = uqsMan;\r\n        let {localData} = uqsMan;\r\n        let uqAppData:UqAppData = localData.get();\r\n        if (!uqAppData || uqAppData.version !== version) {\r\n\t\t\tuqAppData = await loadAppUqs(appOwner, appName);\r\n\t\t\tif (!uqAppData.id) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t`${appOwner}/${appName}不存在。请仔细检查app全名。`\r\n\t\t\t\t];\r\n\t\t\t}\r\n            uqAppData.version = version;\r\n            localData.set(uqAppData);\r\n            // \r\n            for (let uq of uqAppData.uqs) uq.newVersion = true;\r\n        }\r\n        let {id, uqs} = uqAppData;\r\n        uqsMan.id = id;\r\n        await uqsMan.init(uqs);\r\n        let retErrors = await uqsMan.load();\r\n        if (retErrors.length === 0) {\r\n            retErrors.push(...uqsMan.setTuidImportsLocal());\r\n            if (retErrors.length === 0) {\r\n                UQsMan._uqs = uqsMan.buildUQs();\r\n                return;\r\n            }\r\n        }\r\n        UQsMan.errors = retErrors;\r\n\t}\r\n\r\n    private collection: {[uqName: string]: UqMan};\r\n    private readonly tvs: TVs;\r\n\r\n    readonly appOwner: string;\r\n    readonly appName: string;\r\n    readonly localMap: LocalMap;\r\n    readonly localData: LocalCache;\r\n    id: number;\r\n\r\n    private constructor(tonvaAppName:string, tvs:TVs) {\r\n        this.tvs = tvs || {};\r\n        this.buildTVs();\r\n        this.collection = {};\r\n        let parts = tonvaAppName.split('/');\r\n        if (parts.length !== 2) {\r\n            throw new Error('tonvaApp name must be / separated, owner/app');\r\n        }\r\n        this.appOwner = parts[0];\r\n        this.appName = parts[1];\r\n        this.localMap = env.localDb.map(tonvaAppName);\r\n        this.localData = this.localMap.child('uqData');\r\n    }\r\n\r\n    // to be removed in the future\r\n    addUq(uq: UqMan) {\r\n        this.collection[uq.name] = uq;\r\n    }\r\n\r\n    private buildTVs() {\r\n        for (let i in this.tvs) {\r\n            let uqTVs = this.tvs[i];\r\n            if (uqTVs === undefined) continue;\r\n            let l = i.toLowerCase();\r\n            if (l === i) continue;\r\n            this.tvs[l] = uqTVs;\r\n            for (let j in uqTVs) {\r\n                let en = uqTVs[j];\r\n                if (en === undefined) continue;\r\n                let lj = j.toLowerCase();\r\n                if (lj === j) continue;\r\n                uqTVs[lj] = en;\r\n            }\r\n        }\r\n    }\r\n\r\n    async init(uqsData:UqData[]):Promise<void> {\r\n        let promiseInits: PromiseLike<void>[] = uqsData.map(uqData => {\r\n\t\t\tlet {uqOwner, uqName} = uqData;\r\n\t\t\tlet uqFullName = uqOwner + '/' + uqName;\r\n\t\t\t//let uqUI = this.ui.uqs[uqFullName] as UqUI || {};\r\n\t\t\t//let cUq = this.newCUq(uqData, uqUI);\r\n\t\t\t//this.cUqCollection[uqFullName] = cUq;\r\n\t\t\t//this.uqs.addUq(cUq.uq);\r\n\t\t\tlet uq = new UqMan(this, uqData, undefined, this.tvs[uqFullName] || this.tvs[uqName]);\r\n\t\t\tthis.collection[uqFullName] = uq;\r\n\t\t\tlet lower = uqFullName.toLowerCase();\r\n\t\t\tif (lower !== uqFullName) {\r\n\t\t\t\tthis.collection[lower] = uq;\r\n\t\t\t}\r\n\t\t\treturn uq.init();\r\n\t\t});\r\n        await Promise.all(promiseInits);\r\n    }\r\n\r\n    async load(): Promise<string[]> {\r\n        let retErrors:string[] = [];\r\n        let promises: PromiseLike<string>[] = [];\r\n        for (let i in this.collection) {\r\n            let uq = this.collection[i];\r\n            promises.push(uq.loadEntities());\r\n\t\t}\r\n        let results = await Promise.all(promises);\r\n        for (let result of results)\r\n        {\r\n            let retError = result; // await cUq.loadSchema();\r\n            if (retError !== undefined) {\r\n                retErrors.push(retError);\r\n                continue;\r\n            }\r\n\t\t}\r\n        return retErrors;\r\n    }\r\n\r\n    buildUQs(): any {\r\n        let that = this;\r\n        let uqs:any = {};\r\n        for (let i in this.collection) {\r\n            let uqMan = this.collection[i];\r\n            //let n = uqMan.name;\r\n            let uqName = uqMan.uqName;\r\n            let l = uqName.toLowerCase();\r\n\t\t\tlet uqKey:string = uqName.split(/[-._]/).join('').toLowerCase();\r\n            let entities = uqMan.entities;\r\n            let keys = Object.keys(entities);\r\n            for (let key of keys) {\r\n                let entity = entities[key];\r\n\t\t\t\tlet {name} = entity;\r\n\t\t\t\tentities[name.toLowerCase()] = entity;\r\n            }\r\n            let proxy = uqs[l] = new Proxy(entities, {\r\n                get: function(target, key, receiver) {\r\n                    let lk = (key as string).toLowerCase();\r\n                    let ret = target[lk];\r\n                    if (ret !== undefined) return ret;\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t\tlet err = `entity ${uqName}.${String(key)} not defined`;\r\n                    console.error(err);\r\n                    that.showReload('UQ错误：' + err);\r\n                    return undefined;\r\n                }\r\n\t\t\t})\r\n\t\t\tif (uqKey !== l) uqs[uqKey] = proxy;\r\n        }\r\n        //let uqs = this.collection;\r\n        return new Proxy(uqs, {\r\n            get: function (target, key, receiver) {\r\n                let lk = (key as string).toLowerCase();\r\n                let ret = target[lk];\r\n                if (ret !== undefined) return ret;\r\n                /*\r\n                for (let i in uqs) {\r\n                    if (i.toLowerCase() === lk) {\r\n                        return uqs[i];\r\n                    }\r\n                }*/\r\n                debugger;\r\n                console.error('error in uqs');\r\n                that.showReload(`代码错误：新增 uq ${String(key)}`);\r\n                return undefined;\r\n            },\r\n        });\r\n\t}\r\n\t\r\n\tgetUqCollection() {\r\n\t\treturn this.collection;\r\n\t}\r\n\r\n    private showReload(msg: string) {\r\n        this.localMap.removeAll();\r\n        nav.showReloadPage(msg);\r\n    }\r\n\r\n    setTuidImportsLocal():string[] {\r\n        let ret:string[] = [];\r\n        for (let i in this.collection) {\r\n            let uq = this.collection[i];\r\n            for (let tuid of uq.tuidArr) {\r\n                if (tuid.isImport === true) {\r\n                    let error = this.setInner(tuid as TuidImport);\r\n                    if (error) ret.push(error);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private setInner(tuidImport: TuidImport):string {\r\n        let {from} = tuidImport;\r\n        let fromName = from.owner + '/' + from.uq;\r\n        let uq = this.collection[fromName];\r\n        if (uq === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} is not loaded`;\r\n        }\r\n        let iName = tuidImport.name\r\n        let tuid = uq.tuid(iName);\r\n        if (tuid === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} has no Tuid ${iName}`;\r\n        }\r\n        if (tuid.isImport === true) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} Tuid ${iName} is import`;\r\n        }\r\n        tuidImport.setFrom(tuid as TuidInner);\r\n    }\r\n}\r\n","import fs from 'fs';\r\nimport {\r\n\tAction, Book, Query, Sheet, Tuid, UqEnum, UqMan, UQsMan\r\n\t, Map, History, Tag, Pending, Entity, ArrFields, Field\r\n} from './index';\r\nimport { nav } from '../components';\r\nimport { AppConfig } from '../app';\r\n//import { env } from 'tonva/tool';\r\n\r\n//const uqAppPath = 'src/UqApp';\r\nconst red = '\\x1b[41m%s\\x1b[0m';\r\nlet lastBuildTime: number = 0;\r\nlet gUqOwnerMap: { [key: string]: string };\r\n\r\nexport interface UqAppOptions extends Partial<AppConfig> {\r\n\tuqAppName: string;\r\n\tuqAppVersion: string;\r\n\tuqAppUnitId: number;\r\n\tuqAppSrcPath?: string;\r\n\tuqOwnerMap?: { [key: string]: string };\r\n}\r\n\r\nexport async function uqAppStart(options: UqAppOptions) {\r\n\tlet { uqAppName, uqAppVersion: appVersion, uqAppUnitId: appUnitId } = options;\r\n\tprocess.env.REACT_APP_UNIT = String(appUnitId);\r\n\tnav.forceDevelopment = true;\r\n\tawait nav.init();\r\n\tawait UQsMan.load(uqAppName, appVersion, undefined);\r\n}\r\nexport async function buildUqApp(options: UqAppOptions) {\r\n\tlet { uqAppSrcPath, uqOwnerMap } = options;\r\n\tif (!uqAppSrcPath) uqAppSrcPath = 'src/UqApp';\r\n\tgUqOwnerMap = uqOwnerMap || {};\r\n\tfor (let i in gUqOwnerMap) {\r\n\t\tgUqOwnerMap[i.toLowerCase()] = gUqOwnerMap[i];\r\n\t}\r\n\tif (lastBuildTime > 0) {\r\n\t\t//if (Date.now() - lastBuildTime < 30*1000) {\r\n\t\tconsole.log(red, 'quit !');\r\n\t\treturn;\r\n\t}\r\n\tif (!fs.existsSync(uqAppSrcPath)) {\r\n\t\tfs.mkdirSync(uqAppSrcPath);\r\n\t}\r\n\tlet tsAppName = buildTsAppName(options);\r\n\tsaveTsFile(uqAppSrcPath, 'appName', tsAppName);\r\n\tlet tsAppConfig = buildTsAppConfig(options);\r\n\tsaveTsFileIfNotExists(uqAppSrcPath, 'appConfig', tsAppConfig);\r\n\tlet tsIndex = buildTsIndex();\r\n\tsaveTsFile(uqAppSrcPath, 'index', tsIndex);\r\n\tlet tsCApp = buildTsCApp();\r\n\tsaveTsFileIfNotExists(uqAppSrcPath, 'CApp', tsCApp);\r\n\tlet tsCBase = buildTsCBase();\r\n\tsaveTsFile(uqAppSrcPath, 'CBase', tsCBase);\r\n\tlet tsVMain = buildTsVMain();\r\n\tsaveTsFileIfNotExists(uqAppSrcPath, 'VMain', tsVMain, 'tsx');\r\n\r\n\tsaveTsFile(uqAppSrcPath, 'uqs', '');\r\n\tfs.unlinkSync(uqAppSrcPath + '/uqs.ts');\r\n\tawait buildUqsFolder(uqAppSrcPath + '/uqs', options);\r\n};\r\n\r\nfunction saveTsFileIfNotExists(uqAppSrcPath: string, fileName: string, content: string, suffix: string = 'ts') {\r\n\tlet tsFile = `${uqAppSrcPath}/${fileName}.${suffix}`;\r\n\tif (fs.existsSync(tsFile) === true) return;\r\n\tsaveTsFile(uqAppSrcPath, fileName, content, suffix);\r\n}\r\nfunction saveTsFile(uqAppSrcPath: string, fileName: string, content: string, suffix: string = 'ts') {\r\n\tlet srcFile = `${uqAppSrcPath}/${fileName}.${suffix}.txt`;\r\n\tlet tsFile = `${uqAppSrcPath}/${fileName}.${suffix}`;\r\n\tif (!fs.existsSync(srcFile)) {\r\n\t\tif (fs.existsSync(tsFile)) {\r\n\t\t\tfs.renameSync(tsFile, srcFile);\r\n\t\t}\r\n\t}\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\nfunction overrideTsFile(uqAppSrcPath: string, fileName: string, content: string, suffix: string = 'ts') {\r\n\tlet tsFile = `${uqAppSrcPath}/${fileName}.${suffix}`;\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\nfunction buildTsHeader() {\r\n\treturn `//=== UqApp builder created on ${new Date()} ===//`;\r\n}\r\nfunction buildTsAppName(options: UqAppOptions): string {\r\n\tlet { uqAppName, appName } = options;\r\n\treturn `${buildTsHeader()}\r\nexport const appName = '${uqAppName || appName}';\r\n`;\r\n}\r\nfunction buildTsAppConfig(options: UqAppOptions): string {\r\n\tlet { version, noUnit, tvs, oem, htmlTitle } = options;\r\n\tfunction toString(s: string) {\r\n\t\tif (s === undefined) return;\r\n\t\tif (s === null) return null;\r\n\t\treturn `'${s}'`;\r\n\t}\r\n\treturn `${buildTsHeader()}\r\nimport { AppConfig } from \"tonva\";\r\nimport { appName } from \"./appName\";\r\n\r\nexport const appConfig: AppConfig = {\r\n    appName: appName,\r\n\tversion: ${toString(version)},\r\n\tnoUnit: ${noUnit},\r\n    tvs: ${JSON.stringify(tvs)},\r\n\toem: ${toString(oem)},\r\n\thtmlTitle: ${toString(htmlTitle)},\r\n};\r\n`;\r\n}\r\nfunction buildTsIndex(): string {\r\n\treturn `${buildTsHeader()}\r\nexport { appConfig } from './appConfig';\r\nexport { CUqApp, CUqBase, CUqSub } from './CBase';\r\nexport { CApp } from './CApp';\r\nexport * from './uqs';\r\n`;\r\n}\r\nfunction buildTsCApp(): string {\r\n\treturn `${buildTsHeader()}\r\nimport { CUqApp } from \"./CBase\";\r\nimport { VMain } from \"./VMain\";\r\n\r\nexport class CApp extends CUqApp {\r\n\tprotected async internalStart(isUserLogin: boolean) {\r\n\t\tthis.openVPage(VMain, undefined, this.dispose);\r\n\t}\r\n}\r\n`;\r\n}\r\nfunction buildTsCBase(): string {\r\n\treturn `${buildTsHeader()}\r\nimport { CSub, CBase, CAppBase, IConstructor } from 'tonva';\r\nimport { UQs } from './uqs';\r\nimport { CApp } from './CApp';\r\n\r\nexport abstract class CUqBase extends CBase {\r\n\tget cApp(): CApp { return this._cApp; }\r\n\tprotected get uqs(): UQs { return this._uqs as UQs };\r\n}\r\n\r\nexport abstract class CUqSub<T extends CUqBase> extends CSub<T> {\r\n\tget cApp(): CApp { return this._cApp; }\r\n\tprotected get uqs(): UQs { return this._uqs as UQs };\r\n\tget owner(): T { return this._owner as T }\r\n}\r\n\r\nexport abstract class CUqApp extends CAppBase {\r\n\tget uqs(): UQs { return this._uqs };\r\n\r\n\tprotected newC<T extends CUqBase>(type: IConstructor<T>): T {\r\n\t\tlet c = new type(this);\r\n\t\tc.init();\r\n\t\treturn c;\r\n\t}\r\n}\r\n`;\r\n}\r\nfunction buildTsVMain() {\r\n\treturn `${buildTsHeader()}\r\nimport { VPage, Page } from 'tonva';\r\nimport { CApp } from './CApp';\r\n\r\nexport class VMain extends VPage<CApp> {\r\n\tasync open(param?: any, onClosePage?: (ret:any)=>void) {\r\n\t\tthis.openPage(this.render, param, onClosePage);\r\n\t}\r\n\r\n\trender = (param?: any): JSX.Element => {\r\n\t\treturn <Page header=\"TEST\">\r\n\t\t\t<div className=\"m-3\">\r\n\t\t\t\t<div>{this.renderMe()}</div>\r\n\t\t\t\t<div className=\"mb-5\">同花样例主页面</div>\r\n\t\t\t</div>\r\n\t\t</Page>;\r\n\t}\r\n}\r\n`;\r\n}\r\n\r\nasync function buildUqsFolder(uqsFolder: string, options: UqAppOptions) {\r\n\tawait uqAppStart(options);\r\n\r\n\tlet uqsMan = UQsMan.value;\r\n\tlet coll = uqsMan.getUqCollection();\r\n\r\n\tlet promiseArr: Promise<void>[] = [];\r\n\tlet uqs: UqMan[] = [];\r\n\tfor (let i in coll) {\r\n\t\tlet lowerI = i.toLowerCase();\r\n\t\tif (lowerI !== i) continue;\r\n\t\tuqs.push(coll[i]);\r\n\t}\r\n\r\n\tif (!uqsMan.id) {\r\n\t\tlet error = options.uqAppName + ' not defined!';\r\n\t\tthrow new Error(error);\r\n\t}\r\n\r\n\tfor (let uq of uqs) {\r\n\t\tpromiseArr.push(loadUqEntities(uq));\r\n\t}\r\n\tawait Promise.all(promiseArr);\r\n\r\n\tif (!fs.existsSync(uqsFolder)) {\r\n\t\tfs.mkdirSync(uqsFolder);\r\n\t}\r\n\tlet tsUqsIndexHeader = buildTsHeader();\r\n\tlet tsUqsIndexContent = `\\n\\nexport interface UQs {`;\r\n\tlet tsUqsExports = '\\n\\n';\r\n\tfor (let uq of uqs) {\r\n\t\tlet { uqOwner, uqName } = uq;\r\n\t\tlet o1 = getUqOwnerName(uqOwner);\r\n\t\tlet n1 = getUqName(uqName);\r\n\t\tlet tsUq = buildTsUq(uq);\r\n\t\toverrideTsFile(uqsFolder, o1 + n1, tsUq);\r\n\t\t// as ${o1}${n1}\r\n\t\ttsUqsIndexHeader += `\\nimport { ${o1}${n1} } from './${o1}${n1}';`;\r\n\t\ttsUqsIndexContent += `\\n\\t${o1}${n1}: ${o1}${n1}.Uq${o1}${n1};`;\r\n\r\n\t\ttsUqsExports += `\\nexport {`;\r\n\t\tfor (let enm of uq.enumArr) {\r\n\t\t\tlet enmName = `${capitalCaseString(enm.sName)}`;\r\n\t\t\ttsUqsExports += `\\n\\t${enmName} as ${o1}${n1}${enmName},`;\r\n\t\t}\r\n\t\ttsUqsExports += `\\n} from './${o1}${n1}';`;\r\n\t}\r\n\r\n\toverrideTsFile(uqsFolder, 'index',\r\n\t\ttsUqsIndexHeader + tsUqsIndexContent + '\\n}' + tsUqsExports + '\\n');\r\n}\r\n\r\nfunction buildTsUq(uq: UqMan) {\r\n\tlet ret = buildTsHeader();\r\n\tret += '\\nimport { UqTuid, UqQuery, UqAction, UqSheet/*, Map, Tag*/ } from \"tonva\";';\r\n\r\n\t//for (let uq of uqs) {\r\n\tret += '\\n';\r\n\tret += '\\n//===============================';\r\n\tret += `\\n//======= UQ ${uq.name} ========`;\r\n\tret += '\\n//===============================';\r\n\tret += '\\n';\r\n\tret += buildUQ(uq);\r\n\tret += '\\n';\r\n\tret += '\\n';\r\n\t//}\r\n\t/*\r\n\tret += '\\n//===============================';\r\n\tret += `\\n//============= UQs =============`;\r\n\tret += '\\n//===============================';\r\n\tret += '\\nexport interface UQs {';\r\n\tfor (let uq of uqs) {\r\n\t\tlet {uqOwner, uqName} = uq;\r\n\t\tlet o1 = getUqOwnerName(uqOwner);\r\n\t\tlet n1 = getUqName(uqName);\r\n\t\tret += `\\n\\t${o1}${n1}: ${o1}${n1}.Uq;`;\r\n\t}\r\n\tret += '\\n}\\n';\r\n\t*/\r\n\treturn ret;\r\n}\r\n\r\nfunction capitalCaseString(s: string): string {\r\n\tlet parts = s.split(/[-._]/);\r\n\treturn parts.map(v => firstCharUppercase(v)).join('');\r\n}\r\n\r\nfunction camelCaseString(s: string): string {\r\n\tlet parts = s.split(/[-._]/);\r\n\tlet len = parts.length;\r\n\tparts[0] = firstCharLowercase(parts[0]);\r\n\tfor (let i = 1; i < len; i++) {\r\n\t\tparts[1] = firstCharUppercase(parts[1]);\r\n\t}\r\n\treturn parts.join('');\r\n}\r\nfunction entityName(s: string): string {\r\n\treturn capitalCaseString(s);\r\n}\r\n\r\nfunction getUqOwnerName(uqOwner: string) {\r\n\tlet uo = gUqOwnerMap[uqOwner.toLowerCase()];\r\n\tif (uo === undefined) return '';\r\n\tif (uo.length === 0) return '';\r\n\treturn capitalCaseString(uo);\r\n}\r\n\r\nfunction getUqName(uqName: string) {\r\n\treturn capitalCaseString(uqName);\r\n}\r\n\r\nfunction uqBlock<T extends Entity>(entity: T, build: (entity: T) => string) {\r\n\tlet { name } = entity;\r\n\tif (name.indexOf('$') > 0) return '';\r\n\tlet entityCode = build(entity);\r\n\tif (!entityCode) return '';\r\n\treturn '\\n' + entityCode;\r\n}\r\n\r\nfunction uqEntityInterface<T extends Entity>(entity: T, buildInterface: (entity: T) => string) {\r\n\tlet { name } = entity;\r\n\tif (name.indexOf('$') > 0) return '';\r\n\tlet entityCode = buildInterface(entity);\r\n\tif (!entityCode) return '';\r\n\t//return uqFirstLine(entity) + \r\n\treturn '\\n' + entityCode + '\\n';\r\n}\r\n\r\nconst aCode = 'a'.charCodeAt(0);\r\nconst zCode = 'z'.charCodeAt(0);\r\nfunction firstCharUppercase(s: string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= aCode && c <= zCode) {\r\n\t\treturn String.fromCharCode(c - 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\nconst ACode = 'A'.charCodeAt(0);\r\nconst ZCode = 'Z'.charCodeAt(0);\r\nfunction firstCharLowercase(s: string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= ACode && c <= ZCode) {\r\n\t\treturn String.fromCharCode(c + 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\n\r\nasync function loadUqEntities(uq: UqMan): Promise<void> {\r\n\tawait uq.loadAllSchemas();\r\n\t/*\r\n\tlet arr: Promise<any>[] = [];\r\n\tuq.actionArr.forEach(v => arr.push(v.loadSchema()));\r\n\tuq.enumArr.forEach(v => arr.push(v.loadSchema()));\r\n\tuq.sheetArr.forEach(v => arr.push(v.loadSchema()));\r\n\tuq.queryArr.forEach(v => arr.push(v.loadSchema()));\r\n\tuq.bookArr.forEach(v => arr.push(v.loadSchema()));\r\n\tuq.mapArr.forEach(v => arr.push(v.loadSchema()));\r\n\tuq.historyArr.forEach(v => arr.push(v.loadSchema()));\r\n\tuq.pendingArr.forEach(v => arr.push(v.loadSchema()));\r\n\tuq.tagArr.forEach(v => arr.push(v.loadSchema()));\r\n\tawait Promise.all(arr);\r\n\t*/\r\n}\r\n\r\nfunction buildUQ(uq: UqMan) {\r\n\tlet { uqOwner, uqName } = uq;\r\n\tlet ts: string = ``;\r\n\tuq.enumArr.forEach(v => ts += uqEntityInterface<UqEnum>(v, buildEnumInterface));\r\n\r\n\tts += `\\nexport declare namespace ${getUqOwnerName(uqOwner)}${getUqName(uqName)} {`;\r\n\tuq.tuidArr.forEach(v => ts += uqEntityInterface<Tuid>(v, buildTuidInterface));\r\n\tuq.actionArr.forEach(v => ts += uqEntityInterface<Action>(v, buildActionInterface));\r\n\tuq.sheetArr.forEach(v => ts += uqEntityInterface<Sheet>(v, buildSheetInterface));\r\n\tuq.queryArr.forEach(v => ts += uqEntityInterface<Query>(v, buildQueryInterface));\r\n\tuq.bookArr.forEach(v => ts += uqEntityInterface<Book>(v, buildBookInterface));\r\n\tuq.mapArr.forEach(v => ts += uqEntityInterface<Map>(v, buildMapInterface));\r\n\tuq.historyArr.forEach(v => ts += uqEntityInterface<History>(v, buildHistoryInterface));\r\n\tuq.pendingArr.forEach(v => ts += uqEntityInterface<Pending>(v, buildPendingInterface));\r\n\tuq.tagArr.forEach(v => ts += uqEntityInterface<Tag>(v, buildTagInterface));\r\n\r\n\tts += `\\n\\nexport interface Uq${getUqOwnerName(uqOwner)}${getUqName(uqName)} {`;\r\n\tuq.tuidArr.forEach(v => ts += uqBlock<Tuid>(v, buildTuid));\r\n\tuq.actionArr.forEach(v => ts += uqBlock<Action>(v, buildAction));\r\n\t//uq.enumArr.forEach(v => ts += uqBlock<UqEnum>(v, buildEnum));\r\n\tuq.sheetArr.forEach(v => ts += uqBlock<Sheet>(v, buildSheet));\r\n\tuq.queryArr.forEach(v => ts += uqBlock<Query>(v, buildQuery));\r\n\tuq.bookArr.forEach(v => ts += uqBlock<Book>(v, buildBook));\r\n\tuq.mapArr.forEach(v => ts += uqBlock<Map>(v, buildMap));\r\n\tuq.historyArr.forEach(v => ts += uqBlock<History>(v, buildHistory));\r\n\tuq.pendingArr.forEach(v => ts += uqBlock<Pending>(v, buildPending));\r\n\tuq.tagArr.forEach(v => ts += uqBlock<Tag>(v, buildTag));\r\n\tts += '\\n}\\n}\\n';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildFields(fields: Field[], indent: number = 1) {\r\n\tif (!fields) return;\r\n\tlet ts = '';\r\n\tfor (let f of fields) {\r\n\t\tts += buildField(f, indent);\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\nconst fieldTypeMap: { [type: string]: string } = {\r\n\t\"char\": \"string\",\r\n\t\"text\": \"string\",\r\n\t\"id\": \"number\",\r\n\t\"int\": \"number\",\r\n\t\"bigint\": \"number\",\r\n\t\"smallint\": \"number\",\r\n\t\"tinyint\": \"number\",\r\n};\r\nfunction buildField(field: Field, indent: number = 1) {\r\n\tlet { type } = field;\r\n\tlet s = fieldTypeMap[type];\r\n\tif (!s) s = 'any';\r\n\treturn `\\n${'\\t'.repeat(indent)}${field.name}: ${s};`;\r\n}\r\n\r\nfunction buildArrs(arrFields: ArrFields[]): string {\r\n\tif (!arrFields) return '';\r\n\tlet ts = '\\n';\r\n\tfor (let af of arrFields) {\r\n\t\tts += `\\t${camelCaseString(af.name)}: {`;\r\n\t\tts += buildFields(af.fields, 2);\r\n\t\tts += '\\n\\t}[];\\n';\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\nfunction buildReturns(entity: Entity, returns: ArrFields[]): string {\r\n\tif (!returns) return;\r\n\tlet { sName } = entity;\r\n\tsName = capitalCaseString(sName);\r\n\tlet ts = '';\r\n\tfor (let ret of returns) {\r\n\t\tlet retName = capitalCaseString(ret.name);\r\n\t\tts += `interface Return${sName}${retName} {`;\r\n\t\tts += buildFields(ret.fields);\r\n\t\tts += '\\n}\\n';\r\n\t}\r\n\r\n\tts += `interface Result${sName} {\\n`;\r\n\tfor (let ret of returns) {\r\n\t\tlet retName = capitalCaseString(ret.name);\r\n\t\tts += `\\t${ret.name}: Return${sName}${retName}[];\\n`;\r\n\t}\r\n\tts += '}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildTuid(tuid: Tuid) {\r\n\tlet ts = `\\t${entityName(tuid.sName)}: UqTuid<Tuid${capitalCaseString(tuid.sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildTuidInterface(tuid: Tuid) {\r\n\tlet ts = `export interface Tuid${capitalCaseString(tuid.sName)} {`;\r\n\tts += buildFields(tuid.fields);\r\n\tts += '\\n}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildAction(action: Action) {\r\n\tlet ts = `\\t${entityName(action.sName)}: UqAction<Param${capitalCaseString(action.sName)}, Result${capitalCaseString(action.sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildActionInterface(action: Action) {\r\n\tlet ts = `export interface Param${capitalCaseString(action.sName)} {`;\r\n\tts += buildFields(action.fields);\r\n\tts += buildArrs(action.arrFields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(action, action.returns);\r\n\treturn ts;\r\n}\r\n\r\nfunction buildEnumInterface(enm: UqEnum) {\r\n\tlet { schema } = enm;\r\n\tif (!schema) return;\r\n\tlet { values } = schema;\r\n\tlet ts = `export enum ${capitalCaseString(enm.sName)} {`;\r\n\tlet first: boolean = true;\r\n\tfor (let i in values) {\r\n\t\tif (first === false) {\r\n\t\t\tts += ',';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\t\tlet v = values[i];\r\n\t\tts += '\\n\\t' + i + ' = ';\r\n\t\tif (typeof v === 'string') {\r\n\t\t\tts += '\"' + v + '\"';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tts += v;\r\n\t\t}\r\n\t}\r\n\treturn ts += '\\n};'\r\n}\r\n\r\nfunction buildQuery(query: Query) {\r\n\tlet { sName } = query;\r\n\tlet ts = `\\t${entityName(sName)}: UqQuery<Param${capitalCaseString(sName)}, Result${capitalCaseString(sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildQueryInterface(query: Query) {\r\n\tlet ts = `export interface Param${capitalCaseString(query.sName)} {`;\r\n\tts += buildFields(query.fields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(query, query.returns);\r\n\treturn ts;\r\n}\r\n\r\nfunction buildSheet(sheet: Sheet) {\r\n\tlet { sName, verify } = sheet;\r\n\tlet cName = capitalCaseString(sName);\r\n\tlet v = verify ? `Verify${cName}` : 'any';\r\n\tlet ts = `\\t${entityName(sName)}: UqSheet<Sheet${cName}, ${v}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildSheetInterface(sheet: Sheet) {\r\n\tlet { sName, fields, arrFields, verify } = sheet;\r\n\tlet ts = `export interface Sheet${capitalCaseString(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += buildArrs(arrFields);\r\n\tts += '}';\r\n\r\n\tif (verify) {\r\n\t\tlet { returns } = verify;\r\n\t\tts += `\\nexport interface Verify${capitalCaseString(sName)} {`;\r\n\t\tfor (let item of returns) {\r\n\t\t\tlet { name: arrName, fields } = item;\r\n\t\t\tts += '\\n\\t' + arrName + ': {';\r\n\t\t\tts += buildFields(fields, 2);\r\n\t\t\tts += '\\n\\t}[];';\r\n\t\t}\r\n\t\tts += '\\n}';\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\nfunction buildBook(book: Book): string {\r\n\treturn;\r\n}\r\n\r\nfunction buildBookInterface(book: Book): string {\r\n\treturn;\r\n}\r\n\r\nfunction buildMap(map: Map): string {\r\n\treturn;\r\n}\r\n\r\nfunction buildMapInterface(map: Map): string {\r\n\treturn;\r\n}\r\n\r\nfunction buildHistory(history: History): string {\r\n\treturn;\r\n}\r\n\r\nfunction buildHistoryInterface(history: History): string {\r\n\treturn;\r\n}\r\n\r\nfunction buildPending(pending: Pending): string {\r\n\treturn;\r\n}\r\n\r\nfunction buildPendingInterface(pending: Pending): string {\r\n\treturn;\r\n}\r\n\r\nfunction buildTag(tag: Tag): string {\r\n\treturn;\r\n}\r\n\r\nfunction buildTagInterface(tag: Tag): string {\r\n\treturn;\r\n}\r\n","export interface Id {\r\n    id: number;\r\n}\r\n\r\nexport interface Api {\r\n    name: string;\r\n    url: string;\r\n    token: string;\r\n}\r\n\r\nexport interface App extends Id {\r\n    name: string;\r\n    discription: string;\r\n    icon: string;\r\n    owner: number;\r\n    ownerName: string;\r\n    ownerDiscription: string;\r\n    url: string;\r\n    apis?: {[name:string]: Api};\r\n}\r\n\r\nexport interface Unit extends Id {\r\n    type: number;\r\n    name: string;\r\n    nick: string;\r\n    discription: string;\r\n    icon: string;\r\n    readMe: string;\r\n    isRoot: number;\r\n    isOwner: number;\r\n    isAdmin: number;\r\n    isDev: number;\r\n    owner?: number;\r\n    ownerName?: string;\r\n    ownerNick?: string;\r\n    ownerIcon?: string;\r\n}\r\n\r\nconst unitCaptions = {\r\n    1: '开发号',\r\n    2: '小号',\r\n    3: '系统号'\r\n}\r\nexport function unitCaption(unit:Unit):String {\r\n    return unitCaptions[unit.type] as string\r\n}\r\n\r\nexport interface UnitApps extends Unit {\r\n    apps: App[];\r\n}\r\n\r\nexport interface UnitAdmin extends Id {\r\n    name: string;\r\n    nick: string;\r\n    icon: string;\r\n    type: number;\r\n    country: string;\r\n    mobile: string;\r\n    email: string;\r\n    isRoot: number;\r\n    isOwner: number;\r\n    isAdmin: number;\r\n    isDev: number;\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {FormView, FormProps} from './formView';\r\n\r\n/*\r\nexport function tonvaDebug() {\r\n    let a = 0;\r\n}\r\n*/\r\nexport interface TonvaFormProps extends FormProps {\r\n    className?: string;\r\n    initValues?: any;\r\n}\r\n\r\n@observer \r\nexport class TonvaForm extends React.Component<TonvaFormProps, {}> {\r\n    formView: FormView;\r\n    constructor(props:TonvaFormProps) {\r\n        super(props);\r\n        this.formView = new FormView(this.props);\r\n        this.formView.setInitValues(this.props.initValues);\r\n    }\r\n    debug() {\r\n        //let s = null;\r\n    }\r\n    render() {\r\n        let {className, children} = this.props;\r\n        return <div className={className}>\r\n            {\r\n                children === undefined? \r\n                    this.formView.render() : \r\n                    <form onSubmit={this.formView.onSubmit}>{children}</form>\r\n            }\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport className from 'classnames';\r\nimport {FormProps, FormRow, SubmitResult, TonvaForm} from '../form';\r\n\r\nexport interface Step {\r\n    formRows: FormRow[];\r\n    next: undefined | string | ((values:any) => string);    // 返回下一步的step名称或者直接就是名称\r\n    ex?: any;                                   // 每一步额外的参数\r\n}\r\n\r\nexport interface MultiStepProps {\r\n    className?: string;\r\n    header?: (step:Step, num:number) => JSX.Element; //name: step name, num: 第几步，1开始\r\n    footer?: (step:Step, num:number) => JSX.Element; //name: step name, num: 第几步，1开始\r\n    steps: {[name:string]: Step};\r\n    first: string;         // 第一步的名字\r\n    onSubmit: (values:any) => Promise<SubmitResult|undefined>;\r\n    submitButton?: string|JSX.Element;\r\n}\r\n\r\nexport interface StepView {\r\n    stepName: string;\r\n    step: Step;\r\n    props: FormProps;\r\n    //view: JSX.Element;\r\n}\r\nexport interface MultiStepState {\r\n    //num: number;\r\n    //step: Step;\r\n    //formView: FormView;\r\n    topView: StepView;\r\n    stepViews: StepView[];\r\n}\r\n\r\nexport class MultiStep extends React.Component<MultiStepProps, MultiStepState> {\r\n    private values: any = {};\r\n    private stepViews: StepView[] = [];\r\n    private topView: StepView;\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            topView: undefined,\r\n            stepViews: [],\r\n        }\r\n        //this.onPrev = this.onPrev.bind(this);\r\n        //this.onNext = this.onNext.bind(this);\r\n        this.setStep(this.props.first);\r\n    }\r\n    \r\n    private setStep(stepName: string) {\r\n        let step = this.props.steps[stepName];\r\n        if (step === undefined) return; //throw new Error('Unknown step name: ' + stepName);\r\n        if (this.topView !== undefined) this.stepViews.push(this.topView);\r\n        let otherButton, onOther;\r\n        if (this.stepViews.length > 0) {\r\n            otherButton = <ButtonConten prefix=\"undo\" text=\"上一步\" />;\r\n            onOther = this.onPrev;\r\n        }\r\n        //let {header, footer} = this.props;\r\n        let btnContent = step.next === undefined?\r\n            {prefix: 'cloud-upload', text: this.props.submitButton || '提交'} :\r\n            {suffix: 'arrow-right', text: '下一步'}\r\n        let formProps = {\r\n            formRows: step.formRows,\r\n            submitButton: <ButtonConten {...btnContent} />,\r\n            onSubmit: this.onNext,\r\n            otherButton: otherButton,\r\n            onOther: onOther,\r\n        };\r\n        //let num = this.stepViews.length + 1;\r\n        this.topView = {\r\n            stepName: stepName,\r\n            step: step,\r\n            props: formProps,\r\n        };\r\n        this.setState({\r\n            topView: this.topView,\r\n            stepViews: this.stepViews\r\n        });\r\n    }\r\n    private onPrev = (values:any) => {\r\n        _.assign(this.values, values);\r\n        this.topView = this.stepViews.pop();\r\n        this.setState({\r\n            topView: this.topView,\r\n            stepViews: this.stepViews\r\n        });\r\n    }\r\n    private onNext = (values:any): Promise<SubmitResult|undefined> => {\r\n        _.assign(this.values, values);\r\n        //let {num, step} = this.state;\r\n        let {next} = this.topView.step;\r\n        if (next === undefined) {\r\n            return this.props.onSubmit(this.values)\r\n        }\r\n        let nextStepName:string;\r\n        if (typeof next === 'string') {\r\n            nextStepName = next;\r\n        }\r\n        else {\r\n            nextStepName = next(this.values);\r\n        }\r\n        this.setStep(nextStepName);\r\n    }\r\n    render() {\r\n        let {className, header, footer} = this.props;\r\n        let {topView, stepViews} = this.state;\r\n        let {stepName, step} = topView;\r\n        //let hidden = {visibility: 'hidden'};\r\n        let num = stepViews.length + 1;\r\n        return <div className={className}>\r\n            <div>\r\n                {header && header(step, num)}\r\n                <TonvaForm key={stepName} initValues={this.values} {...topView.props} />\r\n                {footer && footer(step, num)}\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nconst ButtonConten = (props:{prefix?:string, text?:string|JSX.Element, suffix?:string}) => {\r\n    let {prefix, suffix} = props;\r\n    let pIcon:any, sIcon:any;\r\n    if (prefix !== undefined) pIcon = <i className={className('fa', 'fa-' + prefix)} />;\r\n    if (suffix !== undefined) sIcon = <i className={className('fa', 'fa-' + suffix)} />;\r\n    return <React.Fragment>{pIcon} {props.text} {sIcon}</React.Fragment>;\r\n}\r\n    \r\n","import _ from 'lodash';\r\nimport { Context } from '../context';\r\nimport { FormRes } from '../../../res/formRes';\r\n\r\nexport abstract class Rule {\r\n    abstract check(defy:string[], value:any):void;\r\n}\r\n\r\nexport type ContextRule = (context:Context)=>{[target:string]:string[]|string} | string[] | string;\r\nexport type FieldRule = (value:any) => string[] | string;\r\n\r\nexport class RuleCustom extends Rule {\r\n    private func: FieldRule;\r\n    constructor(func: FieldRule) {\r\n        super();\r\n        this.func = func;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        let ret = this.func(value);\r\n        if (ret === undefined) return;\r\n        switch (typeof ret) {\r\n            case 'undefined': return;\r\n            case 'string': defy.push(ret as string); return;\r\n            default: defy.push(...ret); return;\r\n        }        \r\n    }\r\n}\r\n\r\nexport abstract class RulePredefined extends Rule {\r\n    protected res: FormRes;\r\n    constructor(res: FormRes) {\r\n        super();\r\n        this.res = res;\r\n    }\r\n}\r\n\r\nexport class RuleRequired extends RulePredefined {\r\n    check(defy:string[], value:any) {\r\n        switch (typeof value) {\r\n            default:\r\n            case 'boolean': return;\r\n            case 'object':\r\n                if (value !== null) return;\r\n                break;\r\n            case 'string':\r\n                if ((value as string).trim().length > 0) return;\r\n                break;\r\n            case 'number':\r\n                if (isNaN(value as number) === false) return;\r\n                break;\r\n            case 'undefined':\r\n                break;\r\n        }\r\n        defy.push(this.res.required);\r\n    }\r\n}\r\n\r\nexport class RuleNum extends RulePredefined {\r\n    private minMsg: _.TemplateExecutor;\r\n    private maxMsg: _.TemplateExecutor;\r\n    protected min: number;\r\n    protected max: number\r\n    constructor(res: FormRes, min?: number, max?: number) {\r\n        super(res);\r\n        this.minMsg = _.template(res.min);\r\n        this.maxMsg = _.template(res.max);\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        if (value === undefined || value === null) return;\r\n        let n = Number(value);\r\n        if (isNaN(n) === true) {\r\n            defy.push(this.res.number);\r\n        }\r\n        else {\r\n            this.checkMore(defy, n);\r\n        }\r\n    }\r\n\r\n    protected checkMore(defy:string[], value: number) {\r\n        if (this.min !== undefined && Number(value) < this.min) {\r\n            defy.push(this.minMsg({min:this.min}));\r\n        }\r\n        if (this.max !== undefined && Number(value) > this.max) {\r\n            defy.push(this.maxMsg({max:this.max}));\r\n        }\r\n    }\r\n}\r\n\r\nexport class RuleInt extends RuleNum {\r\n    protected checkMore(defy:string[], n: number) {\r\n        super.checkMore(defy, n);\r\n        if (Number.isInteger(n) === false) {\r\n            defy.push(this.res.integer);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiItem, ChangingHandler, ChangedHandler } from '../../schema';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { ItemSchema } from '../../schema';\r\nimport { Rule, RuleRequired, RuleCustom, FieldRule } from '../rules';\r\nimport { computed, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Widget {\r\n    name: string;\r\n    protected context: Context;\r\n    protected fieldProps: FieldProps;\r\n    protected children: React.ReactNode;\r\n    protected _itemSchema: ItemSchema;\r\n    protected _ui: UiItem;\r\n    protected defaultValue: any;\r\n    protected value: any;\r\n    protected rules: Rule[];\r\n    @observable errors: string[] = [];\r\n    @observable protected contextErrors: string[] = [];\r\n    @computed protected get hasError(): boolean { return (this.errors.length + this.contextErrors.length) > 0 }\r\n    protected readOnly: boolean;\r\n    protected disabled: boolean;\r\n    @observable visible: boolean;\r\n\r\n    constructor(context: Context, itemSchema: ItemSchema, fieldProps: FieldProps, children: React.ReactNode) {\r\n        this.context = context;\r\n        let { name } = itemSchema;\r\n        this.name = name;\r\n        this._itemSchema = itemSchema;\r\n        this.fieldProps = fieldProps;\r\n        this.children = children;\r\n        this._ui = context.getUiItem(name);\r\n        if (this.ui === undefined) {\r\n            this.readOnly = false;\r\n            this.disabled = false;\r\n            this.visible = true;\r\n        }\r\n        else {\r\n            let { readOnly, disabled, visible } = this.ui;\r\n            this.readOnly = (readOnly === true);\r\n            this.disabled = (disabled === true);\r\n            this.visible = !(visible === false);\r\n        }\r\n        this.value = this.defaultValue = context.getValue(name); //defaultValue;\r\n        // this.init();\r\n    }\r\n\r\n    protected get itemSchema(): ItemSchema { return this._itemSchema };\r\n    protected get ui(): UiItem { return this._ui };\r\n\r\n    init() {\r\n        this.rules = [];\r\n        if (this.itemSchema.required === true) {\r\n            this.rules.push(new RuleRequired(this.context.form.res));\r\n        }\r\n        this.buildRules();\r\n        if (this.ui === undefined) return;\r\n        let { rules } = this.ui;\r\n        if (rules === undefined) return;\r\n        if (Array.isArray(rules) === false) {\r\n            this.rules.push(new RuleCustom(rules as FieldRule));\r\n            return;\r\n        }\r\n        for (let rule of rules as FieldRule[]) {\r\n            this.rules.push(new RuleCustom(rule));\r\n        }\r\n    }\r\n\r\n    protected buildRules() {\r\n    }\r\n\r\n    checkRules() {\r\n        let defy: string[] = [];\r\n        for (let r of this.rules) r.check(defy, this.value);\r\n        if (defy.length === 0) {\r\n            this.context.removeErrorWidget(this);\r\n        }\r\n        else {\r\n            this.context.addErrorWidget(this);\r\n            this.errors.push(...defy);\r\n        }\r\n    }\r\n\r\n    @computed get isOk() {\r\n        return this.errors.length === 0;\r\n    }\r\n\r\n    setError(err: string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.errors.push(err);\r\n        else this.errors.push(...err);\r\n    }\r\n\r\n    setContextError(err: string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.contextErrors.push(err);\r\n        else this.contextErrors.push(...err);\r\n    }\r\n\r\n    clearError() {\r\n        this.errors.splice(0);\r\n    }\r\n\r\n    clearContextError() {\r\n        this.contextErrors.splice(0);\r\n    }\r\n\r\n    protected parse(value: any): any { return value }\r\n\r\n    protected setElementValue(value: any) { }\r\n    protected setDataValue(value: any) {\r\n        if (this.isChanging === true) return;\r\n        this.context.initData[this.name] = this.value = this.parse(value);\r\n    }\r\n\r\n    setValue(value: any) {\r\n        if (this.isChanging === true) return;\r\n        //this.setDataValue(value);\r\n        //this.setElementValue(value);\r\n        this.changeValue(value, false);\r\n    }\r\n\r\n    getValue() {\r\n        return this.context.getValue(this.name);\r\n    }\r\n\r\n    getReadOnly(): boolean { return this.readOnly }\r\n    getDisabled(): boolean { return this.disabled }\r\n    getVisible(): boolean { return this.visible }\r\n    setReadOnly(value: boolean) { this.readOnly = value }\r\n    setDisabled(value: boolean) { this.disabled = value }\r\n    setVisible(value: boolean) { this.visible = value }\r\n\r\n    private isChanging: boolean;\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n\r\n    protected changeValue(newValue: any, fromElement: boolean) {\r\n        let prev = this.value;\r\n        let onChanging: ChangingHandler;\r\n        let onChanged: ChangedHandler;\r\n        if (this.ui !== undefined) {\r\n            onChanging = this.ui.onChanging;\r\n            onChanged = this.ui.onChanged;\r\n        }\r\n        let allowChange = true;\r\n        if (onChanging !== undefined) {\r\n            this.isChanging = true;\r\n            allowChange = onChanging(this.context, this.value, prev);\r\n            this.isChanging = false;\r\n        }\r\n        if (allowChange === true) {\r\n            this.setDataValue(newValue);\r\n            if (fromElement !== true) this.setElementValue(newValue);\r\n            if (onChanged !== undefined) {\r\n                this.isChanging = true;\r\n                onChanged(this.context, this.value, prev);\r\n                this.isChanging = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected get className(): string {\r\n        let fieldClass: string;\r\n        if (this.context.inNode === false) fieldClass = 'form-control';\r\n        return classNames(fieldClass, this.context.form.FieldClass, this.ui && this.ui.className);\r\n    }\r\n\r\n    protected abstract render(): JSX.Element;\r\n\r\n    protected renderBody(): JSX.Element {\r\n        let elDiscription;\r\n        if (this.hasError === false && this.ui) {\r\n            let { discription, discriptionClassName } = this.ui;\r\n            if (discriptionClassName === undefined) discriptionClassName = 'small text-muted';\r\n            elDiscription = <span className={discriptionClassName}>\r\n                {discription}\r\n            </span>;\r\n        }\r\n        return <>\r\n            {this.render()}\r\n            {elDiscription}\r\n        </>;\r\n    }\r\n\r\n    container = observer((): JSX.Element => {\r\n        if (this.visible === false) return null;\r\n        let { form, inNode } = this.context;\r\n        if (inNode === true) return this.render();\r\n        let label: any = this.label;\r\n        if (this.itemSchema.required === true && form.props.requiredFlag !== false) {\r\n            if (label !== null) label = <>{label}&nbsp;<span className=\"text-danger\">*</span></>;\r\n        }\r\n        return form.FieldContainer(label, this.renderBody());\r\n    })\r\n\r\n    protected get label(): string {\r\n        let label: any;\r\n        if (this.ui === undefined) {\r\n            label = this.name;\r\n        }\r\n        else {\r\n            let uiLabel = this.ui.label;\r\n            if (uiLabel === null) label = null;\r\n            else label = uiLabel || this.name;\r\n        }\r\n        return label;\r\n    }\r\n\r\n    protected renderTemplet(): JSX.Element | undefined {\r\n        if (this.children !== undefined) {\r\n            return <>{this.children}</>;\r\n        }\r\n        if (this.ui === undefined) return undefined;\r\n        let { Templet } = this.ui;\r\n        if (typeof Templet === 'function') return Templet(this.value);\r\n        return Templet;\r\n    }\r\n\r\n    protected renderErrors() {\r\n        let errorList: string[] = [...this.errors, ...this.contextErrors];\r\n        if (errorList.length === 0) return null;\r\n        let { inNode } = this.context;\r\n        let tag = inNode === true ? 'span' : 'div';\r\n        return errorList.map(err => React.createElement(tag,\r\n            {\r\n                key: err,\r\n                className: 'text-danger d-inline-block my-2 ms-3'\r\n            },\r\n            <><i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}</>\r\n        ));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTextItem, StringSchema } from '../../schema';\r\nimport { observable } from 'mobx';\r\n\r\nexport class TextWidget extends Widget {\r\n    protected inputType = 'text';\r\n    protected get ui(): UiTextItem {return this._ui as UiTextItem};\r\n    protected input: HTMLInputElement;\r\n    @observable protected hasFocus: boolean;\r\n\r\n    protected setElementValue(value:any) {\r\n        if (this.input === null) return;\r\n        this.input.value = value;\r\n    }\r\n    protected get placeholder() {return (this.ui && this.ui.placeholder) || this.name}\r\n    protected onKeyDown = async (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n        this.internalOnKeyDown(evt);\r\n        if (evt.keyCode !== 13) return;\r\n        let {onEnter} = this.context.form.props;\r\n        if (onEnter === undefined) return;\r\n\r\n        this.changeValue(evt.currentTarget.value, true);\r\n\r\n        //this.checkRules();\r\n        //this.context.checkContextRules();\r\n        this.input.blur();\r\n\r\n        let ret = await onEnter(this.name, this.context);\r\n        if (ret !== undefined) {\r\n            this.context.setError(this.name, ret);\r\n        }\r\n    }\r\n\r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n    }\r\n\r\n    protected onBlur = (evt: React.FocusEvent<any>) => {\r\n        this.onInputChange(evt);\r\n        this.checkRules();\r\n\t\tthis.context.checkContextRules();\r\n\t\tthis.hasFocus = false;\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n        this.clearError();\r\n        this.context.removeErrorWidget(this);\r\n        this.context.clearErrors();\r\n\t\tthis.hasFocus = true;\r\n    }\r\n    protected onChange(evt: React.ChangeEvent<any>) {\r\n    }\r\n\r\n    setReadOnly(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.readOnly = this.readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.disabled = this.disabled = value;\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {\r\n            //'form-control': true,\r\n        };\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, cn)}\r\n            type={this.inputType}\r\n            defaultValue={this.value}\r\n            onChange={(evt: React.ChangeEvent<any>) => this.onChange(evt)}\r\n            placeholder={this.placeholder}\r\n            readOnly={this.readOnly}\r\n            disabled={this.disabled}\r\n            onKeyDown = {this.onKeyDown}\r\n            onFocus = {this.onFocus}\r\n            onBlur={this.onBlur}\r\n            maxLength={(this.itemSchema as StringSchema).maxLength} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTextAreaItem } from '../../schema';\r\nimport { StringSchema } from '../../schema';\r\n\r\nexport class TextAreaWidget extends Widget {\r\n    protected get itemSchema(): StringSchema {return this._itemSchema as StringSchema};\r\n    protected input: HTMLTextAreaElement;\r\n    protected get ui(): UiTextAreaItem {return this._ui as UiTextAreaItem};\r\n\r\n    protected setElementValue(value:any) {this.input.value = value}\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.setValue(evt.currentTarget.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n\tprotected onBlur = (evt: React.FocusEvent<any>) => {\r\n        this.onInputChange(evt);\r\n        this.checkRules();\r\n        this.context.checkContextRules();\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n        this.clearError();\r\n        this.context.removeErrorWidget(this);\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {};\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <>\r\n\t\t\t<textarea ref={(input) => this.input=input}\r\n\t\t\t\tonBlur={this.onBlur} \r\n\t\t\t\tonFocus={this.onFocus}\r\n                className={classNames(this.className, cn)}\r\n                rows={this.ui && this.ui.rows}\r\n                maxLength={this.itemSchema.maxLength}\r\n                defaultValue={this.defaultValue} onChange={this.onInputChange} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class PasswordWidget extends TextWidget {\r\n    protected inputType = 'password';\r\n}\r\n\r\nexport class UrlWidget extends TextWidget {\r\n    protected inputType = 'url';\r\n}\r\n\r\nexport class EmailWidget extends TextWidget {\r\n    protected inputType = 'email';\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\nimport { RuleNum, RuleInt } from '../rules';\r\nimport { NumBaseSchema } from '../../schema';\r\n\r\nexport class NumberWidget extends TextWidget {\r\n    protected inputType = 'number';\r\n    protected get itemSchema(): NumBaseSchema {return this._itemSchema as NumBaseSchema};\r\n\r\n    protected buildRules() {\r\n        super.buildRules();\r\n        let res = this.context.form.res;\r\n        let {min, max} = this.itemSchema;\r\n        this.rules.push(\r\n            this.itemSchema.type === 'integer'?\r\n                new RuleNum(res, min, max) :\r\n                new RuleInt(res, min, max)\r\n        );\r\n        /*\r\n        if (this.itemSchema.type === 'integer') {\r\n            this.rules.push(new RuleInt);\r\n        }\r\n        let {min, max} = this.itemSchema;\r\n        if (min !== undefined) this.rules.push(new RuleMin(min));\r\n        if (max !== undefined) this.rules.push(new RuleMax(max));\r\n        */\r\n    }\r\n\r\n    protected parse(value:any):any {\r\n        if (value === undefined || value === null) return;\r\n        return Number(value);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { NumberWidget } from './numberWidget';\r\n\r\nexport class UpdownWidget extends NumberWidget {\r\n    protected inputType = 'number';\r\n\r\n    protected isValidKey(key:number):boolean {\r\n        return key===46 || key===8 || key===37 || key===39\r\n            || (key>=48 && key<=57)\r\n            || (key>=96 && key<=105)\r\n            || key===109 || key===189;\r\n    }\r\n    \r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n        let key = evt.keyCode;\r\n        window.event.returnValue = this.isValidKey(key);\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class DateWidget extends TextWidget {\r\n    protected inputType = 'date';\r\n}\r\n\r\nexport class DateTimeWidget extends TextWidget {\r\n    protected inputType = 'datetime';\r\n}\r\n\r\nexport class TimeWidget extends TextWidget {\r\n    protected inputType = 'time';\r\n}\r\n\r\nexport class MonthWidget extends TextWidget {\r\n    protected inputType = 'month';\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiCheckItem } from '../../schema';\r\n\r\nexport class CheckBoxWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiCheckItem {return this._ui as UiCheckItem};\r\n    protected trueValue: any;\r\n    protected falseValue: any;\r\n\r\n    init() {\r\n        super.init();\r\n        if (this.ui !== undefined) {\r\n            let {trueValue, falseValue} = this.ui;\r\n            if (trueValue === undefined) this.trueValue = true;\r\n            else this.trueValue = trueValue;\r\n            if (falseValue === undefined) this.falseValue = false;\r\n            else this.falseValue = falseValue;\r\n        }\r\n        else {\r\n            this.trueValue = true;\r\n            this.falseValue = false;\r\n        }\r\n    }\r\n    protected setElementValue(value:any) {\r\n        this.input.checked = value === this.trueValue;\r\n    }\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let v = evt.target.checked === true? this.trueValue : this.falseValue;\r\n        this.setDataValue(v);\r\n    }\r\n\r\n    protected onClick = () => {\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let cn = classNames(this.className, 'form-check-inline p-0');\r\n        let input = <input\r\n            ref={(input)=>this.input = input}\r\n            className={'align-self-center'}\r\n            type=\"checkbox\"\r\n            defaultChecked={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            onClick={this.onClick} />;\r\n        if (this.context.inNode === true) {\r\n            return <label className={cn}>\r\n                {input} {(this.ui&&this.ui.label) || this.name}\r\n            </label>\r\n        }\r\n        else {\r\n            return <div className={cn}>\r\n                <label className=\"w-100 h-100 mb-0 d-flex justify-content-center\">{input}</label>\r\n            </div>;\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observable } from 'mobx';\r\nimport { Widget } from './widget';\r\nimport { UiSelect } from '../../schema';\r\n\r\nexport class SelectWidget extends Widget {\r\n    protected select: HTMLSelectElement;\r\n    protected get ui(): UiSelect {return this._ui as UiSelect};\r\n    @observable protected readOnly: boolean;\r\n\r\n    protected setElementValue(value:any) {this.select.value = value}\r\n    protected onInputChange = (evt:React.ChangeEvent<HTMLSelectElement>) => {\r\n        this.setDataValue(evt.target.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.select.disabled = this.readOnly = !value}\r\n    setDisabled(value:boolean) {this.select.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        if (this.readOnly === true) {\r\n            let option = this.ui.list.find(v => v.value === this.value);\r\n            let title = (option === undefined)? '(???)' : option.title;\r\n            return <span className=\"form-control w-min-6c\">{title}</span>;\r\n        }\r\n        return <select\r\n            ref={(select)=>this.select = select}\r\n            className={classNames(this.className, 'form-control')}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}>\r\n            {this.ui.list.map((v,index) => {\r\n                let {title, value} = v;\r\n                let cn:string;\r\n                //if (value === undefined || value === null) cn = 'text-light small';\r\n                //else cn = 'text-danger';\r\n                return <option className={cn} key={index} value={value}>{title || value}</option>\r\n            })}\r\n        </select>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n//import { TextWidget } from './textWidget';\r\nimport { Widget } from './widget';\r\nimport { UiRadio } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class RadioWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiRadio {return this._ui as UiRadio};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n    }\r\n\r\n    /*\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n    */\r\n\r\n    render() {\r\n        let {defaultValue, list} = this.ui;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n        return <span className={cn} style={radioStyle}>\r\n                {list.map((v,index) => {\r\n                    let {value, title} = v;\r\n                    let name = this.name;\r\n                    if (rowKey !== undefined) name += '-' + rowKey;\r\n                    return <label key={index} className=\"form-radio-inline\">\r\n                        <input ref={input=>this.inputs[index]=input} type=\"radio\" name={name}\r\n                            value={value} defaultChecked={(this.defaultValue || defaultValue)===value}\r\n                            onChange={this.onInputChange} />\r\n                        {title || value}\r\n                    </label>;\r\n                    //</span>\r\n                })}\r\n            </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiRange } from '../../schema';\r\nimport { Widget } from './widget';\r\n\r\nexport class RangeWidget extends Widget {\r\n    protected inputType = 'range';\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiRange {return this._ui as UiRange};\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        let {min, max, step} = this.ui;\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, 'form-control', 'w-min-6c')}\r\n            type={this.inputType}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            max={max}\r\n            min={min}\r\n            step={step}\r\n            />\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiIdItem, TempletType } from '../../schema';\r\nimport { observable } from 'mobx';\r\n\r\nconst none = <small className=\"text-muted\">[无]</small>;\r\n\r\nexport class IdWidget extends Widget {\r\n    protected get ui(): UiIdItem {return this._ui as UiIdItem};\r\n    @observable protected value:number;\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {this.disabled = value}    \r\n\r\n    protected onClick = async () => {\r\n        let pickId = this.ui && this.ui.pickId;\r\n        if (pickId === undefined) {\r\n            alert('no pickId defined!');\r\n            return;\r\n        }\r\n        let id = await pickId(this.context, this.name, this.value);        \r\n        this.setDataValue(id);\r\n        this.clearError();\r\n        this.clearContextError();\r\n        this.checkRules();\r\n    }\r\n\r\n    render() {\r\n        let placeholder:string|JSX.Element, Templet: TempletType;\r\n        if (this.ui !== undefined) {\r\n            placeholder = this.ui.placeholder;\r\n            Templet = this.ui.Templet;\r\n        }\r\n        let cn:any = {\r\n            'form-control': true,\r\n            'required-item': this.itemSchema.required === true,\r\n            'cursor-pointer': true,\r\n            'is-invalid': this.hasError,\r\n        };\r\n        let content;\r\n        if (this.value === undefined || this.value === null) {\r\n            content = placeholder || none;\r\n            cn['text-muted'] = true;\r\n        }\r\n        else if (Templet === undefined) {\r\n            let c: any;\r\n            if (this.value === null) {\r\n                c = 'null';\r\n            }\r\n            else {\r\n                switch (typeof this.value) {\r\n                    case 'undefined': c = none; break;\r\n                    case 'object': c = (this.value as any).id; break;\r\n                    default: c = this.value; break;\r\n                }\r\n            }\r\n            content = <>{c}</>;\r\n        }\r\n        else if (typeof Templet === 'function') {\r\n            content = Templet(this.value);\r\n        }\r\n        else {\r\n            content = Templet;\r\n        }\r\n        return <>\r\n            <div className={classNames(cn)} onClick={this.onClick}>{content}</div>\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { DataType } from '../../schema';\r\nimport { UiType } from '../../schema';\r\n\r\nexport const Unknown = (dataType:DataType, uiType:UiType, dataTypes:DataType[]) => {\r\n    return <span className=\"text-danger\">!!data type {dataType} only support {(dataTypes || []).join(', ')}, can't use ui {uiType}!!</span>;\r\n};\r\n","import * as React from 'react';\r\nimport { UiButton, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { Widget } from './widget';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class ButtonWidget extends Widget {\r\n    protected get ui(): UiButton {return this._ui as UiButton};\r\n\r\n    protected onClick = async () => {\r\n        this.clearError();\r\n        this.clearContextError();\r\n        let {name, type} = this.itemSchema;\r\n        if (type === 'submit') {\r\n            await this.context.submit(name);\r\n        }\r\n        /*\r\n        let {onButtonClick} = this.context.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${name} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(name, this.context);\r\n        if (ret === undefined) return;\r\n        this.context.setError(name, ret);\r\n        */\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let {name, type} = this.itemSchema;\r\n        let Templet:TempletType, cn:string, caption:string;\r\n        if (this.ui !== undefined) {\r\n            let {widget:widgetType} = this.ui;\r\n            if (widgetType !== 'button') return Unknown(type, widgetType, ['button']);\r\n            Templet = this.ui.Templet;\r\n            cn = this.ui.className;\r\n            caption = this.ui.label;\r\n        }\r\n        let {form, hasError} = this.context;\r\n        let context = this.context;\r\n        let disabled = type==='submit' && hasError;\r\n        let content:any;\r\n        if (this.children !== undefined) content = this.children;\r\n        else if (typeof Templet === 'function') content = Templet();\r\n        else if (Templet !== undefined) content = Templet;\r\n        else content = caption; \r\n        let button = <button \r\n            className={cn} \r\n            type=\"button\"\r\n            disabled={disabled}\r\n            onClick={this.onClick}>\r\n            {content || name}\r\n        </button>;\r\n        if (context.inNode === true) return <>{button}{this.renderErrors()}</>;\r\n        return <div className={form.ButtonClass}>\r\n            <div>{this.renderErrors()}</div>\r\n            {button}\r\n        </div>;\r\n    });\r\n    \r\n    protected get label():string {return null}\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Form } from './form';\r\nimport { UiSchema, UiArr, UiItem } from '../schema';\r\nimport { ArrSchema, ItemSchema } from '../schema';\r\nimport { Widget } from './widgets/widget';\r\n//import { ArrRow } from './arrRow';\r\nimport { observable, computed } from 'mobx';\r\nimport { ContextRule } from './rules';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Context {\r\n    private subContexts: { [name: string]: { [rowKey: string]: Context } };\r\n    readonly form: Form;\r\n    readonly uiSchema: UiSchema;\r\n    readonly initData: any;\r\n    readonly inNode: boolean;           // true: 在</> 流中定义Field\r\n    readonly widgets: { [name: string]: Widget } = {};\r\n    readonly rules: ContextRule[];\r\n    readonly isRow: boolean;\r\n    @observable errors: string[] = [];\r\n    @observable errorWidgets: Widget[] = [];\r\n\r\n    constructor(form: Form, uiSchema: UiSchema, data: any, inNode: boolean, isRow: boolean) {\r\n        this.form = form;\r\n        this.uiSchema = uiSchema;\r\n        this.initData = data;\r\n        this.inNode = inNode;\r\n        this.isRow = isRow;\r\n        if (uiSchema !== undefined) {\r\n            let { rules } = uiSchema;\r\n            if (rules !== undefined) {\r\n                this.rules = [];\r\n                if (Array.isArray(rules) === false)\r\n                    this.rules.push(rules as ContextRule);\r\n                else\r\n                    this.rules.push(...rules as ContextRule[]);\r\n            }\r\n        }\r\n    }\r\n\r\n    getArrRowContexts(arrName: string) {\r\n        if (this.subContexts === undefined) this.subContexts = {};\r\n        let arrRowContexts = this.subContexts[arrName];\r\n        if (arrRowContexts === undefined) this.subContexts[arrName] = arrRowContexts = {};\r\n        return arrRowContexts;\r\n    }\r\n\r\n    abstract get data(): any;\r\n    abstract getItemSchema(itemName: string): ItemSchema;\r\n    abstract getUiItem(itemName: string): UiItem;\r\n    get arrName(): string { return undefined }\r\n    getValue(itemName: string): any { return this.initData[itemName] }\r\n    setValue(itemName: string, value: any) {\r\n        this.initData[itemName] = value;\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setValue(value);\r\n    }\r\n    getDisabled(itemName: string): boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) return widget.getDisabled();\r\n        return undefined;\r\n    }\r\n    setDisabled(itemName: string, value: boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setDisabled(value);\r\n    }\r\n    getReadOnly(itemName: string): boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getReadOnly();\r\n        return undefined;\r\n    }\r\n    setReadOnly(itemName: string, value: boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setReadOnly(value);\r\n    }\r\n    getVisible(itemName: string): boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getVisible();\r\n        return undefined;\r\n    }\r\n    setVisible(itemName: string, value: boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setVisible(value);\r\n    }\r\n\r\n    async submit(buttonName: string) {\r\n        this.checkRules()\r\n        if (this.hasError === true) {\r\n            let err = '';\r\n            for (let ew of this.errorWidgets) {\r\n                err += ew.name + ':\\n' + ew.errors.join('\\n');\r\n            }\r\n            console.error(err);\r\n            return;\r\n        }\r\n        let { onButtonClick } = this.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${buttonName} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this);\r\n        if (ret === undefined) return;\r\n        this.setError(buttonName, ret);\r\n\r\n    }\r\n\r\n    checkFieldRules() {\r\n        for (let i in this.widgets) {\r\n            this.widgets[i].checkRules();\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                arrRowContexts[j].checkFieldRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    checkContextRules() {\r\n        this.clearErrors();\r\n        if (this.rules === undefined) return;\r\n        for (let rule of this.rules) {\r\n            let ret = rule(this);\r\n            if (ret === undefined) continue;\r\n            if (Array.isArray(ret) === true) {\r\n                this.errors.push(...ret as string[]);\r\n            }\r\n            else if (typeof ret === 'string') {\r\n                this.errors.push(ret as string);\r\n            }\r\n            else {\r\n                for (let i in ret as object) this.setError(i, (ret as any)[i]);\r\n            }\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                let rowContext = arrRowContexts[j];\r\n                rowContext.clearErrors();\r\n                rowContext.checkContextRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    setError(itemName: string, error: string) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget === undefined) return;\r\n        widget.setContextError(error);\r\n        this.addErrorWidget(widget);\r\n    }\r\n\r\n    clearContextErrors() {\r\n        for (let i in this.widgets) {\r\n            let widget = this.widgets[i];\r\n            if (widget === undefined) continue;\r\n            widget.clearContextError();\r\n        }\r\n    }\r\n\r\n    clearWidgetsErrors() {\r\n        for (let i in this.widgets) {\r\n            let widget = this.widgets[i];\r\n            if (widget === undefined) continue;\r\n            widget.clearError();\r\n        }\r\n    }\r\n\r\n    checkRules() {\r\n        this.clearErrors();\r\n        this.clearWidgetsErrors();\r\n        this.checkFieldRules();\r\n        if (this.hasError === true) return;\r\n        this.checkContextRules();\r\n    }\r\n\r\n    addErrorWidget(widget: Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos < 0) this.errorWidgets.push(widget);\r\n    }\r\n    removeErrorWidget(widget: Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos >= 0) this.errorWidgets.splice(pos, 1);\r\n    }\r\n\r\n    protected checkHasError(): boolean {\r\n        let ret = (this.errorWidgets.length + this.errors.length) > 0;\r\n        if (ret === true) return true;\r\n        if (this.subContexts === undefined) return false;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                if (arrRowContexts[j].hasError === true) return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    @computed get hasError(): boolean {\r\n        return this.checkHasError();\r\n    };\r\n\r\n    clearErrors() {\r\n        this.errors.splice(0);\r\n        this.errorWidgets.splice(0);\r\n        this.clearContextErrors();\r\n    }\r\n\r\n    renderErrors = observer((): JSX.Element => {\r\n        let { errors } = this;\r\n        if (errors.length === 0) return null;\r\n        return <>\r\n            {errors.map(err => <span key={err} className=\"text-danger inline-block my-1 ms-3\">\r\n                <i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}\r\n            </span>)}\r\n        </>\r\n    });\r\n}\r\n\r\nlet rowKeySeed: number = 1;\r\nexport class RowContext extends Context {\r\n    readonly parentContext: Context;\r\n    readonly arrSchema: ArrSchema;\r\n    readonly rowKey: number;\r\n    readonly data: any;\r\n    //readonly uiSchema: UiArr;\r\n\r\n    constructor(parentContext: Context, arrSchema: ArrSchema, data: any, inNode: boolean) {\r\n        let uiArr: UiArr;\r\n        let { uiSchema } = parentContext;\r\n        if (uiSchema !== undefined) {\r\n            let { items } = uiSchema;\r\n            if (items !== undefined) uiArr = items[arrSchema.name] as UiArr;\r\n        }\r\n        super(parentContext.form, uiArr, data, inNode, true);\r\n        this.parentContext = parentContext;\r\n        this.arrSchema = arrSchema;\r\n        this.rowKey = rowKeySeed++;\r\n        this.data = data;\r\n    }\r\n    getItemSchema(itemName: string): ItemSchema { return this.arrSchema.itemSchemas[itemName] }\r\n    getUiItem(itemName: string): UiItem {\r\n        if (this.uiSchema === undefined) return undefined;\r\n        let { items } = this.uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName]\r\n    }\r\n    get arrName(): string { return this.arrSchema.name }\r\n    clearErrors() {\r\n        super.clearErrors();\r\n        this.parentContext.clearErrors();\r\n    }\r\n\r\n    get parentData(): any { return this.parentContext.data; }\r\n}\r\n\r\nexport class FormContext extends Context {\r\n    constructor(form: Form, inNode: boolean) {\r\n        super(form, form.uiSchema, form.data, inNode, false);\r\n    }\r\n    get data(): any { return this.form.data }\r\n    getItemSchema(itemName: string): ItemSchema { return this.form.itemSchemas[itemName] }\r\n    getUiItem(itemName: string): UiItem {\r\n        let { uiSchema } = this.form;\r\n        if (uiSchema === undefined) return undefined;\r\n        let { items } = uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName];\r\n    }\r\n}\r\n\r\nexport const ContextContainer = React.createContext<Context>({} as any);\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\n//import { ArrRow } from '../arrRow';\r\nimport { Context, RowContext, ContextContainer } from '../context';\r\nimport { ArrSchema } from '../../schema';\r\nimport { UiArr, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { factory } from './factory';\r\n\r\nexport const ArrComponent = observer((\r\n    {parentContext, arrSchema, children}:{parentContext: Context, arrSchema: ArrSchema, children: React.ReactNode}) => \r\n{\r\n    let {name, arr} = arrSchema;\r\n    let data = parentContext.initData[name] as any[];\r\n    let {form} = parentContext;\r\n    let arrRowContexts = parentContext.getArrRowContexts(name);\r\n\tlet ui = parentContext.getUiItem(name) as UiArr;\r\n\tlet {onDeleted, onRestored} = ui;\r\n    let arrLabel = name;\r\n    let Templet:TempletType;\r\n    let selectable:boolean, deletable:boolean, restorable:boolean;\r\n    let {ArrContainer, RowContainer, RowSeperator, uiSchema} = form;\r\n    if (uiSchema !== undefined) {\r\n        let {selectable:formSelectable, deletable:formDeletable, restorable:formRestorable} = uiSchema;\r\n        if (selectable !== true) selectable = formSelectable;\r\n        if (deletable !== true) deletable = formDeletable;\r\n        if (restorable !== true) restorable = formRestorable;\r\n    }\r\n    if (ui !== undefined) {\r\n        let {widget:widgetType, label, \r\n            selectable:arrSelectable, deletable:arrDeletable, restorable:arrRestorable,\r\n            ArrContainer:ac, RowContainer:rc, RowSeperator:rs\r\n        } = ui;\r\n        if (arrSelectable !== undefined) selectable = arrSelectable;\r\n        if (arrDeletable !== undefined) deletable = arrDeletable;\r\n        if (arrRestorable !== undefined) restorable = arrRestorable;\r\n        if (ac !== undefined) ArrContainer = ac;\r\n        if (rc !== undefined) RowContainer = rc;\r\n        if (rs !== undefined) RowSeperator = rs;\r\n        Templet = ui.Templet;\r\n        if (widgetType !== 'arr') return Unknown(arrSchema.type, widgetType, ['arr']);\r\n        arrLabel = label || arrLabel;\r\n    }\r\n    let first = true;\r\n    return ArrContainer(arrLabel, <>\r\n        {data.map((row:any, index) => {\r\n            let rowContext: RowContext;\r\n            let rowContent: JSX.Element;\r\n            let sep = undefined;\r\n            if (first === false) sep = RowSeperator;\r\n            else first = false;\r\n            if (children !== undefined) {\r\n                rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                rowContent = <>{children}</>;\r\n            }\r\n            else {\r\n                let typeofTemplet = typeof Templet;\r\n                if (typeofTemplet === 'function') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = React.createElement(observer(Templet as React.StatelessComponent), row);\r\n                }\r\n                else if (typeofTemplet === 'object') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = Templet as JSX.Element;\r\n                }\r\n                else {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, false);\r\n                    rowContent = <>{\r\n                        arr.map((v, index) => {\r\n                            return <React.Fragment key={v.name}>\r\n                                {factory(rowContext, v, undefined)}\r\n                            </React.Fragment>\r\n                        })}\r\n                    </>;\r\n                }\r\n            }\r\n            let {rowKey} = rowContext;\r\n            arrRowContexts[rowKey] = rowContext;\r\n\r\n            let selectCheck:JSX.Element, deleteIcon:JSX.Element;\r\n            if (selectable === true) {\r\n                let onClick = (evt: React.MouseEvent<HTMLInputElement>)=>{\r\n                    let {checked} = (evt.target as HTMLInputElement);\r\n                    row.$isSelected = checked;\r\n                    let {$source} = row;\r\n                    if ($source !== undefined) $source.$isSelected = checked;\r\n                    rowContext.clearErrors();\r\n                }\r\n                selectCheck = <div className=\"form-row-checkbox\">\r\n                    <input type=\"checkbox\" onClick={onClick} defaultChecked={row.$isSelected} />\r\n                </div>;\r\n            }\r\n            let isDeleted = !(row.$isDeleted===undefined || row.$isDeleted===false);\r\n            if (deletable === true) {\r\n                let icon = isDeleted? 'fa-undo' : 'fa-trash';\r\n                let onDelClick = () => {\r\n                    if (restorable === true) {\r\n                        row.$isDeleted = !isDeleted;\r\n                        let {$source} = row;\r\n\t\t\t\t\t\tif ($source !== undefined) $source.$isDeleted = !isDeleted;\r\n\t\t\t\t\t\tif (onRestored) onRestored(row);\r\n                    }\r\n                    else {\r\n                        let p = data.indexOf(row);\r\n\t\t\t\t\t\tif (p>=0) data.splice(p, 1);\r\n\t\t\t\t\t\tif (onDeleted) onDeleted(row);\r\n                    }\r\n                    rowContext.clearErrors();\r\n                }\r\n                deleteIcon = <div className=\"form-row-edit text-info\" onClick={onDelClick}>\r\n                    <i className={classNames('fa', icon, 'fa-fw')} />\r\n                </div>;\r\n            }\r\n            let editContainer = selectable===true || deletable===true?\r\n                (content:any) => <fieldset disabled={isDeleted}><div className={classNames('d-flex', {'deleted':isDeleted, 'row-selected':row.$isSelected})}>\r\n                    {selectCheck}\r\n                    <div className={selectable===true && deletable===true? \"form-row-content\":\"form-row-content-1\"}>{content}</div>\r\n                    {deleteIcon}\r\n                </div></fieldset>\r\n                :\r\n                (content:any) => content;\r\n\r\n            return <ContextContainer.Provider key={rowKey} value={rowContext}>\r\n                {sep}\r\n                {RowContainer(editContainer(<><rowContext.renderErrors />{rowContent}</>))}\r\n            </ContextContainer.Provider>;\r\n        })}\r\n    </>);\r\n});\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiImageItem } from '../../schema';\r\nimport { Image } from '../../image';\r\nimport { ImageItemEdit } from '../../edit/imageItemEdit';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\n\r\nexport class ImageWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiImageItem {return this._ui as UiImageItem};\r\n    @observable private imageSrc: string;\r\n\r\n    init() {\r\n        super.init();\r\n        this.imageSrc = this.value;\r\n    }\r\n\r\n    protected onClick = async () => {\r\n        let edit = new ImageItemEdit(undefined, this.itemSchema, this.ui, this.ui.label, this.value);\r\n        let ret = await edit.start();\r\n        if (ret !== null) {\r\n            this.setValue(ret);\r\n            this.imageSrc = ret;\r\n        }\r\n        await edit.end();\r\n    }\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let cn = [\r\n            'bg-white p-1 d-flex justify-content-center',\r\n        ];\r\n        let onClick: any;\r\n        if (!this.readOnly && !this.disabled) {\r\n            cn.push('cursor-pointer');\r\n            onClick = this.onClick;\r\n        }\r\n        return <div className={classNames(cn)} onClick={onClick}>\r\n            <Image src={this.imageSrc} className=\"w-4c h-4c\"/>\r\n        </div>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTag, IValuesViewRenderOptions } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\nabstract class TagWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiTag {return this._ui as UiTag};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n\t}\r\n\t\r\n\tabstract render():JSX.Element;\r\n}\r\n\r\nexport class TagSingleWidget extends TagWidget {\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet name = this.name;\r\n\t\tif (rowKey !== undefined) name += '-' + rowKey;\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputName: name,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderRadios(this.defaultValue, options);\r\n    }\r\n}\r\n\r\nexport class TagMultiWidget extends TagWidget {\r\n\tprivate defaultArr:number[];\r\n\tinit() {\r\n\t\tsuper.init();\r\n\t\tlet def = this.defaultValue;\r\n\t\tswitch (typeof def) {\r\n\t\t\tdefault:\r\n\t\t\t\tthis.defaultArr = [];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'string':\r\n\t\t\t\tthis.defaultArr = def.split('|').map(v => Number(v));\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.changeValue(values.join('|'), true);\r\n\t}\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputs: this.inputs,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderChecks(this.defaultValue, options);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { ArrSchema, DataType, ItemSchema } from '../../schema';\r\nimport { TypeWidget, UiCustom } from '../../schema';\r\nimport { TextWidget } from './textWidget';\r\nimport { TextAreaWidget } from './textareaWidget';\r\nimport { PasswordWidget, UrlWidget, EmailWidget } from './passwordWidget';\r\nimport { UpdownWidget } from './updownWidget';\r\nimport { NumberWidget } from './numberWidget';\r\nimport { DateWidget, DateTimeWidget, TimeWidget, MonthWidget } from './dateWidget';\r\nimport { CheckBoxWidget } from './checkBoxWidget';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { SelectWidget } from './selectWidget';\r\nimport { RadioWidget } from './radioWidget';\r\nimport { RangeWidget } from './rangeWidget';\r\nimport { IdWidget } from './idWidget';\r\nimport { ButtonWidget } from './buttonWidget';\r\nimport { ArrComponent } from './arrComponent';\r\nimport { ImageWidget } from './imageWidget';\r\nimport { TagSingleWidget, TagMultiWidget } from './tagWidget';\r\n\r\nconst widgetsFactory: {[type: string]: {widget?: TypeWidget, dataTypes?: DataType[]}} = {\r\n    id: {\r\n        dataTypes: ['id'],\r\n        widget: IdWidget,\r\n    },\r\n    text: {\r\n        dataTypes: ['integer', 'number', 'string'],\r\n        widget: TextWidget\r\n    },\r\n    textarea: {\r\n        dataTypes: ['string'],\r\n        widget: TextAreaWidget\r\n    },\r\n    password: {\r\n        dataTypes: ['string'],\r\n        widget: PasswordWidget\r\n    },\r\n    date: {\r\n        dataTypes: ['date'],\r\n        widget: DateWidget\r\n    },\r\n    datetime: {\r\n        dataTypes: ['date'],\r\n        widget: DateTimeWidget\r\n    },\r\n    time: {\r\n        dataTypes: ['date'],\r\n        widget: TimeWidget\r\n    },\r\n    month: {\r\n        dataTypes: ['date'],\r\n        widget: MonthWidget\r\n    },\r\n    select: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: SelectWidget\r\n    },\r\n    url: {\r\n        dataTypes: ['string'],\r\n        widget: UrlWidget\r\n    },\r\n    email: {\r\n        dataTypes: ['string'],\r\n        widget: EmailWidget\r\n    },\r\n    number: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: NumberWidget\r\n    },\r\n    updown: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: UpdownWidget\r\n    },\r\n    color: {\r\n\r\n    },\r\n    checkbox: {\r\n        dataTypes: ['boolean', 'integer', 'number'],\r\n        widget: CheckBoxWidget\r\n    },\r\n    image: {\r\n        dataTypes: ['string'],\r\n        widget: ImageWidget,\r\n    },\r\n    checkboxes: {\r\n\r\n    },\r\n    radio: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: RadioWidget\r\n\t},\r\n\ttagSingle: {\r\n\t\tdataTypes: ['integer'],\r\n\t\twidget: TagSingleWidget\r\n\t},\r\n\ttagMulti: {\r\n\t\tdataTypes: ['string'],\r\n\t\twidget: TagMultiWidget\r\n\t},\r\n    range: {\r\n        dataTypes: ['integer'],\r\n        widget: RangeWidget,\r\n    },\r\n    button: {\r\n        dataTypes: ['button', 'submit'],\r\n        widget: ButtonWidget,\r\n    }\r\n}\r\n\r\nexport function factory(context: Context, itemSchema: ItemSchema, children:React.ReactNode, fieldProps?: FieldProps):JSX.Element {\r\n    if (context === undefined) {\r\n        debugger;\r\n        return null;\r\n    }\r\n    if (itemSchema === undefined) return undefined;\r\n    let {name, type} = itemSchema;\r\n    switch (type) {\r\n    case 'arr':\r\n        let arrSchema = context.getItemSchema(name) as ArrSchema;\r\n        return <ArrComponent parentContext={context} arrSchema={arrSchema} children={children} />;\r\n    default:\r\n        break;\r\n    }\r\n\r\n    let typeWidget: TypeWidget;\r\n    let ui = context.getUiItem(name);\r\n    function getTypeWidget(t:DataType): TypeWidget {\r\n        switch(t) {\r\n        default: return TextWidget; \r\n        case 'id': return IdWidget;\r\n        case 'integer': return UpdownWidget;\r\n        case 'number': return NumberWidget; \r\n        case 'string': return TextWidget; \r\n        case 'date': return DateWidget; \r\n        case 'boolean': return CheckBoxWidget; \r\n        case 'button':\r\n        case 'submit': return ButtonWidget;\r\n        }\r\n    }\r\n    if (ui === undefined) { \r\n        typeWidget = getTypeWidget(type);\r\n    }\r\n    else {\r\n        let {widget:widgetType} = ui;\r\n        switch (widgetType) {\r\n        default:\r\n            if (widgetType !== undefined) {\r\n                let widgetFactory = widgetsFactory[widgetType];\r\n                typeWidget = widgetFactory.widget;\r\n            }\r\n            if (typeWidget === undefined) typeWidget = getTypeWidget(type);\r\n            break;\r\n        case 'custom':\r\n            typeWidget = (ui as UiCustom).WidgetClass;\r\n            break;\r\n        case 'group':\r\n            return <span>impletment group</span>;\r\n        }\r\n        //label = uiLabel || name;\r\n    }\r\n    \r\n\tlet {widgets} = context;\r\n\tlet widget = widgets[name];\r\n\tif (!widget) {\r\n\t\twidget = new typeWidget(context, itemSchema, fieldProps, children);\r\n\t\twidget.init();\r\n\t\twidgets[name] = widget;\r\n\t}\r\n\r\n    return <widget.container />;\r\n    /*\r\n    if (isRow === false) {\r\n        let WidgetElement = observer(() => widget.container());\r\n        return <WidgetElement />;\r\n    }\r\n    else {\r\n        let widgetElement = widget.container();\r\n        return widgetElement;\r\n    }\r\n    */\r\n}\r\n\r\n","import * as React from 'react';\r\nimport {observable, IReactionDisposer, autorun} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { Schema, ItemSchema, ArrSchema } from '../schema';\r\nimport { UiSchema, TempletType } from '../schema';\r\nimport { factory } from './widgets';\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport { ContextContainer, FormContext, Context } from './context';\r\nimport { FormRes, formRes } from '../../res';\r\nimport { resLang } from '../../res/res';\r\n\r\nexport type FormButtonClick = (name:string, context: Context) => Promise<any>;\r\nexport type InputEnter = (name:string, context: Context) => Promise<any>;\r\n\r\nexport interface FormProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    uiSchema?: UiSchema;\r\n    formData?: any;\r\n    onButtonClick?: FormButtonClick;\r\n    onEnter?: InputEnter;\r\n    fieldLabelSize?: number;            // col-sm-2 for label\r\n    requiredFlag?: boolean;             // default=true\r\n    beforeShow?: (formContext:FormContext) => void;\r\n    res?: FormRes;\r\n\r\n    Container?: (content:JSX.Element) => JSX.Element;\r\n    FieldContainer?: (label:string|JSX.Element, content:JSX.Element) => JSX.Element;\r\n    FieldClass?: string;\r\n    ButtonClass?: string;\r\n}\r\n\r\nexport class Form extends React.Component<FormProps> {\r\n    readonly schema: Schema;\r\n    readonly itemSchemas: {[name:string]: ItemSchema};\r\n    readonly uiSchema: UiSchema;\r\n    readonly res?: FormRes;\r\n    protected formContext: FormContext;\r\n    private disposer: IReactionDisposer;\r\n    readonly data:any;\r\n\r\n    readonly Container: (content:JSX.Element) => JSX.Element;\r\n    readonly FieldContainer: (label:any, content:JSX.Element) => JSX.Element;\r\n    readonly FieldClass: string;\r\n    readonly ButtonClass: string;\r\n    \r\n    constructor(props:FormProps) {\r\n        super(props);\r\n        let {schema, uiSchema, \r\n            Container, FieldContainer, FieldClass, \r\n            ButtonClass, res,\r\n        } = props;\r\n        this.Container = Container || this.DefaultContainer;\r\n        this.FieldContainer = FieldContainer || this.DefaultFieldContainer;\r\n        this.FieldClass = FieldClass!==undefined && FieldClass!==''&&FieldClass!==null? FieldClass : this.DefaultFieldClass;\r\n        this.res = res || this.DefaultRes;\r\n        this.ButtonClass = ButtonClass || this.DefaultButtonClass;\r\n\r\n        this.schema = schema;\r\n        this.itemSchemas = {};\r\n        for (let itemSchema of this.schema) {\r\n            this.itemSchemas[itemSchema.name] = itemSchema;\r\n        }\r\n        this.uiSchema = uiSchema;\r\n\r\n        this.disposer = autorun(this.watch);\r\n        this.data = {};\r\n    }\r\n\r\n    private renderContent():any {\r\n        this.initData(this.props.formData);\r\n        let {children} = this.props;\r\n        if (children !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return <>{children}</>;\r\n        }\r\n\r\n        let Templet: TempletType;\r\n        if (this.uiSchema !== undefined) {\r\n            Templet = this.uiSchema.Templet;\r\n        }\r\n        if (Templet !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return typeof(Templet) === 'function'? Templet(this.data) : Templet;\r\n        }\r\n\r\n\t\tif (!this.formContext) {\r\n\t\t\tthis.formContext = new FormContext(this, false);\r\n\t\t}\r\n        return <>{this.schema.map((v, index) => {\r\n            return <React.Fragment key={index}>{factory(this.formContext, v, children)}</React.Fragment>\r\n        })}</>;\r\n    }\r\n\r\n    private initData(formData: any) {\r\n        if (formData === undefined) formData = {};\r\n        if (this.uiSchema !== undefined) {\r\n            let {items} = this.uiSchema;\r\n            if (items !== undefined) {\r\n                for (let i in items) {\r\n                    let ui = items[i];\r\n                    let dv = ui.defaultValue;\r\n                    if (dv !== undefined) {\r\n                        if (formData[i] === undefined) {\r\n                            formData[i] = dv;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (let itemSchema of this.schema) {\r\n            this.initDataItem(itemSchema, this.data, formData);\r\n        }\r\n    }\r\n\r\n    private initDataItem(itemSchema: ItemSchema, data:any, formData: any):any {\r\n        let {name, type} = itemSchema;\r\n        if (type === 'button') return;\r\n        if (type !== 'arr') {\r\n            data[name] = formData[name];\r\n            return;\r\n        }\r\n\r\n        let arrItem:ArrSchema = itemSchema as ArrSchema;\r\n        let {arr:arrItems} = arrItem;\r\n        if (arrItems === undefined) return;\r\n        let arrDict:any = arrItem.itemSchemas = {};\r\n        for (let item of arrItems) {\r\n            arrDict[item.name] = item;\r\n        }\r\n        let val:any[] = formData[name];\r\n        if (val === undefined) val = [];\r\n        else if (Array.isArray(val) === false) val = [val];\r\n        let arr:any[] = [];\r\n        for (let row of val) {\r\n            let {$isSelected, $isDeleted} = row;\r\n            let r = {\r\n                $source: row,\r\n                $isSelected: $isSelected,\r\n                $isDeleted: $isDeleted,\r\n            };\r\n            for (let item of arrItems) {\r\n                this.initDataItem(item, r, row);\r\n            }\r\n            arr.push(r);\r\n        }\r\n        // 如果没有observable，行删除标志点击不管用\r\n        // 不知道这里为什么要去掉observable。有可能会有别的问题\r\n        data[name] = observable(arr);\r\n        //data[name] = arr;\r\n        return;\r\n    }\r\n\r\n    private watch = () => {\r\n        let {formData} = this.props;\r\n        if (formData === undefined) return;\r\n        //this.initData(formData);\r\n        this.calcSelectOrDelete();\r\n    }\r\n    private calcSelectOrDelete() {\r\n        for (let itemSchema of this.schema) {\r\n            this.arrItemOperated(itemSchema);\r\n        }\r\n    }\r\n\r\n    private arrItemOperated(itemSchema: ItemSchema) {\r\n        let {name, type} = itemSchema;\r\n        if (type !== 'arr') return;\r\n        if (this.data === undefined) return;\r\n        let formArrVal = this.data[name];\r\n        if (formArrVal === undefined) return;\r\n        let {arr: arrItems} = itemSchema as ArrSchema;\r\n        for (let row of formArrVal) {\r\n            let {$source} = row;\r\n            if ($source === undefined) continue;\r\n            let {$isSelected, $isDeleted} = $source;\r\n            row.$isSelected = $isSelected;\r\n            row.$isDeleted = $isDeleted;\r\n            //console.log($isSelected, $isDeleted);\r\n            for (let item of arrItems) {\r\n                this.arrItemOperated(item);\r\n            }\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        let {beforeShow} = this.props;\r\n        if (beforeShow !== undefined) beforeShow(this.formContext);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        if (this.disposer !== undefined) this.disposer();\r\n    }\r\n\r\n    render() {\r\n        let content = this.renderContent();\r\n        return <ContextContainer.Provider value={this.formContext}>\r\n            {React.createElement(this.formContext.renderErrors)}\r\n            {this.Container(content)}\r\n        </ContextContainer.Provider>;\r\n    }\r\n\r\n    async buttonClick(buttonName:string) {\r\n        this.formContext.checkRules()\r\n        if (this.formContext.hasError === true) return;\r\n\r\n        let {onButtonClick} = this.formContext.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this.formContext);\r\n        if (ret === undefined) return;\r\n        this.formContext.setError(buttonName, ret);\r\n    }\r\n\r\n    protected DefaultContainer = (content:JSX.Element): JSX.Element => {\r\n        return <form className={classNames(this.props.className)} onSubmit={e=>e.preventDefault()}>\r\n            {content}\r\n        </form>;\r\n    }\r\n    protected DefaultFieldContainer = (label:string|JSX.Element, content:JSX.Element): JSX.Element => {\r\n        let {fieldLabelSize} = this.props;\r\n\r\n        if (fieldLabelSize > 0) {\r\n            let labelView:any;\r\n            if (label === null) {\r\n                fieldLabelSize = 0;\r\n            }\r\n            else {\r\n                labelView = <label className={classNames('col-sm-' + fieldLabelSize, 'col-form-label')}>{label}</label>\r\n            }\r\n            let fieldCol = 'col-sm-' + (12 - fieldLabelSize);\r\n            return <div className=\"form-group row\">\r\n                {labelView}\r\n                <div className={fieldCol}>{content}</div>\r\n            </div>;\r\n        }\r\n        return <div className=\"form-group\">\r\n            {label===null? null:<label className=\"col-form-label\">{label}</label>}\r\n            {content}\r\n        </div>;\r\n    }\r\n    protected DefaultFieldClass:string = undefined;\r\n    protected DefaultButtonClass = 'text-center py-2';\r\n    protected DefaultRes:FormRes = resLang<FormRes>(formRes);\r\n\r\n    ArrContainer = (label:any, content:JSX.Element): JSX.Element => {\r\n        return <div>\r\n            <div className={classNames('small text-muted text-center bg-light py-1 px-3 mt-4 mb-1')}>{label}</div>\r\n            {content}\r\n        </div>;\r\n    }\r\n    RowContainer = (content:JSX.Element): JSX.Element => {\r\n        let cn = classNames({\r\n            'py-3': true\r\n        });\r\n        return <div className={cn}>{content}</div>\r\n    }\r\n    RowSeperator = <div className=\"border border-gray border-top\" />;\r\n}\r\n","import * as React from 'react';\r\nimport { factory } from './widgets';\r\nimport { ContextContainer, Context } from './context';\r\n\r\nexport interface FieldProps {\r\n    name: string;\r\n}\r\n\r\nexport class FormField extends React.Component<FieldProps> {\r\n    static contextType = ContextContainer;\r\n    render() {\r\n        let {name, children } = this.props;\r\n        let context:Context = this.context;\r\n        if (context === undefined) return <span className=\"text-danger\">!only in Form!</span>;\r\n        let itemSchema = context.getItemSchema(name);\r\n        let content = factory(context, itemSchema, children, this.props);\r\n        if (content === undefined) {\r\n            return <span className=\"text-danger\">!!{name} is not defined!!</span>;\r\n        }\r\n        return content;\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { nav } from '../components';\r\nimport { VPage } from '../vm';\r\nimport { CLogin } from './CLogin';\r\n\r\nexport class VLogout extends VPage<CLogin> {\r\n\tprivate onLogout: ()=>void;\r\n\r\n\tinit(param: any) {\r\n\t\tthis.onLogout = param;\r\n\t}\r\n\theader() {return this.isWebNav === true? false : '安全退出';}\r\n\tfooter() {\r\n\t\treturn <div className=\"mt-5 text-center justify-content-center\">\r\n\t\t\t<button className=\"btn btn-outline-warning\" onClick={nav.resetAll}>升级软件</button>\r\n\t\t</div>;\r\n\t}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\r\n\tcontent() {\r\n\t\treturn <div className=\"m-5 border border-info bg-white rounded-3 p-5 text-center\">\r\n\t\t\t<div>退出当前账号不会删除任何历史数据，下次登录依然可以使用本账号</div>\r\n\t\t\t<div className=\"mt-5 text-center\">\r\n\t\t\t\t<button className=\"btn btn-danger\" onClick={this.onLogout}>安全退出</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","export default __webpack_public_path__ + \"static/media/logo.2d27ead7.svg\";","import * as React from 'react';\r\nimport { nav } from '../components';\r\nimport { mobileRegex, emailRegex } from '../tool';\r\nimport logo from '../img/logo.svg';\r\n\r\nexport function tonvaTop() {\r\n    return nav.loginTop(<div className=\"d-flex align-items-center position-relative\">\r\n        <img className=\"App-logo h-3c position-absolute\" src={logo} alt=\"img\" />\r\n        <div className=\"h3 flex-fill text-center\"><span className=\"text-primary me-3\">同</span>\r\n            <span className=\"text-danger\">花</span>\r\n        </div>\r\n    </div>);\r\n}\r\n\r\ninterface Sender {\r\n    type: string;\r\n    caption: string;\r\n    regex: RegExp;\r\n}\r\n\r\nconst senders: Sender[] = [\r\n    { type: 'mobile', caption: '手机号', regex: mobileRegex },\r\n    { type: 'email', caption: '邮箱', regex: emailRegex }\r\n];\r\n\r\nexport function getSender(un: string): Sender {\r\n    let sender = senders.find(v => v.regex.test(un) === true);\r\n    return sender;\r\n}","import { nav, Form, Schema, UiSchema, UiTextItem, UiPasswordItem, Context, UiButton, StringSchema, Ax } from '../components';\r\nimport { tonvaTop, getSender } from './tools';\r\nimport { CLogin } from './CLogin';\r\nimport { VPage } from '../vm';\r\n\r\nconst schema: Schema = [\r\n    { name: 'username', type: 'string', required: true, maxLength: 100 } as StringSchema,\r\n    { name: 'password', type: 'string', required: true, maxLength: 100 } as StringSchema,\r\n    { name: 'login', type: 'submit' },\r\n];\r\n\r\nexport class VLogin extends VPage<CLogin> {\r\n    private onLogin: (un: string, pwd: string) => Promise<boolean>;\r\n    private withBack: boolean;\r\n\r\n    init({ onLogin, withBack }: { onLogin: (un: string, pwd: string) => Promise<boolean>; withBack: boolean; }) {\r\n        this.onLogin = onLogin;\r\n        this.withBack = withBack;\r\n    }\r\n\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            username: { placeholder: '手机/邮箱/用户名', label: '登录账号' } as UiTextItem,\r\n            password: { widget: 'password', placeholder: '密码', label: '密码' } as UiPasswordItem,\r\n            login: { widget: 'button', className: 'btn btn-primary btn-block mt-3', label: '登录' } as UiButton,\r\n        }\r\n    }\r\n\r\n    private onSubmit = async (name: string, context: Context): Promise<string> => {\r\n        let values = context.form.data;\r\n        let un = values['username'];\r\n        let pwd = values['password'];\r\n        if (pwd === undefined) {\r\n            return 'something wrong, pwd is undefined';\r\n        }\r\n        let ret = await this.onLogin(un, pwd);\r\n        if (ret === true) return;\r\n\r\n        let sender = getSender(un);\r\n        let type: string = sender !== undefined ? sender.caption : '用户名';\r\n        return type + '或密码错！';\r\n    }\r\n    private onEnter = async (name: string, context: Context): Promise<string> => {\r\n        if (name === 'password') {\r\n            return await this.onSubmit('login', context);\r\n        }\r\n    }\r\n\r\n    header() {\r\n        if (this.withBack === true) {\r\n            return '登录';\r\n        }\r\n        return false;\r\n    }\r\n\r\n    footer() {\r\n        return <div className=\"d-block\">\r\n            <div className='text-center'>\r\n                <Ax href=\"/register\" className=\"btn btn-link\" style={{ margin: '0px auto' }}>\r\n                    注册账号\r\n                </Ax>\r\n            </div>\r\n            {nav.privacyEntry()}\r\n        </div>;\r\n    }\r\n\r\n    content() {\r\n        return <div className=\"d-flex p-5 flex-column justify-content-center align-items-center\">\r\n            <div className=\"flex-fill\" />\r\n            <div className=\"w-20c\">\r\n                {tonvaTop()}\r\n                <div className=\"h-2c\" />\r\n                <Form schema={schema} uiSchema={this.uiSchema}\r\n                    onButtonClick={this.onSubmit}\r\n                    onEnter={this.onEnter}\r\n                    requiredFlag={false} />\r\n                {/*onClick={() => this.clickForget()}*/}\r\n                <Ax className=\"btn btn-link btn-block\" href=\"/forget\">\r\n                    忘记密码\r\n                </Ax>\r\n            </div>\r\n            <div className=\"flex-fill\" />\r\n            <div className=\"flex-fill\" />\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage } from '../vm';\r\nimport { Page, Form, ItemSchema, UiSchema, StringSchema, UiPasswordItem, Context, ButtonSchema, UiButton, nav } from '../components';\r\n//import { CenterAppApi } from '../net';\r\nimport { CLogin } from './CLogin';\r\n\r\nexport class VChangePassword extends VPage<CLogin> {\r\n    private schema: ItemSchema[] = [\r\n        {name:'orgPassword', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'newPassword', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'newPassword1', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'submit', type: 'submit'} as ButtonSchema\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            orgPassword: {\r\n                widget: 'password',\r\n                label: '原密码',\r\n                placeholder: '输入原来的密码'\r\n            } as UiPasswordItem,\r\n            newPassword: {\r\n                widget: 'password',\r\n                label: '新密码',\r\n                placeholder: '输入新设的密码'\r\n            } as UiPasswordItem,\r\n            newPassword1: {\r\n                widget: 'password',\r\n                label: '确认密码', \r\n                placeholder: '再次输入新设密码'\r\n            } as UiPasswordItem,\r\n            submit: {\r\n                widget: 'button',\r\n                label: '提交',\r\n                className: 'btn btn-primary'\r\n            } as UiButton,\r\n        }\r\n\t};\r\n\t\r\n\tprivate onChange: (orgPassword:string, newPassword:string) => Promise<boolean>\r\n\tinit(onChange: (orgPassword:string, newPassword:string) => Promise<boolean>) {\r\n\t\tthis.onChange = onChange;\r\n\t}\r\n\r\n    private onSubmit = async (name:string, context: Context):Promise<any> => {\r\n        let {orgPassword, newPassword, newPassword1} = context.data;\r\n        if (newPassword !== newPassword1) {\r\n            context.setError('newPassword1', '新密码错误，请重新输入');\r\n            return;\r\n        }\r\n        //let centerAppApi = new CenterAppApi('tv/', undefined);\r\n\t\t//let ret = await centerAppApi.changePassword({orgPassword, newPassword});\r\n\t\tlet ret = await this.onChange(orgPassword, newPassword);\r\n        if (ret === false) {\r\n            context.setError('orgPassword', '原密码错误');\r\n            return;\r\n        }\r\n        nav.replace(<Page header=\"修改密码\" back=\"close\">\r\n            <div className=\"m-3  text-success\">\r\n                密码修改成功！\r\n            </div>\r\n        </Page>);\r\n        return;\r\n    }\r\n\r\n\theader() {return '修改密码'}\r\n\r\n    content() {\r\n        return <Form\r\n\t\t\tclassName=\"m-3\" \r\n\t\t\tschema={this.schema}\r\n\t\t\tuiSchema={this.uiSchema}\r\n\t\t\tonButtonClick={this.onSubmit}\r\n\t\t\tfieldLabelSize={2} />\r\n    }\r\n}\r\n","import { VPage } from \"../../vm\";\r\nimport { tonvaTop, getSender } from '../tools';\r\nimport { nav, Schema, UiSchema, UiTextItem, UiButton, Form, Context, StringSchema, Ax } from '../../components';\r\nimport { CForget, CRegBase, CRegister } from './CRegister';\r\n\r\nexport abstract class VStart<T extends CRegBase> extends VPage<T> {\r\n    private schema: Schema = [\r\n        { name: 'user', type: 'string', required: true, maxLength: 100 } as StringSchema,\r\n        { name: 'verify', type: 'submit' },\r\n    ]\r\n    private uiSchema: UiSchema;\r\n\r\n    abstract get accountLable(): string;\r\n    abstract get pageCaption(): string;\r\n\r\n    init() {\r\n        this.uiSchema = {\r\n            items: {\r\n                user: {\r\n                    widget: 'text',\r\n                    label: this.accountLable,\r\n                    placeholder: '手机号或邮箱',\r\n                } as UiTextItem,\r\n                verify: { widget: 'button', className: 'btn btn-primary btn-block mt-3', label: '发送验证码' } as UiButton,\r\n            }\r\n        }\r\n    }\r\n\r\n    header() { return this.pageCaption; }\r\n    footer() {\r\n        return <div className=\"text-center\">\r\n            <Ax href=\"/login\" className=\"text-primary\">已有账号，直接登录</Ax>\r\n        </div>;\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        return <div className=\"w-max-20c my-5 py-5\"\r\n            style={{ marginLeft: 'auto', marginRight: 'auto' }}>\r\n            {tonvaTop()}\r\n            <div className=\"h-3c\" />\r\n            <Form schema={this.schema} uiSchema={this.uiSchema}\r\n                onButtonClick={this.onSubmit}\r\n                onEnter={this.onEnter}\r\n                requiredFlag={false} />\r\n            {nav.privacyEntry()}\r\n        </div>;\r\n    }\r\n\r\n    private onSubmit = async (name: string, context: Context): Promise<string> => {\r\n        context.clearContextErrors();\r\n        let user = 'user';\r\n        let value = context.getValue(user);\r\n        let sender = getSender(value);\r\n        if (sender === undefined) {\r\n            context.setError(user, '必须是手机号或邮箱');\r\n            return;\r\n        }\r\n        let type: 'mobile' | 'email' = sender.type as 'mobile' | 'email';\r\n        if (type === 'mobile') {\r\n            if (value.length !== 11 || value[0] !== '1') {\r\n                context.setError(user, '请输入正确的手机号');\r\n                return;\r\n            }\r\n        }\r\n        this.controller.account = value;\r\n        this.controller.type = type;\r\n        let ret = await this.controller.checkAccount();\r\n        if (ret !== undefined) context.setError(user, ret);\r\n    }\r\n\r\n    private onEnter = async (name: string, context: Context): Promise<string> => {\r\n        if (name === 'user') {\r\n            return await this.onSubmit('verify', context);\r\n        }\r\n    }\r\n}\r\n\r\nexport class VRegisterStart extends VStart<CRegister> {\r\n    get accountLable(): string { return '账号' }\r\n    get pageCaption(): string { return '注册账号' }\r\n}\r\n\r\nexport class VForgetStart extends VStart<CForget> {\r\n    footer(): JSX.Element { return null; }\r\n    get accountLable(): string { return '账号' }\r\n    get pageCaption(): string { return '密码找回' }\r\n}\r\n","import React from 'react';\r\nimport { VPage } from \"../../vm\";\r\nimport { CRegBase } from \"./CRegister\";\r\nimport {Schema, UiSchema, UiTextItem, UiButton, Form, Context, NumSchema} from '../../components';\r\n\r\nexport class VVerify extends VPage<CRegBase> {\r\n    private schema: Schema = [\r\n        {name: 'verify', type: 'number', required: true, maxLength: 6} as NumSchema,\r\n        {name: 'submit', type: 'submit'},\r\n    ]\r\n\r\n    private onVerifyChanged = (context:Context, value:any, prev:any) => {\r\n        context.setDisabled('submit', !value || (value.length !== 6));\r\n    }\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            verify: {\r\n                widget: 'text',\r\n                label: '验证码',\r\n                placeholder: '请输入验证码',\r\n                onChanged: this.onVerifyChanged,\r\n            } as UiTextItem, \r\n            submit: {\r\n                widget: 'button', \r\n                className: 'btn btn-primary btn-block mt-3', \r\n                label: '下一步 >',\r\n                disabled: true\r\n            } as UiButton,\r\n        }\r\n\t}\r\n\t\r\n\tprivate onVerify: (verify:string) => Promise<number>;\r\n\tinit(onVerify: (verify:string) => Promise<number>) {\r\n\t\tthis.onVerify = onVerify;\r\n\t}\r\n\r\n\tprivate onSubmit = async (name:string, context:Context):Promise<string> => {\r\n        let verify = context.getValue('verify');\r\n        let ret = await this.onVerify(verify);\r\n        if (ret === 0) {\r\n            context.setError('verify', '验证码错误');\r\n            return;\r\n        }\r\n    }\r\n\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'verify') {\r\n            return await this.onSubmit('submit', context);\r\n        }\r\n    }\r\n\r\n\theader() {return '验证码'}\r\n\r\n\tcontent() {\r\n        let typeText:string, extra:any;\r\n        switch (this.controller.type) {\r\n            case 'mobile': typeText = '手机号'; break;\r\n            case 'email': \r\n                typeText = '邮箱'; \r\n                extra = <><span className=\"text-danger\">注意</span>: 有可能误为垃圾邮件，请检查<br/></>;\r\n                break;\r\n        }\r\n        return <div className=\"w-max-20c my-5 py-5\"\r\n\t\t\tstyle={{marginLeft:'auto', marginRight:'auto'}}>\r\n\t\t\t验证码已经发送到{typeText}<br/>\r\n\t\t\t<div className=\"py-2 px-3 my-2 text-primary bg-light\"><b>{this.controller.account}</b></div>\r\n\t\t\t{extra}\r\n\t\t\t<div className=\"h-1c\" />\r\n\t\t\t<Form schema={this.schema} uiSchema={this.uiSchema} \r\n\t\t\t\tonButtonClick={this.onSubmit} \r\n\t\t\t\tonEnter={this.onEnter}\r\n\t\t\t\trequiredFlag={false} />\r\n\t\t</div>;\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { VPage } from \"../../vm\";\r\nimport {nav, Page, Schema, UiSchema, UiPasswordItem, UiButton, Form, Context, StringSchema} from '../../components';\r\nimport { CForget, CRegBase, CRegister } from './CRegister';\r\n\r\nexport abstract class VPassword<T extends CRegBase> extends VPage<T> {\r\n\tprotected abstract get pageCaption():string;\r\n\tprotected abstract get submitCaption():string;\r\n\r\n\tget account():string {return this.controller.account}\r\n\r\n    private schema: Schema = [\r\n        {name: 'pwd', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n        {name: 'rePwd', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n        {name: 'submit', type: 'submit'},\r\n    ]\r\n\r\n\tprivate onButtonSubmit = async (name:string, context:Context):Promise<string> => {\r\n        let values = context.form.data;\r\n        let {pwd, rePwd} = values;\r\n        let error:string;\r\n        if (!pwd || pwd !== rePwd) {\r\n            context.setValue('pwd', '');\r\n            context.setValue('rePwd', '');\r\n            error = '密码错误，请重新输入密码！';\r\n            context.setError('pwd', error);\r\n        }\r\n        else {\r\n\t\t\terror = await this.controller.onPasswordSubmit(pwd);\r\n            if (error !== undefined) {\r\n                nav.push(<Page header=\"注册不成功\"><div className=\"p-5 text-danger\">{error}</div></Page>);\r\n            }\r\n        }\r\n        return error;\r\n    }\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'rePwd') {\r\n            return await this.onButtonSubmit('submit', context);\r\n        }\r\n    }\r\n\t\r\n\theader() {\r\n\t\treturn this.pageCaption;\r\n\t}\r\n\r\n\tcontent() {\r\n\t\tlet uiSchema: UiSchema = {\r\n\t\t\titems: {\r\n\t\t\t\tpwd: {widget: 'password', placeholder: '密码', label: '密码'} as UiPasswordItem,\r\n\t\t\t\trePwd: {widget: 'password', placeholder: '重复密码', label: '重复密码'} as UiPasswordItem,\r\n\t\t\t\tsubmit: {widget: 'button', className: 'btn btn-primary btn-block mt-3', label: this.submitCaption} as UiButton,\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <div className=\"w-max-20c my-5 py-5\"\r\n\t\t\tstyle={{marginLeft:'auto', marginRight:'auto'}}>\r\n\t\t\t注册账号<br/>\r\n\t\t\t<div className=\"py-2 px-3 my-2 text-primary bg-light\"><b>{this.account}</b></div>\r\n\t\t\t<div className=\"h-1c\" />\r\n\t\t\t<Form schema={this.schema} uiSchema={uiSchema}\r\n\t\t\t\tonButtonClick={this.onButtonSubmit}\r\n\t\t\t\tonEnter={this.onEnter}\r\n\t\t\t\trequiredFlag={false} />\r\n\t\t</div>;\r\n    }\r\n}\r\n\r\nexport class VRegisterPassword extends VPassword<CRegister> {\r\n\tget pageCaption():string {return '注册账号'}\r\n\tget submitCaption():string {return '注册新账号'}\r\n}\r\n\r\nexport class VForgetPassword extends VPassword<CForget> {\r\n\tget pageCaption():string {return '账号密码'}\r\n\tget submitCaption():string {return '改密码'}\r\n}\r\n","import React from 'react';\r\nimport { VPage } from \"../../vm\";\r\nimport { CRegBase } from './CRegister';\r\n\r\nexport abstract class VSuccess extends VPage<CRegBase> {\r\n\theader() {return false;}\r\n}\r\n\r\nexport class VRegisterSuccess extends VSuccess {\r\n\tcontent() {\r\n    \tconst {account, login} = this.controller;\r\n\t\treturn <div className=\"container w-max-30c\">\r\n\t\t\t<div className=\"my-5\">\r\n\t\t\t\t<div className=\"py-5 text-center\">\r\n\t\t\t\t\t账号 <strong className=\"text-primary\">{account} </strong> 注册成功！\r\n\t\t\t\t</div>\r\n\t\t\t\t<button className=\"btn btn-success btn-block\" type=\"button\" onClick={()=>login(undefined)}>\r\n\t\t\t\t\t直接登录\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nexport class VForgetSuccess extends VSuccess {\r\n\tcontent() {\r\n    \tconst {login} = this.controller;\r\n\t\treturn <div className=\"container w-max-30c\">\r\n\t\t\t<div className=\"my-5\">\r\n\t\t\t\t<div className=\"py-5 text-center text-success\">成功修改密码</div>\r\n\t\t\t\t<button className=\"btn btn-primary btn-block\" onClick={()=>login()}>\r\n\t\t\t\t\t登录账号\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t}\t\r\n}\r\n","import { Controller, VPage } from \"../../vm\";\r\nimport { nav } from '../../components';\r\nimport { VRegisterStart, VForgetStart } from './VStart';\r\nimport { userApi, RegisterParameter } from '../../net';\r\nimport { VVerify } from './VVerify';\r\nimport { VRegisterPassword, VForgetPassword } from './VPassword';\r\nimport { VForgetSuccess, VRegisterSuccess } from \"./VSuccess\";\r\n\r\nexport abstract class CRegBase extends Controller {\r\n    account: string;\r\n    type:'mobile'|'email';\r\n    password: string;\r\n    verify: string;\r\n\r\n\tprotected abstract get VStart(): new(c:Controller) => VPage<any>;\r\n    protected async internalStart() {\r\n        this.openVPage(this.VStart);\r\n    }\r\n\r\n\tprotected get VVerify(): new(c:Controller) => VPage<any> {return VVerify as any};\r\n    toVerify() {\r\n        //this.account = account;\r\n        this.openVPage(this.VVerify, async (verify: string) => {\r\n\t\t\tthis.verify = verify;\r\n\t\t\tlet ret = await userApi.checkVerify(this.account, verify);\r\n\t\t\tif (ret === 0) return ret;\r\n\t\t\tthis.toPassword();\r\n\t\t});\r\n    }\r\n\r\n\tprotected abstract get VPassword(): new(c:Controller) => VPage<any>;\r\n    toPassword() {\r\n        this.openVPage(this.VPassword);\r\n    }\r\n\r\n\tprotected abstract get VSuccess(): new(c:Controller) => VPage<any>;\r\n    toSuccess() {\r\n        this.openVPage(this.VSuccess);\r\n\t}\r\n\r\n    login = async (account?:string) => {\r\n        let retUser = await userApi.login({user: account || this.account, pwd: this.password, guest: nav.guest});\r\n        if (retUser === undefined) {\r\n            alert('something wrong!');\r\n            return;\r\n        }\r\n\t\tawait nav.userLogined(retUser);\r\n\t\t//await nav.start();\r\n\t\tif (this.isWebNav) nav.navigate('/');\r\n    }\r\n\r\n    async checkAccount():Promise<string> {\r\n        let ret = await userApi.isExists(this.account);\r\n        let error = this.accountError(ret);\r\n        if (error !== undefined) return error;\r\n        ret = await userApi.sendVerify(this.account, this.type, nav.oem);\r\n        this.toVerify();\r\n        return;\r\n    }\r\n\r\n    protected abstract accountError(isExists: number):string;\r\n\tabstract onPasswordSubmit(pwd:string):Promise<string>;\r\n}\r\n\r\nexport class CRegister extends CRegBase {\r\n\tprotected get VStart(): new(c:Controller) => VPage<any> {return VRegisterStart as any};\r\n\tprotected get VPassword(): new(c:Controller) => VPage<any> {return VRegisterPassword as any};\r\n\tprotected get VSuccess(): new(c:Controller) => VPage<any> {return VRegisterSuccess as any}\r\n    protected accountError(isExists: number) {\r\n        if (isExists > 0) return '已经被注册使用了';\r\n    }\r\n\r\n    async onPasswordSubmit(pwd:string):Promise<string> {\r\n\t\tthis.password = pwd;\r\n        let params: RegisterParameter = {\r\n            nick: undefined,\r\n            user: this.account, \r\n            pwd,\r\n            country: undefined,\r\n            mobile: undefined,\r\n            mobileCountry: undefined,\r\n            email: undefined,\r\n            verify: this.verify\r\n        }\r\n        switch (this.type) {\r\n            case 'mobile':\r\n                params.mobile = Number(this.account);\r\n                params.mobileCountry=86;\r\n                break;\r\n            case 'email':\r\n                params.email = this.account;\r\n                break;\r\n        }\r\n        let ret = await userApi.register(params);\r\n        if (ret === 0) {\r\n            nav.clear();\r\n            this.toSuccess();\r\n            return;\r\n        }\r\n        let error = this.regReturn(ret)\r\n        return error;\r\n\t}\r\n\t\r\n    private regReturn(registerReturn:number):string {\r\n        let msg:any;\r\n        switch (registerReturn) {\r\n            default: return '服务器发生错误';\r\n            case 4: return '验证码错误';\r\n            case 0: return;\r\n            case 1: msg = '用户名 ' + this.account; break;\r\n            case 2: msg = '手机号 +' + this.account; break;\r\n            case 3: msg = '邮箱 ' + this.account; break;\r\n        }\r\n        return msg + ' 已经被注册过了';\r\n    }\r\n}\r\n\r\nexport class CForget extends CRegBase {\r\n\tprotected get VStart(): new(c:Controller) => VPage<any> {return VForgetStart as any};\r\n\tprotected get VPassword(): new(c:Controller) => VPage<any> {return VForgetPassword as any};\r\n\tprotected get VSuccess(): new(c:Controller) => VPage<any> {return VForgetSuccess as any}\r\n\tprotected accountError(isExists: number) {\r\n        if (isExists === 0) return '请输入正确的账号';\r\n    }\r\n    async onPasswordSubmit(pwd:string):Promise<string> {\r\n\t\tthis.password = pwd;\r\n\t\tlet ret = await userApi.resetPassword(this.account, this.password, this.verify, this.type);\r\n\t\tif (ret.length === 0) {\r\n\t\t\tlet err = 'something wrong in reseting password';\r\n\t\t\tconsole.log(err);\r\n\t\t\tthrow err;\r\n\t\t}\r\n        nav.clear();\r\n        this.toSuccess();\r\n        return;\r\n    }\r\n}\r\n","import { User } from '../tool';\r\nimport { nav, Login } from '../components';\r\nimport { Controller, VPage } from \"../vm\";\r\nimport { VLogout } from './VLogout';\r\n//import { Login as LoginPage } from './login';\r\nimport { VLogin } from './VLogin';\r\nimport { CenterAppApi, userApi } from '../net';\r\nimport { VChangePassword } from './VChangePassword';\r\nimport { CRegister } from './register';\r\nimport { CForget } from './register';\r\n\r\nexport class CLogin extends Controller implements Login {\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\tasync showLogin(callback?: (user: User) => Promise<void>, withBack?: boolean): Promise<void> {\r\n\t\tlet onLogin = async (un: string, pwd: string): Promise<boolean> => {\r\n\t\t\tlet user = await userApi.login({\r\n\t\t\t\tuser: un,\r\n\t\t\t\tpwd: pwd,\r\n\t\t\t\tguest: nav.guest,\r\n\t\t\t});\r\n\r\n\t\t\tif (user === undefined) return false;\r\n\t\t\tconsole.log(\"onLoginSubmit: user=%s pwd:%s\", user.name, user.token);\r\n\t\t\tawait nav.userLogined(user, callback);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tthis.openVPage(VLogin, { onLogin, withBack });\r\n\t}\r\n\r\n\tasync showLogout(callback?: () => Promise<void>) {\r\n\t\tthis.openVPage(VLogout, () => {\r\n\t\t\tnav.logout(callback);\r\n\t\t});\r\n\t}\r\n\r\n\tasync showRegister() {\r\n\t\tlet cRegister = new CRegister(this.res);\r\n\t\tawait cRegister.start();\r\n\t}\r\n\r\n\tasync showForget() {\r\n\t\tlet cForget = new CForget(this.res);\r\n\t\tawait cForget.start();\r\n\t}\r\n\r\n\tprotected getVChangePassword(): new (cLogin: CLogin) => VPage<CLogin> {\r\n\t\treturn VChangePassword;\r\n\t}\r\n\tasync showChangePassword() {\r\n\t\tlet vPage = this.getVChangePassword();\r\n\t\tthis.openVPage(vPage, async (orgPassword: string, newPassword: string): Promise<boolean> => {\r\n\t\t\tlet centerAppApi = new CenterAppApi('tv/', undefined);\r\n\t\t\tlet ret = await centerAppApi.changePassword({ orgPassword, newPassword });\r\n\t\t\treturn ret;\r\n\t\t});\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport interface InputOptions {\r\n    type: string;\r\n    min?: number;\r\n    max?: number;\r\n    step?: number;\r\n}\r\n\r\nexport class StringItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem { return this._uiItem as UiTextItem }\r\n    protected async internalStart(): Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, { resolve, reject });\r\n            nav.push(element, reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    protected inputOptions(): InputOptions {\r\n        return {\r\n            type: 'text',\r\n        }\r\n    }\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let onSave = () => {\r\n            this.verifyValue();\r\n            if (this.error === undefined) {\r\n                let val = this.newValue;\r\n                resolve(val);\r\n            }\r\n        }\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n        let onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n            if (evt.keyCode === 13) onSave();\r\n        }\r\n        let { type, max, min, step } = this.inputOptions();\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <input type={type}\r\n                    onChange={this.onChange}\r\n                    onKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\"\r\n                    defaultValue={this.value} min={min} max={max} step={step} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiRadio } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class RadioItemEdit extends ItemEdit {\r\n    get uiItem(): UiRadio {return this._uiItem as UiRadio}\r\n\r\n\tinit() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\r\n        }\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value: any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let {name} = this.itemSchema;\r\n        let {list} = this.uiItem;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (this.error === undefined) resolve(this.newValue);\r\n            }}>保存</button>;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input name={name} type=\"radio\" value={value} \r\n                        onClick={()=>this.onChange(value)} \r\n                        defaultChecked={value === this.value} /> {title || value} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"m-3\">\r\n\t\t\t\t<div className=\"row row-cols-2 row-cols-sm-3 row-cols-md-4\">{content}</div>\r\n\t\t\t</div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiSelect } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class SelectItemEdit extends ItemEdit {\r\n    get uiItem(): UiSelect {return this._uiItem as UiSelect}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiIdItem } from '../schema';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class IdItemEdit extends ItemEdit {\r\n    get uiItem(): UiIdItem {return this._uiItem as UiIdItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            //let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            //nav.push(element,reject);\r\n\r\n            let {pickId} = this.uiItem;\r\n            if (pickId === undefined) {\r\n                alert('IdItemEdit.pickId = undefined');\r\n                return;\r\n            }\r\n            let boxId = await pickId(undefined, undefined, this.value);\r\n            //if (typeof id === 'object') {\r\n            //    id = (id as any).id;\r\n            //}\r\n            this.onChange(boxId.id);\r\n            resolve(boxId);\r\n            //this.newValue = id;\r\n        });\r\n    }\r\n\r\n    protected async internalEnd():Promise<void> {}\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        /*\r\n        let {resolve, reject} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n        */\r\n        return <Page header={'更改' + this.label}>\r\n            ddd\r\n        </Page>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiTag } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nabstract class TagItemEdit extends ItemEdit {\r\n\tprotected inputs: {[index:number]: HTMLInputElement} = {};\r\n\tprotected inputType: 'checkbox' | 'radio';\r\n    get uiItem(): UiTag {return this._uiItem as UiTag};\r\n\r\n\tinit() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\r\n        }\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n\t}\r\n\t\r\n\trenderContent() {\r\n\t\tlet valuesView = this.uiItem.valuesView;\r\n\t\tif (valuesView === undefined) return super.renderContent();\r\n\t\treturn valuesView.render(this.value);\r\n\t}\r\n\r\n\tprotected abstract renderInputs():JSX.Element;\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (this.error === undefined) resolve(this.newValue);\r\n\t\t\t}}>保存</button>;\r\n\t\t/*\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {name:itemName, id} = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input ref={input=>this.inputs[id] = input} name={name} type={this.inputType} value={id} \r\n\t\t\t\t\t\tonClick={(e)=>this.onChange(e.currentTarget.checked, id)}\r\n                        defaultChecked={this.defaultChecked(id)} /> {itemName} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n\t\t\t<>no list defined</>;\r\n\t\t*/\r\n        return <Page header={'更改' + this.label} right={right}>\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t\t{this.renderInputs()}\r\n\t\t\t</div>\r\n        </Page>;\r\n    })\r\n}\r\n\r\nexport class TagSingleItemEdit extends TagItemEdit {\r\n\tprotected inputType:'radio'|'checkbox' = 'radio';\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet {currentTarget} = evt;\r\n\t\tif (currentTarget.checked === false) return;\r\n        this.newValue = Number(currentTarget.value);\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\t\r\n\tprotected renderInputs():JSX.Element {\r\n\t\tlet {valuesView} = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange,\r\n\t\t};\r\n\t\treturn valuesView.renderRadios(this.value, options);\r\n\t}\r\n}\r\n\r\nexport class TagMultiItemEdit extends TagItemEdit {\r\n\t//private arr:number[];\r\n\tprotected inputType:'radio'|'checkbox' = 'checkbox';\r\n\r\n\tprivate onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.newValue = values.join('|');\r\n        //this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\tprotected renderInputs():JSX.Element {\r\n\t\tlet {valuesView} = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t};\r\n\t\treturn valuesView.renderChecks(this.value, options);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class TextAreaItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem { return this._uiItem as UiTextItem }\r\n    protected async internalStart(): Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, { resolve, reject });\r\n            nav.push(element, reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let onSave = () => {\r\n            this.verifyValue();\r\n            if (this.error === undefined) {\r\n                let val = this.newValue;\r\n                resolve(val);\r\n            }\r\n        }\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n        let onKeyDown = (evt: React.KeyboardEvent<HTMLTextAreaElement>) => {\r\n            // if (evt.keyCode === 13) onSave();\r\n        }\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <textarea\r\n                    onChange={this.onChange}\r\n                    onKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\"\r\n                    defaultValue={this.value}\r\n                    rows={6} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import React from 'react';\r\nimport { UiCheckItem } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class CheckBoxItemEdit extends ItemEdit {\r\n\tprivate input: HTMLInputElement;\r\n    get uiItem(): UiCheckItem {return this._uiItem as UiCheckItem}\r\n\tget editInRow(): boolean {return true;}\r\n    protected async internalStart():Promise<any> {\r\n\t\tif (!this.input) return;\r\n\t\tlet uiItem = this.uiItem;\r\n\t\tif (uiItem === undefined) return this.input.checked;\r\n\t\tlet {checked} = this.input;\r\n\t\treturn this.getValue(checked);\r\n    }\r\n\tasync end():Promise<any> {}\r\n\trenderContent() {\r\n\t\tlet {readOnly} = this.uiItem;\r\n\t\tlet disabled = readOnly === true;\r\n\t\tlet onChange:any;\r\n\t\tif (readOnly !== true) onChange = this.onChange;\r\n\t\treturn <input ref={r => this.input=r} type=\"checkbox\" \r\n\t\t\tdefaultChecked={this.value} disabled={disabled}\r\n\t\t\tonChange={onChange} />\r\n\t}\r\n\r\n\tprivate getValue(checked: boolean) {\r\n\t\tlet {trueValue, falseValue} = this.uiItem;\r\n        return checked === true? (trueValue??true) : (falseValue??false);\r\n\t}\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = this.getValue(evt.target.checked);\r\n        let preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t\tthis.edit.onItemChanged(this, this.newValue);\r\n    }\r\n}\r\n","import { UiRange } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class RangeItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiRange).min\r\n\t\t\tmax = (this._uiItem as UiRange).max\r\n\t\t\tstep = (this._uiItem as UiRange).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'range',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import { UiNumberItem } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class NumberItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiNumberItem).min\r\n\t\t\tmax = (this._uiItem as UiNumberItem).max\r\n\t\t\tstep = (this._uiItem as UiNumberItem).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'number',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import * as React from 'react';\r\n//import _ from 'lodash';\r\nimport { observer } from 'mobx-react';\r\nimport { Schema, UiSchema, ItemSchema, UiItem, UiRadio, UiTagSingle, UiTagMulti } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { StringItemEdit } from './stringItemEdit';\r\nimport { ImageItemEdit } from './imageItemEdit';\r\nimport { RadioItemEdit } from './radioItemEdit';\r\nimport { SelectItemEdit } from './selectItemEdit';\r\nimport { IdItemEdit } from './idItemEdit';\r\nimport { TagSingleItemEdit, TagMultiItemEdit } from './tagItemEdit';\r\nimport { TextAreaItemEdit } from './textAreaItemEdit';\r\nimport { CheckBoxItemEdit } from './checkBoxItemEdit';\r\nimport { RangeItemEdit } from './rangeItemEdit';\r\nimport { NumberItemEdit } from './numberItemEdit';\r\n\r\nexport interface EditProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    data: any;\r\n    onItemClick?: (itemSchema: ItemSchema, uiItem: UiItem, value: any) => Promise<void>;\r\n    onItemChanged?: (itemSchema: ItemSchema, newValue: any, preValue: any) => Promise<void>;\r\n    stopEdit?: boolean;\r\n    uiSchema?: UiSchema;\r\n    sepClassName?: string;\r\n    topBorderClassName?: string;\r\n    bottomBorderClassName?: string;\r\n    rowContainerClassName?: string;\r\n}\r\n\r\n@observer\r\nexport class Edit extends React.Component<EditProps> {\r\n    private defaultSepClassName = 'border-top edit-sep-light-gray';\r\n    private defaultRowContainerClassName = 'd-flex px-3 py-2 bg-white align-items-center';\r\n    private topBorder: JSX.Element;\r\n    private bottomBorder: JSX.Element;\r\n    private rowContainerClassName?: string;\r\n    private sep: JSX.Element;\r\n    private uiSchema: { [name: string]: UiItem };\r\n\r\n    constructor(props: EditProps) {\r\n        super(props);\r\n        let { topBorderClassName, bottomBorderClassName, sepClassName, rowContainerClassName, uiSchema } = props;\r\n        this.topBorder = <div className={topBorderClassName || this.defaultSepClassName} />;\r\n        this.bottomBorder = <div className={bottomBorderClassName || this.defaultSepClassName} />;\r\n        this.rowContainerClassName = rowContainerClassName || this.defaultRowContainerClassName;\r\n        //if (stopEdit !== true) this.rowContainerClassName += ' cursor-pointer';\r\n        this.sep = <div className={sepClassName || this.defaultSepClassName} />;\r\n        this.uiSchema = (uiSchema && uiSchema.items) || {};\r\n    }\r\n\r\n    render() {\r\n        let { schema } = this.props;\r\n        let sep: any;\r\n        return <div>\r\n            {this.topBorder}\r\n            {schema.map((itemSchema, index) => {\r\n                let { stopEdit } = this.props;\r\n                let { name } = itemSchema;\r\n                let uiItem = this.uiSchema === undefined ? undefined : this.uiSchema[name];\r\n                let label: string, labelHide: any;\r\n                if (uiItem !== undefined) {\r\n                    label = uiItem.label || name;\r\n                    labelHide = uiItem.labelHide;\r\n                };\r\n                let value = this.props.data[name];\r\n                let itemEdit = createItemEdit(this, itemSchema, uiItem, label, value);\r\n                let rowContainerClassName = this.rowContainerClassName;\r\n                let { editInRow } = itemEdit;\r\n                if (editInRow === false) {\r\n                    if (stopEdit !== true) editInRow = false;\r\n                }\r\n                if (editInRow === false) rowContainerClassName += ' cursor-pointer';\r\n\r\n                let { required } = itemSchema;\r\n                let requireFlag = required === true && <span className=\"text-danger\">*</span>;\r\n                let divLabel: any, cn: string = 'flex-fill d-flex ';\r\n                if (labelHide === true) {\r\n                    divLabel = undefined;\r\n                }\r\n                else {\r\n                    divLabel = <div>{label} {requireFlag}</div>;\r\n                    cn += 'justify-content-end';\r\n                }\r\n                let ret = <React.Fragment key={index}>\r\n                    {sep}\r\n                    <div className={'d-flex align-items-center' + rowContainerClassName}\r\n                        onClick={async () => await this.rowClick(itemEdit)}>\r\n                        {divLabel}\r\n                        <div className={cn}>{\r\n                            itemEdit === undefined ? undefined : itemEdit.renderContent()\r\n                        }</div>\r\n                        {editInRow === false && <div className=\"w-2c text-end\"><i className=\"fa fa-angle-right\" /></div>}\r\n                    </div>\r\n                </React.Fragment>;\r\n                sep = this.sep;\r\n                return ret;\r\n            })}\r\n            {this.bottomBorder}\r\n        </div>;\r\n    }\r\n\r\n    async onItemChanged(itemEdit: ItemEdit, newValue: any) {\r\n        let { itemSchema, uiItem, value } = itemEdit;\r\n        this.props.data[itemSchema.name] = newValue;\r\n        let { onItemChanged, stopEdit } = this.props;\r\n        if (stopEdit === true) return;\r\n        if (uiItem?.readOnly === true) return;\r\n        if (onItemChanged === undefined) {\r\n            alert(`${itemSchema.name} value changed, new: ${newValue}, pre: ${value}`);\r\n            // 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n            //this.props.data[itemSchema.name] = changeValue;\r\n        }\r\n        else {\r\n            await onItemChanged(itemSchema, newValue, value);\r\n        }\r\n    }\r\n\r\n    private rowClick = async (itemEdit: ItemEdit) => {\r\n        if (itemEdit === undefined) {\r\n            alert('item has no edit');\r\n            return;\r\n        }\r\n        let { itemSchema, uiItem, value, editInRow } = itemEdit;\r\n        if (editInRow === true) return;\r\n        let { onItemChanged, onItemClick, stopEdit } = this.props;\r\n        if (stopEdit === true) return;\r\n        if (uiItem?.readOnly === true) return;\r\n        let changeValue: any;\r\n        if (onItemClick !== undefined) {\r\n            await onItemClick(itemSchema, uiItem, value);\r\n            return;\r\n        }\r\n        //let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);\r\n        if (itemEdit === undefined) {\r\n            alert('undefined: let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);');\r\n            return;\r\n        }\r\n        try {\r\n            changeValue = await itemEdit.start();\r\n            if (changeValue !== value) {\r\n                // 2020-04-15：改值之后，应该赋值吧。所以移到这里来\r\n                this.props.data[itemSchema.name] = changeValue;\r\n                if (onItemChanged === undefined) {\r\n                    alert(`${itemSchema.name} value changed, new: ${changeValue}, pre: ${value}`);\r\n                    // 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n                    //this.props.data[itemSchema.name] = changeValue;\r\n                }\r\n                else {\r\n                    await onItemChanged(itemSchema, changeValue, value);\r\n                }\r\n            }\r\n            await itemEdit.end();\r\n        }\r\n        catch (err) {\r\n            // 如果直接back，会触发reject，就到这里了\r\n            console.log('no value changed');\r\n            console.error(err);\r\n        }\r\n    }\r\n}\r\n\r\ntype NewItemEdit = new (edit: Edit, itemSchema: ItemSchema, uiItem: UiItem, label: string, value: any) => ItemEdit;\r\n\r\nfunction createItemEdit(edit: Edit, itemSchema: ItemSchema, uiItem: UiItem, label: string, value: any): ItemEdit {\r\n    let ie: ItemEdit;\r\n    let itemEdit: NewItemEdit;\r\n    if (uiItem !== undefined) {\r\n        switch (uiItem.widget) {\r\n            default: break;\r\n            case 'id': itemEdit = IdItemEdit; break;\r\n            case 'text': itemEdit = StringItemEdit; break;\r\n            case 'textarea': itemEdit = TextAreaItemEdit; break;\r\n            case 'image': itemEdit = ImageItemEdit; break;\r\n            case 'select': itemEdit = SelectItemEdit; break;\r\n            case 'range': itemEdit = RangeItemEdit; break;\r\n            case 'number':\r\n            case 'updown': itemEdit = NumberItemEdit; break;\r\n            case 'checkbox': itemEdit = CheckBoxItemEdit; break;\r\n            case 'radio':\r\n                ie = new RadioItemEdit(edit, itemSchema, uiItem as UiRadio, label, value);\r\n                break;\r\n            case 'tagSingle':\r\n                ie = new TagSingleItemEdit(edit, itemSchema, uiItem as UiTagSingle, label, value);\r\n                break;\r\n            case 'tagMulti':\r\n                ie = new TagMultiItemEdit(edit, itemSchema, uiItem as UiTagMulti, label, value);\r\n                break;\r\n        }\r\n    }\r\n    if (ie === undefined) {\r\n        if (itemEdit === undefined) {\r\n            switch (itemSchema.type) {\r\n                case 'string': itemEdit = StringItemEdit; break;\r\n                case 'image': itemEdit = ImageItemEdit; break;\r\n                case 'boolean': itemEdit = CheckBoxItemEdit; break;\r\n                case 'number':\r\n                case 'integer': itemEdit = RangeItemEdit; break;\r\n            }\r\n        }\r\n        if (itemEdit === undefined) return;\r\n        ie = new itemEdit(edit, itemSchema, uiItem, label, value);\r\n    }\r\n    ie.init();\r\n    return ie;\r\n}\r\n","import {CenterApiBase} from '../net';\r\n\r\nexport class CenterApi extends CenterApiBase {\r\n    async userAppUnits(app:number):Promise<any[]> {\r\n        return await this.get('tie/user-app-units', {app:app});\r\n    }\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await this.get('user/user-name-nick-icon-from-id', {userId:userId});\r\n\t}\r\n\tasync userFromKey(userName:string):Promise<any> {\r\n\t\treturn await this.get('tie/user-from-key', {key:userName});\r\n\t}\r\n}\r\n\r\nexport const centerApi = new CenterApi('tv/', undefined);\r\n","import * as React from 'react';\r\nimport { Page, FA, nav, LMR, List } from \"../components\";\r\nimport { VPage } from '../vm';\r\nimport { appInFrame } from '../net';\r\nimport { CAppBase } from \"./CAppBase\";\r\nimport { UQsMan } from '../uq';\r\n\r\n/*\r\nexport class VAppMain extends VPage<CMainBase> {\r\n    async open(param?:any) {\r\n        this.openPage(this.appPage);\r\n    }\r\n\r\n    render(param?:any) {\r\n        return this.appContent();\r\n    }\r\n\r\n    protected appPage = () => {\r\n        let {caption} = this.controller;\r\n        return <Page header={caption} logout={async()=>{appInFrame.unit = undefined}}>\r\n            {this.appContent()}\r\n        </Page>;\r\n    }\r\n\r\n    protected appContent = () => {\r\n        let {cUqArr} = this.controller;\r\n        let content:any;\r\n        if (cUqArr.length === 0) {\r\n            content = <div className=\"text-danger\">\r\n                <FA name=\"\" /> 此APP没有绑定任何的UQ\r\n            </div>;\r\n        }\r\n        else {\r\n            content = cUqArr.map((v,i) => <div key={i}>{v.render()}</div>);\r\n        }\r\n        return <>{content}</>;\r\n    };\r\n}\r\n*/\r\nexport class VUnsupportedUnit extends VPage<CAppBase> {\r\n    async open(predefinedUnit: number) {\r\n        this.openPage(this.page, {predefinedUnit:predefinedUnit});\r\n    }\r\n\r\n    private page = ({predefinedUnit}:{predefinedUnit: number}) => {\r\n        let {user} = nav;\r\n        let userName:string = user? user.name : '[未登录]';\r\n        let {appOwner, appName} = UQsMan.value;\r\n        return <Page header=\"APP无法运行\" logout={true}>\r\n            <div className=\"m-3 text-danger container\">\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">登录用户</div>\r\n                    <div className=\"col-sm text-body\">{userName}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">App</div>\r\n                    <div className=\"col-sm text-body\">{`${appOwner}/${appName}`}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">预设小号</div>\r\n                    <div className=\"col-sm text-body\">{predefinedUnit || <small className=\"\">[无预设小号]</small>}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">\r\n                        可能原因<FA name=\"exclamation-triangle\" />\r\n                    </div>\r\n                    <div className=\"col-sm text-body\">\r\n                        <ul className=\"p-0\">\r\n                            <li>没有小号运行 {appName}</li>\r\n                            <li>用户 <b>{userName}</b> 没有加入任何一个运行{appName}的小号</li>\r\n                            {\r\n                                predefinedUnit && \r\n                                <li>预设小号 <b>{predefinedUnit}</b> 没有运行App {appName}</li>\r\n                            }\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">小号{predefinedUnit}</div>\r\n                    <div className=\"col-sm text-body\">\r\n                        预设小号定义在 public/unit.json 文件中。\r\n                        定义了这个文件的程序，只能由url直接启动。\r\n                        用户第一次访问app之后，会缓存在localStorage里。<br/>\r\n                        如果要删去缓存的预定义Unit，logout然后再login。\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class VUnitSelect extends VPage<CAppBase> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderRow = (item: any, index: number):JSX.Element => {\r\n        let {id, nick, name} = item;\r\n        return <LMR className=\"px-3 py-2\" right={'id: ' + id}>\r\n            <div>{nick || name}</div>\r\n        </LMR>;\r\n    }\r\n    private onRowClick = async (appUnit: any) => {\r\n\t\tappInFrame.unit = appUnit.id; // 25;\r\n\t\tthis.controller.setAppUnit(appUnit);\r\n        await this.controller.start();\r\n    }\r\n\r\n    private page = () => {\r\n        return <Page header=\"选择小号\" logout={true}>\r\n            <List items={this.controller.appUnits} item={{render: this.renderRow, onClick: this.onRowClick}}/>\r\n        </Page>\r\n    }\r\n}\r\n\r\nexport class VErrorsPage extends VPage<CAppBase> {\r\n    async open(errors:string[]) {\r\n        this.openPage(this.page, {errors:errors});\r\n    }\r\n\r\n    private page = (errors:{errors:string[]}) => {\r\n        return <Page header=\"ERROR\">\r\n            <div className=\"m-3\">\r\n\t\t\t\t<div className=\"p-3 d-flex justify-content-center align-items-center\">\r\n\t\t\t\t\t<button className=\"btn btn-danger\" onClick={nav.resetAll}>重启网页</button>\r\n\t\t\t\t</div>\r\n\r\n                <div>Load Uqs 发生错误：</div>\r\n                {errors.errors.map((r, i) => <div key={i}>{r}</div>)}\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class VStartError extends VPage<CAppBase> {\r\n    async open(error:any) {\r\n        this.openPage(this.page, {error:error});\r\n    }\r\n\r\n    private page = ({error}:{error:any}) => {\r\n        return <Page header=\"App start error!\">\r\n            <pre>\r\n                {typeof error === 'string'? error : error.message}\r\n            </pre>\r\n        </Page>;\r\n    }\r\n}","import { nav, t, setGlobalRes, RouteFunc, Hooks, Navigo, NamedRoute } from \"../components\";\r\nimport { Controller } from '../vm';\r\nimport { UQsMan, TVs } from \"../uq\";\r\nimport { appInFrame } from \"../net\";\r\nimport { centerApi } from \"./centerApi\";\r\nimport { VUnitSelect, VErrorsPage, VStartError, VUnsupportedUnit } from \"./vMain\";\r\n\r\nexport interface IConstructor<T> {\r\n    new (...args: any[]): T;\r\n}\r\n\r\nexport interface AppConfig {\r\n    appName: string;        // 格式: owner/appName\r\n    version: string;        // 版本变化，缓存的uqs才会重载\r\n    tvs: TVs;\r\n    uqNameMap?: {[uqName:string]: string};      // uqName='owner/uq' 映射到内存简单名字：uq, 可以注明映射，也可以自动。有可能重\r\n    loginTop?: JSX.Element;\r\n    oem?: string;               // 用户注册发送验证码的oem厂家，默认同花\r\n\tprivacy?: string;\r\n\tnoUnit?: boolean;\t\t\t// app的运行，不跟unit绑定\r\n\thtmlTitle?: string;\r\n}\r\n\r\nexport interface Elements {\r\n\t[id:string]: (element: HTMLElement)=>void,\r\n}\r\n\r\nexport abstract class CAppBase extends Controller {\r\n\tprivate appConfig: AppConfig;\r\n    protected _uqs: any;\r\n\r\n    protected readonly name: string;\r\n\tprotected readonly noUnit: boolean;\r\n\r\n    appUnits:any[];\r\n\r\n    constructor(config?: AppConfig) {\r\n\t\tsuper(undefined);\r\n\t\tthis.appConfig = config || (nav.navSettings as AppConfig);\r\n\t\tif (this.appConfig) {\r\n\t\t\tlet {appName, noUnit} = this.appConfig;\r\n\t\t\tthis.name = appName;\r\n\t\t\tif (appName === undefined) {\r\n\t\t\t\tthrow new Error('appName like \"owner/app\" must be defined in MainConfig');\r\n\t\t\t}\r\n\t\t\tthis.noUnit = noUnit;\r\n\t\t}\r\n    }\r\n\r\n    get uqs(): any {return this._uqs;}\r\n\r\n\tinternalT(str:string):any {\r\n\t\treturn t(str);\r\n\t}\r\n\t\r\n\tprotected setRes(res:any) {\r\n\t\tsetGlobalRes(res);\r\n\t}\r\n\r\n\tprivate appUnit:any;\r\n\tprivate roleDefines: string[];\r\n\thasRole(role: string|number):boolean {\r\n\t\tlet nRole:number;\r\n\t\tif (typeof role === 'string') {\r\n\t\t\tif (role.length === 0) return false;\r\n\t\t\tlet index = this.roleDefines.findIndex(v => v === role);\r\n\t\t\tif (index < 0) return false;\r\n\t\t\tnRole = 1<<index;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tnRole = role;\r\n\t\t}\r\n\t\treturn (this.appUnit.roles & nRole) !== 0;\r\n\t}\r\n\r\n\tsetAppUnit(appUnit:any) {\r\n\t\tthis.appUnit = appUnit;\r\n\t\tlet {roleDefs} = appUnit;\r\n\t\tif (roleDefs) {\r\n\t\t\tthis.roleDefines = roleDefs.split('\\t');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.roleDefines = [];\r\n\t\t}\r\n}\r\n\t\r\n    protected async beforeStart():Promise<boolean> {\r\n        try {\r\n\t\t\tthis.onNavRoutes();\r\n\t\t\tif (!this.appConfig) return true;\r\n\t\t\tlet {appName, version, tvs} = this.appConfig;\r\n\t\t\tawait UQsMan.load(appName, version, tvs);\r\n\t\t\tthis._uqs = UQsMan._uqs;\t\t\t\r\n            //let retErrors = await this.load();\r\n            //let app = await loadAppUqs(this.appOwner, this.appName);\r\n            // if (isDevelopment === true) {\r\n\t\t\t// 这段代码原本打算只是在程序员调试方式下使用，实际上，也可以开放给普通用户，production方式下\r\n\t\t\tlet retErrors = UQsMan.errors;\r\n            let {predefinedUnit} = appInFrame;\r\n            let {user} = nav;\r\n            if (user !== undefined && user.id > 0) {\r\n\t\t\t\tlet result = await centerApi.userAppUnits(UQsMan.value.id);\r\n\t\t\t\tthis.appUnits = result;\r\n\t\t\t\t/*\r\n\t\t\t\t// 老版本，只返回一个数组。新版本，返回两个数组。下面做两个数组的判断\r\n\t\t\t\tif (result.length === 0) {\r\n\t\t\t\t\tthis.appUnits = result;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (Array.isArray(result[0]) === true) {\r\n\t\t\t\t\t\tthis.appUnits = result[0];\r\n\t\t\t\t\t\tlet result1 = result[1];\r\n\t\t\t\t\t\tif (Array.isArray(result1) === true) {\r\n\t\t\t\t\t\t\tthis.roleDefines = result1[0]?.roles?.split('\\t');\r\n\t\t\t\t\t\t\tif (this.roleDefines === undefined) this.roleDefines = [];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.appUnits = result;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\tif (this.noUnit === true) return true;\r\n                switch (this.appUnits.length) {\r\n                    case 0:\r\n                        this.showUnsupport(predefinedUnit);\r\n\t\t\t\t\t\treturn false;\r\n                    case 1:\r\n\t\t\t\t\t\tlet appUnit = this.appUnits[0];\r\n\t\t\t\t\t\tthis.setAppUnit(appUnit);\r\n\t\t\t\t\t\tlet {id} = appUnit;\r\n                        let appUnitId = id;\r\n                        if (appUnitId === undefined || appUnitId < 0 || \r\n                            (predefinedUnit !== undefined && appUnitId !== predefinedUnit))\r\n                        {\r\n                            this.showUnsupport(predefinedUnit);\r\n                            return false;\r\n                        }\r\n                        appInFrame.unit = appUnitId;\r\n                        break;\r\n                    default:\r\n                        if (predefinedUnit>0 && this.appUnits.find(v => v.id===predefinedUnit) !== undefined) {\r\n                            appInFrame.unit = predefinedUnit;\r\n                            break;\r\n                        }\r\n                        this.openVPage(VUnitSelect);\r\n                        return false;\r\n                }\r\n            }\r\n            if (retErrors !== undefined) {\r\n                this.openVPage(VErrorsPage, retErrors);\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n        catch (err) {\r\n            this.openVPage(VStartError, err);\r\n            return false;\r\n        }\r\n    }\r\n\tprotected async afterStart():Promise<void> {\r\n\t\tnav.resolveRoute();\r\n\t}\r\n\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await centerApi.userFromId(userId);\r\n    }\r\n\r\n\tprotected on(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\tprotected on(...args:any[]):Navigo {\r\n\t\treturn nav.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tprotected onNavRoutes() {return;}\r\n\r\n    private showUnsupport(predefinedUnit: number) {\r\n        nav.clear();\r\n        this.openVPage(VUnsupportedUnit, predefinedUnit);\r\n    }\r\n}\r\n","import { AppConfig, CAppBase } from './CAppBase';\r\n\r\nexport async function start(CApp: new (config: AppConfig) => CAppBase, appConfig: AppConfig, isUserLogin?:boolean) {\r\n\tif (appConfig) {\r\n\t\tlet {htmlTitle} = appConfig;\r\n\t\tif (htmlTitle) {\r\n\t\t\tdocument.title = htmlTitle;\r\n\t\t}\r\n\t\tlet html = document.getElementsByTagName('html');\r\n\t\tlet html0 = html[0];\r\n\t\tif (html0) {\r\n\t\t\tlet version = html0?.getAttribute('data-version');\r\n\t\t\tif (version) appConfig.version = version;\r\n\t\t}\r\n\t}\r\n\r\n\tlet cApp = new CApp(appConfig);\r\n    await cApp.start(isUserLogin);\r\n}\r\n","import _ from 'lodash';\r\nimport { Controller, WebNav } from \"../vm\";\r\nimport { IConstructor } from \"./CAppBase\";\r\n\r\nexport abstract class CBase extends Controller {\r\n    protected readonly _uqs: any;\r\n    protected readonly _cApp: any;\r\n\r\n    constructor(cApp: any) {\r\n        super(cApp.res);\r\n        this._cApp = cApp;\r\n        this._uqs = cApp && cApp.uqs;\r\n\t}\r\n\r\n    protected get uqs(): any {return this._uqs}\r\n\tget cApp(): any {return this._cApp}\r\n\thasRole(role:string|number):boolean {\r\n\t\treturn this._cApp?.hasRole(role);\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._cApp.internalT(str);\r\n\t}\r\n\r\n    protected newC<T extends CBase>(type: IConstructor<T>, param?:any):T {\r\n\t\tlet c = new type(this.cApp);\r\n\t\tc.init(param);\r\n\t\treturn c;\r\n    }\r\n\r\n    protected newSub<O extends CBase, T extends CSub<O>>(type: IConstructor<T>, param?:any):T {\r\n\t\tlet s = new type(this);\r\n\t\ts.init(param);\r\n\t\treturn s;\r\n\t}\r\n\t\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this._cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ret = _.clone(wn);\r\n\t\t_.merge(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nexport abstract class CSub<T extends CBase> extends CBase {\r\n    protected _owner: T;\r\n\r\n    constructor(owner: T) {\r\n        super(owner.cApp);\r\n        this._owner = owner;\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._owner.internalT(str);\r\n\t}\r\n\r\n    protected get owner(): CBase {return this._owner}\r\n\t\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this._cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ownerWNs:WebNav<any>[] = [];\r\n\t\tfor (let p = this.owner; p!==undefined; p = (p as any)?.owner) {\r\n\t\t\townerWNs.push(p.webNav);\r\n\t\t}\r\n\t\tlet ret = _.clone(wn);\r\n\t\tfor (;;) {\r\n\t\t\tlet own = ownerWNs.pop();\r\n\t\t\tif (own === undefined) break;\r\n\t\t\t_.merge(ret, own);\r\n\t\t}\r\n\t\t_.merge(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { IObservableArray, computed } from 'mobx';\r\nimport { PageItems } from '../../tool/pageItems';\r\nimport {List} from './index';\r\n\r\nexport abstract class ListBase {\r\n    protected list: List;\r\n    constructor(list: List) {\r\n        this.list = list;\r\n    }\r\n    get isPaged():boolean {\r\n        let items = this.list.props.items;\r\n        return (items !== null && items !== undefined && Array.isArray(items) === false);\r\n    }\r\n    get items():any[]|IObservableArray<any> {\r\n        let items = this.list.props.items;\r\n        if (items === null) return null;\r\n        if (items === undefined) return undefined;\r\n        if (Array.isArray(items) === true)\r\n            return items as IObservableArray<any>;\r\n        else\r\n            return (items as PageItems<any>).items;\r\n    }\r\n    @computed get loading():boolean {\r\n        let items = this.list.props.items;\r\n        if (items === null) return false;\r\n        if (items === undefined) return true;\r\n        let pageItems = items as PageItems<any>;\r\n        if (pageItems.items === undefined) return false;\r\n        return pageItems.loading;\r\n    }\r\n    get selectedItems():any[] { return undefined; }\r\n    //updateProps(nextProps:any) {}\r\n    dispose() {};\r\n    abstract render: (item:any, index:number) => JSX.Element;\r\n    protected renderContent(item:any, index:number) {\r\n        let {render} = this.list.props.item;\r\n        if (render === undefined) return <div className=\"px-3 py-2\">{JSON.stringify(item)}</div>;\r\n        return render(item, index);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\n\r\nexport class Clickable extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key, onClick} = this.list.props.item;\r\n        return <li key={key===undefined?index:key(item)} className={classNames('va-row-clickable', className)} onClick={()=>onClick && onClick(item)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { ListBase } from './base';\r\nimport { uid } from '../../tool/uid';\r\n\r\nexport class Static extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key} = this.list.props.item;\r\n        if (typeof item === 'string') {\r\n            let cn = classNames('va-list-gap', 'px-3', 'pt-1');\r\n            return <li key={uid()} className={cn}>{item}</li>;\r\n        }\r\n        return <li key={key===undefined?index:key(item)} className={classNames(className)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observable, IObservableArray, isObservableArray, observe} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\nimport {uid} from '../../tool/uid';\r\nimport { PageItems } from '../../tool/pageItems';\r\nimport { List } from './index';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport interface SelectableItem {\r\n    selected: boolean;\r\n    item: any;\r\n    labelId: string;\r\n}\r\n\r\nexport class Selectable extends ListBase {\r\n    @observable private _items: SelectableItem[];\r\n    private inputItems:{[uid:string]: HTMLInputElement} = {};\r\n\r\n    constructor(list: List) {\r\n        super(list);\r\n        this.buildItems();\r\n        this.listenArraySplice();\r\n    }    \r\n\r\n    private listenArraySplice() {\r\n        let {items} = this.list.props;\r\n        if (items === undefined) return;\r\n        if (items === null) return;\r\n        let itemsArray:any;\r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as PageItems<any>).items;\r\n        }\r\n        if (isObservableArray(items) === true) {\r\n            observe(itemsArray as IObservableArray<any>, (change) => {                \r\n                if (change.type === 'splice') {\r\n                    let {index, removedCount, added} = change;\r\n                    let _added = added && added.map(v => {\r\n                        return {\r\n                            selected: false, \r\n                            item: v, \r\n                            labelId:uid()\r\n                        }\r\n                    });\r\n                    this._items.splice(index, removedCount, ..._added);\r\n                    this.buildItems();\r\n                }\r\n            }, true);\r\n        }\r\n    }\r\n\r\n    private buildItems = () => {\r\n        let {items, isItemSelected, selectedItems, compare} = this.list.props;\r\n        let itemsArray:any[] | IObservableArray<any>;\r\n        if (items === undefined) {\r\n            this._items = undefined;\r\n            return;\r\n        }\r\n        if (items === null) {\r\n            this._items = null;\r\n            return;\r\n        }\r\n        \r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as PageItems<any>).items;\r\n        }\r\n\r\n\t\tif (isItemSelected) {\r\n\t\t\tlet retItems = itemsArray.map(v => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tselected: isItemSelected(v),\r\n\t\t\t\t\titem: v, \r\n\t\t\t\t\tlabelId:uid()\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tthis._items = retItems;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet comp: ((item:any, selectItem:any)=>boolean);\r\n\t\t\tif (compare === undefined) {\r\n\t\t\t\tcomp = (item:any, selectItem:any) => item === selectItem;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcomp = compare;\r\n\t\t\t}\r\n\t\t\tlet retItems = itemsArray.map(v => {\r\n\t\t\t\t//let isObserved = isObservable(v);\r\n\t\t\t\t//let obj = isObserved === true? toJS(v) : v;\r\n\t\t\t\t//let obj = v;\r\n\t\t\t\tlet selected = selectedItems === undefined?\r\n\t\t\t\t\tfalse\r\n\t\t\t\t\t: selectedItems.find(si => comp(v, si)) !== undefined;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tselected: selected, \r\n\t\t\t\t\titem: v, \r\n\t\t\t\t\tlabelId:uid()\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tthis._items = retItems;\r\n\t\t}\r\n    }\r\n\r\n    get items() {\r\n        //if (this._items === undefined) \r\n        //this.buildItems();\r\n        return this._items;\r\n    }\r\n    private checkAll(on: boolean) {\r\n        for (let i in this.inputItems) this.inputItems[i].checked = on;\r\n        for (let item of this._items) item.selected = on;\r\n    }\r\n    selectAll() {\r\n        //if (this._items) this._items.forEach(v => v.selected = true);\r\n        this.checkAll(true);\r\n        this.list.props.item.onSelect(undefined, true, this.anySelected);\r\n    }\r\n    unselectAll() {\r\n        // if (this._items) this._items.forEach(v => v.selected = false);\r\n        this.checkAll(false);\r\n        this.list.props.item.onSelect(undefined, false, this.anySelected);\r\n    }\r\n    /*\r\n    updateProps(nextProps:any) {\r\n        if (nextProps.selectedItems === this._selectedItems) return;\r\n        this.buildItems();\r\n    }\r\n    */\r\n    private get anySelected():boolean {return this._items.some(v => v.selected)}\r\n    private onSelect(item:SelectableItem, selected:boolean) {\r\n        item.selected = selected;\r\n        this.list.props.item.onSelect(item.item, selected, this.anySelected);\r\n    }\r\n    \r\n    get selectedItems():any[] {\r\n        return this._items.filter(v => v.selected === true).map(v => v.item);\r\n    }\r\n    /*\r\n    set selectedItems(value: any[]) {\r\n        if (value === undefined) return;\r\n        if (this._items === undefined) return;\r\n        let sLen = this._items.length;\r\n        let list = value.slice();\r\n        for (let n=0; n<sLen; n++) {\r\n            let sItem = this._items[n];\r\n            let len = list.length;\r\n            if (len === 0) break;\r\n            let item = sItem.item;\r\n            for (let i=0; i<len; i++) {\r\n                let v = list[i];\r\n                if (item === v) {\r\n                    sItem.selected = true;\r\n                    value.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        };\r\n    }\r\n    */\r\n    //w-100 mb-0 pl-3\r\n    //m-0 w-100\r\n    render = (item:SelectableItem, index:number):JSX.Element => {\r\n        let {key} = this.list.props.item;\r\n\t\treturn React.createElement(this.row, {item, index, key:key===undefined?index:key(item)});\r\n    }\r\n\r\n    private row = observer((props: {item:SelectableItem, index:number}):JSX.Element => {\r\n        let {item, index} = props;\r\n        let {className} = this.list.props.item;\r\n        let {labelId, selected, item:obItem} = item;\r\n        return <li className={classNames(className)}>\r\n            <div className=\"d-flex align-items-center px-3\">\r\n                <input ref={input=>{if (input) this.inputItems[labelId] = input;}}\r\n                    className=\"\" type=\"checkbox\" value=\"\" id={labelId}\r\n                    defaultChecked={selected}\r\n                    onChange={(e)=>{\r\n                        this.onSelect(item, e.target.checked)} \r\n                    }/>\r\n                <label className=\"\" style={{flex:1, marginBottom:0}} htmlFor={labelId}>\r\n                    {this.renderContent(obItem, index)}\r\n                </label>\r\n            </div>\r\n        </li>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport _ from 'lodash';\r\nimport {PageItems} from '../../tool/pageItems';\r\nimport {ListBase} from './base';\r\nimport {Clickable} from './clickable';\r\nimport {Static} from './static';\r\nimport {Selectable} from './selectable';\r\nimport '../../css/va-list.css';\r\nimport { IObservableArray } from 'mobx';\r\nimport { resLang } from '../../res/res';\r\nimport { ListRes, listRes } from '../../res';\r\n\r\ntype StaticRow = string|JSX.Element|(()=>string|JSX.Element);\r\ninterface ItemProps {\r\n\tclassName?: string|string[];\r\n\trender?: (item:any, index:number) => JSX.Element;\r\n\tonSelect?: (item:any, isSelected:boolean, anySelected:boolean)=>void;\r\n\tonClick?: (item:any)=>void;\r\n\tkey?: (item:any)=>string|number;\r\n}\r\n\r\nexport interface ListProps {\r\n    className?: string|string[];\r\n    items: any[] | IObservableArray<any> | PageItems<any>;\r\n    item: ItemProps;\r\n\tisItemSelected?: (item:any) => boolean;\r\n    compare?: (item:any, selectItem:any) => boolean;\r\n\tselectedItems?:any[];\r\n    header?: StaticRow;\r\n    footer?: StaticRow;\r\n    before?: StaticRow;\r\n    loading?: StaticRow;\r\n\tnone?: StaticRow;\r\n\tonFocus?: (evt: React.FocusEvent<HTMLUListElement>)=>void;\r\n}\r\n\r\n@observer\r\nexport class List extends React.Component<ListProps> {\r\n\tprivate static res:ListRes = resLang<ListRes>(listRes);\r\n\r\n\tprivate listBase: ListBase;\r\n\tprivate selectable: Selectable;\r\n    constructor(props:ListProps) {\r\n\t\tsuper(props);\r\n        this.buildBase();\r\n    }\r\n    _$scroll = (direct: 'top'|'bottom') => {\r\n        console.log('############### items scroll to ' + direct);\r\n    }\r\n    private buildBase() {\r\n        let {item} = this.props;\r\n        let {onClick, onSelect} = item;\r\n        if (onSelect !== undefined)\r\n            this.selectable = this.listBase = new Selectable(this);\r\n        else if (onClick !== undefined)\r\n            this.listBase = new Clickable(this);\r\n        else\r\n            this.listBase = new Static(this);\r\n\t}\r\n\tcomponentDidUpdate(prevProps: Readonly<ListProps>, prevState: Readonly<any>) {\r\n\t\tif (_.isEqual(this.props.item, prevProps.item) === false) {\r\n\t\t\tthis.buildBase();\r\n\t\t\tthis.forceUpdate();\r\n\t\t}\r\n\t}\r\n    componentWillUnmount() {\r\n        this.listBase.dispose();\r\n    }\r\n    selectAll() {\r\n        if (this.selectable) this.selectable.selectAll();\r\n    }\r\n    unselectAll() {\r\n        if (this.selectable) this.selectable.unselectAll();\r\n    }\r\n    get selectedItems():any[] {\r\n        return this.listBase.selectedItems;\r\n    }\r\n    render() {\r\n        let {className, header, footer, before, loading, none, onFocus} = this.props;\r\n        if (before === undefined) before = '-';\r\n        if (loading === undefined) loading = () => <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />;\r\n        if (none === undefined) none = List.res.none;\r\n        //this.listBase.selectedItems = selectedItems;\r\n        let {items, loading:isLoading} = this.listBase;\r\n        function staticRow(row:StaticRow, type:string) {\r\n            if (!row) return;\r\n            switch (typeof row) {\r\n                default:\r\n                case 'string': return <li className={\"va-list-\"+type}>{row}</li>;\r\n                case 'function': return <li className={\"va-list-\"+type}>{(row as ()=>string|JSX.Element)()}</li>;\r\n                case 'object': return <li>{row}</li>\r\n            } \r\n        }\r\n        let content:any, waitingMore:any;\r\n        if (items === null)\r\n            content = staticRow(before, 'before');\r\n        else if (items === undefined)\r\n            content = staticRow(loading, 'loading');\r\n        else if (items.length === 0)\r\n            content = staticRow(none, 'none');\r\n        else {\r\n            content = items.map((item, index) => {\r\n                return this.listBase.render(item, index);\r\n            });\r\n        }\r\n        if (isLoading === true && items) {\r\n            waitingMore = staticRow(loading, 'loading');\r\n\t\t}\r\n\t\tlet tabIndex:number;\r\n\t\tif (onFocus !== undefined) tabIndex = -1;\r\n        return <ul className={classNames('va-list', className)} onFocus={onFocus} tabIndex={tabIndex}>\r\n            {staticRow(header, 'header')}\r\n            {content}\r\n            {waitingMore}\r\n            {staticRow(footer, 'footer')}\r\n        </ul>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport className from 'classnames';\r\nimport {PropGridProps} from './PropGrid';\r\nimport {LabeledProp, StringProp, NumberProp, ListProp, ComponentProp} from './propView';\r\n\r\nexport abstract class PropRow {\r\n    setValues(values: any) {}\r\n    abstract render(key:string): any;\r\n}\r\n\r\nexport class PropBorder extends PropRow {\r\n    render(key:string): JSX.Element {\r\n        return <div key={'_b_' + key} className=\"\">\r\n            <div className=\"w-100\">\r\n                <div style={{borderTop: '1px solid #f0f0f0'}} />\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class PropGap extends PropRow {\r\n    private param: string;\r\n    constructor(param?: string) {\r\n        super();\r\n        this.param = param;\r\n    }\r\n    render(key:string): JSX.Element {\r\n        let w: string;\r\n        switch (this.param) {\r\n            default: w = 'py-2'; break;\r\n            case '=': w = 'py-1'; break;\r\n            case '-': w = 'pb-1'; break;\r\n        }\r\n        let cn = className(w);\r\n        return <div key={'_g_' + key} className={cn} />;\r\n    }\r\n}\r\n\r\nconst valueAlignStart = 'justify-content-start';\r\nconst valueAlignCenter = 'justify-content-center';\r\nconst valueAlignEnd = 'justify-content-end';\r\nexport abstract class LabeledPropRow extends PropRow {\r\n    protected gridProps: PropGridProps;\r\n    protected _prop: LabeledProp;\r\n    protected get prop():LabeledProp {return this._prop}\r\n    protected content: any;\r\n    protected col: string;\r\n    //protected values: any;\r\n    constructor(gridProps:PropGridProps, prop: LabeledProp) {\r\n        super();\r\n        this.gridProps = gridProps;\r\n        this._prop = prop;\r\n        this.col = gridProps.labelFixLeft === true? 'col' : 'col-sm';\r\n        //this.values = values;\r\n    }\r\n    render(key:string):any {\r\n        let {onClick, bk} = this.prop;\r\n        let cn = className({\r\n            \"cursor-pointer\": onClick !== undefined,\r\n            \"bg-white\": bk === undefined, \r\n            \"row\": true\r\n        });\r\n        return <div key={key} className={cn} onClick={onClick}>\r\n            {this.renderLabel()}\r\n            {this.renderProp()}\r\n        </div>;\r\n    }\r\n    protected renderLabel():any {\r\n        let {label} = this.prop;\r\n        if (label === undefined) return null;\r\n        return <label className={this.col + '-3 col-form-label'}>\r\n            {label}\r\n        </label>;\r\n    }\r\n    protected renderProp():any {\r\n        let {label} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string = this.col + (label===undefined? '-12':'-9');\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n    protected renderPropBody():any {\r\n        return <div className=\"form-control-plaintext\">\r\n            {this.renderPropContent()}\r\n        </div>;\r\n    }\r\n    protected renderPropContent():any {\r\n        return this.content;\r\n    }\r\n}\r\n\r\nexport class StringPropRow extends LabeledPropRow {\r\n    protected get prop(): StringProp {return this._prop as StringProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class NumberPropRow extends LabeledPropRow {\r\n    protected get prop(): NumberProp {return this._prop as NumberProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class ListPropRow extends LabeledPropRow {\r\n    protected get prop(): ListProp {return this._prop as ListProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else {\r\n            let list = this.prop.list;\r\n            if (typeof list === 'string') this.content = values[list];\r\n            else this.content = undefined;\r\n        }\r\n    }\r\n    protected renderPropBody() {\r\n        let {list, row} = this.prop;\r\n        let items:any[] = typeof list === 'string'? this.content : list;\r\n        if (items === undefined) return <div/>;\r\n        // new row(item)\r\n        return <div className=\"w-100\">\r\n            {\r\n                items.map((item, index) => <React.Fragment key={index}>\r\n                    {index===0? null: <div style={{width:'100%', borderBottom:'1px solid #f0f0f0'}} />}\r\n                    {React.createElement(row, item)}\r\n                </React.Fragment>)\r\n            }\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class ComponentPropRow extends LabeledPropRow {\r\n    protected get prop(): ComponentProp {return this._prop as ComponentProp;}\r\n    protected renderPropBody() {\r\n        let {component} = this.prop;\r\n        return component;\r\n    }\r\n    protected renderProp():any {\r\n        let {label, full} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string;\r\n        if (full !== true)\r\n            col = this.col + (label===undefined? '-12':'-9');\r\n        else\r\n            col = 'w-100';\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n}\r\n","import { PropGridProps } from './PropGrid';\r\nimport {\r\n    PropRow, PropBorder, PropGap, \r\n    StringPropRow, NumberPropRow, ListPropRow, ComponentPropRow\r\n} from './row';\r\n\r\nexport interface Format {\r\n\r\n}\r\n\r\nexport interface PropBase {\r\n    onClick?: () => void;\r\n}\r\n\r\nexport interface LabeledProp extends PropBase {\r\n    label?: string;\r\n    bk?: string;\r\n    vAlign?: 'top' | 'bottom' | 'center' | 'stretch';\r\n}\r\n\r\nexport interface StringProp extends LabeledProp {\r\n    type: 'string';\r\n    name: string;\r\n}\r\n\r\nexport interface NumberProp extends LabeledProp {\r\n    type: 'number';\r\n    name: string;\r\n}\r\n\r\nexport interface FormatProp extends LabeledProp {\r\n    type: 'format';\r\n    format: Format;\r\n}\r\n\r\nexport interface ListProp extends LabeledProp {\r\n    type: 'list';\r\n    list: string | any[];  // string 表示名字，否则就是值\r\n    row: new (props: any) => React.Component;\r\n}\r\n\r\nexport interface ComponentProp extends LabeledProp {\r\n    type: 'component';\r\n    full?: boolean;\r\n    component: any; //JSX.Element;\r\n}\r\n\r\nexport type Prop = StringProp | NumberProp | FormatProp | ListProp | ComponentProp | string;\r\n\r\nexport class PropView {\r\n    private gridProps: PropGridProps\r\n    private props: Prop[];\r\n    //private values:any;\r\n    private rows: PropRow[];\r\n\r\n    constructor(gridProps: PropGridProps, props: Prop[]) {\r\n        this.gridProps = gridProps;\r\n        this.props = props;\r\n        //this.values = values;\r\n        this.buildRows();\r\n    }\r\n\r\n    private buildRows() {\r\n        this.rows = [];\r\n        let isGap: boolean = true;\r\n        for (let prop of this.props) {\r\n            if (typeof prop === 'string') {\r\n                this.rows.push(new PropGap(prop));\r\n                isGap = true;\r\n            }\r\n            else {\r\n                if (!isGap) this.rows.push(new PropBorder());\r\n                let row;\r\n                switch (prop.type) {\r\n                    default: continue;\r\n                    case 'string': row = new StringPropRow(this.gridProps, prop); break;\r\n                    case 'number': row = new NumberPropRow(this.gridProps, prop); break;\r\n                    case 'list': row = new ListPropRow(this.gridProps, prop); break;\r\n                    case 'component': row = new ComponentPropRow(this.gridProps, prop); break;\r\n                }\r\n                this.rows.push(row);\r\n                isGap = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    setValues(values: any) {\r\n        for (let r of this.rows) r.setValues(values);\r\n    }\r\n\r\n    render() {\r\n        return this.rows.map((row, index) => row.render(String(index)));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, PropView} from './propView';\r\n\r\nexport interface PropGridProps {\r\n    className?: string;\r\n    rows: Prop[];\r\n    values: any;\r\n    alignValue?: 'left'|'center'|'right';\r\n    labelFixLeft?: boolean;\r\n}\r\n\r\n@observer\r\nexport class PropGrid extends React.Component<PropGridProps> {\r\n    render() {\r\n        let {className, rows, values} = this.props;\r\n        let propView = new PropView(this.props, rows);\r\n        propView.setValues(values);\r\n        let cn = classNames('container-fluid', className);\r\n        return <div className={cn}>\r\n            {propView.render()}\r\n        </div>;\r\n    }\r\n}\r\n","import { observable } from 'mobx';\r\nimport { isNumber } from 'util';\r\nimport _ from 'lodash';\r\nimport { LocalArr } from '../../tool';\r\nimport { BoxId } from './boxId';\r\nimport { TuidInner, TuidDiv } from './tuid';\r\n\r\nconst maxCacheSize = 1000;\r\n\r\nexport class IdCache {\r\n    private queue: number[] = [];               // 每次使用，都排到队头\r\n\tprivate cache = observable.map({}, {deep: false});    // 已经缓冲的\r\n\tprivate loading:boolean = false;\r\n\r\n    protected localArr:LocalArr;\r\n    protected waitingIds: number[] = [];          // 等待loading的\r\n    protected tuidInner: TuidInner;\r\n\r\n    constructor(tuidLocal: TuidInner) {\r\n        this.tuidInner = tuidLocal;\r\n        this.initLocalArr();\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    useId(id:number, defer?:boolean) {\r\n        if (!id) return;\r\n        if (isNumber(id) === false) return;\r\n        if (this.cache.has(id) === true) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n        this.tuidInner.cacheTuids(defer===true?70:20);\r\n        this.cache.set(id, id);\r\n        if (this.waitingIds.findIndex(v => v === id) >= 0) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n\r\n        if (this.queue.length >= maxCacheSize) {\r\n            // 缓冲已满，先去掉最不常用的\r\n            let r = this.queue.shift();\r\n            if (r === id) {\r\n                // 如果移除的，正好是现在用的，则插入\r\n                this.queue.push(r);\r\n                return;\r\n            }\r\n\r\n            //let rKey = String(r);\r\n            if (this.cache.has(r) === true) {\r\n                // 如果移除r已经缓存\r\n                this.cache.delete(r);\r\n            }\r\n            else {\r\n                // 如果移除r还没有缓存\r\n                let index = this.waitingIds.findIndex(v => v === r);\r\n                this.waitingIds.splice(index, 1);\r\n            }\r\n        }\r\n        this.waitingIds.push(id);\r\n        this.queue.push(id);\r\n        return;\r\n    }\r\n\r\n    private moveToHead(id:number) {\r\n        let index = this.queue.findIndex(v => v === id);\r\n        this.queue.splice(index, 1);\r\n        this.queue.push(id);\r\n    }\r\n\r\n    getValue(id:number) {\r\n        return this.cache.get(id);\r\n    }\r\n\r\n    remove(id:number) {\r\n        this.cache.delete(id);\r\n        let index = this.queue.findIndex(v => v === id);\r\n\t\tthis.queue.splice(index, 1);\r\n\t\tthis.localArr.removeItem(id);\r\n    }\r\n\r\n    valueFromId(id:number|BoxId):any {\r\n        let _id:number;\r\n        switch (typeof id) {\r\n            case 'object': _id = (id as BoxId).id; break;\r\n            case 'number': _id = id as number; break;\r\n            default: return;\r\n        }\r\n        return this.getValue(_id);\r\n    }\r\n\r\n    resetCache(id:number) {\r\n        this.remove(id);\r\n        this.useId(id);\r\n    }\r\n\r\n    cacheValue(val:any):boolean {\r\n        if (val === undefined) return false;\r\n        let id = this.getIdFromObj(val);\r\n        if (id === undefined) return false;\r\n        let index = this.waitingIds.findIndex(v => v === id);\r\n        if (index>=0) this.waitingIds.splice(index, 1);\r\n        this.cache.set(id, val);\r\n        return true;\r\n    }\r\n    protected getIdFromObj(val:any) {return this.tuidInner.getIdFromObj(val)}\r\n\r\n    async cacheIds():Promise<void> {\r\n        if (this.waitingIds.length === 0) return;\r\n\t\tlet tuidValues = await this.loadIds();\r\n\t\tif (tuidValues === undefined || tuidValues.length === 0) {\r\n\t\t\tthis.waitingIds.splice(0, this.waitingIds.length);\r\n\t\t\treturn;\r\n\t\t}\r\n        this.cacheIdValues(tuidValues);\r\n    }\r\n\r\n    private cacheIdValues(tuidValues: any[]) {\r\n        if (tuidValues === undefined) return;\r\n        let tuids = this.unpackTuidIds(tuidValues);\r\n        for (let tuidValue of tuids) {\r\n            if (this.cacheValue(tuidValue) === false) continue;\r\n            this.cacheTuidFieldValues(tuidValue);\r\n        }\r\n    }\r\n    async modifyIds(ids:any[]):Promise<void> {\r\n        let tuidValues:string[] = await this.loadTuidIdsOrLocal(ids);\r\n        let localedValues = tuidValues.filter(v => {\r\n            let p = v.indexOf('\\t');\r\n            if (p<0) p = v.length;\r\n            let id = Number(v.substr(0, p));\r\n            let val = this.localArr.getItem(id);\r\n            return (val !== undefined);\r\n        });\r\n        if (localedValues.length === 0) return;\r\n        this.cacheIdValues(localedValues);\r\n    }\r\n    protected divName:string = undefined;\r\n    protected async loadIds(): Promise<any[]> {\r\n\t\tif (this.loading === true) return;\r\n\t\tthis.loading = true;\r\n\t\tlet ret = await this.loadTuidIdsOrLocal(this.waitingIds);\r\n\t\tthis.loading = false;\r\n        return ret;\r\n    }\r\n    protected unpackTuidIds(values:string[]):any[] {\r\n        return this.tuidInner.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.tuidInner.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\r\n    async assureObj(id:number):Promise<void> {\r\n        let val = this.cache.get(id);\r\n        switch (typeof val) {\r\n            case 'object': return val;\r\n            case 'number': this.cache.set(id, id); break;\r\n        }\r\n        let ret = await this.loadTuidIdsOrLocal([id]);\r\n        this.cacheIdValues(ret);\r\n    }\r\n\r\n    private async loadTuidIdsOrLocal(ids:number[]):Promise<string[]> {\r\n        let ret:string[] = [];        \r\n        let netIds:number[] = [];\r\n        for (let id of ids) {\r\n            let value = this.localArr.getItem(id);\r\n            //if (value === undefined)\r\n            // 值不存在或者是空字符串，重新获取\r\n            if (!value)\r\n                netIds.push(id);\r\n            else\r\n                ret.push(value);\r\n        }\r\n        let len = netIds.length;\r\n        if (len > 0) {\r\n            let netRet = await this.tuidInner.loadTuidIds(this.divName, netIds);\r\n            for (let i=0; i<len; i++) {\r\n                //有些id可能没有内容，不会返回\r\n                //let id = netIds[i]; \r\n                let row:string = netRet[i];\r\n                if (!row) continue;\r\n                let p = row.indexOf('\\t');\r\n                if (p < 0) p = row.length;\r\n                let id = Number(row.substr(0, p));\r\n\t\t\t\t_.remove(netIds, v => v === id);\r\n                ret.push(row);\r\n                this.localArr.setItem(id, row);\r\n            }\r\n            len = netIds.length;\r\n            for (let i=0; i<len; i++) {\r\n                this.localArr.setItem(netIds[i], '');\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nexport class IdDivCache extends IdCache {\r\n    private div: TuidDiv;\r\n    protected divName:string;\r\n\r\n    constructor(tuidLocal:TuidInner, div: TuidDiv) {\r\n        super(tuidLocal);\r\n        this.div = div;\r\n        this.divName = div.name;\r\n        this.localArr = tuidLocal.cache.arr(tuidLocal.name + '.ids.' + this.divName);\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        // 这个不需要，必须去掉\r\n        // this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    protected getIdFromObj(val:any) {return this.div.getIdFromObj(val)}\r\n    protected unpackTuidIds(values:string[]):any[] {\r\n        return this.div.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.div.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\r\n    /*\r\n    async cacheIds():Promise<void> {\r\n        if (this.waitingIds.length === 0) return;\r\n        let tuidValues = await this.loadIds();\r\n        if (tuidValues !== undefined) {\r\n            let tuids = this.tuidLocal.unpackTuidIds(tuidValues);\r\n            for (let tuidValue of tuids) {\r\n                if (this.cacheValue(tuidValue) === false) continue;\r\n                this.tuidLocal.cacheTuidFieldValues(tuidValue);\r\n                this.afterCacheValue(tuidValue);\r\n            }\r\n        }\r\n    }\r\n    */\r\n}\r\n","import _ from 'lodash';\r\nimport { LocalArr } from '../../tool';\r\nimport { Entity } from '../entity';\r\nimport { UqMan, ArrFields, Field, SchemaFrom } from '../uqMan';\r\nimport { EntityCaller } from '../caller';\r\nimport { BoxId } from './boxId';\r\nimport { IdCache, IdDivCache } from './idCache';\r\n\r\nexport interface TuidSaveResult {\r\n    id: number;\r\n    inId: number;\r\n}\r\n\r\nexport interface TuidNOResult {\r\n\tdate: string;\r\n\tno: number;\r\n}\r\n\r\nexport abstract class UqTuid<M> extends Entity {\r\n    protected noCache: boolean;\r\n    readonly typeName:string = 'tuid';\r\n    protected idName: string;\r\n    cached: boolean;\r\n    unique: string[];\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {id} = schema;\r\n        this.idName = id;\r\n    }\r\n\r\n    buildTuidBox(): TuidBox {\r\n        return new TuidBox(this);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    stopCache():void {this.noCache = true}\r\n    abstract useId(id:number):void;\r\n    abstract boxId(id:number):BoxId;\r\n    abstract valueFromId(id:number):any;\r\n\tabstract resetCache(id:number|BoxId):void;\r\n\tabstract assureBox<T> (id:number|BoxId): Promise<T>;\r\n\tstatic idValue(id: {id:number}|number):number {\r\n\t\tswitch (typeof id) {\r\n\t\t\tdefault: debugger; throw new Error('unknown id');\r\n\t\t\tcase 'object': return id.id;\r\n\t\t\tcase 'number': return id;\r\n\t\t}\r\n\t}\r\n    static equ(id1:{id:number}|number, id2:{id:number}|number): boolean {\r\n        if (id1 === undefined || id1 === null) return false;\r\n\t\tif (id2 === undefined || id2 === null) return false;\r\n\t\treturn Tuid.idValue(id1) === Tuid.idValue(id2);\r\n\t\t/*\r\n        if (typeof id1 === 'object') {\r\n\t\t\tlet id1Id = id1.id;\r\n            return typeof id2 === 'object'? id1Id === id2.id : id1Id === id2;\r\n        }\r\n        if (typeof id2 === 'object') {\r\n\t\t\tlet id2Id = id2.id;\r\n            return typeof id1 === 'object'? id2Id === id1.id : id2Id === id1;\r\n        }\r\n\t\treturn id1 === id2;\r\n\t\t*/\r\n    }\r\n    cacheIds() {}\r\n    async modifyIds(ids:any[]) {}\r\n    isImport = false;\r\n    abstract get hasDiv():boolean;// {return this.divs!==undefined}\r\n    abstract div(name:string):TuidDiv;\r\n    abstract loadMain(id:number|BoxId):Promise<M>;\r\n\tabstract load(id:number|BoxId):Promise<M>;\r\n    abstract all():Promise<M[]>;\r\n\tabstract save(id:number, props:M):Promise<TuidSaveResult>;\r\n\tabstract saveProp(id:number, prop:string, value:any):Promise<void>;\r\n    abstract search(key:string, pageStart:string|number, pageSize:number):Promise<M[]>;\r\n    abstract searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any>;\r\n    abstract loadArr(arr:string, owner:number, id:number):Promise<any>;\r\n    abstract saveArr(arr:string, owner:number, id:number, props:any):Promise<void>;\r\n\tabstract posArr(arr:string, owner:number, id:number, order:number):Promise<void>;\r\n\tabstract no():Promise<TuidNOResult>;\r\n}\r\n\r\nexport abstract class Tuid extends UqTuid<any> {\r\n}\r\n\r\nexport class TuidInner extends Tuid {\r\n    private divs: {[div:string]: TuidDiv};\r\n    protected cacheFields: Field[];\r\n    protected idCache: IdCache;\r\n    protected localArr:LocalArr;\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        super(uq, name, typeId);\r\n        this.idCache = new IdCache(this);\r\n        this.localArr = this.cache.arr(this.name + '.whole');\r\n        if (uq.newVersion === true) this.localArr.removeAll();\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {arrs} = schema;\r\n        if (arrs !== undefined) {\r\n            this.divs = {};\r\n            for (let arr of arrs) {\r\n                let {name} = arr;\r\n                let tuidDiv = new TuidDiv(this.uq, this, name);\r\n                this.divs[name] = tuidDiv;\r\n                tuidDiv.setSchema(arr);\r\n                tuidDiv.buildFieldsTuid();\r\n            }\r\n        }\r\n    }\r\n    \r\n    useId(id:number, defer?:boolean) {\r\n        if (this.noCache === true) return;\r\n        if (!id) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n    boxId(id:number):BoxId {\r\n        if (!id) return;\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        let {createBoxId} = this.uq;\r\n        if (!createBoxId) return {id: id} as BoxId;\r\n        return createBoxId(this, id);\r\n    }\r\n    valueFromId(id:number) {return this.idCache.getValue(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tthis.idCache.resetCache(id);\r\n\t}\r\n    async assureBox<T> (id:number|BoxId):Promise<T> {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    cacheIds() {\r\n        this.idCache.cacheIds();\r\n        if (this.divs === undefined) return;\r\n        for (let i in this.divs) this.divs[i].cacheIds();\r\n    }\r\n    async modifyIds(ids:any[]) {\r\n        await this.idCache.modifyIds(ids);\r\n    }\r\n    cacheTuids(defer:number) {this.uq.cacheTuids(defer)}\r\n    get hasDiv():boolean {return this.divs!==undefined}\r\n    div(name:string):TuidDiv {\r\n        return this.divs && this.divs[name];\r\n    }\r\n    async loadTuidIds(divName:string, ids:number[]):Promise<any[]> {\r\n        let ret:any[] = await new IdsCaller(this, {divName:divName, ids:ids}, false).request();\r\n        if (ret.length > 0) this.cached = true;\r\n        return ret;\r\n    }\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        if (typeof id === 'object') id = id.id;\r\n        await this.idCache.assureObj(id);\r\n        return this.idCache.valueFromId(id);\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let cacheValue = this.idCache.valueFromId(id); \r\n        //if (typeof cacheValue === 'object') return cacheValue;\r\n        if (typeof id === 'object') id = id.id;\r\n        let valuesText = undefined; //this.localArr.getItem(id);\r\n        let values: any;\r\n        if (valuesText) {\r\n            values = JSON.parse(valuesText);\r\n        }\r\n        else {\r\n            values = await new GetCaller(this, id).request();\r\n            if (values !== undefined) {\r\n                // this.localArr.setItem(id, JSON.stringify(values));\r\n            }\r\n        }\r\n        if (values === undefined) return;\r\n        for (let f of this.schema.fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.uq.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            let n = f.name;\r\n            values[n] = t.boxId(values[n]);\r\n        }\r\n        this.idCache.cacheValue(values);\r\n        this.cacheTuidFieldValues(values);\r\n        return values;\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let {fields, arrs} = this.schema;\r\n        this.cacheFieldsInValue(values, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs as ArrFields[]) {\r\n                let {name, fields} = arr;\r\n                let arrValues = values[name];\r\n                if (arrValues === undefined) continue;\r\n                let tuidDiv = this.div(name);\r\n                for (let row of arrValues) {\r\n                    //row._$tuid = tuidDiv;\r\n                    //row.$owner = this.boxId(row.owner);\r\n                    tuidDiv.cacheValue(row);\r\n                    this.cacheFieldsInValue(row, fields);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields, $create, $update, stampOnMain} = this.schema;\r\n\t\tif (mainFields === undefined) debugger;\r\n\t\tthis.cacheFields = mainFields || this.fields;\r\n\t\tif (stampOnMain === true) {\r\n\t\t\tif ($create === true) this.cacheFields.push({name: '$create', type: 'timestamp', _tuid: undefined});\r\n\t\t\tif ($update === true) this.cacheFields.push({name: '$update', type: 'timestamp', _tuid: undefined});\r\n\t\t}\r\n        this.uq.buildFieldTuid(this.cacheFields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        let ret = await new SaveCaller(this, {id:id, props:props}).request();\r\n        if (id !== undefined) {\r\n            this.idCache.remove(id);\r\n            this.localArr.removeItem(id);\r\n        }\r\n        return ret;\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait new SavePropCaller(this, {id, prop, value}).request();\r\n\t\tthis.idCache.remove(id);\r\n\t\tawait this.idCache.assureObj(id);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        let ret: any[] = await new AllCaller(this, {}).request();\r\n        return ret;\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any[]> {\r\n        let ret:any[] = await this.searchArr(undefined, key, pageStart, pageSize);\r\n        return ret;\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        //let api = this.uqApi;\r\n        //let ret = await api.tuidSearch(this.name, undefined, owner, key, pageStart, pageSize);\r\n        let params:any = {arr:undefined, owner:owner, key:key, pageStart:pageStart, pageSize:pageSize};\r\n        let ret = await new SearchCaller(this, params).request();\r\n        let {fields} = this.schema;\r\n        for (let row of ret) {\r\n            this.cacheFieldsInValue(row, fields);\r\n        }\r\n        return ret;\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let api = this.uqApi;\r\n        //return await api.tuidArrGet(this.name, arr, owner, id);\r\n        return await new LoadArrCaller(this, {arr:arr, owner:owner, id:id}).request();\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any) {\r\n        //let params = _.clone(props);\r\n        //params[\"$id\"] = id;\r\n        //return await this.uqApi.tuidArrSave(this.name, arr, owner, params);\r\n        return await new SaveArrCaller(this, {arr:arr, owner:owner, id:id, props:props}).request();\r\n    }\r\n\r\n    async posArr(arr:string, owner:number, id:number, order:number) {\r\n        //return await this.uqApi.tuidArrPos(this.name, arr, owner, id, order);\r\n        return await new ArrPosCaller(this, {arr:arr, owner:owner, id:id, order:order}).request();\r\n\t}\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await new TuidNoCaller(this, undefined).request();\r\n\t}\r\n}\r\n\r\nabstract class TuidCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Tuid {return this._entity as Tuid};\r\n}\r\n\r\n// 包含main字段的load id\r\n// 当前为了兼容，先调用的包含所有字段的内容\r\nclass GetCaller extends TuidCaller<number> {\r\n    method = 'GET';\r\n    get path():string {return `tuid/${this.entity.name}/${this.params}`}\r\n}\r\n\r\nclass IdsCaller extends TuidCaller<{divName:string, ids:number[]}> {\r\n    get path():string {\r\n        let {divName} = this.params;\r\n        return `tuidids/${this.entity.name}/${divName !== undefined?divName:'$'}`;\r\n    }\r\n    buildParams():any {return this.params.ids}\r\n    xresult(res:any):any {\r\n        return (res as string).split('\\n');\r\n    }\r\n}\r\n\r\n\r\nclass SaveCaller extends TuidCaller<{id:number, props:any}> {\r\n    get path():string {return `tuid/${this.entity.name}`}\r\n    buildParams():any {\r\n        let {fields, arrs} = this.entity.schema;\r\n        let {id, props} = this.params;\r\n        let params:any = {$id: id};\r\n        this.transParams(params, props, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let arrName = arr.name;\r\n                let arrParams = [];\r\n                let arrFields = arr.fields;\r\n                let arrValues = props[arrName];\r\n                if (arrValues !== undefined) {\r\n                    for (let arrValue of arrValues) {\r\n                        let row = {};\r\n                        this.transParams(row, arrValue, arrFields);\r\n                        arrParams.push(row);\r\n                    }\r\n                }\r\n                params[arrName] = arrParams;\r\n            }\r\n        }\r\n        return params;\r\n    }\r\n    private transParams(values:any, params:any, fields:Field[]) {\r\n        if (params === undefined) return;\r\n        for (let field of fields) {\r\n            let {name, tuid, type} = field;\r\n            let val = params[name];\r\n            if (tuid !== undefined) {\r\n                if (typeof val === 'object') {\r\n                    if (val !== null) val = val.id;\r\n                }\r\n            }\r\n            else {\r\n                switch (type) {\r\n                    case 'date':\r\n                        val = this.entity.buildDateParam(val); \r\n                        //val = (val as string).replace('T', ' ');\r\n                        //val = (val as string).replace('Z', '');\r\n                        break;\r\n                    case 'datetime':\r\n                        val = this.entity.buildDateTimeParam(val);\r\n                        //val = new Date(val).toISOString();\r\n                        //val = (val as string).replace('T', ' ');\r\n                        //val = (val as string).replace('Z', '');\r\n                        break;\r\n                }\r\n            }\r\n            values[name] = val;\r\n        }\r\n    }\r\n}\r\n\r\nclass SearchCaller extends TuidCaller<{arr:string, owner:number, key:string, pageStart:string|number, pageSize:number}> {\r\n    get path():string {return `tuids/${this.entity.name}`}\r\n}\r\n\r\nclass AllCaller extends TuidCaller<{}> {\r\n    method = 'GET';\r\n    get path():string {return `tuid-all/${this.entity.name}`}\r\n}\r\n\r\nclass LoadArrCaller extends TuidCaller<{arr:string, owner:number, id:number}> {\r\n    method = 'GET';\r\n    get path():string {\r\n        let {arr, owner, id} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/${id}`;\r\n    }\r\n}\r\nclass SavePropCaller extends TuidCaller<{id:number, prop:string, value:any}> {\r\n    get path():string {return `tuid-prop/${this.entity.name}/`;}\r\n}\r\nclass SaveArrCaller extends TuidCaller<{arr:string, owner:number, id:number, props:any}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, props} = this.params;\r\n        let params = _.clone(props);\r\n        params['$id'] = id;\r\n        return params;\r\n    }\r\n}\r\nclass ArrPosCaller extends TuidCaller<{arr:string, owner:number, id:number, order:number}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr-pos/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, order} = this.params;\r\n        return { bid: id, $order: order}\r\n    }\r\n}\r\nclass TuidNoCaller extends TuidCaller<{}> {\r\n    get path():string {\r\n        return `tuid-no/${this.entity.name}/`;\r\n    }\r\n    buildParams():any {\r\n\t\tlet d = new Date();\r\n\t\tlet year = d.getFullYear();\r\n\t\tlet month = d.getMonth() + 1;\r\n\t\tlet date = d.getDate();\r\n        return {year, month, date};\r\n    }\r\n}\r\n\r\nexport class TuidImport extends Tuid {\r\n    private tuidLocal: TuidInner;\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number, from: SchemaFrom) {\r\n        super(uq, name, typeId);\r\n        this.from = from;\r\n    }\r\n\r\n    setFrom(tuidLocal: TuidInner) {this.tuidLocal = tuidLocal}\r\n    \r\n    readonly from: SchemaFrom;\r\n    isImport = true;\r\n\r\n    useId(id:number) {this.tuidLocal.useId(id);}\r\n    boxId(id:number):BoxId {return this.tuidLocal.boxId(id);}\r\n    valueFromId(id:number) {return this.tuidLocal.valueFromId(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tthis.tuidLocal.resetCache(id);\r\n\t}\r\n    async assureBox<T>(id:number):Promise<T> {\r\n        await this.tuidLocal.assureBox(id);\r\n\t\treturn this.tuidLocal.valueFromId(id);\r\n    }\r\n    get hasDiv():boolean {return this.tuidLocal.hasDiv}\r\n    div(name:string):TuidDiv {return this.tuidLocal.div(name)}\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        let ret = await this.tuidLocal.loadMain(id);\r\n        return ret;\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        return await this.tuidLocal.load(id);\r\n    }\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        return await this.tuidLocal.save(id, props);\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait this.tuidLocal.saveProp(id, prop, value);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        return await this.tuidLocal.all();\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.search(key, pageStart, pageSize);\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.searchArr(owner, key, pageStart, pageSize);\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        return await this.tuidLocal.loadArr(arr, owner, id);\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any):Promise<void> {\r\n        await this.tuidLocal.saveArr(arr, owner, id, props);\r\n    }\r\n    async posArr(arr:string, owner:number, id:number, order:number):Promise<void> {\r\n        await this.tuidLocal.posArr(arr, owner, id, order);\r\n    }\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await this.tuidLocal.no();\r\n\t}\r\n}\r\n\r\n// field._tuid 用这个接口\r\n// Tuid, TuidDiv 实现这个接口\r\nexport class TuidBox {\r\n    tuid: Tuid;\r\n    ownerField:Field = undefined;\r\n    constructor(tuid: Tuid) {\r\n        this.tuid = tuid;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.tuid.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.tuid.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.tuid.useId(id);\r\n    }\r\n    async showInfo() {\r\n        alert('showInfo not implemented');\r\n    }\r\n}\r\n\r\n\r\nexport class TuidDiv extends TuidInner /* Entity*/ {\r\n    readonly typeName:string = 'div';\r\n    protected cacheFields: Field[];\r\n    protected tuid: TuidInner;\r\n    protected idName: string;\r\n    protected idCache: IdDivCache;\r\n\r\n    //ui: React.StatelessComponent<any>;\r\n    //res: any;\r\n\r\n    constructor(uq: UqMan, tuid: TuidInner, name: string) {\r\n        super(uq, name, 0);\r\n        this.tuid = tuid;\r\n        this.idName = 'id';\r\n        this.idCache = new IdDivCache(tuid, this);\r\n    }\r\n\r\n    get owner() {return this.tuid}\r\n\r\n    /*\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.buildFieldsTuid();\r\n    }*/\r\n\r\n    /*\r\n    setUIRes(ui:any, res:any) {\r\n        this.ui = ui && ui.content;\r\n        this.res = res;\r\n    }\r\n    */\r\n\r\n    buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields} = this.schema;\r\n        if (mainFields === undefined) debugger;\r\n        this.uq.buildFieldTuid(this.cacheFields = mainFields);\r\n    }\r\n\r\n    buildTuidDivBox(ownerField: Field): TuidBoxDiv {\r\n        return new TuidBoxDiv(this.tuid, this, ownerField);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    cacheValue(value:any):void {\r\n        this.idCache.cacheValue(value);\r\n    }\r\n\r\n    useId(id:number, defer?:boolean):void {\r\n        if (this.noCache === true) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n\r\n    /*\r\n    boxId(id:number):BoxId {\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        //return new BoxDivId(this.tuid, this, id);\r\n        return this.tuid.boxDivId(this, id);\r\n    }\r\n    */\r\n    valueFromId(id:number):any {\r\n        return this.idCache.getValue(id)\r\n    }\r\n\r\n    async assureBox<T>(id:number):Promise<T> {\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    async cacheIds() {\r\n        await this.idCache.cacheIds();\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let fields = this.schema.fields;\r\n        this.cacheFieldsInValue(values, fields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n}\r\n\r\nexport class TuidBoxDiv extends TuidBox {\r\n    ownerField: Field;\r\n    private div: TuidDiv;\r\n    constructor(tuid: Tuid, div: TuidDiv, ownerField: Field) {\r\n        super(tuid);\r\n        this.div = div;\r\n        this.ownerField = ownerField;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.div.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.div.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.div.useId(id);\r\n    }\r\n}\r\n","import {appInFrame, CenterApiBase} from 'tonva';\r\n\r\nclass MainApi extends CenterApiBase {\r\n    async userAppUnits(app:number):Promise<any[]> {\r\n        return await this.get('tie/user-app-units', {app:app});\r\n    }\r\n    async stickies():Promise<any[]> {\r\n        return await this.get('sticky/list', {start:0, pageSize:30});\r\n    }\r\n\r\n    async ties():Promise<any[]> {\r\n        return await this.get('tie/list', {start:0, pageSize:30});\r\n    }\r\n\r\n    async apps(unit:number):Promise<any> {\r\n        return await this.get('tie/apps', {unit:unit});\r\n    }\r\n\r\n    async appApi(unit:number, app:number, apiName:string) {\r\n        return await this.get('tie/app-api', {unit:unit, app:app, apiName:apiName});\r\n    }\r\n\r\n    async userId(name:string):Promise<number> {\r\n        return await this.get('tie/user-id', {name:name});\r\n    }\r\n\r\n    async user(id:number):Promise<any> {\r\n        return await this.get('tie/user', {id:id});\r\n    }\r\n\r\n    async userUnitAdmins():Promise<any[]> {\r\n        return await this.get('tie/user-admin-units', {});\r\n    }\r\n\r\n    async sendMessage(toUser:number, type:string, content:any) {\r\n        let {unit} = appInFrame;\r\n        let adminApp = 0;\r\n        return await this.post('tie/send-message', {\r\n            type: type, \r\n            fromUnit: unit, \r\n            fromApp: adminApp,\r\n            toUser: toUser, \r\n            content: content, \r\n        });\r\n    }\r\n\r\n    async unit(unit:number):Promise<any> {\r\n        return await this.get('unit/', {unit:unit});\r\n    }\r\n\r\n    async unitMemberCount(unit:number):Promise<number> {\r\n        return await this.get('unit/member-count', {unit:unit});\r\n    }\r\n\r\n    async unitAdmins(unit:number):Promise<any[]> {\r\n        return await this.get('unit/admins', {unit:unit});\r\n    }\r\n\r\n    async unitAppAdmins(unit:number, app:number):Promise<any[]> {\r\n        return await this.get('unit/app-admins', {unit:unit, app:app});\r\n    }\r\n\r\n    async unitSetAdmin(fellow:number, unit:number, isOwner:number, isAdmin:number, isDev:number):Promise<any> {\r\n        return await this.post('unit/set-admin', {fellow:fellow, unit:unit, isOwner:isOwner, isAdmin:isAdmin, isDev:isDev});\r\n    }\r\n\r\n    async unitAddAdmin(user:string, unit:number, isOwner:number, isAdmin:number, isDev:number):Promise<any> {\r\n        return await this.post('unit/add-admin', {user:user, unit:unit, isOwner:isOwner, isAdmin:isAdmin, isDev});\r\n    }\r\n\r\n    async unitDelAdmin(unit:number, user:number):Promise<any> {\r\n        return await this.post('unit/del-admin', {user:user, unit:unit});\r\n    }\r\n\r\n    async adminDevs(unit:number):Promise<any[][]> {\r\n        return await this.get('unit/admin-devs', {unit:unit});\r\n    }\r\n\r\n    async addDev(unit:number, dev:string):Promise<any> {\r\n        return await this.post('unit/add-dev', {unit:unit, dev:dev})\r\n    }\r\n\r\n    async delDev(unit:number, dev:number):Promise<string> {\r\n        return await this.post('unit/del-dev', {unit:unit, dev:dev})\r\n    }\r\n\r\n    async unitApps(unit:number):Promise<any[]> {\r\n        return await this.get('unit/apps', {unit:unit});\r\n    }\r\n\r\n    async unitAddApp(unit:number, app:number):Promise<number> {\r\n        let ret = await this.post('unit/add-app', {unit:unit, app:app});\r\n        return ret;\r\n    }\r\n\r\n    async unitDeleteApp(unit:number, app:number, deleted:number):Promise<void> {\r\n        await this.post('unit/delete-app', {unit:unit, app:app, deleted:deleted});\r\n    }\r\n\r\n    async unitChangeProp(unit:number, prop:string, value:any):Promise<void> {\r\n        await this.post('unit/change-prop', {unit:unit, prop:prop, value:value});\r\n    }\r\n\r\n    async searchApp(unit:number, key:string, pageStart:any, pageSize:number):Promise<any[]> {\r\n        return await this.get('unit/search-app', {unit:unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n\r\n    async unitRoles(unit:number):Promise<any[]> {\r\n        return await this.get('unit/roles', {unit:unit});\r\n    }\r\n\r\n    async unitAddRole(unit:number, name:string, discription:string):Promise<number> {\r\n        return await this.post('unit/add-role', {unit:unit, name:name, discription:discription});\r\n    }\r\n\r\n    async unitRoleChangeProp(unit:number, role:number, prop:string, value:any):Promise<void> {\r\n        await this.post('unit/change-role-prop', {unit:unit, role:role, prop:prop, value:value});\r\n    }\r\n\r\n    async unitRoleApps(unit:number, role:number):Promise<any[]> {\r\n        return await this.get('unit/role-apps', {unit:unit, role:role});\r\n    }\r\n\r\n    async unitRoleSetApps(unit:number, role:number, apps:number[]):Promise<void> {\r\n        await this.post('unit/role-set-apps', {unit:unit, role:role, apps:apps});\r\n    }\r\n\r\n    async unitMembers(unit:number, role:number, key:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        return await this.get('unit/members', {unit:unit, role:role, key, pageStart, pageSize});\r\n    }\r\n\r\n    async unitAssignMember(unit:number, member:number, assigned:string):Promise<void> {\r\n        await this.post('unit/assign-member', {unit:unit, member:member, assigned:assigned});\r\n    }\r\n\r\n    async unitMemberRoles(unit:number, member:number):Promise<any[]> {\r\n        return await this.get('unit/member-roles', {unit:unit, member:member});\r\n    }\r\n\r\n    async unitSetMemberRoles(unit:number, member:number, roles:number[]):Promise<void> {\r\n        await this.post('unit/member-set-roles', {unit:unit, member:member, roles:roles});\r\n    }\r\n\r\n    async unitUsers(unit:number, key:string, pageStart:number, pageSize:number):Promise<any> {\r\n        return await this.get('unit/users', {unit: unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async unitAppUsers(unit:number, key:string, pageStart:number, pageSize:number):Promise<any> {\r\n        return await this.get('unit/app-users', {unit: unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async unitOneAppUsers(unit:number, app:number, pageStart:number, pageSize:number):Promise<any[]> {\r\n        return await this.get('unit/one-app-users', {unit: unit, app:app, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async unitOneUserApps(unit:number, user:number, pageStart:number, pageSize:number):Promise<any[]> {\r\n        return await this.get('unit/one-user-apps', {unit: unit, user:user, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async unitAppEditUsers(unit:number, app:number, key:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        return await this.get('unit/app-edit-users', {unit: unit, app:app, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async unitUserEditApps(unit:number, user:number, key:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        return await this.get('unit/user-edit-apps', {unit: unit, user:user, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async bindAppUser(unit:number, app:number, user:number, bind:number):Promise<void> {\r\n        await this.post('unit/bind-app-user', {unit: unit, app:app, user:user, bind:bind});\r\n    }\r\n\r\n    async userFromKey(key:string):Promise<any> {\r\n        return await this.get('tie/user-from-key', {key:key});\r\n    }\r\n    async unitAddUser(unit:number, user:number) {\r\n        await this.post('unit/add-user', {unit:unit, user:user});\r\n    }\r\n\r\n    async setAppAdmin(unit:number, app:number, user:number, name:string, isAdmin:number):Promise<any> {\r\n        return await this.post('unit/set-app-admin', {unit:unit, app:app, user:user, name:name, isAdmin:isAdmin});\r\n    }\r\n\r\n    async setAppRoles(unit:number, app:number, user:number, name:string, roles:number):Promise<any> {\r\n        return await this.post('unit/set-app-roles', {unit:unit, app:app, user:user, name:name, roles:roles});\r\n    }\r\n}\r\n\r\nexport const mainApi = new MainApi('tv/', true);\r\n","import {CenterApiBase} from 'tonva';\r\n\r\nclass DevApi extends CenterApiBase {\r\n    async userAppUnits(app:number):Promise<any[]> {\r\n        return await this.get('tie/user-app-units', {app:app});\r\n    }\r\n    async uqBuilderUrl():Promise<any> {\r\n        let ret = await this.get('uq-builder-url', undefined);\r\n        return ret;\r\n    }    \r\n    async counts(unit:number):Promise<any> {\r\n        return await this.get('counts', {unit:unit});\r\n    }\r\n    async app(id:number):Promise<any> {\r\n        return await this.get('app', {id:id});\r\n    }\r\n    async bus(id:number):Promise<any> {\r\n        let ret = await this.get('bus', {id:id});\r\n\t\tlet {schema, source} = ret;\r\n\t\tif (!source) ret.source = schema;\r\n\t\treturn ret;\r\n    }\r\n    async uq(id:number):Promise<any> {\r\n        return await this.get('uq', {id:id});\r\n    }\r\n    async server(id:number):Promise<any> {\r\n        return await this.get('server', {id:id});\r\n    }\r\n    async apps(unit:number, pageSize:number=30):Promise<any[]> {\r\n        return await this.get('apps', {unit:unit, pageSize: pageSize});\r\n    }\r\n    async uqs(unit:number, pageSize:number=30):Promise<any[]> {\r\n        return await this.get('uqs', {unit, pageSize});\r\n    }\r\n    async unitUQs(unit:number, pageSize:number=30):Promise<any[]> {\r\n        return await this.get('unit-uqs', {unit, pageSize});\r\n    }\r\n    async buses(unit:number, pageSize:number=30):Promise<any[]> {\r\n        return await this.get('buses', {unit:unit, pageSize: pageSize});\r\n    }\r\n    async servers(unit:number, pageSize:number=30):Promise<any[]> {\r\n        return await this.get('servers', {unit:unit, pageSize: pageSize});\r\n    }\r\n    async services(unit:number, pageSize:number=30):Promise<any[]> {\r\n        return await this.get('services', {unit:unit, pageSize: pageSize});\r\n    }\r\n    async saveApp(values:any):Promise<number> {\r\n        return await this.post('app-save', values);\r\n    }\r\n    async saveUq(values:any):Promise<number> {\r\n        return await this.post('uq-save', values);\r\n    }\r\n    async saveBus(values:any):Promise<number> {\r\n        return await this.post('bus-save', values);\r\n    }\r\n    async saveServer(values:any):Promise<number> {\r\n        return await this.post('server-save', values);\r\n    }\r\n    async saveService(values:any):Promise<number> {\r\n        return await this.post('service-save', values);\r\n    }\r\n    async delApp(unit:number,id:number):Promise<void> {\r\n        return await this.post('app-del', {unit:unit, id:id});\r\n    }\r\n    async delUq(unit:number,id:number):Promise<void> {\r\n        return await this.post('uq-del', {unit:unit, id:id});\r\n    }\r\n    async delBus(unit:number,id:number):Promise<void> {\r\n        return await this.post('bus-del', {unit:unit, id:id});\r\n    }\r\n    async delServer(unit:number,id:number):Promise<void> {\r\n        return await this.post('server-del', {unit:unit, id:id});\r\n    }\r\n    async delUqdb(unit:number,id:number):Promise<void> {\r\n        return await this.post('uqdb-del', {unit:unit, id:id});\r\n    }\r\n    async delService(unit:number,id:number):Promise<void> {\r\n        return await this.post('service-del', {unit:unit, id:id});\r\n    }\r\n    async loadAppUqs(app:number):Promise<any[]> {\r\n        return await this.get('app-uqs', {app: app});\r\n    }\r\n    async appBindUq(unit:number,app:number,uqs:number[]):Promise<void> {\r\n        let uqsText = uqs.join(';');\r\n        await this.post('app-bind-uq', {unit:unit, app:app, uqs:uqsText});\r\n    }\r\n    async appSetUqMain(unit:number, app:number, uq:number): Promise<void> {\r\n        await this.post('app-set-uq-main', {unit:unit, app:app, uq:uq});\r\n    }\r\n    async searchUq(unit:number,key:string,pageStart:number,pageSize:number):Promise<any[]> {\r\n        return await this.get('uq-search', {unit:unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async getMyUqs(unit:number):Promise<any[]> {\r\n        return await this.get('my-uqs', {unit:unit});\r\n    }\r\n    async searchApp(unit:number,key:string,pageStart:number,pageSize:number):Promise<any[]> {\r\n        return await this.get('app-search', {unit:unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async searchServer(unit:number,key:string,pageStart:number,pageSize:number):Promise<any[]> {\r\n        return await this.get('server-search', {unit:unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async searchUqdb(unit:number,key:string,pageStart:number,pageSize:number):Promise<any[]> {\r\n        return await this.get('uqdb-search', {unit:unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async loadUqServices(unit:number, uq:number):Promise<any[]> {\r\n        return await this.get('uq-services', {unit:unit, uq:uq});\r\n    }\r\n    async changeServiceProp(unit:number, service:number, prop:string, value:any):Promise<number> {\r\n        return await this.post('service-change-prop', {unit:unit, service:service, prop:prop, value:value});\r\n    }\r\n    async uqGetEntities(unit:number, uq:number):Promise<any[][]> {\r\n        return await this.get('uq-get-entities', {unit:unit, uq:uq});\r\n    }\r\n    async adminDevAdd(param: {unit:number, type:string, dev:number, devUser:number}):Promise<void> {\r\n        await this.post('admin-dev-add', param);\r\n    }\r\n    async adminDevDel(param: {unit:number, type:string, dev:number, devUser:number}):Promise<void> {\r\n        await this.post('admin-dev-del', param);\r\n    }\r\n}\r\n\r\nexport const devApi = new DevApi('tv/dev/', true);\r\n","import {CacheIds, User} from 'tonva';\r\nimport {Unit, DevUQ, DevApp, DevBus, DevServer} from '../model';\r\nimport {mainApi, devApi} from '../api';\r\n\r\nclass CacheUnits extends CacheIds<Unit> {\r\n    protected async _loadIds(ids:number[]):Promise<Unit[]> {\r\n        return;\r\n    }\r\n    protected async _loadId(id:number):Promise<Unit> {\r\n        return await mainApi.unit(id);\r\n    }\r\n}\r\n\r\nclass CacheUqs extends CacheIds<DevUQ> {\r\n    protected async _loadIds(ids:number[]):Promise<DevUQ[]> {\r\n        return;\r\n    }\r\n    protected async _loadId(id:number):Promise<DevUQ> {\r\n        return await devApi.uq(id);\r\n    }\r\n}\r\n\r\nclass CacheApps extends CacheIds<DevApp> {\r\n    protected async _loadIds(ids:number[]):Promise<DevApp[]> {\r\n        return;\r\n    }\r\n    protected async _loadId(id:number):Promise<DevApp> {\r\n        return await devApi.app(id);\r\n    }\r\n}\r\n\r\nclass CacheBuses extends CacheIds<DevBus> {\r\n    protected async _loadIds(ids:number[]):Promise<DevBus[]> {\r\n        return;\r\n    }\r\n    protected async _loadId(id:number):Promise<DevBus> {\r\n        let ret = await devApi.bus(id);\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass CacheUsers extends CacheIds<User> {\r\n    protected async _loadIds(ids:number[]):Promise<User[]> {\r\n        return;\r\n    }\r\n    protected async _loadId(id:number):Promise<User> {\r\n        let ret = await mainApi.user(id);\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass CacheServers extends CacheIds<DevServer> {\r\n    protected async _loadIds(ids:number[]):Promise<DevServer[]> {\r\n        return;\r\n    }\r\n    protected async _loadId(id:number):Promise<DevServer> {\r\n        return await devApi.server(id);\r\n    }\r\n}\r\n\r\nclass Caches {\r\n    units: CacheUnits;\r\n    uqs: CacheUqs;\r\n    apps: CacheApps;\r\n    buses: CacheBuses;\r\n    servers: CacheServers;\r\n    users: CacheUsers;\r\n\r\n    constructor() {\r\n        this.reset();\r\n    }\r\n\r\n    reset() {\r\n        this.units = new CacheUnits();\r\n        this.uqs = new CacheUqs();\r\n        this.apps = new CacheApps();\r\n        this.buses = new CacheBuses();\r\n        this.servers = new CacheServers();\r\n        this.users = new CacheUsers();\r\n    }\r\n};\r\n\r\nexport const caches:Caches = new Caches();\r\n","import { observable } from 'mobx';\r\nimport _ from 'lodash';\r\nimport { devApi } from '../api';\r\nimport { Store } from './store';\r\nimport { DevObjBase, DevApp, DevUQ, DevBus, DevServer, DevService } from 'model';\r\n\r\ninterface Counts {\r\n    uq: number;\r\n    app: number;\r\n    bus: number;\r\n    server: number;\r\n    service: number;\r\n    //uqdb: number;\r\n}\r\n\r\nexport abstract class ObjItems<T extends DevObjBase> {\r\n    protected store: Store;\r\n    protected dev: Dev;\r\n    constructor(store: Store, dev: Dev) {\r\n        this.store = store;\r\n        this.dev = dev;\r\n    }\r\n\r\n    @observable items: T[] = undefined;\r\n    @observable cur: T = undefined;\r\n\r\n    async load(): Promise<void> {\r\n        let ret = await this._load();\r\n        this.items = ret;\r\n    }\r\n    protected abstract _load(): Promise<T[]>;\r\n    async saveCur(item: T): Promise<boolean> {\r\n        let values: any = {};\r\n        if (this.cur !== undefined) {\r\n            _.assign(values, this.cur, item);\r\n        }\r\n        else {\r\n            _.assign(values, item);\r\n        }\r\n\r\n        values.unit = item.unit = this.store.unit.id;\r\n        let id = await this._save(values);\r\n        if (this.cur === undefined) {\r\n            if (id === 0) return false;\r\n            values.id = id;\r\n            if (this.items !== undefined) this.items.unshift(values);\r\n            this._inc();\r\n            this.cur = observable(values);\r\n        }\r\n        else {\r\n            _.assign(this.cur, values);\r\n        }\r\n        return true;\r\n    }\r\n    async check(item: T): Promise<boolean> {\r\n        return true;\r\n    }\r\n    async save(item: T): Promise<T> {\r\n        let values: any = {};\r\n        _.assign(values, item);\r\n\r\n        values.unit = item.unit = this.store.unit.id;\r\n        let id = await this._save(values);\r\n        if (id === 0) return;\r\n        values.id = id;\r\n        return values;\r\n    }\r\n    protected abstract _save(item: T): Promise<number>;\r\n    async del(): Promise<void> {\r\n        let c = this.cur;\r\n        if (c === undefined) return;\r\n        let id = c.id;\r\n        await this._del(c);\r\n        if (this.items === undefined) return;\r\n        let index = this.items.findIndex(v => v.id === id);\r\n        if (index >= 0) {\r\n            this.items.splice(index, 1);\r\n            this._dec();\r\n        }\r\n    }\r\n    protected abstract _del(item: T): Promise<void>;\r\n    protected abstract _inc();\r\n    protected abstract _dec();\r\n}\r\n\r\nclass Apps extends ObjItems<DevApp> {\r\n    @observable uqs: DevUQ[] = undefined;\r\n    @observable searchedUqs: DevUQ[] = undefined;\r\n    //@observable service: Service = null;\r\n    protected async _load() {\r\n        return await devApi.apps(this.store.unit.id);\r\n    }\r\n    protected async _save(item: DevApp): Promise<number> {\r\n        return await devApi.saveApp(item);\r\n    }\r\n    protected async _del(item: DevApp): Promise<void> {\r\n        await devApi.delApp(this.store.unit.id, item.id);\r\n    }\r\n    protected _inc() { this.dev.counts.app++; }\r\n    protected _dec() { this.dev.counts.app--; }\r\n\r\n    public async loadCurUqs() {\r\n        let ret = await devApi.loadAppUqs(this.cur.id);\r\n        this.uqs = ret;\r\n    }\r\n    public async searchUq(key: string) {\r\n        this.searchedUqs = await devApi.searchUq(this.store.unit.id, key, 0, searchPageSize);\r\n    }\r\n    /*\r\n    public async appBindUq(uqIds:number[]) {\r\n        let allUqs:{id:number}[] = this.uqs.map(v => {return {id: v.id};});\r\n        for (let id of uqIds) {\r\n            let index = allUqs.findIndex(v => v.id === id);\r\n            if (index < 0) allUqs.unshift({id: id});\r\n        }\r\n        await devApi.appBindUq(this.store.unit.id, this.cur.id, allUqs);\r\n        for (let id of uqIds) {\r\n            let index = this.uqs.findIndex(a => a.id === id);\r\n            if (index>=0) this.uqs.splice(index, 1);\r\n            if (this.searchedUqs !== undefined) {\r\n                let find = this.searchedUqs.find(a => a.id === id);\r\n                if (find !== undefined) this.uqs.unshift(find);\r\n            }\r\n        }\r\n    }\r\n    async appRemoveUq(removeUqIds:number[]):Promise<void> {\r\n        let uqs:{id:number}[] = [];\r\n        for (let uq of this.uqs) {\r\n            if (removeUqIds.findIndex(v => v === uq.id)>=0) continue;\r\n            uqs.push({id: uq.id});\r\n        }\r\n        await devApi.appBindUq(this.store.unit.id, this.cur.id, uqs);\r\n        for (let removeUqId of removeUqIds) {\r\n            let index = this.uqs.findIndex((v:UQ) => v.id === removeUqId);\r\n            if (index < 0) continue;\r\n            this.uqs.splice(index, 1);\r\n        };\r\n    }\r\n    */\r\n}\r\n\r\nclass Uqs extends ObjItems<DevUQ> {\r\n    protected async _load() {\r\n        let ret = await devApi.uqs(this.store.unit.id);\r\n        return ret;\r\n    }\r\n    protected async _save(item: DevUQ): Promise<number> {\r\n        //let {access} = item;\r\n        //if (!access) access = \"*';\r\n        //let parts = access.split(',').map(v => v.trim()).filter(v => v!=='');\r\n        //item.access = parts.join(',');\r\n        return await devApi.saveUq(item);\r\n    }\r\n    protected async _del(item: DevUQ): Promise<void> {\r\n        await devApi.delUq(this.store.unit.id, item.id);\r\n    }\r\n    protected _inc() { this.dev.counts.uq++; }\r\n    protected _dec() { this.dev.counts.uq--; }\r\n}\r\n\r\nclass Buses extends ObjItems<DevBus> {\r\n    protected async _load() {\r\n        let ret = await devApi.buses(this.store.unit.id);\r\n        for (let item of ret) {\r\n            let { schema, source } = item;\r\n            if (!source) item.source = schema;\r\n        }\r\n        return ret;\r\n    }\r\n    protected async _save(item: DevBus): Promise<number> {\r\n        return await devApi.saveBus(item);\r\n    }\r\n    protected async _del(item: DevBus): Promise<void> {\r\n        await devApi.delBus(this.store.unit.id, item.id);\r\n    }\r\n    protected _inc() { this.dev.counts.bus++; }\r\n    protected _dec() { this.dev.counts.bus--; }\r\n    private checkBusName(item: DevBus, busName: string): boolean {\r\n        let parts = busName.split('/');\r\n        switch (parts.length) {\r\n            default:\r\n                alert(`'${busName}'不符合bus名称的格式: 所有者/名称`);\r\n                return false;\r\n            case 1:\r\n                if (parts[0].toLowerCase() !== item.name) {\r\n                    alert(`$prop '${busName}' in schema 应该跟名称一致`);\r\n                    return false;\r\n                }\r\n                break;\r\n            case 2:\r\n                if (parts[0].toLowerCase() !== this.store.unit.name.toLowerCase()\r\n                    || parts[1].toLowerCase() !== item.name.toLowerCase()) {\r\n                    alert(`$prop '${busName}' in schema 应该跟 所有者/名称 一致`);\r\n                    return false;\r\n                }\r\n                break;\r\n        }\r\n        return true;\r\n    }\r\n    async check(item: DevBus): Promise<boolean> {\r\n        let { source } = item;\r\n        try {\r\n            let bus = JSON.parse(source);\r\n            for (let i in bus) {\r\n                let face = bus[i];\r\n                if (face === null || face === undefined) {\r\n                    alert(`face ${i} is null，请设置内容`);\r\n                    return false;\r\n                }\r\n                switch (typeof face) {\r\n                    case 'object': break;\r\n                    case 'string':\r\n                        if (i === '$') {\r\n                            if (this.checkBusName(item, face) === false) return false;\r\n                        }\r\n                        delete bus[i];\r\n                        continue;\r\n                    default:\r\n                        delete bus[i];\r\n                        continue;\r\n                    /*\r\n                    case 'function':\r\n                        alert(`face ${i} is function，不接受function`);\r\n                        return false;\r\n                    //case 'bigint':\r\n                    case 'boolean':\r\n                    case 'number':\r\n                        alert(`face ${i} 应该是数组或者对象`);\r\n                        return false;\r\n                    */\r\n                }\r\n                if (Array.isArray(face) === true) {\r\n                    if (checkBusFace(face, bus) === false) return false;\r\n                }\r\n                else {\r\n                    if (checkBusQuery(face, bus) === false) return false;\r\n                }\r\n            }\r\n            for (let i in bus) {\r\n                let face = bus[i];\r\n                if (!face) continue;\r\n                if (faceReplaceStringWithFace(face, bus, []) === false) {\r\n                    alert(`face ${i} 包含了循环引用`);\r\n                    return false;\r\n                };\r\n            }\r\n            item.schema = JSON.stringify(bus);\r\n            if (!item.owner) {\r\n                item.owner = this.store.unit.name;\r\n            }\r\n            return true;\r\n        }\r\n        catch (err) {\r\n            alert((err as any).message);\r\n            return false;\r\n        }\r\n    }\r\n}\r\n\r\nconst paramTypes = ['id', 'number', 'string'];\r\nconst busTypes = [...paramTypes, 'array'];\r\nfunction refNameOk(faceName: string, bus: any): boolean {\r\n    let face = bus[faceName];\r\n    if (face === undefined) {\r\n        alert(`face ${faceName} not defined`);\r\n        return false;\r\n    }\r\n    if (Array.isArray(face) === false) {\r\n        alert(`face ${faceName} is referenced, bus is not array`);\r\n        return false;\r\n    }\r\n    return true;\r\n    //return refArrayOk(face as any[], bus);\r\n}\r\n\r\nfunction refArrayOk(items: any[], bus: any): boolean {\r\n    for (let item of items) {\r\n        let type: string;\r\n        if (typeof item === 'string') {\r\n            let pos = item.indexOf(':');\r\n            if (pos <= 0) {\r\n                alert('type is not defined');\r\n                return false;\r\n            }\r\n            type = item.substr(pos + 1).trim();\r\n        }\r\n        else {\r\n            type = item.type;\r\n        }\r\n        if (['id', 'string', 'number', 'array'].indexOf(type) < 0) {\r\n            alert(`type ${type} out of ['id', 'string', 'number', 'array']`);\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction faceReplaceStringWithFace(face: any[], bus: any, arr: any[]): boolean {\r\n    let len = face.length;\r\n    let hasFaceReplace: boolean = false;\r\n    let newFace = [];\r\n    for (let i = 0; i < len; i++) {\r\n        let field = face[i];\r\n        if (typeof field !== 'string') {\r\n            pushFaceField(newFace, field);\r\n            continue;\r\n        }\r\n        hasFaceReplace = true;\r\n        let faceFromName = bus[field];\r\n        if (!faceFromName) continue;\r\n        if (arr.findIndex(v => v === faceFromName) >= 0) return false;\r\n        if (faceReplaceStringWithFace(faceFromName, bus, [face]) === false) return false;\r\n        for (let f of faceFromName) {\r\n            pushFaceField(newFace, f);\r\n        }\r\n    }\r\n    if (hasFaceReplace === true) {\r\n        face.splice(0, face.length, ...newFace);\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction pushFaceField(face: any[], field: any) {\r\n    for (let f of face) {\r\n        let { name: fn } = f;\r\n        let { name, type } = field;\r\n        if (fn.toLowerCase() === name.toLowerCase()) {\r\n            f.type = type;\r\n            return;\r\n        }\r\n    }\r\n    face.push(field);\r\n}\r\n\r\nfunction parseField(str: string): object | string | undefined {\r\n    if (str === undefined) return undefined;\r\n    let p = str.indexOf('--');\r\n    if (p >= 0) {\r\n        str = str.substr(0, p);\r\n    }\r\n    str = str.trim();\r\n    if (str.length === 0) return undefined;\r\n    let parts = str.split(':');\r\n    let len = parts.length;\r\n    if (len === 0) return undefined;\r\n    if (len === 1) return str;\r\n    //\"detail: order-detail -- { name: detail, type: array, fields: order-detail }\"\r\n    let name = parts[0].trim();\r\n    let type = parts[1].trim();\r\n    if (name.length === 0) return undefined;\r\n    let fields: string = undefined;\r\n    switch (type) {\r\n        default:\r\n            fields = type;\r\n            type = 'array';\r\n            break;\r\n        case 'id':\r\n        case 'number':\r\n        case 'string': break;\r\n    }\r\n    return { name, type, fields };\r\n}\r\n\r\nfunction checkBusFace(face: any[], bus: any): boolean {\r\n    if (Array.isArray(face) === false) {\r\n        alert('face must be array');\r\n        return false;\r\n    }\r\n    let len = face.length;\r\n    let delArr: number[] = [];\r\n    for (let i = 0; i < len; i++) {\r\n        let field = face[i];\r\n        switch (typeof field) {\r\n            default:\r\n                alert('face中的项，只能是object或者字符串');\r\n                return false;\r\n            case 'object':\r\n                if (field['-']) delete field['-'];\r\n                if (field['--']) delete field['--'];\r\n                break;\r\n            case 'string':\r\n                let parsed = parseField(field);\r\n                if (parsed === undefined) {\r\n                    delArr.push(i);\r\n                    continue;\r\n                }\r\n                if (typeof parsed === 'string') {\r\n                    let faceFromName = bus[parsed];\r\n                    if (!faceFromName) {\r\n                        alert(`'${field}' 没有定义`);\r\n                        return false;\r\n                    }\r\n                    face.splice(i, 1, parsed);\r\n                    continue;\r\n                }\r\n                field = parsed;\r\n                face.splice(i, 1, parsed);\r\n                break;\r\n        }\r\n        let { type } = field;\r\n        if (type === undefined) {\r\n            alert('type not defined');\r\n            return false;\r\n        }\r\n        if (type === 'array') {\r\n            let { fields } = field;\r\n            if (refNameOk(fields, bus) === false) {\r\n                return false;\r\n            }\r\n        }\r\n        if (busTypes.indexOf(type) < 0) {\r\n            if (type === 'date') {\r\n                alert('不再支持数据类型date，请用number unixtime作为媒介')\r\n            }\r\n            else {\r\n                alert(`不支持数据类型 ${type}`);\r\n            }\r\n            return false;\r\n        }\r\n    }\r\n    len = delArr.length;\r\n    for (let i = len - 1; i >= 0; i--) {\r\n        face.splice(delArr[i], 1);\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction checkBusQuery(face: any, bus: any): boolean {\r\n    for (let i in face) {\r\n        let item = face[i];\r\n        switch (i) {\r\n            default:\r\n                alert(i + ': not allowed in bus query.');\r\n                return false;\r\n            case 'param':\r\n                if (checkBusQueryParam(item, bus) === false) return false;\r\n                break;\r\n            case 'returns':\r\n                let returns = item;\r\n                if (typeof item === 'string') {\r\n                    returns = bus[item];\r\n                    if (returns === undefined) {\r\n                        alert(item + ' is not defined');\r\n                        return false;\r\n                    }\r\n                    bus.returns = returns;\r\n                }\r\n                if (checkBusFace(returns, bus) === false) return false;\r\n                break;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction checkBusQueryParam(param: any, bus: any): boolean {\r\n    if (param === null || param === undefined) return true;\r\n    switch (typeof param) {\r\n        case 'string':\r\n            return refNameOk(param, bus);\r\n        default:\r\n            if (Array.isArray(param)) {\r\n                if (refArrayOk(param, bus) === false) return false;\r\n                for (let i = 0; i < param.length; i++) {\r\n                    let item = param[i];\r\n                    if (typeof item === 'string') {\r\n                        param[i] = parseField(item);\r\n                    }\r\n                }\r\n                return true;\r\n            }\r\n            break;\r\n    }\r\n    alert('param of a query can only be string or array');\r\n    return false;\r\n}\r\n\r\nclass Servers extends ObjItems<DevServer> {\r\n    protected async _load() {\r\n        return await devApi.servers(this.store.unit.id);\r\n    }\r\n    protected async _save(item: DevServer): Promise<number> {\r\n        return await devApi.saveServer(item);\r\n    }\r\n    protected async _del(item: DevServer): Promise<void> {\r\n        await devApi.delServer(this.store.unit.id, item.id);\r\n    }\r\n    protected _inc() { this.dev.counts.server++; }\r\n    protected _dec() { this.dev.counts.server--; }\r\n}\r\nclass Services extends ObjItems<DevService> {\r\n    protected async _load() {\r\n        return await devApi.services(this.store.unit.id);\r\n    }\r\n    protected async _save(item: DevService): Promise<number> {\r\n        return await devApi.saveService(item);\r\n    }\r\n    protected async _del(item: DevService): Promise<void> {\r\n        await devApi.delService(this.store.unit.id, item.id);\r\n    }\r\n    protected _inc() { this.dev.counts.service++; }\r\n    protected _dec() { this.dev.counts.service--; }\r\n    async changeProp(prop: string, value: any): Promise<number> {\r\n        let ret = await devApi.changeServiceProp(this.store.unit.id, this.cur.id, prop, value);\r\n        switch (prop) {\r\n            case 'url': this.cur.url = value; break;\r\n            case 'urlTest': this.cur.urlTest = value; break;\r\n            case 'server': this.cur.server = value; break;\r\n            case 'db': this.cur.db = value; break;\r\n            //case 'db_type': this.cur.db_type = value; break;\r\n            //case 'connection': this.cur.connection = value; break;\r\n        }\r\n        return ret;\r\n    }\r\n    async loadUqServices(uq: number): Promise<void> {\r\n        let ret = await devApi.loadUqServices(this.store.unit.id, uq);\r\n        this.items = ret[0];\r\n    }\r\n}\r\n\r\nconst searchPageSize = 50;\r\ntype Search = (unit: number, key: string, pageStart: number, pageSize: number) => Promise<any[]>;\r\nclass SearchItems<T extends DevObjBase> {\r\n    private store: Store;\r\n    private dev: Dev;\r\n    private search: (unit: number, key: string, pageStart: number, pageSize: number) => Promise<any[]>;\r\n\r\n    constructor(store: Store, dev: Dev, search: Search) {\r\n        this.store = store;\r\n        this.dev = dev;\r\n        this.search = search;\r\n    }\r\n\r\n    @observable items: T[] = undefined;\r\n    allLoaded: boolean = false;\r\n    private key: string;\r\n    private pageStart = 0;\r\n\r\n    async first(key: string) {\r\n        this.key = key;\r\n        this.items = undefined;\r\n        this.allLoaded = false;\r\n        this.pageStart = 0;\r\n        await this.more();\r\n    }\r\n\r\n    async more(): Promise<void> {\r\n        if (this.allLoaded === true) return;\r\n        let ret = await this.search(this.store.unit.id, this.key, this.pageStart, searchPageSize);\r\n        let len = ret.length;\r\n        if (len > searchPageSize) {\r\n            this.allLoaded = false;\r\n            --len;\r\n            ret.splice(len, 1);\r\n        }\r\n        else {\r\n            this.allLoaded = true;\r\n        }\r\n        if (len > 0) {\r\n            this.pageStart = ret[len - 1].id;\r\n            if (this.items === undefined)\r\n                this.items = ret;\r\n            else\r\n                this.items.push(...ret);\r\n        }\r\n        else {\r\n            this.items = [];\r\n        }\r\n    }\r\n}\r\n\r\nexport class Dev {\r\n    private store: Store;\r\n    constructor(store: Store) {\r\n        this.store = store;\r\n        this.apps = new Apps(store, this);\r\n        this.uqs = new Uqs(store, this);\r\n        this.buses = new Buses(store, this);\r\n        this.servers = new Servers(store, this);\r\n        //this.uqdbs = new Uqdbs(store, this);\r\n        this.services = new Services(store, this);\r\n        this.searchApp = new SearchItems<DevApp>(store, this, devApi.searchApp.bind(devApi));\r\n        this.searchUq = new SearchItems<DevUQ>(store, this, devApi.searchUq.bind(devApi));\r\n        this.searchServer = new SearchItems<DevServer>(store, this, devApi.searchServer.bind(devApi));\r\n    }\r\n\r\n    @observable counts: Counts = undefined;\r\n    apps: Apps = undefined;\r\n    uqs: Uqs = undefined;\r\n    buses: Buses = undefined;\r\n    servers: Servers = undefined;\r\n    services: Services = undefined;\r\n\r\n    searchApp: SearchItems<DevApp> = undefined;\r\n    searchUq: SearchItems<DevUQ> = undefined;\r\n    searchServer: SearchItems<DevServer> = undefined;\r\n\r\n    async loadCounts(): Promise<void> {\r\n        let { unit } = this.store;\r\n        this.counts = await devApi.counts(unit.id);\r\n    }\r\n}\r\n","import {observable} from 'mobx';\r\nimport _ from 'lodash';\r\nimport {appInFrame, host} from 'tonva';\r\nimport {mainApi, devApi} from '../api';\r\nimport {Unit, UnitApp, Role, RoleMember, UnitAdmin} from '../model';\r\nimport {Dev} from './dev';\r\n\r\nexport class Store {\r\n    private get unitId():number {return appInFrame.unit;};\r\n    dev:Dev;\r\n    uqServer: string;\r\n\r\n    @observable unit: Unit;\r\n    @observable memberCount: number;\r\n    @observable apps: UnitApp[];\r\n    @observable role:Role;\r\n    @observable roles: Role[];\r\n    @observable roleApps: UnitApp[];\r\n    @observable roleMember: RoleMember;\r\n    @observable roleMembers: RoleMember[];\r\n    @observable memberRoles: Role[];\r\n\r\n    unitAdmins: UnitAdmin[]; // 仅仅为Admins调试用。从登录用户获取units\r\n    accUnits: UnitAdmin[];\r\n    devUnits: UnitAdmin[];\r\n    bothUnits: UnitAdmin[];\r\n\r\n    init() {\r\n        this.unit = undefined;\r\n        this.apps = undefined;\r\n        //this.admins = new Admins(this);\r\n        this.dev = new Dev(this);\r\n    }\r\n\r\n    logout() {\r\n        //meInFrame.app = undefined;\r\n        appInFrame.hash = undefined;\r\n        //let unitId = process.env.REACT_APP_DEBUG_UNITID;\r\n        //if (unitId !== undefined)\r\n        //    meInFrame.unit = Number(unitId);\r\n        appInFrame.unit = undefined;\r\n        this.init();\r\n        this.memberCount = undefined;\r\n        this.apps = undefined;\r\n        this.role = undefined;\r\n        this.roles = undefined;\r\n        this.roleApps = undefined;\r\n        this.roleMember = undefined;\r\n        this.roleMembers = undefined;\r\n        this.memberRoles = undefined;\r\n    }\r\n\r\n    async loadAdminUnits(): Promise<void> {\r\n        let ret = await mainApi.userUnitAdmins();\r\n        let unitAdmins = this.unitAdmins = ret[0];\r\n        if (unitAdmins.length === 1) {\r\n            appInFrame.unit = unitAdmins[0].id;\r\n            await store.loadUnit();\r\n        }\r\n        else {\r\n            this.accUnits = [];\r\n            this.devUnits = [];\r\n            this.bothUnits = [];\r\n            for (let ua of unitAdmins) {\r\n                let {type} = ua;\r\n                if ((type & 3) === 3) {\r\n                    this.bothUnits.push(ua);\r\n                }\r\n                else if ((type & 1) === 1) {\r\n                    this.devUnits.push(ua);\r\n                }\r\n                else if ((type & 2) === 2) {\r\n                    this.accUnits.push(ua);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    setRole(role:Role) {\r\n        if (this.role === role) return;\r\n        this.role = role;\r\n        this.roleApps = undefined;\r\n        this.roleMember = undefined;\r\n        this.roleMembers = undefined;\r\n        this.memberRoles = undefined;\r\n    }\r\n\r\n    setRoleUser(user:RoleMember) {\r\n        if (this.roleMember === user) return;\r\n        this.roleMember = user;\r\n        this.memberRoles = undefined;\r\n    }\r\n\r\n    async unitChangeProp(prop:string, value:any):Promise<void> {\r\n        await mainApi.unitChangeProp(this.unit.id, prop, value);\r\n        this.unit[prop] = value;\r\n    }\r\n\r\n    async loadApps(): Promise<void> {\r\n        if (this.apps !== undefined) return;\r\n        this.apps = await mainApi.unitApps(this.unitId);\r\n    }\r\n\r\n    async loadUnit(): Promise<void> {\r\n        if (this.unitId === undefined) return;\r\n        let ret = await mainApi.unit(this.unitId);\r\n        this.unit = ret;\r\n        this.memberCount = await mainApi.unitMemberCount(this.unitId);\r\n        let uqServer = await devApi.uqBuilderUrl();\r\n        let {url} = uqServer;\r\n        this.uqServer = host.getUrlOrDebug(url, 'uq-build');\r\n    }\r\n\r\n    async stopUnitApp(appId:number): Promise<void> {\r\n        await mainApi.unitDeleteApp(this.unit.id, appId, 1);\r\n        let app = this.apps.find(v => v.id === appId);\r\n        app.inUnit = 0;\r\n    }\r\n\r\n    async restoreUnitApp(appId:number): Promise<number> {\r\n        let ret = await mainApi.unitAddApp(this.unit.id, appId);\r\n        if (ret <= 0) return ret;\r\n        let app = this.apps.find(v => v.id === appId);\r\n        app.inUnit = 1;\r\n        return 1;\r\n    }\r\n\r\n    async addUnitApp(app:UnitApp): Promise<number> {\r\n        let ret = await mainApi.unitAddApp(this.unit.id, app.id);\r\n        if (ret <= 0) return ret;\r\n        this.apps.push(app);\r\n        return 1;\r\n    }\r\n\r\n    async loadRoles(): Promise<void> {\r\n        if (this.roles !== undefined) return;\r\n        let ret = await mainApi.unitRoles(this.unit.id);\r\n        ret.forEach(v => {\r\n            switch (v.id) {\r\n                case 1: \r\n                    v.name= '访客';\r\n                    v.discription = '可以获取开放信息';\r\n                    break;\r\n                case 2: \r\n                    v.name= '普通';\r\n                    v.discription = '能访问最基本的功能';\r\n                    break;\r\n            }\r\n        });\r\n        this.roles = ret;\r\n    }\r\n\r\n    async unitAddRole(name:string, discription:string): Promise<number> {\r\n        let id = await mainApi.unitAddRole(this.unit.id, name, discription);\r\n        if (id > 0) {\r\n            this.roles.push({\r\n                id: id,\r\n                name: name,\r\n                discription: discription,\r\n                count: undefined,\r\n            });\r\n        }\r\n        return id;\r\n    }\r\n\r\n    async roleChangeProp(prop:string, value:any):Promise<void> {\r\n        await mainApi.unitRoleChangeProp(this.unit.id, this.role.id, prop, value);\r\n        this.role[prop] = value;\r\n    }\r\n\r\n    async loadRoleApps():Promise<void> {\r\n        let ret = await mainApi.unitRoleApps(this.unit.id, this.role.id);\r\n        this.roleApps = ret.map(v => {\r\n            return this.apps.find(app=>app.id === v.id);\r\n        });\r\n    }\r\n\r\n    async setRoleApps(apps:UnitApp[]) {\r\n        await mainApi.unitRoleSetApps(this.unit.id, this.role.id, apps.map(v=>v.id));\r\n        this.roleApps = apps;\r\n    }\r\n\r\n    async loadMembers():Promise<void> {\r\n        let ret = await mainApi.unitMembers(this.unit.id, this.role === undefined? 0:this.role.id, undefined, 0, 100);\r\n        this.roleMembers = ret;\r\n    }\r\n\r\n    async unitAssignMember(assigned:string):Promise<void> {\r\n        await mainApi.unitAssignMember(this.unit.id, this.roleMember.id, assigned);\r\n        this.roleMember.assigned = assigned;\r\n    }\r\n\r\n    async loadMemberRoles():Promise<void> {\r\n        let ret = await mainApi.unitMemberRoles(this.unit.id, this.roleMember.id);\r\n        let roles:Role[] = ret.map(v => {\r\n            let rId = v.id;\r\n            let role = this.roles.find(r => r.id === rId);\r\n            return _.clone(role);\r\n        });\r\n        this.memberRoles = roles;\r\n    }\r\n\r\n    async setMemberRoles(memberRoles:Role[]) {\r\n        await mainApi.unitSetMemberRoles(this.unit.id, this.roleMember.id, memberRoles.map(v=>v.id));\r\n        this.roles.forEach(role => {\r\n            let rId = role.id;\r\n            let org = this.memberRoles.find(v => v.id === rId);\r\n            let cur = memberRoles.find(v => v.id === rId);\r\n            if (org !== undefined) {\r\n                if (cur !== undefined) return;\r\n                role.count--;\r\n                return;\r\n            }\r\n            if (cur === undefined) return;\r\n            role.count++;\r\n        });\r\n        this.memberRoles = memberRoles;\r\n    }\r\n};\r\n\r\nexport const store = new Store();\r\n","import { CSub, CBase } from 'tonva';\r\nimport { CApp } from './CApp';\r\n\r\nexport abstract class CUqBase extends CBase {\r\n    get cApp(): CApp { return this._cApp; }\r\n}\r\n\r\nexport abstract class CUqSub<T extends CUqBase> extends CSub<T> {\r\n    get cApp(): CApp { return this.cApp; }\r\n    protected get owner(): CUqBase { return this._owner as CUqBase }\r\n}\r\n\r\nexport abstract class CRenderBase extends CUqBase {\r\n    protected async internalStart(param:any, ...params:any[]):Promise<void> {\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {EasyDate, EasyTime} from 'tonva';\r\n\r\nexport interface IdDatesProps {\r\n    date_init: Date;\r\n    date_update: Date;\r\n}\r\n\r\nexport class IdDates extends React.Component<IdDatesProps> {\r\n    render() {\r\n        let {date_init, date_update} = this.props;\r\n        return <small className=\"text-muted\">\r\n            更新: <EasyTime date={date_update}/>\r\n            <i className=\"fa fa-fw\" />\r\n            创建: <EasyDate date={date_init}/>\r\n        </small>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport function span(\r\n    isLink:boolean,\r\n    className:string, \r\n    onClick:(evt:React.MouseEventHandler<HTMLElement>)=>void,\r\n    content:any): JSX.Element\r\n{\r\n    let tag:string;\r\n    let props:any;\r\n    if (isLink === true) {\r\n        tag = 'a';\r\n        props = {\r\n            className: classNames(className, 'cursor-pointer'),\r\n            onClick: onClick,\r\n            href: '#',\r\n        }\r\n    }\r\n    else {\r\n        tag = 'span';\r\n        props = {\r\n            className: className,\r\n        }\r\n    }\r\n    return React.createElement(tag, props, content);\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, Media, PropGrid} from 'tonva';\r\nimport {nav, Page}  from 'tonva';\r\nimport {caches} from '../store';\r\nimport {span} from './span';\r\n\r\nexport interface UnitLinkProps {\r\n    className?: string;\r\n    id: number;\r\n    isLink?: boolean;\r\n}\r\n\r\n@observer\r\nexport class UnitSpan extends React.Component<UnitLinkProps> {\r\n    onClick = (evt) => {\r\n        evt.preventDefault();\r\n        nav.push(<UnitInfo id={this.props.id} />);\r\n        return false;\r\n    }\r\n    render() {\r\n        let {id, isLink, className} = this.props;\r\n        if (id === undefined) return null;\r\n        if (id === null) return null;\r\n        let unit = caches.units.get(id);\r\n        if (!unit) return null;\r\n        let content:any;\r\n        let {name, nick, discription} = unit;\r\n        let disc = discription && '- ' + discription;\r\n        if (nick) {\r\n            content = <>{nick} &nbsp; <small className=\"text-muted\">{name} {disc}</small></>;\r\n        }\r\n        else if (name) {\r\n            content = <>{name} &nbsp; <small className=\"text-muted\">{disc}</small></>;\r\n        }\r\n        else {\r\n            content = id;\r\n        }\r\n        return span(isLink, className, this.onClick, content);\r\n    }\r\n}\r\n\r\n@observer\r\nexport class UnitName extends React.Component<UnitLinkProps> {\r\n    render() {\r\n        let {id} = this.props;\r\n        if (id === undefined) return null;\r\n        let unit = caches.units.get(id);\r\n        let {name} = unit;\r\n        return <>{name}</>;\r\n    }\r\n}\r\n\r\nclass UnitInfo extends React.Component<UnitLinkProps> {\r\n    private rows:Prop[];\r\n    render() {\r\n        let unit = caches.units.get(this.props.id);\r\n        let {name, icon, discription} = unit;\r\n        this.rows = [\r\n            '',\r\n            {type: 'component', component: <Media icon={icon} main={name} discription={discription} />},\r\n            '',\r\n        ];\r\n        return <Page header={'小号 - 详细资料'}>\r\n            <PropGrid rows={this.rows} values={this.props} />\r\n        </Page>;\r\n    }\r\n}\r\n","export const appIcon = process.env.REACT_APP_ICON;\r\nexport const appItemIcon = process.env.REACT_APP_ITEM_ICON;\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, Media, PropGrid} from 'tonva';\r\nimport {nav, Page}  from 'tonva';\r\nimport {appIcon} from 'consts';\r\nimport {caches} from 'store';\r\nimport {IdDates} from './idDates';\r\nimport {span} from './span';\r\nimport {UnitSpan} from './unitSpan';\r\n\r\nexport interface UqLinkProps {\r\n    className?: string;\r\n    id: number;\r\n    isLink?: boolean;\r\n}\r\n\r\n@observer\r\nexport class UqSpan extends React.Component<UqLinkProps> {\r\n    onClick = (evt) => {\r\n        evt.preventDefault();\r\n        nav.push(<UqInfo id={this.props.id} />);\r\n        return false;\r\n    }\r\n    render() {\r\n        let {id, className, isLink} = this.props;\r\n        let api = caches.uqs.get(id);\r\n        let content;\r\n        if (api === null) {\r\n            content = id;\r\n        }\r\n        else {\r\n            let {name, discription} = api;\r\n            let disc = discription && '- ' + discription;\r\n            if (name !== undefined) {\r\n                content = <>{name}&nbsp;<small className=\"text-muted\">{disc}</small></>;\r\n            }\r\n            else {\r\n                content = id;\r\n            }\r\n        }\r\n        return span(isLink, className, this.onClick, content);\r\n    }\r\n}\r\n\r\n@observer\r\nclass UqInfo extends React.Component<UqLinkProps> {\r\n    private rows:Prop[];\r\n    render() {\r\n        let uq = caches.uqs.get(this.props.id);\r\n        let {name, discription, unit, date_init, date_update} = uq;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        this.rows = [\r\n            '',\r\n            {type: 'component', component: <Media icon={appIcon} main={name} discription={disp} />},\r\n            '',\r\n            {type: 'component', label: '所有者', component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> },\r\n        ];\r\n        return <Page header={'UQ - 详细资料'}>\r\n            <PropGrid rows={this.rows} values={this.props} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { Prop, ListProp, Media, PropGrid } from 'tonva';\r\nimport { nav, Page } from 'tonva';\r\nimport { caches } from '../store';\r\nimport { devApi } from '../api';\r\nimport { span } from './span';\r\nimport { IdDates } from './idDates';\r\nimport { UnitSpan } from './unitSpan';\r\n\r\nexport interface AppSpanProps {\r\n    className?: string;\r\n    id: number;\r\n    isLink?: boolean;\r\n}\r\n\r\nclass AppRow extends React.Component<any> {\r\n    render() {\r\n        let { name, discription } = this.props;\r\n        let disp;\r\n        if (discription) disp = <div className=\"small text-muted\">{discription}</div>;\r\n        return <div className='form-control-plaintext'>\r\n            <div>{name}</div>\r\n            {disp}\r\n        </div>\r\n    }\r\n}\r\n\r\n@observer\r\nexport class AppSpan extends React.Component<AppSpanProps> {\r\n    onClick = (evt) => {\r\n        evt.preventDefault();\r\n        nav.push(<AppInfo id={this.props.id} />)\r\n        return false;\r\n    }\r\n    render() {\r\n        let { id, isLink, className } = this.props;\r\n        let app = caches.apps.get(id);\r\n        let content;\r\n        if (app === null) {\r\n            content = id;\r\n        }\r\n        else {\r\n            let { name, discription } = app;\r\n            //let isPublic = app.public;\r\n            let disc = discription && '- ' + discription;\r\n            if (name !== undefined) {\r\n                content = <React.Fragment>{name} &nbsp; <small className=\"text-muted\">{disc}</small></React.Fragment>;\r\n            }\r\n            else {\r\n                content = id;\r\n            }\r\n        }\r\n        return span(isLink, className, this.onClick, content);\r\n    }\r\n}\r\n\r\n\r\n@observer\r\nclass AppInfo extends React.Component<AppSpanProps> {\r\n    private rows: Prop[];\r\n    @observable private apis: ListProp = {\r\n        label: '关联API', type: 'list', list: undefined, row: AppRow\r\n    };\r\n    /*\r\n    constructor(props:any) {\r\n        super(props);\r\n    }*/\r\n    async componentDidMount() {\r\n        this.apis.list = await devApi.loadAppUqs(this.props.id);\r\n    }\r\n    render() {\r\n        let app = caches.apps.get(this.props.id);\r\n        let { unit, name, discription, icon, date_init, date_update } = app;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        this.rows = [\r\n            '',\r\n            { type: 'component', component: <Media icon={icon} main={name} discription={disp} /> },\r\n            '',\r\n            { type: 'component', label: '所有者', component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> },\r\n            this.apis,\r\n        ];\r\n        return <Page header={'APP - 详细资料'}>\r\n            <PropGrid rows={this.rows} values={this.props} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, Media, PropGrid} from 'tonva';\r\nimport {nav, Page}  from 'tonva';\r\nimport {appIcon} from 'consts';\r\nimport {caches} from 'store';\r\nimport {IdDates} from './idDates';\r\nimport {span} from './span';\r\nimport {UnitSpan} from './unitSpan';\r\n\r\nexport interface BusLinkProps {\r\n    className?: string;\r\n    id: number;\r\n    isLink?: boolean;\r\n}\r\n\r\n@observer\r\nexport class BusSpan extends React.Component<BusLinkProps> {\r\n    onClick = (evt) => {\r\n        evt.preventDefault();\r\n        nav.push(<BusInfo id={this.props.id} />);\r\n        return false;\r\n    }\r\n    render() {\r\n        let {id, className, isLink} = this.props;\r\n        let api = caches.buses.get(id);\r\n        let content:any;\r\n        if (api === null) {\r\n            content = id;\r\n        }\r\n        else {\r\n            let {name, owner} = api;\r\n            if (name !== undefined) {\r\n                content = <>{name} / {owner}</>;\r\n            }\r\n            else {\r\n                content = id;\r\n            }\r\n        }\r\n        return span(isLink, className, this.onClick, content);\r\n    }\r\n}\r\n\r\n@observer\r\nclass BusInfo extends React.Component<BusLinkProps> {\r\n    private rows:Prop[];\r\n    render() {\r\n        let bus = caches.buses.get(this.props.id);\r\n        let {name, discription, unit, date_init, date_update} = bus;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        this.rows = [\r\n            '',\r\n            {type: 'component', component: <Media icon={appIcon} main={name} discription={disp} />},\r\n            '',\r\n            {type: 'component', label: '所有者', component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> },\r\n        ];\r\n        return <Page header={'UQ - 详细资料'}>\r\n            <PropGrid rows={this.rows} values={this.props} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, Media, PropGrid} from 'tonva';\r\nimport {nav, Page}  from 'tonva';\r\nimport {appIcon} from '../consts';\r\nimport {caches} from '../store';\r\nimport {span} from './span';\r\nimport {UnitSpan} from './unitSpan';\r\n\r\nexport interface ServerSpanProps {\r\n    className?: string;\r\n    id: number;\r\n    isLink?: boolean;\r\n}\r\n\r\n@observer\r\nexport class ServerSpan extends React.Component<ServerSpanProps> {\r\n    onClick = (evt) => {\r\n        evt.preventDefault();\r\n        nav.push(<ServerInfo id={this.props.id} />)\r\n        return false;\r\n    }\r\n    render() {\r\n        let {id, isLink, className} = this.props;\r\n        let server = caches.servers.get(id);\r\n        let content:any;\r\n        if (server === null) {\r\n            content = id;\r\n        }\r\n        else {\r\n            let {ip, name, url} = server;\r\n            if (name !== undefined) {\r\n                content = <>\r\n                    {name}&nbsp; <small className=\"text-muted\">{url || ip}</small>\r\n                </>;\r\n            }\r\n            else {\r\n                content = id;\r\n            }\r\n        }\r\n        if (!content) content = <small className=\"text-muted\">[无]</small>;\r\n        return span(isLink, className, this.onClick, content);\r\n    }\r\n}\r\n\r\nclass ServerInfo extends React.Component<ServerSpanProps> {\r\n    private rows:Prop[];\r\n    render() {\r\n        let server = caches.servers.get(this.props.id);\r\n        let {discription, ip, unit} = server;\r\n        /*\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        */\r\n        this.rows = [\r\n            '',\r\n            {type: 'component', component: <Media icon={appIcon} main={discription} discription={ip} />},\r\n            '',\r\n            {type: 'component', label: '所有者', component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> },\r\n            {type: 'string', label: '云服务', name: 'cloud'},\r\n        ];\r\n        return <Page header={'服务器 - 详细资料'}>\r\n            <PropGrid rows={this.rows} values={this.props} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {nav, Page} from 'tonva';\r\n\r\ninterface StringValueEditProps {\r\n    title: string;\r\n    onChanged:(value:any, orgValue:any)=>Promise<string|void>;\r\n    value?: any;\r\n    buttonText?: string;\r\n    info?: string;\r\n}\r\ninterface StringValueEditState {\r\n    disabled: boolean;\r\n    error?: string;\r\n}\r\n\r\nexport class StringValueEdit extends React.Component<StringValueEditProps, StringValueEditState> {\r\n    //private input:HTMLInputElement;\r\n    protected value: string;\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            disabled: true,\r\n        };\r\n    }\r\n    /*\r\n    private ref = (input:HTMLInputElement) => {\r\n        if (!input) return;\r\n        input.value = this.props.value || '';\r\n        this.input = input;\r\n    }*/\r\n    private onChange = (evt:React.FormEvent<HTMLInputElement>) => {\r\n        let val = this.props.value;\r\n        let org = val && val.trim();\r\n        this.value = evt.currentTarget.value.trim();\r\n        this.setState({\r\n            disabled: org === this.value\r\n        });\r\n        \r\n    }\r\n    protected onSubmit = async () => {\r\n        let val = this.props.value;\r\n        let org = val && val.trim();\r\n        let v = this.value; // this.input.value.trim();\r\n        let onChanged = this.props.onChanged;\r\n        if (onChanged !== undefined) {\r\n            let ret = await onChanged(v, org);\r\n            if (typeof ret === 'string') {\r\n                this.setState({error: ret});\r\n                return;\r\n            }\r\n            nav.pop();\r\n        }\r\n    }\r\n    protected renderControl() {\r\n        return <input className=\"form-control w-100\" type=\"text\"\r\n            // ref={this.ref}\r\n            defaultValue={this.props.value}\r\n            onChange={this.onChange} />\r\n    }\r\n    render() {\r\n        let {title, buttonText, info} = this.props;\r\n        let {disabled, error} = this.state;\r\n        let right = <button\r\n            className=\"btn btn-success btn-sm\"\r\n            disabled={disabled}\r\n            onClick={this.onSubmit}\r\n        >\r\n            {buttonText||'保存'}\r\n        </button>;\r\n        let errorDiv;\r\n        if (error !== undefined) errorDiv = <div className='text-danger'>{error}</div>;\r\n        return <Page header={title} right={right}>\r\n            <div className=\"my-4 mx-3\">\r\n                {this.renderControl()}\r\n                {errorDiv}\r\n                <small className=\"d-block mt-2 text-muted\">{info}</small>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class TextValueEdit extends StringValueEdit {\r\n    /*\r\n    private textArea:HTMLTextAreaElement;\r\n    private refTextArea = (textArea:HTMLTextAreaElement) => {\r\n        if (!textArea) return;\r\n        textArea.value = this.props.value || '';\r\n        this.textArea = textArea;\r\n    }\r\n    */\r\n    private onTextAreaChange = (evt:React.FormEvent<HTMLTextAreaElement>) => {\r\n        let val = this.props.value;\r\n        let org = val && val.trim();\r\n        this.value = evt.currentTarget.value.trim();\r\n        this.setState({\r\n            disabled: org === this.value\r\n        })\r\n    }\r\n    protected renderControl() {\r\n        return <textarea className=\"form-control w-100\" rows={8}\r\n            // ref={this.refTextArea}\r\n            defaultValue={this.props.value}\r\n            onChange={this.onTextAreaChange} />\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { nav, Page } from 'tonva';\r\nimport { SearchBox, List } from 'tonva';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport interface IdPickPageProps {\r\n    caption: string;\r\n    searchPlaceHolder?: string;\r\n    candidateItems: ((params:any, key:string) => Promise<any[]>) | any[];\r\n    moreCandidates: () => Promise<void>;\r\n    row: (item:any, index:number) => JSX.Element;\r\n    idFromItem: (item:any) => number;\r\n    resolve: (item?: any) => void;\r\n    params: any;\r\n}\r\n\r\n@observer\r\nexport class IdPickPage extends React.Component<IdPickPageProps> {\r\n    @observable private items:any[];\r\n\r\n    async componentDidMount() {\r\n        let {candidateItems, params} = this.props;\r\n        this.items = Array.isArray(candidateItems)? \r\n            candidateItems \r\n            : await candidateItems(params, '');\r\n    }\r\n    private itemClick = (item:any):Promise<void> => {\r\n        let {resolve, idFromItem} = this.props;\r\n        resolve(idFromItem(item));\r\n        nav.pop();\r\n        return;\r\n    }\r\n    private onSearch = async (key: string):Promise<void> => {\r\n        let {candidateItems, params} = this.props;\r\n        if (typeof candidateItems === 'function') {\r\n            let ret = await candidateItems(params, key);\r\n            this.items = ret;\r\n        }\r\n        return;\r\n    }\r\n    render() {\r\n        let {caption, row, searchPlaceHolder} = this.props;\r\n        return <Page header={caption} back=\"close\">\r\n            <div className=\"container\">\r\n                <SearchBox className=\"my-2\" \r\n                    onSearch={this.onSearch} \r\n                    placeholder={searchPlaceHolder}\r\n                    maxLength={100} />\r\n            </div>\r\n            <List items={this.items} item={{onClick:this.itemClick, render:row}} />\r\n        </Page>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {nav, Page} from 'tonva';\r\nimport {IdPick, IdPickFace} from 'tonva-form';\r\nimport {List, SearchBox} from 'tonva';\r\n\r\nexport interface IdPickProps {\r\n    caption: string;\r\n    searchPlaceHolder?: string;\r\n    candidateItems: ((params:any, key:string) => Promise<any[]>) | any[];\r\n    moreCandidates: () => Promise<void>;\r\n    row: (item:any, index:number) => JSX.Element;\r\n}\r\n\r\nexport function createIdPick(props: IdPickProps):IdPick {\r\n    return function(face: IdPickFace, params: any):Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            nav.push(<IdPickPage resolve={resolve} face={face} params={params} {...props} />);\r\n        });\r\n    }\r\n}\r\n\r\ninterface IdPickPageProps extends IdPickProps {\r\n    face: IdPickFace;\r\n    resolve: (item?: any) => void;\r\n    params: any;\r\n}\r\ninterface IdPickPageState {\r\n    items?: any[];\r\n}\r\n\r\nclass IdPickPage extends React.Component<IdPickPageProps, IdPickPageState> {\r\n    private items:any[];\r\n    constructor(props:IdPickPageProps) {\r\n        super(props);\r\n        this.state = {\r\n            items: null,\r\n        }\r\n        this.itemClick = this.itemClick.bind(this);\r\n        this.onSearch = this.onSearch.bind(this);\r\n    }\r\n    async componentDidMount() {\r\n        let {candidateItems, params} = this.props;\r\n        this.setState({\r\n            items: Array.isArray(candidateItems)? candidateItems : await candidateItems(params, ''),\r\n        });\r\n    }\r\n    itemClick(item:any) {\r\n        let {resolve} = this.props;\r\n        resolve(item);\r\n        nav.pop();\r\n    }\r\n    async onSearch(key: string) {\r\n        //alert('search ' + key);\r\n        //await store.dev.searchServer.first(key)\r\n        let {candidateItems, params} = this.props;\r\n        if (typeof candidateItems === 'function') {\r\n            let ret = await candidateItems(params, key);\r\n            this.setState({items: ret});\r\n        }\r\n    }\r\n    render() {\r\n        let {caption, row, searchPlaceHolder} = this.props;\r\n        return <Page header={caption} back=\"close\">\r\n            <div className=\"container\">\r\n                <SearchBox className=\"my-2\" \r\n                    onSearch={this.onSearch} \r\n                    placeholder={searchPlaceHolder}\r\n                    maxLength={100} />\r\n            </div>\r\n            <List items={this.state.items} item={{onClick:this.itemClick, render:row}} />\r\n        </Page>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport {Media, List, LMR, Prop, PropGrid, FA} from 'tonva';\r\nimport {nav} from 'tonva';\r\nimport {IdDates, UnitSpan} from '../tools';\r\nimport {UnitApp} from '../model';\r\nimport {store} from '../store';\r\nimport { devApi } from 'api';\r\n\r\n@observer\r\nexport class Info extends React.Component<{app:UnitApp, appActed?:(appId:number, inUnit:number)=>void}> {\r\n    @observable private uqAccesses: any[];\r\n    async componentDidMount() {\r\n        this.uqAccesses = await devApi.loadAppUqs(this.props.app.id);\r\n    }\r\n\r\n    private renderUqRow = (uqAccess:any, index:number):JSX.Element => {\r\n        let {name, owner, discription} = uqAccess;\r\n        return <LMR className=\"py-2\" right={<small className=\"text-muted\">{discription}</small>}>\r\n            {owner} / {name}\r\n        </LMR>;\r\n    }\r\n\r\n    private act = async () => {\r\n        let {app, appActed} = this.props;\r\n        let {id, inUnit} = app;\r\n        let newInUnit:number = 1;\r\n        if (inUnit === 0) {\r\n            let ret = await store.restoreUnitApp(id);\r\n            if (ret <= 0) alert('app 或者 uq 没有定义 service');\r\n        }\r\n        else if (inUnit === 1) {\r\n            await store.stopUnitApp(id);\r\n            newInUnit = 0;\r\n        }\r\n        else {\r\n            let newApp:UnitApp = _.clone(app);\r\n            newApp.id = id;\r\n            newApp.inUnit = 1;\r\n            let ret = await store.addUnitApp(newApp);\r\n            if (ret <= 0) alert('app 或者 uq 没有定义 service');\r\n        }\r\n        if (appActed !== undefined) {\r\n            appActed(id, newInUnit);\r\n        }\r\n        nav.pop();\r\n    }\r\n    render() {\r\n        let {unit, name, discription, icon, inUnit, date_init, date_update} = this.props.app;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        let faName:string, text:string, color:string;\r\n        if (inUnit === 1) {\r\n            faName = 'ban';\r\n            text = '停用APP';\r\n            color = 'btn-danger';\r\n        }\r\n        else if (inUnit === 0) {\r\n            faName = 'refresh';\r\n            text = '恢复APP';\r\n            color = 'btn-success';\r\n        }\r\n        else {\r\n            faName = 'plus';\r\n            text = '启用APP';\r\n            color = 'btn-primary';\r\n        }\r\n        let rows:Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component', \r\n                component: <Media icon={icon} main={name} discription={disp} />\r\n            },\r\n            '',\r\n            {\r\n                type: 'component', \r\n                label: '开发号', \r\n                component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div>\r\n            },\r\n            {\r\n                type: 'component', \r\n                label: '关联UQ', \r\n                component: <List className=\"w-100\" items={this.uqAccesses} item={{render: this.renderUqRow}} />\r\n            },\r\n            '',\r\n            '',\r\n            {\r\n                type: 'component', \r\n                bk: '', \r\n                component: <button className={classNames('btn', 'w-100', color)} onClick={this.act}>\r\n                    <FA name={faName} size=\"lg\" /> {text}\r\n                </button>\r\n            },\r\n        ];\r\n        return <div>\r\n            <PropGrid rows={rows} values={this.props} />\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {IObservableArray} from 'mobx';\r\nimport {observer} from 'mobx-react';\r\nimport {SearchBox, List, LMR, Badge} from 'tonva';\r\nimport {nav, Page, PageItems, Image} from 'tonva';\r\nimport {mainApi} from '../api';\r\nimport {store} from '../store';\r\nimport {UnitApp} from '../model';\r\nimport {Info} from './info';\r\n\r\nclass PageApps extends PageItems<UnitApp> {\r\n    private unitId:number;\r\n    constructor(unitId:number) {\r\n        super();\r\n        this.unitId = unitId;\r\n\t}\r\n\t/*\r\n    protected async load():Promise<UnitApp[]> {\r\n        return await mainApi.searchApp(this.unitId, this.param, this.pageStart, this.pageSize);\r\n\t}\r\n\t*/\r\n    protected async loadResults(param: any, pageStart: any, pageSize: number): Promise<{\r\n        [name: string]: any[];\r\n    }> {\r\n\t\tlet ret = await mainApi.searchApp(this.unitId, this.param, this.pageStart, this.pageSize);\r\n\t\treturn {$page: ret};\r\n\t}\r\n    protected setPageStart(item:UnitApp) {\r\n        if (item === undefined)\r\n            this.pageStart = 0;\r\n        else\r\n            this.pageStart = item.id;\r\n    }\r\n}\r\n\r\n@observer\r\nexport class NewApp extends React.Component {\r\n    private apps: PageApps;\r\n    constructor(props:any) {\r\n        super(props);\r\n        this.apps = new PageApps(store.unit.id);\r\n    }\r\n    private onSearch = async (key:string) => {\r\n        await this.apps.first(key);\r\n    }\r\n    private appClick = (app:UnitApp) => {\r\n        nav.push(<Page header=\"App详细信息\">\r\n            <Info app={app} appActed={this.appActed}/>\r\n        </Page>);\r\n    }\r\n    private appActed = (appId:number, inUnit:number) => {\r\n        let apps = this.apps.items as IObservableArray<UnitApp>; //.replace .find(v => v.id === appId);\r\n        let app = apps.find(v => v.id === appId);\r\n        app.inUnit = inUnit;\r\n        apps.replace([app]);\r\n    }\r\n    private renderApp(app:UnitApp):JSX.Element {\r\n        let {name, discription, icon, inUnit} = app;\r\n        let right;\r\n        if (inUnit === 1)\r\n            right = <small>已启用</small>;\r\n        else if (inUnit === 0)\r\n            right = <small>已停用</small>;\r\n        return <LMR className=\"px-3 py-2\"\r\n            left={<Badge><Image src={icon} /></Badge>}\r\n            right={right}>\r\n            <div className=\"px-3\">\r\n                <div>{name}</div>\r\n                <small className=\"text-muted\">{discription}</small>\r\n            </div>\r\n        </LMR>;\r\n    }\r\n    render() {\r\n        let items = this.apps.items;\r\n        let center = <SearchBox onSearch={this.onSearch} \r\n            className=\"w-100 mx-1\" \r\n            placeholder=\"搜索App\" \r\n            maxLength={100} />;\r\n        return <Page header={center}>\r\n            <List\r\n                items={items}\r\n                item={{onClick:this.appClick, render:this.renderApp}}\r\n                before=\"搜索App名字\" />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { List, FA, LMR, Badge } from 'tonva';\r\nimport { nav, Page, Image } from 'tonva';\r\nimport { store } from '../store';\r\nimport { NewApp } from './new';\r\nimport { UnitApp } from '../model';\r\nimport { Info } from './info';\r\n\r\n@observer\r\nexport default class AppsPage extends React.Component {\r\n    async componentDidMount() {\r\n        await store.loadApps();\r\n    }\r\n    private itemRender(app: UnitApp, index: number) {\r\n        let { name, discription, icon, inUnit } = app;\r\n        let ban;\r\n        if (inUnit === 0)\r\n            ban = <FA className=\"text-danger\" name='ban' />;\r\n        return <LMR className=\"px-3 py-1\"\r\n            left={<Badge><Image src={icon} /></Badge>}\r\n            right={ban}>\r\n            <div className=\"px-3\">\r\n                <div>{name}</div>\r\n                <small className=\"text-muted\">{discription}</small>\r\n            </div>\r\n        </LMR>;\r\n    }\r\n    private appClick(app: UnitApp) {\r\n        nav.push(<Page header=\"App详细信息\">\r\n            <Info app={app} />\r\n        </Page>);\r\n    }\r\n    private newItem() {\r\n        nav.push(<NewApp {...this.props} />);\r\n    }\r\n    render() {\r\n        let right = <button\r\n            className='btn btn-success btn-sm me-1 align-self-center'\r\n            onClick={() => this.newItem()}><FA name=\"plus\" /></button>;\r\n        return <Page header=\"启停App\" right={right}>\r\n            <List items={store.apps} item={{ render: this.itemRender, onClick: this.appClick }} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, Image, EasyDate } from 'tonva';\r\nimport { AppController } from '.';\r\nimport { List, LMR, Badge, FA } from 'tonva';\r\nimport { DevApp } from 'model';\r\n\r\nexport class AppsPage extends VPage<AppController> {\r\n    async open(param: any) {\r\n        this.openPage(this.page);\r\n    }\r\n    private page = (): JSX.Element => {\r\n        let { appList, listRowClick, showNewApp } = this.controller;\r\n        let right = <button className='btn btn-success btn-sm me-2' onClick={showNewApp}>\r\n            <FA name=\"plus\" /></button>;\r\n        return <Page header=\"App\" right={right}>\r\n            <List items={appList} item={{ render: this.appRow, onClick: listRowClick }} />\r\n        </Page>\r\n    }\r\n    private appRow = (item: DevApp): JSX.Element => {\r\n        let { name, caption, icon, date_init } = item;\r\n        let left = <Badge size=\"sm\"><Image src={icon} /></Badge>;\r\n        /*let urlDiv = <div className=\"text-muted small\">\r\n            {url || '-'} {urlDebug}\r\n        </div>;*/\r\n        let spanCaption = caption ?\r\n            <><div className=\"small text-muted\">{name}</div><div><b>{caption}</b></div></> :\r\n            <div><b>{name}</b></div>;\r\n        //let disDiv = <div><Muted>{discription}</Muted></div>\r\n        let right = <small className=\"text-muted\"><EasyDate date={date_init} /></small>;\r\n        return <LMR className=\"py-2 px-3 align-items-stretch\" left={left} right={right}>\r\n            <div className=\"px-3\">\r\n                {spanCaption}\r\n            </div>\r\n        </LMR>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport { AppController } from '.';\r\nimport { VPage, nav, Page, ItemSchema, UiSchema, StringSchema, BoolSchema, \r\n    UiTextItem, UiTextAreaItem, UiCheckItem, Form, \r\n    ButtonSchema, Context, ImageSchema, UiImageItem, IdSchema, UiIdItem } from 'tonva';\r\n//import { IdPickProps } from 'createIdPick';\r\nimport { store } from 'store';\r\nimport { IdPickPage, ServerSpan } from '../../tools';\r\nimport { observer } from 'mobx-react';\r\nimport { DevServer, DevApp } from 'model';\r\n\r\nconst ServerCaption = (item:DevServer) => {\r\n    let {discription, cloud, ip} = item;\r\n    return <>{discription} {cloud} {ip}</>;\r\n}\r\n/*\r\nconst idPickServerProps: IdPickProps = {\r\n    caption: '选择服务器',\r\n    searchPlaceHolder: '搜索服务器',\r\n    candidateItems: async (params:any, key:string) => {\r\n        await store.dev.searchServer.first(key);\r\n        return store.dev.searchServer.items;\r\n    },\r\n    moreCandidates: async () => {\r\n        await store.dev.searchServer.more();\r\n    },\r\n    row: (item:Server, index:number) => {\r\n        return <div className=\"px-3 py-2\"><ServerCaption {...item} /></div>;\r\n    },\r\n};\r\n*/\r\nconst schema:ItemSchema[] = [\r\n    {name: 'name', type: 'string', maxLength: 100, required: true} as StringSchema,\r\n    {name: 'caption', type: 'string', maxLength: 100} as StringSchema,\r\n    {name: 'discription', type: 'string', maxLength: 250} as StringSchema,\r\n    {name: 'url', type: 'string', maxLength: 200} as StringSchema,\r\n    {name: 'public', type: 'boolean'} as BoolSchema,\r\n    {name: 'server', type: 'id'} as IdSchema,\r\n    {name: 'icon', type: 'image'} as ImageSchema,\r\n    {name: 'submit', type: 'submit'} as ButtonSchema,\r\n];\r\n\r\nexport abstract class EditBasePage extends VPage<AppController> {\r\n    private candidateItems = async (params:any, key:string):Promise<any[]> => {\r\n        await store.dev.searchServer.first(key);\r\n        return store.dev.searchServer.items;\r\n    }\r\n\r\n    private moreCandidates = async ():Promise<void> => {\r\n        await store.dev.searchServer.more();\r\n    }\r\n\r\n    private renderRow = (item:DevServer, index:number): JSX.Element => {\r\n        return <div className=\"px-3 py-2\"><ServerCaption {...item} /></div>;\r\n    }\r\n\r\n    private pickServerId = (context:Context, name:string, value:number): Promise<number> => {\r\n        return new Promise<number>((resolve, reject) => {\r\n            nav.push(<IdPickPage \r\n                caption=\"选择服务器\" \r\n                searchPlaceHolder=\"搜索服务器\"\r\n                candidateItems={this.candidateItems}\r\n                moreCandidates={this.moreCandidates}\r\n                row={this.renderRow}\r\n                idFromItem={(item:DevServer) => item.id}\r\n                resolve={resolve} params={undefined} />, \r\n                ()=> {\r\n                    reject();\r\n                });\r\n        });\r\n    }\r\n\r\n    private renderServerInput = (itemId:number): JSX.Element => {\r\n        return <ServerSpan id={itemId} />;\r\n    };\r\n\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            name: {widget: 'text', label: '名称'} as UiTextItem,\r\n            caption: {widget: 'text', label: '标题'} as UiTextItem,\r\n            discription: {widget: 'textarea', label: '描述', rows: 5} as UiTextAreaItem,\r\n            url: {widget: 'text', label: 'URL', placeholder: 'http(s)://APP地址'} as UiTextItem,\r\n            'public': {widget: 'checkbox', label: '公开', } as UiCheckItem,\r\n            server: {widget: 'id', label: '服务器', pickId: this.pickServerId, Templet: this.renderServerInput} as UiIdItem,\r\n            icon: {widget: 'image', label: '标志图'} as UiImageItem,\r\n            submit: {widget: 'button', label: '提交', className: 'btn btn-primary'}\r\n        }\r\n    }\r\n    \r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n    private onButtonClick = async (name:string, context: Context) => {\r\n        let {data} = context;\r\n        let app:DevApp = _.clone(this.controller.app) || {} as any;\r\n        _.merge(app, data);\r\n        await this.controller.saveApp(app);\r\n        nav.pop();\r\n    }\r\n    protected page: ()=>JSX.Element;\r\n    protected form = observer(() => {\r\n        return <Form fieldLabelSize={2}\r\n            className=\"m-3\" \r\n            schema={schema} \r\n            uiSchema={this.uiSchema}\r\n            formData={this.initValues}\r\n            onButtonClick={this.onButtonClick} />\r\n    });\r\n    abstract get initValues():any;\r\n}\r\n\r\nexport class EditPage extends EditBasePage {\r\n    get initValues():any {return this.controller.app}\r\n    protected page = () => {\r\n        let {app} = this.controller;\r\n        let {name} = app;\r\n        return <Page header={'修改APP - ' + name} back=\"close\">\r\n            {React.createElement(this.form)}\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class NewPage extends EditBasePage {\r\n    get initValues():any {return {}}\r\n    protected page = () => {\r\n        return <Page header={'新建APP'} back=\"close\">\r\n            {React.createElement(this.form)}\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { List, LMR, SearchBox } from 'tonva';\r\nimport { Page, VPage } from 'tonva';\r\nimport { AppController } from '.';\r\nimport { DevUQ } from 'model';\r\n\r\nexport class SearchUqPage extends VPage<AppController> {\r\n    @observable private uqs: DevUQ[];\r\n\r\n    async open() {\r\n        //this.uqs = await this.controller.getMyUqs();\r\n        let pageStart = 0, pageSize = 200;\r\n        this.uqs = await this.controller.searchUq('', pageStart, pageSize);\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onSearch = async (key: string) => {\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        this.uqs = await this.controller.searchUq(key, pageStart, pageSize);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { onUq } = this.controller;\r\n        let header = <SearchBox className=\"w-100 mx-1\"\r\n            label=\"选择关联UQ \"\r\n            onSearch={this.onSearch}\r\n            placeholder=\"搜索UQ名字\"\r\n            maxLength={100} />;\r\n        return <Page back=\"close\" header={header}>\r\n            <List items={this.uqs} item={{ render: this.row, onClick: onUq }} />\r\n        </Page>;\r\n    });\r\n\r\n    private row = (uq: DevUQ) => {\r\n        let { owner, name, discription } = uq;\r\n        return <LMR className=\"py-2 px-3\" right={discription}>\r\n            <div>{owner} / {name}</div>\r\n        </LMR>;\r\n    };\r\n}\r\n/*\r\n@observer\r\nexport class AppUqs extends React.Component {\r\n    @observable anySelected: boolean = false;\r\n    private list:List;\r\n    private onSelect = (item: UQ, isSelected:boolean, anySelected:boolean) => {\r\n        this.anySelected = anySelected;\r\n    }\r\n    private row = (item: UQ) => {\r\n        let {name, unit, discription} = item;\r\n        return <LMR className=\"px-3 py-2\" right={<small className=\"text-muted\">{discription}</small>}>\r\n            <UnitSpan id={unit} />/{name}\r\n        </LMR>;\r\n    }\r\n    private removeBind = () => {\r\n        if (this.list === null) return;\r\n        let {selectedItems} = this.list;\r\n        if (selectedItems === undefined) return;\r\n        if (selectedItems.length === 0) return;\r\n        store.dev.apps.appRemoveUq(selectedItems.map(v => v.id));\r\n    }\r\n    render() {\r\n        let btnProps = this.anySelected?\r\n            {color:'danger', onClick:this.removeBind, icon:'trash', text:'取消'}:\r\n            {color:'primary', onClick:()=>nav.push(<Uqs/>), icon:'plus', text:'新增'};\r\n        let btn = (p)=><button \r\n            className={classNames('btn', 'btn-outline-'+p.color, 'btn-sm')} \r\n            onClick={p.onClick}>\r\n            <i className={\"fa fa-\" + p.icon} /> {p.text}关联\r\n        </button>;\r\n        let listHeader = <div className=\"va-row py-1 justify-content-center\">{btn(btnProps)}</div>;\r\n        return <Page header=\"关联UQ\">\r\n            <List ref={list=>this.list=list} header={listHeader}\r\n                items={store.dev.apps.uqs}\r\n                item={{render: this.row, onSelect: this.onSelect}} />\r\n        </Page>;\r\n    }\r\n}\r\n\r\n@observer\r\nclass Uqs extends React.Component {\r\n    onSearch = async (key:string) => {\r\n        await store.dev.apps.searchUq(key);\r\n    }\r\n    onBind(uq: UQ, bind: boolean) {\r\n        store.dev.apps.appBindUq([uq.id]);\r\n    }\r\n    row = (uq: UQ) => {\r\n        let isConnected = store.dev.apps.uqs.find(a => a.id === uq.id) !== undefined;\r\n        let cn = ['btn', 'btn-sm'];\r\n        let btnContent:any, onClick:any;\r\n        if (isConnected) {\r\n            cn.push('btn-success');\r\n            //onClick = ()=>this.onBind(uq, false);\r\n            btnContent = <div>已关联</div>;\r\n        }\r\n        else {\r\n            cn.push('btn-primary');\r\n            onClick = ()=>this.onBind(uq, true);\r\n            btnContent = <button className={classNames(cn)} onClick={onClick}><span><i className=\"fa fa-check\"/> 关联</span></button>;\r\n        }\r\n        return <div className=\"d-flex justify-content-start py-1 px-3\">\r\n            <div className=\"align-self-center\">{uq.name + ' - ' + uq.discription}</div>\r\n            <footer className=\"ms-auto\">{btnContent}</footer>\r\n        </div>\r\n    }\r\n    render() {\r\n        let header = <SearchBox className=\"w-100 mx-1\" \r\n            onSearch={this.onSearch} \r\n            placeholder=\"搜索UQ名字\" \r\n            maxLength={100} />;\r\n        return <Page back=\"close\" header={header}>\r\n            <List items={store.dev.apps.searchedUqs} item={{render: this.row}} loading={null} />\r\n        </Page>;\r\n    }\r\n}\r\n*/","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page, nav, Prop, Media, PropGrid, DropdownActions, List, LMR, FA } from 'tonva';\r\nimport { AppController/*, UqAccess*/ } from '.';\r\nimport { IdDates, UnitSpan, ServerSpan, UnitName } from 'tools';\r\nimport { EditPage } from './editPage';\r\nimport { SearchUqPage } from './appUqs';\r\nimport { DevUQ } from 'model';\r\n//import { DevModel } from 'model';\r\n\r\nexport class AppPage extends VPage<AppController> {\r\n    async open() {\r\n        //this.uqs.list = this.controller.uqs;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private editItem = async () => {\r\n        await this.openVPage(EditPage);\r\n        //nav.push(<EditAppPage {...this.props} />);\r\n    }\r\n\r\n    private deleteItem = async () => {\r\n        if (window.confirm('真的要删除吗？系统删除时并不会检查相关引用，请谨慎') === true) {\r\n            await this.controller.deleteApp();\r\n            nav.pop();\r\n        }\r\n    }\r\n\r\n    private page = observer((): JSX.Element => {\r\n        let { app, uqs } = this.controller;\r\n        //let mainId = mainUq === undefined? 0: mainUq.id;\r\n        let { unit, name, caption, discription, icon, server, date_init, date_update } = app;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        let menuItems = [\r\n            // {icon: 'cogs', caption:'设置关联UQ', action: ()=>nav.push(<AppUqs />)},\r\n            { caption: '修改App', action: this.editItem, icon: 'edit' },\r\n            { caption: '删除', action: this.deleteItem, icon: 'trash-o' }\r\n        ];\r\n\r\n        let right = <DropdownActions actions={menuItems} className=\"btn-primary me-2\" />;\r\n        let spanCaption = caption ?\r\n            <>{name}: <b>{caption}</b></> :\r\n            <b>{name}</b>;\r\n        let rows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <Media icon={icon} main={spanCaption} discription={disp} />\r\n            },\r\n            '',\r\n            {\r\n                type: 'component',\r\n                label: '开发号',\r\n                component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div>\r\n            },\r\n            /*\r\n            {\r\n                type: 'component', \r\n                label: 'Service',\r\n                vAlign: 'stretch',\r\n                component: <ServiceRow />,\r\n            },*/\r\n            {\r\n                label: 'URL',\r\n                name: 'url',\r\n                type: 'string',\r\n            },\r\n            {\r\n                type: 'component',\r\n                label: '服务器',\r\n                component: <ServerSpan id={server} />\r\n            },\r\n            '',\r\n            //this.uqs,\r\n        ];\r\n        let btnAddUq = <button\r\n            className=\"btn btn-outline-primary btn-sm\"\r\n            onClick={() => this.openVPage(SearchUqPage)}>增加UQ</button>;\r\n        //let slaveUqs = uqs.filter(v => v.id !== mainId);\r\n        return <Page header={'App - ' + name} right={right}>\r\n            <PropGrid rows={rows} values={app} />\r\n            <LMR className=\"mx-3 mt-3 mb-1\" right={btnAddUq}>关联UQ</LMR>\r\n            <List\r\n                items={uqs}\r\n                item={{ render: this.renderUqRow, onClick: this.uqClick }} />\r\n        </Page>\r\n    })\r\n\r\n    private uqClick = (uq: DevUQ) => {\r\n        this.controller.onUq(uq);\r\n    }\r\n\r\n    private renderUqRow = (uq: DevUQ, index: number): JSX.Element => {\r\n        if (uq === undefined) return null;\r\n        let { name, discription, unit } = uq;\r\n        let right = discription && <div className=\"small text-muted\"> &nbsp; {discription}</div>;\r\n        let isMain = this.controller.isMain(uq);\r\n        let cn = classNames(\"px-3 py-2 align-items-center bg-white\", isMain === true && \"font-weight-bold my-2\");\r\n        return <LMR className={cn} right={right}>\r\n            {isMain === true && <FA className=\"text-warning me-3\" name=\"star-o\" />}\r\n            <UnitName id={unit} /> / {name}\r\n        </LMR>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, nav, FA } from 'tonva';\r\nimport { AppController } from '.';\r\nimport { LMR } from 'tonva';\r\nimport { DevUQ } from 'model';\r\n\r\nexport class UqBindPage extends VPage<AppController> {\r\n    private uq: DevUQ;\r\n    //private accesses: string[];\r\n    //private accessChecked:{[name:string]:boolean};\r\n    async open(uq: DevUQ) {\r\n        this.uq = uq;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private saveUqBind = async () => {\r\n        await this.controller.saveUqBind(this.uq/*, acc*/);\r\n        this.closePage(2);\r\n    }\r\n\r\n    private removeUqBind = async () => {\r\n        await this.controller.removeUqBind(this.uq);\r\n        nav.pop();\r\n    }\r\n\r\n    private setMainUQ = async () => {\r\n        this.controller.saveSetUqMain(this.uq);\r\n        this.closePage();\r\n    }\r\n\r\n    private page = (): JSX.Element => {\r\n        //let {uq/*, bind_access*/} = this.uqAccess;\r\n        let { owner, name, discription } = this.uq;\r\n        let btnLeft: any, btnRight: any;\r\n        if (this.controller.isBinded(this.uq) === true) {\r\n            if (this.controller.isMain(this.uq) === false) {\r\n                btnLeft = <button className=\"btn btn-primary btn-sm\" onClick={this.setMainUQ}>设为主UQ</button>;\r\n            }\r\n            else {\r\n                btnLeft = <div><FA className=\"text-warning\" name=\"star-o\" /> 主UQ</div>;\r\n            }\r\n            btnRight = <button className=\"btn btn-outline-danger btn-sm\" onClick={this.removeUqBind}>取消关联</button>;\r\n        }\r\n        else {\r\n            btnLeft = <button className=\"btn btn-primary btn-sm\" onClick={this.saveUqBind}>保存关联</button>;\r\n        }\r\n        //let btnDelete = <button className=\"btn btn-outline-danger btn-sm\" onClick={this.removeUqBind}>取消关联</button>;\r\n        /*\r\n        if (bind_access !== null && bind_access !== undefined) {\r\n            btnDelete = <button className=\"btn btn-outline-danger btn-sm\" onClick={this.removeUqBind}>取消关联</button>;\r\n        }\r\n        */\r\n        /*\r\n        let checkAccessList:any;\r\n        if (this.accesses) {\r\n            checkAccessList = <div className=\"mt-3\">\r\n            {\r\n                this.accesses.map(v => {\r\n                    let checked = this.accessChecked[v];\r\n                    return <label key={v} className=\"d-inline-block me-4\">\r\n                        <input onChange={this.onCheckChanged}\r\n                            style={{width:'1.1rem', height:'1.1rem'}} \r\n                            name={v} type=\"checkbox\" defaultChecked={checked} />&nbsp;{v}\r\n                    </label>;\r\n                })\r\n            }\r\n            </div>;\r\n        }\r\n        */\r\n        return <Page header=\"关联UQ\">\r\n            <div className=\"m-3 py-3 px-3 bg-white border\">\r\n                <div>{owner} / {name}</div>\r\n                <div className=\"text-muted\">{discription}</div>\r\n                {/*checkAccessList*/}\r\n                <LMR className=\"pt-3\" right={btnRight}>{btnLeft}</LMR>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}","import _ from 'lodash';\r\nimport { observable } from 'mobx';\r\nimport { Controller } from 'tonva';\r\nimport { devApi } from 'api';\r\nimport { AppsPage } from './appsPage';\r\nimport { AppPage } from './appPage';\r\nimport { UqBindPage } from './uqBindPage';\r\nimport { NewPage } from './editPage';\r\nimport { DevApp, DevUQ } from 'model';\r\n\r\n/*\r\nexport interface UqAccess {\r\n    uq: UQ;\r\n    //bind_access: string[];\r\n}\r\n*/\r\n\r\nexport class AppController extends Controller {\r\n    private unitId: number;\r\n    app: DevApp;\r\n    @observable appList: DevApp[];\r\n    @observable uqs: DevUQ[];\r\n    @observable uqMain: DevUQ;\r\n    protected async internalStart(unitId:any) {\r\n        this.unitId = unitId;\r\n        this.appList = await devApi.apps(this.unitId);\r\n        this.openVPage(AppsPage);\r\n    }\r\n\r\n    listRowClick = async (item:DevApp) => {\r\n        this.app = item;\r\n        let {uqMain:uqMainId} = item;\r\n        let ret = await devApi.loadAppUqs(item.id);\r\n        let mainIdex:number;\r\n        this.uqs = ret.map((v, index) => {\r\n            let {owner, id, name, discription, unit, date_init, date_update} = v;\r\n            let ret = {\r\n                    id: id,\r\n                    name: name,\r\n                    discription: discription,\r\n                    unit: unit,\r\n                    //access: access,\r\n                    owner: owner,\r\n                    date_init: date_init,\r\n                    date_update: date_update, \r\n                    service_count: undefined,\r\n            }\r\n            if (id === uqMainId) {\r\n                this.uqMain = ret;\r\n                mainIdex = index;\r\n            }\r\n            return ret;\r\n        });\r\n        if (mainIdex !== undefined) {\r\n            this.uqs.splice(mainIdex, 1);\r\n            this.uqs.unshift(this.uqMain);\r\n        }\r\n        this.openVPage(AppPage);\r\n    }\r\n\r\n    saveSetUqMain = async (uq:DevUQ) => {\r\n        await devApi.appSetUqMain(this.unitId, this.app.id, uq.id);\r\n        this.setUqMain(uq);\r\n    }\r\n\r\n    private setUqMain(uq:DevUQ) {\r\n        this.uqMain = uq;\r\n        let index = this.uqs.findIndex(v => v.id === uq.id);\r\n        if (index >= 0) {\r\n            this.uqs.splice(index, 1);\r\n        }\r\n        this.uqs.unshift(uq);\r\n    }\r\n\r\n\r\n\r\n    showNewApp = () => {\r\n        this.app = undefined;\r\n        this.openVPage(NewPage);\r\n    }\r\n\r\n    saveApp = async (values: DevApp) => {\r\n        let app: DevApp;\r\n        let now = new Date();\r\n        if (this.app === undefined) {\r\n            app = _.clone(values);\r\n            app.date_init = now;\r\n        }\r\n        else {\r\n            app = _.clone(this.app);\r\n            _.merge(app, values);\r\n        }\r\n        app.unit = this.unitId;\r\n        app.date_update = now;\r\n        let ret = await devApi.saveApp(app);\r\n        app.id = ret;\r\n        let org = this.appList.find(v => v.id === ret);\r\n        if (org !== undefined) {\r\n            _.merge(org, app);\r\n        }\r\n        else {\r\n            this.appList.push(app);\r\n        }\r\n    }\r\n\r\n    isBinded = (uq:DevUQ):boolean => {\r\n        return this.uqs.findIndex(v => v.id === uq.id) >= 0;\r\n    }\r\n\r\n    isMain = (uq:DevUQ):boolean => {\r\n        return this.uqMain !== undefined && this.uqMain.id === uq.id;\r\n    }\r\n\r\n    deleteApp = async () => {\r\n        await devApi.delApp(this.unitId, this.app.id);\r\n        let index = this.appList.findIndex(v => v.id === this.app.id);\r\n        if (index >= 0) this.appList.splice(index, 1);\r\n    }\r\n\r\n    searchUq = async (key:string, pageStart:number, pageSize:number) => {\r\n        return await devApi.searchUq(this.unitId, key, pageStart, pageSize);\r\n    }\r\n\r\n    getMyUqs = async () => {\r\n        return await devApi.getMyUqs(this.unitId);\r\n    }\r\n\r\n    onUq = (uq: DevUQ) => {\r\n        this.openVPage(UqBindPage, uq);\r\n    }\r\n\r\n    saveUqBind = async (uq: DevUQ) => {\r\n        let uqs:number[] = this.uqs.map(v => v.id);\r\n        let index = uqs.findIndex(v => v === uq.id);\r\n        if (index < 0) uqs.push(uq.id);\r\n        await devApi.appBindUq(this.unitId, this.app.id, uqs);\r\n        this.uqs.push(uq);\r\n        if (this.uqs.length === 1) {\r\n            this.setUqMain(uq);\r\n        }\r\n    }\r\n\r\n    removeUqBind = async (uq: DevUQ) => {\r\n        let uqs:number[] = [];\r\n        for (let u of this.uqs) {\r\n            if (u.id !== uq.id) uqs.push(u.id);\r\n        }\r\n        await devApi.appBindUq(this.unitId, this.app.id, uqs);\r\n        let index = this.uqs.findIndex(v => v.id === uq.id);\r\n        if (index>=0) this.uqs.splice(index, 1);\r\n        if (this.uqMain && this.uqMain.id === uq.id) {\r\n            this.uqMain = undefined;\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\nimport ReactDOMServer from 'react-dom/server';\r\nimport { FA } from 'tonva';\r\nimport { observable } from 'mobx';\r\n//import { observer } from 'mobx-react';\r\n\r\nconst groupStart = '///++++++';\r\nconst groupEnd = '------///';\r\n\r\nexport abstract class Section {\r\n    rowId: number;\r\n\trender: () => JSX.Element;\r\n\trenderHtml() {\r\n\t\treturn ReactDOMServer.renderToStaticMarkup(this.render());\r\n\t}\r\n\tafterMount() {}\r\n\tisMe(name:string):boolean {return false;}\r\n}\r\n\r\nclass StringSection extends Section {\r\n    text: string;\r\n    constructor(text:string) {\r\n        super(); \r\n        this.text = text;\r\n    }\r\n    render = (): JSX.Element => {\r\n        if (this.text.trim().length === 0) return null;\r\n        let parts = this.text.split('\\n');\r\n        return <>{parts.map((v, i) => v.length === 0?\r\n            <div key={i}>&nbsp;</div> :\r\n            <div key={i}>{v}</div>\r\n        )}</>;\r\n    }\r\n}\r\n\r\nclass GroupSection extends Section {\r\n\tname: string;\r\n    group: string[];\r\n    @observable collaps: 1|2|3;\r\n    constructor(name:string, group:string[]) {\r\n\t\tsuper();\r\n\t\tthis.name = name;\r\n        this.group = group;\r\n        this.collaps = 1;\r\n\t}\r\n\tget elId() {return 'g' + this.rowId}\r\n\tget cId() {return 'c' + this.rowId}\r\n\tsetCollaps(c:1|2|3) {\r\n\t\tthis.collaps = c;\r\n\t\tlet el = document.getElementById(this.elId);\r\n\t\tlet elIcon = el.firstElementChild;\r\n\t\tif (elIcon) {\r\n\t\t\tlet fa:string;\r\n\t\t\tswitch (c) {\r\n\t\t\t\tcase 1: fa = 'fa fa-spin text-primary'; break;\r\n\t\t\t\tcase 2: fa = 'fa fa-arrow-circle-down text-success'; break;\r\n\t\t\t\tcase 3: fa = 'fa fa-arrow-circle-up text-success'; break;\r\n\t\t\t}\r\n\t\t\telIcon.className = fa;\t\t\t\r\n\t\t}\r\n\t\tif (c === 3) {\r\n             let content = ReactDOMServer.renderToStaticMarkup(<div id={this.cId}>\r\n                {\r\n                    this.group.map((v, i) => {\r\n                        if (v.trim().length === 0) return null;\r\n                        return <pre style={{whiteSpace: 'pre-wrap'}} key={i}>{v}</pre>\r\n                    })\r\n                }\r\n\t\t\t</div>);\r\n\t\t\tconst range = document.createRange();\r\n\t\t\trange.selectNode(el);\r\n\t\t\tconst child = range.createContextualFragment(content);\r\n\t\t\tel.parentNode.insertBefore(child, el.nextSibling);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet c = document.getElementById(this.cId);\r\n\t\t\tif (c) {\r\n\t\t\t\tc.parentNode.removeChild(c);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tisMe(name:string):boolean {\r\n\t\treturn this.name === name;\r\n\t}\r\n\tprivate onClick = () => {\r\n\t\tlet c = this.collaps;\r\n\t\tif (c === 1) return;\r\n\t\tif (c === 2) c = 3;\r\n\t\telse c = 2;\r\n\t\tthis.setCollaps(c);\r\n\t}\r\n\tafterMount() {\r\n\t\tlet el = document.getElementById(this.elId);\r\n\t\tif (el) {\r\n\t\t\tel.addEventListener('click', this.onClick);\r\n\t\t}\r\n\t}\r\n    render = /*observer(*/():JSX.Element => {\r\n        //let groupId = 'text-group-' + index;\r\n        let line = this.group[0];\r\n        let title: string;\r\n        let p0 = 0, p = line.indexOf('\\n');\r\n        if (p < 0) p = undefined;\r\n        else {\r\n            let l = line.indexOf('(');\r\n            if (l < p) p = l;\r\n        }\r\n        title = line.substring(p0, p);\r\n\r\n\t\tlet titleIcon:any, content:any;\r\n\t\tif (this.collaps === 1) {\r\n\t\t\ttitleIcon = <FA name='spinner' className='text-primary fa-spin' />;\r\n\t\t}\r\n        else if (this.collaps===3) {\r\n            titleIcon = <FA name='arrow-circle-up' className='text-success' />;\r\n            content = <div id={this.cId}>\r\n                {\r\n                    this.group.map((v, i) => {\r\n                        if (v.trim().length === 0) return null;\r\n                        return <pre style={{whiteSpace: 'pre-wrap'}} key={i}>{v}</pre>\r\n                    })\r\n                }\r\n            </div>;\r\n        }\r\n        else {\r\n            titleIcon = <FA name='arrow-circle-down' className='text-success' />;\r\n        }\r\n        return <>\r\n            <div id={this.elId} className=\"cursor-pointer text-primary\" onClick={this.onClick}>{titleIcon} <u>{title}</u></div>\r\n            {content}\r\n        </>;\r\n    }//);\r\n}\r\n\r\nclass EndSection extends Section {\r\n\tname: string;\r\n\tconstructor(name:string) {super(); this.name = name}\r\n}\r\n\r\nclass ErrorSection extends Section {\r\n    error: string[];\r\n    constructor(error:string[]) {super(); this.error = error}\r\n    render = ():JSX.Element => {\r\n        return <div className=\"text-danger\">\r\n            <FA name=\"exclamation-circle\" />&nbsp;\r\n            {this.error.join().split('\\n').map((v, index)=><React.Fragment key={index}>{v}<br/></React.Fragment>)}\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class ResultSections {\r\n    private text: string;\r\n    private p: number;\r\n    private group: string[];\r\n    private stop: boolean;\r\n    @observable hasError: boolean = false;\r\n    @observable seconds: number;\r\n    //readonly sections: (string | string[])[] = [];\r\n    private sectionId: number = 1;\r\n\t@observable readonly sections: Section[] = []; //observable.array([], {deep: true});\r\n\tprivate containerElement: HTMLDivElement\r\n\r\n\tconstructor(containerElement: HTMLDivElement) {\r\n\t\tthis.containerElement = containerElement;\r\n\t}\r\n\r\n    add(text:string):void {\r\n        this.stop = false;\r\n        if (this.text === undefined) {\r\n            this.p = 0;\r\n            this.text = text;\r\n        }\r\n        else {\r\n            this.text = this.text + text;\r\n        }\r\n        if (this.text.length < 10) return;\r\n        while (this.stop === false) {\r\n            this.addToGroup();\r\n            this.addText();\r\n        }\r\n\t}\r\n\t\r\n\tprivate addHtml(text:string) {\r\n\t\tconst range = document.createRange();\r\n\t\trange.selectNode(this.containerElement);\r\n\t\tconst child = range.createContextualFragment(text);\r\n\t\tthis.containerElement.appendChild(child);\r\n\t};\r\n\r\n    private addSection(section:Section) {\r\n        section.rowId = this.sectionId;\r\n        this.sectionId++;\r\n\t\tthis.sections.push(section);\r\n\t\t/*\r\n        let len = this.sections.length;\r\n        if (len > 500) {\r\n            this.sections.splice(0, len - 500);\r\n\t\t}\r\n\t\t*/\r\n\t\tlet html = section.renderHtml();\r\n\t\tthis.addHtml(html);\r\n\t\tsection.afterMount();\r\n    }\r\n\r\n    private mayStart(token:string):boolean {\r\n        let len = this.text.length - token.length;\r\n        if (this.p < len) return false;\r\n        for (let i=0; i<len; i++) {\r\n            if (this.text.charCodeAt(this.p + i) !== token.charCodeAt(i)) return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private parse():Section {\r\n        let type: string = '';\r\n\t\tlet len = this.group.length;\r\n        for (let i=0; i<len; i++) {\r\n            let ln = this.group[i];\r\n            let pos = ln.indexOf('\\n');\r\n            if (pos < 0) {\r\n                type += ln;\r\n                continue;\r\n            }\r\n            type += ln.substr(0, pos);\r\n            for (let s=0; s<i+1; s++) this.group.shift();\r\n            this.group.unshift(ln.substr(pos+1));\r\n            switch (type) {\r\n                default:\r\n\t\t\t\tcase '': \r\n                    return new GroupSection(type, this.group);\r\n                case 'error': \r\n                    this.hasError = true;\r\n                    return new ErrorSection(this.group);\r\n            }            \r\n        }\r\n\t\treturn new EndSection(type);\r\n\t}\r\n\r\n    private addToGroup():void {\r\n        if (this.group === undefined) return;\r\n        if (this.text === undefined) return;\r\n        let p = this.text.indexOf(groupEnd, this.p);\r\n        if (p < 0) {\r\n            if (this.mayStart(groupEnd) === true) return;\r\n            this.group.push(this.p === 0? this.text : this.text.substr(this.p));\r\n            this.p = 0;\r\n            this.text = undefined;\r\n            this.stop = true;\r\n            return;\r\n        }\r\n\t\tthis.group.push(this.text.substring(this.p, p));\r\n\t\tlet sec = this.parse();\r\n\t\tif (sec.render !== undefined) {\r\n\t\t\tthis.addSection(sec);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet n = (sec as EndSection).name;\r\n\t\t\tlet len = this.sections.length;\r\n\t\t\tfor (let i=len-1; i>=0; i--) {\r\n\t\t\t\tlet sec = this.sections[i];\r\n\t\t\t\tif (!sec) continue;\r\n\t\t\t\tif (sec.isMe(n) === true) {\r\n\t\t\t\t\t(sec as GroupSection).setCollaps(2);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n        this.group = undefined;\r\n        this.p = p + 9;\r\n    }\r\n\r\n    private addText():void {\r\n        if (this.text === undefined) return;\r\n        let p = this.text.indexOf(groupStart, this.p);\r\n        if (p < 0) {\r\n            if (this.mayStart(groupStart) === true) return;\r\n            this.addSection(new StringSection(this.p === 0? this.text : this.text.substr(this.p)));\r\n            this.p = 0;\r\n            this.text = undefined;\r\n            this.stop = true;\r\n            return;\r\n\t\t}\r\n\t\tlet sec = this.text.substring(this.p, p);\r\n        this.addSection(new StringSection(sec));\r\n        this.p = p + 9;\r\n        this.group = [];\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { UqActionProps } from './uqActionProps';\r\nimport { DevUQ } from 'model';\r\nimport { observer } from 'mobx-react';\r\nimport { ResultSections, Section } from './resultSections';\r\nimport { nav, Page } from 'tonva';\r\n\r\ninterface CompileResultProps extends UqActionProps {\r\n    uq: DevUQ;\r\n\tcaption?: string;\r\n    action: 'upload' | 'test' | 'deploy';\r\n\tactionName: string;\r\n    res: Response;\r\n    abortController: AbortController;\r\n}\r\n\r\n@observer\r\nexport class CompileResultPage extends React.Component<CompileResultProps> {\r\n    private resultSections: ResultSections;\r\n    private timeHandler:any;\r\n    constructor(props:CompileResultProps) {\r\n        super(props);\r\n        this.resultSections = new ResultSections(undefined);\r\n    }\r\n\tprivate autoScrollEnd:boolean = false;\r\n\tprivate autoScroll = true;\r\n    private startAutoScrollToBottom() {\r\n\t\tif (this.autoScrollEnd === true) return;\r\n\t\tthis.autoScroll = true;\r\n\t\tif (this.timeHandler !== undefined) return;\r\n        this.timeHandler = setInterval(() => {\r\n\t\t\tif (this.autoScroll === false) return;\r\n            var pane = document.getElementById('bottomDiv');\r\n            pane && pane.scrollIntoView();\r\n        }, 100);\r\n    }\r\n    private endAutoScrollToBottom() {\r\n        setTimeout(() => {\r\n\t\t\tthis.autoScroll = false;\r\n\t\t\tthis.autoScrollEnd = true;\r\n\t\t\tif (this.timeHandler === undefined) return;\r\n\t\t\tclearInterval(this.timeHandler);\r\n\t\t\tthis.timeHandler = undefined;\r\n\t\t}, 300);\r\n\t}\r\n\tprivate pauseAutoScrollToBottom() {\r\n\t\tthis.autoScroll = false;\r\n\t}\r\n    private getParent(el:HTMLElement):HTMLElement {\r\n        if (!el) return;\r\n        if (el.tagName === 'MAIN') return el;\r\n        return this.getParent(el.parentElement);\r\n    }\r\n    private topIntoView() {\r\n        var pane = document.getElementById('topDiv');\r\n        pane && pane.scrollIntoView();\r\n    }\r\n    private bottomIntoView() {\r\n        var pane = document.getElementById('bottomDiv');\r\n        pane && pane.scrollIntoView();\r\n    }\r\n    private doubleClick = () => {\r\n\t\tif (this.autoScrollEnd === true) return;\r\n        var pane = document.getElementById('scrollDiv');\r\n        let main = this.getParent(pane);\r\n        if (!main) return;\r\n        if (main.scrollTop >= main.scrollHeight / 2) {\r\n            this.topIntoView();\r\n        }\r\n        else {\r\n            this.bottomIntoView();\r\n        }\r\n    }\r\n    private lastScrollTop = 0;\r\n    private onScroll = (e:any) => {\r\n        let el = e.target as HTMLBaseElement;\r\n        let {scrollTop, scrollHeight, offsetHeight} = el;\r\n        if (scrollTop <= this.lastScrollTop) {\r\n            this.pauseAutoScrollToBottom();\r\n        }\r\n        else if (scrollTop + offsetHeight > scrollHeight - 30) {\r\n            this.startAutoScrollToBottom();\r\n        }\r\n\r\n        this.lastScrollTop = scrollTop;\r\n    }\r\n\r\n    private uintToString(uintArray:number[]):string {\r\n        let encodedString = String.fromCharCode(...uintArray);\r\n        try {\r\n            return decodeURIComponent(escape(encodedString));\r\n        }\r\n        catch (err) {\r\n            return encodedString;\r\n        }\r\n    }\r\n\r\n    private startTime: Date;\r\n\tprivate total: number;\r\n    private async pump(reader: ReadableStreamReader<any>, resultSections: ResultSections):Promise<boolean> {\r\n\t\tlet ret = await reader.read();\r\n        let {done, value} = ret;\r\n        if (done) {\r\n            this.resultSections.seconds = (new Date().getTime() - this.startTime.getTime());\r\n            let {action, services} = this.props;\r\n            if (services !== undefined) {\r\n                let now = Date.now() / 1000;\r\n                for (let service of services) {\r\n                    switch (action) {\r\n                        case 'test': service.compile_time = now; break;\r\n                        case 'deploy': service.deploy_time = now; break;\r\n                    }\r\n                }\r\n            }\r\n            return true;\r\n\t\t}\r\n\t\tlet buf:Uint8Array = value;\r\n\t\tfor (let p=0; p<buf.length; p+=0x4000) {\r\n\t\t\tlet sec = buf.slice(p, p+0x4000);\r\n\t\t\tlet text = this.uintToString(sec as any);\r\n\t\t\t//this.resultSections.add(text);\r\n\t\t\tresultSections.add(text);\r\n\t\t\tthis.total += value.byteLength;\r\n\t\t}\r\n        return false;\r\n    }\r\n\r\n    async componentDidMount() {\r\n        nav.regConfirmClose(async ():Promise<boolean>=>{\r\n            if (this.resultSections.seconds>=0) return true;\r\n            return new Promise<boolean>((resolve, reject) => {\r\n                try {\r\n                    if (window.confirm(`正在${this.props.actionName}中，真的要中止吗？`) === true) {\r\n                        try {\r\n                            this.props.abortController.abort();\r\n                        }\r\n                        catch (err) {\r\n                            console.error(err);\r\n                        }\r\n                        resolve(true);\r\n                    }\r\n                    else {\r\n                        resolve(false);\r\n                    }\r\n                }\r\n                catch (err) {\r\n                    reject(err);\r\n                }\r\n            })\r\n        });\r\n        \r\n        this.startAutoScrollToBottom();\r\n        try {\r\n            let reader = this.props.res.body.getReader();\r\n            this.startTime = new Date();\r\n\t\t\tthis.total = 0;\r\n\t\t\tlet containerElement = document.getElementById('scrollDiv') as HTMLDivElement;\r\n\t\t\tlet resultSections = new ResultSections(containerElement);\r\n            while (true) {\r\n\t\t\t\tlet retPump = await this.pump(reader, resultSections);\r\n                if (retPump === true) break;\r\n            }\r\n        }\r\n        catch (err) {\r\n            console.error(err);\r\n        }\r\n        finally {\r\n            this.endAutoScrollToBottom();\r\n        }\r\n    }\r\n    private renderText = (section:Section, index:number):JSX.Element => {\r\n        return <section.render key={section.rowId} />;\r\n    }\r\n    render() {\r\n        let {uq, actionName, caption} = this.props;\r\n        let {seconds, /*sections, */hasError} = this.resultSections;\r\n        let finish = hasError === true? '发生错误' : '完成';\r\n\t\tlet header:string;\r\n\t\tif (caption) header = '[' + caption + '] ';\r\n\t\telse header = '';\r\n        if (uq !== undefined) header += uq.name + ' - ';\r\n\t\theader += actionName + (seconds>=0? finish : \"中...\");\r\n        return <Page header={header} back=\"close\" onScroll={this.onScroll}>\r\n            <div id='topDiv' />\r\n            <div id='scrollDiv'\r\n                onDoubleClick={this.doubleClick} \r\n                className='py-2 px-3' \r\n                style={{wordWrap: 'break-word', whiteSpace: 'normal'}}>\r\n                {/*sections.map(this.renderText)*/}\r\n            </div>\r\n            {seconds>=0? <div className='px-3 pb-3' style={{color: 'red', fontWeight: 'bold'}}>\r\n                {actionName}完成。共计用时{Math.floor(seconds/1000)}秒\r\n            </div> : undefined}\r\n            <div id='bottomDiv' />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { nav, Page } from 'tonva';\r\nimport { List, EasyDate, LMR, Muted } from 'tonva';\r\nimport { store } from '../../store';\r\nimport { UqActionProps } from './uqActionProps';\r\nimport { CompileResultPage } from './compileResultPage';\r\n\r\ninterface State {\r\n    files: any[];\r\n    compiled?: string;\r\n    text?: string;\r\n}\r\n\r\n//const fastUpload = '快速测试';\r\n//const thoroughlyUpload = '完全测试';\r\nexport class UqUpload extends React.Component<UqActionProps, State> {\r\n    private fileInput: HTMLInputElement;\r\n\r\n    constructor(props: UqActionProps) {\r\n        super(props);\r\n        this.state = {\r\n            files: undefined,\r\n        }\r\n    }\r\n\r\n    private onFilesChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let upFiles: any[] = [];\r\n        let { files } = evt.target;\r\n        let len = files.length;\r\n        for (let i = 0; i < len; i++) {\r\n            upFiles.push(files[i]);\r\n        }\r\n        this.setState({\r\n            files: upFiles,\r\n        });\r\n    }\r\n    fileRender(file: any, index: number): JSX.Element {\r\n        let { name, size, lastModifiedDate } = file;\r\n        function sz(): string {\r\n            let n: number, u: string;\r\n            if (size < 1024) {\r\n                n = size; u = 'b';\r\n            }\r\n            else if (size < 1024 * 1024) {\r\n                n = Math.trunc((size / 1024) * 100) / 100; u = 'k';\r\n            }\r\n            else {\r\n                n = Math.trunc((size / 1024 / 1024) * 100) / 100; u = 'm';\r\n            }\r\n            return n + ' ' + u;\r\n        }\r\n        return <LMR className=\"px-2 py-1\" right={<Muted>{sz()}</Muted>}>\r\n            <div>{name}</div>\r\n            <div><Muted>修改日期: <EasyDate date={lastModifiedDate} /></Muted></div>\r\n        </LMR>;\r\n    }\r\n    private fileClick = (file: any) => {\r\n        let fr = new FileReader();\r\n        fr.onload = function (f) {\r\n            nav.push(<UqPage name={file.name} content={this.result} />)\r\n        }\r\n        fr.readAsText(file, \"utf8\");\r\n    }\r\n    private onSubmit = (evt: React.FormEvent<any>) => {\r\n        evt.preventDefault();\r\n    }\r\n\r\n    private async upload() {\r\n        var files: FileList = this.fileInput.files;\r\n        var data = new FormData();\r\n        let len = files.length;\r\n        for (let i = 0; i < len; i++) {\r\n            let file = files[i];\r\n            data.append('files[]', file, file.name);\r\n        }\r\n\r\n        let url = store.uqServer + 'uq-compile/' + this.props.uq.id + '/upload';\r\n        try {\r\n            let abortController = new AbortController();\r\n            let res = await fetch(url, {\r\n                method: \"POST\",\r\n                body: data,\r\n                signal: abortController.signal,\r\n            });\r\n            nav.push(<CompileResultPage {...this.props}\r\n                actionName=\"上传\"\r\n                action=\"upload\"\r\n                res={res} abortController={abortController} />);\r\n        }\r\n        catch (e) {\r\n            console.error('%s %s', url, e);\r\n        }\r\n    }\r\n    private onUpload = async () => {\r\n        nav.ceaseTop();\r\n        await this.upload();\r\n    }\r\n    render() {\r\n        let { files } = this.state;\r\n        let fileList: any;\r\n        if (files !== undefined) {\r\n            fileList = <List\r\n                className=\"my-3\"\r\n                items={files}\r\n                item={{ render: this.fileRender, onClick: this.fileClick }} />;\r\n        }\r\n        let button: any;\r\n        if (files !== undefined && files.length > 0) {\r\n            button = <div className=\"my-2 d-flex\">\r\n                <button className=\"btn btn-primary\" type=\"submit\" onClick={this.onUpload}>提交UQ</button>\r\n            </div>;\r\n        }\r\n        return <Page header={'提交UQ - ' + this.props.uq.name}>\r\n            <div className=\"py-2 px-3\">\r\n                <form className=\"my-1\" encType=\"multipart/form-data\" onSubmit={this.onSubmit}>\r\n                    <div className=\"my-1\">\r\n                        <button className=\"btn btn-outline-success\"\r\n                            onClick={() => this.fileInput.click()}>选择UQ源代码文件</button>\r\n                        <input\r\n                            ref={(fileInput) => this.fileInput = fileInput}\r\n                            type=\"file\"\r\n                            className=\"w-100 form-control-file d-none\"\r\n                            name=\"files\" multiple={true}\r\n                            onChange={this.onFilesChange} />\r\n                    </div>\r\n                    {fileList}\r\n                    {button}\r\n                </form>\r\n                <pre>{this.state.compiled}</pre>\r\n                <div>{this.state.text}</div>\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n\r\ninterface Options {\r\n    action: 'test' | 'deploy';\r\n    caption: string;\r\n    compile: string;\r\n    //fast: string;\r\n    //thoroughly: string;\r\n    description: any;\r\n}\r\nconst test: Options = {\r\n    action: 'test',\r\n    caption: '测试版',\r\n    compile: '编译',\r\n    //fast: '快速编译',\r\n    //thoroughly: '完全编译',\r\n    description: <>\r\n        <li>用上传的UQ代码，生成测试数据库</li>\r\n        <li>自动做增量快速编译。比较源代码，仅对修改的源代码，生成数据库</li>\r\n        <li>编译器升级后，会自动完全编译</li>\r\n    </>\r\n}\r\n\r\nconst deploy: Options = {\r\n    action: 'deploy',\r\n    caption: '发布版',\r\n    compile: '编译',\r\n    //fast: '快速编译',\r\n    //thoroughly: '完全编译',\r\n    description: <>\r\n        <li>将已经编译测试过的代码，发布到生产服务器</li>\r\n        <li>自动做增量快速编译。比较源代码，仅对修改的源代码，生成数据库</li>\r\n        <li>编译器升级后，会自动完全编译</li>\r\n    </>\r\n}\r\n\r\nexport class UqDeploy extends React.Component<UqActionProps> {\r\n    readonly options: Options;\r\n    constructor(props: UqActionProps) {\r\n        super(props);\r\n        switch (props.action) {\r\n            case 'test':\r\n                this.options = test;\r\n                break;\r\n            case 'deploy':\r\n                this.options = deploy;\r\n                break;\r\n        }\r\n    }\r\n\r\n    private onCompile = async () => {\r\n        nav.ceaseTop();\r\n        //let thoroughly = false;\r\n        await this.compile(/*thoroughly*/);\r\n    }\r\n    /*\r\n    private onCompileThoroughly = async () => {\r\n        nav.ceaseTop();\r\n        let thoroughly = true;\r\n        await this.compile(thoroughly);\r\n    }\r\n    */\r\n    private async compile(/*isThoroughly: boolean*/) {\r\n        let { caption, action, compile/* thoroughly, fast*/ } = this.options;\r\n        let url = store.uqServer + 'uq-compile/' + this.props.uq.id + '/' + action;\r\n        let actionName: string;\r\n        /*if (isThoroughly === true) {\r\n            actionName = thoroughly;\r\n            url += '-thoroughly';\r\n        }\r\n        else {*/\r\n        actionName = compile; //fast;\r\n        //}\r\n        try {\r\n            let abortController = new AbortController();\r\n            let res = await fetch(url, {\r\n                method: \"POST\",\r\n                signal: abortController.signal,\r\n            });\r\n            nav.push(<CompileResultPage {...this.props}\r\n                caption={caption}\r\n                action={action}\r\n                actionName={actionName}\r\n                res={res} abortController={abortController} />);\r\n        }\r\n        catch (e) {\r\n            console.error('%s %s', url, e);\r\n        }\r\n    }\r\n    render() {\r\n        let { caption, compile, /*fast, thoroughly, */description } = this.options;\r\n        return <Page header={caption + ' - ' + this.props.uq.name}>\r\n            <div className=\"bg-white p-3\">\r\n                <ul className=\"my-3\">{description}</ul>\r\n                <div className=\"d-flex p-3 justify-content-center\">\r\n                    <button className=\"btn btn-primary w-8c\"\r\n                        type=\"submit\" onClick={this.onCompile}>\r\n                        {compile}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n        /*\r\n                    <div className=\"py-2 flex-grow-1\" />\r\n                    <button className=\"btn btn-outline-warning\"\r\n                        type=\"submit\" onClick={this.onCompileThoroughly}>{thoroughly}</button>\r\n        */\r\n    }\r\n}\r\n\r\ninterface UqPgeProps {\r\n    name: string;\r\n    content: string | ArrayBuffer;\r\n}\r\nclass UqPage extends React.Component<UqPgeProps> {\r\n    render() {\r\n        return <Page header={this.props.name}>\r\n            <pre className=\"px-3 py-2\">{this.props.content}</pre>\r\n        </Page>;\r\n    }\r\n}\r\n","import { IdPickProps, createIdPick } from '../../tools';\r\nimport { store, caches } from 'store';\r\nimport { Field, FormRow, TonvaForm, SubmitResult } from 'tonva-form';\r\nimport { CUq } from './CUq';\r\nimport { VPage, nav, Page } from 'tonva';\r\nimport { DevServer, Unit } from 'model';\r\n\r\nconst ServerCaption = (item:DevServer) => {\r\n    let {discription, cloud, ip} = item;\r\n    return <>{discription} {cloud} {ip}</>;\r\n}\r\n\r\nconst idPickServerProps: IdPickProps = {\r\n    caption: '选择服务器',\r\n    searchPlaceHolder: '搜索服务器',\r\n    candidateItems: async (params:any, key:string) => {\r\n        await store.dev.searchServer.first(key);\r\n        return store.dev.searchServer.items;\r\n    },\r\n    moreCandidates: async () => {\r\n        await store.dev.searchServer.more();\r\n    },\r\n    row: (item:DevServer, index:number) => {\r\n        return <div className=\"px-3 py-2\"><ServerCaption {...item} /></div>;\r\n    },\r\n};\r\n\r\nconst serverField:Field = {name: 'server', type: 'id', required: true};\r\nconst testServerField:Field = {name: 'serverTest', type: 'id', required: true};\r\nconst uqUniqueUnitField:Field = {name: 'uqUniqueUnit', type: 'id', required: true};\r\nconst dbField:Field = {name: 'db', type: 'string', maxLength:50, required: true};\r\n\r\nconst fromPicked = (item:DevServer)=>{\r\n\treturn {\r\n\t\tid: item.id, \r\n\t\tcaption: <ServerCaption {...item} />,\r\n\t};\r\n}\r\n\r\nconst itemFromId = (id:number)=>caches.servers.get(id);\r\n\r\nconst serverRow = {\r\n    label: '运行服务器',\r\n    field: serverField,\r\n    face: {\r\n        type: 'pick-id', \r\n        initCaption: '请选择运行服务器', \r\n        pick: createIdPick(idPickServerProps), //this.idPick,\r\n        fromPicked: fromPicked,\r\n        itemFromId: itemFromId,\r\n    },\r\n};\r\n\r\nconst testServerRow = {\r\n    label: '测试服务器', \r\n    field: testServerField,\r\n    face: {\r\n        type: 'pick-id', \r\n        initCaption: '请选择测试服务器', \r\n        pick: createIdPick(idPickServerProps), //this.idPick,\r\n        fromPicked: fromPicked,\r\n        itemFromId: itemFromId,\r\n    },\r\n};\r\n\r\n\r\nconst UnitCaption = (item:Unit) => {\r\n    let {name, discription} = item;\r\n    return <>{name ?? discription}</>;\r\n}\r\nconst idPickUnitProps: IdPickProps = {\r\n    caption: '选择小号($unit)',\r\n    searchPlaceHolder: '搜索小号($unit)',\r\n    candidateItems: async (params:any, key:string) => {\r\n        // await store.dev.searchServer.first(key);\r\n        //return store.dev.searchServer.items;\r\n        return store.accUnits;\r\n    },\r\n    moreCandidates: async () => {\r\n        // await store.dev.searchServer.more();\r\n    },\r\n    row: (item:Unit, index:number) => {\r\n        return <div className=\"px-3 py-2\"><UnitCaption {...item} /></div>;\r\n    },\r\n};\r\n\r\nconst uqUniqueUnitRow = {\r\n    label: '小号($unit)',\r\n    field: uqUniqueUnitField,\r\n    face: {\r\n        type: 'pick-id', \r\n        initCaption: '请选择小号($unit)', \r\n        pick: createIdPick(idPickUnitProps), \r\n        fromPicked: (item:Unit)=>{\r\n            return {\r\n                id: item.id, \r\n                caption: <UnitCaption {...item} />,\r\n            };\r\n        },\r\n        itemFromId: (id:number)=>caches.units.get(id),\r\n    },\r\n};\r\n\r\nconst dbRow = {\r\n    label: '数据库名字',\r\n    field: dbField,\r\n};\r\n\r\nexport class NewServicePage extends VPage<CUq> {\r\n    private formRows:FormRow[] = [\r\n        dbRow,\r\n        uqUniqueUnitRow,\r\n\t\tserverRow,\r\n\t\ttestServerRow,\r\n    ];\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n    private onSubmit = async (values:any):Promise<SubmitResult | undefined> => {\r\n        values.type = 2; // uq type, to be removed\r\n        values.uqId = this.controller.uq.id;\r\n        let ret = await this.controller.saveService(values);\r\n        if (ret === 0) {\r\n            return;\r\n        }\r\n        nav.pop();\r\n        return;\r\n    }\r\n    private page = () => {\r\n        return <Page header=\"新建Service\">\r\n            <TonvaForm className=\"m-3\" formRows={this.formRows} onSubmit={this.onSubmit} />\r\n        </Page>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { Page, VPage, nav } from 'tonva';\r\nimport { CUq } from './CUq';\r\nimport { Prop, PropGrid } from 'tonva';\r\nimport { StringValueEdit, ServerSpan, UnitSpan } from 'tools';\r\nimport { observer } from 'mobx-react';\r\nimport { DevService } from 'model';\r\n\r\nexport class ServicePage extends VPage<CUq> {\r\n    @observable private service: DevService;\r\n    async open(service: DevService) {\r\n        this.service = service;\r\n        this.openPage(this.page);\r\n    }\r\n    private async changeProp(prop:string, value:any):Promise<any> {\r\n        return await this.controller.changeServiceProp(this.service, prop, value);\r\n\t}\r\n    private onDbChanged = async (value:any, orgValue:any):Promise<string|void> => {\r\n        let ret = await this.changeProp('db', value);\r\n        if (ret === 0) {\r\n            return 'Db已经被使用了';\r\n        }\r\n        this.service.db = value;\r\n    }\r\n    private onUnitPick = async () => {\r\n        let ret = await this.controller.pickUnit();\r\n        this.changeProp('uq_unique_unit', ret);\r\n        this.service.uqUniqueUnit = ret;\r\n    }\r\n    private onServerPick = async () => {\r\n        let ret = await this.controller.pickServer();\r\n        this.changeProp('server', ret);\r\n        this.service.server = ret;\r\n    }\r\n    private onServerTestPick = async () => {\r\n        let ret = await this.controller.pickServer();\r\n        this.changeProp('server_test', ret);\r\n        this.service.serverTest = ret;\r\n    }\r\n    private onDeleteClick = async () => {\r\n        if (window.confirm(\"真的要删除Service吗？删除了不可恢复，需要重新录入。\")!==true) return;\r\n        await this.controller.delService(this.service);\r\n        nav.pop();\r\n    }\r\n    private page = observer(() => {\r\n        let {uq} = this.controller;\r\n        let rows:Prop[] = [\r\n            '',\r\n            {\r\n                type: 'string',\r\n                name: 'db',\r\n                label: '数据库名',\r\n                onClick: ()=>nav.push(<StringValueEdit \r\n                    title=\"数据库名字\"\r\n                    value={this.service.db}\r\n                    onChanged={this.onDbChanged} />)\r\n            },\r\n            {\r\n                type: 'component',\r\n                label: '小号($unit)',\r\n                component: <UnitSpan id={this.service.uqUniqueUnit} />,\r\n                onClick: this.onUnitPick\r\n            },\r\n            '',\r\n            {\r\n                type: 'component',\r\n                label: '生产服务器',\r\n                component: <ServerSpan id={this.service.server} />,\r\n                onClick: this.onServerPick\r\n            },\r\n            {\r\n                type: 'component',\r\n                label: '测试服务器',\r\n                component: <ServerSpan id={this.service.serverTest} />,\r\n                onClick: this.onServerTestPick\r\n\t\t\t},\r\n        ];\r\n        let right = <button onClick={this.onDeleteClick} \r\n            className=\"btn btn-sm btn-success align-self-center\">删除</button>;\r\n        return <Page header={'UQ - ' + uq.name} right={right}>\r\n            <PropGrid rows={rows} values={this.service} />\r\n        </Page>\r\n    })\r\n}\r\n\r\n","import { CUq } from './CUq';\r\nimport { VPage, nav, Page } from 'tonva';\r\nimport { SubmitResult, TonvaForm } from 'tonva-form';\r\n\r\nconst formRows = [\r\n    {\r\n        label: '名称', \r\n        field: {name: 'name', type: 'string', maxLength: 100, required: true},\r\n    },\r\n    {\r\n        label: '描述',\r\n        field: {name: 'discription', type: 'string', maxLength: 250},\r\n        face: {type: 'textarea'}\r\n    },\r\n    //{\r\n    //    label: '入口',\r\n    //    field: {name: 'access', type: 'string', maxLength: 250},\r\n    //    face: {type: 'textarea', placeholder: '逗号分隔的入口名'}\r\n    //},\r\n];\r\n\r\n\r\nexport abstract class EditBasePage extends VPage<CUq> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n    protected onSubmit = async (values:any):Promise<SubmitResult> => {\r\n        await this.controller.saveUq(values);\r\n        nav.pop();\r\n        return;\r\n    }\r\n    protected page: ()=>JSX.Element;\r\n    protected form(initValues:any):JSX.Element {\r\n        return <TonvaForm\r\n            className=\"m-3\"\r\n            formRows={formRows} \r\n            onSubmit={this.onSubmit} initValues={initValues} />\r\n    }\r\n}\r\n\r\nexport class EditPage extends EditBasePage {\r\n    protected page = () => {\r\n        let {uq} = this.controller;\r\n        let {name} = uq;\r\n        return <Page header={'修改UQ - ' + name} back=\"close\">\r\n            {this.form(uq)}\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class NewPage extends EditBasePage {\r\n    protected page = () => {\r\n        return <Page header={'新建UQ'} back=\"close\">\r\n            {this.form({})}\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, nav, EasyTime } from 'tonva';\r\nimport { CUq } from './CUq';\r\nimport { IdDates, UnitSpan, ServerSpan } from 'tools';\r\nimport { Prop, LMR, FA, PropGrid, Muted, List, DropdownActions } from 'tonva';\r\nimport { EditPage } from './editPage';\r\nimport { store } from 'store';\r\nimport { observer } from 'mobx-react';\r\nimport { DevService } from 'model';\r\n\r\nexport class UQPage extends VPage<CUq> {\r\n    async open() {\r\n        this.openPageElement(React.createElement(this.page));\r\n    }\r\n\r\n    private editItem = async () => {\r\n        await this.openVPage(EditPage);\r\n    }\r\n\r\n    private deleteItem = async () => {\r\n        if (window.confirm('真的要删除UQ吗？') === true) {\r\n            await this.controller.deleteUq();\r\n            nav.pop();\r\n        }\r\n    }\r\n\r\n    private page = observer((): JSX.Element => {\r\n        let { onUqUpload, onUqTest, onUqDeploy, onUqDevsAdmin, serviceClick, uq, services } = this.controller;\r\n        let { unit } = store;\r\n        let { isOwner } = unit;\r\n        let { name, discription, unit: unitId, date_init, date_update } = uq;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        let menuItems = [\r\n            { caption: '修改UQ', action: this.editItem, icon: 'edit' },\r\n            { caption: '删除', action: this.deleteItem, icon: 'trash-o' }\r\n        ];\r\n        let right = isOwner > 0 && <DropdownActions className=\"btn-primary me-2\" actions={menuItems} />;\r\n        let angle = <FA className=\"align-self-center\" name=\"angle-right\" />;\r\n        let action = (icon: string, cnIcon: string, label: string, onClick: () => void): Prop => {\r\n            return {\r\n                type: 'component',\r\n                label: undefined, // '上传UQ', \r\n                component: <LMR onClick={onClick} className=\"w-100 py-2 cursor-pointer\"\r\n                    left={<span className=\"align-self-center\"><FA className={cnIcon} name={icon} fixWidth={true} /> &nbsp; {label}</span>} right={angle} />\r\n            };\r\n        };\r\n        let rows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <LMR className=\"py-2\"\r\n                    left={<FA name=\"database\" className=\"text-primary fa-2x me-3\" />}>\r\n                    <div><b>{name}</b></div>\r\n                    {disp}\r\n                </LMR>\r\n            },\r\n            {\r\n                type: 'component',\r\n                label: '开发号',\r\n                component: <div className=\"py-2\"><UnitSpan id={unitId} isLink={true} /></div>\r\n            },\r\n            '',\r\n            action('code', 'text-info', '上传提交UQ代码', onUqUpload),\r\n            action('database', 'text-warning', '测试版 - 编译UQ数据库', onUqTest),\r\n            action('database', 'text-success', '发布版 - 编译UQ数据库', onUqDeploy),\r\n        ];\r\n\r\n        let adminDev: any;\r\n        let btnAddService: any;\r\n        if (isOwner > 0) {\r\n            btnAddService = <button\r\n                className=\"btn btn-outline-primary btn-sm\"\r\n                onClick={() => this.controller.showNewServicePage()}>\r\n                增加\r\n            </button>;\r\n            let devList = this.controller.uqDevs.filter(v => v.isOwner === 0);\r\n            adminDev = <>\r\n                <div className=\"d-flex mx-3 mt-3 mb-1 align-items-end\">\r\n                    <Muted style={{ display: 'block', flex: 1 }}>开发者</Muted>\r\n                    <button\r\n                        className=\"btn btn-outline-primary btn-sm\"\r\n                        onClick={onUqDevsAdmin}>\r\n                        管理\r\n                    </button>\r\n                </div>\r\n                <div className=\"px-3 py-2 d-flex flex-wrap bg-white\">\r\n                    {\r\n                        devList.length === 0 ?\r\n                            <div className=\"small text-muted\">[无]</div>\r\n                            :\r\n                            devList.map((v: any) => {\r\n                                return <div key={v.userId} className=\"my-2 me-3\">{v.nick || v.name}</div>\r\n                            })}\r\n                </div>\r\n            </>;\r\n        }\r\n\r\n        let onServiceClick: any;\r\n        if (isOwner > 0) onServiceClick = serviceClick;\r\n\r\n        return <Page header={'UQ - ' + name} right={right}>\r\n            <PropGrid rows={rows} values={uq} />\r\n            {adminDev}\r\n            <div className=\"d-flex mx-3 mt-3 mb-1 align-items-end\">\r\n                <Muted style={{ display: 'block', flex: 1 }}>Service</Muted>\r\n                {btnAddService}\r\n            </div>\r\n            <List items={services} item={{\r\n                render: (service: DevService, index: number) =>\r\n                    React.createElement(this.renderService, { service, index }),\r\n                onClick: onServiceClick\r\n            }} />\r\n        </Page>;\r\n    });\r\n    private renderService = observer((props: { service: DevService; index: number }): JSX.Element => {\r\n        let { service } = props;\r\n        let { db, server, serverTest, uqUniqueUnit, compile_time, deploy_time } = service;\r\n        let compile = !compile_time ?\r\n            <Muted>未测试</Muted>\r\n            :\r\n            <EasyTime date={compile_time} />;\r\n        let deploy = !deploy_time ?\r\n            <Muted>未发布</Muted>\r\n            :\r\n            <EasyTime date={deploy_time} />;\r\n\r\n        return <div className=\"d-block w-100 cursor-pointer mb-2 py-2 px-3\">\r\n            <div>\r\n                <small>数据库名：</small>{db}\r\n                &nbsp; &nbsp; &nbsp;\r\n                <small>小号($unit)：</small><UnitSpan id={uqUniqueUnit} />\r\n            </div>\r\n            <LMR className=\"align-items-center\"\r\n                right={<small>{deploy}</small>}>\r\n                <div>\r\n                    <small>生产：</small>\r\n                    <ServerSpan id={server} />\r\n                </div>\r\n            </LMR>\r\n            <LMR className=\"align-items-center\"\r\n                right={<small>{compile}</small>}>\r\n                <div>\r\n                    <small>测试：</small>\r\n                    <ServerSpan id={serverTest} />\r\n                </div>\r\n            </LMR>\r\n        </div>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, EasyTime, DropdownActions, DropdownAction, nav } from 'tonva';\r\nimport { CUq } from './CUq';\r\nimport { List, LMR, Muted, FA } from 'tonva';\r\nimport { NewPage } from './editPage';\r\nimport { store } from 'store';\r\nimport { DevUQ } from 'model';\r\nimport { CompileResultPage } from './compileResultPage';\r\n\r\nexport class ListPage extends VPage<CUq> {\r\n    async open(param: any) {\r\n        this.openPage(this.page);\r\n    }\r\n    private newItem = () => {\r\n        this.controller.uq = undefined;\r\n        this.openVPage(NewPage);\r\n    }\r\n    private batchCompile = () => {\r\n        this.openPage(this.batchCompilePage);\r\n    }\r\n    private page = (): JSX.Element => {\r\n        let { uqList: list, listRowClick } = this.controller;\r\n        let { isOwner } = store.unit;\r\n        let actions: DropdownAction[] = [\r\n            { icon: 'plus', caption: '新增UQ', action: this.newItem },\r\n            { icon: 'plus', caption: '批量编译', action: this.batchCompile },\r\n        ];\r\n        let right = isOwner > 0 &&\r\n            <DropdownActions className=\"btn-primary me-2 align-self-center\" icon=\"bars\" actions={actions}>\r\n                <button className='btn btn-primary btn-sm' onClick={() => this.newItem()}><FA name=\"plus\" /></button>\r\n            </DropdownActions>\r\n        return <Page header=\"UQ\" right={right}>\r\n            <List items={list} item={{ render: this.listRow, onClick: listRowClick }} />\r\n        </Page>\r\n    }\r\n    private listRow = (item: DevUQ): JSX.Element => {\r\n        let { name, discription, service_count, date_update } = item;\r\n        return <LMR className=\"py-1 px-3 align-items-center\"\r\n            left={<FA name=\"database\" className=\"text-primary fa-lg\" />}\r\n            right={<div className=\"text-end\">\r\n                <div><small className=\"text-muted\">服务数:</small> {service_count}</div>\r\n                <div className=\"small text-muted\"><EasyTime date={date_update} /></div>\r\n            </div>}>\r\n            <div className=\"py-2 px-3\">\r\n                <div><b>{name}</b></div>\r\n                <div><Muted>{discription}</Muted></div>\r\n            </div>\r\n        </LMR>;\r\n    }\r\n\r\n    private onSelect = (item: DevUQ, isSelected: boolean, anySelected: boolean) => {\r\n        //alert('ok');\r\n    }\r\n\r\n    private listCompileRow = (item: DevUQ): JSX.Element => {\r\n        let { name, discription, date_update } = item;\r\n        return <LMR className=\"py-1 px-3 align-items-center\"\r\n            left={<FA name=\"database\" className=\"text-info fa-lg\" />}\r\n            right={<div className=\"text-end\">\r\n                <div className=\"small text-muted\"><EasyTime date={date_update} /></div>\r\n            </div>}>\r\n            <div className=\"py-2 px-3\">\r\n                <div><b>{name}</b></div>\r\n                <div><Muted>{discription}</Muted></div>\r\n            </div>\r\n        </LMR>;\r\n    }\r\n\r\n    private list: List;\r\n    private selectAll = () => {\r\n        this.list.selectAll();\r\n    }\r\n    private unselectAll = () => {\r\n        this.list.unselectAll();\r\n    }\r\n    private test = () => {\r\n        this.compile('test', false);\r\n    }\r\n    /*\r\n    根据uq编译器版本，自动决定是不是需要彻底编译\r\n    private testThoroughly = () => {\r\n        this.compile('test', true);\r\n    }\r\n    */\r\n    private deploy = () => {\r\n        this.compile('deploy', false);\r\n    }\r\n    /*\r\n    根据uq编译器版本，自动决定是不是需要彻底编译\r\n    private deployThoroughly = () => {\r\n        this.compile('deploy', true);\r\n    }\r\n    */\r\n    private async compile(action: 'test' | 'deploy', thoroughly: boolean) {\r\n        let selectItems = this.list.selectedItems;\r\n        //let {action, thoroughly, fast} = this.options;\r\n        let url = store.uqServer + 'uq-compile/batch';\r\n        let actionName: string;\r\n        switch (action) {\r\n            case 'test': actionName = '测试'; break;\r\n            case 'deploy': actionName = '发布'; break;\r\n        }\r\n        try {\r\n            let abortController = new AbortController();\r\n            let body = {\r\n                test: action === 'test',\r\n                thoroughly: thoroughly,\r\n                uqs: selectItems.map(v => v.id)\r\n            };\r\n            //let data = new FormData();\r\n            //data.append( \"json\", JSON.stringify(body) );\r\n            let res = await fetch(url, {\r\n                method: \"POST\",\r\n                signal: abortController.signal,\r\n                headers: {\r\n                    //'Accept': 'application/json',\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify(body)\r\n            });\r\n            nav.push(<CompileResultPage uq={undefined} services={undefined}\r\n                action={action}\r\n                actionName={actionName}\r\n                res={res} abortController={abortController} />);\r\n        }\r\n        catch (e) {\r\n            console.error('%s %s', url, e);\r\n        }\r\n    }\r\n\r\n    private batchCompilePage = (): JSX.Element => {\r\n        let { uqList: list } = this.controller;\r\n        let right = <span>\r\n            <button className=\"btn btn-sm btn-link\" onClick={this.selectAll}>全选</button>\r\n            <button className=\"btn btn-sm btn-link\" onClick={this.unselectAll}>全清</button>\r\n        </span>;\r\n        let cnBtn = 'btn btn-sm btn-outline-primary me-3';\r\n        let bar = <span className=\"px-3 py-1 d-flex w-100\">\r\n            <span className=\"flex-grow-1\">\r\n                <button className={cnBtn} onClick={this.test}>测试</button>\r\n                <button className={cnBtn} onClick={this.deploy}>发布</button>\r\n            </span>\r\n            {right}\r\n        </span>;\r\n        /*\r\n        根据uq编译器版本，自动决定是不是需要彻底编译\r\n        <button className={cnBtn} onClick={this.testThoroughly}>彻底测试</button>\r\n        <button className={cnBtn} onClick={this.deployThoroughly}>彻底发布</button>\r\n        */\r\n\r\n        return <Page header=\"批量编译\" footer={bar}>\r\n            <List ref={list => this.list = list} items={list} item={{ render: this.listCompileRow, onSelect: this.onSelect }} />\r\n        </Page>\r\n    }\r\n}\r\n\r\n","import { VPage, Page, LMR, Image, List } from 'tonva';\r\nimport { CUq } from './CUq';\r\nimport { UnitAdmin } from '../../model';\r\n\r\nexport class VUqDevsAdmin extends VPage<CUq> {\r\n    async open() {\r\n        await this.controller.loadAdmins();\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onSelect = async (admin: any, isSelected: boolean) => {\r\n        await this.controller.devChanged(admin, isSelected);\r\n    }\r\n\r\n    private page = (): JSX.Element => {\r\n        let { uqDevs, admins } = this.controller;\r\n        let selectedItems = admins.devs.filter(v => uqDevs.find(d => d.userId === v.id) !== undefined);\r\n        let listHeader = <div className=\"px-3 py-1 small text-muted\">开发者</div>;\r\n        return <Page header=\"增减开发者\">\r\n            <div className='my-3'>\r\n                {listHeader}\r\n                <List\r\n                    items={admins.devs}\r\n                    none='[无]'\r\n                    selectedItems={selectedItems}\r\n                    item={{ onSelect: this.onSelect, render: this.row }}\r\n                />\r\n            </div>\r\n        </Page>;\r\n    }\r\n\r\n    private row = ({ icon, name, nick }: UnitAdmin) => {\r\n        let content = nick ?\r\n            <><b>{nick}</b> &nbsp; <small className=\"text-muted\">{name}</small></>\r\n            :\r\n            <b>{name}</b>;\r\n        let left = <Image className=\"w-2-5c h-2-5c\" src={icon} />;\r\n        return <LMR className=\"py-2 px-3 align-items-stretch\" left={left}>\r\n            <div className=\"px-3\">{content}</div>\r\n        </LMR>;\r\n    }\r\n\r\n}\r\n","import { CUqBase } from \"UqApp\";\r\nimport { VPage, Page, SearchBox, List, PageItems } from \"tonva\";\r\nimport { observer } from 'mobx-react';\r\nimport { devApi } from 'api';\r\nimport { store } from 'store';\r\nimport { ServerSpan } from 'tools';\r\nimport { DevServer } from 'model';\r\n\r\nexport class CPickServer extends CUqBase {\r\n    pageItems: PageServerItems;\r\n\r\n    async internalStart() {\r\n        this.pageItems = new PageServerItems();\r\n    }\r\n\r\n    async pick(): Promise<number> {\r\n        this.pageItems = new PageServerItems();\r\n        await this.pageItems.first('');\r\n        return await this.vCall(VPickServer);\r\n    }\r\n\r\n    onSearch = async (key: string): Promise<void> => {\r\n        await this.pageItems.first(key);\r\n    }\r\n}\r\n\r\nclass PageServerItems extends PageItems<DevServer> {\r\n    protected async loadResults(param: any, pageStart: any, pageSize: number): Promise<{ [name: string]: DevServer[] }> {\r\n        let unitId = store.unit.id;\r\n        let ret = await devApi.searchServer(unitId, param, pageStart, pageSize);\r\n        return { $page: ret };\r\n    }\r\n    protected setPageStart(item: DevServer): void {\r\n        this.pageStart = item === undefined ? 0 : item.id;\r\n    }\r\n}\r\n\r\nclass VPickServer extends VPage<CPickServer> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderServer = (server: DevServer, index: number): JSX.Element => {\r\n        return <div className=\"px-3 py-2\"><ServerSpan id={server.id} /></div>;\r\n    }\r\n\r\n    private clickServer = (server: DevServer) => {\r\n        this.closePage();\r\n        this.returnCall(server.id);\r\n    }\r\n\r\n    private onClickNullServer = () => {\r\n        this.closePage();\r\n        this.returnCall(null);\r\n    }\r\n\r\n    private page = observer((): JSX.Element => {\r\n        let searchBox = <SearchBox label=\"选择服务器\" onSearch={this.controller.onSearch} />\r\n        return <Page header={searchBox}>\r\n            <div className=\"px-3 py-2 cursor-pointer bg-white border-bottom\"\r\n                onClick={this.onClickNullServer}>\r\n                <span className=\"text-danger me-3\">NULL</span>\r\n                <small className=\"text-muted\">[不选服务器]</small>\r\n            </div>\r\n            <List items={this.controller.pageItems.items}\r\n                item={{ render: this.renderServer, onClick: this.clickServer }} />\r\n        </Page>;\r\n    });\r\n}\r\n","import {observable} from 'mobx';\r\nimport {Unit, UnitAdmin} from '../model';\r\nimport {mainApi} from '../api';\r\n//import {Store} from './store';\r\n\r\nexport class Admins {\r\n    //private store:Store;\r\n    private unit: Unit;\r\n    constructor(unit: Unit/*store:Store*/) {\r\n        //this.store = store;\r\n        this.unit = unit;\r\n    }\r\n\r\n    @observable cur: UnitAdmin = undefined;\r\n    @observable owners: UnitAdmin[] = undefined;\r\n    @observable admins: UnitAdmin[] = undefined;\r\n    @observable devs: UnitAdmin[] = undefined;\r\n    \r\n    async load(): Promise<void> {\r\n        let unit = this.unit;\r\n        if (unit === undefined) return;\r\n        if (unit.id === undefined) return;\r\n        if (this.admins !== undefined) return;\r\n        let all = await mainApi.unitAdmins(unit.id);\r\n        let owners:UnitAdmin[] = [];\r\n        let admins:UnitAdmin[] = [];\r\n        let devs:UnitAdmin[] = [];\r\n        all.forEach(ua => {\r\n            let {isOwner, isAdmin, isDev} = ua;\r\n            if (isDev)\r\n                devs.push(ua);\r\n            else {\r\n                if (isOwner === 1) owners.push(ua);\r\n                if (isAdmin === 1) admins.push(ua);\r\n            }\r\n        });\r\n        this.owners = owners;\r\n        this.admins = admins;\r\n        this.devs = devs;\r\n    }\r\n\r\n    private removeOneUnitAdmin(arr: UnitAdmin[], unitAdmin?: UnitAdmin) {\r\n        let index = arr.findIndex(v => v.id===unitAdmin.id);\r\n        if (index >=0) arr.splice(index, 1);\r\n    }\r\n\r\n    private removeUnitAdmin(unitAdmin?: UnitAdmin) {\r\n        if (unitAdmin === undefined) unitAdmin = this.cur;\r\n        this.removeOneUnitAdmin(this.owners, unitAdmin);\r\n        this.removeOneUnitAdmin(this.admins, unitAdmin);\r\n        this.removeOneUnitAdmin(this.devs, unitAdmin);\r\n    }\r\n\r\n    async unitSetAdmin(isOwner:number, isAdmin:number, isDev:number) {\r\n        let cur = this.cur;\r\n        let fellowId = cur.id, unitId = this.unit.id;\r\n        await mainApi.unitSetAdmin(fellowId, unitId, isOwner, isAdmin, isDev);\r\n        cur.isOwner = isOwner;\r\n        cur.isAdmin = isAdmin;\r\n        this.removeUnitAdmin();\r\n        if (isOwner === 0 && isAdmin === 0)\r\n            this.devs.unshift(cur);\r\n        else {\r\n            if (isOwner === 1) this.owners.unshift(cur);\r\n            if (isAdmin === 1) this.admins.unshift(cur);\r\n        }\r\n    }\r\n\r\n    async unitAddAdmin(user:string, isOwner:number, isAdmin:number, isDev:number):Promise<UnitAdmin|string> {\r\n        let admin = await mainApi.unitAddAdmin(user, this.unit.id, isOwner, isAdmin, isDev);\r\n        if (admin === undefined) return 'unauthorized';\r\n        let {r} = admin;\r\n        if (r !== undefined) return r;\r\n\r\n        let cur = this.cur = admin;\r\n        this.removeUnitAdmin();\r\n        if (isOwner === 0 && isAdmin === 0)\r\n            this.devs.unshift(cur);\r\n        else {\r\n            if (isOwner === 1) this.owners.unshift(cur);\r\n            if (isAdmin === 1) this.admins.unshift(cur);\r\n        }\r\n        return admin;\r\n    }\r\n\r\n    async unitDelAdmin(unitAdmin: UnitAdmin) {\r\n        await mainApi.unitDelAdmin(this.unit.id, unitAdmin.id);\r\n        if (this.cur === unitAdmin) this.cur = undefined;\r\n        this.removeUnitAdmin(unitAdmin);\r\n    }\r\n}\r\n","import { CUqBase } from \"UqApp\";\r\nimport { VPage, Page, List } from \"tonva\";\r\nimport { observer } from 'mobx-react';\r\nimport { store } from 'store';\r\nimport { UnitSpan } from 'tools';\r\nimport { UnitAdmin } from 'model';\r\n\r\nexport class CPickUnit extends CUqBase {\r\n    unitItems: UnitAdmin[];\r\n    \r\n    async internalStart() {\r\n    }\r\n\r\n    async pick(): Promise<number> {\r\n        this.unitItems = store.accUnits;\r\n        return await this.vCall(VPickUnit);\r\n    }\r\n}\r\n\r\nclass VPickUnit extends VPage<CPickUnit> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderUnit = (unitAdmin:UnitAdmin, index:number):JSX.Element => {\r\n        return <div className=\"px-3 py-2\"><UnitSpan id={unitAdmin.id} /></div>;\r\n    }\r\n\r\n    private clickUnit = (unitAdmin:UnitAdmin) => {\r\n        this.closePage();\r\n        this.returnCall(unitAdmin.id);\r\n\t}\r\n\t\r\n\tprivate onClickNullServer = () => {\r\n        this.closePage();\r\n        this.returnCall(null);\r\n\t}\r\n\r\n    private page = observer(():JSX.Element => {\r\n        return <Page header=\"选择小号($unit)\">\r\n            <List items={this.controller.unitItems}\r\n                item={{render:this.renderUnit, onClick:this.clickUnit}} />\r\n        </Page>;\r\n    });\r\n}\r\n","import _ from 'lodash';\r\nimport { observable } from 'mobx';\r\nimport { nav } from 'tonva';\r\nimport { Unit, DevUQ, DevService } from '../../model';\r\nimport { UqUpload, UqDeploy } from './uqUpload';\r\nimport { devApi } from 'api';\r\nimport { NewServicePage } from './newServicePage';\r\nimport { ServicePage } from './servicePage';\r\nimport { UQPage } from './uqPage';\r\nimport { ListPage } from './listPage';\r\nimport { VUqDevsAdmin } from './VUqDevsAdmin';\r\nimport { CUqBase } from 'UqApp';\r\nimport { CPickServer } from './CPickServer';\r\nimport { Admins } from 'store/admins';\r\nimport { CPickUnit } from './CPickUnit';\r\n\r\nexport class CUq extends CUqBase {\r\n    private unit: Unit;\r\n    uq: DevUQ;\r\n    access: string;\r\n    entities: string;\r\n    admins: Admins;\r\n    @observable uqDevs: any[];\r\n    @observable uqList: DevUQ[];\r\n    @observable services: DevService[];\r\n    protected async internalStart(unit:Unit) {\r\n        this.unit = unit;\r\n        this.uqList = await devApi.uqs(this.unit.id, 200);\r\n        this.openVPage(ListPage);\r\n    }\r\n\r\n    listRowClick = async (item:DevUQ) => {\r\n        this.uq = item;\r\n        await this.loadUqEntities(item.id);\r\n        this.openVPage(UQPage);\r\n    }\r\n\r\n    private async loadUqEntities(uqId: number) {\r\n        let ret = await devApi.uqGetEntities(this.unit.id, uqId);\r\n        let r0 = ret[0][0];\r\n        this.access = r0.access;\r\n        this.entities = r0.entities;\r\n        this.services = ret[1];\r\n        this.uqDevs = ret[4];\r\n    }\r\n\r\n    async loadAdmins() {\r\n        this.admins = new Admins(this.unit);\r\n        await this.admins.load();\r\n    }\r\n\r\n    async devChanged(admin:any, isSelected:boolean) {\r\n        let param = {\r\n            unit: this.unit.id,\r\n            type: 'uq',\r\n            dev: this.uq.id,\r\n            devUser: admin.id\r\n        };\r\n        if (isSelected === true) {\r\n            await devApi.adminDevAdd(param);\r\n            this.uqDevs.push({\r\n                userId: admin.id,\r\n                icon: admin.icon,\r\n                name: admin.name,\r\n                nick: admin.nick,\r\n                isOwner: 0,\r\n            });\r\n        }\r\n        else {\r\n            await devApi.adminDevDel(param);\r\n            let index = this.uqDevs.findIndex(v => v.userId === admin.id);\r\n            this.uqDevs.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    onUqDevsAdmin = () => {\r\n        this.openVPage(VUqDevsAdmin);\r\n    }\r\n\r\n    serviceClick = (service: DevService) => {\r\n        this.openVPage(ServicePage, service);\r\n    }\r\n\r\n    onUqUpload = async() => {\r\n        let onDispose = () => {}\r\n        nav.push(<UqUpload uq={this.uq} services={this.services} />, onDispose);\r\n    }\r\n\r\n    onUqTest = async() => {\r\n        let onDispose = () => {}\r\n        nav.push(<UqDeploy uq={this.uq} action=\"test\" services={this.services} />, onDispose);\r\n    }\r\n\r\n    onUqDeploy = async() => {\r\n        let onDispose = () => {}\r\n        nav.push(<UqDeploy uq={this.uq} action=\"deploy\" services={this.services} />, onDispose);\r\n    }\r\n\r\n    saveUq = async (values: DevUQ) => {\r\n        let uq: DevUQ;\r\n        if (this.uq === undefined) {\r\n            uq = _.clone(values);\r\n        }\r\n        else {\r\n            uq = _.clone(this.uq);\r\n            _.merge(uq, values);\r\n        }\r\n        uq.unit = this.unit.id;\r\n        let ret = await devApi.saveUq(uq);\r\n        uq.id = ret;\r\n        this.uqList.push(uq);\r\n    }\r\n\r\n    deleteUq = async () => {\r\n        await devApi.delUq(this.unit.id, this.uq.id);\r\n        let index = this.uqList.findIndex(v => v.id === this.uq.id);\r\n        if (index >= 0) this.uqList.splice(index);\r\n    }\r\n\r\n    async changeServiceProp(service: DevService, prop:string, value:any):Promise<any> {\r\n        return await devApi.changeServiceProp(this.unit.id, service.id, prop, value);\r\n    }\r\n\r\n    async saveService(service: DevService):Promise<number> {\r\n        let svc = _.clone(service);\r\n        svc.unit = this.unit.id;\r\n        if (!svc.urlTest) svc.urlTest = '-';\r\n        let ret = await devApi.saveService(svc);\r\n        svc.id = ret;\r\n        this.services.push(svc);\r\n        return ret;\r\n    }\r\n\r\n    async delService(service: DevService) {\r\n        await devApi.delService(this.unit.id, service.id);\r\n        let index = this.services.findIndex(v => v.id === service.id);\r\n        if (index >= 0) this.services.splice(index);\r\n    }\r\n\r\n    showNewServicePage = async () => {\r\n        await this.openVPage(NewServicePage);\r\n    }\r\n\r\n    pickServer = async () => {\r\n        let cPickServer = this.newC(CPickServer);\r\n        return await cPickServer.pick();\r\n    }\r\n\r\n    pickUnit = async () => {\r\n        let cPickUnit = this.newC(CPickUnit);\r\n        return await cPickUnit.pick();\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {EasyDate, Prop, PropGrid, LMR, Muted, FA} from 'tonva';\r\nimport {UnitSpan, IdDates} from '../tools';\r\nimport {store} from '../store';\r\nimport { ObjViewProps } from './ObjViewProps';\r\nimport { DevBus } from 'model';\r\n\r\nconst busIcon = 'cogs';\r\n\r\n@observer\r\nclass Info extends React.Component<DevBus> {\r\n    async componentDidMount() {\r\n        //await store.dev.buses.loadCurApis();\r\n    }\r\n    render() {\r\n        let {unit, owner, name, discription, mine, version, date_init, date_update} = this.props;\r\n        let disp = <small>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </small>;\r\n        let caption:any = owner + ' / ' + name;\r\n        if (mine === 1) {\r\n            caption = <b>{caption}</b>;\r\n        }\r\n        let rows:Prop[] = [\r\n            '',\r\n            {type: 'component', component: <LMR className=\"py-2\"\r\n                left={<FA className=\"pt-2 pr-1 text-primary\" name={busIcon} size=\"3x\" />}>\r\n                <div className=\"pl-3\">\r\n                    <div className=\"mb-2\">{caption}</div>\r\n                    {disp}\r\n                </div>\r\n            </LMR>},\r\n            '',\r\n            {type: 'component', label: '所有者', component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> },\r\n            {\r\n                type: 'component', \r\n                label: '版本号', \r\n                component: <LMR className=\"py-2 w-100\" right={<small className=\"text-muted\"><EasyDate date={date_update}/></small>} >{version}</LMR> },\r\n            '',\r\n            {\r\n                type: 'component', \r\n                label: '代码',\r\n                vAlign: 'stretch',\r\n                component: <SchemaView />,\r\n            },\r\n        ];\r\n        return <div>\r\n            <PropGrid rows={rows} values={this.props} />\r\n        </div>\r\n    }\r\n}\r\n\r\n@observer\r\nexport class SchemaView extends React.Component {\r\n    render() {\r\n        let bus = store.dev.buses.cur;\r\n        if (bus === null) return '...';\r\n        let content = bus.source;\r\n        return <div className=\"d-flex py-2 w-100 align-items-center\" style={{flex:1}}>\r\n            <pre>\r\n                {content}\r\n            </pre>\r\n        </div>;\r\n    }\r\n}\r\n\r\nconst busesProps:ObjViewProps<DevBus> = {\r\n    title: 'BUS',\r\n    formRows: [\r\n        {\r\n            label: '名称', \r\n            field: {name: 'name', type: 'string', maxLength: 100, required: true},\r\n        },\r\n        {\r\n            label: '描述',\r\n            field: {name: 'discription', type: 'string', maxLength: 250},\r\n            face: {type: 'textarea'}\r\n        },\r\n        {\r\n            label: '代码',\r\n            field: {name: 'source', type: 'string', maxLength: 25000},\r\n            face: {type: 'textarea', rows: 8}\r\n        },\r\n    ],\r\n    row: (item:DevBus):JSX.Element => {\r\n        let {owner, name, discription, mine} = item;\r\n        //let icon = appIcon;\r\n        let main = owner + ' / ' + name;\r\n        return <LMR className=\"py-2 px-3 align-items-stretch\"\r\n            left={<FA className=\"pt-2 pr-1 text-primary\" name='cogs' size=\"lg\" />}>\r\n            <div className=\"px-3\">\r\n                <div>{mine===1? <b>{main}</b> : main}</div>\r\n                <div><Muted>{discription}</Muted></div>\r\n            </div>\r\n        </LMR>;\r\n    },\r\n    items: ()=>store.dev.buses,\r\n    repeated: {\r\n        name: 'name',\r\n        err: '跟已有的名称重复',\r\n    },\r\n    info: Info,\r\n    canEdit: bus => bus.mine === 1,\r\n};\r\n\r\nexport default busesProps;\r\n","import * as React from 'react';\r\nimport { Prop, PropGrid, LMR, Muted, FA, EasyTime, EasyDate } from 'tonva';\r\nimport { UnitSpan } from '../tools';\r\nimport { store } from '../store';\r\nimport { ObjViewProps } from './ObjViewProps';\r\nimport { DevServer } from 'model';\r\n\r\nclass Info extends React.Component<DevServer> {\r\n    render() {\r\n        let { name, discription, unit, date_init, date_update } = this.props;\r\n        let disp = <div>\r\n            <div><b>{name}</b></div>\r\n            <div>{discription}</div>\r\n        </div>;\r\n        let right = <div className=\"text-end small text-muted align-self-end\">\r\n            更新:<EasyTime date={date_update} /><br />\r\n            创建:<EasyDate date={date_init} />\r\n        </div>;\r\n        let rows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component', component: <LMR className=\"w-100 py-2\"\r\n                    left={<FA name=\"server\" className=\"text-primary fa-2x me-3\" />}\r\n                    right={right}>\r\n                    {disp}\r\n                </LMR>\r\n            },\r\n            '',\r\n            { type: 'component', label: '开发号', component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> },\r\n            { type: 'string', label: 'URL', name: 'url' },\r\n            { type: 'string', label: '云服务', name: 'cloud' },\r\n            { type: 'string', label: 'IP', name: 'ip' },\r\n        ];\r\n        return <div>\r\n            <PropGrid rows={rows} values={this.props} />\r\n        </div>;\r\n    }\r\n}\r\n\r\nconst serversProps: ObjViewProps<DevServer> = {\r\n    title: 'Server',\r\n    info: Info,\r\n    formRows: [\r\n        {\r\n            label: '名称',\r\n            field: { name: 'name', type: 'string', maxLength: 50, required: true },\r\n        },\r\n        {\r\n            label: 'URL',\r\n            field: { name: 'url', type: 'string', maxLength: 200, required: true },\r\n        },\r\n        {\r\n            label: 'IP地址',\r\n            field: { name: 'ip', type: 'string', maxLength: 20 },\r\n        },\r\n        {\r\n            label: '描述',\r\n            field: { name: 'discription', type: 'string', maxLength: 50, required: false },\r\n        },\r\n        {\r\n            label: '云服务商',\r\n            field: { name: 'cloud', type: 'string', maxLength: 20, required: false },\r\n        },\r\n    ],\r\n    row: (item: DevServer): JSX.Element => {\r\n        let { name, discription, cloud } = item;\r\n        return <LMR className=\"py-2 px-3 align-items-center\"\r\n            left={<FA name=\"server\" className=\"text-primary fa-lg\" />}>\r\n            <div className=\"px-3\">\r\n                <div><b className=\"me-3\">{name}</b><Muted>{cloud}</Muted></div>\r\n                <div className=\"small text-muted\">{discription}</div>\r\n            </div>\r\n        </LMR>;\r\n    },\r\n    items: () => store.dev.servers,\r\n    repeated: {\r\n        name: 'name',\r\n        err: '跟已有服务器名称重复',\r\n    },\r\n    canEdit: server => {\r\n        let { isOwner, isAdmin } = store.unit;\r\n        return isOwner > 0 || isAdmin > 0;\r\n    },\r\n};\r\n\r\nexport default serversProps;\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { nav, Page } from 'tonva';\r\nimport { TonvaForm, MultiStep, SubmitResult } from 'tonva-form';\r\nimport { DropdownActions, List, FA } from 'tonva';\r\nimport { store } from 'store';\r\nimport { ObjViewProps } from './ObjViewProps';\r\nimport { DevObjBase } from 'model';\r\n\r\n@observer\r\nexport class ObjView<T extends DevObjBase> extends React.Component<ObjViewProps<T>> {\r\n    async componentDidMount() {\r\n        await this.props.items().load();\r\n    }\r\n    //converter(item:T):ListItem {\r\n    //    return this.props.converter(item);\r\n    //}\r\n    newItem() {\r\n        this.props.items().cur = undefined;\r\n        nav.push(<New {...this.props} />);\r\n    }\r\n    itemClick = (item: T) => {\r\n        this.props.items().cur = observable(item);\r\n        nav.push(<Info {...this.props} />);\r\n    }\r\n    render() {\r\n        let { title, items } = this.props;\r\n        if (!store.unit) debugger;\r\n        let { isOwner } = store.unit;\r\n        let right = isOwner > 0 && <button className='btn btn-success btn-sm me-2'\r\n            onClick={() => this.newItem()}><FA name=\"plus\" /></button>;\r\n        return <Page header={title} right={right}>\r\n            <List items={items().items}\r\n                item={{ render: this.props.row, onClick: this.itemClick }}\r\n            />\r\n        </Page>;\r\n    }\r\n}\r\n\r\nclass New<T extends DevObjBase> extends React.Component<ObjViewProps<T>> {\r\n    private tonvaForm: TonvaForm;\r\n    constructor(props: ObjViewProps<T>) {\r\n        super(props);\r\n        this.onSubmit = this.onSubmit.bind(this);\r\n    }\r\n    async onSubmit(values: any): Promise<SubmitResult> {\r\n        values.owner = this.props\r\n        if (await this.props.items().check(values) === false) return;\r\n        let ret = await this.props.items().saveCur(values);\r\n        if (ret === true) {\r\n            nav.pop();\r\n        }\r\n        else {\r\n            let repeated = this.props.repeated;\r\n            this.tonvaForm.formView.setError(repeated.name, repeated.err);\r\n        }\r\n        return;\r\n    }\r\n    render() {\r\n        let content: any;\r\n        let { title, steps, stepHeader } = this.props;\r\n        let { formRows, items } = this.props;\r\n        if (steps !== undefined) {\r\n            content = <MultiStep className=\"mt-4\" header={stepHeader} steps={steps} first=\"step1\" onSubmit={this.onSubmit} />;\r\n        }\r\n        else if (formRows !== undefined) {\r\n            content = <TonvaForm ref={f => this.tonvaForm = f}\r\n                className=\"m-3\"\r\n                formRows={formRows}\r\n                onSubmit={this.onSubmit} initValues={items().cur} />;\r\n        }\r\n        else {\r\n            content = 'ObjViewProps: no steps and no formRows';\r\n        }\r\n        return <Page header={'新增' + title}>\r\n            {content}\r\n        </Page>\r\n    }\r\n}\r\n\r\n@observer\r\nclass Info<T extends DevObjBase> extends React.Component<ObjViewProps<T>> {\r\n    private menuItems = [\r\n        { caption: '修改' + this.props.title, action: this.editItem.bind(this), icon: 'edit' },\r\n        { caption: '删除', action: this.deleteItem.bind(this), icon: 'trash-o' }\r\n    ];\r\n    async deleteItem() {\r\n        if (window.confirm('真的要删除吗？系统删除时并不会检查相关引用，请谨慎') === true) {\r\n            await this.props.items().del();\r\n            nav.pop();\r\n        }\r\n    }\r\n    editItem() {\r\n        nav.push(<Edit {...this.props} />);\r\n    }\r\n    render() {\r\n        let item = this.props.items().cur;\r\n        let actions = [];\r\n        let ex = this.props.extraMenuActions;\r\n        if (ex !== undefined) actions.push(...ex);\r\n        actions.push(...this.menuItems);\r\n        let canEdit = this.props.canEdit;\r\n        let right: any;\r\n        if (canEdit && canEdit(item) === true) {\r\n            right = <DropdownActions actions={actions} className=\"btn-primary me-2\" />;\r\n        }\r\n        //<this.props.info {...item} />\r\n        return <Page header={this.props.title + ' - 详细资料'} right={right}>\r\n            {React.createElement(this.props.info, item)}\r\n        </Page>;\r\n    }\r\n}\r\n\r\nclass Edit<T extends DevObjBase> extends React.Component<ObjViewProps<T>> {\r\n    private actions = [\r\n        { caption: '删除', action: this.deleteItem.bind(this), icon: 'trash-o' }\r\n    ];\r\n    constructor(props: ObjViewProps<T>) {\r\n        super(props);\r\n        this.onSubmit = this.onSubmit.bind(this);\r\n    }\r\n    async onSubmit(values: any): Promise<SubmitResult> {\r\n        if (await this.props.items().check(values) === false) return;\r\n        await this.props.items().saveCur(values);\r\n        nav.pop();\r\n        return;\r\n    }\r\n    async deleteItem() {\r\n        if (window.confirm('真的要删除吗？系统删除时并不会检查相关引用，请谨慎') === true) {\r\n            await this.props.items().del();\r\n            nav.pop();\r\n        }\r\n    }\r\n    render() {\r\n        let right = <DropdownActions actions={this.actions} className=\"btn-primary me-2\" />\r\n        return <Page header={'修改 ' + this.props.title} right={right} back=\"close\">\r\n            <TonvaForm\r\n                className=\"m-3\"\r\n                formRows={this.props.formRows}\r\n                onSubmit={this.onSubmit} initValues={this.props.items().cur} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { VPage, Page, LMR, Image, Edit, Controller, List } from \"tonva\";\r\nimport { FA, nav, Badge, ItemSchema, ImageSchema, StringSchema, UiSchema, UiTextItem, UiImageItem } from 'tonva';\r\nimport { CHome } from \"./CHome\";\r\nimport { observer } from 'mobx-react';\r\nimport { store } from 'store';\r\nimport { UnitApp, Unit, unitCaption, DevObjBase } from 'model';\r\n//import { CUsers } from 'Users';\r\nimport { ObjViewProps } from 'Dev/ObjViewProps';\r\nimport AppsPage from 'Apps';\r\nimport { busesProps, serversProps, ObjView } from 'Dev';\r\nimport { NewApp } from 'Apps/new';\r\n//import { CAdmins } from 'Admins';\r\n\r\nconst defaultIconClass = 'text-info';\r\nconst devIconClass = 'text-success';\r\n\r\ninterface ActionBase {\r\n    title: string | JSX.Element;\r\n    icon: string | JSX.Element;\r\n    onClick?: () => void;\r\n    className?: string;\r\n    iconClassName?: string;\r\n    page?: new (props: any) => React.Component;\r\n}\r\n\r\ninterface ActionItem extends ActionBase {\r\n    right?: string | JSX.Element;\r\n    controller?: Controller;\r\n}\r\n\r\ninterface DevItem<T extends DevObjBase> extends ActionBase {\r\n    dev: true;\r\n    count: number;\r\n    objProps?: ObjViewProps<T>;\r\n}\r\n\r\ntype Item = ActionItem | DevItem<DevObjBase> | string;\r\n\r\nconst rArrow = <FA name=\"angle-right\" />;\r\n\r\nexport class VUnit extends VPage<CHome> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private appsAction: ActionItem = {\r\n        title: '启停App',\r\n        right: rArrow, //'增减',\r\n        icon: 'play-circle-o',\r\n        page: AppsPage,\r\n    };\r\n    /*\r\n    private usersAction:ActionItem = {\r\n        main: '用户角色',\r\n        right: rArrow,\r\n        icon: 'users',\r\n        page: Members,\r\n    };\r\n    */\r\n    private newUsersAction: ActionItem = {\r\n        title: 'App管理员',\r\n        right: <><small className=\"text-muted\">各App的管理员汇总</small> &nbsp; {rArrow}</>,\r\n        icon: 'user-o',\r\n        controller: this.controller.cUsers, // new UsersController(undefined),\r\n    };\r\n    /*\r\n    private devAction:Item = {\r\n        main: <DevActions />,\r\n        right: '程序开发相关管理',\r\n        icon: 'laptop',\r\n        //page: Dev,\r\n    };*/\r\n    private adminsAction: ActionItem = {\r\n        title: unitCaption(this.controller.unit) + '总管',\r\n        right: rArrow,\r\n        icon: 'universal-access',\r\n        //page: AdministorsPage,\r\n        controller: this.controller.cAdmins, // new CAdmins(undefined)\r\n    };\r\n    private uqRolesAction: ActionItem = {\r\n        title: 'UQ角色设置',\r\n        right: rArrow,\r\n        icon: 'universal-access',\r\n        //page: AdministorsPage,\r\n        controller: this.controller.cUqRoles,\r\n    };\r\n    /*\r\n    private appUserManagerAction: ActionItem = {\r\n        main: 'App用户管理员',\r\n        right: rArrow,\r\n        icon: 'vcard-o',\r\n        //page: Administors,\r\n        controller: new CAppUserManagers(undefined),\r\n    };\r\n    */\r\n    /*\r\n    private cOrganization = new COrganization;\r\n    private organizeAction:ActionItem = {\r\n        main: this.cOrganization.label,\r\n        right: rArrow,\r\n        icon: this.cOrganization.icon,\r\n        controller: this.cOrganization\r\n    };\r\n    */\r\n\r\n    private noneAction: ActionItem = {\r\n        title: '请耐心等待分配任务',\r\n        icon: 'hourglass-start',\r\n    };\r\n\r\n    private buildItems(): Item[] {\r\n        let { unit, dev } = store;\r\n        let { isAdmin, isOwner, isDev, type } = unit;\r\n        let items: Item[] = [];\r\n        if (isOwner === 1 || isAdmin === 1) {\r\n            items.push(this.uqRolesAction);\r\n            items.push(this.adminsAction);\r\n        }\r\n        if ((type & 2) !== 0) {\r\n            if (isAdmin === 1) {\r\n                items.push(this.newUsersAction);\r\n            }\r\n        }\r\n\r\n        // 开发号\r\n        if ((type & 1) !== 0) {\r\n            let { counts } = dev;\r\n\r\n            if (isAdmin === 1 || isDev === 1) {\r\n                items.push('开发号管理')\r\n            }\r\n\r\n            if (isAdmin === 1) {\r\n                let developersAction: ActionItem = {\r\n                    title: '开发者',\r\n                    right: rArrow,\r\n                    icon: 'user-o',\r\n                    onClick: async () => await this.controller.onShowDevelopers(),\r\n                    className: 'border-bottom',\r\n                    iconClassName: devIconClass,\r\n                };\r\n                items.push(developersAction);\r\n            }\r\n\r\n            if (isDev === 1) {\r\n                if (isOwner > 0) {\r\n                    /*\r\n                    let appAction: DevItem<DevObjBase> = {\r\n                        dev: true,\r\n                        title: 'APP',\r\n                        count: counts && counts.app,\r\n                        icon: 'tablet',\r\n                        onClick: () => this.controller.startApp(unit), // new AppController(undefined).start(unit.id),\r\n                    };\r\n                    items.push(appAction);\r\n                    */\r\n                }\r\n                let uqAction: DevItem<DevObjBase> = {\r\n                    dev: true,\r\n                    title: 'UQ',\r\n                    count: counts && counts.uq,\r\n                    icon: 'database',\r\n                    onClick: () => this.controller.startUq(unit), //new CUq(undefined).start(unit),\r\n                };\r\n                let busAction: DevItem<DevObjBase> = {\r\n                    dev: true,\r\n                    title: 'BUS',\r\n                    count: counts && counts.bus,\r\n                    icon: 'cogs',\r\n                    objProps: busesProps as any,\r\n                };\r\n                items.push(uqAction, busAction);\r\n                if (isOwner > 0) {\r\n                    let serverAction: DevItem<DevObjBase> = {\r\n                        dev: true,\r\n                        title: 'Server',\r\n                        count: counts && counts.server,\r\n                        icon: 'server',\r\n                        objProps: serversProps as any,\r\n                    };\r\n                    items.push(serverAction);\r\n                }\r\n            }\r\n        }\r\n        /*\r\n        // 小号\r\n        if ((type & 2) !== 0) {\r\n            if (isAdmin === 1) {\r\n                items.push(\r\n                    '小号管理（未来将会去掉）',\r\n                    this.appsAction, \r\n                    //this.usersAction, \r\n                    this.newUsersAction, \r\n                    //this.organizeAction\r\n                );\r\n            }\r\n        }\r\n        */\r\n        return items;\r\n    }\r\n    private row = (item: Item, index: number): JSX.Element => {\r\n        if (typeof item === 'string') {\r\n            return <div className=\"px-3 pt-3 pb-1 small text-muted cursor-default\" style={{ backgroundColor: '#f0f0f0' }}>{item}</div>;\r\n        }\r\n        let { iconClassName, className } = item;\r\n        if (iconClassName === undefined) iconClassName = defaultIconClass;\r\n        let { dev } = item as DevItem<DevObjBase>;\r\n        let left: any, mid: any, r: any;\r\n        if (dev === true) {\r\n            let { icon, title, count } = item as DevItem<DevObjBase>;\r\n            left = typeof icon === 'string' ?\r\n                <FA className={iconClassName} name={icon} fixWidth={true} size=\"lg\" />\r\n                :\r\n                icon;\r\n            mid = title;\r\n            r = count > 0 && <span>{count}</span>;\r\n        }\r\n        else {\r\n            let { right, title, icon } = item as ActionItem;\r\n            left = typeof icon === 'string' ?\r\n                <FA className={iconClassName} name={icon} fixWidth={true} size=\"lg\" /> :\r\n                item.icon;\r\n            mid = title;\r\n            r = <span>{right}</span>;\r\n        }\r\n        return <LMR className={classNames('px-3 py-2 align-items-center', className)} left={left} right={r}>\r\n            <div className=\"px-3\">{mid}</div>\r\n        </LMR>;\r\n    }\r\n    private rowClick = async (item: Item) => {\r\n        let { page: P, onClick } = item as ActionBase;\r\n        if (P !== undefined) {\r\n            nav.push(<P />);\r\n            return;\r\n        }\r\n        if (onClick) {\r\n            onClick();\r\n            return;\r\n        }\r\n        let { objProps } = item as DevItem<DevObjBase>;\r\n        if (objProps !== undefined) {\r\n            return nav.push(<ObjView {...objProps} />);\r\n        }\r\n        let { controller } = item as ActionItem;\r\n        if (controller) {\r\n            await controller.start(store.unit);\r\n            return;\r\n        }\r\n    }\r\n\r\n    private appItemRender(app: UnitApp, index: number) {\r\n        let { name, discription, icon, inUnit } = app;\r\n        let ban = (inUnit === 0) &&\r\n            <FA className=\"text-danger\" name='ban' />;\r\n        return <LMR className=\"px-3 py-2\"\r\n            left={<Badge><Image src={icon} /></Badge>}\r\n            right={ban}>\r\n            <div className=\"px-3\">\r\n                <div><b>{name}</b></div>\r\n                <small className=\"text-muted\">{discription}</small>\r\n            </div>\r\n        </LMR>;\r\n    }\r\n    private appClick = async (app: UnitApp) => {\r\n        await this.controller.showAppXAccount(app);\r\n        /*\r\n        nav.push(<Page header=\"App详细信息\">\r\n            <Info app={app} />\r\n        </Page>);\r\n        */\r\n    }\r\n    private newItem() {\r\n        nav.push(<NewApp />);\r\n    }\r\n    private appRender() {\r\n        let { apps } = store;\r\n        if (apps === undefined) return;\r\n        if (apps.length === 0) return;\r\n        let { isAdmin, isOwner } = store.unit;\r\n        let right = (isAdmin === 1 || isOwner === 1) && <button\r\n            className='btn btn-success btn-sm'\r\n            onClick={() => this.newItem()}><FA name=\"plus\" /></button>;\r\n        return <>\r\n            <LMR className=\"mt-4 mb-2 px-3 small text-muted align-items-end\" right={right}>\r\n                <div className=\"align-self-end\">App</div>\r\n            </LMR>\r\n            <List items={store.apps} item={{ render: this.appItemRender, onClick: this.appClick }} />\r\n        </>\r\n    }\r\n\r\n    private onClickUnitProps = () => {\r\n        this.openPageElement(<UnitProps />);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let unit: Unit = store.unit;\r\n        if (unit === undefined) {\r\n            //console.log(\"admin render without unit\");\r\n            return null;\r\n        }\r\n        //console.log(\"admin render with unit\");\r\n        let items = this.buildItems();\r\n        if (items === undefined) {\r\n            return <Page header=\"\" />;\r\n        }\r\n        let header: any, top: any;\r\n        if (unit !== undefined) {\r\n            let { name, nick, icon, discription } = unit;\r\n            let title: string, vice: any;\r\n            if (nick) {\r\n                title = nick;\r\n                vice = <h6><small className='text-secondary'>{name}</small></h6>;\r\n            }\r\n            else {\r\n                title = name;\r\n            }\r\n            let caption = unitCaption(this.controller.unit);\r\n            if (caption !== undefined) header = caption + ' - ' + title;\r\n            top = <LMR className='px-3 my-4 bg-white py-2 cursor-pointer' onClick={this.onClickUnitProps}\r\n                left={<div><Image className=\"w-3c h-3c\" src={icon} /></div>}>\r\n                <div className=\"px-3\">\r\n                    <LMR right={vice}><h6 className='text-dark font-weight-bold'>{title}</h6></LMR>\r\n                    <div className='text-info overflow-hidden h-max-3c'>{discription}</div>\r\n                </div>\r\n            </LMR>;\r\n        }\r\n        else {\r\n            header = '系统管理';\r\n        }\r\n\r\n        return <Page header={header} logout={this.controller.logout}>\r\n            {top}\r\n            {items.length > 0 && <List items={items} item={{ render: this.row, onClick: this.rowClick }} />}\r\n            {this.appRender()}\r\n        </Page>;\r\n    })\r\n}\r\n\r\n\r\nclass UnitProps extends React.Component {\r\n    private schema: ItemSchema[] = [\r\n        { name: 'icon', type: 'image' } as ImageSchema,\r\n        { name: 'nick', type: 'string' } as StringSchema,\r\n        { name: 'discription', type: 'string' } as StringSchema,\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            nick: { widget: 'text', label: '别名', placeholder: '好的别名更方便记忆' } as UiTextItem,\r\n            icon: { widget: 'image', label: '标志图' } as UiImageItem,\r\n            discription: { widget: 'text', label: '描述', placeholder: '简短清晰的描述' } as UiTextItem,\r\n        }\r\n    }\r\n    /*\r\n    async onNickChanged(value:any, orgValue:any):Promise<void> {\r\n        await store.unitChangeProp('nick', value);\r\n    }\r\n    async onDiscriptionChanged(value:any, orgValue:any):Promise<void> {\r\n        await store.unitChangeProp('discription', value);\r\n    }\r\n    */\r\n    private onItemChanged = async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\r\n        let { name } = itemSchema;\r\n        //await userApi.userSetProp(name, newValue);\r\n        await store.unitChangeProp(name, newValue);\r\n        //this.data[name] = newValue;\r\n        //nav.user[name] = newValue;\r\n        //nav.saveLocalUser();\r\n    }\r\n    //<PropGrid rows={this.rows} values={store.unit} alignValue=\"right\" />\r\n    render() {\r\n        let unit: Unit = store.unit;\r\n        let { isRoot, isOwner, readMe } = unit;\r\n        let caption = unitCaption(unit);\r\n\r\n        let divReadMe = readMe && <div className=\"p-3\"\r\n            dangerouslySetInnerHTML={{ __html: readMe }}></div>;\r\n\r\n        return <Page header={caption + '详情'}>\r\n            <Edit schema={this.schema} uiSchema={this.uiSchema}\r\n                data={store.unit}\r\n                onItemChanged={this.onItemChanged}\r\n                stopEdit={!(isRoot > 0 && isOwner > 0)} />\r\n            {divReadMe}\r\n        </Page>;\r\n    }\r\n}\r\n","import classNames from 'classnames';\r\nimport { VPage, Page, List, LMR, FA } from 'tonva';\r\nimport { CHome } from './CHome';\r\nimport { UnitAdmin } from 'model';\r\nimport { store } from 'store';\r\n\r\nexport class VHome extends VPage<CHome> {\r\n    async open() {\r\n        let { isProduction } = this.controller;\r\n        let { unitAdmins } = store;\r\n        if (isProduction === false) {\r\n            switch (unitAdmins.length) {\r\n                default: this.openPage(this.selectUnitPage); return;\r\n                case 0: this.openPage(this.noUnitPage); return;\r\n                case 1: await this.controller.onShowUnit(unitAdmins[0]); return;\r\n            }\r\n        }\r\n\r\n        if (store.unit === undefined) {\r\n            this.openPage(this.noUnitPage);\r\n            return;\r\n        }\r\n        await this.controller.onShowUnit(unitAdmins[0]);\r\n    }\r\n\r\n    private onClickUnit = async (unitAdmin: UnitAdmin) => {\r\n        this.closePage();\r\n        await this.controller.onShowUnit(unitAdmin);\r\n    }\r\n\r\n    private selectUnitPage = () => {\r\n        let { logout } = this.controller;\r\n        let { accUnits, devUnits, bothUnits } = store;\r\n        let item = { render: this.renderUnitAdmin, onClick: this.onClickUnit };\r\n        let list = (items: UnitAdmin[], label: string) => {\r\n            return items.length > 0 &&\r\n                <div className=\"my-3\">\r\n                    <div className=\"px-3 py-1 small text-muted\">{label}</div>\r\n                    <List items={items} item={item} />\r\n                </div>\r\n        }\r\n        return <Page header=\"同花管理员\" logout={logout}>\r\n            {list(accUnits, '小号')}\r\n            {list(devUnits, '开发号')}\r\n            {list(bothUnits, '双号')}\r\n        </Page>;\r\n        //<List items={this.controller.unitAdmins} \r\n        //    item={{render: this.renderRow, onClick: this.onRowClick}} />\r\n    }\r\n\r\n    private noUnitPage = () => {\r\n        let { user, logout } = this.controller;\r\n        let { nick, name } = user;\r\n        return <Page header=\"没有小号\" logout={logout}>\r\n            <div className=\"p-3 small text-info\">\r\n                {nick || name}: 没有需要管理的小号\r\n            </div>\r\n        </Page>\r\n    }\r\n\r\n    protected get view(): any { return undefined }\r\n\r\n    private renderUnitAdmin = (item: UnitAdmin, index: number): JSX.Element => {\r\n        let { name, nick, type } = item;\r\n        let icon: string, color: string;\r\n        if (type & 1) {\r\n            icon = 'code';\r\n            color = 'text-success';\r\n        }\r\n        else if (type & 2) {\r\n            icon = 'flag';\r\n            color = 'text-primary';\r\n        }\r\n        else {\r\n            icon = 'start';\r\n            color = 'text-danger';\r\n        }\r\n        return <LMR className=\"px-3 py-2\" right={<span className=\"small text-muted\">id: {item.id}</span>}>\r\n            <div>\r\n                <FA name={icon} fixWidth={true} className={classNames('me-3', color)} />\r\n                {nick || name}\r\n            </div>\r\n        </LMR>;\r\n    }\r\n    /*\r\n    private onUnitClick = async (item: UnitAdmin) => {\r\n        appInFrame.unit = item.id; // 25;\r\n        store.init();\r\n        await store.loadUnit();\r\n        this.closePage();\r\n        this.openPageElement(<AdminPage />);\r\n    }*/\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount, Coll } from './CAppXAccount';\r\nimport { VPage, Page, PropGrid, Media, Prop, FA, LMR } from 'tonva';\r\nimport { IdDates } from 'tools';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VApp extends VPage<CAppXAccount> {\r\n    async open() {\r\n        this.openPage(this.page)\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { appXAccount, showDetail, users, showUserList, calcUserColl } = this.controller;\r\n        let coll = calcUserColl();\r\n        let { name, discription, icon, date_init, date_update } = appXAccount;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        let right = <button className=\"btn btn-success btn-sm me-2 align-self-center\"\r\n            onClick={showDetail}><FA name=\"ellipsis-h\" fixWidth={true} /></button>;\r\n        let rows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <Media icon={icon} main={name} discription={disp} />\r\n            },\r\n            '',\r\n        ];\r\n        return <Page header={\"App - \" + name} right={right}>\r\n            <PropGrid rows={rows} values={{}} />\r\n            {this.renderAdmins(coll)}\r\n            {this.renderRoles(coll)}\r\n            {this.renderUsers(coll)}\r\n            <div className=\"h-1c\" />\r\n            {this.row('全部用户', users.length, showUserList, 'text-info', 'list')}\r\n        </Page>;\r\n    })\r\n\r\n    private row(content: JSX.Element | string, count: number, onClick: () => void, color: string, icon?: string): JSX.Element {\r\n        let left = <FA className={\"me-3 \" + color} fixWidth={true} name={icon || \"user\"} size=\"lg\" />;\r\n        let right = <>{count} &nbsp; &nbsp; <FA className=\"align-self-center\" name=\"angle-right\" /></>;\r\n        return <LMR className=\"my-2 px-3 py-2 bg-white align-items-center\"\r\n            onClick={onClick} left={left} right={right}>{content}</LMR>;\r\n    }\r\n\r\n    private renderAdmins(coll: Coll): JSX.Element {\r\n        let { showAdmins, unit } = this.controller;\r\n        if (unit.isAdmin === 1) {\r\n            return this.row('管理员', coll.admins.length, showAdmins, 'text-danger');\r\n        }\r\n    }\r\n\r\n    private renderRoles(coll: Coll): JSX.Element {\r\n        let { showRoles, roleUserCount } = this.controller;\r\n        let { roleUsers } = coll;\r\n        if (!roleUsers) return;\r\n        return this.row('角色用户', roleUserCount, showRoles, 'text-success');\r\n    }\r\n\r\n    private renderUsers(coll: Coll): JSX.Element {\r\n        let { showUsers } = this.controller;\r\n        return this.row('普通用户', coll.users.length, showUsers, 'text-info');\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport {Media, List, LMR, Prop, PropGrid, FA, VPage, Page} from 'tonva';\r\nimport { CAppXAccount } from './CAppXAccount';\r\nimport { IdDates, UnitSpan } from 'tools';\r\n\r\nexport class VDetail extends VPage<CAppXAccount> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderUqRow = (uqAccess:any, index:number):JSX.Element => {\r\n        let {name, owner, discription} = uqAccess;\r\n        return <LMR className=\"py-2\" right={<small className=\"text-muted\">{discription}</small>}>\r\n            {owner} / {name}\r\n        </LMR>;\r\n    }\r\n\r\n    private onTurnOnOff = async () => {\r\n        if (await this.controller.appTurnOnOff() === true) {\r\n            this.closePage();\r\n            // after action;\r\n            //let {id, inUnit} = this.props.app;\r\n            //appActed?.(id, inUnit);\r\n        }\r\n    }\r\n\r\n    private status = ():JSX.Element => {\r\n        let {inUnit} = this.controller.appXAccount;\r\n        let text:string, right:any;\r\n        if (inUnit === 1) {\r\n            right = <button className=\"btn btn-danger\" onClick={this.onTurnOnOff}>\r\n                <FA name=\"ban\" /> 停用APP\r\n            </button>;\r\n            text = '运行中';\r\n        }\r\n        else if (inUnit === 0) {\r\n            right = <button className=\"btn btn-success\" onClick={this.onTurnOnOff}>\r\n                <FA name=\"refresh\" size=\"lg\" /> 恢复APP\r\n            </button>;\r\n            text = '停运中';\r\n        }\r\n        else {\r\n            right = <button className=\"btn btn-primary\" onClick={this.onTurnOnOff}>\r\n                <FA name=\"plus\" size=\"lg\" /> 新建\r\n            </button>;\r\n            text = '启用APP';\r\n        }\r\n        return <LMR className=\"w-100 align-items-center my-1\" right={right}>{text}</LMR>;\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {appXAccount, uqAccesses} = this.controller;\r\n        let {unit, name, discription, icon, date_init, date_update} = appXAccount;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        let rows:Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component', \r\n                component: <Media icon={icon} main={name} discription={disp} />\r\n            },\r\n            '',\r\n            {\r\n                type: 'component', \r\n                label: '开发号', \r\n                component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div>\r\n            },\r\n            {\r\n                type: 'component', \r\n                label: '关联UQ', \r\n                component: <List className=\"w-100\" items={uqAccesses}\r\n                    item={{render: this.renderUqRow}} />\r\n            },\r\n            '',\r\n            {\r\n                type: 'component', \r\n                label: '状态',\r\n                component: this.status()\r\n            },\r\n        ];\r\n        return <Page header={\"App详情 - \" + name}>\r\n            <PropGrid rows={rows} values={{}} labelFixLeft={true} />\r\n        </Page>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount, User } from \"./CAppXAccount\";\r\nimport { View, LMR, Image, FA } from \"tonva\";\r\nimport { caches } from 'store';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VUser extends View<CAppXAccount> {\r\n    render(user: User): JSX.Element {\r\n        //return <this.row user={user} />;\r\n        return React.createElement(this.row, { user });\r\n    }\r\n\r\n    private row = observer((props: { user: User }) => {\r\n        let { user } = props;\r\n        let u = caches.users.get(user.id);\r\n        if (u === null) return;\r\n        let { name, nick, icon } = u;\r\n        let { assigned, isAdmin, roleBins } = user;\r\n        if (assigned !== undefined) nick = assigned;\r\n        if (name !== undefined) {\r\n            let { uqRoles, showEditUserPage, user: _user } = this.controller;\r\n            let left = <Image className=\"w-3c h-3c me-3\" src={icon} />;\r\n            let isMe = user.id === _user.id;\r\n            let caption: any = isMe === true ?\r\n                <div>\r\n                    {nick ? <><b>{nick}</b> {name}</> : <><b>{name}</b></>}\r\n                    &nbsp; <small className=\"text-muted\">[自己]</small>\r\n                </div>\r\n                :\r\n                <div>{nick ? <>{nick} <small>{name}</small></> : <>{name}</>}</div>;\r\n            let divRoles: any[] = [];\r\n            if (uqRoles !== undefined) {\r\n                let len = uqRoles.length;\r\n                for (let i = 0; i < len; i++) {\r\n                    if ((roleBins & (1 << i)) === 0) continue;\r\n                    divRoles.push(this.box(uqRoles[i], 'px-2 text-primary border-primary bg-white'));\r\n                }\r\n            }\r\n\r\n            return <LMR className=\"px-3 py-3 cursor-pointer\" left={left} onClick={() => showEditUserPage(user)}>\r\n                {caption}\r\n                <div className=\"d-flex flex-wrap mt-1\">\r\n                    {isAdmin === true && this.box('管理员', 'px-2 text-success border-success bg-light')}\r\n                    {divRoles}\r\n                </div>\r\n            </LMR>;\r\n        }\r\n    });\r\n\r\n    private box = (text: string, cn: string) => {\r\n        return <div className={'me-3 py-0 small border rounded ' + cn} key={text}>{text}</div>;\r\n    }\r\n}\r\n\r\nexport class VAddUser extends View<CAppXAccount> {\r\n    render(roleNum: number): JSX.Element {\r\n        return <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            onClick={() => this.controller.showAddUserPage(roleNum)}>\r\n            <FA name=\"plus\" />\r\n        </button>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount } from './CAppXAccount';\r\nimport { VPage, Page, List } from 'tonva';\r\nimport { VAddUser } from './VUser';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VAdmins extends VPage<CAppXAccount> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {appXAccount, renderUser} = this.controller;\r\n        let {name} = appXAccount;\r\n        let coll = this.controller.calcUserColl();\r\n        return <Page header={'管理员 - ' + name} right={this.renderVm(VAddUser, -1)}>\r\n            <List items={coll.admins} item={{render: renderUser}} />\r\n        </Page>;\r\n    })\r\n\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount, User } from './CAppXAccount';\r\nimport { VPage, Page, List, LMR } from 'tonva';\r\nimport { VAddUser } from './VUser';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VRoleUsers extends VPage<CAppXAccount> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {appXAccount} = this.controller;\r\n        let {name} = appXAccount;\r\n        let coll = this.controller.calcUserColl();\r\n        let {roleUsers} = coll;\r\n        return <Page header={'角色用户 - ' + name}>\r\n            <div className=\"py-0\">\r\n                {roleUsers && roleUsers.map((v, index) => {\r\n                    return this.renderRole(v, index);\r\n                })}\r\n            </div>\r\n        </Page>;\r\n    })\r\n\r\n    private renderRole = (users:User[], index:number) => {\r\n        let {uqRoles, renderUser} = this.controller;\r\n        let role = uqRoles[index];\r\n        if (!role) return;\r\n        return <div key={index} className=\"my-3\">\r\n            <LMR className=\"pl-3 pb-1 align-items-end\" right={this.renderVm(VAddUser, index+1)}>{uqRoles[index]}</LMR>\r\n            <List items={users} item={{render: renderUser}} none={()=><small className=\"text-muted\">[无]</small>} />\r\n        </div>;\r\n    }\r\n\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount } from './CAppXAccount';\r\nimport { VPage, Page, List } from 'tonva';\r\nimport { VAddUser } from './VUser';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VNoRoleUsers extends VPage<CAppXAccount> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {appXAccount, renderUser} = this.controller;\r\n        let {name} = appXAccount;\r\n        let coll = this.controller.calcUserColl();\r\n        return <Page header={'普通用户 - ' + name} right={this.renderVm(VAddUser, -2)}>\r\n            <List items={coll.users} item={{render: renderUser}} />\r\n        </Page>;\r\n    })\r\n\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount } from \"./CAppXAccount\";\r\nimport { VPage, Page, Form, Schema, StringSchema, ButtonSchema, UiSchema, UiButton, UiTextItem, Context } from \"tonva\";\r\n\r\nexport class VAddUserPage extends VPage<CAppXAccount> {\r\n    private roleNum:number;\r\n    private schema:Schema = [\r\n        {name: 'user', type: 'string', required: true} as StringSchema,\r\n        {name: 'submit', type: 'submit'} as ButtonSchema,\r\n    ];\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            'user': {widget: 'text', label: '用户', placeholder: '请输入用户账号'} as UiTextItem,\r\n            'submit': {widget: 'button', label: '提交', className: 'btn btn-primary'} as UiButton,\r\n        }\r\n    }\r\n    async open(roleNum:number) {\r\n        this.roleNum = roleNum;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onSubmit = async (name:string, context:Context) => {\r\n        let ret = await this.controller.addUser(this.roleNum, context.data.user);\r\n        if (ret === undefined) {\r\n            this.closePage();\r\n            return;\r\n        }\r\n        context.setError('user', ret);\r\n    }\r\n\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'user') {\r\n            await this.onSubmit('login', context);\r\n            return;\r\n        }\r\n    }\r\n\r\n    private page = () => {\r\n        let roleCaption = this.controller.getRoleCaption(this.roleNum);\r\n        return <Page header={'新增 - ' + roleCaption} back=\"close\">\r\n            <div className=\"m-5 px-5 py-3 bg-white border rounded\">\r\n                <Form schema={this.schema} uiSchema={this.uiSchema}\r\n                    onEnter={this.onEnter}\r\n                    onButtonClick={this.onSubmit}/>\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount } from './CAppXAccount';\r\nimport { VPage, Page, List } from 'tonva';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VUserList extends VPage<CAppXAccount> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {appXAccount, users, renderUser} = this.controller;\r\n        let {name} = appXAccount;\r\n        return <Page header={'用户列表 - ' + name}>\r\n            <List items={users} item={{render: renderUser}} />\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, Media, PropGrid} from 'tonva';\r\nimport {nav, Page}  from 'tonva';\r\nimport {caches} from 'store';\r\nimport {span} from './span';\r\n\r\nexport interface UserLinkProps {\r\n    className?: string;\r\n    id: number;\r\n    assigned?: string;\r\n    isLink?: boolean;\r\n}\r\n\r\n@observer\r\nexport class UserSpan extends React.Component<UserLinkProps> {\r\n    onClick = (evt) => {\r\n        evt.preventDefault();\r\n        nav.push(<UserInfo id={this.props.id} />);\r\n        return false;\r\n    }\r\n    render() {\r\n        let {id, className, assigned, isLink} = this.props;\r\n        let api = caches.users.get(id);\r\n        let content:any;\r\n        if (api === null) {\r\n            content = id;\r\n        }\r\n        else {\r\n            let {name, nick} = api;\r\n            if (assigned !== undefined) nick = assigned;\r\n            if (name !== undefined) {\r\n                content = nick? <><b>{nick}</b> {name}</> : <><b>{name}</b></>;\r\n            }\r\n            else {\r\n                content = id;\r\n            }\r\n        }\r\n        return span(isLink, className, this.onClick, content);\r\n    }\r\n}\r\n\r\n@observer\r\nclass UserInfo extends React.Component<UserLinkProps> {\r\n    private rows:Prop[];\r\n    render() {\r\n        let uq = caches.users.get(this.props.id);\r\n        let {name, nick, icon} = uq;\r\n        this.rows = [\r\n            '',\r\n            {type: 'component', component: <Media icon={icon} main={nick} discription={name} />},\r\n            '',\r\n        ];\r\n        return <Page header={'用户 - 详细资料'}>\r\n            <PropGrid rows={this.rows} values={this.props} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { CAppXAccount, User } from \"./CAppXAccount\";\r\nimport { VPage, Page, FA } from \"tonva\";\r\nimport { UserSpan } from 'tools/userSpan';\r\n\r\nexport class VEditUserPage extends VPage<CAppXAccount> {\r\n    private user: User;\r\n    async open(user: User) {\r\n        this.user = user;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private row = (caption: string, cn: string,\r\n        isChecked: boolean,\r\n        isMeAdmin: boolean,\r\n        onChange: (event: React.ChangeEvent<HTMLInputElement>) => Promise<void>) => {\r\n        if (!caption) return;\r\n        return <label className={classNames(\r\n            \"px-3 py-2 m-0 d-flex bg-white mb-1 w-100 align-items-center\",\r\n            { \"cursor-pointer\": !isMeAdmin })}>\r\n            <input type=\"checkbox\" className=\"me-4\" defaultChecked={isChecked}\r\n                disabled={isMeAdmin}\r\n                onChange={onChange} />\r\n            <span className={cn}>{caption}</span>\r\n        </label>\r\n    }\r\n\r\n    private onAdminChanged = async (value: boolean) => {\r\n        let ret = await this.controller.setAppAdmin(this.user, value);\r\n        if (ret === undefined) this.closePage();\r\n        else alert(ret);\r\n    }\r\n\r\n    private onRoleChanged = async (value: boolean, roleNum: number) => {\r\n        let ret = await this.controller.setAppRole(this.user, roleNum, value);\r\n        // if (ret === undefined) this.closePage();\r\n        // else alert(ret);\r\n        if (ret !== undefined) alert(ret);\r\n    }\r\n\r\n    private onDelUer = async () => {\r\n        let ret = await this.controller.delUser(this.user);\r\n        if (ret === undefined) this.closePage();\r\n        else alert(ret);\r\n    }\r\n\r\n    private page = () => {\r\n        let { isAdmin, roleBins } = this.user;\r\n        let header = <>用户 -&nbsp;<UserSpan id={this.user.id} /></>;\r\n        let btnDel = this.user.id !== this.controller.user.id\r\n            && <div className=\"text-end m-3\"><button onClick={this.onDelUer}\r\n                className=\"btn btn-sm btn-outline-primary\"\r\n            ><FA name=\"trash\" /> 从App中移除</button>\r\n            </div>;\r\n        let isMeAdmin = this.user.id === this.controller.user.id;\r\n        let onAdminChange = async (event: React.ChangeEvent<HTMLInputElement>) => {\r\n            await this.onAdminChanged(event.target.checked);\r\n        }\r\n        return <Page header={header}>\r\n            <div className=\"my-3\">\r\n                {this.row('App管理员', 'text-success font-weight-bold', isAdmin, isMeAdmin, onAdminChange)}\r\n                <div className=\"h-1c\" />\r\n                {this.controller.uqRoles.map((v, index) => {\r\n                    let onRoleChange = async (event: React.ChangeEvent<HTMLInputElement>) => {\r\n                        await this.onRoleChanged(event.target.checked, index);\r\n                    }\r\n                    let isChecked = (roleBins & (1 << index)) !== 0;\r\n                    return this.row(v, 'text-primary', isChecked, false, onRoleChange);\r\n                })}\r\n                {btnDel}\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n","import _ from 'lodash';\r\nimport { CUqBase } from \"UqApp\";\r\nimport { UnitApp, Unit, DevApp } from \"model\";\r\nimport { VApp } from \"./VApp\";\r\nimport { VDetail } from \"./VDetail\";\r\nimport { devApi, mainApi } from \"api\";\r\nimport { store } from \"store\";\r\nimport { observable } from 'mobx';\r\nimport { VAdmins } from './VAdmins';\r\nimport { VRoleUsers } from './VRoleUsers';\r\nimport { VNoRoleUsers } from './VNoRoleUsers';\r\nimport { VAddUserPage } from './VAddUserPage';\r\nimport { VUser } from './VUser';\r\nimport { VUserList } from './VUserList';\r\nimport { VEditUserPage } from './VEditUserPage';\r\n\r\nexport interface User {\r\n    id: number;\r\n    assigned: string;\r\n    isAdmin: boolean;\r\n    roleBins:number;\r\n}\r\n\r\nexport interface Coll {\r\n    admins: User[];\r\n    users: User[];\r\n    roleUsers: User[][];\r\n}\r\n\r\nexport class CAppXAccount extends CUqBase {\r\n    unit: Unit;\r\n    appXAccount:DevApp;\r\n    uqAccesses: any[];\r\n    uqMain: number;\r\n    uqRoles: string[];\r\n    //userColl: {[id:number]: User};\r\n    @observable users: User[];\r\n    @observable unitOnly: boolean;\r\n    @observable roleUserCount: number;\r\n\r\n    async internalStart(unit:Unit, appXAccount:DevApp) {\r\n        this.unit = unit;\r\n        this.appXAccount = appXAccount;\r\n        this.unitOnly = appXAccount.unitOnly === 1;\r\n        await this.loadAppAdmins();\r\n        this.openVPage(VApp);\r\n    }\r\n\r\n    private async loadAppAdmins() {\r\n        let ret:any[][] = await mainApi.unitAppAdmins(this.unit.id, this.appXAccount.id);\r\n        let {uq_main, roles} = ret[0][0];\r\n        this.uqMain = uq_main;\r\n        if (roles) {\r\n            this.uqRoles = (roles as string).split('\\t');\r\n        }\r\n        this.users = [];\r\n        for (let admin of ret[1]) {\r\n            let {user:id} = admin;\r\n            let i = this.insertUser(id);\r\n            if (i>=0) this.users[i].isAdmin = true;\r\n        }\r\n        let roleUserCount = 0;\r\n        for (let userRoles of ret[2]) {\r\n            let {user:id, roles} = userRoles;\r\n            let i = this.insertUser(id);\r\n            if (i>=0) {\r\n                //let rolesArr = this.toRolesArr(roles);\r\n                this.users[i].roleBins = roles; // rolesArr;\r\n                //if (rolesArr !== undefined && rolesArr.length > 0) roleUserCount++;\r\n                if (!roles) roleUserCount++;\r\n            }\r\n        }\r\n        for (let item of ret[3]) {\r\n            let {user:id, assigned} = item;\r\n            let i = this.insertUser(id);\r\n            if (i>=0) this.users[i].assigned = assigned;\r\n        }\r\n        this.roleUserCount = roleUserCount;\r\n    }\r\n\r\n    private insertUser(id:number):number {\r\n        let len = this.users.length;\r\n        let i:number;\r\n        for (i=0; i<len; i++) {\r\n            let u = this.users[i];\r\n            let uid = u.id;\r\n            if (id === uid) return i;\r\n            if (id < uid) break;\r\n        }\r\n        this.users.splice(i, 0, {id:id} as User);\r\n        return i;\r\n    }\r\n\r\n    private toRolesArr(n: number):number[] {\r\n        if (this.uqRoles === undefined) return undefined;\r\n        let ret:number[] = [];\r\n        let len = this.uqRoles.length;\r\n        let mask = 1;\r\n        for (let i=0;i<len; i++, mask<<=1) {\r\n            if ((n & mask) === mask) ret.push(i);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    calcUserColl = (): Coll => {\r\n        let admins:User[] = [];\r\n        let users:User[] = [];\r\n        let roleUsers:User[][];\r\n        let roleUserCount = 0;\r\n        let len = 0;\r\n        if (this.uqRoles) {\r\n            len = this.uqRoles.length;\r\n            roleUsers = [];\r\n            for (let i=0; i<len; i++) roleUsers.push([]);\r\n        }\r\n        for (let user of this.users) {\r\n            let {isAdmin, roleBins} = user;\r\n            let isUser = true, isRole = false;\r\n            if (isAdmin === true) {\r\n                admins.push(user);\r\n                isUser = false;\r\n            }\r\n\r\n            let mask = 1;\r\n            for (let i=0; i<len; i++, mask<<=1) {\r\n                if ((roleBins & mask) !== 0) {\r\n                    let rus = roleUsers[i];\r\n                    if (this.user.id === user.id) \r\n                        rus.unshift(user);\r\n                    else\r\n                        rus.push(user);\r\n                    isUser = false;\r\n                    isRole = true;\r\n                }\r\n            }\r\n            if (isRole === true) {\r\n                ++roleUserCount;\r\n            }\r\n            if (isUser === true) {\r\n                users.push(user);\r\n            }\r\n        }\r\n        this.roleUserCount = roleUserCount;\r\n        return {\r\n            admins: admins,\r\n            users: users,\r\n            roleUsers: roleUsers,\r\n        };\r\n    }\r\n\r\n    showDetail = async () => {\r\n        this.uqAccesses = await devApi.loadAppUqs(this.appXAccount.id);\r\n        this.openVPage(VDetail);\r\n    }\r\n\r\n    appTurnOnOff = async ():Promise<boolean> => {\r\n        let {id, inUnit, name} = this.appXAccount;\r\n        //let newInUnit:number = 1;\r\n        if (inUnit === 0) {\r\n            let ret = await store.restoreUnitApp(id);\r\n            if (ret <= 0) {\r\n                alert('app 或者 uq 没有定义 service');\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n\r\n        if (inUnit === 1) {\r\n            let ret = await this.confirm({\r\n                caption: '停运 - ' + name,\r\n                message: 'App停运之后，任何人都无法访问。请确认',\r\n                ok: '确认',\r\n            });\r\n            if (ret !== 'ok') return false;\r\n            await store.stopUnitApp(id);\r\n            //newInUnit = 0;\r\n            return true;\r\n        }\r\n\r\n        let newApp:UnitApp = _.clone(this.appXAccount);\r\n        newApp.id = id;\r\n        newApp.inUnit = 1;\r\n        let ret = await store.addUnitApp(newApp);\r\n        if (ret <= 0) {\r\n            alert('app 或者 uq 没有定义 service');\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    showAdmins = async () => {\r\n        this.openVPage(VAdmins);\r\n    }\r\n\r\n    showRoles = async () => {\r\n        this.openVPage(VRoleUsers);\r\n    }\r\n\r\n    showUsers = async () => {\r\n        this.openVPage(VNoRoleUsers);\r\n    }\r\n\r\n    showUserList = async () => {\r\n        this.openVPage(VUserList);\r\n    }\r\n\r\n    showAddUserPage = (roleNum:number) => {\r\n        this.openVPage(VAddUserPage, roleNum);\r\n    }\r\n\r\n    showEditUserPage = (user: User) => {\r\n        this.openVPage(VEditUserPage, user);\r\n    }\r\n\r\n    getRoleCaption(roleNum:number):string {\r\n        switch(roleNum) {\r\n            case -1: return '[App管理员]';\r\n            case -2: return '[普通用户]';\r\n            default: return this.uqRoles[roleNum];\r\n        }\r\n    }\r\n\r\n    async addUser(roleNum:number, userName:string):Promise<string> {\r\n        let roleBit:number = roleNum<=0? roleNum : 1<<(roleNum-1);\r\n        let ret = await mainApi.setAppRoles(this.unit.id, this.appXAccount.id, undefined, userName, roleBit);\r\n        if (ret === undefined) return 'unauthorized';\r\n        let {r, id} = ret;\r\n        if (r !== undefined) return r;\r\n\r\n        let i = this.insertUser(id);\r\n        //let isAdmin:boolean = false; \r\n        let user = this.users[i];\r\n        if (roleNum > 0) {\r\n            user.roleBins |= (1<<roleNum-1);\r\n        }\r\n        else if (roleNum === -1) {\r\n            // 管理员\r\n            user.isAdmin = true;\r\n        }\r\n        else if (roleNum === 0) {\r\n            // 普通用户\r\n        }\r\n        //this.users[i] = {id, isAdmin, roles, assigned:undefined};\r\n    }\r\n\r\n    renderUser = (user:User, index:number) => {\r\n        return this.renderView(VUser, user);\r\n    }\r\n\r\n    async setAppAdmin(user:User, on:boolean):Promise<string> {\r\n        let {id, isAdmin, roleBins, assigned} = user;\r\n        isAdmin = on;\r\n        let ret = await mainApi.setAppAdmin(\r\n            this.unit.id, this.appXAccount.id, \r\n            id, undefined, isAdmin===true? 1:0);\r\n        if (ret === undefined) {\r\n            return 'unauthorized';\r\n        }\r\n        let {r} = ret;\r\n        if (r !== undefined) return r;\r\n\r\n        this.renewUser(user, isAdmin, roleBins, assigned);\r\n    }\r\n\r\n    async setAppRole(user:User, roleNum:number, on:boolean):Promise<string> {\r\n        let {id, isAdmin, assigned} = user;\r\n        if (on === true) {\r\n            user.roleBins |= 1<<roleNum;\r\n        }\r\n        else {\r\n            user.roleBins &= ~(1<<roleNum);\r\n        }\r\n        let roleBins = user.roleBins;\r\n        let ret = await mainApi.setAppRoles(\r\n            this.unit.id, this.appXAccount.id, \r\n            id, undefined, roleBins);\r\n        if (ret === undefined) return 'unauthorized';\r\n        let {r} = ret;\r\n        if (r !== undefined) return r;\r\n        this.renewUser(user, isAdmin, roleBins, assigned);\r\n    }\r\n\r\n    private renewUser(user:User, isAdmin:boolean, roleBins:number, assigned:string) {\r\n        let {id} = user;\r\n        let index = this.users.findIndex(v => v.id === id);\r\n        this.users[index] = {id, isAdmin, roleBins, assigned};\r\n    }\r\n\r\n    delUser = async (user:User):Promise<string> => {\r\n        let ret = await mainApi.setAppRoles(this.unit.id, this.appXAccount.id, user.id, undefined, 0);\r\n        if (ret === undefined) return 'unauthorized';\r\n        let {id, r} = ret;\r\n        if (r !== undefined) return r;\r\n        let index = this.users.findIndex(v => v.id === id);\r\n        this.users.splice(index, 1);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { CDevelopers } from \"./CDevelopers\";\r\nimport { Page, VPage, List, LMR, Image, FA } from \"tonva\";\r\nimport { UserUqsBuses } from 'store/adminDevs';\r\nimport { observer } from 'mobx-react';\r\nimport { caches } from 'store';\r\n\r\nexport class VDevelopers extends VPage<CDevelopers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderUserUqsBuses = (user: number, index: number) => {\r\n        let userUqsBuses: UserUqsBuses = this.controller.adminDevs.getUserUqsBuses(user);\r\n        let { uqs, buses } = userUqsBuses;\r\n        let userObj = caches.users.get(user);\r\n        let content: any;\r\n        if (userObj !== null) {\r\n            let { name, nick, icon } = userObj;\r\n            content = <LMR className=\"w-100\"\r\n                left={<Image className=\"w-3c h-3c me-4\" src={icon} />}\r\n                right={<div className=\"text-end\">uq: {uqs.length}<br />bus: {buses.length}</div>}>\r\n                <div>{nick ? <><b>{nick}</b><br /><small className=\"text-muted\">{name}</small></> : <><b>{name}</b></>}</div>\r\n            </LMR>\r\n        }\r\n        return <div className=\"px-3 py-2\">{content}</div>;\r\n    }\r\n\r\n    private onClickUserUqsBuses = (user: number) => {\r\n        this.controller.showUserUqsBuses(user);\r\n    }\r\n\r\n    private onAddUser = () => {\r\n        this.controller.showAddDeveloper();\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { adminDevs } = this.controller;\r\n        let { unit, users } = adminDevs;\r\n        let right = <button className=\"btn btn-sm btn-success align-self-center me-3\" onClick={this.onAddUser}><FA name=\"plus\" /></button>\r\n        return <Page header={\"开发者 - \" + unit.name} right={right}>\r\n            <List className=\"my-3\" items={users}\r\n                item={{ render: this.renderUserUqsBuses, onClick: this.onClickUserUqsBuses }} />\r\n        </Page>\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport { CDevelopers } from \"./CDevelopers\";\r\nimport { VPage, Page, List, LMR, FA } from 'tonva';\r\nimport { UserSpan } from 'tools/userSpan';\r\nimport { BusSpan, UqSpan } from 'tools';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VUqsBuses extends VPage<CDevelopers> {\r\n    private user: number;\r\n    async open(user: number) {\r\n        this.user = user;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderUq = (uq: number, index: number) => {\r\n        return <div className=\"px-3 py-2 align-items-center\">\r\n            <FA className=\"text-primary\" size=\"lg\" name=\"database\" fixWidth={true} />\r\n            <div className=\"mx-3\"><UqSpan id={uq} /></div>\r\n        </div>;\r\n    }\r\n\r\n    private onChangeUq = () => {\r\n        this.controller.showUserUqs(this.user);\r\n    }\r\n\r\n    private renderBus = (bus: number, index: number) => {\r\n        return <div className=\"px-3 py-2 align-items-center\">\r\n            <FA className=\"text-primary\" size=\"lg\" name=\"cogs\" fixWidth={true} />\r\n            <div className=\"mx-3\"><BusSpan id={bus} /></div>\r\n        </div>;\r\n    }\r\n\r\n    private onChangeBus = () => {\r\n        this.controller.showUserBuses(this.user);\r\n    }\r\n\r\n    private onDelDev = async () => {\r\n        if (await this.controller.confirm({\r\n            message: '真的要取消开发者资格吗？',\r\n            ok: '确认'\r\n        }) === 'ok') {\r\n            await this.controller.delDev(this.user);\r\n            this.closePage();\r\n        }\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { user, uqs, buses } = this.controller.adminDevs.getUserUqsBuses(this.user);\r\n        let btnUqAdd = <button className=\"btn btn-success btn-sm\" onClick={this.onChangeUq}><FA name=\"pencil\" /></button>;\r\n        let uqHeader = <LMR className=\"px-3 pb-1 align-items-end\" right={btnUqAdd}>UQ</LMR>;\r\n        let btnBusAdd = <button className=\"btn btn-success btn-sm\" onClick={this.onChangeBus}><FA name=\"pencil\" /></button>;\r\n        let busHeader = <LMR className=\"px-3 pb-1 align-items-end\" right={btnBusAdd}>BUS</LMR>;\r\n        let right = <button className=\"btn btn-outline-info btn-sm align-self-center me-3\" onClick={this.onDelDev}><FA name=\"minus\" /></button>;\r\n\r\n        return <Page header=\"开发者 - UQ BUS\" right={right}>\r\n            <div className=\"px-3 py-2\"><UserSpan id={user} /></div>\r\n            <div className=\"h-1c\" />\r\n\r\n            {uqHeader}\r\n            <List className=\"mb-3\" items={uqs}\r\n                item={{ render: this.renderUq, onClick: undefined/*this.onClickUq*/ }} />\r\n            <div className=\"h-1c\" />\r\n            {busHeader}\r\n            <List className=\"mb-3\" items={buses}\r\n                item={{ render: this.renderBus, onClick: undefined/*this.onClickBus*/ }} />\r\n        </Page>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport { CDevelopers } from \"./CDevelopers\";\r\nimport { VPage, Page, List, FA } from 'tonva';\r\nimport { UserSpan } from 'tools/userSpan';\r\nimport { UqSpan } from 'tools';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VUqs extends VPage<CDevelopers> {\r\n    private user: number;\r\n    async open(user: number) {\r\n        this.user = user;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onCheckChanged = async (evt: React.ChangeEvent<HTMLInputElement>, dev: number) => {\r\n        await this.controller.changeUserDev(evt.target.checked, 'uq', this.user, dev);\r\n    }\r\n\r\n    private renderUqItem = (item: { dev: number, selected: boolean }, index: number) => {\r\n        let { dev, selected } = item;\r\n        return <label className=\"ms-0 px-3 py-2 align-items-center\">\r\n            <input className=\"me-4\" type=\"checkbox\" defaultChecked={selected}\r\n                onChange={async evt => await this.onCheckChanged(evt, dev)} />\r\n            <FA className=\"text-primary\" size=\"lg\" name=\"database\" fixWidth={true} />\r\n            <div className=\"mx-3\"><UqSpan id={dev} /></div>\r\n        </label>;\r\n    }\r\n\r\n    private onClickUq = (uq: number) => {\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { adminDevs } = this.controller;\r\n        let { uqDevs } = adminDevs;\r\n        let { user, uqs } = adminDevs.getUserUqsBuses(this.user);\r\n        let uqItems: { dev: number, selected: boolean }[] = uqDevs.map(uq => {\r\n            return {\r\n                dev: uq,\r\n                selected: uqs.findIndex(v => v === uq) >= 0\r\n            }\r\n        });\r\n        return <Page header=\"增减 - UQ\">\r\n            <div className=\"px-3 py-2\"><UserSpan id={user} /></div>\r\n            <div className=\"h-1c\" />\r\n\r\n            <List className=\"mb-3\" items={uqItems}\r\n                item={{ render: this.renderUqItem, onClick: this.onClickUq }} />\r\n            <div className=\"h-1c\" />\r\n        </Page>;\r\n    });\r\n}","import * as React from 'react';\r\nimport { CDevelopers } from \"./CDevelopers\";\r\nimport { VPage, Page, List, FA } from 'tonva';\r\nimport { UserSpan } from 'tools/userSpan';\r\nimport { BusSpan } from 'tools';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VBuses extends VPage<CDevelopers> {\r\n    private user: number;\r\n    async open(user: number) {\r\n        this.user = user;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onCheckChanged = async (evt: React.ChangeEvent<HTMLInputElement>, dev: number) => {\r\n        await this.controller.changeUserDev(evt.target.checked, 'bus', this.user, dev);\r\n    }\r\n\r\n    private renderBusItem = (item: { dev: number, selected: boolean }, index: number) => {\r\n        let { dev, selected } = item;\r\n        return <label className=\"ms-0 px-3 py-2 align-items-center\">\r\n            <input className=\"me-4\" type=\"checkbox\" defaultChecked={selected}\r\n                onChange={async evt => await this.onCheckChanged(evt, dev)} />\r\n            <FA className=\"text-primary\" size=\"lg\" name=\"database\" fixWidth={true} />\r\n            <div className=\"mx-3\"><BusSpan id={dev} /></div>\r\n        </label>;\r\n    }\r\n\r\n    private onClickBusItem = (bus: number) => {\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { adminDevs } = this.controller;\r\n        let { buses } = adminDevs;\r\n        let { user, buses: userBuses } = adminDevs.getUserUqsBuses(this.user);\r\n        let items: { dev: number, selected: boolean }[] = buses.map(dev => {\r\n            return {\r\n                dev: dev,\r\n                selected: userBuses.findIndex(v => v === dev) >= 0\r\n            }\r\n        });\r\n        return <Page header=\"增减 - UQ\">\r\n            <div className=\"px-3 py-2\"><UserSpan id={user} /></div>\r\n            <div className=\"h-1c\" />\r\n\r\n            <List className=\"mb-3\" items={items}\r\n                item={{ render: this.renderBusItem, onClick: this.onClickBusItem }} />\r\n            <div className=\"h-1c\" />\r\n        </Page>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport { CDevelopers } from \"./CDevelopers\";\r\nimport { VPage, Page, Form, ItemSchema, StringSchema, UiSchema, \r\n    ButtonSchema, UiTextItem, UiButton, Context } from 'tonva';\r\n\r\nexport class VAddDeveloper extends VPage<CDevelopers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onSubmitClick = async (name:string, context:Context) => {\r\n        let ret = await this.controller.addDev(context.data.user);\r\n        let {r} = ret;\r\n        if (r === 'success') {\r\n            this.closePage();\r\n            return;\r\n        }\r\n        let error: string;\r\n        switch (r) {\r\n            case 'is-root': error = '是创建人，不需要设为开发者'; break;\r\n            case 'is-owner': error = '是所有者，不需要设为开发者'; break;\r\n            case 'is-admin': error = '是管理员，不需要设为开发者'; break;\r\n            case 'is-dev': error = '已经是开发者了'; break;\r\n        }\r\n        context.setError('user', error);\r\n    }\r\n\r\n    private page = () => {\r\n        let schema: ItemSchema[] = [\r\n            {name: 'user', type: 'string', maxLength: 50, required: true} as StringSchema,\r\n            {name: 'submit', type: 'submit' } as ButtonSchema,\r\n        ];\r\n        let uiSchema: UiSchema = {\r\n            items: {\r\n                user: {widget: 'text', label: '用户名', placeholder: '请输入开发者的账号'} as UiTextItem,\r\n                submit: {widget: 'button', label: '提交', className:'btn btn-success'} as UiButton\r\n            }\r\n        };\r\n        return <Page header=\"新增开发者\">\r\n            <Form className=\"m-5\" schema={schema} uiSchema={uiSchema} \r\n                onEnter={this.onSubmitClick}\r\n                onButtonClick={this.onSubmitClick} />\r\n        </Page>;\r\n    }\r\n}","import { CUqBase } from \"UqApp\";\r\nimport { VDevelopers } from \"./VDevelopers\";\r\nimport { AdminDevs } from \"store/adminDevs\";\r\nimport { VUqsBuses } from \"./VUqsBuses\";\r\nimport { VUqs } from \"./VUqs\";\r\nimport { VBuses } from \"./VBuses\";\r\nimport { devApi, mainApi } from \"api\";\r\nimport { VAddDeveloper } from \"./VAddDeveloper\";\r\n\r\nexport class CDevelopers extends CUqBase {\r\n    adminDevs: AdminDevs;\r\n\r\n    protected async internalStart(adminDevs: AdminDevs) {\r\n        this.adminDevs = adminDevs;\r\n        this.openVPage(VDevelopers);\r\n    }\r\n\r\n    showUserUqsBuses(user: number) {\r\n        this.openVPage(VUqsBuses, user);\r\n    }\r\n\r\n    showUserUqs(user: number) {\r\n        this.openVPage(VUqs, user);\r\n    }\r\n    \r\n    showUserBuses(user: number) {\r\n        this.openVPage(VBuses, user);\r\n    }\r\n\r\n    async changeUserDev(isSelected:boolean, type:'uq'|'bus', user:number, dev:number) {\r\n        if (isSelected === true) {\r\n            await devApi.adminDevAdd({unit: this.adminDevs.unit.id, type: type, dev: dev, devUser: user});\r\n            this.adminDevs.devs.push({\r\n                type: type,\r\n                user: user,\r\n                dev: dev\r\n            });\r\n        }\r\n        else {\r\n            await devApi.adminDevDel({unit: this.adminDevs.unit.id, type: type, dev: dev, devUser: user});\r\n            let index = this.adminDevs.devs.findIndex(v => v.dev===dev && v.type===type && v.user===user);\r\n            if (index >= 0) this.adminDevs.devs.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    showAddDeveloper() {\r\n        this.openVPage(VAddDeveloper);\r\n    }\r\n\r\n    async addDev(dev:string): Promise<any> {\r\n        let {users, unit} = this.adminDevs;\r\n        let ret = await mainApi.addDev(unit.id, dev);\r\n        if (ret === undefined) {\r\n            throw new Error('unauthorized!');\r\n        }\r\n        let {r, id} = ret;\r\n        if (r === 'success') {\r\n            users.push(id);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    async delDev(user: number): Promise<void> {\r\n        let {users, unit} = this.adminDevs;\r\n        await mainApi.delDev(unit.id, user);\r\n        let index = users.findIndex(v => v === user);\r\n        if (index >= 0) users.splice(index, 1);\r\n    }\r\n}\r\n","import { observable } from \"mobx\";\r\nimport { mainApi } from \"api\";\r\nimport { Unit } from \"model\";\r\n\r\nexport interface AdminDev {\r\n    type: string;\r\n    dev: number;\r\n    user: number;\r\n}\r\n\r\nexport interface UserUqsBuses {\r\n    user: number;\r\n    uqs: number[];\r\n    buses: number[];\r\n}\r\n\r\nexport interface UqUsers {\r\n    uq: number;\r\n    users: number[];\r\n}\r\n\r\nexport interface BusUsers {\r\n    bus: number;\r\n    users: number[];\r\n}\r\n\r\nexport class AdminDevs {\r\n    private loaded:boolean = false;\r\n    unit: Unit;\r\n    @observable users: number[];\r\n    @observable uqDevs: number[];\r\n    @observable buses: number[];\r\n    @observable devs: AdminDev[];\r\n\r\n    constructor(unit: Unit) {\r\n        this.unit = unit;\r\n    }\r\n\r\n    async load() {\r\n        if (this.loaded === true) return;\r\n        let ret = await mainApi.adminDevs(this.unit.id);\r\n        this.loaded = true;\r\n        this.users = ret[0].map(v => v.user);\r\n        this.devs = ret[1];\r\n        this.uqDevs = ret[2].map(v => v.id);\r\n        this.buses = ret[3].map(v => v.id);\r\n    }\r\n\r\n    getUserUqsBuses(user: number):UserUqsBuses {\r\n        //let ret:UserUqsBuses[] = [];\r\n        //for (let user of this.users) {\r\n            let uqs: number[] = [];\r\n            let buses: number[] = [];\r\n            let ret = {\r\n                user: user,\r\n                uqs: uqs,\r\n                buses: buses\r\n            };\r\n            for (let dev of this.devs) {\r\n                if (dev.user === user) {\r\n                    switch (dev.type) {\r\n                        case 'uq': uqs.push(dev.dev); break;\r\n                        case 'bus': buses.push(dev.dev); break;\r\n                    }\r\n                }\r\n            }\r\n        //}\r\n        return ret;\r\n    }\r\n\r\n    getUqUsers(): UqUsers[] {\r\n        let ret:UqUsers[] = [];\r\n        for (let uq of this.uqDevs) {\r\n            let users: number[] = [];\r\n            ret.push({\r\n                uq: uq,\r\n                users: users,\r\n            });\r\n            for (let dev of this.devs) {\r\n                if (dev.type === 'uq' && dev.dev === uq) {\r\n                    users.push(dev.user);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    getBusUsers(): BusUsers[] {\r\n        let ret:BusUsers[] = [];\r\n        for (let bus of this.buses) {\r\n            let users: number[] = [];\r\n            ret.push({\r\n                bus: bus,\r\n                users: users,\r\n            });\r\n            for (let dev of this.devs) {\r\n                if (dev.type === 'bus' && dev.dev === bus) {\r\n                    users.push(dev.user);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n","import { DevUQ } from \"model\";\r\nimport { FA, List, VPage } from \"tonva\";\r\nimport { CUqRoles } from \"./CUqRoles\";\r\n\r\nexport class VUqRoles extends VPage<CUqRoles> {\r\n\theader() { return 'UQ角色设置' }\r\n\tcontent() {\r\n\t\tlet { devUQs, onDevUQ } = this.controller;\r\n\t\treturn <div>\r\n\t\t\t<List items={devUQs} item={{ render: this.renderDevUQ, onClick: onDevUQ }} />\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate renderDevUQ = (item: DevUQ & { roles: string[] }, index: number) => {\r\n\t\tlet { name, discription, roles } = item;\r\n\t\treturn <div className=\"px-3 py-2\">\r\n\t\t\t<FA name=\"database\" className=\"text-info my-2 mx-1\" size=\"lg\" />\r\n\t\t\t<div className=\"ms-3\">\r\n\t\t\t\t<div>{name}</div>\r\n\t\t\t\t<div className=\"small text-muted\">{discription}</div>\r\n\t\t\t\t<div className=\"mt-3\">\r\n\t\t\t\t\t<small className=\"text-muted me-1\">角色:</small>\r\n\t\t\t\t\t{roles?.map((v, index) => <span key={index} className=\"mx-2\">{v}</span>)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n}\r\n","import { Form, ItemSchema, VPage, StringSchema, ButtonSchema, UiButton, UiTextItem, Context } from \"tonva\";\r\nimport { CUqRoles } from \"./CUqRoles\";\r\n\r\nexport class VAddUser extends VPage<CUqRoles> {\r\n\theader() {return '新增角色用户'}\r\n\tcontent() {\r\n\t\tlet schema:ItemSchema[] = [\r\n\t\t\t{ name: 'userName', required: true, type: 'string', maxLength: 60 } as StringSchema,\r\n\t\t\t{ name: 'ok', type: 'submit' } as ButtonSchema,\r\n\t\t];\r\n\t\tlet uiSchema = {\r\n\t\t\titems: {\r\n\t\t\t\tuserName: { widget: 'text', label:'用户账号', placeholder: '请输入用户的账号' } as UiTextItem,\r\n\t\t\t\tok: { widget: 'button', className: 'btn btn-primary', label: '提交' } as UiButton,\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t<Form schema={schema} uiSchema={uiSchema} onButtonClick={this.onClick} onEnter={this.onEnter} />\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate onClick = async (name:string, context: Context) => {\r\n\t\tlet error = await this.controller.newUser(context.data['userName']);\r\n\t\tif (error) {\r\n\t\t\tcontext.setError('userName', error);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.closePage();\r\n\t}\r\n\r\n\tprivate onEnter = async (name:string, context: Context) => {\r\n\t\tawait this.onClick(name, context);\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport { FA, LMR, VPage } from \"tonva\";\r\nimport { CUqRoles, UserRole } from \"./CUqRoles\";\r\nimport { VAddUser } from \"./VAddUser\";\r\n\r\nexport class VRoleAdmin extends VPage<CUqRoles> {\r\n\theader() { return '设置用户角色' }\r\n\tcontent() {\r\n\t\tlet { userRoles } = this.controller;\r\n\t\tlet VItem = observer((v: { userRole: UserRole; isMe: boolean }) => this.renderItem(v.userRole, v.isMe));\r\n\t\tlet VUserRoles = observer(() => <>{\r\n\t\t\tuserRoles.map(v => {\r\n\t\t\t\treturn <VItem key={v.user} userRole={v} isMe={false} />;\r\n\t\t\t})\r\n\t\t}</>);\r\n\t\tlet MeItem = observer(() => <VItem userRole={this.controller.meRoles} isMe={true} />);\r\n\t\treturn <div>\r\n\t\t\t<div className=\"mx-3 mt-3 mb-1 d-flex align-items-end\">\r\n\t\t\t\t<div className=\"me-auto\">用户角色</div>\r\n\t\t\t\t<button className=\"btn btn-sm btn-outline-primary\" onClick={() => this.openVPage(VAddUser)}><FA name=\"plus\" /> 增加</button>\r\n\t\t\t</div>\r\n\t\t\t{\r\n\t\t\t\tuserRoles.length > 0 ? <>\r\n\t\t\t\t\t<MeItem />\r\n\t\t\t\t\t<VUserRoles />\r\n\t\t\t\t</>\r\n\t\t\t\t\t:\r\n\t\t\t\t\t<div className=\"small text-muted p-3\">[无角色用户]</div>\r\n\t\t\t}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderItem = (userRole: UserRole, isMe: boolean) => {\r\n\t\tif (!userRole) return null;\r\n\t\tlet { user, roles, isDeleted } = userRole;\r\n\t\tlet { allRoles } = this.controller;\r\n\t\tlet onUndo = () => this.controller.restoreUser(userRole);\r\n\t\tlet onDelete = () => this.controller.deleteUser(userRole);\r\n\t\tlet onRightClick: () => void;\r\n\t\tlet rightIcon: string;\r\n\t\tlet vUser = this.renderUser(user);\r\n\t\tlet cn = 'bg-white border-top ';\r\n\t\tif (isMe === true) {\r\n\t\t\tcn += 'mb-1';\r\n\t\t\tvUser = <>{vUser}<small className=\"ms-1 text-success\">[自己]</small></>;\r\n\t\t}\r\n\t\tif (isDeleted === true) {\r\n\t\t\tonRightClick = onUndo;\r\n\t\t\trightIcon = 'undo';\r\n\t\t\tvUser = <del>{vUser}</del>\r\n\t\t}\r\n\t\telse {\r\n\t\t\tonRightClick = onDelete;\r\n\t\t\trightIcon = 'times';\r\n\t\t}\r\n\t\tlet right = <div className=\"p-3 cursor-pointer text-info\" onClick={onRightClick}><FA name={rightIcon} /></div>;\r\n\t\treturn <LMR key={user}\r\n\t\t\tclassName={cn}\r\n\t\t\tleft={<div className=\"p-3 w-12c\">{vUser}</div>}\r\n\t\t\tright={right}\r\n\t\t>\r\n\t\t\t<div className=\"d-flex flex-wrap\">\r\n\t\t\t\t{roles.map((v, i) => {\r\n\t\t\t\t\tlet vCap: any = allRoles[i];\r\n\t\t\t\t\tif (isDeleted === true) vCap = <del>{vCap}</del>\r\n\t\t\t\t\treturn <label className=\"m-3\" key={i}>\r\n\t\t\t\t\t\t<input className=\"me-2\" type='checkbox'\r\n\t\t\t\t\t\t\tdisabled={isDeleted} defaultChecked={v}\r\n\t\t\t\t\t\t\tonChange={e => this.onRoleChange(e, i, userRole)} />\r\n\t\t\t\t\t\t{vCap}\r\n\t\t\t\t\t</label>;\r\n\t\t\t\t})}\r\n\t\t\t</div>\r\n\t\t</LMR>;\r\n\t}\r\n\r\n\tprivate async onRoleChange(event: React.ChangeEvent<HTMLInputElement>, iRole: number, userRole: UserRole) {\r\n\t\tlet { target } = event;\r\n\t\ttarget.disabled = true;\r\n\t\tawait this.controller.setUserRole(target.checked, iRole, userRole);\r\n\t\ttarget.disabled = false;\r\n\t}\r\n}\r\n","import { centerApi, UqApi } from 'tonva';\r\nimport { devApi } from \"../api\";\r\nimport { DevUQ, Unit } from \"../model\";\r\nimport { CUqBase } from \"UqApp\";\r\nimport { VUqRoles } from \"./VUqRoles\";\r\nimport { observable, runInAction } from 'mobx';\r\nimport { VRoleAdmin } from './VRoleAdmin';\r\n\r\nexport interface UserRole {\r\n\tuser:number; \r\n\troles:boolean[];\r\n\tisDeleted?: boolean;\r\n}\r\n\r\nexport class CUqRoles extends CUqBase {\r\n\tprivate unit: Unit;\r\n\tprivate uqApi: UqApi;\r\n\tprivate myRolesChanged:(roles:string[])=>void;\r\n\r\n\tdevUQs: (DevUQ&{roles:string[]})[];\r\n\tallRoles: string[];\r\n\t//roleCaptions: string[];\r\n\t@observable meRoles: UserRole = null;\r\n\t@observable userRoles: UserRole[] = null;\r\n\r\n\tprotected async internalStart(unit: Unit) {\r\n\t\tthis.unit = unit;\r\n\t\tawait this.loadUQs();\r\n\t\tthis.openVPage(VUqRoles);\r\n\t}\r\n\r\n\tasync loadUQs() {\r\n\t\tlet ret = await devApi.unitUQs(this.unit.id, 1000);\r\n\t\tthis.devUQs = ret.map(v => {\r\n\t\t\tlet roles: string[];\r\n\t\t\ttry {\r\n\t\t\t\troles = JSON.parse(v.roles);\r\n\t\t\t}\r\n\t\t\tcatch {\r\n\t\t\t\ttry {\r\n\t\t\t\t\troles = v.roles.split('\\t');\r\n\t\t\t\t}\r\n\t\t\t\tcatch {\r\n\t\t\t\t\troles = [];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!roles) return v;\r\n\t\t\troles = roles.filter(v => v);\r\n\t\t\treturn {\r\n\t\t\t\t...v,\r\n\t\t\t\troles,\r\n\t\t\t};\r\n\t\t});\r\n\t}\r\n\r\n\tonDevUQ = async (item: DevUQ & {roles: string[]}) => {\r\n\t\tlet basePath:string = 'tv/';\r\n\t\tlet appOwner:string = undefined;\r\n\t\tlet appName:string = undefined;\r\n\t\tlet uqOwner = item.owner;\r\n\t\tlet uqName = item.name;\r\n\t\tlet access:string[] = undefined;\r\n\t\tlet showWaiting = false;\r\n\t\tthis.uqApi = new UqApi(basePath, appOwner, appName, uqOwner, uqName, access, showWaiting);\r\n\t\tawait this.uqApi.init();\r\n\r\n\t\tthis.allRoles = item.roles;\r\n\t\tlet allUserRoles = await this.uqApi.getAllRoleUsers();\r\n\t\trunInAction(() => {\r\n\t\t\tlet r0 = allUserRoles.shift();\r\n\t\t\tlet {roles} = r0;\r\n\t\t\tif (roles) {\r\n\t\t\t\t//this.ixOfUsers = roles.split('|');\r\n\t\t\t}\r\n\t\t\tlet arr:string[] = this.allRoles.map(v => `|${v}|`);\r\n\t\t\tfunction rolesBool(t:string): boolean[] {\r\n\t\t\t\tif (!t) return arr.map(v => false);\r\n\t\t\t\treturn arr.map(v => t.indexOf(v) >= 0);\r\n\t\t\t}\r\n\t\t\tthis.userRoles = [];\r\n\t\t\tlet meId = this.user.id;\r\n\t\t\tfor (let ur of allUserRoles) {\r\n\t\t\t\tlet {user, roles} = ur;\r\n\t\t\t\tlet item:UserRole = ur as any;\r\n\t\t\t\titem.roles = rolesBool(roles);\r\n\t\t\t\tif (user === meId)\r\n\t\t\t\t\tthis.meRoles = item;\r\n\t\t\t\telse\r\n\t\t\t\t\tthis.userRoles.push(item);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.openVPage(VRoleAdmin);\r\n\t}\r\n\t\r\n\tasync setUserRole(checked:boolean, iRole:number, userRole:UserRole) {\r\n\t\tlet {roles} = userRole;\r\n\t\tlet len = roles.length;\r\n\t\tlet text:string = '';\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet yes = i===iRole? checked : roles[i];\r\n\t\t\tif (yes === true) text += '|' + this.allRoles[i];\r\n\t\t}\r\n\t\ttext += '|';\r\n\t\tawait this.uqApi.setUserRoles(userRole.user, text);\r\n\t\troles[iRole] = checked;\r\n\t\tthis.fireMyRolesChanged(userRole);\r\n\t}\r\n\r\n\tprivate fireMyRolesChanged(userRole: UserRole, newRoles?:boolean[]) {\r\n\t\tif (!this.myRolesChanged) return;\r\n\t\tif (userRole !== this.meRoles) return;\r\n\t\tlet {roles} = userRole;\r\n\t\tif (newRoles) roles = newRoles;\r\n\t\tlet roleNames:string[] = ['$'];\r\n\t\tfor (let i=0; i<roles.length; i++) {\r\n\t\t\tif (roles[i] === true) roleNames.push(this.allRoles[i]);\r\n\t\t}\r\n\t\tthis.myRolesChanged(roleNames);\r\n\t}\r\n\r\n\tprivate buildRolesText(userRole:UserRole) {\r\n\t\tlet ret = userRole.roles.map((v, index) => v===true? this.allRoles[index]:'').join('|');\r\n\t\treturn `|${ret}|`;\r\n\t}\r\n\r\n\tasync newUser(userName: string): Promise<string> {\r\n\t\tlet ret = await centerApi.userFromKey(userName);\r\n\t\tif (!ret) {\r\n\t\t\treturn '这个用户名没有注册';\r\n\t\t}\r\n\t\tlet user = ret.id;\r\n\t\tlet roles: string;\r\n\t\tif (this.isMe(user) === true) {\r\n\t\t\tif (this.meRoles) {\r\n\t\t\t\tthis.meRoles.isDeleted = false;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.meRoles = {\r\n\t\t\t\t\tuser,\r\n\t\t\t\t\troles:  this.allRoles.map(v => false)\r\n\t\t\t\t};\t\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet userRole = this.userRoles.find(v => v.user === user);\r\n\t\t\tif (userRole) {\r\n\t\t\t\tif (userRole.isDeleted === true) {\r\n\t\t\t\t\tuserRole.isDeleted = false;\r\n\t\t\t\t\troles = this.buildRolesText(userRole);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturn '这个用户已经是角色用户了';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tuserRole = {\r\n\t\t\t\t\tuser,\r\n\t\t\t\t\troles: this.allRoles.map(v => false),\r\n\t\t\t\t};\r\n\t\t\t\tthis.userRoles.push(userRole);\r\n\t\t\t\troles = '';\r\n\t\t\t}\r\n\t\t}\r\n\t\tawait this.uqApi.setUserRoles(user, roles);\r\n\t\tif (this.isMe(user) === true) {\r\n\t\t\tthis.fireMyRolesChanged(this.meRoles);\r\n\t\t}\r\n\t}\r\n\r\n\tasync deleteUser(userRole: UserRole) {\r\n\t\tlet {user} = userRole;\r\n\t\tuserRole.isDeleted = true; \r\n\t\tawait this.uqApi.deleteUserRoles(user);\r\n\t\tthis.fireMyRolesChanged(userRole, this.allRoles.map(v => false));\r\n\t}\r\n\r\n\tasync restoreUser(userRole: UserRole) {\r\n\t\tlet {user} = userRole;\r\n\t\tuserRole.isDeleted = false;\r\n\t\tlet roles = this.buildRolesText(userRole)\r\n\t\tawait this.uqApi.setUserRoles(user, roles);\r\n\t\tthis.fireMyRolesChanged(userRole);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { Page, ItemSchema, UiCheckItem, UiButton, ButtonSchema, Form, Context, Image, VPage } from 'tonva';\r\nimport { UnitAdmin } from '../model/index';\r\nimport { CAdmins } from './CAdmins';\r\n\r\nexport class VEditAdmin extends VPage<CAdmins> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onSubmit = async (name: string, context: Context) => {\r\n        let { isOwner, isAdmin } = context.form.data;\r\n        await this.controller.setAdmin(isOwner, isAdmin);\r\n        this.closePage();\r\n    }\r\n    private page = observer(() => {\r\n        let { unit, admins } = this.controller;\r\n        let { isRoot, isOwner } = unit;\r\n        let unitAdmin = admins.cur;\r\n        let owner: ItemSchema = { name: 'isOwner', type: 'boolean' };\r\n        let admin: ItemSchema = { name: 'isAdmin', type: 'boolean' };\r\n        let submit: ButtonSchema = { name: 'submit', type: 'submit' };\r\n        let schema: ItemSchema[];\r\n        if (isRoot === 1) schema = [owner, admin, submit];\r\n        else if (isOwner === 1) schema = [admin, submit];\r\n        let data = {\r\n            isOwner: unitAdmin.isOwner,\r\n            isAdmin: unitAdmin.isAdmin,\r\n        };\r\n\r\n        let uiSchema = {\r\n            items: {\r\n                'isOwner': { widget: 'checkbox', label: '高管', trueValue: 1, falseValue: 0 } as UiCheckItem,\r\n                'isAdmin': { widget: 'checkbox', label: '管理员', trueValue: 1, falseValue: 0 } as UiCheckItem,\r\n                'submit': { widget: 'button', label: '提交', className: 'btn btn-primary' } as UiButton,\r\n            }\r\n        };\r\n\r\n        return <Page header='权限'>\r\n            <div className=\"px-3\">\r\n                <Fellow {...admins.cur} />\r\n                <Form schema={schema} uiSchema={uiSchema} formData={data} onButtonClick={this.onSubmit} />\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n\r\nconst Fellow = (props: UnitAdmin) => {\r\n    let { name, nick, icon } = props;\r\n    //<img className='w-75' src={icon || process.env.REACT_APP_DEFAULT_ICON} />\r\n    return <div>\r\n        <div className='d-flex my-4'>\r\n            <Image className=\"w-3c h-3c me-3\" src={icon} />\r\n            <div className=\"\">\r\n                <h4 className='text-dark'>{name}</h4>\r\n                {nick && <h6><small className='text-secondary'>{nick}</small></h6>}\r\n            </div>\r\n        </div>\r\n        <hr className='mb-4' />\r\n    </div>;\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, Form, Schema, StringSchema, ButtonSchema, UiSchema, UiButton, UiTextItem, Context } from \"tonva\";\r\nimport { CAdmins } from './CAdmins';\r\nimport { unitCaption } from 'model';\r\n\r\nexport class VAddAdmin extends VPage<CAdmins> {\r\n    private roleNum:number;\r\n    private schema:Schema = [\r\n        {name: 'user', type: 'string', required: true} as StringSchema,\r\n        {name: 'submit', type: 'submit'} as ButtonSchema,\r\n    ];\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            'user': {widget: 'text', label: '用户', placeholder: '请输入用户账号'} as UiTextItem,\r\n            'submit': {widget: 'button', label: '提交', className: 'btn btn-primary'} as UiButton,\r\n        }\r\n    }\r\n    async open(roleNum:number) {\r\n        this.roleNum = roleNum;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onSubmit = async (name:string, context:Context) => {\r\n        let ret = await this.controller.addAdmin(context.data.user);\r\n        if (ret === undefined) {\r\n            this.closePage();\r\n            return;\r\n        }\r\n        let err:string;\r\n        switch (ret) {\r\n            default: err = '未知错误'; break;\r\n            case 'no-exist': err = '用户不存在'; break;\r\n            case 'me': err = '你自己已经是管理员'; break;\r\n            case 'admin': err = '已经是管理员'; break;\r\n        }\r\n        context.setError('user', err);\r\n    }\r\n\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'user') {\r\n            await this.onSubmit('login', context);\r\n            return;\r\n        }\r\n    }\r\n\r\n    private page = () => {\r\n        //let roleCaption = this.controller.getRoleCaption(this.roleNum);\r\n        return <Page header={'新增 - ' + unitCaption(this.controller.unit) + '管理员'} back=\"close\">\r\n            <div className=\"m-5 px-5 py-3 bg-white border rounded\">\r\n                <Form schema={this.schema} uiSchema={this.uiSchema}\r\n                    onEnter={this.onEnter}\r\n                    onButtonClick={this.onSubmit}/>\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { CAdmins } from \"./CAdmins\";\r\nimport { VPage, List, Page, Image, LMR, FA } from \"tonva\";\r\nimport { UnitAdmin } from 'model';\r\nimport { VEditAdmin } from './VEditAdmin';\r\nimport { VAddAdmin } from './VAddAdmin';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\n\r\nexport class VAdmins extends VPage<CAdmins> {\r\n    private list: List;\r\n    @observable allSelectVisible: boolean = true;\r\n    @observable allUnSelectVisible: boolean = false;\r\n    @observable disableDel: boolean = true;\r\n\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onNewFellow = () => {\r\n        //nav.push(<NewFellow />);\r\n    }\r\n    private onItemClick = (ua: UnitAdmin) => {\r\n        //store.admins.cur = ua;\r\n        this.controller.admins.cur = ua;\r\n        this.openVPage(VEditAdmin);\r\n        //nav.push(<EditAdmin />);\r\n    }\r\n    private onItemSelect = (ua: UnitAdmin, isSelected: boolean, anySelected: boolean) => {\r\n        this.disableDel = !anySelected;\r\n    }\r\n\r\n    private onSelectAll = () => {\r\n        this.list.selectAll();\r\n    }\r\n\r\n    private onClearAll = () => {\r\n        this.list.unselectAll();\r\n    }\r\n\r\n    private onDel = async () => {\r\n        await this.controller.delAdmins(this.list.selectedItems);\r\n    }\r\n\r\n    private row = ({ icon, name, nick }: UnitAdmin) => {\r\n        let content = nick ?\r\n            <><b>{nick}</b> &nbsp; <small className=\"text-muted\">{name}</small></>\r\n            :\r\n            <b>{name}</b>;\r\n        let left = <Image className=\"w-2-5c h-2-5c\" src={icon} />;\r\n        return <LMR className=\"py-2 px-3 align-items-stretch\" left={left}>\r\n            <div className=\"px-3\">{content}</div>\r\n        </LMR>;\r\n    }\r\n\r\n    onAddAdmin = () => {\r\n        this.openVPage(VAddAdmin);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { admins } = this.controller;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success me-2 align-self-center\"\r\n            onClick={this.onAddAdmin}><FA name=\"plus\" /></button>;\r\n        /*\r\n        let showOwners = false, showAdmins = false;\r\n        let ownersView:any, adminsView:any;\r\n        if (unit.isRoot === 1) {\r\n            showOwners = true;\r\n            showAdmins = true;\r\n        }\r\n        if (unit.isOwner === 1) showAdmins = true;\r\n        if (showOwners === true) {\r\n            let header = <LMR \r\n                className=\"px-3 py-1 small\"\r\n                left=\"高管\" \r\n                right={<a href='/' onClick={this.onNewOwner}>新增</a>} />;\r\n            ownersView = <List \r\n                className=\"my-4\"\r\n                header={header} items={owners}\r\n                none=\"[无]\"\r\n                item={{onClick: this.onItemClick, render: this.row}}\r\n            />;\r\n        }\r\n        if (showAdmins === true) {\r\n            let header = <LMR \r\n                className=\"px-3 py-1 small\"\r\n                left=\"管理员\" \r\n                right={<a href='/' onClick={this.onNewAdmin}>新增</a>} />;\r\n            adminsView = <List \r\n                className='my-4' \r\n                header={header} items={admins} \r\n                none='[无]'\r\n                item={{onClick: this.onItemClick, render: this.row}}\r\n            />;\r\n        }\r\n        */\r\n        let adminsView = <List ref={(list) => this.list = list}\r\n            className=\"my-1\" items={admins.admins}\r\n            none='[无]'\r\n            item={{ render: this.row, onSelect: this.onItemSelect }}\r\n        />;\r\n        let cnBtn = 'btn btn-sm btn-outline-info me-1';\r\n        let buttons = admins.admins.length > 0 && <div className=\"pl-3\">\r\n            <button className={cnBtn} onClick={this.onSelectAll}>全选</button>\r\n            <button className={cnBtn} onClick={this.onClearAll}>全清</button>\r\n            <button className={cnBtn} disabled={this.disableDel} onClick={this.onDel}>移除</button>\r\n        </div>;\r\n\r\n        return <Page header=\"管理员\" right={right}>\r\n            <div className='my-3'>\r\n                {buttons}\r\n                {adminsView}\r\n                {buttons}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import { CUqBase } from \"UqApp\";\r\nimport { Unit, UnitAdmin } from \"model\";\r\nimport { Admins } from \"store/admins\";\r\nimport { VAdmins } from \"./VAdmins\";\r\n\r\nexport class CAdmins extends CUqBase {\r\n    unit: Unit;\r\n    admins: Admins;\r\n    protected async internalStart(unit: Unit) {\r\n        this.unit = unit;\r\n        this.admins = new Admins(unit);\r\n        await this.admins.load();\r\n\r\n        this.openVPage(VAdmins);\r\n    }\r\n\r\n    setAdmin = async (isOwner:number, isAdmin:number) => {\r\n        await this.admins.unitSetAdmin(isOwner, isAdmin, 0);\r\n    }\r\n\r\n    addAdmin = async (user:string):Promise<string> => {\r\n        let ret = await this.admins.unitAddAdmin(user, 0, 1, 0);\r\n        if (typeof ret === 'object') return;\r\n        return ret;\r\n    }\r\n\r\n    delAdmins = async (unitAdmins: UnitAdmin[]) => {\r\n        if (await this.confirm({\r\n            caption: '确认移除',\r\n            message: '真的要移除这些管理员吗？' + unitAdmins.map(v => v.name).join(','),\r\n            ok: '确认'\r\n        }) === 'ok') {\r\n            let promises:Promise<any>[] = unitAdmins.map(v => this.admins.unitDelAdmin(v));\r\n            await Promise.all(promises);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page } from 'tonva';\r\nimport { List, SearchBox, LMR, FA } from 'tonva';\r\nimport { CUsers, AppUsers } from './CUsers';\r\n\r\nexport class VApps extends VPage<CUsers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderRow = (appUsers: AppUsers, index: number): JSX.Element => {\r\n        let { app, more, users } = appUsers;\r\n        let { name, discription } = app;\r\n        let right = <small className=\"text-muted\">{discription}</small>;\r\n        return <div className=\"d-block px-3 py-2\">\r\n            <LMR className=\"mb-2\" right={right}>\r\n                <FA name=\"address-card-o\" className=\"text-primary me-3\" />\r\n                <b>{name}</b>\r\n            </LMR>\r\n            <div>\r\n                <small className=\"text-muted\">用户: </small>\r\n                {users.length === 0 ?\r\n                    '[无]' :\r\n                    users.map(u => u.assigned || u.nick || u.name).join(', ') + (more === true ? ' ...' : '')}\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { appUsersList, searchApp, onAppsClick } = this.controller;\r\n        let searchBox = <SearchBox className=\"w-100 pr-1\"\r\n            onSearch={searchApp}\r\n            placeholder=\"搜索App\"\r\n            allowEmptySearch={true} />;\r\n        return <Page header={searchBox}>\r\n            <List items={appUsersList}\r\n                item={{ render: this.renderRow, onClick: onAppsClick, key: (item => item.app.id) }} />\r\n        </Page>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page, LMR } from 'tonva';\r\nimport { List, SearchBox, FA } from 'tonva';\r\nimport { CUsers, UserApps } from './CUsers';\r\n\r\nexport class VUsers extends VPage<CUsers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderRow = (userApps: UserApps, index: number): JSX.Element => {\r\n        let { user, apps } = userApps;\r\n        let { name, nick, assigned } = user;\r\n        let left = <FA name=\"user-o\" size=\"lg\" className=\"text-info mx-3 mt-2\" fixWidth={true} />;\r\n        return <LMR className=\"py-2\" left={left}>\r\n            <div className=\"mb-2\">\r\n                <b>{assigned || nick || name}</b>\r\n            </div>\r\n            <div className=\"d-flex flex-wrap mt-1\">\r\n                {apps.length === 0 ?\r\n                    <small className=\"text-muted\">[无]</small>\r\n                    :\r\n                    apps.map(a => this.box(a.name, 'px-2 text-info border-muted bg-white'))\r\n                }\r\n            </div>\r\n        </LMR>;\r\n    }\r\n\r\n    private box = (text: string, cn: string) => {\r\n        return <div className={'me-3 mb-1 py-1 small border rounded ' + cn} key={text}>{text}</div>;\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { userAppsList, searchUser, onUsersClick } = this.controller;\r\n        let searchBox = <SearchBox className=\"w-100 pr-1\" label=\"App管理员 &nbsp; \"\r\n            onSearch={searchUser}\r\n            placeholder=\"搜索管理员\"\r\n            allowEmptySearch={true} />;\r\n        return <Page header={searchBox}>\r\n            <List items={userAppsList}\r\n                item={{ render: this.renderRow, onClick: onUsersClick, key: (item => item.user.id) }} />\r\n        </Page>;\r\n    });\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page } from 'tonva';\r\nimport { List } from 'tonva';\r\nimport { CUsers, User } from './CUsers';\r\n\r\nexport class VApp extends VPage<CUsers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {curApp, curAppUsers, onAppEditUsers} = this.controller;\r\n        let right = <button className=\"btn btn-sm btn-success\" onClick={()=>onAppEditUsers()}>增减用户</button>;\r\n        return <Page header={'App - ' + (curApp.name)} right={right}>\r\n            <List items={curAppUsers} item={{render:this.renderApp}} />\r\n        </Page>\r\n    })\r\n\r\n    private renderApp = (user: User, index:number):JSX.Element => {\r\n        let {name, nick, assigned} = user;\r\n        let content:any;\r\n        if (assigned)\r\n            content = <span>{assigned} &nbsp; <small className=\"text-muted\">{name}</small></span>;\r\n        else if (nick)\r\n            content = <span>{nick} &nbsp; <small className=\"text-muted\">{name}</small></span>;\r\n        else\r\n            content = <>{name}</>\r\n        return <div className=\"px-3 py-2\">{content}</div>\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page, LMR, FA } from 'tonva';\r\nimport { List } from 'tonva';\r\nimport { CUsers, App } from './CUsers';\r\n\r\nexport class VUser extends VPage<CUsers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { curUser, curUserApps, onUserEditApps } = this.controller;\r\n        let right = <button className=\"btn btn-sm btn-success align-self-center me-2\" onClick={() => onUserEditApps()}>增减App</button>;\r\n        return <Page header={'用户 - ' + (curUser.assigned || curUser.nick || curUser.name)}\r\n            right={right}>\r\n            <List items={curUserApps} item={{ render: this.renderApp }} />\r\n        </Page>\r\n    })\r\n\r\n    private renderApp = (app: App, index: number): JSX.Element => {\r\n        let { name, discription } = app;\r\n        let left = <FA name=\"caret-square-o-right\" size=\"lg\" className=\"me-3 mt-1 text-info\" />;\r\n        let right = <small className=\"text-muted\">{discription}</small>\r\n        return <LMR className=\"px-3 py-2\" left={left} right={right}><b>{name}</b></LMR>\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page } from 'tonva';\r\nimport { List, LMR, Muted } from 'tonva';\r\nimport { CUsers, EditUser } from './CUsers';\r\n\r\nexport class VAppEditUsers extends VPage<CUsers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {curApp, appEditUsers} = this.controller;\r\n        return <Page header={curApp.name + ' - 增减用户'} >\r\n            <List items={appEditUsers} item={{render:this.renderUserItem}} />\r\n        </Page>\r\n    })\r\n\r\n    private renderUserItem = (editUser: EditUser, index:number):JSX.Element => {\r\n        let {name, nick, assigned, bind} = editUser;\r\n        let content:any;\r\n        if (assigned)\r\n            content = <>{assigned} <Muted>{name}</Muted></>;\r\n        else if (nick)\r\n            content = <>{nick} <Muted>{name}</Muted></>;\r\n        else\r\n            content = <>{name}</>\r\n        let right = <input type=\"checkbox\" defaultChecked={bind===1} \r\n            onChange={(evt)=>this.onUserChanged(editUser, evt.target.checked)} />;\r\n        return <LMR className=\"px-3 py-2 align-items-center\" right={right}>\r\n            {content}\r\n        </LMR>\r\n    }\r\n\r\n    private onUserChanged = async (editUser: EditUser, checked:boolean) => {\r\n        await this.controller.bindAppUser(editUser, checked);\r\n        editUser.bind = checked===true? 1: 0;\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page } from 'tonva';\r\nimport { List, LMR } from 'tonva';\r\nimport { CUsers, EditApp } from './CUsers';\r\n\r\nexport class VUserEditApps extends VPage<CUsers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {curUser, userEditApps} = this.controller;\r\n        return <Page header={'增减App - ' + (curUser.assigned || curUser.nick || curUser.name)}>\r\n            <List items={userEditApps} item={{render:this.renderApp}} />\r\n        </Page>\r\n    })\r\n\r\n    private renderApp = (editApp: EditApp, index:number):JSX.Element => {\r\n        let {name, discription, bind} = editApp;\r\n        let right = <input type=\"checkbox\" defaultChecked={bind===1} \r\n            onChange={(evt)=>this.onAppChanged(editApp, evt.target.checked)} />;\r\n        return <LMR className=\"px-3 py-2\" right={right}>\r\n            {name} {discription}\r\n        </LMR>\r\n    }\r\n\r\n    private onAppChanged = async (editApp: EditApp, checked:boolean) => {\r\n        await this.controller.bindUserApp(editApp, checked);\r\n        editApp.bind = checked===true? 1: 0;\r\n    }\r\n}","import * as React from 'react';\r\nimport { VPage, Page, Image } from 'tonva';\r\nimport { CUsers, User } from './CUsers';\r\nimport { SearchBox } from 'tonva';\r\nimport { mainApi } from 'api';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VAddUser extends VPage<CUsers> {\r\n    @observable private user: User = null;\r\n    //@observable private addedUser: User;\r\n    private searchBox: SearchBox;\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer((): JSX.Element => {\r\n        let searchBox = <SearchBox ref={v => this.searchBox = v}\r\n            className=\"w-100\"\r\n            onSearch={this.onSearch}\r\n            onFocus={this.onSearchFocus}\r\n            placeholder=\"用户全名/手机号/邮箱\"\r\n        />;\r\n        let content: any;\r\n        if (this.user === null) {\r\n        }\r\n        else if (this.user === undefined) {\r\n            content = <div className=\"text-info p-3\">没有找到用户</div>;\r\n        }\r\n        else {\r\n            let { name, nick, icon } = this.user;\r\n            let divUser: any;\r\n            if (nick) {\r\n                divUser = <><div><b>{nick}</b></div><div>{name}</div></>;\r\n            }\r\n            else {\r\n                divUser = <div><b>{name}</b></div>;\r\n            }\r\n            content = <div>\r\n                <div className=\"m-3 p-3 d-flex bg-white\">\r\n                    <Image src={icon} />\r\n                    <div className=\"ms-3\">{divUser}</div>\r\n                </div>\r\n                <div className=\"d-flex justify-content-center\">\r\n                    <button className=\"btn btn-success text-center\" onClick={this.onAddUser}>增加用户</button>\r\n                </div>\r\n            </div>;\r\n        }\r\n        /*\r\n        let divUserAdded:any;\r\n        if (this.addedUser) {\r\n            divUserAdded = <div className=\"p-3\">\r\n                <div>\r\n                    新增用户: {this.addedUser.name} &nbsp; &nbsp; \r\n                    <button className=\"btn btn-success\" \r\n                        onClick={()=>this.controller.onUserEditApps()}>\r\n                        为用户添加App\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        }\r\n        */\r\n        return <Page header={searchBox}>\r\n            {content}\r\n        </Page>;\r\n    })\r\n    //{divUserAdded}\r\n\r\n    private onSearch = async (key: string) => {\r\n        this.user = await mainApi.userFromKey(key);\r\n    }\r\n\r\n    private onAddUser = async () => {\r\n        await this.controller.addUser(this.user.id);\r\n        this.controller.curUser = this.user;\r\n        this.user = null;\r\n        this.searchBox.clear();\r\n        this.replacePage(this.addedPage);\r\n    }\r\n\r\n    private onSearchFocus = () => {\r\n        this.user = null;\r\n        //this.addedUser = null;\r\n        if (this.searchBox) this.searchBox.clear();\r\n    }\r\n\r\n    private onAddApps = () => {\r\n        this.closePage();\r\n        this.controller.onUserEditApps();\r\n    }\r\n\r\n    private onContinueAddUser = () => {\r\n        this.closePage();\r\n        this.controller.onAddUser();\r\n    }\r\n\r\n    private addedPage = () => {\r\n        return <Page header=\"添加成功\">\r\n            <div className=\"p-3 text-center\">\r\n                <div>\r\n                    新增用户: {this.controller.curUser.name}\r\n                </div>\r\n                <div className=\"mt-3\">\r\n                    <button className=\"btn btn-success me-3\"\r\n                        onClick={this.onAddApps}>\r\n                        为用户添加App\r\n                    </button>\r\n                    <button className=\"btn btn-outline-primary\"\r\n                        onClick={this.onContinueAddUser}>\r\n                        继续添加新用户\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n","import { observable } from 'mobx';\r\nimport { Controller } from 'tonva';\r\nimport { mainApi } from 'api';\r\nimport { VApps } from './VApps';\r\nimport { VUsers } from './VUsers';\r\nimport { VApp } from './VApp';\r\nimport { VUser } from './VUser';\r\nimport { VAppEditUsers } from './VAppEditUsers';\r\nimport { VUserEditApps } from './VUserEditApps';\r\nimport { VAddUser } from './VAddUser';\r\nimport { Unit } from 'model';\r\n\r\nexport interface User {\r\n    id: number;\r\n    name: string;\r\n    nick: string;\r\n    icon: string;\r\n    assigned: string;\r\n}\r\nexport interface App {\r\n    id: number;\r\n    name: string;\r\n    discription: string;\r\n}\r\nexport interface UserApps {\r\n    user: User;\r\n    apps: App[];\r\n}\r\nexport interface AppUsers {\r\n    app: App;\r\n    users: User[];\r\n    more: boolean;\r\n}\r\nexport interface EditApp extends App {\r\n    bind: number;   // 0: not bind, 1: bind\r\n}\r\nexport interface EditUser extends User {\r\n    bind: number;  // 0: not bind, 1: bind\r\n}\r\n\r\nexport class CUsers extends Controller {\r\n    private unit: Unit;\r\n    @observable userAppsList: UserApps[];\r\n    @observable appUsersList: AppUsers[];\r\n    curUser: User;\r\n    @observable curUserApps: App[];\r\n    @observable userEditApps: EditApp[];\r\n    curApp: App;\r\n    @observable curAppUsers: User[];\r\n    @observable appEditUsers: EditUser[];\r\n\r\n    protected async internalStart(unit:Unit) {\r\n        this.unit = unit;\r\n        //await this.loadAppUsers(undefined);\r\n        await this.loadUserApps(undefined);\r\n        //this.openVPage(VApps);\r\n        this.openVPage(VUsers);\r\n    }\r\n\r\n    private onAppUsers = async () => {\r\n        await this.loadAppUsers(undefined);\r\n        this.openVPage(VApps);\r\n    }\r\n\r\n    private onUserApps = async () => {\r\n        await this.loadUserApps(undefined);\r\n        this.openVPage(VUsers);\r\n    }\r\n\r\n    private async loadAppUsers(key:string) {\r\n        let list:AppUsers[] = [];\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        let ret = await mainApi.unitAppUsers(this.unit.id, key, pageStart, pageSize);\r\n\t\tlet apps = ret[0];\r\n        let users = ret[1];\r\n        let coll: {[id:number]:AppUsers} = {}\r\n        for (let a of apps) {\r\n            let app:App = {\r\n                id: a.id,\r\n                name: a.name,\r\n                discription: a.discription,\r\n            };\r\n            list.push(coll[a.id] = {app:app, more:false, users:[]});\r\n        }\r\n        for (let u of users) {\r\n            let user:User = {\r\n                id: u.user,\r\n                name: u.name,\r\n                nick: u.nick,\r\n                icon: u.icon,\r\n                assigned: u.assigned\r\n            }\r\n            let item = coll[u.app];\r\n            let {users} = item;\r\n            if (users.length >= 5) {\r\n                item.more = true;\r\n            }\r\n            else {\r\n                users.push(user);\r\n            }\r\n        }\r\n        this.appUsersList = list;\r\n    }\r\n\r\n    private async loadUserApps(key:string) {\r\n        let list:UserApps[] = [];\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        let ret = await mainApi.unitUsers(this.unit.id, key, pageStart, pageSize);\r\n        let users = ret[0];\r\n        let apps = ret[1];\r\n        let coll: {[id:number]:UserApps} = {}\r\n        for (let u of users) {\r\n            let user:User = {\r\n                id: u.id,\r\n                name: u.name,\r\n                nick: u.nick,\r\n                icon: u.icon,\r\n                assigned: u.assigned\r\n            };\r\n            list.push(coll[u.id] = {user:user, apps:[]});\r\n        }\r\n        for (let a of apps) {\r\n            let app:App = {\r\n                id: a.app,\r\n                name: a.name,\r\n                discription: a.discription,\r\n            }\r\n            coll[a.user].apps.push(app);\r\n        }\r\n        this.userAppsList = list;\r\n    }\r\n\r\n    searchUser = async(key:string) => {\r\n        await this.loadUserApps(key);\r\n    }\r\n\r\n    searchApp = async(key:string) => {\r\n        await this.loadAppUsers(key);\r\n    }\r\n\r\n    onAppsClick = async (appUsers: AppUsers) => {\r\n        this.curApp = appUsers.app;\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        this.curAppUsers = await mainApi.unitOneAppUsers(this.unit.id, this.curApp.id, pageStart, pageSize);\r\n        this.openVPage(VApp);\r\n    }\r\n\r\n    onUsersClick = async (userApps: UserApps) => {\r\n        this.curUser = userApps.user;\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        this.curUserApps = await mainApi.unitOneUserApps(this.unit.id, this.curUser.id, pageStart, pageSize);\r\n        this.openVPage(VUser);\r\n    }\r\n\r\n    onAppEditUsers = async (key?:string) => {\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        this.appEditUsers = await mainApi.unitAppEditUsers(this.unit.id, this.curApp.id, key, pageStart, pageSize);\r\n        this.openVPage(VAppEditUsers);\r\n    }\r\n\r\n    onAddUser = () => {\r\n        this.openVPage(VAddUser);\r\n    }\r\n\r\n    onUserEditApps = async (key?:string) => {\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        this.userEditApps = await mainApi.unitUserEditApps(this.unit.id, this.curUser.id, key, pageStart, pageSize);\r\n        this.openVPage(VUserEditApps);\r\n    }\r\n\r\n    bindAppUser = async(user:User, checked:boolean) => {\r\n        await mainApi.bindAppUser(this.unit.id, this.curApp.id, user.id, checked===true? 1:0);\r\n        let appUsers = this.appUsersList.find(v => v.app.id === this.curApp.id);\r\n        if (checked === true) {\r\n            this.curAppUsers.push(user);\r\n            if (appUsers) appUsers.users.push(user);\r\n        }\r\n        else {\r\n            let index = this.curAppUsers.findIndex(v => v.id === user.id);\r\n            if (index>=0) this.curAppUsers.splice(index, 1);\r\n            if (appUsers) {\r\n                index = appUsers.users.findIndex(v => v.id === user.id);\r\n                if (index>=0) appUsers.users.splice(index, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    bindUserApp = async(app:App, checked:boolean) => {\r\n        await mainApi.bindAppUser(this.unit.id, app.id, this.curUser.id, checked===true? 1:0);\r\n        if (this.userAppsList === undefined) return;\r\n        let userApps = this.userAppsList.find(v => v.user.id === this.curUser.id);\r\n        if (checked === true) {\r\n            this.curUserApps.push(app);\r\n            if (userApps) userApps.apps.push(app);\r\n        }\r\n        else {\r\n            let index = this.curUserApps.findIndex(v => v.id === app.id);\r\n            if (index>=0) this.curUserApps.splice(index, 1);\r\n            if (userApps) {\r\n                index = userApps.apps.findIndex(v => v.id === app.id);\r\n                if (index>=0) userApps.apps.splice(index, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    addUser = async (userId: number) => {\r\n        await mainApi.unitAddUser(this.unit.id, userId);\r\n    }\r\n}\r\n","import { appInFrame } from 'tonva';\r\nimport { UnitAdmin, Unit, DevApp } from '../model';\r\nimport { store } from '../store';\r\nimport { CUqBase } from 'UqApp';\r\nimport { VUnit } from './VUnit';\r\nimport { VHome } from './VHome';\r\nimport { CAppXAccount } from 'XAccount';\r\nimport { CDevelopers } from 'Dev/developers';\r\nimport { AdminDevs } from 'store/adminDevs';\r\nimport { CUqRoles } from '../UqRoles';\r\nimport { CAdmins } from 'Admins';\r\nimport { CUsers } from 'Users';\r\nimport { AppController, CUq } from 'Dev';\r\n\r\nexport class CHome extends CUqBase {\r\n    unit: Unit;\r\n    isProduction: boolean;\r\n    adminDevs: AdminDevs;\r\n    cAdmins: CAdmins;\r\n    cUsers: CUsers;\r\n    cUqRoles: CUqRoles;\r\n\r\n    protected async internalStart(param?: any): Promise<void> {\r\n        this.cAdmins = this.newC(CAdmins);\r\n        this.cUsers = new CUsers(this.res);\r\n        store.init();\r\n\r\n        this.isProduction = document.location.hash.startsWith('#tv');\r\n        console.log('admins isProduction %s', this.isProduction);\r\n\r\n        if (this.isProduction === false) {\r\n            await store.loadAdminUnits();\r\n        }\r\n        else {\r\n            await store.loadUnit();\r\n        }\r\n        this.openVPage(VHome);\r\n    }\r\n\r\n    startUq = (unit: Unit) => {\r\n        let cUq = this.newC(CUq);\r\n        cUq.start(unit);\r\n    }\r\n\r\n    startApp = (unit: Unit) => {\r\n        let appController = new AppController(this.res);\r\n        appController.start(unit.id);\r\n    }\r\n\r\n    onShowUnit = async (item: UnitAdmin) => {\r\n        appInFrame.unit = item.id; // 25;\r\n        store.init();\r\n        await store.loadUnit();\r\n\r\n        let { unit } = store;\r\n        this.adminDevs = new AdminDevs(unit);\r\n\r\n        let { isDev, type } = unit;\r\n        if (isDev === 1) {\r\n            // 开发号管理员\r\n            if ((type & 1) !== 0) {\r\n                await store.dev.loadCounts();\r\n            }\r\n\r\n            // 小号管理员\r\n            if ((type & 2) !== 0) {\r\n                await store.loadApps();\r\n            }\r\n        }\r\n        this.unit = unit;\r\n        this.cUqRoles = this.newC(CUqRoles, this.unit.id)\r\n        this.openVPage(VUnit);\r\n    }\r\n\r\n    logout = async () => {\r\n        store.logout();\r\n    }\r\n\r\n    showAppXAccount = async (appXAccount: DevApp) => {\r\n        let cAppXAccount = this.newC(CAppXAccount);\r\n        await cAppXAccount.start(this.unit, appXAccount);\r\n    }\r\n\r\n    async onShowDevelopers() {\r\n        await this.adminDevs.load();\r\n        let c = this.newC(CDevelopers);\r\n        c.start(this.adminDevs);\r\n    }\r\n}\r\n\r\n","import { CAppBase, IConstructor } from \"tonva\";\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\nimport { CUqBase } from \"./CBase\";\r\n//import { VMain } from './tonvaApp/main';\r\n//import { CMe } from \"me/CMe\";\r\nimport { CHome } from \"Home\";\r\n\r\nexport class CApp extends CAppBase {\r\n    cHome: CHome;\r\n\r\n    protected newC<T extends CUqBase>(type: IConstructor<T>): T {\r\n        return new type(this);\r\n    }\r\n\r\n    protected async internalStart() {\r\n        this.cHome = this.newC(CHome);\r\n        this.cHome.start();\r\n    }\r\n}\r\n","import { nav, NavView, start } from 'tonva';\r\nimport './App.css';\r\nimport { CApp } from 'UqApp/CApp';\r\n\r\n/*\r\nfunction App() {\r\n  return (\r\n    <div className=\"App\">\r\n      <header className=\"App-header\">\r\n        <img src={logo} className=\"App-logo\" alt=\"logo\" />\r\n        <p>\r\n          Edit <code>src/App.tsx</code> and save to reload.\r\n        </p>\r\n        <a\r\n          className=\"App-link\"\r\n          href=\"https://reactjs.org\"\r\n          target=\"_blank\"\r\n          rel=\"noopener noreferrer\"\r\n        >\r\n          Learn React\r\n        </a>\r\n      </header>\r\n    </div>\r\n  );\r\n}\r\n*/\r\n\r\nfunction App() {\r\n  let onLogined = async () => {\r\n    nav.clear();\r\n    await start(CApp, undefined);\r\n    //let cAdmin = new CHome({});\r\n    //await cAdmin.start();\r\n  }\r\n  return (<NavView onLogined={onLogined} />);\r\n}\r\n\r\nexport default App;\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\nimport './index.css';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}