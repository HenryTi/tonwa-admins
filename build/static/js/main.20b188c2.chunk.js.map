{"version":3,"sources":["tonva/index.ts","tonva/components/index.ts","tonva/net/guestApi.ts","tonva/net/caller.ts","tonva/components/nav.tsx","tonva/net/netToken.ts","tonva/components/fetchErrorView.tsx","tonva/components/reloadPage.tsx","tonva/tool/cacheIds.ts","tonva/tool/local.ts","tonva/tool/getObjPropIgnoreCase.ts","tonva/tool/rules.ts","tonva/vm/controller.tsx","tonva/vm/view.tsx","tonva/vm/vpage.tsx","tonva/vm/components/CStringEdit.tsx","tonva/components/page/page.tsx","tonva/net/appBridge.ts","tonva/uq/entity.ts","tonva/components/edit/itemEdit.tsx","tonva/uq/caller.ts","tonva/net/httpChannel.ts","tonva/net/httpChannelUI.ts","tonva/net/uqApi.ts","tonva/uq/index.ts","tonva/res/res.ts","tonva/tool/uid.ts","tonva/uq/query.ts","tonva/net/wsChannel.ts","tonva/components/image.tsx","tonva/tool/user.ts","tonva/net/host.ts","tonva-form/index.ts","tonva/components/page/scrollView.tsx","tonva/uq/action.ts","tonva/components/simple/Badge.tsx","tonva/components/simple/LMR.tsx","tonva/components/simple/FA.tsx","tonva/components/simple/Muted.tsx","tonva/components/simple/IconText.tsx","tonva/tool/localDb.ts","tonva/uq/tuid/reactBoxId.tsx","tonva/components/loading.tsx","tonva-form/form/control/control.tsx","tonva-form/form/control/checkControl.tsx","tonva-form/form/control/radioControl.tsx","tonva-form/form/control/charsControl.tsx","tonva-form/form/control/textAreaControl.tsx","tonva-form/form/control/selectControl.tsx","tonva-form/form/control/unknownControl.tsx","tonva-form/form/control/stringControl.tsx","tonva-form/form/control/numberControl.tsx","tonva-form/form/control/pickIdControl.tsx","tonva-form/form/control/pickTuidControl.tsx","tonva-form/form/control/pickControl.tsx","tonva-form/form/control/buttonsControl.tsx","tonva-form/form/control/index.ts","tonva/tool/env.ts","tonva/uq/tuid/index.ts","tonva-form/form/rowContainer/index.tsx","model/index.ts","tonva/net/apiBase.ts","tonva/components/edit/imageItemEdit.tsx","tonva/tool/pageItems.ts","tonva/net/messageHub.ts","tonva/components/navigo.ts","tonva/components/page/pageHeader.tsx","tonva/components/page/tabs.tsx","tonva/components/resUploader.tsx","tonva/uq/uqMan.ts","tonva/uq/sheet.ts","tonva/uq/book.ts","tonva/uq/history.ts","tonva/uq/map.ts","tonva/uq/pending.ts","tonva/uq/enum.ts","tonva-form/form/index.ts","tonva-form/form/formView.tsx","tonva/auth/meInfo.tsx","tonva/auth/createLogin.ts","tonva/uq/tag/tagView.tsx","tonva/uq/tag/tag.ts","tonva/res/formRes.ts","tonva/res/listRes.ts","tonva/components/page/index.ts","tonva/components/schema/index.ts","tonva/components/dropDownActions/index.tsx","tonva/components/easyDate/index.tsx","tonva/components/media.tsx","tonva/components/searchBox.tsx","tonva/components/userIcon.tsx","tonva/components/ax/index.tsx","tonva/uq/tuid/tuidsCache.ts","tonva/uq/uqsMan.ts","tonva/uq/buildUqApp.ts","model/id.ts","tonva-form/form/TonvaForm.tsx","tonva-form/multiStep/index.tsx","tonva/components/form/rules/index.ts","tonva/components/form/widgets/widget.tsx","tonva/components/form/widgets/textWidget.tsx","tonva/components/form/widgets/textareaWidget.tsx","tonva/components/form/widgets/passwordWidget.tsx","tonva/components/form/widgets/numberWidget.tsx","tonva/components/form/widgets/updownWidget.tsx","tonva/components/form/widgets/dateWidget.tsx","tonva/components/form/widgets/checkBoxWidget.tsx","tonva/components/form/widgets/selectWidget.tsx","tonva/components/form/widgets/radioWidget.tsx","tonva/components/form/widgets/rangeWidget.tsx","tonva/components/form/widgets/idWidget.tsx","tonva/components/form/widgets/unknown.tsx","tonva/components/form/widgets/buttonWidget.tsx","tonva/components/form/context.tsx","tonva/components/form/widgets/arrComponent.tsx","tonva/components/form/widgets/imageWidget.tsx","tonva/components/form/widgets/tagWidget.tsx","tonva/components/form/widgets/factory.tsx","tonva/components/form/form.tsx","tonva/components/form/field.tsx","tonva/auth/VLogout.tsx","tonva/img/logo.svg","tonva/auth/tools.tsx","tonva/auth/VLogin.tsx","tonva/auth/VChangePassword.tsx","tonva/auth/register/VStart.tsx","tonva/auth/register/VVerify.tsx","tonva/auth/register/VPassword.tsx","tonva/auth/register/VSuccess.tsx","tonva/auth/register/CRegister.ts","tonva/auth/CLogin.tsx","tonva/components/edit/stringItemEdit.tsx","tonva/components/edit/radioItemEdit.tsx","tonva/components/edit/selectItemEdit.tsx","tonva/components/edit/idItemEdit.tsx","tonva/components/edit/tagItemEdit.tsx","tonva/components/edit/textAreaItemEdit.tsx","tonva/components/edit/checkBoxItemEdit.tsx","tonva/components/edit/rangeItemEdit.tsx","tonva/components/edit/numberItemEdit.tsx","tonva/components/edit/edit.tsx","tonva/app/centerApi.ts","tonva/app/vMain.tsx","tonva/app/CAppBase.ts","tonva/app/start.ts","tonva/app/CBase.ts","tonva/components/list/base.tsx","tonva/components/list/clickable.tsx","tonva/components/list/static.tsx","tonva/components/list/selectable.tsx","tonva/components/list/index.tsx","tonva/components/propGrid/row.tsx","tonva/components/propGrid/propView.tsx","tonva/components/propGrid/PropGrid.tsx","tonva/uq/tuid/idCache.ts","tonva/uq/tuid/tuid.ts","api/mainApi.ts","api/devApi.ts","store/cacheIds.ts","store/dev.ts","store/store.ts","UqApp/CBase.ts","tools/idDates.tsx","tools/span.tsx","tools/unitSpan.tsx","consts.ts","tools/uqSpan.tsx","tools/appSpan.tsx","tools/busSpan.tsx","tools/serverSpan.tsx","tools/stringValueEdit.tsx","tools/idPickPage.tsx","tools/createIdPick.tsx","Apps/info.tsx","Apps/new.tsx","Apps/index.tsx","Dev/apps/appsPage.tsx","Dev/apps/editPage.tsx","Dev/apps/appUqs.tsx","Dev/apps/appPage.tsx","Dev/apps/uqBindPage.tsx","Dev/apps/index.tsx","Dev/uqs/resultSections.tsx","Dev/uqs/compileResultPage.tsx","Dev/uqs/uqUpload.tsx","Dev/uqs/newServicePage.tsx","Dev/uqs/servicePage.tsx","Dev/uqs/editPage.tsx","Dev/uqs/uqPage.tsx","Dev/uqs/listPage.tsx","Dev/uqs/VUqDevsAdmin.tsx","Dev/uqs/CPickServer.tsx","store/admins.ts","Dev/uqs/CUq.tsx","Dev/buses.tsx","Dev/servers.tsx","Dev/ObjView.tsx","Home/VUnit.tsx","Home/VHome.tsx","XAccount/VApp.tsx","XAccount/VDetail.tsx","XAccount/VUser.tsx","XAccount/VAdmins.tsx","XAccount/VRoleUsers.tsx","XAccount/VNoRoleUsers.tsx","XAccount/VAddUserPage.tsx","XAccount/VUserList.tsx","tools/userSpan.tsx","XAccount/VEditUserPage.tsx","XAccount/CAppXAccount.ts","Dev/developers/VDevelopers.tsx","Dev/developers/VUqsBuses.tsx","Dev/developers/VUqs.tsx","Dev/developers/VBuses.tsx","Dev/developers/VAddDeveloper.tsx","Dev/developers/CDevelopers.ts","store/adminDevs.ts","Admins/VEditAdmin.tsx","Admins/VAddAdmin.tsx","Admins/VAdmins.tsx","Admins/CAdmins.ts","Users/VApps.tsx","Users/VUsers.tsx","Users/VApp.tsx","Users/VUser.tsx","Users/VAppEditUsers.tsx","Users/VUserEditApps.tsx","Users/VAddUser.tsx","Users/CUsers.tsx","Home/CHome.tsx","UqApp/CApp.ts","App.tsx","reportWebVitals.ts","index.tsx"],"names":["guestApi","this","get","ret","decodeGuestToken","guest","token","unitName","unit","CenterApiBase","undefined","Caller","params","waiting","_params","method","logMark","netToken","userId","setCenterToken","WSChannel","FetchErrorView","reApi","a","props","clearError","channel","url","options","resolve","reject","refetchApi","close","errContent","error","err","i","push","style","wordWrap","className","type","onClick","React","SystemNotifyPage","message","header","ReloadPage","timerHandler","reload","clearInterval","nav","seconds","state","setInterval","setState","title","msg","ConfirmReloadPage","back","confirm","isMobile","RegExp","test","navigator","userAgent","logs","stackKey","NavView","stack","waitCount","waitTimeHandler","upgradeUq","start","isHistoryBack","navBack","tick","Date","now","console","log","length","len","window","self","top","postMessage","confirmClose","pop","fetchError","wait","set","addEventListener","init","env","setTimeout","clearTimeout","unauthorized","showLogin","uq","version","show","view","disposer","clear","removeCeased","history","pushState","key","ceased","refresh","item","dispose","level","p","backLevel","popAndDispose","find","v","elWait","elError","testing","left","zIndex","name","map","index","visibility","position","navView","wsHost","local","LocalData","navigo","navSettings","language","culture","resUrl","hashParam","centerHost","arrs","windowOnError","event","source","lineno","colno","windowOnUnhandledRejection","ev","reason","windowOnClick","windowOnMouseMove","x","y","windowOnScroll","forceDevelopment","navLogin","user","navLogout","showLogout","navRegister","showRegister","navForget","showForget","navPageRoutes","doneSysRoutes","sysRoutes","isWebNav","backIcon","closeIcon","pageWebNav","showPrivacyPage","privacy","getPrivacyContent","privacyPage","htmlString","content","__html","dangerouslySetInnerHTML","createLogin","login","Promise","race","serviceWorker","ready","registration","unregister","document","location","plus","webview","webView","resetAll","ok","showReloadPage","localStorage","lang","resOptions","district","messageHub","dispatch","unitJsonPath","fetch","unitRes","json","res","remove","el","getElementById","innerText","loadUnitJson","innerHTML","JSON","parse","envUnit","process","REACT_APP_UNIT","Number","isDevelopment","id","getPredefinedUnitName","unitFromName","unitId","settings","origin","pathname","toLowerCase","endsWith","substr","host","hash","pos","getExHashPos","substring","ws","resHost","resUrlFromHost","setCenterUrl","Error","setGuest","exHash","getExHash","appInFrame","setAppInFrame","parent","loadPredefinedUnit","predefinedUnit","onerror","onunhandledrejection","onselectstart","oncontextmenu","startWait","notLogined","logined","endWait","Navigo","historyAPIUpdateMethod","on","navigate","navPage","alert","queryStr","routeFromNavPage","internalOnNavRoutes","_","merge","navOns","route","absolute","showPage","isUserLogin","onLogined","userApi","me","icon","nick","callback","logoutApis","stringify","saveLocalUser","showAppView","internalLogined","defaultTop","loginTop","withBack","getLogin","logoutClear","showChangePassword","onError","showUpgradeUq","replace","topKey","popTo","ceaseTop","regConfirmClose","confirmBox","apiId","sheetType","sheetId","sheet","includes","uh","appUrl","src","String","open","date","getTime","toTimeString","step","href","indexOf","text","r","parser","DOMParser","htmlDoc","parseFromString","elHtml","getElementsByTagName","newVersion","getAttribute","g","oem","observable","CacheIds","maxCount","arr","ids","dict","loadId","shift","delete","_loadIds","items","_loadId","setItem","e","Map","localDb","child","_user","_guest","_unit","forEach","d","getObjPropIgnoreCase","obj","prop","keys","Object","mobileRegex","emailRegex","Controller","_t","t","label","isDev","receiveHandlerId","unregisterReceiveHandler","onDispose","onMessageReceive","onMessage","_resolve_$","topPageKey","str","internalT","beforeInit","getPageWebNav","afterInit","webNav","$lang","$district","l","vp","param","afterBack","replaceOpen","render","value","onEvent","openPage","registerReceiveHandler","beforeStart","internalStart","afterStart","page","onClosePage","go","caption","yes","no","classNames","closePage","buttons","View","controller","isMe","vm","vCall","returnCall","imageClassName","textClassName","renderUser","replacePage","backPage","ceasePage","popToTopPage","VPage","retOnClosePage","_onClosePage","openPageElement","renderPage","replacePageElement","logout","right","footer","onScroll","onPageScroll","onScrollTop","scroller","onPageScrollTop","onScrollBottom","onPageScrollBottom","headerClassName","tabsProps","onChange","evt","newValue","target","preValue","isChanged","onBlur","verifyValue","onFocus","onEdit","maxLength","placeholder","onValueChange","onSave","createElement","observer","disabled","onKeyDown","keyCode","defaultValue","renderValue","renderPencil","Page","tabsView","TabsView","inWebNav","pageHeaderProps","center","rph","renderPageHeader","elFooter","errorInfo","children","renderHeader","renderFooter","uqTokens","logoutUqTokens","appsInFrame","val","isBridged","subFrameStarted","data","subWin","setSubAppWindow","hidden","hideFrameBack","clone","initSubWin","onReceiveAppApiMessage","apiName","db","parts","split","uqOwner","uqName","appOwner","appName","uqTokenApi","onAppApiReturn","urlTest","action","uqTokenActions","realUrl","getUrlOrTest","appHash","slice","lastIndexOf","u","uid","getUnit","realUnit","onReceive","callCenterApiFromMessage","bridgeCenterApiReturn","startsWith","buildAppUq","uqToken","centerToken","at","opener","appUq","brideCenterApis","bridgeCenterApi","body","callId","from","callCenterapi","directCall","result","bca","ln","chars","codeBackSlash","charCodeAt","codeN","codeT","codeB","codeF","codeV","codeR","codes","codeBN","codeBT","codeBB","codeBF","codeBV","codeBR","Entity","typeId","jName","schema","ver","sys","cache","uqApi","fields","arrFields","returns","face","fieldMaps","localMap","f","loadEntitySchema","buildSchema","loadValues","setSchema","buildFieldsTuid","setJName","buildFieldTuid","buildArrFieldsTuid","fieldName","arrName","entities","fn","getTuid","an","fieldArr","tuid","buildFieldsParams","arrResult","pa","rowResult","field","buildDateTimeParam","getFullYear","getMonth","getDate","_tuid","getIdFromObj","dt","Math","floor","toISOString","packRow","arrData","packArr","join","row","ch","escape","values","boxId","unpackRow","unpackArr","ch0","c","fLen","to","reverseNT","n","isNaN","p0","vals","ItemEdit","edit","itemSchema","uiItem","_itemSchema","_uiItem","internalEnd","divValue","labelHide","templet","Templet","widget","list","rules","nv","Array","isArray","verifyRule","rule","EntityCaller","entity","tries","_entity","loadSchema","innerRequest","xcall","innerCall","jsonResult","$uq","$modify","pullModify","xresult","retry","rebuildSchema","buildEntities","uqVersion","en","ActionCaller","QueryQueryCaller","unpackReturns","buildParams","QueryPageCaller","pageStart","pageSize","methodsWithBody","HttpChannel","hostUrl","apiToken","ui","timeout","showError","post","urlPrefix","caller","buildOptions","headers","path","h","encodeURI","innerFetch","k","innerFetchResult","buildError","ex","retErr","that","timeOutHandler","statusText","ct","then","retJson","retError","catch","buildHeaders","CenterHttpChannel","UqHttpChannel","HttpChannelNavUI","channelUIs","channelNoUIs","channels","UqApi","basePath","access","showWaiting","channelUI","acc","ApiBase","UnitxApi","buildChannel","centerAppApi","CenterAppApi","unitxUq","centerChannel","centerChannelUI","loginedUserId","uqTokensName","un","localCache","nowTick","appUqParams","call","loadAppUqs","uqs","decodeUserToken","account","verify","password","resLang","languages","toUpperCase","setResOptions","resGlobal","setRes","setGlobalRes","ALPHABET","rtn","charAt","random","Query","PageItems","more","startField","isPaged","size","$page","array","deep","pageCaller","request","queryCaller","query","table","subAppWindow","postWsToSubApp","win","WsBase","wsBaseSeed","wsBaseId","WebSocket","onopen","onmessage","wsMessage","onclose","receive","netThis","connect","send","Image","altImage","alt","currentTarget","jwtDecode","uqDebugHost","hosts","centerhost","reshost","uqhost","unitxhost","httpArr","urlFromHost","isAbsoluteUrl","centerUrlFromHost","centerWsFromHost","https","fetchOptions","mode","tryLocal","getCenterHost","getResHost","promises","hostArr","findIndex","fetchUrl","debugHostUrl","localCheck","all","results","j","hostValue","debugHost","getUrlOrDebug","urlDebug","fetchLocalCheck","Scroller","scrollTo","scrollTop","offsetHeight","scrollTimeGap","ScrollViewBase","bottomTime","topTime","div","refDiv","onResize","removeEventListener","sh","scrollHeight","direct","Children","_$scroll","toString","eachChild","Component","ScrollView","ref","WebNavScrollView","vHeader","vFooter","navHeader","navRawHeader","navFooter","navRawFooter","Action","ActionSubmitCaller","SubmitReturnsCaller","SubmitConvertCaller","pack","Badge","b","badge","color","badgeAlign","badgeVertical","cn","LMR","cursor","FA","spin","fixWidth","border","pull","pulse","rotate","flip","inverse","Muted","__ls","getItem","removeItem","LocalCache","removeLocal","Local","caches","locals","keyForGet","keyForSet","sk","LocalArr","LocalMap","keyForRemove","removeAll","ks","unshift","splice","saveIndex","max","ls","TuidContent","tuidName","uqStringify","s","ReactBoxId","isUndefined","boxName","assureBox","valueFromId","tuidValue","nullUI","ttv","divObj","bi","logContent","boxIdContent","Loading","ControlBase","formView","renderControl","validate","hasError","computed","Control","_field","_face","element","setProps","bind","clearErrors","clearValue","isOK","getValueFromElement","isOk","notes","CheckControl","trueValue","falseValue","assign","checked","RadioControl","CharsControl","required","trim","parseValue","renderInput","renderError","TextAreaControl","rows","SelectControl","selectedOptions","default","UnknownControl","role","EmptyControl","StringControl","PasswordControl","NumberControl","extraChars","min","parseFloat","onKeyPress","charCode","onKeyDot","onKeyNeg","preventDefault","PickIdControl","pick","fromPicked","readValues","onPicked","itemFromId","initCaption","input","controlContent","component","PickTuidControl","onIdChanged","onFormValues","buildContent","PickControl","Content","ButtonsControl","otherClick","onOther","nothing","btnOther","submitButton","otherButton","createControl","form","group","groupRow","createGroupControl","fieldRow","fieldType","defaultFaces","controlTypes","createFieldControl","help","tag","ms","args","global","handle","RowContainer","control","cc","setError","setInitValues","filled","ElementRowContainer","BootStrapRowContainer","bootstrapCreateRow","elementCreateRow","getHttpChannel","callFetch","put","ImageItemEdit","resId","onSaved","itemObservable","isFirst","pageItemAction","itemConverter","_items","scrollToTop","scrollIntoView","topDiv","scrollToBottom","bottomDiv","firstSize","appendPosition","sortOrder","changing","divId","getPageId","loadResults","pageList","beforeLoad","loaded","allLoaded","reset","isAsc","endItem","scrollToEnd","pushItem","endIndex","startId","pid","sum","load","setLoaded","loading","onLoad","setPageStart","onLoaded","reverse","handlerSeed","anyHandlers","msgHandlers","handler","seed","args0","handlerId","$type","useHash","root","_routes","_useHash","_hash","_paused","_destroyed","_lastRouteResolved","_notFoundHandler","_defaultHandler","_usePushState","_genericHooks","_historyUpdateMethod","timout","_onLocationChange","isPushStateAvailable","_cLoc","_listen","updatePageLinks","cleanUrl","match","names","reduce","decodeURIComponent","paramNames","regexp","PARAMETER_REGEXP","full","dots","REPLACE_VARIABLE_REGEXP","WILDCARD_REGEXP","REPLACE_WILDCARD","FOLLOWED_BY_SLASH_REGEXP","MATCH_REGEXP_FLAGS","urlA","urlB","getUrlDepth","routes","replaceDynamicURLParts","clean","regExpResultToParams","filter","m","findMatchedRoutes","colonExp","matched","routeExp","fallbackURL","matched0","cleanGETParam","hooks","exHooks","before","shouldRoute","after","_getRoot","_historyUpdate","arg0","arg1","orderedRoutes","sort","compareUrlDepth","uses","_add","current","GETParameters","extractGETParameters","onlyURL","getOnlyURL","already","manageHooks","_callLeave","isHashedRoot","_findLinks","link","hasListenerAttached","ctrlKey","metaKey","tagName","getLinkPath","status","pause","destroy","as","replaceState","cLocRoot","isHashChangeAPIAvailable","cached","check","querySelectorAll","lastRouteResolved","leave","onBack","vBack","debugLogout","rightView","Tab","contentBuilder","notify","onShown","_content","selected","tabBg","sep","tabClick","tab","selectedTab","tabArr","shown","tabs","bsCur","bsTab","tabPosition","borderColor","borderStyle","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","notifyCircle","num","displayNone","pageHeader","pageFooter","tabBack","isSelected","display","ResUploader","fileInput","upload","formData","buildFormData","Headers","append","onFilesChange","files","fileName","maxSize","FormData","file","multiple","formatSize","pointLength","units","toFixed","xlargeSize","mediumSize","ImageUploader","imgBaseSize","imageTypes","suffix","resUploader","onFileChange","fileError","uploaded","enableUploadButton","reader","FileReader","readAsDataURL","onload","srcImage","setSize","desImgSize","desImage","compress","img","width","height","srcImgWidth","srcImgHeight","w","scale","desImgWidth","round","desImgHeight","canvas","ctx","getContext","anw","createAttribute","nodeValue","anh","setAttributeNode","drawImage","base64","toDataURL","blob","convertBase64UrlToBlob","showOrgImage","maxWidth","urlData","mime","bstr","atob","u8arr","Uint8Array","Blob","defaultChecked","levelDiv","padding","AudioUploader","audioTypes","fileSize","uploading","UqMan","uqData","createBoxId","tvs","enums","actions","sheets","queries","books","maps","histories","pendings","tags","tuidsCache","localAccess","localModifyMax","tuids","createBoxIdFromTVs","tuidArr","actionArr","enumArr","sheetArr","queryArr","bookArr","mapArr","historyArr","pendingArr","tagArr","TuidsCache","accesses","loadAccess","buildTuids","buildAccess","newTuid","entityName","allSchemas","fromType","fromObj","defer","cacheTuids","enm","UqEnum","TuidImport","TuidInner","book","Book","Tag","History","pending","Pending","Sheet","newAction","newQuery","newBook","newMap","newHistory","newSheet","newPending","newTag","newEnum","buildSheet","build","mainFields","buildTuidBox","owner","ownerField","buildTuidDivBox","modifyMax","states","ops","op","discription","app","SaveCaller","SaveDirectCaller","flow","ActionDirectCaller","brief","unpackSheet","flows","GetSheetCaller","getArchive","unpack","SheetArchiveCaller","SheetArchivesCaller","StateSheetsCaller","PageStateItems","StateSheetCountCaller","UserSheetsCaller","MySheetsCaller","SheetCaller","resVerify","count","getStateSheets","queryApiName","BookQueryCaller","schemaFrom","actionSchema","querySchema","AddCaller","DelCaller","AllCaller","PageCaller","qc","QueryCaller","MapCaller","getCaller","MapAddCaller","add","MapDelCaller","MapAllCaller","MapPageCaller","MapQueryCaller","FormView","buttonsRow","buildRows","onSubmit","initValues","formRows","createRow","buildRow","readOnly","createButtons","formRow","formRowCreator","some","every","uiSchema","onItemChanged","userSetProp","importCLogin","CLogin","radioStyle","TagView","nameFromId","namesFromIds","renderRadio","renderView","renderCheck","wrapClassName","inputs","inputName","onInputChange","coll","_view","lines","line","ext","formRes","number","integer","zh","listRes","none","DropdownActions","menu","button","handleDocumentClick","dropdownOpen","contains","toggle","isRight","itemIconClass","itemCaptionClass","hasIcon","data-toggle","aria-expanded","iconClass","captionClass","aria-hidden","onTouchStart","timeRes","md","month","ymd","year","yesterday","today","tomorrow","$zh","$en","tt","renderDate","vDate","withTime","always","nDate","_date","nowYear","hour","getHours","minute","getMinutes","appendTime","dPart","hm","EasyDate","EasyTime","Media","disp","main","px","py","SearchBox","allowEmptySearch","initKey","onSearch","inputSize","inputClassName","buttonText","userCache","loader","UserView","noneImage","getValue","idProp","useUser","use","Ax","axProps","aClassName","naClassName","openSysPage","cacheTimer","loadIds","clearCacheTimer","cacheIds","tuidCached","innerPullModify","tuidLists","queueModify","queue","modify","modifyIds","UQsMan","tonvaAppName","collection","localData","buildTVs","uqsMan","uqAppData","retErrors","setTuidImportsLocal","_uqs","buildUQs","errors","uqTVs","lj","uqsData","promiseInits","uqFullName","lower","loadEntities","uqMan","uqKey","proxy","Proxy","receiver","showReload","isImport","setInner","tuidImport","fromName","iName","setFrom","unitCaptions","1","2","3","unitCaption","TonvaForm","MultiStep","stepViews","topView","onPrev","onNext","nextStepName","next","setStep","first","stepName","steps","ButtonConten","prefix","btnContent","formProps","pIcon","sIcon","Rule","RuleCustom","func","defy","RulePredefined","RuleRequired","RuleNum","minMsg","maxMsg","template","checkMore","RuleInt","isInteger","Widget","context","fieldProps","_ui","isChanging","changeValue","container","visible","inNode","requiredFlag","FieldContainer","renderBody","getUiItem","contextErrors","buildRules","removeErrorWidget","addErrorWidget","initData","fromElement","onChanging","onChanged","prev","allowChange","setDataValue","setElementValue","elDiscription","discriptionClassName","errorList","fieldClass","FieldClass","uiLabel","TextWidget","inputType","internalOnKeyDown","onEnter","blur","checkRules","checkContextRules","hasFocus","renderTemplet","renderErrors","TextAreaWidget","setValue","PasswordWidget","UrlWidget","EmailWidget","NumberWidget","UpdownWidget","returnValue","isValidKey","DateWidget","DateTimeWidget","TimeWidget","MonthWidget","CheckBoxWidget","SelectWidget","select","option","RadioWidget","rowKey","isRow","RangeWidget","IdWidget","pickId","clearContextError","Unknown","dataType","uiType","dataTypes","ButtonWidget","submit","observerRender","widgetType","ButtonClass","Context","subContexts","widgets","arrRowContexts","itemName","getDisabled","setDisabled","getReadOnly","setReadOnly","getVisible","setVisible","buttonName","errorWidgets","ew","onButtonClick","checkFieldRules","rowContext","setContextError","clearWidgetsErrors","clearContextErrors","checkHasError","rowKeySeed","RowContext","parentContext","arrSchema","uiArr","itemSchemas","FormContext","ContextContainer","ArrComponent","selectable","deletable","restorable","getArrRowContexts","onDeleted","onRestored","arrLabel","ArrContainer","RowSeperator","formSelectable","formDeletable","formRestorable","arrSelectable","arrDeletable","arrRestorable","ac","rc","rs","rowContent","typeofTemplet","factory","selectCheck","deleteIcon","$isSelected","$source","isDeleted","$isDeleted","editContainer","Provider","ImageWidget","imageSrc","end","TagWidget","widgetsFactory","textarea","datetime","time","email","updown","checkbox","image","checkboxes","radio","tagSingle","valuesView","renderRadios","tagMulti","defaultArr","def","renderChecks","range","typeWidget","getItemSchema","getTypeWidget","WidgetClass","Form","formContext","Container","watch","calcSelectOrDelete","DefaultContainer","DefaultFieldContainer","fieldLabelSize","labelView","fieldCol","DefaultFieldClass","DefaultButtonClass","DefaultRes","autorun","dv","initDataItem","arrItem","arrItems","arrDict","arrItemOperated","formArrVal","beforeShow","renderContent","contextType","VLogout","onLogout","tonvaTop","logo","senders","regex","getSender","VLogin","onLogin","username","pwd","sender","margin","privacyEntry","VChangePassword","orgPassword","newPassword","newPassword1","VStart","checkAccount","accountLable","pageCaption","marginLeft","marginRight","VRegisterStart","VForgetStart","VVerify","onVerifyChanged","onVerify","typeText","extra","VPassword","onButtonSubmit","rePwd","onPasswordSubmit","submitCaption","VRegisterPassword","VForgetPassword","VSuccess","VRegisterSuccess","VForgetSuccess","CRegBase","retUser","userLogined","openVPage","checkVerify","toPassword","isExists","accountError","sendVerify","toVerify","CRegister","country","mobile","mobileCountry","register","toSuccess","regReturn","registerReturn","CForget","resetPassword","cRegister","cForget","vPage","getVChangePassword","changePassword","StringItemEdit","inputOptions","RadioItemEdit","SelectItemEdit","IdItemEdit","TagItemEdit","renderInputs","TagSingleItemEdit","TagMultiItemEdit","TextAreaItemEdit","CheckBoxItemEdit","RangeItemEdit","NumberItemEdit","Edit","defaultSepClassName","defaultRowContainerClassName","topBorder","bottomBorder","rowContainerClassName","rowClick","itemEdit","editInRow","onItemClick","stopEdit","topBorderClassName","bottomBorderClassName","sepClassName","ie","createItemEdit","divLabel","requireFlag","centerApi","userName","VUnsupportedUnit","VUnitSelect","renderRow","onRowClick","appUnit","setAppUnit","appUnits","VErrorsPage","VStartError","CAppBase","config","appConfig","noUnit","roleDefines","nRole","roles","roleDefs","onNavRoutes","userAppUnits","showUnsupport","appUnitId","resolveRoute","userFromId","CApp","htmlTitle","html","html0","cApp","CBase","_cApp","hasRole","wn","getWebNav","CSub","_owner","ownerWNs","own","ListBase","pageItems","Clickable","Static","Selectable","inputItems","buildItems","itemsArray","isItemSelected","selectedItems","compare","retItems","labelId","comp","selectItem","si","obItem","onSelect","flex","marginBottom","htmlFor","listenArraySplice","isObservableArray","observe","change","removedCount","added","_added","checkAll","anySelected","List","listBase","buildBase","prevProps","prevState","isEqual","forceUpdate","selectAll","unselectAll","waitingMore","tabIndex","isLoading","staticRow","PropRow","PropBorder","borderTop","PropGap","valueAlignStart","valueAlignCenter","valueAlignEnd","LabeledPropRow","gridProps","_prop","col","labelFixLeft","bk","renderLabel","renderProp","align","vAlign","alignValue","renderPropBody","renderPropContent","StringPropRow","NumberPropRow","ListPropRow","borderBottom","ComponentPropRow","PropView","isGap","setValues","PropGrid","propView","IdCache","tuidLocal","localArr","waitingIds","tuidInner","divName","initLocalArr","isNumber","has","moveToHead","_id","useId","tuidValues","cacheIdValues","unpackTuidIds","cacheValue","cacheTuidFieldValues","loadTuidIdsOrLocal","localedValues","netIds","loadTuidIds","netRet","IdDivCache","Tuid","noCache","typeName","idName","unique","TuidBox","id1","id2","idValue","divs","cacheFields","idCache","tuidDiv","TuidDiv","resetCache","assureObj","IdsCaller","GetCaller","cacheFieldsInValue","arrValues","$create","$update","stampOnMain","unpackTuidIdsOfFields","SavePropCaller","searchArr","SearchCaller","LoadArrCaller","SaveArrCaller","order","ArrPosCaller","TuidNoCaller","TuidCaller","$id","transParams","arrParams","arrValue","buildDateParam","bid","$order","loadMain","save","saveProp","search","loadArr","saveArr","posArr","hasDiv","TuidBoxDiv","mainApi","toUser","fromUnit","fromApp","fellow","isOwner","isAdmin","dev","deleted","apps","member","assigned","devApi","uqsText","service","CacheUnits","CacheUqs","CacheApps","CacheBuses","bus","CacheUsers","CacheServers","server","buses","servers","users","ObjItems","store","_load","cur","_save","_inc","_del","_dec","Apps","saveApp","delApp","counts","searchUq","searchPageSize","searchedUqs","Uqs","saveUq","delUq","Buses","saveBus","delBus","checkBusFace","checkBusQuery","busTypes","refNameOk","faceName","refArrayOk","checkBusQueryParam","Servers","saveServer","delServer","Services","services","saveService","delService","changeServiceProp","loadUqServices","SearchItems","Dev","searchApp","searchServer","uqServer","memberCount","roleApps","roleMember","roleMembers","memberRoles","unitChangeProp","unitApps","unitMemberCount","uqBuilderUrl","appId","unitDeleteApp","inUnit","unitAddApp","unitRoles","unitAddRole","unitRoleChangeProp","unitRoleApps","unitRoleSetApps","unitMembers","unitAssignMember","unitMemberRoles","rId","unitSetMemberRoles","org","CUqBase","IdDates","date_init","date_update","span","isLink","UnitSpan","disc","UnitName","UnitInfo","appIcon","REACT_APP_ICON","UqSpan","REACT_APP_ITEM_ICON","api","UqInfo","AppInfo","apis","AppRow","BusSpan","BusInfo","ServerSpan","ip","ServerInfo","StringValueEdit","errorDiv","info","IdPickPage","itemClick","idFromItem","candidateItems","searchPlaceHolder","createIdPick","Info","renderUqRow","uqAccess","act","appActed","newInUnit","restoreUnitApp","stopUnitApp","newApp","addUnitApp","uqAccesses","faName","PageApps","NewApp","appClick","renderApp","AppsPage","loadApps","ban","newItem","itemRender","appList","listRowClick","showNewApp","appRow","spanCaption","ServerCaption","cloud","EditBasePage","moreCandidates","pickServerId","renderServerInput","itemId","EditPage","NewPage","SearchUqPage","onUq","AppPage","editItem","deleteItem","deleteApp","menuItems","btnAddUq","uqClick","isMain","UqBindPage","saveUqBind","removeUqBind","setMainUQ","saveSetUqMain","btnLeft","btnRight","isBinded","AppController","uqMainId","uqMain","service_count","mainIdex","appSetUqMain","setUqMain","getMyUqs","appBindUq","groupStart","groupEnd","Section","rowId","ReactDOMServer","renderToStaticMarkup","StringSection","GroupSection","collaps","setCollaps","titleIcon","cId","whiteSpace","elId","elIcon","firstElementChild","fa","createRange","selectNode","createContextualFragment","parentNode","insertBefore","nextSibling","removeChild","EndSection","ErrorSection","Fragment","ResultSections","containerElement","stop","sectionId","addToGroup","addText","appendChild","section","sections","renderHtml","addHtml","afterMount","mayStart","sec","addSection","CompileResultPage","resultSections","timeHandler","autoScrollEnd","autoScroll","doubleClick","pane","getParent","topIntoView","bottomIntoView","lastScrollTop","pauseAutoScrollToBottom","startAutoScrollToBottom","startTime","total","renderText","parentElement","uintArray","encodedString","fromCharCode","read","done","compile_time","deploy_time","buf","uintToString","byteLength","actionName","abortController","abort","getReader","pump","endAutoScrollToBottom","finish","onDoubleClick","fontWeight","UqUpload","upFiles","fileClick","fr","readAsText","onUpload","lastModifiedDate","trunc","sz","AbortController","signal","fileList","fileRender","encType","click","compiled","fast","thoroughly","description","deploy","UqDeploy","onCompile","compile","onCompileThoroughly","isThoroughly","UqPage","idPickServerProps","serverRow","testServerRow","dbRow","NewServicePage","tonvaForm","uqId","ServicePage","onDbChanged","orgValue","changeProp","onServerPick","pickServer","onServerTestPick","serverTest","onDeleteClick","UQPage","deleteUq","adminDev","btnAddService","onServiceClick","onUqUpload","onUqTest","onUqDeploy","onUqDevsAdmin","serviceClick","angle","cnIcon","showNewServicePage","devList","uqDevs","renderService","ListPage","batchCompile","batchCompilePage","uqList","listRow","listCompileRow","testThoroughly","deployThoroughly","cnBtn","bar","selectItems","VUqDevsAdmin","admin","devChanged","admins","devs","listHeader","loadAdmins","CPickServer","PageServerItems","VPickServer","renderServer","clickServer","onClickNullServer","searchBox","Admins","unitAdmins","owners","ua","unitAdmin","removeOneUnitAdmin","fellowId","unitSetAdmin","removeUnitAdmin","unitAddAdmin","unitDelAdmin","CUq","loadUqEntities","cPickServer","newC","uqGetEntities","r0","devUser","adminDevAdd","adminDevDel","svc","mine","SchemaView","busesProps","repeated","canEdit","serversProps","ObjView","New","saveCur","stepHeader","del","extraMenuActions","defaultIconClass","rArrow","VUnit","appsAction","newUsersAction","cUsers","adminsAction","cAdmins","noneAction","backgroundColor","mid","iconClassName","P","objProps","showAppXAccount","onClickUnitProps","vice","appRender","developersAction","onShowDevelopers","appAction","startApp","uqAction","startUq","busAction","serverAction","appItemRender","UnitProps","isRoot","readMe","divReadMe","VHome","onClickUnit","onShowUnit","selectUnitPage","accUnits","devUnits","bothUnits","renderUnitAdmin","noUnitPage","isProduction","VApp","appXAccount","showDetail","showUserList","calcUserColl","renderAdmins","renderRoles","renderUsers","showAdmins","showRoles","roleUserCount","roleUsers","showUsers","VDetail","onTurnOnOff","appTurnOnOff","VUser","roleBins","uqRoles","showEditUserPage","divRoles","box","VAddUser","roleNum","showAddUserPage","VAdmins","renderVm","VRoleUsers","renderRole","VNoRoleUsers","VAddUserPage","addUser","roleCaption","getRoleCaption","VUserList","UserSpan","UserInfo","VEditUserPage","isChecked","isMeAdmin","onAdminChanged","setAppAdmin","onRoleChanged","setAppRole","onDelUer","delUser","btnDel","onAdminChange","onRoleChange","CAppXAccount","isUser","isRole","mask","rus","setAppRoles","unitOnly","loadAppAdmins","unitAppAdmins","uq_main","insertUser","userRoles","roleBit","renewUser","VDevelopers","renderUserUqsBuses","userUqsBuses","adminDevs","getUserUqsBuses","userObj","onClickUserUqsBuses","showUserUqsBuses","onAddUser","showAddDeveloper","VUqsBuses","renderUq","onChangeUq","showUserUqs","renderBus","onChangeBus","showUserBuses","onDelDev","delDev","btnUqAdd","uqHeader","btnBusAdd","busHeader","VUqs","onCheckChanged","changeUserDev","renderUqItem","onClickUq","uqItems","VBuses","renderBusItem","onClickBusItem","userBuses","VAddDeveloper","onSubmitClick","addDev","CDevelopers","AdminDevs","VEditAdmin","setAdmin","Fellow","VAddAdmin","addAdmin","onNewFellow","onItemSelect","disableDel","onSelectAll","onClearAll","onDel","delAdmins","onAddAdmin","adminsView","CAdmins","VApps","appUsers","appUsersList","onAppsClick","VUsers","userApps","userAppsList","searchUser","onUsersClick","curApp","curAppUsers","onAppEditUsers","curUser","curUserApps","onUserEditApps","VAppEditUsers","appEditUsers","renderUserItem","editUser","onUserChanged","bindAppUser","VUserEditApps","userEditApps","editApp","onAppChanged","bindUserApp","onSearchFocus","divUser","userFromKey","addedPage","onAddApps","onContinueAddUser","CUsers","onAppUsers","loadAppUsers","onUserApps","loadUserApps","unitOneAppUsers","unitOneUserApps","unitAppEditUsers","unitUserEditApps","unitAddUser","unitAppUsers","unitUsers","CHome","loadUnit","loadCounts","cAppXAccount","userUnitAdmins","loadAdminUnits","cHome","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode"],"mappings":"uHAAA,uiH,oCCAA,4vG,grBCsBaA,EAAW,IAnBxB,wSAGwBC,KAAKC,IAAI,GAAI,IAHrC,OAGYC,EAHZ,mBAIuBA,EAJvB,OAMiB,WANjB,OAOiB,WAPjB,gFAMkCC,YAAiBD,IANnD,cAQoBE,EAAQD,YAAiBD,EAAIG,OARjD,kBASuBD,GATvB,mLAauBE,GAbvB,uFAcwBN,KAAKC,IAAIK,GAdjC,cAcYJ,EAdZ,yBAeeA,GAAOA,EAAIK,MAf1B,4GAA8BC,KAmBN,CAAa,iBAAaC,GCtB5BC,EAAtB,WAEI,WAAYC,EAAWC,GAAmB,yBADvBC,aACsB,OAMzCC,OAAkB,OANuB,KASzCF,aATyC,EACrCZ,KAAKa,QAAUF,EACfX,KAAKY,QAAUA,EAJvB,0DAOuB,OAAOZ,KAAKW,SAPnC,6BAMgC,OAAOX,KAAKa,UAN5C,wC,kICsCIE,E,iKClCSC,EAAW,SAChBC,EAAeZ,GACfa,YAAeD,EAAQZ,GACvBc,IAAUD,eAAeb,I,QCEZe,E,4MACTC,M,sBAAQ,sCAAAC,EAAA,6DACZ,EAAKC,MAAMC,aADC,EAEqC,EAAKD,MAA/CE,EAFK,EAELA,QAASC,EAFJ,EAEIA,IAAKC,EAFT,EAESA,QAASC,EAFlB,EAEkBA,QAASC,EAF3B,EAE2BA,OAF3B,SAGNC,YAAWL,EAASC,EAAKC,EAASC,EAASC,GAHrC,2C,EAKRE,M,sBAAQ,sBAAAT,EAAA,sDACZ,EAAKC,MAAMC,aADC,2C,uDAGN,IAEFQ,EAFC,EACchC,KAAKuB,MAAnBU,EADA,EACAA,MAAOP,EADP,EACOA,IAEZ,GAAqB,kBAAVO,EAAoB,CAC3B,IAAIC,EAAM,GACV,IAAK,IAAIC,KAAKF,EACVC,EAAIE,KAAK,+BAAY,gCAAQD,IAAU,qBAAKE,MAAO,CAACC,SAAS,cAAtB,SAAsCL,EAAME,OAAjEA,IAEtBH,EAAa,6BAAKE,SAGlBF,EAAa,8BAAMC,IAEvB,OAAO,8BACH,kCACR,uBAAMM,UAAU,WAAhB,UACC,uEACA,uEACA,sBAAKF,MAAO,CAACC,SAAS,cAAtB,kBAA2CZ,KAC1CM,EACD,sBAAKO,UAAU,MAAf,UACC,wBAAQC,KAAK,SAASC,QAASzC,KAAKqB,MAApC,6BACA,wBAAQmB,KAAK,SAASC,QAASzC,KAAK+B,MAApC,wC,GA/BsCW,aAuC/BC,EAAmB,SAAC,GAA4C,IAA3CC,EAA0C,EAA1CA,QAC9B,OAAO,cAAC,IAAD,CAAMC,OAAO,2BAAb,SACH,qBAAKN,UAAU,OAAf,SAAuBK,O,qFCrClBE,EAAb,kDAEI,WAAYvB,GAAc,IAAD,uBAC3B,cAAMA,IAFIwB,kBACiB,IAiBjBC,OAAS,WACbC,cAAc,EAAKF,cACnBG,EAAIF,UAnBiB,IAEtBG,EAAW5B,EAAX4B,QACL,YAAc1C,IAAV0C,EAAqB,gBACnB,EAAKC,MAAQ,CAACD,WAChBA,GAAW,EAAG,gBACZ,EAAKJ,aAAeM,aAAY,WAAO,IACvCF,EAAW,EAAKC,MAAhBD,UACIA,GACe,EACX,EAAKH,SAGL,EAAKM,SAAS,CAACH,QAASA,MAE7B,KAfkB,IAF7B,qDAuBc,IAERI,EAAcC,EASZ,OAVUxD,KAAKoD,MAAhBD,QAES,GACbI,EAAQ,oCACRC,EAAMxD,KAAKoD,MAAMD,QAAU,2DAG3BI,EAAQ,uCACRC,EAAM,0DAEM,cAAC,IAAD,CAAMX,QAAQ,EAAd,SACH,sBAAKN,UAAU,kBAAf,UACI,sBAAKA,UAAU,iBAAf,UACX,sBAAMA,UAAU,cAAhB,SAA+BgB,IAC/B,uBACCC,EACc,uBACA,sBAAMjB,UAAU,mBAAhB,SAAoCvC,KAAKuB,MAAMqB,aAEnD,wBAAQL,UAAU,iBAAiBE,QAASzC,KAAKgD,OAAjD,+CA3ChB,GAAgCN,aAoDnBe,EAAoB,SAAClC,GAC9B,OAAO,cAAC,IAAD,CAAMsB,OAAO,2BAAOa,KAAK,QAAzB,SACH,sBAAKnB,UAAU,8CAAf,UACI,qBAAKA,UAAU,wBAAf,gLAGA,qBAAKA,UAAU,mBAAf,SACI,wBAAQA,UAAU,sBAAsBE,QAAS,kBAAIlB,EAAMoC,SAAQ,IAAnE,8C,QH1CVC,EAJQ,IAAIC,OAAO,gFAGrB,KACmBC,KAAKC,UAAUC,WAShCC,EAAgB,GAQlBC,EAAW,EAcFC,EAAb,kDAKI,WAAY5C,GAAc,IAAD,8BACrB,cAAMA,IALF6C,WAIiB,IAHjBC,UAAoB,EAGH,EAFjBC,qBAEiB,IAmFjBC,UAAY,WAChBrB,EAAIsB,SApFiB,EA+OjBC,eAAwB,EA/OP,EAgPzBC,QAAU,WAEN,IAAIC,EAAOC,KAAKC,MAChB,EAAKJ,eAAgB,EACrB,EAAKf,MAAK,GACV,EAAKe,eAAgB,EACrBK,QAAQC,IAAR,kBAAuBH,KAAKC,MAAMF,EAAlC,8CAA4E,EAAKP,MAAMY,UAtPlE,EAyPzBtB,KAzPyB,sBAyPlB,8CAAApC,EAAA,yDAAOqC,IAAP,iCACCS,EAAQ,EAAKA,MAEL,KADRa,EAAMb,EAAMY,QAFb,oDAIS,IAARC,EAJD,uBAKKC,OAAOC,OAASD,OAAOE,KACvBF,OAAOE,IAAIC,YAAY,CAAC7C,KAAK,WAAY,KAN9C,6BAUC4C,EAAMhB,EAAMa,EAAI,IACN,IAAVtB,IAAkByB,EAAIE,aAXvB,kCAYWF,EAAIE,eAZf,wBAYgC,IAZhC,sBAYsC,EAAKC,MAZ3C,gCAeC,EAAKA,MAfN,4CAzPkB,EA+QzB/D,WAAa,WACT,EAAK8B,SAAS,CAACkC,gBAAY/E,KA9Q3B,EAAK2D,MAAQ,GACb,EAAKhB,MAAQ,CACTgB,MAAO,EAAKA,MACZqB,KAAM,EACND,gBAAY/E,GAEhByC,EAAIwC,IAAJ,gBARqB,EAL7B,iLAiBER,OAAOS,iBAAiB,WAAY3F,KAAK0E,SAjB3C,SAmBQxB,EAAI0C,OAnBZ,uBAqBc1C,EAAIsB,QArBlB,wIA4BiB,IAAD,OACe,IAAnBxE,KAAKqE,YACLrE,KAAKsD,SAAS,CAACmC,KAAM,IACrBzF,KAAKsE,gBAAkBuB,IAAIC,WACvB,qBACA,WACI,EAAKxB,qBAAkB7D,EACvB,EAAK6C,SAAS,CAACmC,KAAM,MAEzB,QAENzF,KAAKqE,UACPrE,KAAKsD,SAAS,CACVkC,gBAAY/E,MAzCxB,gCA6Ce,IAAD,OACNoF,IAAIC,gBACArF,GACA,aAKE,EAAK4D,UACgB,IAAnB,EAAKA,iBACwB5D,IAAzB,EAAK6D,kBACLuB,IAAIE,aAAa,EAAKzB,iBACtB,EAAKA,qBAAkB7D,GAE3B,EAAK6C,SAAS,CAACmC,KAAM,OAE3B,OA7DV,uEAgEkBD,GAhElB,+EAmEoB/E,KADRyB,EAAMsD,EAAWvD,OAlE7B,qBAoEqC,IAArBC,EAAI8D,aApEpB,gCAqEU9C,EAAI+C,eAAUxF,GArExB,6CAyEoByB,EAAIM,KAzExB,OA0EqB,iBA1ErB,OA8EqB,qBA9ErB,yCA2E0BU,EAAI+C,eAAUxF,GA3ExC,iDA+EoByC,EAAId,KAAK,cAAC,EAAD,CAAkBQ,QAAQ,0FA/EvD,2BAmFQ5C,KAAKsD,SAAS,CACVkC,WAAYA,IApFxB,qLA4FwBU,EAAWC,GA5FnC,iEA6FQnG,KAAKoG,KAAK,cAAC,IAAD,CAAMvD,QAAQ,EAAd,SACN,wGACkB,uBACd,wBAAON,UAAU,aAAjB,UAA+B2D,EAA/B,QAAwCC,KACxC,wBAAQ5D,UAAU,kBAAkBE,QAASzC,KAAKuE,UAAlD,gCAjGhB,oIAsGS8B,EAAmBC,GAEpB,OADAtG,KAAKuG,QACEvG,KAAKoC,KAAKiE,EAAMC,KAxG/B,2BA2GSD,EAAmBC,GACpBtG,KAAKwG,eACDxG,KAAKoE,MAAMY,OAAS,GACpBE,OAAOuB,QAAQC,UAAU,UAAW,KAAM,MAE9C,IAAIC,EAAMzC,IASV,OARAlE,KAAKoE,MAAMhC,KAAK,CACZuE,IAAKA,EACLN,KAAMA,EACNO,QAAQ,EACRN,SAAUA,IAEdtG,KAAK6G,UAEEF,IAzHf,8BA4HYN,EAAmBC,GACvB,IAAIQ,OAAiBrG,EACjB2D,EAAQpE,KAAKoE,MACbA,EAAMY,OAAS,IACf8B,EAAO1C,EAAMmB,OAGjB,IAAIoB,EAAMzC,IAUV,OATAlE,KAAKoE,MAAMhC,KAAK,CACZuE,IAAKA,EACLN,KAAMA,EACNO,QAAQ,EACRN,SAAUA,SAED7F,IAATqG,GAAoB9G,KAAK+G,QAAQD,EAAKR,UAC1CtG,KAAK6G,UAEEF,IA7If,iCAkJQ,IAFwB,IAAnBK,EAAkB,uDAAH,EAChBC,EAAIjH,KAAKoE,MAAMY,OAAS,EACnB7C,EAAE,EAAGA,EAAE6E,KACRC,EAAI,GADW9E,IAAK8E,IAAK,CAE7B,IAAIH,EAAO9G,KAAKoE,MAAM6C,GACtBH,EAAKF,QAAS,KArJ1B,4BAyJ2B,IAAnBI,EAAkB,uDAAH,EACX5C,EAAQpE,KAAKoE,MACba,EAAMb,EAAMY,OAEhB,KAAIgC,GAAS,GAAK/B,GAAO,GAAzB,CACIA,EAAM+B,IAAOA,EAAQ/B,GAEzB,IADA,IAAIiC,EAAY,EACP/E,EAAI,EAAGA,EAAI6E,GACK,IAAjB5C,EAAMY,OADa7C,IAGvBnC,KAAKmH,kBACHD,EAEFA,GAAajC,GAAKiC,IACtBlH,KAAK6G,UACD7G,KAAKyE,iBAxKjB,4BAgLUkC,GACF,QAAYlG,IAARkG,QACwClG,IAAxCT,KAAKoE,MAAMgD,MAAK,SAAAC,GAAC,OAAIA,EAAEV,MAAQA,KACnC,KAAO3G,KAAKoE,MAAMY,OAAQ,GAAG,CACzB,IAAIC,EAAMjF,KAAKoE,MAAMY,OAErB,GADUhF,KAAKoE,MAAMa,EAAI,GACjB0B,MAAQA,EAAK,MACrB3G,KAAKuF,SAvLjB,+BA4LQ,IAAIN,EAAMjF,KAAKoE,MAAMY,OACrB,GAAY,IAARC,EACJ,OAAOjF,KAAKoE,MAAMa,EAAI,GAAG0B,MA9LjC,qCAkMQ,OAAS,CACL,IAAIM,EAAEjH,KAAKoE,MAAMY,OAAO,EACxB,GAAIiC,EAAI,EAAG,MAEX,IAAmB,IADTjH,KAAKoE,MAAM6C,GACbL,OAAkB,MAC1B,IACKN,EADMtG,KAAKoE,MAAMmB,MACjBe,SACLtG,KAAK+G,QAAQT,GAEjBtG,KAAK6G,YA3Mb,sCA+MQ7G,KAAKwG,eACL,IAAIM,EAAO9G,KAAKoE,MAAMmB,MAC5B,QAAa9E,IAATqG,EAAJ,CAH0B,IAOfR,EAAYQ,EAAZR,SAGL,OAFAtG,KAAK+G,QAAQT,GACbtG,KAAKwG,eACEM,KAxNf,8BA2NoBR,QACK7F,IAAb6F,SAES7F,IADFT,KAAKoE,MAAMgD,MAAK,SAAAC,GAAC,OAAIA,EAAEf,WAAaA,MACvBA,OA9NhC,8BAmOQ,IADUtG,KAAKoE,MAAMY,OACdhF,KAAKoE,MAAMY,OAAS,GAAGhF,KAAKmH,kBAnO3C,sCA4OoB7B,GACZ,IAAIlB,EAAQpE,KAAKoE,MACba,EAAMb,EAAMY,OACJ,IAARC,IACMb,EAAMa,EAAI,GAChBK,aAAeA,KAjP3B,iCAiRe1C,GACP,OAAOsC,OAAOvB,QAAQf,KAlR9B,+BAuRc,IAAD,EACsB5C,KAAKoD,MAAzBqC,EADF,EACEA,KAAMD,EADR,EACQA,WACRpB,EAASpE,KAAKoD,MAAdgB,MACDgB,EAAMhB,EAAMY,OAAS,EACrBsC,EAAS,KAAMC,EAAU,KAC7B,OAAQ9B,GACJ,KAAK,EACD6B,EAAS,qBAAK/E,UAAU,qBAExB,MACJ,KAAK,EACD+E,EAAS,qBAAK/E,UAAU,mBAAf,SACL,cAAC,IAAD,MAIRiD,IACA+B,EAAU,cAAC,EAAD,aAAgB/F,WAAYxB,KAAKwB,YAAgBgE,KAC/D,IAAI1B,GAAqB,IAAdZ,EAAIsE,SACpB,sBAAMjF,UAAU,gCAAgCF,MAAO,CAAC+C,IAAI,EAAEqC,KAAK,SAASC,OAAO,OAAnF,SACa,cAAC,IAAD,CAAInF,UAAU,eAAeoF,KAAK,kBAE1C,OAAO,qCACXvD,EAAMwD,KAAI,SAACd,EAAMe,GAAW,IACvBlB,EAAaG,EAAbH,IAAKN,EAAQS,EAART,KACV,OAAO,qBAAehE,MAAOwF,EAAMzC,EAAK,CAAC0C,WAAY,SAAUC,SAAU,iBAAYtH,EAA9E,SACL4F,GADeM,MAIjBW,EACAC,EACAzD,OAtTJ,gCA2TQ9D,KAAKsD,SAAS,CAACc,MAAOpE,KAAKoE,UA3TnC,4BAyBQ,OAAOpE,KAAKoE,MAAMY,WAzB1B,GAA6BtC,aAk/BhBQ,EAAW,IA7qBxB,aAcI,aAAe,IAAD,gCAbN8E,aAaM,OAXTC,YAWS,OAVNC,MAAmB,IAAIC,IAUjB,KATTC,YASS,OAPjBC,iBAOiB,uCALdb,aAKc,OAJdc,cAIc,OAHdC,aAGc,OAFdC,YAEc,OAoGdC,eApGc,OAqGNC,gBArGM,OAsGNC,KAAO,CAAC,QAAS,UAtGX,KAqHNC,cAAgB,SAACC,EAAuBC,EAAiBC,EAAiBC,EAAgB/G,GAE9F6C,QAAQ7C,MAAM,iBACd6C,QAAQ7C,MAAMA,IAxHJ,KA0HNgH,2BAA6B,SAACC,GAElCpE,QAAQ7C,MAAM,8BACd6C,QAAQ7C,MAAMiH,EAAGC,SA7HP,KA+HNC,cAAgB,SAACF,GACrBpE,QAAQ7C,MAAM,kBAhIJ,KAkINoH,kBAAoB,SAACH,GACzBpE,QAAQC,IAAI,wBAA0BhB,UAAUC,WAChDc,QAAQC,IAAI,sBAAuBmE,EAAGI,EAAGJ,EAAGK,IApIlC,KAsINC,eAAiB,SAACN,GACtBpE,QAAQC,IAAI,iBAvIF,KA0IjB0E,sBA1IiB,OAwPTC,SAxPS,uCAwPU,WAAO/I,GAAP,SAAAW,EAAA,sDAC1B4B,EAAI+C,UAAJ,uCAAc,WAAO0D,GAAP,SAAArI,EAAA,+EAAsB4D,OAAOuB,QAAQ/C,QAArC,2CAAd,uDAA2D,GADjC,2CAxPV,2DA4PTkG,UA5PS,uCA4PW,WAAOjJ,GAAP,SAAAW,EAAA,sDAC3B4B,EAAI2G,WAAJ,sBAAe,sBAAAvI,EAAA,+EAAY4D,OAAOuB,QAAQ/C,QAA3B,4CADY,2CA5PX,2DAgQToG,YAhQS,uCAgQa,WAAOnJ,GAAP,SAAAW,EAAA,sDAC7B4B,EAAI6G,eADyB,2CAhQb,2DAoQTC,UApQS,uCAoQW,WAAOrJ,GAAP,SAAAW,EAAA,sDAC3B4B,EAAI+G,aADuB,2CApQX,2DAqRTC,mBArRS,OAiSTC,eAAwB,EAjSf,KAkSTC,UAA0C,CACjD,SAAUpK,KAAK0J,SACf,UAAW1J,KAAK4J,UAChB,YAAa5J,KAAK8J,YAClB,UAAW9J,KAAKgK,WAtSA,KAsUjBK,UAAmB,EAtUF,KAuUjBC,SAAW,mBAAG/H,UAAU,qBAvUP,KAwUjBgI,UAAY,mBAAGhI,UAAU,gBAxUR,KA+UjBiI,gBA/UiB,OAsbdC,gBAAkB,WACd,IAAIC,EAAU,EAAKC,oBACfD,EACA,EAAKE,YAAYF,GAGjBxH,EAAId,KAAK,cAAC,IAAD,CAAMS,OAAO,2BAAb,SACL,qBAAKN,UAAU,MAAf,uKA7bE,KAkcNqI,YAlcM,uCAkcQ,WAAOC,GAAP,eAAAvJ,EAAA,sDAGpBwJ,EAAU,CAACC,OAAQF,GACjB3H,EAAId,KAAK,cAAC,IAAD,CAAMS,OAAO,2BAAb,SACL,qBAAKN,UAAU,MAAMyI,wBAAyBF,OALhC,2CAlcR,2DA2cTG,YAAcA,IA3cL,KAgdTC,WAhdS,OAsmBdlI,OAtmBc,sBAsmBL,oCAAA1B,EAAA,yDACDV,EAAwB,IAAIuK,SAAc,SAACvJ,EAASC,GACpDiE,WAAWlE,EAAS,UAGpB,kBAAmBmC,WALlB,gCAMuBoH,QAAQC,KAAK,CAACxK,EAASmD,UAAUsH,cAAcC,QANtE,QAMGC,EANH,SAOiBA,EAAaC,aAP9B,OASXtG,OAAOuG,SAASC,SAAS1I,UAErB2I,EAAQzG,OAAeyG,SAEtBC,EAAUD,EAAKC,SAEdA,EAAQ5I,QAAQ4I,EAAQ5I,QAAO,IAG/B6I,EAAUF,EAAKE,UAEdA,EAAQ7I,QAAQ6I,EAAQ7I,QAAO,IApB3B,2CAtmBK,KAioBd8I,SAAW,WACP,EAAK1J,KAAK,cAAC,EAAD,CAAmBuB,QAAS,SAACoI,IACxB,IAAPA,GACA,EAAKC,eAAe,4BAChCC,aAAa1F,SAQD,EAAKhB,WA7oBH,IACL2G,EAAkBC,IAAlBD,KAAME,EAAYD,IAAZC,SACXpM,KAAKsI,SAAW4D,EAChBlM,KAAKuI,QAAU6D,EACrBpM,KAAKwH,SAAU,EAlBjB,gDA6BQQ,GAEAhI,KAAKgI,QAAUA,IA/BvB,yEA6CoBxE,GA7CpB,iFA+Cc6I,IAAWC,SAAS9I,GA/ClC,2QAoDO+I,EAAevM,KAAKuM,eApD3B,SAqDuBC,MAAMD,EAAc,IArD3C,cAqDOE,EArDP,gBAsDmBA,EAAQC,OAtD3B,cAsDOC,EAtDP,yBAuDUA,EAAIpM,MAvDd,yCA0DGP,KAAKkI,MAAM3H,KAAKqM,SA1DnB,0SAgEMC,EAAKpB,SAASqB,eAAe,SAhEnC,yCAkEUD,EAAGE,WAlEb,UAoEEF,EAAKpB,SAASqB,eAAe,aApE/B,gCAsEgB9M,KAAKgN,eAtErB,+DAyEgBN,EAAOG,EAAGI,UACVN,EAAMO,KAAKC,MAAMT,GA1EjC,kBA2EmBC,EAAIpM,MA3EvB,mDA8EgBP,KAAKgN,eA9ErB,kUAoFwBvM,KADZ2M,EAAUC,sLAAYC,gBAnFlC,yCAqFmBC,OAAOH,IArF1B,eAyFqB3M,KADTF,EAAOP,KAAKkI,MAAM3H,KAAKN,OAxFnC,qBA0FsC,IAAtB4F,IAAI2H,cA1FpB,yCA0FmDjN,EAAKkN,IA1FxD,uBA2F6BzN,KAAK0N,wBA3FlC,eA4F6BjN,KADjBH,EA3FZ,8DA6FgBC,EAAKoH,OAASrH,EA7F9B,0CA6F+CC,EAAKkN,IA7FpD,iDAgG6BzN,KAAK0N,wBAhGlC,gBAiG6BjN,KADjBH,EAhGZ,4EAmG2BP,IAAS4N,aAAarN,GAnGjD,oBAoGuBG,KADXmN,EAnGZ,SAqGY5N,KAAKkI,MAAM3H,KAAKmF,IAAI,CAAC+H,GAAIG,EAAQjG,KAAMrH,IArGnD,kBAuGesN,GAvGf,yIA0GgBC,GACR7N,KAAKqI,YAAcwF,IA3G3B,qCAqHmC,IAAD,EACDpC,SAASC,SAA7BoC,EADqB,EACrBA,OAAQC,EADa,EACbA,SACnBA,EAAWA,EAASC,cAFY,oBAGThO,KAAK2I,MAHI,IAG1B,2BAA4B,CAAC,IAApB7B,EAAmB,QACxB,IAAgC,IAA5BiH,EAASE,SAASnH,GAAgB,CAClCiH,EAAWA,EAASG,OAAO,EAAGH,EAAS/I,OAAS8B,EAAK9B,QACrD,QANkB,8BAY1B,OAH+B,IAA3B+I,EAASE,SAAS,OAA6C,IAA5BF,EAASE,SAAS,QACrDF,EAAWA,EAASG,OAAO,EAAGH,EAAS/I,OAAO,IAE3C8I,EAASC,EAAW,eAjInC,oKA2JE/N,KAAKwH,QAAU3B,IAAI2B,SACW,IAA1BxH,KAAKyJ,mBACR5D,IAAI2H,eAAgB,GA7JvB,SA+JQW,IAAK3J,MAAMxE,KAAKwH,SA/JxB,eAiKe/G,KADT2N,EAAO3C,SAASC,SAAS0C,OACHA,EAAKpJ,OAAS,KACnCqJ,EAAMC,eACA,IAAGD,OAAM5N,GACnBT,KAAKyI,UAAY2F,EAAKG,UAAU,EAAGF,IAE/B3M,EAAoByM,IAApBzM,IAAK8M,EAAeL,IAAfK,GAAIC,EAAWN,IAAXM,QACdzO,KAAK0I,WAAahH,EAClB1B,KAAKwI,OAASkG,YAAgBD,GAC9BzO,KAAKiI,OAASuG,EACdG,YAAajN,QAGCjB,KADVL,EAAcJ,KAAKkI,MAAM9H,MAAMH,OA5KrC,kCA8KiBF,IAASK,QA9K1B,QA8KGA,EA9KH,kBAgLOA,EAhLP,uBAkLSwO,MAAM,8BAlLf,WAoLE1L,EAAI2L,SAASzO,GAET0O,EAASC,cACTC,EAAaC,YAAcH,QAChBrO,IAAXqO,GAAwB5J,SAAWA,OAAOgK,OAxLhD,yBA0LsBzO,IAAfuO,EA1LP,wBA4LIlK,QAAQC,IAAI,mCAERG,OAAOC,OAASD,OAAOgK,QAC1BhK,OAAOgK,OAAO7J,YAAY,CAAC7C,KAAK,oBAAqB4L,KAAMY,EAAWZ,MAAO,KA/LlF,4CAuM6BpO,KAAKmP,qBAvMlC,QAuMMC,EAvMN,OAwMEJ,EAAWI,eAAiBA,EAxM9B,mQA6MGlK,OAAOmK,QAAUrP,KAAK4I,cACb1D,OAAOoK,qBAAuBtP,KAAKiJ,4BAKlB,IAAbrF,IACA6H,SAAS8D,cAAgB,WAAY,OAAO,GAC5C9D,SAAS+D,cAAgB,WAAY,OAAO,IAGzDtM,EAAIqD,QAEJvG,KAAKyP,iBAGiBhP,KADTkJ,EAAa3J,KAAKkI,MAAMyB,KAAK1J,OA5N7C,yBA+NmCQ,KADdiP,EAAc1P,KAAKgI,QAAQzG,MAA3BmO,YA9NrB,kCAgO0BA,IAhO1B,iDAmO0BxM,EAAI+C,eAAUxF,GAnOxC,2DAyOkByC,EAAIyM,QAAQhG,GAzO9B,0DA4OG7E,QAAQ7C,MAAR,MA5OH,yBAgPYjC,KAAK4P,UAhPjB,6KAsPsBnP,IAAhBT,KAAKoI,QACTpI,KAAKoI,OAAOxG,YAvPd,2BAmQE,YAJoBnB,IAAhBT,KAAKoI,SACRpI,KAAKoI,OAAS,IAAIyH,KACI,IAAlB7P,KAAKqK,UAAmBrK,KAAKoI,OAAO0H,uBAAuB,iBAEzD9P,KAAKoI,OAAO2H,GAAZ,2HAnQT,wCAuRE7M,EAAI8M,SAAS,YAvRf,kCA0RatO,GACX,IAAIuO,EAAmBjQ,KAAKoK,UAAU1I,QACtBjB,IAAZwP,EAIJA,OAAQxP,GAHPyP,MAAMxO,EAAM,kCA7Rf,uCAoS0BuO,GAAmB,IAAD,OAC1C,OAAO,SAACtP,EAAawP,GAChBF,IACC,EAAK5F,UAAUnH,EAAIqD,QACvB0J,EAAQtP,OAxSZ,iCA4SYsP,GACVjQ,KAAK+P,GAAG/P,KAAKoQ,iBAAiBH,MA7ShC,kCA2Ta/F,IACgB,IAAvBlK,KAAKmK,gBACRnK,KAAKmK,eAAgB,EACrBnK,KAAKqQ,oBAAoBrQ,KAAKoK,YAE/BpK,KAAKqQ,oBAAoBnG,KAhU3B,0CAmU6BA,GAC3B,GAAKA,EAAL,CACAlK,KAAKkK,cAAgBoG,IAAEC,MAAMvQ,KAAKkK,cAAeA,GACjD,IAAIsG,EAAoE,GACxE,IAAK,IAAIC,KAASvG,EAAe,CAChC,IAAI+F,EAAU/F,EAAcuG,GAC5BD,EAAOC,GAASzQ,KAAKoQ,iBAAiBH,GAEvCjQ,KAAK+P,GAAGS,MA3UV,oCAwVExQ,KAAKqK,UAAW,EAChBrK,KAAKsK,SAAW,mBAAG/H,UAAU,qBAC7BvC,KAAKuK,UAAY,mBAAGhI,UAAU,kBA1VhC,+BAiWUb,EAAYgP,GACpB,GAAK1Q,KAAKoI,OAOV,OAHqB,IAAjBpI,KAAKwH,UACR9F,GAAO,SAED1B,KAAKoI,OAAO4H,SAAStO,EAAKgP,GANhCR,MAAM,mDAAqDxO,EAAM,OAnWpE,yBA4WIiP,EAAmBjP,EAAYgP,QACbjQ,IAAhBT,KAAKoI,OACRpI,KAAKgQ,SAAStO,EAAKgP,GAGnBC,MAjXH,2EAqXsBC,GArXtB,+EAuX0BnQ,KADboQ,EAAa7Q,KAAKgI,QAAQzG,MAA1BsP,WAtXb,uBAwXY3N,EAAId,KAAK,iEAxXrB,iCA2XQc,EAAIqD,QA3XZ,SA4XcsK,EAAUD,GA5XxB,sIA+XaxQ,GACLJ,KAAKkI,MAAM9H,MAAMsF,IAAItF,GACrBY,EAAa,EAAGZ,EAAMC,SAjY9B,sCAqYQL,KAAKkI,MAAMyB,KAAKjE,IAAI1F,KAAK2J,QArYjC,+JAyYuBmH,IAAQC,KAzY/B,OAyYYA,EAzYZ,OA0YQ/Q,KAAK2J,KAAKqH,KAAOD,EAAGC,KACpBhR,KAAK2J,KAAKsH,KAAOF,EAAGE,KA3Y5B,qLA8Y+BtH,EAAYuH,EAAsCN,GA9YjF,oEA+YQO,cACArM,QAAQC,IAAI,cAAemI,KAAKkE,UAAUzH,IAC1C3J,KAAK2J,KAAOA,EACZ3J,KAAKqR,gBACXrQ,EAAa2I,EAAK8D,GAAI9D,EAAKtJ,OAC3B6C,EAAIqD,aAEmB9F,IAAbyQ,EAtZZ,iBAuZYA,EAASvH,GAvZrB,4BAyZmC,IAAlB3J,KAAKqK,SAzZtB,iBA0ZGrK,KAAKgQ,SAAS,UA1ZjB,yCA6ZkBhQ,KAAKsR,YAAYV,GA7ZnC,mLAkakBjH,EAAYuH,GAla9B,iFAmaQlR,KAAKuR,gBAAgB5H,EAAMuH,GAAU,GAna7C,oLAuasBvH,EAAYuH,GAvalC,iFAwaQlR,KAAKuR,gBAAgB5H,EAAMuH,GAAU,GAxa7C,wIAgbaM,GACL,OAAQxR,KAAKqI,aAAerI,KAAKqI,YAAYoJ,UAAaD,IAjblE,qCAqbQ,GAAKxR,KAAK2K,oBACV,OAAO,qBAAKpI,UAAU,cAAf,SACH,wBAAQA,UAAU,sBACdE,QAASzC,KAAKyK,gBADlB,SAEI,uBAAOlI,UAAU,aAAjB,4CAzbhB,0CA+bQ,GAAKvC,KAAKqI,YAEV,OADgBrI,KAAKqI,YAAhBqC,UAhcb,qCA0dgBO,GACdjL,KAAKiL,YAAcA,IA3drB,+IAgeMjL,KAAKkL,MAheX,yCAgeyBlL,KAAKkL,OAhe9B,uBAie4BlL,KAAKiL,cAjejC,gCAieSjL,KAAKkL,MAjed,uLAmeiBgG,EAAuCQ,GAnexD,iFAoeoB1R,KAAK2R,WApezB,cAqeQ1L,UAAUiL,EAAUQ,GAre5B,mLAweqBR,GAxerB,iFAyeoBlR,KAAK2R,WAzezB,cA0eQ9H,WAAWqH,GA1enB,sQA8eoBlR,KAAK2R,WA9ezB,cA+eQ5H,eA/eR,mQAmfoB/J,KAAK2R,WAnfzB,cAofQ1H,aApfR,4KAufiBiH,GAvfjB,0EAwfQlC,IAAWzO,UAAOE,EAClBT,KAAKkI,MAAM0J,cACX5R,KAAK2J,UAAOlJ,EACZ0Q,cACI/Q,EAAQJ,KAAKkI,MAAM9H,MAAMH,MAC7BiB,YAAe,EAAGd,GAASA,EAAMC,OAEvCL,KAAKuG,aACkB9F,IAAbyQ,EAhgBZ,kCAigBkBhO,EAAIsB,QAjgBtB,iDAmgBkB0M,IAngBlB,yQAugBoBlR,KAAK2R,WAvgBzB,cAwgBQE,qBAxgBR,wIA8gBiB,IAAD,EACR,UAAA7R,KAAKgI,eAAL,SAAcyH,cA/gBtB,gCAihBe,IAAD,EACN,UAAAzP,KAAKgI,eAAL,SAAc4H,YAlhBtB,uEAohBkB3N,GAphBlB,iFAqhBcjC,KAAKgI,QAAQ8J,QAAQ7P,GArhBnC,oLAuhBwBiE,EAAWC,GAvhBnC,iFAwhBcnG,KAAKgI,QAAQ+J,cAAc7L,EAAIC,GAxhB7C,oIA2hBUE,EAAmBC,GACrBtG,KAAKgI,QAAQ5B,KAAKC,EAAMC,KA5hBhC,2BA8hBSD,EAAmBC,GACpBtG,KAAKgI,QAAQ5F,KAAKiE,EAAMC,KA/hBhC,8BAiiBYD,EAAmBC,GACvBtG,KAAKgI,QAAQgK,QAAQ3L,EAAMC,KAliBnC,4BAoiB2B,IAAnBU,EAAkB,uDAAH,EACfhH,KAAKgI,QAAQzC,IAAIyB,KAriBzB,+BAwiBQ,OAAOhH,KAAKgI,QAAQiK,WAxiB5B,4BA0iBUtL,GACF3G,KAAKgI,QAAQkK,MAAMvL,KA3iB3B,8BA6iBa,IAAD,EACJ,UAAA3G,KAAKgI,eAAL,SAAczB,UA9iBtB,gCAijBQvG,KAAKgI,QAAQtD,YAjjBrB,+BAmjBasC,GACLhH,KAAKgI,QAAQmK,SAASnL,KApjB9B,qCAujBQhH,KAAKgI,QAAQxB,iBAvjBrB,gKAyjBe7C,IAzjBf,0CA0jBc3D,KAAKgI,QAAQtE,KAAKC,GA1jBhC,4IA4jBoB2B,GACZtF,KAAKgI,QAAQoK,gBAAgB9M,KA7jBrC,iCA+jBe1C,GACP,OAAO5C,KAAKgI,QAAQqK,WAAWzP,KAhkBvC,wEAkkBmBlB,EAAakM,EAAgB0E,EAAeC,EAAmBC,GAlkBlF,qGAmkBe,IAAIrH,SAAc,SAACvJ,EAASC,GAC/B,IAAI4Q,GAA0D,IAAlD,EAAK/J,WAAWgK,SAAS,qBAA+B,cAAc,QAC9EC,OAAiBlS,IAAZ+R,EACDI,YAAOlR,EAAKkM,GACZgF,YAAOlR,EAAKkM,EAAQ6E,EAAO,CAACH,EAAOC,EAAWC,IACtD1N,QAAQC,IAAI,eAAgBmI,KAAKkE,UAAUuB,IAC3CzP,EAAId,KAAK,0BAASG,UAAU,gBAAnB,UACL,sBAAMkL,GAAIkF,EAAGvE,KAAM3L,QAAS,kBAAI,EAAKiB,QAArC,SACI,mBAAGnB,UAAU,uBAIb,wBAAQsQ,IAAKF,EAAGjR,IAAK6B,MAAOuP,OAAON,SAG3C,WACI5Q,WAnlBhB,0IAwlBcF,GAENwD,OAAO6N,KAAKrR,KA1lBpB,0BA8lBQ8B,GACAS,EAAK7B,KAAKoB,KA/lBlB,gCAkmBQ,IAAIwP,EAAO,IAAIpO,KACf7D,EAAUiS,EAAKC,UACfhP,EAAK7B,KAAK,aAAe4Q,EAAKE,kBApmBtC,8BAsmBYC,GACJlP,EAAK7B,KAAK+Q,EAAO,OAAQ,IAAIvO,MAAOqO,UAAYlS,MAvmBxD,qCA0mBmByC,GAEjBxD,KAAKoC,KAAK,cAAC,EAAD,CAAYQ,QAASY,EAAKL,SADf,OA3mBvB,wKAkqBaiQ,EAAQ3H,SAASC,SAAjB0H,KACLA,IAASA,EAAKC,QAAQ,MAAM,EAAG,IAAI,KAAO,UAAW,IAAIzO,MAAOqO,UAnqBxE,SAoqBwBzG,MAAM4G,GApqB9B,cAoqBYlT,EApqBZ,gBAqqBsBA,EAAIoT,OArqB1B,cAqqBYC,EArqBZ,OAsqBYC,EAAS,IAAIC,UACbC,EAAUF,EAAOG,gBAAgBJ,EAAG,aACpCK,EAASF,EAAQG,qBAAqB,QACtCC,EAAaF,EAAO,GAAGG,aAAa,gBAzqBhD,kBA0qBeD,GA1qBf,8HAsBQ,IAAI1T,EAAQJ,KAAKkI,MAAM9H,MACvB,QAAcK,IAAVL,EAAqB,OAAO,EAChC,IAAI4T,EAAI5T,EAAMH,MACd,YAAUQ,IAANuT,EAAwB,EACrBA,EAAE5T,QA1BjB,0BA+GQ,OAAOJ,KAAKqI,aAAerI,KAAKqI,YAAY4L,MA/GpD,+BA+VyB,OAAOrQ,IA/VhC,4BA4gBQ,OAAO5D,KAAKgI,QAAQhB,QA5gB5B,2BA6lBgB,OAAO/C,MA7lBvB,uCAQKiQ,KARL,0E,gaI5XsBC,GAAtB,aACI,aAAoC,IAAxBC,EAAuB,uDAAL,IAAK,yBAG3BA,cAH2B,OAI3BC,IAAU,GAJiB,gCAC/BrU,KAAKoU,SAAWA,EAFxB,oDAQYE,GACJ,IADkB,EACdD,EAAe,GADD,cAEHC,GAFG,IAElB,2BAAoB,CAAC,IAAZ7G,EAAW,QAChB,GAAW,OAAPA,EAAJ,CACA,IAAI3G,EAAO9G,KAAKuU,KAAKtU,IAAIwN,QACZhN,IAATqG,IACAuN,EAAIjS,KAAKqL,GACT3G,EAAO,CAAC2G,GAAGA,GACXzN,KAAKuU,KAAK7O,IAAI+H,EAAI3G,MARR,8BAWlB9G,KAAKwU,OAAOH,KAnBpB,0BAsBQ5G,GACA,QAAWhN,IAAPgN,GAA2B,OAAPA,EAAa,OAAO,KAC5C,IAAI3G,EAAO9G,KAAKuU,KAAKtU,IAAIwN,GAMzB,YALahN,IAATqG,IACA9G,KAAKuU,KAAK7O,IAAI+H,EAAI,CAACA,GAAGA,IACtBzN,KAAKwU,OAAO,CAAC/G,IACb3G,EAAO9G,KAAKuU,KAAKtU,IAAIwN,IAElB3G,IA9Bf,8BAgCoB2G,EAAW3G,QACVrG,IAATqG,GACA9G,KAAKuU,KAAK7O,IAAI+H,EAAI,MAClBzN,KAAKqU,IAAIjS,KAAK,CAACqL,GAAIA,MAGnBzN,KAAKuU,KAAK7O,IAAI+H,EAAI3G,GAClB9G,KAAKqU,IAAIjS,KAAK0E,IAEd9G,KAAKqU,IAAIrP,OAAShF,KAAKoU,WACvBtN,EAAO9G,KAAKqU,IAAII,QAChBzU,KAAKuU,KAAKG,OAAO5N,EAAK2G,OA3ClC,sEA8CyB6G,GA9CzB,4GA+C0BtU,KAAK2U,SAASL,GA/CxC,eAgDsB7T,KADVmU,EA/CZ,uCAiD2BN,GAjD3B,4DAkD2B,QADN7G,EAjDrB,kFAmDiCzN,KAAK6U,QAAQpH,GAnD9C,QAmDoB3G,EAnDpB,OAoDgB9G,KAAK8U,QAAQrH,EAAI3G,GApDjC,mFAAAiO,EAAA,gGAwD2BT,GAxD3B,IAwDY,IAxDZ,iBAwDqB7G,EAxDrB,QAyDoB3G,EAAO8N,EAAMxN,MAAK,SAAAC,GAAC,OAAIA,EAAEoG,KAAOA,KACpC,EAAKqH,QAAQrH,EAAI3G,IAFrB,uBAAqB,IAxDjC,WAAAiO,EAAA,iLAMKb,KANL,yEAMuB,IAAIc,OAN3B,G,gBCJa7M,EAAb,iDACIwB,KAAO9D,IAAIoP,QAAQC,MAAM,QAD7B,KAEI9U,MAAQyF,IAAIoP,QAAQC,MAAM,SAF9B,KAGI3U,KAAOsF,IAAIoP,QAAQC,MAAM,QAH7B,KAKYC,WALZ,OAMYC,YANZ,OAOYC,WAPZ,6DASQrV,KAAKmV,MAAQnV,KAAK2J,KAAK1J,MACvBD,KAAKoV,OAASpV,KAAKI,MAAMH,MACzBD,KAAKqV,MAAQrV,KAAKO,KAAKN,QAX/B,2CAcQD,KAAK2J,KAAKjE,IAAI1F,KAAKmV,OACnBnV,KAAKI,MAAMsF,IAAI1F,KAAKoV,QACpBpV,KAAKO,KAAKmF,IAAI1F,KAAKqV,SAhB3B,oCAoBQ,CACIrV,KAAK2J,KACL3J,KAAKO,MACP+U,SAAQ,SAAAC,GAAC,OAAIA,EAAE3I,gBAvBzB,KCFO,SAAS4I,EAAqBC,EAASC,GAC7C,GAAKD,GACAC,EAAL,CACA,IAAIC,EAAOC,OAAOD,KAAKF,GACvBC,EAAOA,EAAK1H,cACZ,cAAgB2H,EAAhB,eAAsB,CAAjB,IAAIhP,EAAG,KACX,GAAIA,EAAIqH,gBAAkB0H,EAAM,OAAOD,EAAI9O,KCLtC,IAAMkP,EAAc,WACdC,EAAa,+C,wPCuBJC,EAAtB,WAeI,WAAYpJ,GAAU,IAAD,gCAdZA,SAcY,OAbfrD,OAae,OAZhB0M,GAAU,GAYM,KAXfC,OAWe,OAVrBjF,UAUqB,OATrBkF,WASqB,OARfC,MAAgBtQ,IAAI2H,cAQL,KAPxBhD,gBAOwB,OA8Cb4L,sBA9Ca,OAiDXrP,QAAU,WAGtBsF,IAAWgK,yBAAyB,EAAKD,kBACnC,EAAKE,aArDY,KAgHbC,iBAhHa,uCAgHM,WAAO3T,GAAP,SAAAtB,EAAA,sEACjB,EAAKkV,UAAU5T,GADE,2CAhHN,2DA8Ib6T,gBA9Ia,OAmNhBC,gBAnNgB,EACjB1W,KAAK2M,IAAMA,GAAO,GACxB3M,KAAKsJ,EAAItJ,KAAK2M,IAAIrD,GAAK,GACvBtJ,KAAKiW,EAAI,SAACU,GAAD,OAAoB,EAAKC,UAAUD,IAAQA,GAlBtD,iDASqB,OAAOzT,MAAIyG,OAThC,gCAU6B,IAChBA,EAAQzG,MAARyG,KACL,YAAalJ,IAATkJ,GACGA,EAAK8D,GAAK,MAbzB,uHAyBEzN,KAAK6W,aACL7W,KAAKwK,WAAaxK,KAAK8W,gBACvB9W,KAAK+W,cA3BP,gCA8BWJ,GACT,OAAO3W,KAAKgW,GAAGW,KA/BjB,kCAoC2B,OAAO3W,KAAKgX,SApCvC,wEAyCUtV,GACRwB,MAAI8M,SAAStO,KA1Cf,6BA6CkBiL,GAChB,QAAYlM,IAARkM,EAAJ,CADyB,IAEpBsK,EAAoB9K,aAApB8K,MAAOC,EAAa/K,aAAb+K,UAEZ,GADA5G,IAAEC,MAAMvQ,KAAKgW,GAAIrJ,QACHlM,IAAVwW,EAAqB,CACxB,IAAIE,EAAIxK,EAAIsK,GACZ,QAAUxW,IAAN0W,EAAiB,CACpB7G,IAAEC,MAAMvQ,KAAKgW,GAAImB,GACjB,IAAI5B,EAAI4B,EAAED,QACAzW,IAAN8U,GACHjF,IAAEC,MAAMvQ,KAAKgW,GAAIT,QAvDtB,gEA4EM9H,GACJ,GAAW,OAAPA,EAAa,OAAO,EADJ,IAGhBxM,EADSjB,KAAR2J,KACa8D,GAClB,cAAeA,GACd,QAAS,OAAO,EAChB,IAAK,SAAU,OAAOF,OAAOE,KAAQxM,EACrC,IAAK,SAAU,OAAOwM,IAAOxM,EAC7B,IAAK,SAAU,OAAOwM,EAAGA,KAAOxM,KApFnC,yEAwFwEmW,EAA4BC,EAAYC,GAxFhH,8EAyFMpX,EAAM,IAAIkX,EAAIpX,MAzFpB,SA0FQE,EAAI6S,KAAKsE,EAAOC,GA1FxB,gCA2FSpX,GA3FT,uLA8F2EkX,EAA4BC,EAAYC,GA9FnH,8EA+FMpX,EAAM,IAAIkX,EAAIpX,MA/FpB,SAgGQE,EAAIqX,YAAYF,EAAOC,GAhG/B,gCAiGSpX,GAjGT,4IAoGkEmG,EAA8BgR,GAE9F,OADQ,IAAIhR,EAAMrG,MACTwX,OAAOH,KAtGlB,qEAyGgB7U,EAAaiV,GAzG7B,iFA0GczX,KAAK0X,QAAQlV,EAAMiV,GA1GjC,gLA6G4BjV,EAAaiV,GA7GzC,wLAgHkBnE,GACVpD,MAAMoD,KAjHd,gCAmHwBzQ,EAAeX,GAC/BlC,KAAK2X,SAAS,cAAC,OAAD,CAAM9U,OAAO,aAAb,SACV,8BACoB,kBAARX,EAAkBA,EAAMA,EAAIU,eAtHpD,gCA2HwBA,MA3HxB,wKAyIe,GAzIf,uXA8IQ5C,KAAKoW,iBAAmB/J,IAAWuL,uBAAuB5X,KAAKuW,oBA9IvE,qEAkJgBc,GAlJhB,8FAoJErX,KAAK4X,yBApJP,SAqJwB5X,KAAK6X,cArJ7B,WAsJoB,IAtJpB,uEAkJ+BlX,EAlJ/B,iCAkJ+BA,EAlJ/B,0BAuJQX,KAAK8X,cAAL,MAAA9X,KAAA,CAAmBqX,GAAnB,OAA6B1W,IAvJrC,wBAwJQX,KAAK+X,aAxJb,4KA8JkBV,GA9JlB,6GA8JiC1W,EA9JjC,iCA8JiCA,EA9JjC,sBA+JgCF,IAApBT,KAAKyW,aAA0BzW,KAAKyW,WAAa,IA/J7D,kBAgKe,IAAItL,QAAJ,uCAAgB,WAAOvJ,EAASC,GAAhB,SAAAP,EAAA,6DACnB,EAAKmV,WAAWrU,KAAKR,GADF,SAEb,EAAK4C,MAAL,QAAI,CAAO6S,GAAP,OAAiB1W,IAFR,2CAAhB,0DAhKf,4KAsKsCyW,EAAmCC,GAtKzE,wFAuKgC5W,IAApBT,KAAKyW,aAA0BzW,KAAKyW,WAAa,IAvK7D,kBAwKe,IAAItL,QAAJ,uCAAkB,WAAOvJ,EAASC,GAAhB,SAAAP,EAAA,6DACrB,EAAKmV,WAAWrU,KAAKR,GADA,SAEd,IAAIwV,EAAG,GAAcrE,KAAKsE,GAFZ,2CAAlB,0DAxKf,0IA8KeI,GACP,QAAwBhX,IAApBT,KAAKyW,WAAT,CACA,IAAI7U,EAAU5B,KAAKyW,WAAWlR,WACd9E,IAAZmB,EAIJA,EAAQ6V,GAHJvH,MAAM,0DAlLlB,+BAwLa8H,EAAkBC,GAC7B,IAAI3R,OACgB7F,IAAhBwX,IACH3R,EAAW,WAEV2R,OAAYxX,KAIRyC,MAAId,KAAK4V,EAAM1R,KAjMvB,kCAqMgB0R,EAAkBC,GAC1B/U,MAAI8O,QAAQgG,EAAMC,KAtM1B,iCA2MQ/U,MAAIQ,SA3MZ,gCA8McsD,GACN9D,MAAIqC,IAAIyB,KA/MhB,gCAkNcA,GACN9D,MAAIiP,SAASnL,KAnNrB,yBAsNI2J,EAAmBjP,EAAYgP,GACjCxN,MAAIgV,GAAGvH,EAAUjP,EAAKgP,KAvNxB,qCA2NQxN,MAAIsD,iBA3NZ,sCA8NoBlB,GACZpC,MAAIkP,gBAAgB9M,KA/N5B,oCAoOEtF,KAAK0W,WAAaxT,MAAI+O,WApOxB,gCAyOctL,GACN3G,KAAK0W,WAAa/P,IA1O1B,qCA6OEzD,MAAIgP,MAAMlS,KAAK0W,cA7OjB,uEAgPkB/U,GAhPlB,qGAiPe,IAAIwJ,QAAJ,uCAAwC,WAAOvJ,EAASC,GAAhB,6BAAAP,EAAA,sDACtC6W,EAA6CxW,EAA7CwW,QAASvV,EAAoCjB,EAApCiB,QAASmJ,EAA2BpK,EAA3BoK,GAAIqM,EAAuBzW,EAAvByW,IAAKC,EAAkB1W,EAAlB0W,GAAIC,EAAc3W,EAAd2W,WAChCvW,EAAQ,SAAC4K,GACT,EAAK4L,YACL3W,EAAQ+K,IAER6L,EAAgB,QACT/X,IAAPsL,GACAyM,EAAQpW,KAAK,wBAAiBG,UAAU,uBAAuBE,QAAS,kBAAIV,EAAM,OAArE,SAA6EgK,GAAjE,YAEjBtL,IAAR2X,GACAI,EAAQpW,KAAK,wBAAkBG,UAAU,uBAAuBE,QAAS,kBAAIV,EAAM,QAAtE,SAA+EqW,GAAnE,aAElB3X,IAAP4X,GACAG,EAAQpW,KAAK,wBAAiBG,UAAU,8BAA8BE,QAAS,kBAAIV,EAAM,OAA5E,SAAoFsW,GAAxE,OAE7B,EAAKV,SAAS,cAAC,OAAD,CAAM9U,OAAQsV,GAAW,qBAAOzU,KAAK,QAArC,SACV,sBAAKnB,UAAW+V,GAAc,kCAA9B,UACI,qBAAK/V,UAAU,mDAAf,SACKK,IAEL,qBAAKL,UAAU,wDAAf,SACKiW,UAIbtV,MAAIkP,gBAAJ,sBAAoB,sBAAA9Q,EAAA,6DAChBM,OAAQnB,GADQ,mBAET,GAFS,4CA1BuB,2CAAxC,0DAjPf,iKAwC0B,OAAOyC,MAAImH,WAxCrC,gCA2J6B,YAA2B5J,IAApBT,KAAKyW,aA3JzC,6BAuOQ,OAAOzW,KAAK0W,eAvOpB,KCnBsB+B,EAAtB,WAMI,WAAYC,GAAgB,yBALlBA,gBAKiB,OAJR/L,SAIQ,OAHXrD,OAGW,OAFX2M,OAEW,EACvBjW,KAAK0Y,WAAaA,EAClB1Y,KAAK2M,IAAM+L,EAAW/L,IAC5B3M,KAAKsJ,EAAIoP,EAAWpP,EACpBtJ,KAAKiW,EAAIyC,EAAWzC,EAVtB,qDAeUvU,GAAa1B,KAAK0Y,WAAW1I,SAAStO,KAfhD,2BAgBgB+L,GAAS,OAAOzN,KAAK0Y,WAAWC,KAAKlL,KAhBrD,+BAmBuBmL,EAAkCvB,GACjD,OAAQ,IAAIuB,EAAG5Y,KAAK0Y,YAAalB,OAAOH,KApBhD,yEAuB8BD,EAAmCC,EAAYC,GAvB7E,iFAwBe,IAAIF,EAAGpX,KAAK0Y,YAAa3F,KAAKsE,EAAOC,GAxBpD,gLA2B0B9U,EAAaiV,GA3BvC,iFA4BczX,KAAK0Y,WAAW7P,MAAMrG,EAAMiV,GA5B1C,kIA+Bc9G,EAAmBjP,EAAYgP,GAC3C1Q,KAAK0Y,WAAWR,GAAGvH,EAAUjP,EAAKgP,KAhCpC,qEAmCsC0G,EAAmCC,GAnCzE,iFAoCqBrX,KAAK0Y,WAAWG,MAAMzB,EAAIC,GApC/C,kLAuCyBI,GACjBzX,KAAK0Y,WAAWI,WAAWrB,KAxCnC,iCA2CsB9N,EAAUoP,EAAwBC,GACtD,IAAIC,EAAa,SAACtP,GAAe,IAC3BhC,EAAoBgC,EAApBhC,KAAMsJ,EAActH,EAAdsH,KAAMD,EAAQrH,EAARqH,KACjB,OAAO,qCACN,cAAC,QAAD,CAAO6B,IAAK7B,EAAMzO,UAAWwW,GAAkB,mBAC/C,sBAAMxW,UAAWyW,EAAjB,SAAiC/H,GAAQtJ,QAG3C,OAAO,cAAC,WAAD,CAAUgC,KAAMA,EAAM6N,OAAQyB,MAnDvC,qCAsD0BtP,GAKxB,OAAO,cAAC,WAAD,CAAUA,KAAMA,EAAM6N,OAJZ,SAAC7N,GAAe,IAC3BhC,EAAcgC,EAAdhC,KAAMsJ,EAAQtH,EAARsH,KACX,OAAO,mCAAGA,GAAQtJ,SAzDrB,+BA8DoBoR,EAAwBC,GAAwB,IAC7DrP,EAAQ3J,KAAK0Y,WAAb/O,KACL,GAAKA,EACL,OAAO3J,KAAKiZ,WAAWtP,EAAK8D,GAAIsL,EAAgBC,KAjElD,+BAoEuB3S,EAAqCgR,EAAYY,GAChE,IAAIzV,SAAc6U,EACL,WAAT7U,GAA8B,cAATA,EACrBxC,KAAK0Y,WAAWf,SAASjV,gBAAoB2D,EAAMgR,GAAQY,GAG3DjY,KAAK0Y,WAAWf,SAAS,eAAC,OAAD,CAAM9U,OAAO,mBAAb,6DAC4BL,KAC5CyV,KA5ErB,kCAgF0B5R,EAAqCgR,GACvDrX,KAAK0Y,WAAWQ,YAAYxW,gBAAoB2D,EAAMgR,MAjF9D,sCAoF8BW,EAAmBC,GACzCjY,KAAK0Y,WAAWf,SAASK,EAAMC,KArFvC,yCAwFiCD,EAAmBC,GAC5CjY,KAAK0Y,WAAWQ,YAAYlB,EAAMC,KAzF1C,iCA6FQjY,KAAK0Y,WAAWS,aA7FxB,gCAgGwBnS,GAChBhH,KAAK0Y,WAAWH,UAAUvR,KAjGlC,gCAoGwBA,GAChBhH,KAAK0Y,WAAWU,UAAUpS,KArGlC,qCAyGQhH,KAAK0Y,WAAWlS,iBAzGxB,sCA4G8BlB,GACtBtF,KAAK0Y,WAAWtG,gBAAgB9M,KA7GxC,qCAiHEtF,KAAK0Y,WAAWW,iBAjHlB,4BAawB,OAAQxT,IAAI2H,gBAbpC,+BAc0B,OAAOxN,KAAK0Y,WAAWrO,aAdjD,K,cCDsBiP,EAAtB,4MACWC,oBADX,qDAGSlC,EAAYY,GAA6C,IAE5DuB,EAF2D,OAC/DxZ,KAAK4F,KAAKyR,QAEU5W,IAAhBwX,IAA2BuB,EAAe,kBAAMvB,EAAY,EAAKsB,kBACrEvZ,KAAKyZ,gBAAgBzZ,KAAK0Z,aAAcF,KAP1C,kCAWgBnC,EAAYY,GAA6C,IAEnEuB,EAFkE,OACtExZ,KAAK4F,KAAKyR,QAEU5W,IAAhBwX,IAA2BuB,EAAe,kBAAMvB,EAAY,EAAKsB,kBACrEvZ,KAAK2Z,mBAAmB3Z,KAAK0Z,aAAcF,KAf7C,6BAmBQnC,GAEN,OADArX,KAAK4F,KAAKyR,GACHrX,KAAK0Z,eArBd,2BAwBMrC,MAxBN,+BA0BsC,OAAO,OA1B7C,8BA2BsB,OAAO,OA3B7B,gCA4BwB,OAAO,OA5B/B,+BA6BuB,OAAO,OA7B9B,+BA8B0C,OAAO,IA9BjD,mCA+BqC,IAAD,OAC9BxU,EAAS7C,KAAK6C,SACbA,IAAQA,GAAS,GACtB,IAAI+W,EAAS5Z,KAAK4Z,SAClB,OAAO,cAAC,OAAD,CACN/W,OAAQA,EAAQgX,MAAO7Z,KAAK6Z,QAASC,OAAQ9Z,KAAK8Z,SAClDC,SAAU,SAAChF,GAAD,OAAS,EAAKiF,aAAajF,IACrCkF,YAAa,SAACC,GAAD,OAAwB,EAAKC,gBAAgBD,IAC1DE,eAAgB,SAACF,GAAD,OAAwB,EAAKG,mBAAmBH,IAChExW,KAAM1D,KAAK0D,KACX4W,gBAAiBta,KAAKsa,gBACtB/X,UAAWvC,KAAKuC,UAChB+U,UAAW,kBAAI,EAAKA,aACpBiD,UAAWva,KAAKua,UAChBX,OAAQA,EACR5C,OAAQhX,KAAK0Y,WAAWlO,WAXlB,SAaLxK,KAAK8K,cAhDT,mCAoDwBiK,MApDxB,+EAqDiCmF,GArDjC,2FAqD+E,GArD/E,oLAsDoCA,GAtDpC,6PAwDkD,MAAO,SAxDzD,sCAyD0C,OAAO,OAzDjD,gCA0DoC,OAAO,OA1D3C,gCA2DuC,OAAO,SA3D9C,GAA0DzB,G,+CCS1D,8MACSlX,MAA0B,CACjC2U,MAAO,gBAFT,yKAuBYsE,SAAW,SAACC,GAChB,EAAKC,SAAWD,EAAIE,OAAOlD,MAC3B,IAAImD,EAAW,EAAKnD,MACpB,EAAKoD,UAAa,EAAKH,WAAaE,GA1B5C,EA6BYE,OAAS,SAACL,GACd,EAAKM,eA9Bb,EAmCYC,QAAU,WACd,EAAK/Y,WAAQxB,GApCrB,EAuCSwa,OAAS,WAAO,IAAD,EAC+B,EAAK1Z,MAArD2U,EADiB,EACjBA,MAAOgF,EADU,EACVA,UAAWC,EADD,EACCA,YAAaC,EADd,EACcA,cAChCC,EAAS,WACZ,EAAKN,mBACcta,IAAf,EAAKwB,QACR,EAAKwV,MAAQ,EAAKiD,SAClB,EAAKnC,YACD6C,GAAeA,EAAc,EAAK3D,SAG9BoC,EAAQnX,IAAM4Y,cAAcC,aAAS,kBAAM,wBAC3ChZ,UAAU,gDACViZ,UAAW,EAAKX,UAChBpY,QAAS4Y,EAHkC,8BAOrD,EAAK1D,SAAS,cAAC,OAAD,CAAM9U,OAAQqT,EAAO2D,MAAOA,EAA5B,SACJ,sBAAKtX,UAAU,MAAf,UACR,uBAAOC,KAAK,OACXgY,SAAU,EAAKA,SACfiB,UAPa,SAAChB,GACI,KAAhBA,EAAIiB,SAAgBL,KAOPP,OAAQ,EAAKA,OACbE,QAAS,EAAKA,QAC7BzY,UAAU,eACVoZ,aAAc,EAAKlE,MACnByD,UAAWA,IAEXxY,IAAM4Y,cAAcC,aAAS,kBAAKJ,GAAe,qBAAK5Y,UAAU,kBAAf,SAAkC4Y,QAEvE,EAAKlZ,OAAS,qBAAKM,UAAU,cAAf,SAA8B,EAAKN,eArElE,+RAUQwV,EAAclW,GAA0B,IAAD,OAG7C,OAFAvB,KAAKyX,MAAQA,EACTlW,GAAO+O,IAAEC,MAAMvQ,KAAKuB,MAAOA,GACxBmB,IAAM4Y,cAAcC,aAAS,kBAAI,qCAAG,EAAKK,cAAe,EAAKC,wBAbtE,oCAgB0B,OAAO,mCAAG7b,KAAKyX,UAhBzC,qCAkBE,OAAO,uBAAMhV,QAASzC,KAAKib,OAAQ1Y,UAAU,iBAAtC,kBACC,cAAC,KAAD,CAAIA,UAAU,YAAYoF,KAAK,oBADhC,aAlBT,4CAAiCoO,GAAjC,mCAIE7B,KAJF,oGAKEA,KALF,qGAMEA,KANF,iGAOEA,KAPF,+D,uJCaa4H,EADZP,YACD,oDAEI,WAAYha,GAAmB,IAAD,uBAChC,cAAMA,IAFCwa,cACyB,MAE3BxB,EAAahZ,EAAbgZ,UAF2B,OAG5BA,IACH,EAAKwB,SAAW,IAAIC,IAASzB,IAJE,EAFlC,yDAUsBvD,GAAsB,IAAD,EACyBhX,KAAKuB,MAAhEmC,EADkC,EAClCA,KAAMb,EAD4B,EAC5BA,OAAQgX,EADoB,EACpBA,MAAOS,EADa,EACbA,gBAAiBhD,EADJ,EACIA,UAAWsC,EADf,EACeA,OACxD,IAAe,IAAX/W,EAAJ,CAEA,IAAIoZ,GAAW,EACXC,EAAkC,CACrCxY,OACAyY,OAAQtZ,EACRgX,QACAD,SACArX,UAAW+X,EACXhD,aAED,QAAe7W,IAAXuW,EAAsB,CACzBiF,GAAW,EADc,IAEFG,EAAOpF,EAAzBqF,iBACL,GAAID,EAAK,OAAOA,EAAIF,QAGpBD,GAAW,EAEZ,OAAOI,YAAiBH,EAAiBD,MA/B3C,mCA6CsBjF,GAAsB,IACnC8C,EAAU9Z,KAAKuB,MAAfuY,OACP,GAAKA,EAAL,CACA,IAAIwC,EAAW,iCAASxC,IACxB,OAAI9C,EAAesF,EACZ,qCACN,yBAAS/Z,UAAU,iBAAnB,SAAqC+Z,IACpCA,QApDJ,wCAwDmBra,EAAcsa,MAxDjC,+BA+DE,GAAIvc,KAAK+b,SACR,OAAOrZ,gBAAoB1C,KAAK+b,SAASjR,SAF/B,IAKPN,EALO,EAIkExK,KAAKuB,MAA3EwY,EAJI,EAIJA,SAAUE,EAJN,EAIMA,YAAaG,EAJnB,EAImBA,eAAgBoC,EAJnC,EAImCA,SAAUja,EAJ7C,EAI6CA,UAAWyU,EAJxD,EAIwDA,OAMlExM,EAJIwM,GACS9T,IAAIsH,WAKlB,IAAIM,EAAU,qCACZ9K,KAAKyc,aAAajS,GACnB,+BAAOgS,IACNxc,KAAK0c,aAAalS,MAEpB,OAAIA,EACI,cAAC,IAAD,CACNuP,SAAUA,EACVE,YAAaA,EACbG,eAAgBA,EAChB7X,UAAWA,EACXyU,OAAQxM,EALF,SAOLM,IAIK,cAAC,IAAD,CACNiP,SAAUA,EACVE,YAAaA,EACbG,eAAgBA,EAChB7X,UAAWA,EAJL,SAMLuI,QAjGL,GAA0BpI,eAA1B,G,mdCdMia,EAAuC,GACtC,SAASC,IACZ,IAAK,IAAIza,KAAKwa,EACVA,EAASxa,QAAK1B,EAWtB,IAAMoc,EAAwC,GAWnC7N,EAAwB,I,iDAR/BZ,U,OACQiH,W,OAGR2C,U,OACAX,W,mDAHoB,OAAOrX,KAAKqV,O,aACvByH,GAAc9c,KAAKqV,MAAMyH,M,MAa/B,SAASC,IACZ,OAAO7X,OAAOC,OAASD,OAAOgK,OA+ClC,SAAS8N,EAAgBvC,GACrB,IAAI7X,EAAU6X,EAAIwC,KACdC,EAASzC,EAAI3R,OACjBqU,YAAgBD,GAMpB,SAAuB9O,GACnB,IAAIvB,EAAKpB,SAASqB,eAAesB,QACtB3N,IAAPoM,IAAkBA,EAAGuQ,QAAS,GAPlCC,CAAcza,EAAQwL,MACtB,IAAI5K,EAAU8M,IAAEgN,MAAMpa,MAAIyG,MAC1BnG,EAAIhB,KAAO,eACX0a,EAAO7X,YAAY7B,EAAK,K,SAMb+Z,E,8EAAf,WAA0B3a,GAA1B,eAAAtB,EAAA,6DACIwD,QAAQC,IAAI,2BAA4BnC,GACpC+G,EAAOzG,MAAIyG,KAAO/G,EACtB1B,YAAeyI,EAAK8D,GAAI9D,EAAKtJ,OAHjC,SAIU6C,MAAIoO,cAJd,4C,+BAMekM,E,gFAAf,WAAsCpP,EAAcqP,GAApD,+BAAAnc,EAAA,8DAEuBb,KADfuO,EAAa6N,EAAYzO,IADjC,yCAEyC,CAACzG,KAAK8V,EAASC,QAAGjd,EAAWiB,SAAIjB,EAAWJ,WAAMI,IAF3F,cAISF,EAAwByO,EAAxBzO,KAAM6O,EAAkBJ,EAAlBI,gBACX7O,EAAOA,GAAQ6O,IAEXtK,QAAQ7C,MAAM,mEAAoE1B,GAElFod,EAAQF,EAAQG,MAAM,KACtBvG,EAAQ,CAAC9W,KAAMA,EAAMsd,QAASF,EAAM,GAAIG,OAAQH,EAAM,GAAII,SAAUJ,EAAM,GAAIK,QAAQL,EAAM,IAChG7Y,QAAQC,IAAI,uCAAwCsS,GAXxD,UAYoB4G,IAAW/X,GAAGmR,GAZlC,eAYQnX,EAZR,OAaSwd,EAAkBxd,EAAlBwd,GAAIhc,EAAcxB,EAAdwB,IAAKrB,EAASH,EAATG,MAblB,kBAcW,CAACsH,KAAM8V,EAASC,GAAGA,EAAIhc,IAAKA,EAAKrB,MAAOA,IAdnD,6C,+BAiBe6d,E,8EAAf,WAA8Btb,GAA9B,2BAAAtB,EAAA,yDACSmc,EAAoC7a,EAApC6a,QAASC,EAA2B9a,EAA3B8a,GAAIhc,EAAuBkB,EAAvBlB,IAAKyc,EAAkBvb,EAAlBub,QAAS9d,EAASuC,EAATvC,WAEjBI,KADX2d,EAASC,EAAeZ,IAFhC,sBAIc,IAAI7O,MAAM,wBAJxB,OAOQ0P,EAAUnQ,IAAKoQ,aAAab,EAAIhc,EAAKyc,GACzCrZ,QAAQC,IAAI,oCAAsCrD,EAAM,UAAY4c,GAGpEF,EAAOxc,QAAQ,CACX+F,KAAM8V,EACNC,GAAIA,EACJhc,IAAK4c,EACLje,MAAOA,IAff,4C,sBAmBO,SAAS4O,EAAcuP,GAC1B,GAAIA,EAAS,CACT,IAAIb,EAAQa,EAAQZ,MAAM,KACtB3Y,EAAM0Y,EAAM3Y,OAChB,GAAIC,EAAM,EAAG,CACT,IAAIgC,EAAI,EACR+H,EAAWZ,KAAOuP,EAAM1W,KACpBhC,EAAI,IAAG+J,EAAWzO,KAAOgN,OAAOoQ,EAAM1W,OACtChC,EAAI,IAAG+J,EAAWgJ,KAAO2F,EAAM1W,MAC/BhC,EAAI,IAAG+J,EAAWqI,MAAQsG,EAAMc,MAAMxX,OAGlD,OAAO+H,EAGJ,SAASV,IACZ,IAAIF,EAAO3C,SAASC,SAAS0C,KAC7B,QAAa3N,IAAT2N,GAAsBA,EAAKpJ,OAAS,EAAG,CACvC,IAAIqJ,EAAMD,EAAKsQ,YAAY,QAE3B,OADIrQ,EAAM,IAAGA,EAAMD,EAAKsQ,YAAY,cAC7BrQ,EAEX,OAAQ,EAGL,SAASU,IACZ,IAAIV,EAAMC,IACV,KAAID,EAAM,GACV,OAAO5C,SAASC,SAAS0C,KAAKG,UAAUF,GAGrC,SAASuE,EAAOlR,EAAakM,EAAgBoK,EAAcX,GAE9D,IADA,IAAIsH,IACK,CAGL,GAFAA,EAAIC,mBAEMne,IADFoc,EAAY8B,GACC,CACjB9B,EAAY8B,GAAK,CAACvQ,KAAKuQ,EAAGpe,KAAKqN,GAC/B,OAIR,GADAlM,GAAO,OAASid,EAAI,IAAM/Q,OACbnN,IAATuX,IACAtW,GAAO,IAAMsW,OACCvX,IAAV4W,GACA,IAAK,IAAIlV,EAAE,EAAGA,EAAEkV,EAAMrS,OAAQ7C,IAC1BT,GAAO,IAAM2V,EAAMlV,GAI/B,MAAO,CAACT,IAAKA,EAAK0M,KAAMuQ,GAG5B,SAASE,IAAkB,IACrBte,EAAwByO,EAAxBzO,KAAM6O,EAAkBJ,EAAlBI,eACJ0P,EAAWve,GAAQ6O,EACvB,QAAiB3O,IAAbqe,EACA,MAAM,IAAIlQ,MAAM,kDAEpB,OAAOkQ,EA9JX5Z,OAAOS,iBAAiB,UAAxB,uCAAmC,WAAe8U,GAAf,mBAAAnZ,EAAA,sDAC3BsB,EAAU6X,EAAIwC,KADa,KAEvBra,EAAQJ,KAFe,OAGtB,sBAHsB,OAMtB,OANsB,OAUtB,iBAVsB,OAatB,YAbsB,QAiBtB,eAjBsB,QAoBtB,sBApBsB,QAuBtB,YAvBsB,QAgCtB,mBAhCsB,+BAIvBwa,EAAgBvC,GAJO,4CAQjBvX,MAAI6b,UAAUnc,EAAQY,KARL,2DAWjB+Z,EAAW3a,GAXM,mDAcvBsC,OAAOJ,QAAQC,IAAI,qBACnB7B,MAAIwB,UAfmB,8CAkBjBsa,EAAyBvE,EAAI3R,OAAkBlG,GAlB9B,mDAqBvBqc,EAAsBrc,GArBC,8CAwBP4a,EAAuB5a,EAAQwL,KAAMxL,EAAQ6a,SAxBtC,eAwBnBvd,EAxBmB,OAyBtBua,EAAI3R,OAAkBzD,YAAY,CAC/B7C,KAAM,iBACNib,QAAS7a,EAAQ6a,QACjBC,GAAIxd,EAAIwd,GACRhc,IAAKxB,EAAIwB,IACTrB,MAAOH,EAAIG,OAAe,KA9BP,oCAiCvByE,QAAQC,IAAI,qBAAsBmI,KAAKkE,UAAUxO,IACjDkC,QAAQC,IAAI,kCAlCW,UAmCjBmZ,EAAetb,GAnCE,gDAsCiC,KAA7D,UAACA,EAAQkG,cAAT,eAA4BoW,WAAW,mBAtCX,4DAuCvBha,OAAOJ,QAAQC,IAAI,cAAemI,KAAKkE,UAAUxO,IAvC1B,iEAAnC,uDAqKA,IAAMyb,EAA8C,GAC7C,SAAec,EAAtB,0C,4CAAO,WAA0BjZ,EAAW2X,EAAgBC,EAAeC,EAAiBC,GAArF,yBAAA1c,EAAA,yDACEyb,IADF,wBAEKxc,EAAOse,IAFZ,SAGqBZ,IAAW/X,GAAG,CAAC3F,OAAOsd,UAASC,SAAQC,WAAUC,YAHtE,mBAIuBvd,KADlB2e,EAHL,QAIa/e,QAAqB+e,EAAQ/e,MAAQgf,KAC5C3B,EAAoB0B,EAApB1B,GAAIhc,EAAgB0d,EAAhB1d,IAAKyc,EAAWiB,EAAXjB,QACVG,EAAUnQ,IAAKoQ,aAAab,EAAIhc,EAAKyc,GACzCrZ,QAAQC,IAAI,cAAeuZ,GAC3Bc,EAAQ1d,IAAM4c,EACd3B,EAASzW,GAAMkZ,EAThB,kBAUQA,GAVR,WAYHta,QAAQC,IAAI,8BAA+BiK,QAEhCvO,IADF4d,EAAenY,GAbrB,4EAeI,IAAIiF,SAAc,SAACvJ,EAASC,GAC/Bwc,EAAenY,GAAM,CACjBtE,QAAQ,WAAD,4BAAE,WAAO0d,GAAP,qBAAAhe,EAAA,sEACwBge,EADxB,gBACA5B,EADA,EACAA,GAAIhc,EADJ,EACIA,IAAKrB,EADT,EACSA,MACdsc,EAASzW,GAAM,CACXyB,KAAMzB,EACNwX,GAAIA,EACJhc,IAAKA,EACLrB,MAAOA,GAEXge,EAAenY,QAAMzF,EACrBqE,QAAQC,IAAI,6BAA8BiK,GAC1CpN,IAVK,4CAAF,mDAAC,GAYRC,OAAQA,IAEXqD,OAAOqa,QAAUra,OAAOgK,QAAQ7J,YAAY,CACzC7C,KAAM,UACNib,QAASvX,EACTkI,KAAMY,EAAWZ,MAClB,SAnCJ,6C,sBAuCA,SAASoR,EAAMtZ,GAElB,OADUyW,EACCzW,GAQf,IAAMuZ,EAAiD,GAChD,SAAeC,EAAtB,sC,4CAAO,WAA+Bhe,EAAYZ,EAAe6e,GAA1D,SAAAre,EAAA,6DACHwD,QAAQC,IAAI,qCAAsCrD,EAAKZ,GADpD,SAEU,IAAIqK,QAAJ,uCAAiB,WAAOvJ,EAASC,GAAhB,eAAAP,EAAA,yDAGtBse,EAAShB,mBAEGne,IADFgf,EAAgBG,GAJJ,uBAMlBH,EAAgBG,GAAU,CACtBnS,GAAImS,EACJhe,QAASA,EACTC,OAAQA,GATM,kDAczBqD,OAAOqa,QAAUra,OAAOgK,QAAQ7J,YAAY,CACzC7C,KAAM,aACNod,OAAQA,EACRle,IAAKA,EACLZ,OAAQA,EACR6e,KAAMA,GACP,KApBuB,2CAAjB,yDAFV,oF,+BA0BQX,E,gFAAf,WAAwCa,EAAajd,GAArD,uBAAAtB,EAAA,6DACSse,EAA6Bhd,EAA7Bgd,OAAQle,EAAqBkB,EAArBlB,IAAKZ,EAAgB8B,EAAhB9B,OAAQ6e,EAAQ/c,EAAR+c,KAD9B,SAEuBG,IAAcC,WAAWre,EAAKZ,EAAQ6e,GAF7D,OAEQK,EAFR,OAGIH,EAAKxa,YAAY,CACb7C,KAAM,oBACNod,OAAQA,EACRI,OAAQA,GACT,KAPP,4C,sBAUA,SAASf,EAAsBrc,GAAc,IACpCgd,EAAkBhd,EAAlBgd,OAAQI,EAAUpd,EAAVod,OACTC,EAAMR,EAAgBG,QACdnf,IAARwf,IACJR,EAAgBG,QAAUnf,EAC1Bwf,EAAIre,QAAQoe,M,wHC5SVE,EAAK,KACLC,EAAQ,WACRC,EAAgBD,EAAME,WAAW,GACjCC,EAAQH,EAAME,WAAW,GACzBE,EAAQJ,EAAME,WAAW,GACzBG,EAAQL,EAAME,WAAW,GACzBI,EAAQN,EAAME,WAAW,GACzBK,EAAQP,EAAME,WAAW,GACzBM,EAAQR,EAAME,WAAW,GAEzBO,EAAQ,eACRC,EAASD,EAAMP,WAAW,GAC1BS,EAASF,EAAMP,WAAW,GAC1BU,EAASH,EAAMP,WAAW,GAC1BW,EAASJ,EAAMP,WAAW,GAC1BY,EAASL,EAAMP,WAAW,GAC1Ba,EAASN,EAAMP,WAAW,GAEVc,EAAtB,WAgBI,WAAYjb,EAAUyB,EAAayZ,GAAgB,yBAf3CC,WAe0C,OAdlDC,YAckD,OAblDC,IAAc,EAaoC,KAZlDC,SAYkD,OAXzCtb,QAWyC,OAVzCyB,UAUyC,OATzCyZ,YASyC,OARzCK,WAQyC,OAPzCC,WAOyC,OAJlDC,YAIkD,OAHlDC,eAGkD,OAFlDC,aAEkD,OAS3CC,UAT2C,OAa1CC,UAAsC,GAZ1C/hB,KAAKkG,GAAKA,EACVlG,KAAK2H,KAAOA,EACZ3H,KAAKohB,OAASA,EACdphB,KAAKwhB,IAAMxhB,KAAK2H,KAAK0L,QAAQ,MAAQ,EACrCrT,KAAKyhB,MAAQzhB,KAAKkG,GAAG8b,SAASlb,KAAK9G,KAAK2H,MACxC3H,KAAK0hB,MAAQ1hB,KAAKkG,GAAGwb,MAtB7B,kDAWwB,OAAO1hB,KAAKqhB,OAASrhB,KAAK2H,SAXlD,8CA8Ba0M,QACO5T,IAAR4T,IAAmBA,EAAM,KAC7B,IAAInU,EAAMF,KAAK+hB,UAAU1N,GACzB,QAAY5T,IAARP,EAAmB,CACnB,IAAIyhB,EACJ,GAAY,MAARtN,EAAasN,EAAS3hB,KAAK2hB,YAC1B,QAAuBlhB,IAAnBT,KAAK4hB,UAAyB,CACnC,IAAIA,EAAY5hB,KAAK4hB,UAAUxa,MAAK,SAAAC,GAAC,OAAIA,EAAEM,OAAS0M,UAClC5T,IAAdmhB,IAAyBD,EAASC,EAAUD,aAE/C,QAAqBlhB,IAAjBT,KAAK6hB,QAAuB,CACjC,IAAID,EAAY5hB,KAAK6hB,QAAQza,MAAK,SAAAC,GAAC,OAAIA,EAAEM,OAAS0M,UAChC5T,IAAdmhB,IAAyBD,EAASC,EAAUD,QAEpD,QAAelhB,IAAXkhB,EAAsB,MAAO,GACjCzhB,EAAM,GAZa,oBAaLyhB,GAbK,IAanB,gCAASM,EAAT,QAAsB/hB,EAAI+hB,EAAEta,MAAQsa,GAbjB,8BAcnBjiB,KAAK+hB,UAAU1N,GAAOnU,EAE1B,OAAOA,IAjDf,2JAqD4BO,IAAhBT,KAAKshB,OArDjB,oDAsDYA,EAASthB,KAAKyhB,MAAMxhB,MAtDhC,gCAwD2BD,KAAKkG,GAAGgc,iBAAiBliB,KAAK2H,MAxDzD,OAwDY2Z,EAxDZ,qBA4DEthB,KAAKmiB,YAAYb,GA5DnB,UA6DQthB,KAAKoiB,aA7Db,yIAgEad,GACLthB,KAAKqiB,UAAUf,GACrBthB,KAAKsiB,oBAlEP,2QA0EQtiB,KAAKshB,YAAS7gB,IA1EtB,gCA6EqB6gB,GACb,QAAe7gB,IAAX6gB,EAAJ,CADyB,IAEpB3Z,EAAiB2Z,EAAjB3Z,KAAMxB,EAAWmb,EAAXnb,QACXnG,KAAKuhB,IAAMpb,GAAW,EAC5BnG,KAAKuiB,SAAS5a,GACR3H,KAAKyhB,MAAM/b,IAAI4b,GACrBthB,KAAKshB,OAASA,EACdthB,KAAKsiB,qBApFP,+BAuFoB3a,GACRA,IAAS3H,KAAK2H,OAAM3H,KAAKqhB,MAAQ1Z,KAxF7C,wCA2F8B,IAAD,EACS3H,KAAKshB,OAA9BK,EADgB,EAChBA,OAAQhZ,EADQ,EACRA,KAAMkZ,EADE,EACFA,QACnB7hB,KAAKkG,GAAGsc,eAAexiB,KAAK2hB,OAASA,GACrC3hB,KAAKkG,GAAGuc,mBAAmBziB,KAAK4hB,UAAYjZ,EAAMgZ,GAClD3hB,KAAKkG,GAAGuc,mBAAmBziB,KAAK6hB,QAAUA,EAASF,KA/F3D,wCAmGQ,OAAOzU,KAAKkE,UAAUpR,KAAKshB,QAAQ,SAAC3a,EAAY8Q,GAC5C,GAAY,UAAR9Q,EACJ,OAAO8Q,IACR,KAtGX,mCAyGiBiL,EAAkBC,GAC3B,QAAoBliB,IAAhBT,KAAKshB,OAAT,CADiD,MAE5BthB,KAAKshB,OAArBK,EAF4C,EAE5CA,OAAQhZ,EAFoC,EAEpCA,KACTia,EAAW5iB,KAAKkG,GAOhB2c,EAAKH,EAAU1U,cACnB,QAAgBvN,IAAZkiB,EAAuB,OAAOG,EAAQD,EAAIlB,GAC9C,QAAalhB,IAATkI,EAAJ,CACA,IAAIoa,EAAKJ,EAAQ3U,cACbqG,EAAO1L,EAAqBvB,MAAK,SAAAC,GAAC,OAAIA,EAAEM,OAASob,KACrD,QAAYtiB,IAAR4T,EACJ,OAAOyO,EAAQD,EAAIxO,EAAIsN,SAZvB,SAASmB,EAAQD,EAAWG,GACxB,QAAiBviB,IAAbuiB,EAAJ,CACA,IAAIf,EAAIe,EAAS5b,MAAK,SAAAC,GAAC,OAAIA,EAAEM,OAASkb,KACtC,QAAUpiB,IAANwhB,EACJ,OAAOW,EAASE,QAAQb,EAAEgB,UAjHtC,kCA4HgBtiB,GACR,IAAIqf,EAAa,GACb2B,EAAS3hB,KAAK2hB,YACHlhB,IAAXkhB,GAAsB3hB,KAAKkjB,kBAAkBlD,EAAQ2B,EAAQhhB,GACjE,IAAIgI,EAAO3I,KAAK4hB,UAChB,QAAanhB,IAATkI,EAAoB,CAAC,IAAD,gBACJA,GADI,IACpB,2BAAsB,CAAC,IAAd0L,EAAa,QACb1M,EAAgB0M,EAAhB1M,KAAMga,EAAUtN,EAAVsN,OAEX,QAAkBlhB,IADIE,EAAOgH,GAC7B,CACA,IAAIwb,EAAkB,GACtBnD,EAAOrY,GAAQwb,EALG,oBAMHxiB,GANG,IAMlB,2BAAuB,CAAC,IAAfyiB,EAAc,QACfC,EAAY,GAChBrjB,KAAKkjB,kBAAkBG,EAAW1B,EAAQyB,GAC1CD,EAAU/gB,KAAKihB,IATD,iCADF,+BAcxB,OAAOrD,IA/If,wCAkJ8BA,EAAY2B,EAAgBhhB,GAAa,IAAD,gBAC5CghB,GAD4C,IAC9D,2BAA0B,CAAC,IAAlB2B,EAAiB,QACjB3b,EAAc2b,EAAd3b,KAAMnF,EAAQ8gB,EAAR9gB,KACP+S,EAAI5U,EAAOgH,GACXmV,OAAO,EACX,OAAQta,GAChB,IAAK,WACQsa,EAAM9c,KAAKujB,mBAAmBhO,GAC1C,MACD,IAAK,OAEHuH,EADGvH,aAAa3Q,KACb,UAAM2Q,EAAEiO,cAAR,YAAyBjO,EAAEkO,WAAW,EAAtC,YAA2ClO,EAAEmO,WAG1CnO,EAEP,MACD,QACC,cAAeA,GACd,QAASuH,EAAMvH,EAAG,MAClB,IAAK,SACJ,GAAIA,aAAa3Q,KAAM,CACtBkY,EAAMvH,EACN,MAED,IAAI0N,EAAOK,EAAMK,MACO7G,OAAXrc,IAATwiB,EAA0B1N,EAAE9H,GACrBwV,EAAKW,aAAarO,IAKxByK,EAAOrY,GAAQmV,GAhC2C,iCAlJtE,yCAsLuBA,GACf,IAAI+G,EACJ,cAAe/G,GACX,QAAmB,MAAM,IAAIlO,MAAM,mDAAqDkO,GACxF,IAAK,YAAa,OAClB,IAAK,SAAU+G,EAAM/G,EAAc,MACnC,IAAK,SACL,IAAK,SAAU+G,EAAK,IAAIjf,KAAKkY,GAEjC,OAAOgH,KAAKC,MAAMF,EAAG5Q,UAAU,OA/LvC,qCAkMmB6J,GACX,IAAI+G,EACJ,cAAe/G,GACX,QAAmB,MAAM,IAAIlO,MAAM,mDAAqDkO,GACxF,IAAK,YAAa,MAAO,GACzB,IAAK,SAAU,OAAOA,EACtB,IAAK,SAAU+G,EAAM/G,EAAc,MACnC,IAAK,SAAU+G,EAAK,IAAIjf,KAAKkY,GAEjC,IAAI5c,EAAM2jB,EAAGG,cACT/c,EAAI/G,EAAImT,QAAQ,KACpB,OAAOpM,EAAE,EAAG/G,EAAIgO,OAAO,EAAGjH,GAAK/G,IA7MvC,2BAgNS+c,GACD,IAAI/c,EAAe,GACfyhB,EAAS3hB,KAAK2hB,YACHlhB,IAAXkhB,GAAsB3hB,KAAKikB,QAAQ/jB,EAAKyhB,EAAQ1E,GACpD,IAAItU,EAAO3I,KAAK4hB,UAChB,QAAanhB,IAATkI,EAAoB,CAAC,IAAD,gBACJA,GADI,IACpB,2BAAsB,CAAC,IAAd0L,EAAa,QACzB1M,EAAgB0M,EAAhB1M,KAAMga,EAAUtN,EAAVsN,OACPuC,EAAU1O,YAAqByH,EAAMtV,GAE7B3H,KAAKmkB,QAAQjkB,EAAKyhB,EAAQuC,IALV,+BAQxB,OAAOhkB,EAAIkkB,KAAK,MA7NxB,6BAgOmBC,EAASf,GACpB,IAAI/N,EAAI8O,EAAIf,EAAM3b,MAClB,OAAQ2b,EAAM9gB,MACV,IAAK,WACD,OAAOxC,KAAKujB,mBAAmBhO,GACnC,QACI,cAAeA,GACX,QAAS,OAAOA,EAChB,IAAK,SACD,IAAI0N,EAAOK,EAAMK,MACjB,YAAaljB,IAATwiB,EAA2B1N,EAAE9H,GAC1BwV,EAAKW,aAAarO,GAC7B,IAAK,SAGD,IAFA,IAAItQ,EAAMsQ,EAAEvQ,OACRuO,EAAI,GAAItM,EAAI,EACP9E,EAAE,EAAEA,EAAE8C,EAAI9C,IAAK,CACpB,IAAgCmiB,OAAS,EACzC,OADe/O,EAAE8K,WAAWle,IAEhD,QAAS,SACT,KAAKie,EAAekE,EAAK,OAAQ,MACT,KAAKxD,EAAQwD,EAAK,MAAO,MACjD,KAAKzD,EAAQyD,EAAK,MAAO,MACzB,KAAKtD,EAAQsD,EAAK,MAAO,MACzB,KAAKrD,EAAQqD,EAAK,MAAO,MACzB,KAAKvD,EAAQuD,EAAK,MAAO,MACzB,KAAKpD,EAAQoD,EAAK,MAEnB/Q,GAAKgC,EAAEhH,UAAUtH,EAAG9E,GAAKmiB,EACzBrd,EAAI9E,EAAE,EAEW,OAAOoR,EAAIgC,EAAEhH,UAAUtH,GAC3B,IAAK,YAAa,MAAO,OA/P7C,8BAoQoB+Y,EAAiB2B,EAAgB1E,GAC7C,IAAIhY,EAAM0c,EAAO3c,OACjB,GAAY,IAARC,EAAJ,CACA,IAAI/E,EAAM,GACVA,GAAOF,KAAKukB,OAAOtH,EAAM0E,EAAO,IAChC,IAAK,IAAIxf,EAAE,EAAEA,EAAE8C,EAAI9C,IAAK,CACpB,IAAI8f,EAAIN,EAAOxf,GACfjC,GA9RA,KA8RaF,KAAKukB,OAAOtH,EAAMgF,GAEnCjC,EAAO5d,KAAKlC,EAAMggB,MA7Q1B,8BAgRoBF,EAAiB2B,EAAgB1E,GAC7C,QAAaxc,IAATwc,EACT,GAAoB,IAAhBA,EAAKjY,OACRgb,EAAO5d,KAAK8d,OAER,CAAC,IAAD,gBACYjD,GADZ,IACJ,2BAAsB,CAAC,IAAdoH,EAAa,QACrBrkB,KAAKikB,QAAQjE,EAAQ2B,EAAQ0C,IAF1B,oCAOLrE,EAAO5d,KAAK8d,GAEPF,EAAO5d,KAAK8d,KA9RpB,yCAgSiCsE,EAAY7C,GAAiB,IAAD,gBACvCA,GADuC,IACrD,2BAAiC,CAAC,IAAzBM,EAAwB,QACxBta,EAAesa,EAAfta,KAAMgc,EAAS1B,EAAT0B,MACX,QAAcljB,IAAVkjB,EAAJ,CACA,IAAIlW,EAAK+W,EAAO7c,GAEhB6c,EAAO7c,GAAQgc,EAAMc,MAAMhX,KANsB,iCAhS7D,4CA0SoC+W,EAAiB7C,GAC7C,QAAelhB,IAAXkhB,EAAsB,OAAO6C,EAEjC,IAHoE,EAGhEtkB,EAAY,GAHoD,cAIrDskB,GAJqD,IAIpE,2BAAuB,CAAC,IAAftE,EAAc,QACnB,GAAKA,EAGL,IAFA,IAAIjb,EAAMib,EAAGlb,OACTiC,EAAI,EACDA,EAAEhC,GAAK,CAEV,GAAW,KADFib,EAAGG,WAAWpZ,GACR,GACTA,EACF,MAEJ,IAAIod,EAAM,GACVpd,EAAIjH,KAAK0kB,UAAUL,EAAK1C,EAAQzB,EAAIjZ,GACpC/G,EAAIkC,KAAKiiB,KAhBmD,8BAmBpE,OAAOnkB,IA7Tf,kCAgUgB+c,GACR,IAAI/c,EAAM,GAENyhB,EAAS3hB,KAAK2hB,OACd1a,EAAI,OACOxG,IAAXkhB,IAAsB1a,EAAIjH,KAAK0kB,UAAUxkB,EAAKyhB,EAAQ1E,EAAMhW,IAChE,IAAI0B,EAAO3I,KAAK4hB,UAChB,QAAanhB,IAATkI,EAAoB,CAAC,IAAD,gBACJA,GADI,IACpB,2BAAsB,CAAC,IAAd0L,EAAa,QAClBpN,EAAIjH,KAAK2kB,UAAUzkB,EAAKmU,EAAK4I,EAAMhW,IAFnB,+BAKxB,OAAO/G,IA5Uf,oCA+Ue+c,EAAa4E,GAE1B,IAAI3hB,EAAM,GACN+G,EAAI,EACJ0B,EAAOkZ,GAAW7hB,KAAK6hB,QAC3B,QAAaphB,IAATkI,EAAoB,CAAC,IAAD,gBACPA,GADO,IACvB,2BAAsB,CAAC,IAAd0L,EAAa,QACrBpN,EAAIjH,KAAK2kB,UAAUzkB,EAAKmU,EAAK4I,EAAMhW,IAFb,+BAKxB,OAAO/G,IAzVT,gCA4VwBA,EAASyhB,EAAgB1E,EAAahW,GAEtD,IADA,IAAI2d,EAAM,EAAGN,EAAK,EAAGO,EAAI5d,EAAG9E,EAAI,EAAG8C,EAAMgY,EAAKjY,OAAQ8f,EAAOnD,EAAO3c,OAC9DiC,EAAEhC,EAAIgC,IAGR,GAFA2d,EAAMN,EAEK,KADXA,EAAKrH,EAAKoD,WAAWpZ,IACP,CACV,IAAIgb,EAAIN,EAAOxf,GACVwF,EAAQsa,EAARta,KACL,GAAY,IAARid,GACA,GAAI3d,EAAE4d,EAAG,CACL,IAAIxd,EAAI4V,EAAK1O,UAAUsW,EAAG5d,GAC1B/G,EAAIyH,GAAQ3H,KAAK+kB,GAAG7kB,EAAKmH,EAAG4a,SAIhC/hB,EAAIyH,GAAQ,KAIhB,GAFAkd,EAAI5d,EAAE,IACJ9E,GACK2iB,EAIH,OAHA7d,EAAIgW,EAAK5J,QAAQ,KAAMwR,KACd,IAAK5d,EACTA,EAAIhC,EACFgC,OAGV,GAAW,KAAPqd,EAAW,CAChB,IAAIrC,EAAIN,EAAOxf,GACVwF,EAAQsa,EAARta,KACL,GAAY,IAARid,GACA,GAAI3d,EAAE4d,EAAG,CACL,IAAIxd,EAAI4V,EAAK1O,UAAUsW,EAAG5d,GAC1B/G,EAAIyH,GAAQ3H,KAAK+kB,GAAG7kB,EAAKmH,EAAG4a,SAIhC/hB,EAAIyH,GAAQ,KAIhB,QADExF,IADA8E,EAKV,IAAIgb,EAAIN,EAAOxf,GACVwF,EAAQsa,EAARta,KACL,GAAY,IAARid,EAAW,CACX,IAAIvd,EAAI4V,EAAK1O,UAAUsW,GACvB3kB,EAAIyH,GAAQ3H,KAAK+kB,GAAG7kB,EAAKmH,EAAG4a,GAEhC,OAAOhd,IA7Yf,yBAgZe/E,EAASmH,EAAU4a,GAC1B,OAAQA,EAAEzf,MACf,QAAS,OAAO6E,EAChB,IAAK,OACL,IAAK,OACJ,OAAOrH,KAAKglB,UAAU3d,GACd,IAAK,WACL,IAAK,OACd,IAAK,YACQ,IAAI4d,EAAI1X,OAAOlG,GAEf,OADwB,IAAb6d,MAAMD,GAAa,IAAIrgB,KAAKyC,GAAK,IAAIzC,KAAO,IAAFqgB,GAEzD,IAAK,OACD,IAAItH,EAAQtW,EAAEuW,MAAM,KACpB,OAAO,IAAIhZ,KAAK2I,OAAOoQ,EAAM,IAAKpQ,OAAOoQ,EAAM,IAAI,EAAGpQ,OAAOoQ,EAAM,KACvE,IAAK,UACL,IAAK,WACL,IAAK,MACL,IAAK,SACL,IAAK,MACD,OAAOpQ,OAAOlG,GAClB,IAAK,KACD,IAAIoG,EAAKF,OAAOlG,GACXsc,EAAS1B,EAAT0B,MACL,YAAcljB,IAAVkjB,EAA4BlW,EACzBkW,EAAMc,MAAMhX,MAzanC,gCA6amB6F,GACjB,QAAa7S,IAAT6S,GACS,OAATA,EAAJ,CAIA,IAHA,IAAIrO,EAAMqO,EAAKtO,OACXuO,EAAI,GACJtM,EAAI,EACC9E,EAAE,EAAGA,EAAE8C,EAAK9C,IAAK,CAEzB,GADQmR,EAAK+M,WAAWle,KACdie,EAAe,CACxB,GAAIje,IAAI8C,EAAI,EAAG,MACf,IACIqf,OAAS,EACb,OAFShR,EAAK+M,WAAWle,EAAE,IAG1B,QAAS,SACT,KAAKie,EAAekE,EAAK,KAAM,MAC/B,KAAKhE,EAAOgE,EAAK,KAAM,MACvB,KAAK/D,EAAO+D,EAAK,KAAM,MACvB,KAAK9D,EAAO8D,EAAK,KAAM,MACvB,KAAK7D,EAAO6D,EAAK,KAAM,MACvB,KAAK5D,EAAO4D,EAAK,KAAM,MACvB,KAAK3D,EAAO2D,EAAK,KAElB/Q,GAAKD,EAAK/E,UAAUtH,EAAG9E,GAAKmiB,EAC5Brd,EAAI9E,EAAE,IACJA,GAIJ,OADAoR,GAAKD,EAAK/E,UAAUtH,EAAGhC,MAxczB,gCA4csB/E,EAASmU,EAAe4I,EAAahW,GAInD,IAHN,IAAIke,EAAKle,EACCme,EAAa,GAAIngB,EAAMgY,EAAKjY,OAC3B2C,EAAgB0M,EAAhB1M,KAAMga,EAAUtN,EAAVsN,OACJ1a,EAAEhC,GAAK,CACV,IAAIqf,EAAKrH,EAAKoD,WAAWpZ,GACzB,GAAW,KAAPqd,EAAW,CACvB,GAAIrd,IAAMke,EAAI,CAEb,GAAW,MADXb,EAAKrH,EAAKoD,WAAWpZ,IAEpB,MAAM,IAAI2H,MAAM,8JAEf3H,IAEWA,EACF,MAEJ,IAAI6V,EAAM,GACVsI,EAAKhjB,KAAK0a,GACV7V,EAAIjH,KAAK0kB,UAAU5H,EAAK6E,EAAQ1E,EAAMhW,GAG1C,OADA/G,EAAIyH,GAAQyd,EACLne,MAlef,M,iLCjBsBoe,GAAtB,aAeI,WAAYC,EAAWC,EAAwBC,EAAetP,EAAcuB,GAAa,yBAdlF6N,UAciF,OAbjF3d,UAaiF,OAZjF8d,iBAYiF,OAV9EC,aAU8E,OARxFjO,WAQwF,OAP3FvB,WAO2F,6EAF9EwE,cAE8E,EAC1F1a,KAAKslB,KAAOA,EACNtlB,KAAKylB,YAAcF,EACnBvlB,KAAK0lB,QAAUF,EACfxlB,KAAKyX,MAAQA,EAJuE,IAK/E9P,EAAQ4d,EAAR5d,KACL3H,KAAK2H,KAAOA,EACZ3H,KAAKkW,MAAQA,EAtBrB,uDAIkC,OAAOlW,KAAKylB,cAJ9C,6BAMyB,OAAOzlB,KAAK0lB,UANrC,gCAS2B,OAAO,MATlC,uMA6BqB1lB,KAAK8X,gBA7B1B,oSAmCc9X,KAAK2lB,cAnCnB,4IAsCkB,IAENC,EAEA1P,EAAc2P,EAJT,SACU7lB,KAAKylB,YAAnB9d,EADI,EACJA,KAAMnF,EADF,EACEA,KAEPgjB,EAASxlB,KAAK0lB,QAElB,QAAejlB,IAAX+kB,EACAtP,EAAQvO,MAEP,CACVuO,EAAQsP,EAAOtP,MACf2P,EAAYL,EAAOK,UACV,IAAIC,EAAUN,EAAOO,QACrB,QAAgBtlB,IAAZqlB,EACuB,oBAAZA,OACHrlB,IAAfT,KAAKyX,QAAqBmO,EAAWE,EAAQ9lB,KAAKyX,QAGtDmO,EAAW,CAACE,gBAGA,QAAmBrlB,IAAfT,KAAKyX,MACV,OAAQ+N,EAAOQ,QACX,IAAK,QACL,IAAK,SAAL,IACSC,EAAQT,EAARS,KACLL,EAAW,4BAAIK,EAAK7e,MAAK,SAAAC,GAAC,OAAIA,EAAEoQ,QAAU,EAAKA,SAAOlU,QACtD,MACJ,IAAK,KACDqiB,EAAW,gDAAmBje,EAAnB,IAA0B3H,KAAKyX,UAK1D,QAAiBhX,IAAbmlB,EACA,OAAQpjB,GACJ,QACIojB,EAAW5lB,KAAKyX,MAC9B,4BAAIzX,KAAKyX,QAET,wBAAOlV,UAAU,aAAjB,eAA4C,IAAZsjB,EAAkB3P,EAAM,SAAxD,OACc,MACJ,IAAK,QACD0P,EAAW,cAAC,IAAD,CAAOrjB,UAAU,YAAYsQ,IAAK7S,KAAKyX,QAIpE,OAAOmO,IApFT,8IAuFiD1iB,IAAIqC,MAvFrD,qIA0FQ,QAAoB9E,IAAhBT,KAAKwlB,OAAT,CADoB,IAEfU,EAASlmB,KAAKwlB,OAAdU,MACL,QAAczlB,IAAVylB,EAAJ,CACA,IAAIC,EAAKnmB,KAAK0a,SAUd,GAAI0L,MAAMC,QAAQH,GAAQ,CAAC,IAAD,gBACLA,GADK,IACtB,2BAAwB,CAAC,IACjBjkB,EAAQqkB,EADQ,SAEpB,QAAc7lB,IAAVwB,EAAqB,CACrBjC,KAAKiC,MAAQA,EACb,QALc,oCAUtBjC,KAAKiC,MAAQqkB,EAAWJ,IAnB5B,SAASI,EAAWC,EAAgB9O,GAChC,IAAIxV,EAAQskB,EAAKJ,GACjB,QAAc1lB,IAAVwB,EACA,MAAqB,kBAAVA,EACAA,EAEAiL,KAAKkE,UAAUnP,QApG1C,wCAWKiS,KAXL,qGAYKA,KAZL,yEAY+C,KAZ/C,I,4NCGsBsS,EAAtB,kDAII,WAAYC,EAAgB9lB,GAAoC,IAAD,EAAzBC,IAAyB,qFAC3D,cAAMD,EAAQC,IAJV8lB,WAGuD,IAFrDC,aAEqD,EAE3D,EAAKD,MAAQ,EACb,EAAKC,QAAUF,EAH4C,EAJnE,sLAgBczmB,KAAKymB,OAAOG,aAhB1B,uBAiBwB5mB,KAAK6mB,eAjB7B,cAiBY3mB,EAjBZ,yBAkBeA,GAlBf,kQAsBqBF,KAAKymB,OAAO/E,MAAMoF,MAAM9mB,MAtB7C,2TA0B+BA,KAAK+mB,YA1BpC,UA0BYC,EA1BZ,OA2BaC,EAAqBD,EAArBC,IAAKC,EAAgBF,EAAhBE,QAASva,EAAOqa,EAAPra,IACnB3M,KAAKymB,OAAOvgB,GAAGihB,WAAWD,QACdzmB,IAARwmB,EA7BZ,uBA+BgB/mB,EAAMF,KAAKonB,QAAQza,GA/BnC,kBAiCmBzM,GAjCnB,wBAmCqBF,KAAKqnB,MAAMJ,GAnChC,8KAsCYta,GAAc,OAAOA,IAtCjC,qEAiDwB2U,GAjDxB,sEAkDUthB,KAAK0mB,QACH1mB,KAAK0mB,MAAQ,GAnDzB,sBAmDkC,IAAI9X,MAAM,iDAnD5C,cAoDQ5O,KAAKsnB,cAAchG,GApD3B,SAqDqBthB,KAAK6mB,eArD1B,mLAwD0BvF,GAA2B,IACxCpb,EAAcob,EAAdpb,GAAIugB,EAAUnF,EAAVmF,YACEhmB,IAAPyF,GACTlG,KAAKymB,OAAOvgB,GAAGqhB,cAAcrhB,QAETzF,IAAXgmB,GACTzmB,KAAKymB,OAAOpE,UAAUoE,KA9DzB,6BAUoC,OAAOzmB,KAAK2mB,UAVhD,8BAwC8C,IAAD,EACrB3mB,KAAKymB,OAAhBlF,EADgC,EAChCA,IACAiG,EAFgC,EAC3BthB,GACLshB,UACL,MAAO,CACHthB,GAAG,GAAD,OAAKshB,GACPC,GAAG,GAAD,OAAKlG,QA7CnB,G,MAA8C7gB,GAmExBgnB,EAAtB,qKACoC,OAAO1nB,KAAK2mB,YADhD,GAA2CH,GAI9BmB,EAAb,sKAGYhb,GAEJ,OADW3M,KAAKymB,OAAOmB,cAAcjb,KAJ7C,oCAOmB,OAAO3M,KAAKymB,OAAOoB,YAAY7nB,KAAKW,UAPvD,6BACmC,OAAOX,KAAK2mB,UAD/C,2BAEuB,MAAM,SAAN,OAAgB3mB,KAAKymB,OAAO9e,UAFnD,GAAsC6e,GAUzBsB,EAAb,4KAKmB,IAEP7gB,EAFM,EAC0BjH,KAAKW,OAApConB,EADK,EACLA,UAAWC,EADN,EACMA,SAAUrnB,EADhB,EACgBA,OAgB1B,OAbIsG,OADWxG,IAAXE,EACI,CAACgG,IAAK,IAGN3G,KAAKymB,OAAOoB,YAAYlnB,IAQ/B,WAAiBonB,EAClB9gB,EAAC,UAAgB+gB,EACV/gB,IAtBf,8BAwBY0F,GAGV,OAFgB3M,KAAKymB,OAAOmB,cAAcjb,KAzB5C,6BAC0E,OAAO3M,KAAKa,UADtF,6BAEgC,OAAOb,KAAK2mB,UAF5C,2BAIoB,MAAM,cAAN,OAAqB3mB,KAAKymB,OAAO9e,UAJrD,GAAqC6e,I,6hBCvE/ByB,EAAkB,CAAC,OAAQ,OAEXC,EAAtB,WAMI,WAAYC,EAAiBC,EAAiBC,GAAqB,IAAD,gCAL1DC,aAK0D,OAJxDD,QAIwD,OAHxDF,aAGwD,OAFxDC,cAEwD,OAO1D3Y,UAAY,SAAC7O,IACD,IAAZA,QACgBH,IAAZ,EAAK4nB,IAAkB,EAAKA,GAAG5Y,aATuB,KAa1DG,QAAU,SAAClO,EAAaG,QACZpB,IAAZ,EAAK4nB,IAAkB,EAAKA,GAAGzY,eACpBnP,IAAXoB,GAAsBA,EAAO,kCAAgBH,IAfa,KAkB1D6mB,UAlB0D,uCAkB9C,WAAOtmB,GAAP,SAAAX,EAAA,8DACAb,IAAZ,EAAK4nB,GADO,gCACiB,EAAKA,GAAGE,UAAUtmB,GADnC,2CAlB8C,sDAC9DjC,KAAKmoB,QAAUA,EACfnoB,KAAKooB,SAAWA,EAChBpoB,KAAKqoB,GAAKA,EACVroB,KAAKsoB,SAAgC,IAAtBziB,IAAI2H,cAAwB,IAAO,IAV1D,mDA6BQxN,KAAKwoB,KAAK,GAAI,MA7BtB,qEAgCgBC,EAAkBC,GAhClC,mFAmCQ,GAFI/mB,EAAU3B,KAAK2oB,eACdC,EAAyBF,EAAzBE,QAASC,EAAgBH,EAAhBG,KAAM/nB,EAAU4nB,EAAV5nB,YACJL,IAAZmoB,EAEA,IAASzmB,KADL2mB,EAAInnB,EAAQinB,QACFA,EAEtBE,EAAE3mB,GAAK4mB,UAAUH,EAAQzmB,IAvC7B,OA0CQR,EAAQb,OAASA,EACbmG,EAAIyhB,EAAOb,cACXI,EAAgB5U,QAAQvS,IAAW,QAAWL,IAANwG,IACxCtF,EAAQge,KAAOzS,KAAKkE,UAAUnK,IA7C1C,SA+CqBjH,KAAKgpB,WAAWP,EAAYI,EAAMlnB,EAAS+mB,EAAO9nB,SA/CvE,iOAkDmCc,EAAaC,EAAcf,GAlD9D,uFAmDwBZ,KAAKgpB,WAAWtnB,EAAKC,EAASf,GAnDtD,cAmDYV,EAnDZ,yBAoDeA,EAAIyM,KApDnB,8KAuDcjL,GAvDd,oGAuD2Bf,EAvD3B,oCAuDyCF,EAAWG,EAvDpD,wBAwDYD,EAxDZ,uBAyDgBgV,EAAOC,OAAOD,KAAKhV,IACdqE,OAAS,GA1D9B,iBA2DoB6f,EAAI,IA3DxB,cA4D8BlP,GA5D9B,4DA4DyBsT,EA5DzB,aA8D8BxoB,IADFE,EAAOsoB,GA7DnC,wDA+DoBvnB,GAAOmjB,EAAIoE,EAAI,IAAMtoB,EAAOsoB,GAC5BpE,EAAI,IAhExB,mFAAA9P,EAAA,iEAoEYpT,EAAU3B,KAAK2oB,gBACX7nB,OAAS,MArEzB,UAsEqBd,KAAKkpB,iBAAiBxnB,EAAKC,EAASf,GAtEzD,oOAyEec,EAAaf,EAAaC,GAzEzC,8EA0EYe,EAAU3B,KAAK2oB,gBACX7nB,OAAS,OACjBa,EAAQge,KAAOzS,KAAKkE,UAAUzQ,GA5EtC,SA6EqBX,KAAKkpB,iBAAiBxnB,EAAKC,EAASf,GA7EzD,sNAgFcc,EAAaf,EAAaC,GAhFxC,8EAiFYe,EAAU3B,KAAK2oB,gBACX7nB,OAAS,MACjBa,EAAQge,KAAOzS,KAAKkE,UAAUzQ,GAnFtC,SAoFqBX,KAAKkpB,iBAAiBxnB,EAAKC,EAASf,GApFzD,yNAuFiBc,EAAaf,EAAaC,GAvF3C,8EAwFYe,EAAU3B,KAAK2oB,gBACX7nB,OAAS,SACjBa,EAAQge,KAAOzS,KAAKkE,UAAUzQ,GA1FtC,SA2FqBX,KAAKkpB,iBAAiBxnB,EAAKC,EAASf,GA3FzD,8UA6FgBc,EAAaC,EAAcf,EAAkBgB,EAA2BC,GA7FxF,QAiGiBsnB,EAjGjB,kFAiGiBA,EAjGjB,SAiG4BjnB,EAAUknB,GAC1B,cAAelnB,GACX,IAAK,cACUzB,IAAP2oB,IAAkBlnB,GAAO,IAAMknB,GACnC,MACJ,IAAK,SAKD,IAJA,IACIC,EAAa,CACbD,GAAIA,GAER,MAJWxT,OAAOD,KAAKzT,GAIvB,eAAsB,CAAjB,IAAIyE,EAAG,KACR0iB,EAAO1iB,GAAOzE,EAAIyE,GAEtBzE,EAAMmnB,EAGd,MAAO,CACH5nB,QAAS6nB,EACT5nB,IAAKmnB,EACLlnB,QAASA,EACTC,QAASA,EACTC,OAAQA,EACRI,MAAOC,IAzBXonB,EAAOtpB,KACXA,KAAKyP,UAAU7O,GACXioB,EAAOnnB,EAhGnB,SA2HYoD,QAAQC,IAAI,WAAYpD,EAAQb,OAAQ+nB,EAAMlnB,EAAQge,MAAQ,IAC1D9a,EAAMD,KAAKC,MACX0kB,EAAiB1jB,IAAIC,gBACrBrF,GACA,WACI6oB,EAAK1Z,QAAQlO,EAAM,sBAAwBkD,KAAKC,MAAQA,GAAO,KAAMhD,KAEzE7B,KAAKsoB,SAlIrB,UAmI4B9b,MAAMuc,UAAUF,GAAOlnB,GAnInD,YAoI2B,KADXgL,EAnIhB,QAoIoBZ,GApIpB,uBAqIgBlG,IAAIE,aAAawjB,GACjBzkB,QAAQC,IAAI,oBACZukB,EAAK1Z,UACL9K,QAAQC,IAAI,gBAAiB4H,EAAI6c,YAC3B7c,EAAI6c,WAzI1B,cA2IgBC,EAAK9c,EAAIic,QAAQ3oB,IAAI,kBACfwpB,EAAGpW,QAAQ,SAAS,GA5I1C,0CA6IuB1G,EAAID,OAAOgd,KAAX,uCAAgB,WAAMC,GAAN,eAAAroB,EAAA,yDACnBuE,IAAIE,aAAawjB,GACjBD,EAAK1Z,WACc,IAAf+Z,EAAQ5d,GAHO,sBAIQ,kBAAZ4d,GAGFvD,MAAMC,QAAQsD,GAPR,kBAUR/nB,EAAQ+nB,IAVA,eAaFlpB,KADbmpB,EAAWD,EAAQ1nB,OAZJ,iCAcTqnB,EAAKf,UAAUY,EAAW,yBAdjB,gDAiBTG,EAAKf,UAAUY,EAAWS,EAAU,kBAjB3B,QAkBf/nB,EAAO+nB,GAlBQ,4CAAhB,uDAoBJC,MApBI,uCAoBE,WAAM5nB,GAAN,SAAAX,EAAA,sEACCgoB,EAAKf,UAAUY,EAAWlnB,EAAO,qBADlC,2CApBF,wDA7IvB,yBAsKiC0K,EAAI2G,OAtKrC,QAsKoBA,EAtKpB,OAuKgBzN,IAAIE,aAAawjB,GACjBzkB,QAAQC,IAAI,gBACZukB,EAAK1Z,UACLhO,EAAQ0R,GA1KxB,6DA8KYtT,KAAK4P,QAAQlO,EAAKG,GACG,kBAAV,EAAP,GA/KhB,qBAiLuD,IAD7B,KAAMmM,cACRkR,WAAW,gBAjLnC,wBAkLoBhc,IAAI0W,SAlLxB,2BAsLY9U,QAAQ7C,MAAM,mCAAqCP,GAtL/D,2MA6LoBA,EAAYZ,EAAe6e,GA7L/C,qFA8LYhe,EAAU3B,KAAK2oB,gBACX7nB,OAASA,EACjBa,EAAQge,KAAOA,EAhMvB,SAiMqB,IAAIxU,QAAJ,uCAAiB,WAAOvJ,EAASC,GAAhB,SAAAP,EAAA,sEACpB,EAAKkL,MAAM9K,EAAKC,GAAS,EAAMC,EAASC,GADpB,2CAAjB,yDAjMrB,wLA+MQ,MANc,CACV+mB,QAFU5oB,KAAK8pB,eAGfhpB,YAAQL,EACRkf,UAAMlf,KA5MlB,qCAiOmD,IACtC6H,EAAqBpF,IAArBoF,SAAUC,EAAWrF,IAAXqF,QACXqgB,EAAkC,CAG5CA,eAA0B,kCAChB1c,EAAO5D,EAQX,OAPIC,IAAS2D,GAAQ,IAAM3D,GAEjCqgB,EAAQ,mBAAqB1c,EACnBlM,KAAKooB,WAEdQ,EAAO,cAAoB5oB,KAAKooB,UAEpBQ,MA/Of,KAmPamB,EAAb,kNAC+BroB,EAAaC,EAAcf,GAD1D,iFAEY+d,EAAI3e,KAAKmoB,QAAUzmB,OACDjB,IAAlBT,KAAKooB,WAA0BrL,cAH3C,gCAIyB2C,YAAgBf,EAAGhd,EAAQb,OAAQa,EAAQge,MAJpE,+DAKqB,IAAIxU,QAAJ,uCAAiB,WAAOvJ,EAASC,GAAhB,SAAAP,EAAA,sEACpB,EAAKkL,MAAMmS,EAAGhd,EAASf,EAASgB,EAASC,GADrB,2CAAjB,yDALrB,wJAAuCqmB,GAW1B8B,EAAb,kNAC+BtoB,EAAaC,EAAcf,GAD1D,qFAEY+d,EAAI3e,KAAKmoB,QAAUzmB,EAF/B,SAGqB,IAAIyJ,QAAJ,uCAAiB,WAAOvJ,EAASC,GAAhB,SAAAP,EAAA,sEACpB,EAAKkL,MAAMmS,EAAGhd,EAASf,EAASgB,EAASC,GADrB,2CAAjB,yDAHrB,wJAAmCqmB,GC3QtB+B,EAAb,oGAEQ/mB,IAAIuM,cAFZ,gCAKQvM,IAAI0M,YALZ,yEAOoB3N,GAPpB,wEAQQiB,IAAI0M,UARZ,SAgBc1M,IAAI4O,QAAQ7P,GAhB1B,+KAkBwBiE,EAAWC,GAlBnC,iFAmBcjD,IAAI6O,cAAc7L,EAAIC,GAnBpC,2G,wBCGI+jB,EAAgE,GAChEC,EAAkE,GAE/D,SAAShZ,IACZ+Y,EAAa,GACbC,EAAe,GA6VfC,EAAW,GA3VXxN,cAqGG,IAAMyN,EAAb,kDAQI,WAAYC,EAAiBvM,EAAiBC,EAAgBH,EAAgBC,EAAeyM,EAAiBC,GAAwB,IAAD,8BACjI,cAAMF,EAAUE,IARZD,YAO6H,IANrIxM,cAMqI,IALrIC,aAKqI,IAJrIH,aAIqI,IAHrIC,YAGqI,IAFrI5X,QAEqI,EAEjI,EAAK6X,SAAWA,EAChB,EAAKC,QAAUA,EACXF,IACA,EAAKD,QAAUA,EACf,EAAKC,OAASA,EACd,EAAK5X,GAAK2X,EAAU,IAAMC,GAE9B,EAAKyM,OAASA,EACd,EAAKC,YAAcA,EAV8G,EARzI,6KAwBcrL,YAAWnf,KAAKkG,GAAIlG,KAAK6d,QAAS7d,KAAK8d,OAAQ9d,KAAK+d,SAAU/d,KAAKge,SAxBjF,8QA8BiC,IAArBhe,KAAKwqB,kBAA6C/pB,IAArBT,KAAKwqB,aAClCJ,EAAWF,EACXO,EAAY,IAAIR,GAGhBG,EAAWD,OAGL1pB,KADNgB,EAAU2oB,EAASpqB,KAAKkG,KArCpC,oBAuCkC,IAA3BkgB,MAAMC,QAAQ5kB,GAvCrB,yCAuCgDA,GAvChD,6BA0CGA,EAAU2oB,EAASpqB,KAAKkG,IAAM,GA1CjC,cA4CMmO,EAAM5S,EA5CZ,kBA6CS,IAAI0J,QAAJ,uCAAY,WAAOvJ,EAASC,GAAhB,yBAAAP,EAAA,yDAClB+S,EAAIjS,KAAK,CAACR,UAASC,WACA,IAAfwS,EAAIrP,OAFU,oDAGdoa,EAAUI,YAAM,EAAKtZ,IAHP,gCAMX,EAAKN,OANM,OAOjBwZ,EAAUI,YAAM,EAAKtZ,IAPJ,OASbxE,GATa,EASC0d,GAAd1d,IAAKrB,EATQ,EASRA,MACV,EAAKA,MAAQA,EACboB,EAAU,IAAIuoB,EAActoB,EAAKrB,EAAOoqB,GACxCL,EAAS,EAAKlkB,IAAMzE,EAZF,cAaH4S,GAbG,IAalB,2BAAoB,QAChBzS,QAAQH,GAdM,0EAAZ,0DA7CT,mQAgFYipB,OAAsBjqB,IAAhBT,KAAKuqB,OACX,GACAvqB,KAAKuqB,OAAOnG,KAAK,KAlF7B,SAmFwBpkB,KAAKC,IAAI,SAAU,CAACyqB,IAAIA,IAnFhD,cAmFYxqB,EAnFZ,yBAoFeA,GApFf,mQAkGeF,KAAKC,IAAI,eAlGxB,oNAqGiB0H,GArGjB,iFAsGqB3H,KAAKC,IAAI,UAAY0H,GAtG1C,0NAyGsBnD,EAAcwT,EAAa4K,GAzGjD,iFA0GqB5iB,KAAKwoB,KAAK,eAAgB,CAAChkB,MAAMA,EAAOwT,KAAKA,EAAM4K,SAASA,IA1GjF,wJAA2B+H,KAmPvBP,EAA0C,GAMvC,IAwBH1hB,EAxBSkiB,EAAb,kDAEI,WAAYhd,GAAgB,IAAD,8BACvB,cAAM,WAAOnN,OAAWA,OAAWA,OAAWA,OAAWA,GAAW,IAFhEmN,YACmB,EAEvB,EAAKA,OAASA,EAFS,EAF/B,qLASwBnN,KADZgB,EAAU2oB,EAASpqB,KAAK4N,SARpC,yCAS0CnM,GAT1C,uBAU6CzB,KAAK6qB,eAVlD,gCAUeT,EAASpqB,KAAK4N,QAV7B,wRAcY6c,EAAY,IAAIR,EAChBa,EAAe,IAAIC,EAAa,WAAOtqB,GAfnD,SAgBwBqqB,EAAaE,QAAQhrB,KAAK4N,QAhBlD,cAgBY1N,EAhBZ,OAiBaG,EAA2BH,EAA3BG,MAAOqd,EAAoBxd,EAApBwd,GAAIhc,EAAgBxB,EAAhBwB,IAAKyc,EAAWje,EAAXie,QACjBG,EAAUnQ,IAAKoQ,aAAab,EAAIhc,EAAKyc,GACzCne,KAAKK,MAAQA,EAnBrB,kBAoBe,IAAI2pB,EAAc1L,EAASje,EAAOoqB,IApBjD,2GAA8BJ,GA0BvB,SAAS1b,EAAajN,GACzBoD,QAAQC,IAAI,kBAAmBrD,GAC/BgH,EAAahH,EAEbupB,OAAgBxqB,EAChByqB,OAAkBzqB,EAGf,IAWHyqB,EACAD,EAZO5L,OAA+B5e,EAEtC0qB,EAAuB,EACpB,SAASjqB,EAAeD,EAAegV,GAC1CkV,EAAgBlqB,EAChBoe,EAAcpJ,EACdnR,QAAQC,IAAI,oBAAqBkR,GACjCgV,OAAgBxqB,EAChByqB,OAAkBzqB,EAcf,IAAeD,EAAtB,mTAOqC,IAArBR,KAAKwqB,kBAA6C/pB,IAArBT,KAAKwqB,iBAftB/pB,IAApByqB,EAAsCA,EACnCA,EAAkB,IAAInB,EAAkBrhB,EAAY2W,EAAa,IAAI4K,QAGtDxpB,IAAlBwqB,EAAoCA,EACjCA,EAAgB,IAAIlB,EAAkBrhB,EAAY2W,IAG7D,2GAA4CsL,KAatCS,EAAe,WAiDRnN,EAAa,IAhD1B,4MACY+D,SAAqBnc,IAAIoP,QAAQrN,IAAIwjB,GADjD,0FAGazqB,GAHb,0GAIakd,EAAmBld,EAAnBkd,QAASC,EAAUnd,EAAVmd,OACVuN,EAAKxN,EAAQ,IAAIC,EACjBwN,EAAatrB,KAAKgiB,SAAS9M,MAAMmW,GAN7C,cAS4B5qB,KADZ2e,EAAkBkM,EAAWrrB,SAExBM,GADmB,EACL6e,GAAd7e,KAAMoJ,EADY,EACZA,KACPpJ,IAASI,EAAOJ,MAAQoJ,IAASwhB,IACjCG,EAAW1e,SACXwS,OAAU3e,IAGd8qB,EAAUzH,KAAKC,MAAMnf,KAAKC,MAAQ,UACtBpE,IAAZ2e,EAjBhB,oBAkBqBza,GAlBrB,EAkBoCya,GAAfza,YACSlE,KADHgX,EAlB3B,EAkB2BA,QACiB8T,EAAU5mB,EAAQ,OAnB9D,0CAoB2B2L,IAAEgN,MAAM7F,IApBnC,eAuBgB+T,EAAkBlb,IAAEgN,MAAM3c,IAClB6G,QAAU2G,IAAK3G,QAxBvC,UAyB4BxH,KAAKC,IAAI,SAAUurB,GAzB/C,gBA0BwB/qB,KADRP,EAzBhB,+BA2BqBK,EAAyBI,EAAzBJ,KAAMsd,EAAmBld,EAAnBkd,QAASC,EAAUnd,EAAVmd,OA3BpC,iCA4BoDvd,EA5BpD,cA4B8Dsd,EA5B9D,YA4ByEC,EA5BzE,qDAgCYsB,EAAU,CACN7e,KAAMI,EAAOJ,KACboJ,KAAMwhB,EACNxmB,KAAM4mB,EACN9T,MAAOvX,GAEXorB,EAAW5lB,IAAI0Z,GAtC3B,kBAuCmB9O,IAAEgN,MAAMpd,IAvC3B,wCA0CYorB,EAAW1e,SA1CvB,2HAAgCpM,GAgDN,CAAe,eAAWC,GAOvCqf,EAAgB,IAL7B,yKACepe,EAAYZ,EAAe6e,GAClC,OAAO3f,KAAKyrB,KAAK/pB,EAAKZ,EAAQ6e,OAFtC,GAAmCnf,GAKN,CAAkB,QAAIC,GA4BtCsqB,EAAb,2MAGchN,EAAiBC,GAH/B,uFAIkChe,KAAKC,IAAI,cAAe,CAAC8d,SAASA,EAAUC,QAAQA,IAJtF,cAIY9d,EAJZ,yBAKeA,GALf,gLAwB0B6d,EAAiBC,GAxB3C,iFAyBqBhe,KAAKC,IAAI,cAAe,CAAC8d,SAASA,EAAUC,QAAQA,IAzBzE,wNAiDkBzd,GAjDlB,iFAkDqBP,KAAKC,IAAI,eAAgB,CAACM,KAAKA,IAlDpD,6NAoDyB8W,GApDzB,iFAqDqBrX,KAAKwoB,KAAK,sBAAuBnR,GArDtD,oJAAkC7W,GAyD3B,SAAekrB,EAAtB,oC,4CAAO,WAA0B3N,EAAiBC,GAA3C,iBAAA1c,EAAA,6DACCwpB,EAAe,IAAIC,EAAa,WAAOtqB,GADxC,SAGaqqB,EAAaa,IAAI5N,EAAUC,GAHxC,cAGC9d,EAHD,yBAaIA,GAbJ,4C,sBA6BA,IAuDM4Q,EAAU,IAvDvB,6MACgBnQ,GADhB,+FAGwBX,KAAKC,IAAI,aAAcU,GAH/C,OAGYT,EAHZ,mBAIuBA,EAJvB,OAMiB,WANjB,OAOiB,WAPjB,gFAMkC0rB,YAAgB1rB,IANlD,cAQoBG,EAAQH,EAAIG,MACZsJ,EAAOiiB,YAAgBvrB,GACtB4Q,EAAc/Q,EAAd+Q,KAAMD,EAAQ9Q,EAAR8Q,KACPC,IAAMtH,EAAKsH,KAAOA,GAClBD,IAAMrH,EAAKqH,KAAOA,GAZtC,kBAauBrH,GAbvB,gLAiBmBhJ,GAjBnB,iFAmBqBX,KAAKwoB,KAAK,gBAAiB7nB,GAnBhD,yNAsBqBkrB,EAAgBrpB,EAAuByR,GAtB5D,iFAuBqBjU,KAAKwoB,KAAK,kBAAmB,CAACqD,QAAQA,EAASrpB,KAAKA,EAAMyR,IAAIA,IAvBnF,8NA0BsB4X,EAAgBC,GA1BtC,iFA2BqB9rB,KAAKwoB,KAAK,oBAAqB,CAACqD,QAAQA,EAASC,OAAOA,IA3B7E,yNA8BmBD,GA9BnB,iFA+BqB7rB,KAAKC,IAAI,iBAAkB,CAAC4rB,QAAQA,IA/BzD,4NAkCwBA,EAAgBE,EAAiBD,EAAetpB,GAlCxE,iFAmCqBxC,KAAKwoB,KAAK,sBAAuB,CAACqD,QAAQA,EAASE,WAAUD,SAAQtpB,SAnC1F,gOAsCsBkT,EAAa+B,GAtCnC,iFAuCczX,KAAKwoB,KAAK,oBAAqB,CAAC9S,KAAKA,EAAM+B,MAAMA,IAvC/D,8PA2CqBzX,KAAKC,IAAI,UA3C9B,kNA8CewN,GA9Cf,iFA+CqBzN,KAAKC,IAAI,WAAY,CAACwN,GAAGA,IA/C9C,sNAkDe9G,GAlDf,iFAmDe3G,KAAKC,IAAI,oBAAqB,CAAC0G,QAnD9C,oJAA6BnG,GAuDN,CAAY,WAAOC,I,6BCxpB1C,uqD,8BCAA,+LAUa0L,EAKT,CACHD,UAAMzL,EACNwW,WAAOxW,EACP2L,cAAU3L,EACVyW,eAAWzW,GA2BL,SAASurB,EAA+Brf,GAAe,IACrDT,EAAkBC,EAAlBD,KAAME,EAAYD,EAAZC,SACPlM,EAAQ,GACZ,QAAYO,IAARkM,EAAmB,OAAOzM,EAC9BoQ,IAAEC,MAAMrQ,EAAKyM,EAAI2D,GACjB,IAAI6G,EAAIxK,EAAIT,GACZ,QAAUzL,IAAN0W,EAAiB,OAAOjX,EAC5BoQ,IAAEC,MAAMrQ,EAAKiX,EAAE7G,GACf,IAAIiF,EAAI4B,EAAE/K,GACV,QAAU3L,IAAN8U,EAAiB,OAAOrV,EAC5BoQ,IAAEC,MAAMrQ,EAAKqV,GAV4C,IAWpDkR,EAAUvmB,EAAVumB,OACL,QAAehmB,IAAXgmB,EACA,IAAK,IAAItkB,KAAKskB,EACVA,EAAOtkB,EAAE6L,eAAiByY,EAAOtkB,GAGzC,OAAOjC,GAlCV,WACG,IAAIgM,EAAcE,EACd9D,EAAYvE,UAAUkoB,WAAaloB,UAAUkoB,UAAU,IACpDloB,UAAUuE,SAEjB,GAAKA,EAIA,CACD,IAAIqV,EAAQrV,EAASsV,MAAM,KAC3B1R,EAAOyR,EAAM,GACTA,EAAM3Y,OAAS,IAAGoH,EAAWuR,EAAM,GAAGuO,oBAN1ChgB,EAAO,KACPE,EAAW,MAdZ,SAAuBF,EAAaE,GAC1CD,EAAWD,KAAOA,EAClBC,EAAW8K,MAAQ,IAAM/K,EACtBC,EAAWC,SAAWA,EACtBD,EAAW+K,UAAY,IAAM9K,EAiB7B+f,CAAcjgB,EAAME,GAdvB,GAqCD,IAAMggB,EAAgB,GACf,SAASC,EAAO1R,EAAahO,GACnC,QAAYlM,IAARkM,EAAJ,CAD+D,IAE1DsK,EAAoB9K,EAApB8K,MAAOC,EAAa/K,EAAb+K,UAEZ,GADA5G,IAAEC,MAAMoK,EAAQhO,QACFlM,IAAVwW,EAAqB,CACxB,IAAIE,EAAIxK,EAAIsK,GACZ,QAAUxW,IAAN0W,EAAiB,CACpB7G,IAAEC,MAAMoK,EAAQxD,GAChB,IAAI5B,EAAI4B,EAAED,QACAzW,IAAN8U,GACHjF,IAAEC,MAAMoK,EAAQpF,IAInB,OAAO,SAASoB,GACf,OAAOgE,EAAOhE,IAAQA,IAGjB,SAAS2V,EAAa3f,GAC5B0f,EAAOD,EAAWzf,GAEZ,SAASsJ,EAAEU,GACjB,OAAOyV,EAAUzV,IAAQA,I,8BCzF1B,sCAAM4V,EAAW,iEAGV,SAAS3N,IAGZ,IAFA,IAAI3Z,EAAMsnB,EAASvnB,OACfwnB,EAAM,GACDrqB,EAAI,EAAGA,EALF,EAKiBA,IAC3BqqB,GAAOD,EAASE,OAAO3I,KAAKC,MAAMD,KAAK4I,SAAWznB,IAEtD,OAAOunB,I,kOCyLEG,GAzLkCC,IAyL/C,6HAhGA,8MAEY7E,eAFZ,IAGYC,cAHZ,IAIYrnB,YAJZ,IAKYksB,UALZ,IAMYC,gBANZ,2CAQIjL,aARJ,IASIkL,aATJ,0DAWczL,GACN,iEAAgBA,GADE,IAEbO,EAAWP,EAAXO,QAEL7hB,KAAK+sB,QAAUlL,QAAgEphB,IAApDohB,EAAkBza,MAAK,SAAAC,GAAC,MAAe,UAAXA,EAAEM,UAfjE,gCAkBcqlB,EAAarsB,GACnBX,KAAK+nB,eAAYtnB,EACjBT,KAAKgoB,SAAWgF,EAChBhtB,KAAKW,OAASA,EACdX,KAAK6sB,MAAO,EACZ7sB,KAAKimB,UAAOxlB,IAvBpB,iKA2B8BA,IAAlBT,KAAKgoB,SA3BjB,sBA4BkB,IAAIpZ,MAAM,iDA5B5B,eA+B+BnO,IAAnBT,KAAK+nB,UA/BjB,sBAgCoB/nB,KAAK8sB,WAAWtqB,KAhCpC,OAkCqB,SAlCrB,MAmCqB,SAnCrB,MAoCqB,aApCrB,6BAiCyBulB,EAAY/nB,KAAK+nB,UAjC1C,mCAoCiCA,EAAa/nB,KAAK+nB,UAAmB9U,UApCtE,8CAuCkBjT,KAAKgY,KAAKhY,KAAKW,OAAQonB,EAAW/nB,KAAKgoB,SAAS,GAvClE,QAuCM9nB,EAvCN,OAwCM8X,EAAQ9X,EAAY+sB,MAOlBjtB,KAAKimB,KAAO/R,IAAWgZ,MAAM,GAAI,CAACC,MAAM,SAC3B1sB,IAATuX,IACIA,EAAKhT,OAAShF,KAAKgoB,UACnBhoB,KAAK6sB,MAAO,EACZ7U,EAAKzS,MACDrF,EAAMF,KAAK6hB,QAAQza,MAAK,SAAAmM,GAAC,MAAe,UAAXA,EAAE5L,QACnC3H,KAAK8sB,WAAa5sB,EAAIyhB,OAAO,GAC7B3hB,KAAK+nB,UAAY/P,EAAKA,EAAKhT,OAAO,GAAGhF,KAAK8sB,WAAWnlB,OAGrD3H,KAAK6sB,MAAO,GAEhB,EAAA7sB,KAAKimB,MAAK7jB,KAAV,oBAAkB4V,KA3D9B,wIAgEyBrX,GAA4D,IAA/C6pB,IAA8C,yDAC5E,OAAO,IAAI1C,IAAgB9nB,KAAMW,EAAQ6pB,KAjEjD,oEAoEe7pB,EAAUonB,EAAeC,GApExC,8FAoEyDwC,IApEzD,iCAqEYvjB,EAAI,CAAC8gB,YAAWC,WAAUrnB,UArEtC,SAsEwBX,KAAKotB,WAAWnmB,EAAGujB,GAAa6C,UAtExD,cAsEY1gB,EAtEZ,yBAuEeA,GAvEf,6IAyE0BhM,GAA2D,IAAhD6pB,IAA+C,yDAC5E,OAAO,IAAI7C,IAAiB3nB,KAAMW,EAAQ6pB,KA1ElD,qEA4EgB7pB,GA5EhB,4FA4E0B6pB,IA5E1B,0CA6EwBxqB,KAAKstB,YAAY3sB,EAAQ6pB,GAAa6C,UA7E9D,cA6EY1gB,EA7EZ,yBA8EeA,GA9Ef,4KAgFgBhM,GAhFhB,8FAgF0B6pB,IAhF1B,0CAiFwBxqB,KAAKutB,MAAM5sB,EAAQ6pB,GAjF3C,OAiFYtqB,EAjFZ,qBAkFsBA,GAlFtB,qDAkFiBiC,EAlFjB,6BAmFoBjC,EAAYiC,IAnFhC,2KAsFcxB,GAtFd,4FAsFwB6pB,IAtFxB,0CAuFwBxqB,KAAKwtB,MAAM7sB,EAAQ6pB,GAvF3C,aAuFYtqB,EAvFZ,QAwFgB8E,OAAS,GAxFzB,yCAwFmC9E,EAAI,IAxFvC,6KA0FiBS,GA1FjB,8FA0F2B6pB,IA1F3B,0CA2FwBxqB,KAAKyV,IAAI9U,EAAQ6pB,GA3FzC,OA2FYtqB,EA3FZ,qBA4FsBA,GA5FtB,qDA4FiBiC,EA5FjB,6BA4FkCjC,EAAIiC,IA5FtC,uIAC6B,MAAO,UADpC,8BAyBmB,OAAOnC,KAAK6sB,SAzB/B,GAAmC1L,KAAnC,kCAOKjN,KAPL,oE,qGChGIuZ,E,2DACJ,SAASC,EAAelqB,QACC/C,IAAjBgtB,GACJA,EAAapoB,YAAY,CACrB7C,KAAM,KACNgB,IAAKA,GACN,KAGA,SAAS2Z,EAAgBwQ,GAC5BF,EAAeE,EAUZ,IAAeC,EAAtB,iDACSvhB,WAAaA,IADtB,6FAwBkB7I,GAxBlB,iEAyBExD,KAAKqM,WAAWC,SAAS9I,GAzB3B,8GAwCIqqB,EAAa,EAOJ1sB,GAFW,IAJxB,4MACI2sB,SAAkB,iBAAmBD,IADzC,YAA8BD,IAM9B,kDAOI,WAAY3lB,EAAgB5H,GAAgB,IAAD,8BACvC,gBAPJytB,SAAkB,kBAAoBD,IAMK,EAJnC5lB,YAImC,IAHnC5H,WAGmC,IAFnCmO,QAEmC,EAEvC,EAAKvG,OAASA,EACd,EAAK5H,MAAQA,EAH0B,EAP/C,sDAiB6B,IAAD,OAGpB,QAAgBI,IAAZT,KAAKwO,GAAT,CACA,IAAI8a,EAAOtpB,KACX,OAAO,IAAImL,SAAQ,SAACvJ,EAASC,GACzB,IAAI2M,EAAK,IAAIuf,UAAU,EAAK9lB,OAAQ,EAAK5H,OAASc,EAAUke,aAC5Dva,QAAQC,IAAI,uBAAwB,EAAKkD,QACzCuG,EAAGwf,OAAS,SAAC9kB,GACTpE,QAAQC,IAAI,yBAA0B,EAAKkD,QAC3CqhB,EAAK9a,GAAKA,EACV5M,KAEJ4M,EAAGa,QAAU,SAACnG,GACVrH,EAAO,0BAEX2M,EAAGyf,UAAH,uCAAe,WAAOzqB,GAAP,SAAAlC,EAAA,sEAAqBgoB,EAAK4E,UAAU1qB,GAApC,mFAAf,sDACAgL,EAAG2f,QAAU,SAACjlB,GACVogB,EAAK9a,QAAK/N,EACVqE,QAAQC,IAAI,4BApC5B,mCAyCwBtE,IAAZT,KAAKwO,KACLxO,KAAKwO,GAAGzM,QACR/B,KAAKwO,QAAK/N,KA3CtB,yEA8C4BoI,GA9C5B,uFAgDY/D,QAAQC,IAAI,wBAAyB8D,EAAMoU,MAE3CyQ,EADIlqB,EAAM0J,KAAKC,MAAMtE,EAAMoU,OAjDvC,SAmDkBjd,KAAKouB,QAAQ5qB,GAnD/B,uDAsDYsB,QAAQC,IAAI,iBAAZ,MAtDZ,6IAyDWvB,GACH,IAAI6qB,EAAUruB,KACdA,KAAKsuB,UAAU5E,MAAK,WAChB2E,EAAQ7f,GAAG+f,KAAK/qB,SA5D5B,sCAa0BnD,GAClBc,EAAUke,YAAchf,MAdhC,GAA+ButB,IAAlBzsB,EAEFke,iB,6GC3DJ,SAASmP,EAAMjtB,GAAoB,IAErCyP,EADCzO,EAAmChB,EAAnCgB,UAAWF,EAAwBd,EAAxBc,MAAOwQ,EAAiBtR,EAAjBsR,IAAK4b,EAAYltB,EAAZktB,SAEzB,GAAI5b,EAAK,CACX,GAAyB,IAArBA,EAAIQ,QAAQ,KAIf,OAH4B,IAAxBR,EAAIqM,WAAW,OAClBrM,EAAM3P,IAAIsF,OAASqK,EAAI3E,OAAO,IAExB,qBAAK2E,IAAKA,EAAKtQ,UAAWA,EAAWmsB,IAAI,MAC/CrsB,MAAOA,EACPyP,QAAS,SAAA2I,GACMA,EAAIkU,cAAc9b,IAA5B4b,GACyB,6CAGhCzd,EAAO6B,EAAI3E,OAAO,QAGlB8C,EAAO,SAER,OAAO,sBAAMzO,UAAW+V,IAAW/V,EAAW,cAAeF,MAAOA,EAA7D,SACN,mBAAGE,UAAW,SAAWyO,Q,6BCjC3B,yFAoBO,SAAS4a,EAAgBvrB,GAC5B,IAAIH,EAAU0uB,IAAUvuB,GAOxB,MANiB,CACboN,GAAIvN,EAAIuN,GACR9F,KAAMzH,EAAIyH,KACVvH,MAAOF,EAAIE,MACXC,MAAOA,GAKR,SAASF,EAAiBE,GAO7B,MALmB,CACfoN,GAAI,EACJrN,MAHUwuB,IAAUvuB,GAGTD,MACXC,MAAOA,K,0JClCTqI,EAAa2E,4BAEboB,EAAUpB,sLAAA,oBAAqC3E,EAE/CmmB,EAAc,iBAMdC,EAAkC,CACpCC,WAAY,CACRtX,MAAOpK,sLAAA,6BAXS,iBAYtBnF,OAAO,GAEL8mB,QAAS,CACLvX,MAAOpK,sLAAA,0BAbM,iBAcnBnF,OAAO,GAEL+mB,OAAQ,CACJxX,MAAOpK,sLAAA,yBAA0CwhB,EACvD3mB,OAAO,GAELgnB,UAAW,CACPzX,MAAOpK,sLAAA,yBAA0CwhB,EACvD3mB,OAAO,GAEL,WAAY,CACRuP,MAAOpK,sLAAA,iCAvBY,iBAwBzBnF,OAAO,IAIHinB,EAAU,CAAC,WAAY,WAQ7B,SAASC,EAAYjhB,GACjB,OAA4B,IARhC,SAAuBzM,GAAqB,IAAD,gBACvBytB,GADuB,IACvC,2BAAyB,CAAC,IAAjBxY,EAAgB,QACrB,IAA4B,IAAxBjV,EAAIwd,WAAWvI,GAAe,OAAO,GAFN,8BAIvC,OAAO,EAIH0Y,CAAclhB,GACVA,EAAKF,SAAS,KAAaE,EACxBA,EAAO,IAEZ,UAAN,OAAiBA,EAAjB,KAGJ,SAASmhB,EAAkBnhB,GACvB,OAAOihB,EAAYjhB,GAEvB,SAASohB,EAAiBphB,GACtB,IAAIqhB,EAAQ,WACZ,OAA+B,IAA3BrhB,EAAK+Q,WAAWsQ,KAEW,KAD3BrhB,EAAOA,EAAKD,OAAOshB,EAAMxqB,SAChBiJ,SAAS,OAAeE,EAAOA,EAAKD,OAAO,EAAGC,EAAKnJ,OAAO,IAC5D,SAAWmJ,EAAO,QAEvB,QAAN,OAAeA,EAAf,QAEG,SAASO,EAAeP,GAC9B,GAAKA,EAEF,OADUihB,EAAYjhB,GACT,OAGjB,IAAMshB,EAAe,CACjB3uB,OAAQ,MACR4uB,KAAM,UACN9G,QAAS,CACL,eAAgB,eAkHXza,EAAY,I,iDA7GrB3G,a,OACA9F,S,OACA8M,Q,OACAC,a,6FAEYjH,G,0EAERxH,KAAKwH,QAAUA,GACW,IAAtB3B,IAAI2H,c,gCACExN,KAAK2vB,W,OAEXxhB,EAAOnO,KAAK4vB,gBAChB5vB,KAAK0B,IAAM4tB,EAAkBnhB,GAC7BnO,KAAKwO,GAAK+gB,EAAiBphB,GACjCnO,KAAKyO,QAAUzO,KAAK6vB,a,0IAGG1hB,GAAc,MAAM,UAAN,OAAiBA,EAAjB,Y,6KAI/B,IAAShM,KAFL2tB,EAA8B,GAC9BC,EAAmB,G,WACd5tB,GACL,IACKsV,EADWqX,EAAM3sB,GACjBsV,MACDsY,EAAQC,WAAU,SAAA3oB,GAAC,OAAIA,IAAMoQ,KAAS,GAAGsY,EAAQ3tB,KAAKqV,IAHhDqX,EAAQ,EAAb3sB,GAMT,UAAiB4tB,EAAjB,eAAS5hB,EAAiB,KAClB8hB,EAAWjwB,KAAKkwB,aAAa/hB,GACjC2hB,EAAS1tB,KAAK+tB,EAAWF,I,gBAET9kB,QAAQilB,IAAIN,G,OAEhC,IAFIO,E,OACAprB,EAAM8qB,EAAQ/qB,OACT7C,EAAE,EAAGA,EAAE8C,EAAK9C,IAGjB,IAASmuB,KAFLpoB,EAAQmoB,EAAQluB,GAChBgM,EAAO4hB,EAAQ5tB,GACL2sB,GACNyB,EAAYzB,EAAMwB,IACR7Y,QAAUtJ,IACpBoiB,EAAUroB,MAAQA,G,6IAMF,IAAD,EACN4mB,EAAMC,WAAtBtX,EADsB,EACtBA,MAAOvP,EADe,EACfA,MAEZ,OAAqC,IAD1BuD,SAASC,SAAS0C,KACpBsE,SAAS,iBAGQ,IAAtB7M,IAAI2H,gBACU,IAAVtF,EAHGuP,EAKJ/O,I,mCAGkB,IAAD,EACHomB,EAAME,QAAtBvX,EADmB,EACnBA,MAAOvP,EADY,EACZA,MAEZ,OAAqC,IAD1BuD,SAASC,SAAS0C,KACpBsE,SAAS,iBAGQ,IAAtB7M,IAAI2H,gBACU,IAAVtF,EAHGuP,EAKJhJ,I,oCAGG/M,GAAiD,IAArC8uB,EAAoC,uDAAjB,SACzC,IAA0B,IAAtB3qB,IAAI2H,cAAyB,OAAO9L,EACxC,IAAIyM,EAAO2gB,EAAM0B,GACjB,QAAa/vB,IAAT0N,EAAoB,OAAOzM,EAH2B,IAIrD+V,EAAgBtJ,EAAhBsJ,MAAOvP,EAASiG,EAATjG,MACZ,OAAc,IAAVA,EAAwBxG,EACtB,UAAN,OAAiB+V,EAAjB,O,mCAESiG,EAAWhc,EAAYyc,GACtC,IAAI0K,EAuBE,OAtBD1K,EAOKzc,IACTA,EAAMyc,EACNne,KAAKwH,SAAU,IARf2W,EAAUzc,IAEToD,QAAQ7C,MAAM,qBAAuByb,IAQZ,IAAjB1d,KAAKwH,SACW,MAAZ2W,IAAiBzc,EAAMyc,GAC3B0K,EAAO,WAAanL,EAAK,KAGzBmL,EAAO,WAAanL,EAAK,KAGT,KAD1Bhc,EAAM1B,KAAKywB,cAAc/uB,IACjBuM,SAAS,OAChBvM,GAAO,KAEKA,EAAMmnB,I,0EAGA6H,G,iFACAP,EAAWO,G,kJAchC,SAASC,EAAgBjvB,GACrB,OAAO,IAAIyJ,SAAQ,SAACvJ,EAASC,GAC3B2K,MAAM9K,EAAK+tB,GACV/F,MAAK,SAAAriB,GACFA,EAAEiM,OAAOoW,KAAK9nB,GAASioB,MAAMhoB,MAEhCgoB,MAAMhoB,GACP,IAAMkT,EAAI,IAAInG,MAAM,wBACpB/I,IAAIC,WAAW,kBAAmBjE,EAVxB,IAUyCkT,M,SAI1Cob,E,8EAAf,WAA0BzuB,GAA1B,SAAAJ,EAAA,+EAEQqvB,EAAgBjvB,GAFxB,iCAGe,GAHf,0DAMe,GANf,yD,qDCjNA,sN,+KCIakvB,EAAb,WAEI,WAAY/jB,GAAsB,yBAD1BA,QACyB,EAC7B7M,KAAK6M,GAAKA,EAHlB,0DAMwB,IAAD,OACf/G,YAAW,kBAAM,EAAK+G,GAAGgkB,SAAS,EAAG,KARzB,MACpB,uCAS2B,IAAD,OAClB/qB,YAAW,kBAAM,EAAK+G,GAAGgkB,SAAS,EAAG,EAAKhkB,GAAGikB,UAAY,EAAKjkB,GAAGkkB,gBAXrD,QACpB,KAwBMC,EAAgB,IACPC,E,4MACHC,WAAoB,E,EACvBC,QAAiB,E,EACjBC,S,IAEEC,OAAS,SAACD,GACdA,GAML,EAAKA,IAAMA,EACX,EAAKA,IAAIzrB,iBAAiB,SAAU,EAAK2rB,WANpC,EAAKF,KACR,EAAKA,IAAIG,oBAAoB,SAAU,EAAKD,W,EAQvCA,SAAW,SAACpoB,GACnBpE,QAAQ7C,MAAM,e,EAGF8X,S,uCAAW,WAAOhF,GAAP,6BAAAzT,EAAA,wDAC6B,EAAKC,MAA9CwY,EADY,EACZA,SAAUE,EADE,EACFA,YAAaG,EADX,EACWA,eACxBL,GAAUA,EAAShF,GACnBlI,EAAKkI,EAAE4F,OACPT,EAAW,IAAI0W,EAAS/jB,GACxBA,EAAGikB,UAAY,SACKrwB,IAAhBwZ,IACIkX,GAAU,IAAIvsB,MAAOqO,WACb,EAAKke,QAAUH,IACvB,EAAKG,QAAUA,EAC9BlX,EAAYC,GAAUwP,MAAK,SAAAxpB,GAE1B,IAAY,IAARA,EAAc,CACjB,IAAIsxB,EAAK3kB,EAAG4kB,aACRrsB,EAAM,IACNA,EAAMosB,IAAIpsB,EAAMosB,GACpB3kB,EAAGikB,UAAY1rB,OAMVyH,EAAGikB,UAAYjkB,EAAGkkB,aAAelkB,EAAG4kB,aAAe,SAE5BhxB,IAAnB2Z,IACI8W,GAAa,IAAItsB,MAAOqO,WACX,EAAKie,WAAaF,IAC/B,EAAKE,WAAaA,EAClB9W,EAAeF,IA5BV,2C,8GAiCH2K,EAAO6M,GAAwB,IAAD,OACtCnwB,EAAUsjB,EAAVtjB,MACN,QAAcd,IAAVc,EAAJ,CAF4C,IAItCib,EAAajb,EAAbib,cACW/b,IAAb+b,GAEJ9Z,IAAMivB,SAASrc,QAAQkH,GAAU,SAACtH,EAAOrN,GAAW,IAC3C+pB,EAAY1c,EAAZ0c,SACDA,GAAUA,EAASF,GACvB5sB,QAAQC,IAAImQ,EAAM2c,YAClB,EAAKC,UAAU5c,EAAOwc,W,GAhE+BhvB,IAAMqvB,WAqE1DC,EAAb,uKACc,IAAD,EACchyB,KAAKuB,MAAzBgB,EADM,EACNA,UAAWF,EADL,EACKA,MAChB,OAAO,qBAAK4vB,IAAKjyB,KAAKqxB,OAAQ9uB,UAAU,UACvCwX,SAAU/Z,KAAK+Z,SAAU1X,MAAOA,EAD1B,SAEN,yBAASE,UAAWA,EAApB,SACEvC,KAAKuB,MAAMib,iBANhB,GAAgCyU,GAuBnBiB,EAAb,uKACc,IAGRC,EAAaC,EAHN,EACsBpyB,KAAKuB,MAAjCgB,EADM,EACNA,UAAWF,EADL,EACKA,MAAO2U,EADZ,EACYA,OAClBqb,EAAoDrb,EAApDqb,UAAWC,EAAyCtb,EAAzCsb,aAAcC,EAA2Bvb,EAA3Bub,UAAWC,EAAgBxb,EAAhBwb,aAOzC,OALIF,EAAcH,EAAUG,EACnBD,IAAWF,EAAU,iCAAQ,+BAAOE,OACzCG,EAAcJ,EAAUI,EACnBD,IAAWH,EAAU,iCAAQ,+BAAOG,OAEtC,sBAAKN,IAAKjyB,KAAKqxB,OAAQ9uB,UAAU,iBACvCwX,SAAU/Z,KAAK+Z,SAAU1X,MAAOA,EAD1B,UAEL8vB,EACD,yBAAS5vB,UAAWA,EAApB,SACEvC,KAAKuB,MAAMib,WAEZ4V,SAhBJ,GAAsCnB,I,wKCvGzBwB,EAAb,4HAfA,8MAEiBxV,GAFjB,8HAGMyL,EAAS,IAAIgK,EAAmB1yB,KAAMid,GAH5C,SAIkByL,EAAO2E,UAJzB,cAIMntB,EAJN,yBAKSA,GALT,oLAOwB+c,GAPxB,iFAQoB,IAAI0V,EAAoB3yB,KAAMid,GAAMoQ,UARxD,4NAUwBpQ,GAVxB,iFAWqB,IAAI2V,EAAoB5yB,KAAMid,GAAMoQ,UAXzD,8KAC6B,MAAO,aADpC,GAAoClM,MAkBvBuR,EAAb,4KAGE,MAAO,CAACzV,KAAMjd,KAAKymB,OAAOoM,KAAK7yB,KAAKW,WAHtC,2BACuB,MAAO,UAAYX,KAAKymB,OAAO9e,SADtD,GAAwC+f,KAOlCiL,E,sKAEMhmB,GAIJ,IAJkB,IACbkV,EAAW7hB,KAAKymB,OAAhB5E,QACD5c,EAAM4c,EAAQ7c,OACd9E,EAAyB,GACpBiC,EAAE,EAAGA,EAAE8C,EAAK9C,IAAK,CAEtBjC,EADgB2hB,EAAQ1f,GACVwF,MAAQgF,EAAIxK,GAE9B,OAAOjC,I,2BATQ,MAAO,UAAYF,KAAKymB,OAAO9e,KAAO,e,GAD3B+qB,GAc5BE,E,4KAGE,MAAO,CACH3V,KAAMjd,KAAKW,U,2BAHA,MAAO,kBAAoBX,KAAKymB,OAAO9e,S,GAD5B+qB,I,gPC3BrBI,G,OADZvX,YACD,yKACc,IAUFwX,EAVC,EACsE/yB,KAAKuB,MAA3EgB,EADA,EACAA,UAAWywB,EADX,EACWA,MAAOhG,EADlB,EACkBA,KAAMiG,EADxB,EACwBA,MAAOC,EAD/B,EAC+BA,WAAYC,EAD3C,EAC2CA,cAAe3W,EAD1D,EAC0DA,SAC3D4W,EAAK9a,IACL/V,EACA,WACAyqB,GAAQ,YAAYA,EACpB,aAAeiG,GAAO,aACtBC,GAAc,WAAWA,EACzBC,GAAiB,WAAWA,GAIhC,OADIH,IAAOD,EAAI,4BAAIC,KACZ,sBAAKzwB,UAAW6wB,EAAhB,UACF5W,EACAuW,SAfb,GAA2BrwB,eAA3B,GCFa2wB,G,OADZ9X,YACD,yKACc,IAEFpE,EAAG5D,EAGH+f,EALC,EAC6CtzB,KAAKuB,MAAlDgB,EADA,EACAA,UAAWkF,EADX,EACWA,KAAM+U,EADjB,EACiBA,SAAU3C,EAD3B,EAC2BA,MAAOpX,EADlC,EACkCA,QAMvC,YAJahC,IAATgH,IAAoB0P,EAAI,iCAAS1P,UACvBhH,IAAVoZ,IAAqBtG,EAAI,iCAASsG,UAEtBpZ,IAAZgC,IAAuB6wB,EAAS,kBAC7B,sBAAK/wB,UAAW+V,IAAW,SAAU/V,EAAW+wB,GAAS7wB,QAASA,EAAlE,UACF0U,EACD,8BAAMqF,IACLjJ,SAXb,GAAyB7Q,eAAzB,GCIa6wB,EAAb,uKACc,IAAD,EACqFvzB,KAAKuB,MAA1FoG,EADA,EACAA,KAAMpF,EADN,EACMA,UAAWyqB,EADjB,EACiBA,KAAMwG,EADvB,EACuBA,KAAMC,EAD7B,EAC6BA,SAAUC,EADvC,EACuCA,OAAQC,EAD/C,EAC+CA,KAAMC,EADrD,EACqDA,MAAOC,EAD5D,EAC4DA,OAAQC,EADpE,EACoEA,KAAMC,EAD1E,EAC0EA,QAC3EX,EAAK9a,IAAW/V,EAAW,KAC3BoF,GAAS,MAAQA,EACjBqlB,GAAQ,MAAMA,EACdyG,GAAY,QACZC,GAAU,YACVC,GAAQ,WAAaA,EACrBH,GAAQ,UACRI,GAAS,WACTC,GAAU,aAAeA,EACzBC,GAAQ,WAAaA,EACrBC,GAAW,cAEf,OAAO,mBAAGxxB,UAAW6wB,QAf7B,GAAwB1wB,aCdXsxB,GDqCkBtxB,YE9BDA,YDPT,SAACnB,GAAD,OACrB,uBAAOgB,UAAW+V,IAAW,aAAc/W,EAAMgB,WAAYF,MAAOd,EAAMc,MAA1E,SACKd,EAAMib,c,wHESLyX,EAAO,I,gGAXDttB,GACJ,OAAOsF,aAAaioB,QAAQvtB,K,8BAExBA,EAAY8Q,GAChBxL,aAAa6I,QAAQnO,EAAK8Q,K,iCAEnB9Q,GACPsF,aAAakoB,WAAWxtB,O,MAMnBytB,EAAb,WAKI,WAAYlsB,EAAavB,GAAoB,yBAJ5BuB,WAI2B,OAFnCvB,SAEmC,EACxC3G,KAAKkI,MAAQA,EACblI,KAAK2G,IAAMA,EAPnB,kDAUQ,IAGI,IAAI2M,EAAOtT,KAAKkI,MAAMgsB,QAAQl0B,KAAK2G,KACnC,GAAa,OAAT2M,EAAe,OACnB,QAAa7S,IAAT6S,EAAoB,OAExB,OAAOpG,KAAKC,MAAMmG,GAEtB,MAAOpR,GAEH,YADAlC,KAAKkI,MAAMisB,WAAWn0B,KAAK2G,QApBvC,0BAwBQ8Q,GACN,IAAIxB,EAAI/I,KAAKkE,UAAUqG,GAAO,SAAC9Q,EAAK8Q,GACnC,GAAY,UAAR9Q,EAAiB,OAAO8Q,KAE7BzX,KAAKkI,MAAM4M,QAAQ9U,KAAK2G,IAAKsP,KA5B/B,6BA8BW/N,QACWzH,IAAVyH,EACAlI,KAAKkI,MAAMisB,WAAWn0B,KAAK2G,KAG3B3G,KAAKkI,MAAMmsB,YAAYnsB,KAnCnC,4BAsCUvB,GACF,OAAO3G,KAAKkI,MAAMgN,MAAMvO,KAvChC,0BAyCQA,GACA,OAAO3G,KAAKkI,MAAMmM,IAAI1N,KA1C9B,0BA4CQA,GACA,OAAO3G,KAAKkI,MAAMN,IAAIjB,OA7C9B,KAiDe2tB,E,WAIX,WAAY3sB,GAAe,yBAHV4sB,YAGS,OAFTC,YAES,OADP7sB,UACO,EACtB3H,KAAK2H,KAAOA,EACZ3H,KAAKu0B,OAAS,GACdv0B,KAAKw0B,OAAS,G,oDAOV7tB,GACJ,IAAIsiB,EAAIjpB,KAAKy0B,UAAU9tB,GACvB,QAAUlG,IAANwoB,EACJ,OAAOgL,EAAKC,QAAQjL,K,8BAEhBtiB,EAAmB8Q,GACvB,IAAIwR,EAAIjpB,KAAK00B,UAAU/tB,GACvBstB,EAAKnf,QAAQmU,EAAGxR,K,iCAET9Q,GACP,IAAIsiB,EAAIjpB,KAAK00B,UAAU/tB,QACblG,IAANwoB,GACJhd,aAAakoB,WAAWlL,K,0BAExBtiB,GACA,IAAIguB,EAAK7hB,OAAOnM,GACZ0N,EAAMrU,KAAKw0B,OAAOG,GACtB,QAAYl0B,IAAR4T,EAAmB,CACnB,IAAI4U,EAAIjpB,KAAK00B,UAAU/tB,GACvB3G,KAAKw0B,OAAOG,GAAMtgB,EAAM,IAAIugB,EAAS3L,GAEzC,OAAO5U,I,0BAEP1N,GACA,IAAIguB,EAAK7hB,OAAOnM,GACZiB,EAAM5H,KAAKw0B,OAAOG,GACtB,QAAYl0B,IAARmH,EAAmB,CACnB,IAAIqhB,EAAIjpB,KAAK00B,UAAU/tB,GACvB3G,KAAKw0B,OAAOG,GAAM/sB,EAAM,IAAIitB,EAAS5L,GAEzC,OAAOrhB,I,kCAECM,GACR,IAAIysB,EAAKzsB,EAAMP,KACXshB,EAAIjpB,KAAK80B,aAAaH,GAC1B,QAAUl0B,IAANwoB,EAAJ,CACA,IAAI5U,EAAMrU,KAAKw0B,OAAOG,QACVl0B,IAAR4T,EAAmBA,EAAM,IAAIugB,EAAS3L,GACrCjpB,KAAKw0B,OAAOG,QAAMl0B,EACvB4T,EAAI0gB,e,4BAEFpuB,GACF,IAAIquB,EAAKliB,OAAOnM,GACZzG,EAAMF,KAAKu0B,OAAOS,GACtB,YAAYv0B,IAARP,EAA0BA,EACvBF,KAAKu0B,OAAOS,GAAW,IAAIZ,EAAWp0B,KAAM2G,O,KAK9CiuB,EAAb,kDAEI,WAAYjtB,GAAe,IAAD,uBACtB,cAAMA,IAFOE,WACS,EAEtB,IAAIA,EAAQosB,EAAKC,QAAQ,EAAKvsB,MAFR,OAGtB,EAAKE,MAAkB,OAAVA,EAAgB,GAAKA,EAAM+V,MAAM,MAAMhW,KAAI,SAAAP,GAAC,OAAIkG,OAAOlG,MAH9C,EAF9B,wDAQQ4sB,EAAKnf,QAAQ9U,KAAK2H,KAAM3H,KAAK6H,MAAMuc,KAAK,SARhD,gCAUwBzd,GAEhB,KADQ2J,IAAE+C,QAAQrT,KAAK6H,MAAOlB,GACtB,GACR,MAAM,GAAN,OAAU3G,KAAK2H,KAAf,YAAuBhB,KAb/B,gCAewBA,GAChB,IAAIxE,EAAImO,IAAE+C,QAAQrT,KAAK6H,MAAOlB,GAU9B,OATIxE,EAAE,GACFnC,KAAK6H,MAAMotB,QAAQtuB,GACf3G,KAAK6H,MAAM7C,OApBR,KAoB6BhF,KAAK6H,MAAMtC,QAG/CvF,KAAK6H,MAAMqtB,OAAO/yB,EAAG,GACrBnC,KAAK6H,MAAMotB,QAAQtuB,IAEvB3G,KAAKm1B,YACC,GAAN,OAAUn1B,KAAK2H,KAAf,YAAuBhB,KA1B/B,mCA4B2BA,GACnB,IAAIxE,EAAImO,IAAE+C,QAAQrT,KAAK6H,MAAOlB,GAC9B,KAAIxE,EAAE,GAGN,OAFAnC,KAAK6H,MAAMqtB,OAAO/yB,EAAG,GACrBnC,KAAKm1B,YACC,GAAN,OAAUn1B,KAAK2H,KAAf,YAAuBhB,KAjC/B,kCAmCsB,IAAD,gBACC3G,KAAK6H,OADN,IACb,2BAA0B,CAAC,IAAlB1F,EAAiB,QACtB8xB,EAAKE,WAAL,UAAmBn0B,KAAK2H,KAAxB,YAAgCxF,KAFvB,8BAIb8xB,EAAKE,WAAWn0B,KAAK2H,MACrB3H,KAAK6H,MAAMqtB,OAAO,KAxC1B,2BA0CSrtB,GACD,OAAO7H,KAAKkV,MAAMrN,OA3C1B,GAA8BysB,GA+CjBO,EAAb,kDAGI,WAAYltB,GAAe,IAAD,uBACtB,cAAMA,IAHOE,WAES,IADlButB,SACkB,EAEtB,EAAKA,IAAM,EACX,EAAKvtB,MAAQ,GACb,IAAIA,EAAQosB,EAAKC,QAAQ,EAAKvsB,MAChB,OAAVE,GACSA,EAAM+V,MAAM,MAClBtI,SAAQ,SAAA6B,GACP,IAAIlQ,EAAIkQ,EAAE9D,QAAQ,MAClB,KAAIpM,EAAE,GAAN,CACA,IAAIN,EAAMwQ,EAAEjJ,OAAO,EAAGjH,GAClB9E,EAAIoL,OAAO4J,EAAEjJ,OAAOjH,EAAE,KACT,IAAbie,MAAM/iB,KACV,EAAK0F,MAAMlB,GAAOxE,EACdA,EAAE,EAAKizB,MAAK,EAAKA,IAAMjzB,QAdb,SAH9B,wDAsBQ,IAAIkzB,EAAc,GAClB,IAAK,IAAIpM,KAAKjpB,KAAK6H,MAAO,CACtB,IAAIR,EAAIrH,KAAK6H,MAAMohB,QACTxoB,IAAN4G,GACJguB,EAAGjzB,KAAH,UAAW6mB,EAAX,aAAiB5hB,IAErB4sB,EAAKnf,QAAQ9U,KAAK2H,KAAM0tB,EAAGjR,KAAK,SA5BxC,gCA8BwBzd,GAChB,IAAIxE,EAAInC,KAAK6H,MAAMlB,GACnB,QAAUlG,IAAN0B,EACJ,MAAM,GAAN,OAAUnC,KAAK2H,KAAf,YAAuBxF,KAjC/B,gCAmCwBwE,GAChB,IAAIxE,EAAInC,KAAK6H,MAAMlB,GAOnB,YANUlG,IAAN0B,MACEnC,KAAKo1B,IACPjzB,EAAInC,KAAKo1B,IACTp1B,KAAK6H,MAAMlB,GAAOxE,EAClBnC,KAAKm1B,aAEH,GAAN,OAAUn1B,KAAK2H,KAAf,YAAuBxF,KA3C/B,mCA6C2BwE,GACnB,IAAIxE,EAAInC,KAAK6H,MAAMlB,GACnB,QAAQlG,IAAJ0B,EAGJ,OAFAnC,KAAK6H,MAAMlB,QAAOlG,EAClBT,KAAKm1B,YACC,GAAN,OAAUn1B,KAAK2H,KAAf,YAAuBxF,KAlD/B,kCAqDQ,IAAK,IAAIA,KAAKnC,KAAK6H,MACfosB,EAAKE,WAAL,UAAmBn0B,KAAK2H,KAAxB,YAAgC3H,KAAK6H,MAAM1F,KAC3CnC,KAAK6H,MAAM1F,QAAK1B,EAEpBwzB,EAAKE,WAAWn0B,KAAK2H,MACrB3H,KAAKo1B,IAAM,IA1DnB,2BA4DSzuB,GACD,OAAO3G,KAAKkV,MAAMvO,OA7D1B,GAA8B2tB,I,8HC3KxBgB,EAAc,SAACC,EAAiB/Q,EAAYlb,GAC9C,OAAO,qCAAGisB,EAAH,KAAeC,EAAYhR,OAG/B,SAASgR,EAAYhR,GACxB,IAAIiR,EAAI,IACR,QAAeh1B,IAAX+jB,EAAsB,MAAO,YACjC,IAAK,IAAIriB,KAAKqiB,EAAQ,CAClB,IAAInd,EAAImd,EAAOriB,GAEf,GADAszB,GAAKtzB,EAAI,UACC1B,IAAN4G,EACAouB,GAAK,iBAEJ,GAAU,OAANpuB,EACLouB,GAAK,YAGL,cAAepuB,GACX,QACIouB,GAAKpuB,EACL,MACJ,IAAK,WACDouB,GAAK,WACL,MACJ,IAAK,SACDA,GAAK,QAIjBA,GAAK,KAET,OAAOA,EAAI,IAGR,IAAMC,EAAb,WAKI,WAAYjoB,EAAYwV,EAAYoF,GAAkC,yBAJ7D5a,QAI4D,OAH3DwV,UAG2D,OAF3DoF,QAE2D,OAD5DsN,iBAC4D,EACjE31B,KAAKyN,GAAKF,OAAOE,GACjBzN,KAAKijB,KAAOA,EACZjjB,KAAKqoB,GAAKA,EACVroB,KAAK21B,iBAA6Bl1B,IAAdT,KAAKijB,KATjC,gDAgBQxV,GACA,YAAWhN,IAAPgN,GAA2B,OAAPA,IACN,kBAAPA,EAAwBzN,KAAKyN,KAAOA,EAAGA,GAC3CzN,KAAKyN,KAAOA,KAnB3B,6BAsBW4a,EAAc/e,GACjB,QAAgB7I,IAAZT,KAAKyN,IAAgC,OAAZzN,KAAKyN,KAAkC,IAAnByX,MAAMllB,KAAKyN,IAA5D,CACA,IAAImoB,EAAU51B,KAAK41B,QACf9Y,EAAM9c,KAAKyV,IACf,IAAyB,IAArBzV,KAAK21B,YACL,YAAWl1B,IAAP4nB,EAAyBA,EAAGvL,EAAKxT,GAC9BgsB,EAAYM,EAAS9Y,GAEhC,cAAeA,GACX,IAAK,YACD,OAAO,uBAAMva,UAAU,gBAAhB,UAAiCqzB,EAAjC,gBACX,IAAK,SACD,OAAO,uBAAMrzB,UAAU,aAAhB,UAA8BqzB,EAA9B,IAAwC51B,KAAKyN,MAK5D,QAHWhN,IAAP4nB,IACAA,EAAKroB,KAAKqoB,SAEH5nB,IAAP4nB,IACkB,oBAAPA,IACPA,EAAMA,EAAWvd,cAEVrK,IAAP4nB,GAAkB,CAClB,IAAInoB,EAAMmoB,EAAGvL,GACb,YAAYrc,IAARP,EAA0BA,EACvB,uBAAMqC,UAAU,cAAhB,UAA+BqzB,EAA/B,IAAyC51B,KAAKyN,MAI7D,OAAO6nB,EAAYM,EAAS9Y,MAlDpC,yJA0Dc9c,KAAKijB,KAAK4S,UAAU71B,KAAKyN,IA1DvC,gCA2DezN,MA3Df,gIAaQ,OAAOA,KAAKijB,KAAK6S,YAAY91B,KAAKyN,MAb1C,8BAqD0B,OAAOzN,KAAKijB,KAAKtb,SArD3C,KA+FW4T,aAAS,YAAuC,IAArCwa,EAAoC,EAApCA,UAAW1N,EAAyB,EAAzBA,GAAI/e,EAAqB,EAArBA,EAAG0sB,EAAkB,EAAlBA,OACpC,QAAkBv1B,IAAds1B,EACA,YAAet1B,IAAXu1B,EAA6B,uBAAOzzB,UAAU,aAAjB,sBAC1ByzB,IAEX,GAAkB,OAAdD,EACA,YAAet1B,IAAXu1B,EAA6B,8CAC1BA,IAEX,IAAIC,SAAaF,EACjB,OAAQE,GACJ,QACI,QAAWx1B,IAAP4nB,EACA,OAAO,qCAAG4N,EAAH,IAASF,KAEhB,IAAI71B,EAAMmoB,EAAG0N,EAAWzsB,GACxB,YAAY7I,IAARP,EAA0BA,EACvB,mCAAG61B,IAElB,IAAK,SACD,IAAIG,EApDhB,SAAsBC,EAAkB9N,EAAc/e,GAClD,IAAI8sB,EACA3R,EAAmB0R,EACvB,cAAcA,GACV,IAAK,YAAaC,EAAa,uDAAsB,MACrD,IAAK,SAAUA,EAAa,2CAAMD,KAAQ,MAC1C,QACI,GAA4B,oBAAjB1R,EAAMjN,OAAuB,CACpC,QAAW/W,IAAP4nB,EAIA,OAAOA,EAAG8N,EAAI7sB,GAHd8sB,EAAad,EAAY7Q,EAAMmR,QAASO,IAQxD,YAAmB11B,IAAf21B,EACO,qBAAK7zB,UAAU,cAAf,SAA8B6zB,IAElC3R,EAAMjN,OAAO6Q,EAAI/e,GAgCH+sB,CAAaN,EAAW1N,EAAI/e,GACzC,YAAe7I,IAAXy1B,EAA6BA,OACfz1B,IAAXu1B,EAAsB,+CAAcA,IAC/C,IAAK,SACD,OAAO,6CAAQD,U,+EC5JpB,SAASO,IACZ,OAAO,qBAAK/zB,UAAU,yDAAf,SACH,mBAAGA,UAAU,oD,6PCGCg0B,GAAtB,aAEI,WAAYC,GAAoB,yBADtBA,cACqB,EAC3Bx2B,KAAKw2B,SAAWA,EAHxB,qDAMQ,OAAO,qBAAKj0B,UAAU,YAAf,SACFvC,KAAKy2B,oBAPlB,yGAeejS,MAff,+BAgBa9B,EAAkBzgB,MAhB/B,oCAiBkBuiB,MAjBlB,6BAkBqC,OAAjBxkB,KAAK02B,YAAoB12B,KAAK22B,WAlBlD,mEAWsC,OAAO,IAX7C,6BAYoC,OAAO,MAZ3C,yCAWKC,KAXL,uGAYKA,KAZL,sEAsBsBC,GAAtB,oDAWI,WAAYL,EAAmBlT,EAAaxB,GAAY,IAAD,8BACnD,cAAM0U,IAXAM,YAU6C,IAT7CC,WAS6C,IAR7Cx1B,WAQ6C,IAP7C2kB,WAO6C,IAL7C8Q,aAK6C,yHAGnD,EAAKF,OAASxT,EACd,EAAKyT,MAAQjV,EACb,EAAKlc,OACL,EAAKqxB,WAN8C,EAX3D,gDAmBkBD,GACVh3B,KAAKg3B,QAAUA,IApBvB,6BAuBQh3B,KAAKkmB,MAAQ,GACb,IACqB,EADjB3S,EAAIvT,KAAK82B,OAAO5Q,WACVzlB,IAAN8S,KACyB,IAArB6S,MAAMC,QAAQ9S,IAAa,EAAAvT,KAAKkmB,OAAM9jB,KAAX,oBAAoBmR,IAC9CvT,KAAKkmB,MAAM9jB,KAAKmR,MA3BjC,iCA+BQ,OAAOvT,KAAKuB,MAAQ,CAChB0wB,IAAKjyB,KAAKiyB,IAAIiF,KAAKl3B,MACnB2H,KAAM3H,KAAK82B,OAAOnvB,QAjC9B,mCAyCmB3H,KAAKyX,WAAQhX,IAzChC,8BA0CcT,KAAKm3B,cAAen3B,KAAKo3B,eA1CvC,oCA2CoBp3B,KAAKq3B,UAAO52B,EAAWT,KAAKiC,WAAQxB,IA3CxD,iCA4Ce+jB,GACPA,EAAOxkB,KAAK82B,OAAOnvB,MAAQ3H,KAAKyX,QA7CxC,+BA+CaiL,EAAkBzgB,MA/C/B,oCAgDkBuiB,MAhDlB,4CAiDyC,OAAOxkB,KAAKyX,QAjDrD,iCAmDQ,IACI,IAAIpQ,EAAIrH,KAAKs3B,sBACb,GAAIt3B,KAAKkmB,MAAMlhB,OAAS,EAAG,CACvB,IAAIuyB,EADmB,gBAENv3B,KAAKkmB,OAFC,IAEvB,2BAA6B,CAAC,IAArBK,EAAoB,QACzBzhB,QAAQC,IAAI,eAAgBsC,GAC5B,IAAInF,EAAMqkB,EAAKlf,GAEf,GADAvC,QAAQC,IAAI,uBAAwBsC,EAAGnF,IAC3B,IAARA,EACAlC,KAAKiC,WAAQxB,EACb82B,GAAO,OAEN,QAAY92B,IAARyB,EAKL,OAFAlC,KAAKiC,MAAQC,OACblC,KAAKq3B,MAAO,IAdG,8BAkBvBr3B,KAAKq3B,KAAOE,EAEhBv3B,KAAKyX,MAAQpQ,EAEjB,MAAO0N,GACH/U,KAAKiC,MAAQ8S,EAAEnS,WA5E3B,+BAgFQ,IAAIqiB,EACJ,QAAmBxkB,IAAfT,KAAK+2B,MAAqB,CAAC,IACtBS,EAASx3B,KAAK+2B,MAAdS,WACS/2B,IAAV+2B,IAAqBvS,EAAI,uBAAO1iB,UAAU,aAAjB,SAA+Bi1B,KAEhE,OAAO,sBAAKj1B,UAAU,YAAf,UACFvC,KAAKy2B,gBACLxR,OAvFb,+BAoCsC,YAAsBxkB,IAAfT,KAAKiC,QApClD,6BAuCQ,YADyBxB,IAAfT,KAAKyX,OAAuBzX,KAAKyX,QAAUzX,KAAK82B,OAAOnb,iBAtCzE,GAAsC4a,GAAtC,kCAOKriB,KAPL,iGAQKA,KARL,iGASKA,KATL,kGAoCK0iB,KApCL,uGAqCKA,KArCL,sECvBaa,EAAb,4MACcT,aADd,IAEYU,eAFZ,IAGYC,gBAHZ,uDASQ,6DADa,MAEiB33B,KAAKsjB,MAA9BoU,EAFQ,EAERA,UAAWC,EAFH,EAEGA,gBACEl3B,IAAdi3B,IAAyB13B,KAAK03B,UAAY,QAC3Bj3B,IAAfk3B,IAA0B33B,KAAK23B,WAAa,KAZxD,iCAgBQ,iEACArnB,IAAEsnB,OAAO53B,KAAKuB,MAAO,CACjBiZ,SAAUxa,KAAKwa,SAAS0c,KAAKl3B,UAlBzC,mCAuBQA,KAAKg3B,QAAQa,QAAU73B,KAAK82B,OAAOnb,eAAiB3b,KAAK03B,UACzD13B,KAAKyX,MAAQzX,KAAKs3B,wBAxB1B,oCA2BkB9S,GACV,IAAInd,EAAImd,EAAOxkB,KAAK82B,OAAOnvB,WACjBlH,IAAN4G,IACAA,EAAIrH,KAAK82B,OAAOnb,gBA9B5B,4CAsC0C,OAAO3b,KAAKg3B,QAAQa,QAAS73B,KAAK03B,UAAU13B,KAAK23B,aAtC3F,iCAyCQ33B,KAAKyX,MAAQzX,KAAKs3B,wBAzC1B,sCA6CQ,OAAO,qBAAK/0B,UAAU,sBAAf,SACH,uBAAOA,UAAU,eAAjB,SACI,wBAAOA,UAAU,sCAAjB,UACI,uBAAOC,KAAK,WACRmF,KAAM3H,KAAK82B,OAAOnvB,KAClBsqB,IAAKjyB,KAAKuB,MAAM0wB,IAChBzX,SAAUxa,KAAKuB,MAAMiZ,SACrBjY,UAAU,yBACd,sBAAMA,UAAU,6BAChB,sBAAMA,UAAU,6BAAhB,SAA8CvC,KAAK8hB,KAAK5L,iBAtD5E,4BAKsC,OAAOlW,KAAK82B,SALlD,2BAMwC,OAAO92B,KAAK+2B,UANpD,GAAkCF,GCFrBiB,EAAb,8KAEiC,IAAD,OACxB,OAAO,qBAAKv1B,UAAU,sBAAf,SACH,qBAAKA,UAAU,eAAf,SAEIvC,KAAK8hB,KAAKmE,KAAKre,KAAI,SAACd,EAAMe,GACtB,IAAIoO,EAMJ,OAL8BA,EAAV,kBAATnP,EAAuBA,EAE1BA,EAAKwM,KAGN,wBAAmB/Q,UAAU,mCAA7B,UACH,uBAAOC,KAAK,QACRmF,KAAM,EAAKmvB,OAAOnvB,KAClBpF,UAAU,yBACd,sBAAMA,UAAU,6BAChB,sBAAMA,UAAU,6BAAhB,SAA8C0T,MAL/BpO,YAbvC,2BACqC,OAAO7H,KAAK+2B,UADjD,GAAkCF,G,yBCIZkB,EAAtB,4MAWcf,aAXd,uDAEQ,8DAC6B,IAAzBh3B,KAAK82B,OAAOkB,UACZh4B,KAAKkmB,MAAM9jB,MAAK,SAACiF,GACb,OAAQ,OAAJA,QAAgB5G,IAAJ4G,GAAiD,IAA/BA,EAAa4wB,OAAOjzB,QAPlD,wDAEpB,4CAYyC,OAAOhF,KAAKk4B,WAAWl4B,KAAKg3B,QAAQvf,SAZ7E,iCAeQ,iEACAnH,IAAEsnB,OAAO53B,KAAKuB,MAAO,CACjBuZ,OAAQ9a,KAAK8a,OAAOoc,KAAKl3B,MACzBgb,QAAShb,KAAKgb,QAAQkc,KAAKl3B,MAC3Bwa,SAAUxa,KAAKwa,SAAS0c,KAAKl3B,QAEjC,IAAI8hB,EAAO9hB,KAAK+2B,MAMhB,YALat2B,IAATqhB,GACAxR,IAAEsnB,OAAO53B,KAAKuB,MAAO,CACjB4Z,YAAa2G,EAAK3G,cAGnBnb,KAAKuB,QA3BpB,iCA6ByBkW,GAAoB,OAAOA,IA7BpD,+BAgCQzX,KAAK02B,aAhCb,iCAmCQ5xB,QAAQC,IAAI,YACZ/E,KAAK02B,aApCb,gCAuCQ12B,KAAKm3B,gBAvCb,kCA4CQ,OAAO7e,IAAW,CACd,gBAAgB,EAChB,eAA6B,IAAdtY,KAAKq3B,KACpB,kBAA6B52B,IAAfT,KAAKiC,MACnB,gBAA2BxB,IAAfT,KAAKiC,QAAqC,IAAdjC,KAAKq3B,SAhDzD,oCAoDQ,OAAO,mCAAO90B,UAAWvC,KAAKuC,aAAiBvC,KAAKuB,UApD5D,0BAsDkBy1B,GACV,2DAAUA,GACNA,IACAA,EAAQvf,WAAuBhX,IAAfT,KAAKyX,MAAqB,GAAGzX,KAAKyX,SAzD9D,oCA8DQ,YAAmBhX,IAAfT,KAAKiC,MAA4B,KAC9B,qBAAKM,UAAU,mBAAf,SAAmCvC,KAAKiC,UA/DvD,mCAiEmB,mEAAoBjC,KAAKg3B,QAAQvf,MAAQ,KAjE5D,+BAkEaiL,EAAkBzgB,GACnBjC,KAAK82B,OAAOnvB,OAAS+a,IAAW1iB,KAAKiC,MAAQA,KAnEzD,oCAqEkBuiB,GACV,IAAInd,EAAImd,EAAOxkB,KAAK82B,OAAOnvB,WACjBlH,IAAN4G,IAEJrH,KAAKyX,MAAQpQ,KAzErB,sCA4EQ,OAAO,eAAC,WAAD,WACFrH,KAAKm4B,cACLn4B,KAAKo4B,qBA9ElB,GAA2CvB,GCF9BwB,EAAb,4MAEYxrB,QAFZ,2DAOQ,IAAI5F,EAAC,iEACAiU,EAAalb,KAAKsjB,MAAlBpI,UACAod,EAAQt4B,KAAK8hB,KAAbwW,KAKL,OAJAhoB,SAASrJ,EAAG,CACRiU,UAAWA,EACXod,KAAMA,IAEHrxB,IAdf,oCAgByC,IAAD,OAChC,OAAO,sCAAUgrB,IAAK,SAAAhc,GAAI,EAAKpJ,GAAKoJ,OAAUxV,IAAJwV,IAAeA,EAAEwB,MAAM,KAAKlV,UAAWvC,KAAKuC,aAAiBvC,KAAKuB,UAjBpH,2BACwC,OAAOvB,KAAK+2B,QADpD,4BAIwC,OAAO/2B,KAAK82B,WAJpD,GAAqCiB,GCAxBQ,EAAb,kDACI,WAAa/B,EAAmBlT,EAAaxB,GAAY,IAAD,8BACpD,cAAM0U,EAAUlT,EAAOxB,IAIjBkV,aAL8C,EAEpD,EAAK/E,IAAM,EAAKA,IAAIiF,KAAT,gBAFyC,EAD5D,kEAOyC,IAE7B7vB,EADoBrH,KAAKg3B,QAAxBwB,gBACuB,GAAG/gB,MAC/B,OAAQzX,KAAK82B,OAAOt0B,MAChB,IAAK,SAAU6E,EAAIkG,OAAOlG,GAAI,MAC9B,IAAK,OAAQA,EAAI,IAAIzC,KAAKyC,GAAI,MAC9B,IAAK,OACgB,kBAANA,IACPA,EAAqC,SAA/BA,EAAa2G,eAI/B,OAAO3G,IAnBf,sCAqBiC,IACpB4e,EAAQjmB,KAAK8hB,KAAbmE,KAEDtkB,EAAiB,GAYrB,YAXYlB,IAFFT,KAAK8hB,KAAK2W,SAGhB92B,EAAQS,KAAK,wBAAiBqV,WAAOhX,EAAxB,gCAAc,IAC/BkB,EAAQS,KAAR,MAAAT,EAAO,YAASskB,EAAKre,KAAI,SAACd,EAAMe,GAC5B,IAAIoO,EAAG5O,EAMP,MALoB,kBAATP,EAAmBmP,EAAI5O,EAAIP,GAElCmP,EAAInP,EAAKwM,KACTjM,EAAIP,EAAK2Q,OAEN,wBAAoBA,MAAOpQ,EAA3B,SAA+B4O,GAAlBpO,QAEjB,qBAAKtF,UAAU,sBAAf,SACH,wBAAQoF,KAAM3H,KAAK82B,OAAOnvB,KAAMpF,UAAU,eAAe0vB,IAAKjyB,KAAKiyB,IAAnE,SACKtwB,QAtCjB,2BAKsC,OAAO3B,KAAK+2B,UALlD,GAAmCF,GCFtB6B,EAAb,8KAEQ,OAAO,qBAAKn2B,UAAU,yBAAf,SACH,sBAAKA,UAAU,sBAAsBo2B,KAAK,QAA1C,6CACgC,uBADhC,UAEQzrB,KAAKkE,UAAUpR,KAAK82B,QAF5B,mBAEoD,uBAFpD,SAGO5pB,KAAKkE,UAAUpR,KAAK+2B,OAH3B,mBAGkD,gCAN9D,GAAoCF,GAYvB+B,EAAb,kDAEI,WAAYpC,EAAmBQ,GAAsB,IAAD,8BAChD,cAAMR,IAFFQ,aAC4C,EAEhD,EAAKA,QAAUA,EAFiC,EAFxD,4DAOQ,OAAO,qBAAKz0B,UAAU,yBAAf,SACFvC,KAAKg3B,cARlB,GAAkCT,GCZrBsC,EAAb,yKAIQ,IAAI5xB,EAAC,iEAKL,OAJAqJ,IAAEsnB,OAAO3wB,EAAG,CACRzE,KAAM,OACN0Y,UAAWlb,KAAKsjB,MAAMpI,YAEnBjU,IATf,iCAWyBwQ,GACjB,QAAchX,IAAVgX,GACwB,IAAxBA,EAAMwgB,OAAOjzB,OACjB,OAAOyS,IAdf,4BACwC,OAAOzX,KAAK82B,WADpD,GAAmCiB,GAkBtBe,EAAb,yKAEQ,IAAI7xB,EAAC,iEAKL,OAJAqJ,IAAEsnB,OAAO3wB,EAAG,CACRzE,KAAM,WACN0Y,UAAWlb,KAAKsjB,MAAMpI,YAEnBjU,MAPf,GAAqC4xB,GCXxBE,EAAb,4MACcthB,WADd,IAEcuhB,gBAFd,uDAOQ,6DACAh5B,KAAKg5B,WAAa,GAFL,MAGIh5B,KAAKsjB,MAAjB2V,EAHQ,EAGRA,IAAK7D,EAHG,EAGHA,IAYV,YAXY30B,IAARw4B,GACAj5B,KAAKkmB,MAAM9jB,MAAK,SAACiF,GAAc,QAAU5G,IAAN4G,EAAyB,QAAIA,EAAE4xB,IAjB/D,2BAiBoFA,KACnFA,EAAM,GAAGj5B,KAAKg5B,WAAW52B,KAfrB,KAkBRpC,KAAKg5B,WAAW52B,KAlBR,SAqBA3B,IAAR20B,GACAp1B,KAAKkmB,MAAM9jB,MAAK,SAACiF,GAAc,QAAU5G,IAAN4G,EAAyB,QAAIA,EAAE+tB,IAxB/D,2BAwBoFA,KAEnFp1B,KAAK82B,OAAOt0B,MAChB,IAAK,MACL,IAAK,SAAUxC,KAAKg5B,WAAW52B,KAzBvB,OAEpB,iCA2ByBqV,GACjB,QAAchX,IAAVgX,GACwB,IAAxBA,EAAMwgB,OAAOjzB,OAAjB,CACA,IAAIigB,EAAI1X,OAAO2rB,WAAWzhB,GAC1B,GAAIyN,MAAMD,GAAI,MAAM,IAAIrW,MAtCP,kCAuCjB,OAAOqW,KAhCf,iCAoCQ,iEACA3U,IAAEsnB,OAAO53B,KAAKuB,MAAO,CACjBiB,KAAM,SACN2Q,KAAOnT,KAAK82B,OAAoB3jB,KAChCgmB,WAAYn5B,KAAKm5B,WAAWjC,KAAKl3B,UAxC7C,iCA4Ce6I,GACP,IAAIyb,EAAKzb,EAAMuwB,SACf,KAAW,IAAP9U,GAAmB,IAAPA,GAAmB,KAAPA,GAAcA,GAAM,IAAMA,GAAM,IAC5D,QAAwB7jB,IAApBT,KAAKg5B,YACDh5B,KAAKg5B,WAAW3lB,QAAQiR,IAAO,EAC/B,OAAQA,GACJ,KApDA,GAoDkBtkB,KAAKq5B,WAAY,MACnC,KAtDA,GAsDkBr5B,KAAKs5B,WAAYzwB,EAAM0wB,sBAKrD1wB,EAAM0wB,mBAxDd,iCA4DQ,IAAIlyB,EAAIrH,KAAKg3B,QAAQvf,MACbpQ,EAAEgM,QAAQ,MACT,IAAGrT,KAAKg3B,QAAQvf,MAAQpQ,EAAE2K,QAAQ,IAAK,OA9DxD,iCAiEQ,IAAI3K,EAAIrH,KAAKg3B,QAAQvf,MACjBxQ,EAAII,EAAEgM,QAAQ,KACNhM,EAARJ,GAAK,EAAOI,EAAE2K,QAAQ,IAAK,IACtB,IAAI3K,EACbrH,KAAKg3B,QAAQvf,MAAQpQ,IArE7B,4BAI8D,OAAOrH,KAAK82B,WAJ1E,GAAmCiB,G,uBCNtByB,GAAb,yPAIY/2B,QAJZ,sBAIsB,wCAAAnB,EAAA,+DACW,EAAKwgB,KAAzB2X,EADS,EACTA,KAAMC,EADG,EACHA,WADG,SAEGD,EAAK,EAAK3X,KAAM,EAAK0U,SAASj1B,MAAO,EAAKi1B,SAASmD,cAFtD,eAGDl5B,KADTqG,EAFU,+BAIV,EAAK2Q,WAAQhX,EAJH,kCAOKA,IAAfi5B,EAPU,wBAQV,EAAKjiB,MAAQ3Q,EAAK2G,GARR,6BAWMisB,EAAW5yB,GAA1B2G,EAXS,EAWTA,GAAI0K,EAXK,EAWLA,QACT,EAAKV,MAAQhK,EACb,EAAK0K,QAAUA,EAbD,4CAJtB,EAmBIyhB,SAAW,SAACniB,GACR,EAAKA,MAAQA,EAAMhK,IApB3B,4DAsBkB+W,GACV,IAAInd,EAAImd,EAAOxkB,KAAK82B,OAAOnvB,MAC3B3H,KAAKyX,MAAQpQ,IAxBrB,uCA0BiD,IAAD,EACIrH,KAAK8hB,KAA5C+X,EADmC,EACnCA,WAAYH,EADuB,EACvBA,WAAYI,EADW,EACXA,YAC7B,QAAmBr5B,IAAfT,KAAKyX,MACL,OAAOqiB,GAAe,uBAE1B,QAAqBr5B,IAAjBT,KAAKmY,QACL,OAAOnY,KAAKmY,QAEhB,QAAmB1X,IAAfo5B,QACmBp5B,IAAfi5B,EAA0B,CAC1B,IAAI5yB,EAAO+yB,EAAW75B,KAAKyX,OAC3B,GAAI3Q,EAAM,CACN,IAAI5G,EAAMw5B,EAAW5yB,GACrB,QAAYrG,IAARP,EAAmB,OAAOA,EAAIiY,SAI9C,OAAOrF,OAAO9S,KAAKyX,SA3C3B,sCA2DiC,IAAD,EACJzX,KAAK8hB,KAApBmB,EADmB,EACnBA,KAAM8W,EADa,EACbA,MACX,YAAct5B,IAAVs5B,EAEO,qBAAKx3B,UAAU,yEAClBE,QAASzC,KAAKyC,QADX,SAEFzC,KAAKg6B,mBAGP,qBAAKz3B,UAAU,uBAAf,SACH,cAACw3B,EAAME,UAAP,CAAiBxsB,GAAIzN,KAAKyX,MACtB4Q,GAAIpF,QAtEpB,2BACsC,OAAOjjB,KAAK+2B,UADlD,GAAmCF,GAAnC,qCAEK3iB,KAFL,iECEagmB,GAAb,oDAII,WAAY1D,EAAmBlT,EAAaxB,GAAY,IAAD,6BACnD,cAAM0U,EAAUlT,EAAOxB,GAD4B,0CAEnD,EAAKqY,YAAc,EAAKA,YAAYjD,KAAjB,gBAFgC,EAJ3D,iDACwC,OAAOl3B,KAAK+2B,UADpD,iDAyBgBtpB,GACRzN,KAAKyX,MAAQhK,EAAGA,KA1BxB,oCA4BkB+W,GACV,IAAInd,EAAImd,EAAOxkB,KAAK82B,OAAOnvB,MAC3B3H,KAAKyX,MAAQpQ,IA9BrB,qCAgCwC,IAAD,OAQrC,OAAO3E,gBAAoB1C,KAAK8hB,KAAKiY,MAAME,UAApC,aACNxsB,GAAIzN,KAAKyX,MACA2iB,aAAc,kBAAI,EAAK5D,SAASmD,cACzCQ,YAAan6B,KAAKm6B,aACfn6B,KAAK8hB,SA5CX,sCAgDQ,OAAO,qBAAKvf,UAAU,uBAAf,SACFvC,KAAKq6B,qBAjDlB,GAAqCxD,GAArC,qCAGK3iB,KAHL,iE,QCDaomB,GAAb,yPAKY73B,QALZ,sBAKsB,wCAAAnB,EAAA,+DACW,EAAKwgB,KAAzB2X,EADS,EACTA,KAAMC,EADG,EACHA,WADG,SAEGD,EAAK,EAAK3X,KAAM,EAAK0U,SAASj1B,MAAO,EAAKi1B,SAASmD,cAFtD,eAGDl5B,KADTqG,EAFU,+BAIV,EAAK2Q,WAAQhX,EAJH,4BAOMi5B,EAAW5yB,GAA1B2G,EAPS,EAOTA,GAAI0K,EAPK,EAOLA,QACT,EAAKV,MAAQhK,EACb,EAAK0K,QAAUA,EATD,4CALtB,EA2DY9R,KAAOkV,aAAS,WACpB,IAAIzQ,EACUyvB,EAAW,EAAKzY,KAAzBhX,QAWL,OATIA,OADerK,IAAf,EAAKgX,OAAsC,OAAf,EAAKA,MACvB,qBAOA,cAAC8iB,EAAD,CAAS9sB,GAAI,EAAKgK,QAEzB,qBACHlV,UAAU,kFACVE,QAAS,EAAKA,QAFX,SAGFqI,OA3Eb,4DAgBkB0Z,GACV,IAAInd,EAAImd,EAAOxkB,KAAK82B,OAAOnvB,MAC3B3H,KAAKyX,MAAQpQ,IAlBrB,sCA+CQ,OAAO3E,gBAAoB1C,KAAKqG,QA/CxC,2BACoC,OAAOrG,KAAK+2B,UADhD,GAAiCF,GAAjC,qCAGK3iB,KAHL,iECHasmB,EAAb,kDACI,WAAYj5B,GAAQ,IAAD,8BACf,cAAMA,IACDk5B,WAAa,EAAKA,WAAWvD,KAAhB,gBAFH,EADvB,yDAMQ,IAAIwD,EAAU16B,KAAKw2B,SAASj1B,MAAMm5B,aAClBj6B,IAAZi6B,GAEJA,EADa16B,KAAKw2B,SAASmD,gBARnC,sCAYQ70B,QAAQC,IAAI,yBACZ,IAAI41B,EAAU36B,KAAKw2B,SAASmE,QACxBhE,EAAW32B,KAAKw2B,SAASG,SACzBp1B,EAAQvB,KAAKw2B,SAASj1B,MAC1BuD,QAAQC,IAAI,+CAAgD41B,EAAShE,GAL7C,IAOpBiE,EADCC,EAA6Bt5B,EAA7Bs5B,aAAcC,EAAev5B,EAAfu5B,YAOnB,YALoBr6B,IAAhBq6B,IACAF,EAAW,wBAAQr4B,UAAU,+BAA+BE,QAASzC,KAAKy6B,WAA/D,SACNK,KAGF,sBAAKv4B,UAAU,+BAAf,UACH,wBACIA,UAAU,kBACVC,KAAK,SACLgZ,SAAUmf,GAAWhE,EAHzB,SAIKkE,GAAgB,iBAEpBD,SA/Bb,GAAoCrE,GCoBvBwE,EAA+B,SAACC,EAAe3W,GAE5CA,EAAInO,MAUhB,YATgCzV,IAA3B4jB,EAAiB4W,MA2D1B,SAA4BD,EAAe9kB,EAAcglB,GACrD,OAAO,IAAIxC,EAAesC,EAAME,OAAiBz6B,GA3DnC06B,CAAmBH,EAAM9kB,EAAOmO,QAET5jB,IAA3B4jB,EAAiBf,MA4B/B,SAA4B0X,EAAe9kB,EAAcklB,GAA6B,IAC7E9X,EAAe8X,EAAf9X,MAAOxB,EAAQsZ,EAARtZ,KACZ,cAAewB,GACX,IAAK,SACDA,EAAQ,CACJ3b,KAAO2b,EACP9gB,KAAM,UAEV,MACJ,IAAK,SACD,MACJ,QACI,OAAO,IAAIk2B,EAAesC,EAAM1X,EAAOxB,GAE/C,IAAIuZ,EAAY/X,EAAM9gB,MAAQ,SAC9B,QAAa/B,IAATqhB,GAEA,QAAarhB,KADbqhB,EAAOwZ,GAAaD,IACI,OAAO,IAAI3C,EAAesC,EAAM1X,EAAOxB,QAE9D,QAAkBrhB,IAAdqhB,EAAKtf,KAAoB,CAC9B,IAAIyf,EAAIqZ,GAAaD,GACrBvZ,EAAKtf,UAAW/B,IAAJwhB,EAAe,SAAWA,EAAEzf,KAI5C,OADQ,IADU+4B,GAAazZ,EAAKtf,MAAQ64B,IAAc3C,GAClCsC,EAAM1X,EAAOxB,GAnDvB0Z,CAAmBR,EAAM9kB,EAAOmO,GAGhC,IAAIuU,EAAaoC,EAAM3W,EAAIoX,OAKvCF,GAA2F,CAC7F,OAAU1C,EACV,SAAYC,EACZ,OAAUC,EACV,SAAYtB,EACZ,SAAYK,EACZ,OAAUS,EACV,UAAWiB,EACX,YAAaU,EACb,SAAY7B,EACZ,KAAQiC,GAENgB,GAAqC,CACvC,OAAU,CAAC94B,KAAK,UAChB,OAAU,CAACA,KAAK,UAChB,IAAO,CAACA,KAAK,UACb,IAAO,CAACA,KAAK,UACb,KAAQ,CAACA,KAAK,c,8BCvDlB,0DAQO,IAAMqD,EAAO,WAChB,IAAI2B,EALG,cAAc1D,KAAK2H,SAASC,SAAS0H,MAO5C,MAAO,CACH5L,QAASA,EACTgG,eAAeH,EACf4H,QAJU,IAAI4f,KAAmB,IAAVrtB,EAAgB,KAAK,KAK5C1B,WAAY,SAAC41B,EAAYxqB,EAAoCyqB,GAA4C,IAAC,IAAD,qBAA7BC,EAA6B,iCAA7BA,EAA6B,kBAErG,OAAO,EAAAC,GAAO/1B,WAAP,SAAkBoL,EAAUyqB,GAA5B,OAAmCC,KAE9C71B,aAAc,SAAC+1B,GACXD,EAAO91B,aAAa+1B,IAExBz4B,YAAa,SAAC6N,EAAoCyqB,GAA6C,IAAC,IAAD,qBAA9BC,EAA8B,iCAA9BA,EAA8B,kBAC3F,OAAO,EAAAC,GAAOx4B,YAAP,SAAmB6N,EAAUyqB,GAA7B,OAAoCC,KAE/C34B,cAAe,SAAC64B,GACZD,EAAO54B,cAAc64B,KAlBb,K,+CCPpB,k2D,uJCKsBC,EAAtB,WAII,WAAYf,EAAe3W,GAGvB,GAHsC,yBAHhC2W,UAG+B,OAF/B3W,SAE+B,OAD/B2X,aAC+B,EACrCh8B,KAAKg7B,KAAOA,EACZh7B,KAAKqkB,IAAMA,OACuB5jB,IAA7B4jB,EAAoB7hB,KAAoB,CACzC,IAAIy5B,EAAoB5X,EAAqB0W,mBAClCt6B,IAAPw7B,IAAkBA,EAAKjB,EAAKD,oBACrBt6B,IAAPw7B,IAAkBA,EAAKlB,KAC3B/6B,KAAKg8B,QAAUC,EAAGjB,EAAM3W,IAXpC,mDAiBQ,YAAqB5jB,IAAjBT,KAAKg8B,SACFh8B,KAAKg8B,QAAQzE,SAlB5B,+BAqBa7U,GACL,IAAIY,EAAStjB,KAAKqkB,IAAiBf,MACnC,QAAc7iB,IAAV6iB,EAAqB,OAAOZ,IAAcY,EAAM3b,KACpD,IAAIszB,EAASj7B,KAAKqkB,IAAiB4W,MACnC,YAAcx6B,IAAVw6B,QAA0Ex6B,IAA9Cw6B,EAAM7zB,MAAK,SAAA4M,GAAC,OAAIA,EAAEsP,MAAM3b,OAAS+a,OAzBzE,mCA+B6BjiB,IAAjBT,KAAKg8B,SAAuBh8B,KAAKg8B,QAAQz1B,UA/BrD,yCAkC6B9F,IAAjBT,KAAKg8B,SAAuBh8B,KAAKg8B,QAAQ7E,gBAlCrD,iCAoCe3S,QACc/jB,IAAjBT,KAAKg8B,SAAuBh8B,KAAKg8B,QAAQrC,WAAWnV,KArChE,+BAuCa9B,EAAkBzgB,QACFxB,IAAjBT,KAAKg8B,SAAuBh8B,KAAKg8B,QAAQE,SAASxZ,EAAWzgB,KAxCzE,oCA0CkBuiB,QACW/jB,IAAjBT,KAAKg8B,SAAuBh8B,KAAKg8B,QAAQG,cAAc3X,KA3CnE,+BA4B4B,OAAOxkB,KAAKg8B,QAAQrF,WA5BhD,6BA6B0B,OAAO32B,KAAKg8B,QAAQI,WA7B9C,KA+CMC,E,qKACK11B,GACH,OAAO,qBAAepE,UAAU,aAAzB,SAAuCvC,KAAKqkB,KAAlC1d,K,+BAEG,OAAO,I,6BACT,OAAO,M,GALCo1B,GAQ5BO,E,qKACK31B,GACH,OAAO,sBAAepE,UAAU,iBAAzB,UACH,uBAAOA,UAAU,0BAAjB,SACMvC,KAAKqkB,IAAqBnO,QAE/BlW,KAAKg8B,QAAQxkB,WAJD7Q,O,GAFWo1B,GAa7B,SAASQ,EAAmBvB,EAAe3W,GAC9C,OAAO,IAAIiY,EAAsBtB,EAAM3W,GAGpC,SAASmY,EAAiBxB,EAAe3W,GAC5C,OAAO,IAAIgY,EAAoBrB,EAAM3W,K,6BC/EzC,0E,0ICGO,SAAeviB,EAAtB,0C,4CAAO,WAA0BL,EAAqBC,EAAYC,EAC9DC,EAA2BC,GADxB,SAAAP,EAAA,sEAGGG,EAAQ+K,MAAM9K,EAAKC,GAAS,EAAOC,EAASC,GAH/C,4C,sBAMA,IAAe8oB,EAAtB,WAKI,WAAY9B,EAAc2B,GAAuB,yBAJvCnqB,WAIsC,OAHtCwoB,UAGsC,OAFtC2B,iBAEsC,EAC5CxqB,KAAK6oB,KAAOA,GAAQ,GACpB7oB,KAAKwqB,YAAcA,EAP3B,2FAYgB9B,GAZhB,uFAa4B1oB,KAAKy8B,iBAbjC,cAaYh7B,EAbZ,gBAcqBA,EAAQqlB,MAAM9mB,KAAK6oB,KAAMH,GAd9C,mNAiBsBhnB,EAAYZ,EAAe6e,GAjBjD,uFAkB4B3f,KAAKy8B,iBAlBjC,cAkBYh7B,EAlBZ,gBAmBqBA,EAAQi7B,UAAUh7B,EAAKZ,EAAQ6e,GAnBpD,sNAsBqBkJ,GAtBrB,4FAsBkCloB,EAtBlC,oCAsB6CF,EAtB7C,SAuB4BT,KAAKy8B,iBAvBjC,cAuBYh7B,EAvBZ,gBAwBqBA,EAAQxB,IAAID,KAAK6oB,KAAOA,EAAMloB,GAxBnD,mNA2BsBkoB,EAAaloB,GA3BnC,uFA4B4BX,KAAKy8B,iBA5BjC,cA4BYh7B,EA5BZ,gBA6BqBA,EAAQ+mB,KAAKxoB,KAAK6oB,KAAOA,EAAMloB,GA7BpD,oNAgCqBkoB,EAAaloB,GAhClC,uFAiC4BX,KAAKy8B,iBAjCjC,cAiCYh7B,EAjCZ,gBAkCqBA,EAAQk7B,IAAI38B,KAAK6oB,KAAOA,EAAMloB,GAlCnD,uNAqCwBkoB,EAAaloB,GArCrC,uFAsC4BX,KAAKy8B,iBAtCjC,cAsCYh7B,EAtCZ,gBAuCqBA,EAAQiT,OAAO1U,KAAK6oB,KAAOA,EAAMloB,GAvCtD,yJ,wMCDai8B,GAAb,uPAyBY5kB,KAAOuD,aAAS,SAACha,GAAgF,IAChGK,EAAWL,EAAXK,QACDorB,EAAW,EAAKxH,QAAU,EAAKA,OAAOwH,KAc1C,OAAO,cAAC,IAAD,CACH9W,MAAO,eAAO,EAAKA,MACnBzI,GAAI,EAAKovB,MACT7P,KAAMA,EACN8P,QAAS,SAACD,GAAuBj7B,EAAQi7B,SA7CrD,0LAKQ78B,KAAK68B,MAAQ78B,KAAKyX,MAL1B,kBAMe,IAAItM,SAAa,SAACvJ,EAASC,GAC9BqB,IAAId,KAAKM,gBAAoB,EAAKsV,KAAM,CAACpW,QAAQA,EAASC,OAAOA,KAAU,kBAAIA,WAP3F,mIAC+B,OAAO7B,KAAK0lB,YAD3C,G,MAAmCL,GAAnC,mCAEKnR,KAFL,kE,kLCLsB0Y,GAAtB,aACI,aAA6C,IAAD,OAAhCmQ,EAAgC,iFAIvCC,SAAmB,EAJoB,KAKvCC,oBALuC,OAMvCC,mBANuC,kHAUlCC,YAVkC,mHA4B5CC,YAAc,WAChB,EAAKC,eAAe,EAAKC,SA7BqB,KAuC5CC,eAAiB,WACnB,EAAKF,eAAe,EAAKG,YAxCqB,KAyDlCnmB,WAzDkC,OA0DlComB,UAAY,IA1DsB,KA2DlC1V,eAAgBtnB,EA3DkB,KA4DlCunB,SAAW,GA5DuB,KA6DlC0V,eAA+B,OA7DG,KA+DrCC,eA/DqC,OAoHvCC,UAAW,OAnHKn9B,IAAnBs8B,IAA8BA,GAAiB,GAC7C/8B,KAAKm9B,OAASjpB,IAAWgZ,MAAS,GAAI,CAACC,KAAK4P,IAHpD,4DAmBiBE,GACfj9B,KAAKi9B,eAAiBA,IApBxB,uCAuBkBC,GAChBl9B,KAAKk9B,cAAgBA,IAxBvB,qCAmDwBW,GACtB/3B,YAAW,WACV,IAAIsrB,EAAM3lB,SAASqB,eAAe+wB,GAC/B,OAAHzM,QAAG,IAAHA,KAAKiM,mBACH,MAvDL,gCAkEqBv2B,MAlErB,mCAmEwBA,GACtB9G,KAAK+nB,UAAY/nB,KAAK89B,UAAUh3B,KApElC,oEAuEsBuQ,EAAW0Q,EAAeC,GAvEhD,qGAwEsBhoB,KAAK+9B,YAAY1mB,EAAO0Q,EAAWC,GAxEzD,UAwEMqI,EAxEN,OAyEM2N,EAAW3N,EAAQpD,OACnBjtB,KAAKk9B,cA1EX,gBA6EG,IAFIh9B,EAAU,GACV+E,EAAM+4B,EAASh5B,OACV7C,EAAE,EAAGA,EAAE8C,EAAK9C,IAChB2E,EAAO9G,KAAKk9B,cAAcc,EAAS77B,GAAIkuB,GAC3CnwB,EAAIkC,KAAK0E,GA/Eb,yBAiFU5G,GAjFV,OAmFE,QAA4BO,IAAxBT,KAAKi9B,eAER,IADIh4B,EAAM+4B,EAASh5B,OACV7C,EAAE,EAAGA,EAAE8C,EAAK9C,IACpBnC,KAAKi9B,eAAee,EAAS77B,GAAIkuB,GAtFrC,yBAyFS2N,GAzFT,0IA6FQh+B,KAAKg9B,SAAU,EACfh9B,KAAKi+B,YAAa,EAClBj+B,KAAKk+B,QAAS,EACdl+B,KAAKqX,WAAQ5W,EACnBT,KAAKm+B,WAAY,EACjBn+B,KAAK+nB,eAAYtnB,EACXT,KAAKm9B,OAAO52B,UAnGpB,6BAuGWO,GACyB,SAAxB9G,KAAK09B,eACL19B,KAAKm9B,OAAOlI,QAAQnuB,GAEpB9G,KAAKm9B,OAAO/6B,KAAK0E,KA3G7B,qEA8GgBuQ,GA9GhB,wEA+GQrX,KAAKo+B,QACLp+B,KAAKi+B,YAAa,EAClBj+B,KAAKqX,MAAQA,EAjHrB,SAkHcrX,KAAK6sB,OAlHnB,wRAuHyBpsB,IAAnBT,KAAK29B,UAvHX,uBAwHG74B,QAAQ7C,MAAM,sEAxHjB,8BA2HwB,IAAlBjC,KAAK49B,SA3HX,iDA4HE59B,KAAK49B,UAAW,EACZhpB,EAAQ5U,KAAKm9B,OACbkB,EAA2B,QAAnBr+B,KAAK29B,UAKW,SAAxB39B,KAAK09B,gBAERY,EAAU1pB,EAAM,GAChB2pB,EAAcv+B,KAAKo9B,YACnBoB,EAAW,SAAC13B,GAAD,OAAY8N,EAAMqgB,QAAQnuB,MAKjC23B,EAAW7pB,EAAM5P,OACrBs5B,EAAU1pB,EAAM6pB,EAAS,GACzBF,EAAcv+B,KAAKu9B,eACnBiB,EAAW,SAAC13B,GAAD,OAAY8N,EAAMsgB,OAAOuJ,EAAU,EAAG33B,KAE9C43B,EAAU1+B,KAAK89B,UAAUQ,GACzBK,OAAMl+B,EACNm+B,EAAM,EAAGxJ,EAAM,GAnJrB,aAoJQwJ,EAAMxJ,GApJd,kCAqJmBp1B,KAAK6+B,KAAK7+B,KAAKqX,MAAOsnB,EAAK,GArJ9C,WAqJOz+B,EArJP,OAuJe,KADR+E,EAAM/E,EAAI8E,QAtJjB,qDAyJY7C,EAAE,EAzJd,aAyJiBA,EAAE8C,GAzJnB,oBA0JQ6B,EAAO5G,EAAIiC,GACfw8B,EAAM3+B,KAAK89B,UAAUh3B,IACP,IAAVu3B,EA5JR,sBA6JSM,GAAOD,GA7JhB,wBA8JMtJ,EAAM,EA9JZ,0DAmKSuJ,GAAOD,GAnKhB,wBAoKMtJ,EAAM,EApKZ,6BAwKIoJ,EAAS13B,KASP83B,EAjLN,QAyJwBz8B,IAzJxB,gDAoLEnC,KAAK49B,UAAW,EACZgB,EAAM,GACTL,IAtLH,2PA+LwB,IAAlBv+B,KAAK49B,SA/LX,wDAgME59B,KAAK49B,UAAW,EAhMlB,SAiMkB59B,KAAK6+B,KAAK7+B,KAAKqX,WAAO5W,EAAWT,KAAKy9B,UAAUz9B,KAAKgoB,SAAUhoB,KAAKy9B,UAAUz9B,KAAKgoB,UAjMrG,OAiMM9nB,EAjMN,OAkMEF,KAAKm9B,OAAO52B,QACZvG,KAAK8+B,UAAU5+B,GAiBfF,KAAK49B,UAAW,EApNlB,6IAuN4B92B,GAC1B,OAAO9G,KAAK89B,UAAUh3B,KAxNxB,6lBA+N+B,IAAnB9G,KAAKm+B,UA/NjB,0CA+N4C,GA/N5C,WAgOuB,IAAjBn+B,KAAK++B,QAhOX,0CAgOoC,GAhOpC,WAiOwB,IAAlB/+B,KAAK49B,SAjOX,0CAiOqC,GAjOrC,cAkOE59B,KAAK++B,SAAU,EACf/+B,KAAK49B,UAAW,EAnOlB,UAoOc59B,KAAKg/B,SApOnB,oBAqO+Bv+B,IAAnBT,KAAK+nB,WAAyB/nB,KAAKi/B,kBAAax+B,GAChDunB,EAAWhoB,KAAKgoB,SAAW,GACV,IAAjBhoB,KAAKg9B,SACDh9B,KAAKy9B,UAAYz9B,KAAKgoB,WAAUA,EAAWhoB,KAAKy9B,UAAU,GAxO1E,UA0OwBz9B,KAAK6+B,KACb7+B,KAAKqX,MACLrX,KAAK+nB,UACjBC,GA7OJ,eA0OY9nB,EA1OZ,OA8OQF,KAAKk+B,QAAS,EAChBj5B,EAAM/E,EAAI8E,QACY,IAAfhF,KAAKg9B,SAAkB/3B,EAAIjF,KAAKy9B,YACjB,IAAfz9B,KAAKg9B,SAAmB/3B,EAAIjF,KAAKgoB,UAElChoB,KAAKm+B,WAAY,IACfl5B,EACF/E,EAAIg1B,OAAOjwB,EAAK,IAGhBjF,KAAKm+B,WAAY,EAiB3Bn+B,KAAK8+B,UAAU5+B,GACfF,KAAKg9B,SAAU,EACfh9B,KAAKk/B,WACLl/B,KAAK49B,UAAW,EAChB59B,KAAK++B,SAAU,EA7QjB,mBA8QU/+B,KAAKm+B,WA9Qf,uIAiRmBlhB,GACjB,IAOqC,EAG/B,EAVFhY,EAAMgY,EAAKjY,OACG,IAARC,GACTjF,KAAKi/B,kBAAax+B,GACTT,KAAKm9B,OAAO52B,UAGrBvG,KAAKi/B,aAAahiB,EAAKhY,EAAI,IACC,SAAxBjF,KAAK09B,gBACR,EAAA19B,KAAKm9B,QAAO/6B,KAAZ,oBAAoB6a,KAGpB,EAAAjd,KAAKm9B,QAAOlI,QAAZ,oBAAuBhY,EAAKkiB,eA7RhC,+BAkSUr4B,GAAa,IAAD,OAChB63B,EAAM3+B,KAAK89B,UAAUh3B,GACrBe,EAAQyI,IAAE0f,UAAUhwB,KAAKm9B,QAAQ,SAAA91B,GAAC,OAAI,EAAKy2B,UAAUz2B,KAAOs3B,KAChE,KAAI92B,EAAQ,GACZ,OAAO7H,KAAKm9B,OAAOt1B,KAtSrB,4BAcQ,OAAwB,IAApB7H,KAAKi+B,WAA4B,MACjB,IAAhBj+B,KAAKk+B,OACFl+B,KAAKm9B,YADZ,MAfR,0CAQKjpB,KARL,yEAQmC,KARnC,wCASKA,KATL,yEAS8C,KAT9C,oCAUKA,KAVL,yEAU4C,KAV5C,uCAYKA,KAZL,yEAYqC,KAZrC,iCAaK0iB,KAbL,sGA2BK1iB,KA3BL,wEA2BgC,WA3BhC,uCA4BKA,KA5BL,wEA4BmC,cA5BnC,I,wGCmCa7H,EAAa,I,iDArCd+yB,YAAc,E,KACdC,YAAqD,G,KACrDC,YAA4E,G,qEAItF,IAEIC,EAFAC,EAAOx/B,KAAKo/B,cACZK,EAAK,wCAET,cAAeA,GACd,IAAK,SACJF,EAAO,wCACPv/B,KAAKs/B,YAAYE,GAAQ,CAACh9B,KAAKi9B,EAAOF,WACtC,MACD,IAAK,WACJv/B,KAAKq/B,YAAYG,GAAQC,EAG3B,OAAOD,I,+CAEoBE,UACd1/B,KAAKq/B,YAAYK,UACjB1/B,KAAKs/B,YAAYI,K,wEAEbl8B,G,iFACNm8B,EAASn8B,EAATm8B,M,cACS3/B,KAAKq/B,a,oDAAVl9B,E,oBACCnC,KAAKq/B,YAAYl9B,GAAGqB,G,2CAEhBxD,KAAKs/B,a,iDAAVn9B,E,aACiBnC,KAAKs/B,YAAYn9B,GAAlCK,E,EAAAA,KAAM+8B,E,EAAAA,QACP/8B,IAASm9B,E,wEACPJ,EAAQ/7B,G,iOCAbqM,EAAb,WA+KC,aAA0E,IAAD,OAA7D0D,EAA6D,uDAAlD,KAAMqsB,EAA4C,wDAAnBxxB,EAAmB,uDAAL,IAAK,yBAdjEyxB,UAciE,OAbjEC,QAAkB,GAa+C,KAZjEC,cAYiE,OAXjEC,WAWiE,OAVjEC,aAUiE,OATjEC,gBASiE,OARjEC,wBAQiE,OAPjEC,sBAOiE,OANjEC,qBAMiE,OALjEC,mBAKiE,OAJjEC,mBAIiE,OAHjEC,0BAGiE,OAFjEC,YAEiE,OAkXjEC,kBAAoB,WAC3B57B,QAAQC,IAAI,qBACZ,EAAKnD,WAnXL5B,KAAK6/B,KAAO,KACZ7/B,KAAK+/B,SAAWH,EAChB5/B,KAAKggC,MAAU5xB,GAAO,IACtBpO,KAAKigC,SAAU,EACfjgC,KAAKkgC,YAAa,EAClBlgC,KAAKmgC,mBAAqB,KAC1BngC,KAAKogC,iBAAmB,KACxBpgC,KAAKqgC,gBAAkB,KACvBrgC,KAAKsgC,eAAiBV,GAAW/vB,EAAO8wB,uBAExC3gC,KAAKugC,cAAgB,KACrBvgC,KAAKwgC,qBAAuB,YAExBjtB,EACHvT,KAAK6/B,KAAOD,EAAUrsB,EAAEvB,QAAQ,MAAO,IAAMhS,KAAKggC,OAASzsB,EAAEvB,QAAQ,MAAO,IAClE4tB,IACV5/B,KAAK6/B,KAAO7/B,KAAK4gC,QAAQhjB,MAAM5d,KAAKggC,OAAO,GAAGhuB,QAAQ,MAAO,IAAMhS,KAAKggC,QAGzEhgC,KAAK6gC,UACL7gC,KAAK8gC,kBApMP,wEASE,QACoB,qBAAX57B,SACPA,OAAOuB,UACPvB,OAAOuB,QAAQC,aAZnB,4BAgBsB+uB,GACpB,OAAIA,aAAa5xB,OAAe4xB,EACzB5lB,EAAOkxB,SAAStL,KAlBzB,+BAoByBA,GACvB,OAAOA,EAAEzjB,QAAQ,OAAQ,IAAIA,QAAQ,OAAQ,QArB/C,2CAwBqCgvB,EAAaC,GAChD,OAAqB,IAAjBA,EAAMj8B,OAAqB,KAC1Bg8B,EACEA,EACJviB,MAAM,EAAGuiB,EAAMh8B,QACfk8B,QAAO,SAACvgC,EAAQ8W,EAAO5P,GAGxB,OAFe,OAAXlH,IAAiBA,EAAS,IAC9BA,EAAOsgC,EAAMp5B,IAAUs5B,mBAAmB1pB,GACnC9W,IACJ,MAPc,OA1BrB,6CAoCuC8P,GACrC,IAAI2wB,EAAsB,GAc1B,MAAO,CAAEC,OAZL5wB,aAAiB5M,OACX4M,EAGA,IAAI5M,OACZ4M,EAAMuB,QAAQnC,EAAOyxB,kBAAkB,SAAUC,EAAMC,EAAM75B,GAE3D,OADAy5B,EAAWh/B,KAAKuF,GACTkI,EAAO4xB,2BAEdzvB,QAAQnC,EAAO6xB,gBAAiB7xB,EAAO8xB,kBAAoB9xB,EAAO+xB,yBAClE/xB,EAAOgyB,oBAEMT,gBAnDnB,kCAsD4B1/B,GAC1B,OAAOA,EAAIsQ,QAAQ,MAAO,IAAI4L,MAAM,KAAK5Y,SAvD3C,sCA0DgC88B,EAAaC,GAC3C,OAAOlyB,EAAOmyB,YAAYD,GAAQlyB,EAAOmyB,YAAYF,KA3DvD,wCA8DkCpgC,GAAkC,IAAtBugC,EAAqB,uDAAJ,GAC7D,OAAOA,EAAOr6B,KAAI,SAAA6I,GAAU,IAAD,EACGZ,EAAOqyB,uBAAuBryB,EAAOsyB,MAAM1xB,EAAMA,QAAxE4wB,EADoB,EACpBA,OAAQD,EADY,EACZA,WACVJ,EAAQt/B,EAAIsQ,QAAQ,OAAQ,KAAKgvB,MAAMK,GACvC1gC,EAASkP,EAAOuyB,qBAAqBpB,EAAOI,GAChD,QAAOJ,GAAQ,CAAEA,QAAOvwB,QAAO9P,aAC7B0hC,QAAO,SAAAC,GAAC,OAAIA,OApEjB,4BAuEsB5gC,EAAYugC,GAChC,OAAOpyB,EAAO0yB,kBAAkB7gC,EAAKugC,GAAQ,KAAM,IAxErD,2BA2EqBvgC,EAAYugC,GAC/B,IAAMO,EAAW3+B,OAAO,gBAAiB,KAErC4+B,EAAUR,EAAOr6B,KACpB,SAAA6I,GACC,IAAI8C,EAAI9C,EAAMA,MACd,GAAU,KAAN8C,GAAkB,MAANA,EAAW,OAAO7R,EACjB,kBAAN6R,IACVA,EAAIA,EAAEvB,QAAQwwB,EAAU,gCAEzB,IAAIE,EAAWnvB,EARL,GAUV,OADU7R,EAAIkc,MAAM,IAAI/Z,OAAO6+B,IAAW,MAIxCC,EAAc9yB,EAAOkxB,SAASr/B,GAC9BuD,EAAMw9B,EAAQz9B,OAClB,GAAY,IAARC,EAAW,OAAO09B,EACtB,IAAIC,EAAWH,EAAQ,GACvB,OAAY,IAARx9B,EAAkB29B,EACfH,EAAQvB,QAAO,SAAClhB,EAAQte,GAE9B,OADIse,EAAOhb,OAAStD,EAAIsD,SAAQgb,EAASte,GAClCse,IACL4iB,KAlGL,iDAsGE,MAAyB,qBAAX19B,QAA0B,iBAAkBA,SAtG5D,2CAyGqCxD,GACnC,OAAOA,EAAIkc,MAAM,YAAYa,MAAM,GAAG2F,KAAK,MA1G7C,iCA6G2B1iB,EAAYk+B,EAAiBxxB,GACtD,IAAmBwP,EACfilB,EAAgB,SAAClsB,GAAD,OAAgBA,EAAIiH,MAAM,YAAY,IAc1D,MAZoB,qBAATxP,IAEVA,EAAO,KAGJyB,EAAO8wB,yBAA2Bf,EACzBiD,EAAcnhC,GAAKkc,MAAMxP,GAAM,IAG3CwP,EAAQlc,EAAIkc,MAAMxP,IACFpJ,OAAS,EAAI69B,EAAcjlB,EAAM,IAAMilB,EAAcjlB,EAAM,MA3H9E,kCAgI4B2hB,EAAmBuD,EAAaniC,EAAaoiC,GACvE,GAAID,GAA0B,kBAAVA,EAAoB,CACvC,GAAIA,EAAME,OAMT,YALAF,EAAME,QAAO,WAAyB,IAAxBC,IAAuB,yDAChCA,IACL1D,IACAuD,EAAMI,OAASJ,EAAMI,MAAMviC,MACxBA,GAGC,GAAImiC,EAAMI,MAGd,OAFA3D,SACAuD,EAAMI,OAASJ,EAAMI,MAAMviC,IAI7B4+B,MAhJF,mCAmJ6B79B,EAAYk+B,EAAiBxxB,GACxD,GAAIyB,EAAO8wB,yBAA2Bf,EACpC,OAAO,EAGT,IAAKl+B,EAAIs/B,MAAM5yB,GACb,OAAO,EAGT,IAAIwP,EAAQlc,EAAIkc,MAAMxP,GAEtB,OAAOwP,EAAM5Y,OAAS,GAAkB,KAAb4Y,EAAM,OA9JnC,8CAuMUiL,GAA+C,IACnD9D,EADiBrU,EAAiC,wDAGtD,GADAmY,EAAOA,GAAQ,GACX7oB,KAAKsgC,cAGRvb,GADAA,GADAA,GAAOrU,EAAmC,GAAxB1Q,KAAKmjC,WAAa,KAAYta,EAAK7W,QAAQ,OAAQ,MAC7DA,QAAQ,kBAAmB,QAC3BA,QAAQ,UAAW,KAC3BhS,KAAKojC,eAAe,GAAI,GAAIre,GAC5B/kB,KAAK4B,eAED,GAAsB,qBAAXsD,OAAwB,CACvC2jB,EAAOA,EAAK7W,QAAQ,IAAInO,OAAO,IAAM7D,KAAKggC,OAAQ,IADX,MAEtB96B,OAAZwG,EAFkC,EAElCA,SACLA,EAAS0H,KAAO1H,EAAS0H,KACvBpB,QAAQ,KAAM,IACdA,QAAQ,IAAInO,OAAO7D,KAAKggC,MAAQ,OAAQ,IAAMhgC,KAAKggC,MAAQnX,EAE9D,OAAO7oB,OAxNT,2BA+N2B,IAAD,OACpBqjC,EAAI,wCACJC,EAAI,wCACR,cAAeD,GACd,IAAK,WACJrjC,KAAKqgC,gBAAkB,CAAEd,QAAS8D,EAAMP,MAAOQ,GAC1CtjC,KAAKogC,mBACTpgC,KAAKogC,iBAAmBpgC,KAAKqgC,iBAE9B,MACD,IAAK,SACJ,IAAIkD,EAAgB3tB,OAAOD,KAAK0tB,GAAMG,KAAK3zB,EAAO4zB,iBAClDF,EAAcjuB,SAAQ,SAAA7E,GAAK,OAAI,EAAKV,GAAGU,EAAO4yB,EAAK5yB,OACnD,MACD,QACC,GAAI,UAAKzL,OAAS,EAAG,MACrB,GAAa,MAATq+B,EAAc,CACjBrjC,KAAKqgC,gBAAkB,CACtBd,QAAyB,kBAAT+D,EAAmBA,EAAKI,KAAOJ,EAC/CR,MAAM,UAAD,+BAEN,MAED9iC,KAAK2jC,KAAKN,EAAMC,EAAhB,yCAGF,OAAOtjC,OAzPT,0BA4PKu/B,GAWH,OAV6B,OAAzBv/B,KAAKqgC,iBAA4Bd,IAAYv/B,KAAKqgC,gBAAgBd,QACrEv/B,KAAKqgC,gBAAkB,KAEW,OAA1BrgC,KAAKogC,kBAA6Bb,IAAYv/B,KAAKogC,iBAAiBb,UAC5Ev/B,KAAKogC,iBAAmB,MAEzBpgC,KAAK8/B,QAAU9/B,KAAK8/B,QAAQoB,QAAO,SAAClhB,EAAQzM,GAE3C,OADIA,EAAEgsB,UAAYA,GAASvf,EAAO5d,KAAKmR,GAChCyM,IACL,IACIhgB,OAvQT,+BA0QUu/B,EAAmBuD,GAE3B,OADA9iC,KAAKogC,iBAAmB,CAAEb,UAASuD,SAC5B9iC,OA5QT,8BA+QS4jC,GAAkB,IAAD,OACpB/e,EAAI+e,GAAW5jC,KAAK4gC,QACpBf,EAAO7/B,KAAKmjC,WACZzhC,EAAMmjB,EAAE7S,QAAQ6tB,EAAM,IAE1B,GAAI7/B,KAAK+/B,SAAU,CAElBr+B,EAAMA,EAAIsQ,QAAQ,IAAInO,OADV,OACuB7D,KAAKggC,OAAQ,KAGjD,IAAI6D,EAAgBh0B,EAAOi0B,qBAAqBF,GAAW5jC,KAAK4gC,SAC5DmD,EAAUl0B,EAAOm0B,WAAWtiC,EAAK1B,KAAK+/B,SAAU//B,KAAKggC,OAKzD,IAJgC,IAA5B+D,EAAQ7kB,WAAW,OACtB6kB,EAAU,IAAMA,GAGb/jC,KAAKigC,QAAS,OAAO,EAEzB,GACCjgC,KAAKmgC,oBACL4D,IAAY/jC,KAAKmgC,mBAAmBz+B,KACpCmiC,IAAkB7jC,KAAKmgC,mBAAmB5S,MAK1C,OAHIvtB,KAAKmgC,mBAAmB2C,OAAS9iC,KAAKmgC,mBAAmB2C,MAAMmB,SAClEjkC,KAAKmgC,mBAAmB2C,MAAMmB,QAAQjkC,KAAKmgC,mBAAmBx/B,SAExD,EAGR,IAAI8hC,EAAU5yB,EAAOmxB,MAAM+C,EAAS/jC,KAAK8/B,SAErCoE,EAAc,SAAC3E,GAClB1vB,EAAOq0B,aAAY,WAClBr0B,EAAOq0B,aAAY,WAClB,EAAKC,aACL,EAAKhE,mBAAqB,CACzBz+B,IAAKqiC,EACLxW,MAAOsW,EACPf,MAAOvD,EAAQuD,OAEhBvD,EAAQA,QAAQsE,KACdtE,EAAQuD,SACT,EAAKvC,gBAGT,IAAgB,IAAZkC,EACH,OAAIziC,KAAKqgC,kBACI,KAAZ0D,GACY,MAAZA,GACAA,IAAY/jC,KAAKggC,OACjBnwB,EAAOu0B,aAAaL,EAAS/jC,KAAK+/B,SAAU//B,KAAKggC,SAejDkE,EAAYlkC,KAAKqgC,kBACV,IAECrgC,KAAKogC,kBAcb8D,EAAYlkC,KAAKogC,mBAEX,GAER,IAAIkC,EAAIG,EACR,GAAIH,EAAG,CACNtiC,KAAKmkC,aACLnkC,KAAKmgC,mBAAqB,CACzBz+B,IAAKqiC,EACLxW,MAAOsW,EACPf,MAAOR,EAAE7xB,MAAMqyB,MACfniC,OAAQ2hC,EAAE3hC,OACVgH,KAAM26B,EAAE7xB,MAAM9I,MAEf,IAAI43B,EAAU+C,EAAE7xB,MAAM8uB,QAQtB,OAPA1vB,EAAOq0B,aAAY,WAClBr0B,EAAOq0B,aAAY,WAClB5B,EAAE7xB,MAAMA,iBAAiB5M,OACzB07B,EAAO,WAAP,cAAY+C,EAAEtB,MAAMviB,MAAM,EAAG6jB,EAAEtB,MAAMh8B,UACrCu6B,EAAQ+C,EAAE3hC,OAAQkjC,KAChBvB,EAAE7xB,MAAMqyB,MAAOR,EAAE3hC,OAAQ,EAAK4/B,iBAC/BvgC,KAAKugC,cAAe+B,EAAE3hC,QAClB2hC,KAvXV,gCA4XEtiC,KAAK8/B,QAAU,GACf9/B,KAAKkgC,YAAa,EAClBlgC,KAAKmgC,mBAAqB,KAC1BngC,KAAKugC,cAAgB,KACrBx6B,aAAa/F,KAAKygC,QACI,qBAAXv7B,SACVA,OAAOqsB,oBAAoB,WAAYvxB,KAAK0gC,mBAC5Cx7B,OAAOqsB,oBAAoB,aAAcvxB,KAAK0gC,sBAnYjD,wCAuYoB,IAAD,OAEO,qBAAbj1B,UACVzL,KAAKqkC,aAAa/uB,SAAQ,SAAAgvB,GACrBA,EAAKC,sBACTD,EAAK3+B,iBAAiB,SAAS,SAACoP,GAC/B,IAAIA,EAAEyvB,SAAWzvB,EAAE0vB,UAAsD,MAA1C1vB,EAAE4Z,cAAc+V,QAAQ12B,cAAwB,OAAO,EACtF,IAAItC,EAAW,EAAKi5B,YAAYL,GAE3B,EAAKpE,aACTnrB,EAAEwkB,iBACF,EAAKvpB,SAAStE,EAASsG,QAAQ,OAAQ,IAAIA,QAAQ,OAAQ,UAG7DsyB,EAAKC,qBAAsB,QArZ/B,+BA0ZU58B,GAA6B,IAAhBsV,EAAe,uDAAJ,GAC5B+C,EAAShgB,KAAK8/B,QAAQoB,QAAO,SAAClhB,EAAQvP,GACzC,GAAIA,EAAM9I,OAASA,EAElB,IAAK,IAAIhB,KADTqZ,EAASvP,EAAMA,MAAMohB,WACL5U,EACf+C,EAASA,EAAOhO,QAAQ,IAAMrL,EAAKsW,EAAKtW,IAG1C,OAAOqZ,IACL,IAEH,OAAOhgB,KAAK+/B,SAAW//B,KAAKggC,MAAQhgB,EAASA,IAra/C,2BAwaM6I,GACJ,OAAO7oB,KAAKmjC,WAAata,IAza3B,8BA4a+B,IAAxB+b,IAAuB,yDAC5B5kC,KAAKigC,QAAU2E,EAEd5kC,KAAKwgC,qBADFoE,EACyB,eAGA,cAlb/B,+BAubE5kC,KAAK6kC,OAAM,KAvbb,6CA0bwBptB,GACtB,MAAqB,qBAAVA,EAA8BzX,KAAKwgC,sBAC9CxgC,KAAKwgC,qBAAuB/oB,EACrBA,KA7bT,iDAicO5H,EAAO8wB,wBACX3gC,KAAK8kC,YAlcR,0CAucE,OAAO9kC,KAAKmgC,qBAvcd,kCA0camE,GACX,OAAOA,EAAKvwB,aAAa,UA3c3B,2IA8cO+uB,GACL9iC,KAAKugC,cAAgBuC,MA/cvB,2BAkdcryB,EAAqB8uB,EAA8BuD,GAoB/D,MAnBqB,kBAAVryB,IACVA,EAAQsY,UAAUtY,IAEnBzQ,KAAK8/B,QAAQ19B,KACO,kBAAZm9B,EACP,CACC9uB,QACA8uB,QAASA,EAAQmE,KACjB/7B,KAAM43B,EAAQwF,GACdjC,MAAOA,GAASvD,EAAQuD,OAGzB,CACCryB,QACA8uB,UACA53B,UAAMlH,EACNqiC,UAGK9iC,KAAK2jC,OAted,qCAyewB1mB,EAAU1Z,EAAc7B,GAC9C,OAAQ1B,KAAKwgC,sBACZ,QAAS,MAAM5xB,MAAM,yBAA2B5O,KAAKwgC,sBACrD,IAAK,YAAyD,YAA5Ct7B,OAAOuB,QAAQC,UAAUuW,EAAM1Z,EAAO7B,GACxD,IAAK,eAA+D,YAA/CwD,OAAOuB,QAAQu+B,aAAa/nB,EAAM1Z,EAAO7B,MA7ejE,iCAkfE,GAAkB,OAAd1B,KAAK6/B,KAAe,CACvB,IACIoF,EADOjlC,KAAK4gC,QACIhjB,MAAM,KAAK,GAC/B5d,KAAK6/B,KAAOhwB,EAAOgwB,KAAKoF,EAAUjlC,KAAK8/B,SAGxC,OADW9/B,KAAK6/B,KAAK7tB,QAAQ,QAAS,MAvfxC,gCA2foB,IAAD,OACjB,GAAIhS,KAAKsgC,cACRp7B,OAAOS,iBAAiB,WAAY3F,KAAK0gC,wBAErC,GAAI7wB,EAAOq1B,2BACfhgC,OAAOS,iBAAiB,aAAc3F,KAAK0gC,uBAEvC,CACJ,IAAIyE,EAASnlC,KAAK4gC,SAEN,SAARwE,IACH,IAAIxB,EAAU,EAAKhD,QACfuE,IAAWvB,IACduB,EAASvB,EACT,EAAKhiC,WAEF,EAAK6+B,QAAQ16B,aAAa,EAAK06B,QACnC,EAAKA,OAAS36B,WAAWs/B,EAAO,KAEjCA,MA9gBH,8BAmhBE,GAAsB,qBAAXlgC,OAAwB,KAI7BkO,EAAQlO,OAAOwG,SAAf0H,KACL,OAAOvD,EAAOkxB,SAAS3tB,GAExB,MAAO,KA1hBT,mCA8hBE,MAAO,GAAGqL,MAAMgN,KAAKhgB,SAAS45B,iBAAiB,oBA9hBjD,mCAuiBE,IAAMC,EAAoBtlC,KAAKmgC,mBAC/B,GAAImF,EAAmB,CAAC,IAClB3kC,EAAiB2kC,EAAjB3kC,OAAQmiC,EAASwC,EAATxC,MACTA,GACCA,EAAMyC,OACTzC,EAAMyC,MAAM5kC,QA5iBjB,KAAakP,EACGyxB,iBAAmB,eADtBzxB,EAEG6xB,gBAAkB,MAFrB7xB,EAGG4xB,wBAA0B,YAH7B5xB,EAIG8xB,iB,SAJH9xB,EAKG+xB,yBAA2B,aAL9B/xB,EAMGgyB,mBAAqB,GA8iBf,IAAIhyB,G,4ICxkBnB,SAASwM,EAAiB9a,EAAwB0a,GACrD,IAAIupB,EAAM,uCAAG,4BAAAlkC,EAAA,sEACH4B,IAAIQ,OADD,QAEV4T,EAAa/V,EAAb+V,YACUA,IAHA,2CAAH,qDAgBTyb,EAAI7vB,IAAI8D,MAAQ,GAAK9B,OAAOC,OAASD,OAAOE,IAC3C1B,EAA8CnC,EAA9CmC,KAAMmW,EAAwCtY,EAAxCsY,MAAOsC,EAAiC5a,EAAjC4a,OAAQvC,EAAyBrY,EAAzBqY,OAAQrX,EAAiBhB,EAAjBgB,UAAW6mB,EAAM7nB,EAAN6nB,GAC7C,IAAiB,IAAbnN,GAAuBvY,GAASmW,GAAUsC,EAA9C,CACA,IAAIspB,EAAWC,EACf,QAAejlC,IAAXmZ,GAAwB1U,OAAOC,OAASD,OAAOE,MAC3B,mBAAXwU,IAAmC,IAAXA,GACd,oBAAXA,GACX,CAAC,IACKjQ,EAAQzG,IAARyG,KACL,QAAalJ,IAATkJ,EAAoB,CAAC,IACnBsH,EAActH,EAAdsH,KAAMtJ,EAAQgC,EAARhC,KACX+9B,EAAc,sBAAKnjC,UAAU,4BAAf,UACb,uBAAOA,UAAU,aAAjB,SAA+B0O,GAAQtJ,IAGtC,qBAAKpF,UAAU,gCACdo2B,KAAK,SACLl2B,QA5BiB,WACtB,IAAImX,EAAM,uCAAG,4BAAAtY,EAAA,yDAEU,oBADjBsY,EAAUrY,EAAVqY,QADO,gCAGLA,IAHK,uBAKN1W,IAAI0W,YAAOnZ,GALL,2CAAH,qDAOVyC,IAAI2G,WAAW+P,IAkBX,SAGC,mBAAGrX,UAAU,+BAOnB,GAAIwwB,EACH,OAAQxxB,EAAMmC,MACb,IAAK,OACJ+hC,OAAQhlC,EACR,MACD,QACA,IAAK,OAGL,IAAK,QACJglC,EAAQ,qBAAKhjC,QAAS+iC,EAAd,SAAuBtiC,IAAIoH,WAIlCpF,OAAOC,OAASD,OAAOE,KAC1BN,QAAQC,IAAI0G,SAASC,SAAS0H,WAGjB3S,IAAVglC,GAAyC,kBAAXtpB,IACjCA,EAAS,qBAAK5Z,UAAU,OAAf,SAAuB4Z,KAEjC,IAAIwpB,GAAa9rB,GAAS6rB,IAAgB,kCAAQ7rB,EAAR,IAAgB6rB,KACtD7iC,EAAS,yBAAQN,UAAWA,EAAnB,UACZ,gCACEkjC,EAED,8BAAMtpB,IACLwpB,KAEDvc,KAEF,OAAiB,IAAbnN,EAA0BpZ,EACvB,qCACN,yBAASN,UAAU,iBAAnB,SAAqCM,IACpCA,MAI6BH,a,6NCvD1BkjC,G,qFAEFj+B,U,2CAEAwQ,a,OACH0tB,oB,OACA7tB,U,OACG8tB,Y,OACAjH,U,OACHkH,a,OACAhsB,c,OACAE,iB,OACAG,oB,OACA7X,e,OAEWyjC,c,wKAoBiBvlC,IAAjBT,KAAK+lC,Q,gCACC/lC,KAAK+lC,U,eAEGtlC,IAAdT,KAAK6+B,K,oBACM,IAAhB7+B,KAAKk+B,O,gCACFl+B,KAAK6+B,O,OACX7+B,KAAKk+B,QAAS,E,oIAvBhB,OAAIl+B,KAAK6+B,OAAwB,IAAhB7+B,KAAKk+B,OAAyB,OACzB,IAAlBl+B,KAAKimC,UACJjmC,KAAKgmC,gBACmBvlC,IAAxBT,KAAK6lC,eACR7lC,KAAKgmC,SAAWhmC,KAAK6lC,sBAECplC,IAAdT,KAAKgY,KACbhY,KAAKgmC,SAAWhmC,KAAKgY,KAAKlN,UAG1B9K,KAAKgmC,SAAW,qBAAKzjC,UAAU,MAAf,kEATkBvC,KAAKgmC,c,yCAlBzC9xB,K,yEAAqC,K,sCAElCA,K,iEAoDQ8H,GAAb,aASI,WAAYza,GAAmB,IAAD,gCARzBA,WAQyB,OAPtByrB,UAOsB,OANtBkZ,WAMsB,OAJtBC,SAIsB,gFAsC9BC,SAtC8B,uCAsCnB,WAAOC,GAAP,SAAA/kC,EAAA,yDACR+kC,EADQ,wBAGA5lC,KADZ4lC,EAAM,EAAKC,aAFC,wBAIS7lC,IAAhB,EAAK8lC,OAJE,oDAKgB,IAAvB,EAAKA,OAAOvhC,OALL,iDAMXqhC,EAAM,EAAKE,OAAO,GANP,cAUP,EAAKD,YAAYL,UAAW,EAC5BI,EAAIJ,UAAW,EACrB,EAAKK,YAAcD,EAZN,UAcPA,EAAIG,QAdG,4CAtCmB,2DAiEzBC,KAAOlrB,aAAS,WAAO,IAEpBmrB,EAA2BC,EAFR,EACU,EAAKplC,MAAjCqlC,EADkB,EAClBA,YAAaC,EADK,EACLA,YAEdA,IACAH,EAAQ,CACJG,YAAaA,EACbC,YAAa,QACbC,eAAgB,EAChBC,gBAAiB,EACjBC,iBAAkB,EAClBC,kBAAmB,GAEvBP,EAAQ,CACJE,YAAaA,EACbC,YAAa,QACbC,eAAgB,EAChBG,kBAAmB,EACnBF,gBAAiB,EACjBC,iBAAkB,GAEF,QAAhBL,GACAF,EAAMQ,kBAAoB,EAC1BR,EAAMS,oBAAsB,GAC5BT,EAAMU,qBAAuB,GAC7BT,EAAMI,eAAiB,IAGvBL,EAAMK,eAAiB,EACvBL,EAAMW,uBAAyB,GAC/BX,EAAMY,wBAA0B,GAChCX,EAAMO,kBAAoB,IAGxC,IAAI9T,EAAK9a,IAAW,UAAW,EAAK4tB,MAAO,EAAKC,IAAK,WAAa,EAAKnZ,MAoBvE,OAnBW,qBAAKzqB,UAAW6wB,EAAhB,SACA,EAAKmT,OAAO3+B,KAAI,SAACP,EAAEQ,GAAW,IAEvB0/B,EADCtB,EAA6B5+B,EAA7B4+B,SAAU9tB,EAAmB9Q,EAAnB8Q,QAAS2tB,EAAUz+B,EAAVy+B,OAExB,QAAerlC,IAAXqlC,EAAsB,CACtB,IAAI0B,EAAM1B,EAAO7lC,WACLQ,IAAR+mC,IACIA,EAAM,EAAGD,EAAe,4BAAIC,EAAI,GAAG,MAAMA,IACpCA,EAAM,IAAGD,EAAe,mBAAGhlC,UAAU,UAGtD,OAAO,qBAAiBE,QAAS,kBAAI,EAAK2jC,SAAS/+B,IAAIhF,OAAkB,IAAX4jC,EAAiBS,EAAMC,EAA9E,SAClB,gCACCY,EACApvB,EAAQ8tB,OAHmBp+B,WA9GC,KAyHjCiD,QAAUyQ,aAAS,WAClB,IAAIksB,EAAkC,CAAC3/B,WAAY,UACnD,OAAO,mCACL,EAAKy+B,OAAO3+B,KAAI,SAACP,EAAEQ,GAAW,IAI1B6/B,EAAgBC,EAKhB9kC,EAAYiX,EARX8sB,EAAe,EAAKrlC,MAApBqlC,YACA97B,EAAmEzD,EAAnEyD,QAASkN,EAA0D3Q,EAA1D2Q,KAAM+B,EAAoD1S,EAApD0S,SAAUE,EAA0C5S,EAA1C4S,YAAaG,EAA6B/S,EAA7B+S,eAAgB7X,EAAa8E,EAAb9E,UACvDkkC,EAAO/jC,gBAAoB,EAAK+jC,WAEvBhmC,IAATuX,IACH0vB,EAAa1vB,EAAKnV,SAClB8kC,EAAa3vB,EAAK8B,UAGnB,IAkCIzX,EAlCAyF,EAAiC,CAACA,WAAW,UAoCjD,MAnCoB,QAAhB8+B,GACH/jC,EAAS,qCACR,yBAASN,UAAU,iBAAnB,SACC,mCAASkkC,EAAMiB,OAEhB,yBAAQrlC,MAAOyF,EAAf,UAA4B2+B,EAAMiB,aAEhBjnC,IAAfknC,IACH7tB,EAAS,qCACR,wBAAQzX,MAAOyF,EAAf,SAA4B6/B,IAC5B,yBAASplC,UAAU,iBAAnB,SACC,iCAASolC,iBAMOlnC,IAAfinC,IACH7kC,EAAS,qCACR,yBAASN,UAAU,iBAAnB,SACC,iCAASmlC,MAEV,wBAAQrlC,MAAOyF,EAAf,SAA4B4/B,QAG9B5tB,EAAS,qCACR,yBAAQzX,MAAOyF,EAAf,UAA4B6/B,EAAYlB,KACxC,yBAASlkC,UAAU,iBAAnB,SACC,mCAASolC,EAAYlB,YAMP,IAAbp/B,EAAE4+B,WAAkB5jC,EAAQolC,GACzB,eAAC,IAAD,CAAwBllC,UAAWA,EACzCF,MAAOA,EACP0X,SAAUA,EAAUE,YAAaA,EAAaG,eAAgBA,EAFxD,UAGLvX,EACAiI,EACAgP,IALsBjS,WAzK1B7H,KAAKuB,MAAQA,EADmB,IAE3ByrB,EAA6CzrB,EAA7CyrB,KAAMyZ,EAAuCllC,EAAvCklC,KAAamB,EAA0BrmC,EAAjC2kC,MAAgBC,EAAiB5kC,EAAjB4kC,IAAKF,EAAY1kC,EAAZ0kC,SACtCjmC,KAAKgtB,KAAOA,GAAQ,KACdhtB,KAAKumC,OAASE,EAAK7+B,KAAI,SAAAP,GACnB,IAAIg/B,EAAM,IAAIT,EACTj+B,EAAqHN,EAArHM,KAAMwQ,EAA+G9Q,EAA/G8Q,QAASrN,EAAsGzD,EAAtGyD,QAASkN,EAA6F3Q,EAA7F2Q,KAAM8tB,EAAuFz+B,EAAvFy+B,OAAQjH,EAA+Ex3B,EAA/Ew3B,KAAMkH,EAAyE1+B,EAAzE0+B,QAAS8B,EAAgExgC,EAAhEwgC,WAAY9tB,EAAoD1S,EAApD0S,SAAUE,EAA0C5S,EAA1C4S,YAAaG,EAA6B/S,EAA7B+S,eAAgB7X,EAAa8E,EAAb9E,UAqB7G,OApBT8jC,EAAI1+B,KAAOA,GACQ,IAAfkgC,GAAuBlgC,IAASs+B,IACnC,EAAKK,YAAcD,GAEpBA,EAAIJ,UAAW,EACfI,EAAIluB,QAAUA,OACE1X,IAAZqK,EACHu7B,EAAIR,eAAiB/6B,OAEJrK,IAATuX,IACRquB,EAAIruB,KAAOA,GAGHquB,EAAIP,OAASA,EACbO,EAAIxH,KAAOA,EACpBwH,EAAIN,QAAUA,EACdM,EAAItsB,SAAWA,EACfssB,EAAIpsB,YAAcA,EAClBosB,EAAIjsB,eAAiBA,EACrBisB,EAAI9jC,UAAYA,EACA8jC,KAEXrmC,KAAKkmC,MAAQ0B,EAEb5nC,KAAKmmC,IAAMA,OACc1lC,IAArBT,KAAKsmC,cACdtmC,KAAKsmC,YAActmC,KAAKumC,OAAO,IAE1BvmC,KAAKsmC,YAAYL,UAAW,EA5CpC,qDA8Lc,IAGRpjC,EAAYiX,EAFX8sB,EAAe5mC,KAAKuB,MAApBqlC,YACDH,EAAO/jC,gBAAoB1C,KAAKymC,MAEhC3+B,EAAiC,CAACggC,QAAQ,QAO9C,MANoB,QAAhBlB,EACH/jC,EAAS,iCAAS4jC,IAGlB3sB,EAAS,iCAAS2sB,IAEZ,qCACL5jC,EACA7C,KAAKumC,OAAO3+B,KAAI,SAACP,EAAEQ,GACnB,IAAIxF,EAEJ,OADiB,IAAbgF,EAAE4+B,WAAkB5jC,EAAQyF,GACzB,qBAAiBvF,UAAW+V,IAAWjR,EAAE9E,WAAYF,MAAOA,EAA5D,SACLgF,EAAEyD,SADajD,MAIjBiS,SAlNJ,8CAMK5F,KANL,kGAOKA,KAPL,iEAuNCqH,YAAS,oDAEN,WAAYha,GAAmB,IAAD,8BAChC,cAAMA,IAFUwa,cACgB,EAEhC,EAAKA,SAAW,IAAIC,EAASza,GAC7BuE,YAAW,WACV,EAAKiW,SAASqqB,cAAS3lC,KACrB,KAL6B,EAFxB,qDAWR,OAAOT,KAAK+b,SAASvE,aAXb,GAA0B9U,cAenC6Y,YAAS,oDAEN,WAAYha,GAAmB,IAAD,8BAChC,cAAMA,IAFUwa,cACgB,EAEhC,EAAKA,SAAW,IAAIC,EAASza,GAC7BuE,YAAW,WACV,EAAKiW,SAASqqB,cAAS3lC,KACrB,KAL6B,EAFxB,qDAWR,OAAOiC,gBAAoB1C,KAAK+b,SAASjR,aAXjC,GAA8BpI,e,+RCjT3BqlC,GADZxsB,aACD,8MACYysB,eADZ,+CAwBIC,OAxBJ,uCAwBa,WAAOC,GAAP,qBAAA5mC,EAAA,6DACDkH,EAAStF,IAAIsF,OAAS,SACrB0/B,IAAUA,EAAW,EAAKC,iBAF1B,SAIDjlC,IAAIuM,aACAmZ,EAAU,IAAIwf,SACVC,OAAO,8BAA+B,KAN7C,SASe77B,MAAMhE,EAAQ,CAC1B1H,OAAQ,OACR6e,KAAMuoB,EACNtf,QAASA,IAZZ,cASGjc,EATH,iBAegBA,EAAID,OAfpB,eAeGA,EAfH,yBAgBM,IAAMA,EAAKC,IAAIc,IAhBrB,yCAmBD3I,QAAQ7C,MAAM,QAASuG,EAAvB,MAnBC,kBAoBM,CAACvG,MAAM,EAAD,KApBZ,yBAuBDiB,IAAI0M,UAvBH,6EAxBb,wDAmDY04B,cAAgB,SAAC7tB,GAA8C,IAC9D6tB,EAAiB,EAAK/mC,MAAtB+mC,cACDA,GAAeA,EAAc7tB,GAIjC,IAHA,IAAI8tB,EAAQ9tB,EAAIE,OAAO4tB,MACnBtjC,EAAMsjC,EAAMvjC,OACZi8B,EAAiB,GACZ9+B,EAAE,EAAGA,EAAE8C,EAAK9C,IACjB8+B,EAAM7+B,KAAKmmC,EAAMzhC,KAAK3E,GAAGwF,MAE7B,EAAK6gC,SAAWvH,EAAM7c,KAAK,OA5DnC,8DAI8B,IACjBqkB,EAAWzoC,KAAKuB,MAAhBknC,aACWhoC,IAAZgoC,GAAyBA,GAAW,EACpCA,EAAU,KAEVA,GAAoB,KAIxB,IAHA,IAAIF,EAAiBvoC,KAAKgoC,UAAUO,MAChCtrB,EAAO,IAAIyrB,SACXzjC,EAAMsjC,EAAMvjC,OACP7C,EAAE,EAAGA,EAAE8C,EAAK9C,IAAK,CACtB,IAAIwmC,EAAOJ,EAAMpmC,GACjB,GAAIwmC,EAAK3b,KAAOyb,EAAS,OAAO,KAChCxrB,EAAKorB,OAAO,UAAWM,EAAMA,EAAKhhC,SAhB9C,iCAqBQ,OAAO3H,KAAKgoC,UAAUO,MAAM,KArBpC,+BA+Dc,IAAD,SAC8BvoC,KAAKuB,MAAnCgB,EADA,EACAA,UAAWqmC,EADX,EACWA,SAAU1yB,EADrB,EACqBA,MAC1B,OAAO,gCACC,wBAAO3T,UAAU,0BAAjB,UACK2T,GAAS,2BACV,uBACI3T,UAAWA,EACX0vB,IAAK,SAAAhc,GAAC,OAAE,EAAK+xB,UAAU/xB,GACvBuE,SAAUxa,KAAKsoC,cACf9lC,KAAK,OAAOmF,KAAK,OACjBihC,SAAUA,EAAUvmC,MAAO,CAACylC,QAAQ,aAR7C,OAWE9nC,KAAKwoC,gBA5EtB,GAAiC9lC,aAAjC,sCAEKwR,KAFL,uEAiFA,SAAS20B,GAAW7b,GAAqD,IACjEzsB,EADyBuoC,EAAuC,uDAApB,EAAGC,EAAiB,uCAGpE,IADAA,EAAQA,GAAS,CAAE,IAAK,IAAK,IAAK,IAAK,OAC9BxoC,EAAOwoC,EAAMt0B,UAAYuY,EAAO,MACrCA,GAAc,KAElB,OAAiB,MAATzsB,EAAeysB,EAAOA,EAAKgc,aAAyBvoC,IAAhBqoC,EAA4B,EAAIA,IAAgBvoC,EAWhG,IAAM0oC,GAAa,KAEbC,GAAa,IAINC,GADZ5tB,aACD,sDAoBI,WAAYha,GAA4B,IAAD,8BACnC,cAAMA,IAnBL6nC,iBAkBkC,IAjBlCC,gBAiBkC,IAhB/BC,YAgB+B,IAf/BC,iBAe+B,wkBAM/BC,aAAe,SAAC/uB,GAIpB,GAHA,EAAKgvB,eAAYhpC,EACjB,EAAKipC,UAAW,EAChB,EAAKC,mBAAqBlvB,EAAIE,OAAO4tB,MAAMvjC,OAAS,EAChD,EAAK2kC,mBAAoB,CACzB,EAAKhB,KAAOluB,EAAIE,OAAO4tB,MAAM,GAC7B,IAAIl6B,EAAM,EAAKs6B,KAAKhhC,KAAK+W,YAAY,KAErC,GADIrQ,GAAO,IAAG,EAAKi7B,OAAS,EAAKX,KAAKhhC,KAAKuG,OAAOG,EAAI,GAAGL,eACtD,EAAKq7B,WAAWh2B,QAAQ,EAAKi2B,QAAU,EAEtC,YADA,EAAKG,UAAL,qDAA4B,EAAKJ,WAAWjlB,KAAK,MAAjD,8BAGJ,IAAIwlB,EAAS,IAAIC,WACjBD,EAAOE,cAAc,EAAKnB,MAC1BiB,EAAOG,OAAP,sBAAgB,sBAAAzoC,EAAA,sDACxB,EAAK0oC,SAAWJ,EAAO5pB,OADC,KAEhB,EAAKspB,OAFW,OAMlB,QANkB,sCAIhB,EAAKW,QAAQ,EAAK1oC,MAAMyrB,MAJR,iDAOtB,EAAKoc,YAAcF,GACnB,EAAKgB,WAAa,EAAKF,SAAShlC,OAChC,EAAKmlC,SAAW,EAAKH,SATC,mEApBe,EAqD/BI,SAAW,WACf,OAAO,IAAIj/B,SAAgB,SAACvJ,EAASC,GACjC,IAAIwoC,EAAM,IAAI7b,MACd6b,EAAIx3B,IAAM,EAAKm3B,SACfK,EAAIN,OAAS,WAAM,IAGVO,EAAiBD,EAAjBC,MAAOC,EAAUF,EAAVE,OACZ,EAAKC,YAAcF,EACnB,EAAKG,aAAeF,EACpB,IACRG,EAAU5hB,EADE6hB,EAAQL,EAAQC,EAE5B,EAAKnB,YAAc,GAIFkB,GAAS,EAAKlB,aAAemB,GAAU,EAAKnB,aAHhEsB,EAAIJ,EACJxhB,EAAIyhB,GAMgBI,EAAQ,EAEb7hB,GADA4hB,EAAI,EAAKtB,aACDuB,EAIRD,GADA5hB,EAAI,EAAKsgB,aACDuB,EAEZ,EAAKC,YAAc9mB,KAAK+mB,MAAMH,GAC9B,EAAKI,aAAehnB,KAAK+mB,MAAM/hB,GAC/B,IAEIiiB,EAASt/B,SAAS6P,cAAc,UAChC0vB,EAAMD,EAAOE,WAAW,MAExBC,EAAMz/B,SAAS0/B,gBAAgB,SACnCD,EAAIE,UAAYt4B,OAAO43B,GACvB,IAAIW,EAAM5/B,SAAS0/B,gBAAgB,UACnCE,EAAID,UAAYt4B,OAAOgW,GACvBiiB,EAAOO,iBAAiBJ,GACxBH,EAAOO,iBAAiBD,GACxBL,EAAIO,UAAUlB,EAAK,EAAG,EAAGK,EAAG5hB,GAC5B,IAAI0iB,EAAST,EAAOU,UAAU,SAAW,EAAKnC,OAZhC,IAaVoC,EAAO,EAAKC,uBAAuBH,GACvC,EAAKtB,WAAawB,EAAK1e,KACnB,EAAKkd,WAAa,UAClB,EAAKT,UAAY,2DACjB,EAAKE,oBAAqB,GAE9B/nC,EAAQ4pC,QAtGmB,EAuH/BvD,OAvH+B,sBAuHtB,sCAAA3mC,EAAA,yDACR,EAAKioC,YADG,wDAETrB,EAAW,IAAIQ,SACfgD,EAAO,EAAKC,uBAAuB,EAAKxB,UAC5CjC,EAASG,OAAO,QAASqD,EAAM,EAAK/C,KAAKhhC,MAJ5B,SAKG,EAAK4hC,YAAYtB,OAAOC,GAL3B,UAMM,kBADfhoC,EALS,yBAOJ+B,EAAS/B,EAAT+B,MACDO,SAAcP,EART,KAUDO,EAVC,OAWA,cAXA,QAYA,WAZA,QAaA,WAbA,gCAWaN,EAAM,mBAXnB,oCAYUA,EAAMD,EAZhB,oCAaUC,EAAMD,EAAMW,QAbtB,oCAcIV,EAAM4Q,OAAO5Q,GAdjB,oCAgBT,EAAKunC,UAAY,UAAYjnC,EAAO,MAAQN,EAhBnC,2BAmBb,EAAK26B,MAAQ38B,EACb,EAAK2a,UAAa,EAAKgiB,QAAU,EAAKt7B,MAAMkM,GAC5C,EAAKi8B,UAAW,EArBH,4CAvHsB,EA+I/B5M,QAAU,WAAsB,IAC/BA,EAAW,EAAKv7B,MAAhBu7B,QACLA,GAAWA,EAAQ,EAAKD,QAjJW,EAqJ/B+O,aAAe,WACnB1oC,IAAId,KAAK,cAAC,IAAD,CAAMS,OAAO,eAAb,SACL,qBAAKN,UAAU,kBAAf,SACI,cAAC,IAAD,CAAcA,UAAU,WAAWF,MAAO,CAACwpC,SAAS,QAASh5B,IAAK,EAAKm3B,iBAtJrF,EAAKnN,MAAQt7B,EAAMkM,GACnB,EAAK47B,WAAa9nC,EAAM8nC,YAAcF,EAAcE,WAHX,EApB3C,6FAwD0Brc,GAxD1B,sEAyDgBA,EAzDhB,OA2DiB,OA3DjB,OA6DiB,OA7DjB,OA+DiB,OA/DjB,OAiEQ,OAjER,OAmEQ,QAnER,8BA4DgBhtB,KAAKopC,YA/DH,IAGlB,mCA8DgBppC,KAAKopC,YAAcF,GA9DnC,mCAgEIlpC,KAAKopC,YArES,IAKlB,mCAkEIppC,KAAKopC,YAAcH,GAlEvB,oCAoEIjpC,KAAKopC,aAAe,EApExB,8CAsEwBppC,KAAKoqC,WAtE7B,QAsEEpqC,KAAKmqC,SAtEP,4JA+HmC2B,GAM3B,IALA,IAAIz3B,EAAMy3B,EAAQluB,MAAM,KACpBmuB,EAAO13B,EAAI,GAAG2sB,MAAM,WAAW,GAC/BgL,EAAOC,KAAK53B,EAAI,IAChB4Q,EAAI+mB,EAAKhnC,OACTknC,EAAQ,IAAIC,WAAWlnB,GACrBA,KACFinB,EAAMjnB,GAAK+mB,EAAK3rB,WAAW4E,GAE/B,OAAO,IAAImnB,KAAK,CAACF,GAAQ,CAAC1pC,KAAKupC,MAxIvC,iCAiLwB,IAAD,OACf,IAAI/rC,KAAKuB,MAAMyrB,KAAf,CACA,IAAI3Y,EAAM,CAAC,CAAC8D,QAAQ,eAAM6U,KAAK,OAW/B,IAVIhtB,KAAKyqC,aAAevB,IAAclpC,KAAKwqC,YAActB,KACrD70B,EAAIjS,KAAK,CAAC+V,QAAQ,eAAM6U,KAAK,QAE7BhtB,KAAKyqC,aA5LC,KA4L2BzqC,KAAKwqC,YA5LhC,MA6LNn2B,EAAIjS,KAAK,CAAC+V,QAAQ,eAAM6U,KAAK,QAE7BhtB,KAAKyqC,aAAexB,IAAcjpC,KAAKwqC,YAAcvB,MAC9D50B,EAAIjS,KAAK,CAAC+V,QAAQ,qBAAO6U,KAAK,OAC9B3Y,EAAIjS,KAAK,CAAC+V,QAAQ,eAAM6U,KAAK,WAEpB3Y,EAAIrP,OAAS,GACjB,OAAO,8BAAMqP,EAAIzM,KAAI,SAACP,EAAGQ,GAAW,IAC3BsQ,EAAiB9Q,EAAjB8Q,QAAS6U,EAAQ3lB,EAAR2lB,KACd,OAAO,wBAAmBzqB,UAAU,OAA7B,UAAoC,uBAAOC,KAAK,QAAQmF,KAAK,OAChE6S,SAAU,kBAAI,EAAKyvB,QAAQjd,IAC3Bqf,eAAwB,IAARxkC,IAFb,IAE4BsQ,IAFhBtQ,WAjM/B,+BAuMc,IAAD,OACAqO,EAASlW,KAAKuB,MAAd2U,MACD2D,EAAQ,wBACRtX,UAAU,gDACViZ,UAAWxb,KAAK6a,UAChBpY,QAASzC,KAAK88B,QAHN,0BAIZ,OAAO,cAAC,IAAD,CAAMj6B,OAAQqT,GAAS,2BAAQ2D,MAAOA,EAAtC,SACH,sBAAKtX,UAAU,0BAAf,UACI,gCACI,sBAAKA,UAAU,OAAf,UACI,cAACwlC,GAAD,CAAa9V,IAAK,SAAA5qB,GAAC,OAAE,EAAKkiC,YAAYliC,GAClCuhC,UAAU,EAAOH,QAAS,KAC1BvyB,MAAM,uCACNoyB,cAAetoC,KAAKwpC,eACxB,sBAAKjnC,UAAU,mBAAf,0BAAsCvC,KAAKqpC,WAAWjlB,KAAK,MAA3D,qCACCpkB,KAAKypC,WAAa,qBAAKlnC,UAAU,cAAf,SAA8BvC,KAAKypC,eAE1D,cAAC,KAAD,CAAKhiC,MAEiB,IAAlBzH,KAAK0pC,SACD,qBAAKnnC,UAAU,mBAAf,4CAEAvC,KAAK2oC,MAAQ3oC,KAAKkqC,WAAa,GAAK,sBAAK3nC,UAAU,8BAAf,UAChC,sBAAKA,UAAU,OAAf,UACKvC,KAAKssC,WACN,2DAAUtsC,KAAK4qC,YAAf,MAA+B5qC,KAAK8qC,aAApC,2CAEMjC,GAAW7oC,KAAKkqC,kBAG1B,wBAAQ3nC,UAAU,kBACdiZ,UAAWxb,KAAK2pC,mBAChBlnC,QAASzC,KAAKioC,OAFlB,6BAKZpuB,MAAO7Z,KAAKmqC,UACR,yBAAQ5nC,UAAU,sCAAsCE,QAASzC,KAAK4rC,aAAtE,uCACW/C,GAAW7oC,KAAK2oC,KAAK3b,MAAM,uBADtC,2BAEShtB,KAAKwqC,YAFd,MAE8BxqC,KAAKyqC,qBAK3C,qBAAKloC,UAAU,cACXF,MAAO,CACHqxB,QAAyB,IAAhB1zB,KAAK0pC,SAAiB,kBAAoB,kBACnD6C,QAAS,OAHjB,SAKI,cAAC,IAAD,CAAchqC,UAAU,WAAWF,MAAO,CAACwpC,SAAS,QAASh5B,IAAK7S,KAAKmqC,sBAvP3F,GAAmCznC,aAAnC,EACgB2mC,WAAa,CAAC,MAAO,MAAO,OAAQ,MAAO,MAAO,OAAQ,MAAO,MAAO,MAAO,OAAQ,MAAO,QAD9G,sCAMKn1B,KANL,uGAOKA,KAPL,wGAQKA,KARL,sGASKA,KATL,uGAUKA,KAVL,wGAWKA,KAXL,qGAYKA,KAZL,yEAY6C,KAZ7C,mCAaKA,KAbL,8GAcKA,KAdL,yEAcsD,KAdtD,sCAeKA,KAfL,oGAgBKA,KAhBL,qGAiBKA,KAjBL,oGAkBKA,KAlBL,yEAkB4C,KAlB5C,SAoQCqH,aACD,sDAgBI,WAAYha,GAA4B,IAAD,8BACnC,cAAMA,IAdF+nC,YAa+B,IAZlCC,iBAYkC,4YAK/BC,aAAe,SAAC/uB,GAIpB,GAHA,EAAKgvB,eAAYhpC,EACjB,EAAKipC,UAAW,EAChB,EAAKC,mBAAqBlvB,EAAIE,OAAO4tB,MAAMvjC,OAAS,EAChD,EAAK2kC,mBAAoB,CACzB,EAAKhB,KAAOluB,EAAIE,OAAO4tB,MAAM,GAC7B,IAAIl6B,EAAM,EAAKs6B,KAAKhhC,KAAK+W,YAAY,KAErC,GADIrQ,GAAO,IAAG,EAAKi7B,OAAS,EAAKX,KAAKhhC,KAAKuG,OAAOG,EAAI,GAAGL,eACtDw+B,EAAcC,WAAWp5B,QAAQ,EAAKi2B,QAAU,EAE/C,YADA,EAAKG,UAAL,qDAA4B+C,EAAcC,WAAWroB,KAAK,MAA1D,8BAGJ,IAAIwlB,EAAS,IAAIC,WACjBD,EAAOE,cAAc,EAAKnB,MAC1BiB,EAAOG,OAAP,sBAAgB,sBAAAzoC,EAAA,sDACxB,EAAKwJ,QAAU8+B,EAAO5pB,OACtB,EAAK0sB,SAAW,EAAK5hC,QAAQ9F,OAFL,6CAnBe,EAsC/BijC,OAtC+B,sBAsCtB,sCAAA3mC,EAAA,yDACd,EAAKioC,YADS,wDAEnB,EAAKoD,WAAY,EACPzE,EAAW,IAAIQ,SACfgD,EAAO,EAAKC,uBAAuB,EAAK7gC,SAC5Co9B,EAASG,OAAO,QAASqD,EAAM,EAAK/C,KAAKhhC,MAL5B,SAMG,EAAK4hC,YAAYtB,OAAOC,GAN3B,UAOM,kBADfhoC,EANS,yBAQJ+B,EAAS/B,EAAT+B,MACDO,SAAcP,EATT,KAWDO,EAXC,OAYA,cAZA,QAaA,WAbA,QAcA,WAdA,gCAYaN,EAAM,mBAZnB,oCAaUA,EAAMD,EAbhB,oCAcUC,EAAMD,EAAMW,QAdtB,oCAeIV,EAAM4Q,OAAO5Q,GAfjB,oCAiBT,EAAKunC,UAAY,UAAYjnC,EAAO,MAAQN,EAjBnC,2BAoBb,EAAK26B,MAAQ38B,EACb,EAAK2a,UAAa,EAAKgiB,QAAU,EAAKt7B,MAAMkM,GAC5C,EAAKi8B,UAAW,EAtBH,4CAtCsB,EA+D/B5M,QAAU,WAAsB,IAC/BA,EAAW,EAAKv7B,MAAhBu7B,QACLA,GAAWA,EAAQ,EAAKD,QA/DxB,EAAKA,MAAQt7B,EAAMkM,GAFgB,EAhB3C,mEA0CmCq+B,GAM3B,IALA,IAAIz3B,EAAMy3B,EAAQluB,MAAM,KACpBmuB,EAAO13B,EAAI,GAAG2sB,MAAM,WAAW,GAC/BgL,EAAOC,KAAK53B,EAAI,IAChB4Q,EAAI+mB,EAAKhnC,OACTknC,EAAQ,IAAIC,WAAWlnB,GACrBA,KACFinB,EAAMjnB,GAAK+mB,EAAK3rB,WAAW4E,GAE/B,OAAO,IAAImnB,KAAK,CAACF,GAAQ,CAAC1pC,KAAKupC,MAnDvC,+BAqFc,IAAD,OACA71B,EAASlW,KAAKuB,MAAd2U,MACD2D,EAAQ,wBACRtX,UAAU,gDACViZ,UAAWxb,KAAK6a,UAChBpY,QAASzC,KAAK88B,QAHN,0BAIZ,OAAO,eAAC,IAAD,CAAMj6B,OAAQqT,GAAS,2BAAQ2D,MAAOA,EAAtC,UACH,qBAAKtX,UAAU,0BAAf,SACI,8BACI,sBAAKA,UAAU,OAAf,UACI,cAACwlC,GAAD,CAAa9V,IAAK,SAAA5qB,GAAC,OAAE,EAAKkiC,YAAYliC,GAClCuhC,UAAU,EAAOH,QAAS,KAC1BvyB,MAAM,uCACNoyB,cAAetoC,KAAKwpC,eACxB,sBAAKjnC,UAAU,mBAAf,0BAAsCiqC,EAAcC,WAAWroB,KAAK,MAApE,yBACCpkB,KAAKypC,WAAa,qBAAKlnC,UAAU,cAAf,SAA8BvC,KAAKypC,mBAI3E,cAAC,KAAD,CAAKhiC,MAEkC,IAAlBzH,KAAK0pC,SACD,qBAAKnnC,UAAU,mBAAf,6CAEF,IAAnBvC,KAAK2sC,UACJ,qBAAKpqC,UAAU,MAAf,SAAqB,cAAC,IAAD,MAErBvC,KAAK2oC,MAAQ3oC,KAAK8K,SAAW,sBAAKvI,UAAU,MAAf,UAC5B,sBAAKA,UAAU,OAAf,2CACOsmC,GAAW7oC,KAAK0sC,aAEvB,wBAAQnqC,UAAU,kBACjBiZ,UAAWxb,KAAK2pC,mBAChBlnC,QAASzC,KAAKioC,OAFf,sCApHT,GAAmCvlC,aAAnC,EACgB+pC,WAAa,CAAC,MAAO,OADrC,yCAKEv4B,KALF,gGAMEA,KANF,oGAOEA,KAPF,qGASKA,KATL,yEAS6C,KAT7C,mCAUKA,KAVL,8GAWKA,KAXL,yEAWsD,KAXtD,uCAYKA,KAZL,oGAaEA,KAbF,yEAayC,KAbzC,uCAcEA,KAdF,yEAc0C,KAd1C,O,iOC3TO,IAAM04B,EAAb,WA0BI,WAAYjhB,EAAYkhB,EAAgBC,EAAyBC,GAAkD,IAAD,gCAzBpGC,MAAiC,GAyBmE,KAxBjGC,QAAmC,GAwB8D,KAvBjGC,OAAiC,GAuBgE,KAtBjGC,QAAkC,GAsB+D,KArBjGC,MAA+B,GAqBkE,KApBjGC,KAA6B,GAoBoE,KAnBjGC,UAAsC,GAmB2D,KAlBpGC,SAAqC,GAkB+D,KAjBpGC,KAA6B,GAiBuE,KAhBjGC,gBAgBiG,OAfjGC,iBAeiG,OAdjGX,SAciG,OAbzG/qB,cAayG,OAZzG2rB,oBAYyG,OAXzGC,MAA+B,GAW0E,KAVzGd,iBAUyG,OATzGh5B,gBASyG,OARzG+J,aAQyG,OAPzGC,YAOyG,OANzGnW,UAMyG,OALzG+Z,WAKyG,OAJzGjU,QAIyG,OAFlH+Z,eAEkH,OA8C1GqmB,mBAAiC,SAAC5qB,EAAWxV,GAAoB,IAChE9F,EAAQsb,EAARtb,KAQL,OAAO,IAAI+tB,IAAWjoB,EAAIwV,EAAM,EAAK8pB,IAAIplC,KAvDqE,KA8EzGmmC,QAAkB,GA9EuF,KA+EzGC,UAAsB,GA/EmF,KAgFzGC,QAAoB,GAhFqF,KAiFzGC,SAAoB,GAjFqF,KAkFzGC,SAAoB,GAlFqF,KAmFzGC,QAAkB,GAnFuF,KAoFzGC,OAAgB,GApFyF,KAqFzGC,WAAwB,GArFiF,KAsFzGC,WAAwB,GAtFiF,KAuFzGC,OAAgB,GAtFrBvuC,KAAK8sC,YAAcA,OACCrsC,IAAhBqsC,IACA9sC,KAAK8sC,YAAc9sC,KAAK6tC,mBACxB7tC,KAAK+sC,IAAMA,GAAO,IAJwF,IAMzGt/B,EAA2Co/B,EAA3Cp/B,GAAIoQ,EAAuCgvB,EAAvChvB,QAASC,EAA8B+uB,EAA9B/uB,OAAQyM,EAAsBsiB,EAAtBtiB,OAAQzW,EAAc+4B,EAAd/4B,WAClC9T,KAAK8T,WAAaA,EAClB9T,KAAK6d,QAAUA,EACf7d,KAAK8d,OAASA,EACd9d,KAAKyN,GAAKA,EACVzN,KAAK2H,KAAOkW,EAAU,IAAMC,EAC5B9d,KAAKwnB,UAAY,EACjBxnB,KAAKgiB,SAAW2J,EAAI3J,SAASpa,IAAI5H,KAAK2H,MACtC3H,KAAK2tC,eAAiB3tC,KAAKgiB,SAAS9M,MAAM,cAC1ClV,KAAK0tC,YAAc1tC,KAAKgiB,SAAS9M,MAAM,WAEvC,IAEIwV,EAOJ,GALIA,EADW,OAAXH,QAA8B9pB,IAAX8pB,GAAmC,MAAXA,EACrC,GAGAA,EAAO3M,MAAM,KAAKhW,KAAI,SAAAP,GAAC,OAAIA,EAAE4wB,UAAQoK,QAAO,SAAAh7B,GAAC,OAAIA,EAAErC,OAAS,KAEpD,eAAdhF,KAAK2H,KAGL3H,KAAK0hB,MAAQ,IAAIkJ,IAAS5b,IAAWzO,UAEpC,CAAC,IACGwd,EAAqB4N,EAArB5N,SAAUC,EAAW2N,EAAX3N,QACfhe,KAAK0hB,MAAQ,IAAI2I,IAhBP,MAgBsBtM,EAAUC,EAASH,EAASC,EAAQ4M,GAAK,GAE7E1qB,KAAKytC,WAAa,IAAIe,aAAWxuC,MA7DzC,iDAoFS2H,GAAmB,OAAO3H,KAAK4tC,MAAMjmC,EAAKqG,iBApFnD,8BAqFYrG,EAAaypB,GACjB,IAAInO,EAAOjjB,KAAK4tC,MAAMjmC,EAAKqG,eAC3B,OAAOiV,GAAQA,EAAKmO,IAAIA,EAAIpjB,iBAvFpC,6BAyFWrG,GAAqB,OAAO3H,KAAKitC,QAAQtlC,EAAKqG,iBAzFzD,4BA0FUrG,GAAoB,OAAO3H,KAAKktC,OAAOvlC,EAAKqG,iBA1FtD,4BA2FUrG,GAAoB,OAAO3H,KAAKmtC,QAAQxlC,EAAKqG,iBA3FvD,2BA4FSrG,GAAmB,OAAO3H,KAAKotC,MAAMzlC,EAAKqG,iBA5FnD,0BA6FQrG,GAAkB,OAAO3H,KAAKqtC,KAAK1lC,EAAKqG,iBA7FhD,8BA8FYrG,GAAsB,OAAO3H,KAAKstC,UAAU3lC,EAAKqG,iBA9F7D,8BA+FYrG,GAAsB,OAAO3H,KAAKutC,SAAS5lC,EAAKqG,iBA/F5D,sCAiGoBoT,GACZ,IAAK,IAAIjf,KAAKnC,KAAKktC,OAAQ,CACvB,IAAIz6B,EAAQzS,KAAKktC,OAAO/qC,GACxB,GAAIsQ,EAAM2O,SAAWA,EAAQ,OAAO3O,KApGhD,uJAoHczS,KAAK0hB,MAAM9b,OApHzB,uQAyHgB6oC,EAAWzuC,KAAK0tC,YAAYztC,MAzH5C,gCA2HiCD,KAAK0hB,MAAMgtB,aA3H5C,OA2HgBD,EA3HhB,iBA6HiBA,EA7HjB,iDA8HYzuC,KAAKunB,cAAcknB,GA9H/B,qOAqIe7rB,GAIP5iB,KAAK0tC,YAAYhoC,IAAIkd,GAJA,IAKhB2H,EAA0B3H,EAA1B2H,OAAQqjB,EAAkBhrB,EAAlBgrB,MAAOznC,EAAWyc,EAAXzc,QACpBnG,KAAKwnB,UAAYrhB,EACjBnG,KAAK2uC,WAAWf,GAChB5tC,KAAK4uC,YAAYrkB,KA7IzB,iCAgJuBqjB,GACf,IAAK,IAAIzrC,KAAKyrC,EAAO,CACjB,IAAItsB,EAASssB,EAAMzrC,GACdif,EAAgBE,EAAhBF,OAAQvB,EAAQyB,EAARzB,KACF7f,KAAK6uC,QAAQ1sC,EAAGif,EAAQvB,GAC9B2B,KAAM,EAEf,IAAK,IAAIrf,KAAKyrC,EAAO,CACjB,IAAItsB,EAASssB,EAAMzrC,GACRnC,KAAK8iB,QAAQ3gB,GACnBkgB,UAAUf,GAEnB,IAAK,IAAInf,KAAKnC,KAAK4tC,MAAO,CACX5tC,KAAK4tC,MAAMzrC,GACjBmgB,qBA9JjB,gFAkK2BwsB,GAlK3B,iFAmKqB9uC,KAAK0hB,MAAMJ,OAAOwtB,GAnKvC,sTAuKkB9uC,KAAK0hB,MAAMqtB,aAvK7B,OAuKM7uC,EAvKN,OAwK6B,CAC1BF,KAAK+tC,UACL/tC,KAAKguC,QACLhuC,KAAKiuC,SACLjuC,KAAKkuC,SACLluC,KAAKmuC,QACLnuC,KAAKouC,OACLpuC,KAAKquC,WACLruC,KAAKsuC,WACLtuC,KAAKuuC,QAEGj5B,SAAQ,SAAAjB,GAChBA,EAAIiB,SAAQ,SAAAjO,GACX,IAAIof,EAASvmB,EAAImH,EAAEM,KAAKqG,eACxB,GAAKyY,EAAL,CACA,IAAInF,EAASmF,EAAOgF,KACfnK,GACLja,EAAE8a,YAAYb,UAzLlB,oIA8LY3Z,GACJ,OAAO3H,KAAK4tC,MAAMjmC,KA/L1B,kCAkMwB4iB,GAChB,IAAK,IAAIjpB,KAAKipB,EAAQ,CAClB,IAAIljB,EAAIkjB,EAAOjpB,GACf,cAAe+F,GACX,IAAK,SAAUrH,KAAKgvC,SAAS1tC,EAAG+F,GAAI,MACpC,IAAK,SAAUrH,KAAKivC,QAAQ3tC,EAAG+F,OAvM/C,iCA4Me6nC,GACPlvC,KAAKytC,WAAW0B,WAAWD,KA7MnC,8BAgNYvnC,EAAa8F,GACjB,IAAI2hC,EAAMpvC,KAAKgtC,MAAMrlC,GACrB,YAAYlH,IAAR2uC,IACJA,EAAMpvC,KAAKgtC,MAAMrlC,GAAQ,IAAI0nC,IAAOrvC,KAAM2H,EAAM8F,GAChDzN,KAAKguC,QAAQ5rC,KAAKgtC,IAFYA,IAlNtC,gCAuNWznC,EAAa8F,GAChB,IAAI2Q,EAASpe,KAAKitC,QAAQtlC,GAC1B,YAAelH,IAAX2d,IACJA,EAASpe,KAAKitC,QAAQtlC,GAAQ,IAAI8qB,IAAOzyB,KAAM2H,EAAM8F,GACrDzN,KAAK+tC,UAAU3rC,KAAKgc,IAFaA,IAzNzC,8BA8NoBzW,EAAa8F,EAAWoS,GACpC,IAAIoD,EAAOjjB,KAAK4tC,MAAMjmC,GACtB,YAAalH,IAATwiB,IAEAA,OADSxiB,IAATof,EACO,IAAIyvB,aAAWtvC,KAAM2H,EAAM8F,EAAIoS,GAE/B,IAAI0vB,YAAUvvC,KAAM2H,EAAM8F,GACrCzN,KAAK4tC,MAAMjmC,GAAQsb,EACnBjjB,KAAK8tC,QAAQ1rC,KAAK6gB,IANaA,IAhOvC,+BAyOatb,EAAa8F,GAClB,IAAI8f,EAAQvtB,KAAKmtC,QAAQxlC,GACzB,YAAclH,IAAV8sB,IACJA,EAAQvtB,KAAKmtC,QAAQxlC,GAAQ,IAAIglB,IAAM3sB,KAAM2H,EAAM8F,GACnDzN,KAAKkuC,SAAS9rC,KAAKmrB,IAFaA,IA3OxC,8BAgPoB5lB,EAAa8F,GACzB,IAAI+hC,EAAOxvC,KAAKotC,MAAMzlC,GACtB,YAAalH,IAAT+uC,IACJA,EAAOxvC,KAAKotC,MAAMzlC,GAAQ,IAAI8nC,IAAKzvC,KAAM2H,EAAM8F,GAC/CzN,KAAKmuC,QAAQ/rC,KAAKotC,IAFaA,IAlPvC,6BAuPmB7nC,EAAa8F,GACxB,IAAI7F,EAAM5H,KAAKqtC,KAAK1lC,GACpB,YAAYlH,IAARmH,IACJA,EAAM5H,KAAKqtC,KAAK1lC,GAAQ,IAAIqN,IAAIhV,KAAM2H,EAAM8F,GAC5CzN,KAAKouC,OAAOhsC,KAAKwF,IAFaA,IAzPtC,6BA8PmBD,EAAa8F,GACxB,IAAIiuB,EAAM17B,KAAKwtC,KAAK7lC,GACpB,YAAYlH,IAARi7B,IACJA,EAAM17B,KAAKwtC,KAAK7lC,GAAQ,IAAI+nC,IAAI1vC,KAAM2H,EAAM8F,GAC5CzN,KAAKuuC,OAAOnsC,KAAKs5B,IAFaA,IAhQtC,iCAqQuB/zB,EAAa8F,GAC5B,IAAIhH,EAAUzG,KAAKstC,UAAU3lC,GAC7B,QAAgBlH,IAAZgG,EAGJ,OAFAA,EAAUzG,KAAKstC,UAAU3lC,GAAQ,IAAIgoC,IAAQ3vC,KAAM2H,EAAM8F,GACzDzN,KAAKquC,WAAWjsC,KAAKqE,GACdA,IA1Qf,iCA4QuBkB,EAAa8F,GAC5B,IAAImiC,EAAU5vC,KAAKutC,SAAS5lC,GAC5B,QAAgBlH,IAAZmvC,EAGJ,OAFAA,EAAU5vC,KAAKutC,SAAS5lC,GAAQ,IAAIkoC,IAAQ7vC,KAAM2H,EAAM8F,GACxDzN,KAAKsuC,WAAWlsC,KAAKwtC,GACdA,IAjRf,+BAmRajoC,EAAa8F,GAClB,IAAIgF,EAAQzS,KAAKktC,OAAOvlC,GACxB,YAAclH,IAAVgS,IACJA,EAAQzS,KAAKktC,OAAOvlC,GAAQ,IAAImoC,IAAM9vC,KAAM2H,EAAM8F,GAClDzN,KAAKiuC,SAAS7rC,KAAKqQ,IAFaA,IArRxC,+BA0RqB9K,EAAanF,GAC1B,IAAImb,EAAQnb,EAAKob,MAAM,KACvBpb,EAAOmb,EAAM,GACb,IAAIlQ,EAAKF,OAAOoQ,EAAM,IACtB,OAAQnb,GAEJ,IAAK,OAID,MACJ,IAAK,SAAUxC,KAAK+vC,UAAUpoC,EAAM8F,GAAK,MACzC,IAAK,QAASzN,KAAKgwC,SAASroC,EAAM8F,GAAK,MACvC,IAAK,OAAQzN,KAAKiwC,QAAQtoC,EAAM8F,GAAK,MACrC,IAAK,MAAOzN,KAAKkwC,OAAOvoC,EAAM8F,GAAK,MACnC,IAAK,UAAWzN,KAAKmwC,WAAWxoC,EAAM8F,GAAK,MAC3C,IAAK,QAAQzN,KAAKowC,SAASzoC,EAAM8F,GAAK,MAC/C,IAAK,UAAWzN,KAAKqwC,WAAW1oC,EAAM8F,GAAK,MAC3C,IAAK,MAAOzN,KAAKswC,OAAO3oC,EAAM8F,GAAK,MACnC,IAAK,OAAQzN,KAAKuwC,QAAQ5oC,EAAM8F,MA7SnC,8BAgToB9F,EAAa8N,GACzB,OAAQA,EAAG,GACP,IAAK,QAASzV,KAAKwwC,WAAW7oC,EAAM8N,MAlThD,iCAqTuB9N,EAAa8N,GAC5B,IAAIhD,EAAQzS,KAAKktC,OAAOvlC,QACVlH,IAAVgS,IAAqBA,EAAQzS,KAAKowC,SAASzoC,EAAM8N,EAAIhI,KACzDgF,EAAMg+B,MAAMh7B,KAxTpB,qCA0TmBkM,EAAgB+uB,GAAsB,IAAD,OAChD,QAAejwC,IAAXkhB,EAAJ,CADgD,oBAElCA,GAFkC,IAEhD,2BAAsB,CAAC,IAAdM,EAAa,QACbgB,EAAQhB,EAARgB,KACL,QAAaxiB,IAATwiB,EAAJ,CACA,IAAIhN,EAAIjW,KAAK8iB,QAAQG,QACXxiB,IAANwV,IACJgM,EAAE0B,MAAQ1N,EAAE06B,kBAPgC,kDASlChvB,GATkC,yBASvCM,EATuC,QAUvC2uB,EAAS3uB,EAAT2uB,MACL,QAAcnwC,IAAVmwC,EAAqB,iBACzB,IAAIC,EAAalvB,EAAOva,MAAK,SAAAC,GAAC,OAAIA,EAAEM,OAASipC,KAC7C,QAAmBnwC,IAAfowC,SACmBpwC,IAAfiwC,IACAG,EAAaH,EAAWtpC,MAAK,SAAAC,GAAC,OAAIA,EAAEM,OAASipC,WAE9BnwC,IAAfowC,GAEA,MAAM,IAAIjiC,MAAJ,sBAAyBgiC,EAAzB,kBAnB8B,IAsBvCv8B,EAAa4N,EAAb5N,IAAK4O,EAAQhB,EAARgB,KACNhN,EAAI,EAAK6M,QAAQ+tB,EAAWltB,MAAMV,KAAKtb,MAC3C,QAAUlH,IAANwV,EAAiB,iBACrB,IAAImb,EAAMnb,EAAEmb,IAAI/c,GAAO4O,GAEvB,GADAhB,EAAE0B,MAAQyN,GAAOA,EAAI0f,gBAAgBD,QACrBpwC,IAAZwhB,EAAE0B,MAEF,MAAM,IAAI/U,MAAJ,sBAAyBgiC,EAAzB,kBApBd,2BAAsB,IAT0B,kCA1TxD,yCA2VuBhvB,EAAuB8uB,GACtC,QAAkBjwC,IAAdmhB,EAAJ,CAD0D,oBAE3CA,GAF2C,IAE1D,2BAA0B,CAAC,IAClBD,EADiB,QACjBA,YACUlhB,IAAXkhB,GACJ3hB,KAAKwiB,eAAeb,EAAQ+uB,IAL0B,kCA3VlE,iCAoWeK,GACP/wC,KAAKytC,WAAWtmB,WAAW4pB,KArWnC,+BAiEQ,OAAOzgC,IAAEC,MAAM,GACXvQ,KAAKitC,QAASjtC,KAAKktC,OAAQltC,KAAKmtC,QAASntC,KAAKotC,MACvDptC,KAAKqtC,KAAMrtC,KAAKstC,UAAWttC,KAAKutC,SAAUvtC,KAAK4tC,MAC/C5tC,KAAKwtC,UApER,M,sKCwGasC,EAAb,4HAzIA,4MAECkB,YAFD,IAGCllB,YAHD,0DAWcxK,GACN,iEAAgBA,GACtBthB,KAAKgxC,OAAS1vB,EAAO0vB,OACrBhxC,KAAK8rB,OAASxK,EAAOwK,SAdvB,4BAgBUrW,GACFzV,KAAKgxC,OAAS,GADH,oBAEIv7B,EAAIw7B,KAFR,IAEX,2BAAwB,CAAC,IAAhBC,EAAe,QACpBlxC,KAAKgxC,OAAO5uC,KAAK,CAACuF,KAAMupC,EAAIjE,aAAQxsC,KAH7B,iCAhBnB,uCA8B6BkH,EAAa8N,GAClC,IAAIvV,EAAiB,CAACyH,KAAKA,EAAMslC,QAAQ,IACrCA,EAAU/sC,EAAI+sC,QAClB,IAAK,IAAIhmC,KAAKwO,EAAK,CACf,IAAI2I,EAAqB,CAACzW,KAAMV,GAChCgmC,EAAQ7qC,KAAKgc,GAEjB,OAAOle,IArCf,oEAuCeixC,EAAoBl0B,GAvCnC,gFAwCaxP,EAAMzN,KAAKkG,GAAXuH,GACD9M,EAAS,CAACywC,IAAK3jC,EAAI0jC,YAAaA,EAAal0B,KAAKA,GAzC9D,SA0CqB,IAAIo0B,EAAWrxC,KAAMW,GAAQ0sB,UA1ClD,gOA4C0B8jB,EAAoBl0B,GA5C9C,gFA6CaxP,EAAMzN,KAAKkG,GAAXuH,GACD9M,EAAS,CAACywC,IAAK3jC,EAAI0jC,YAAaA,EAAal0B,KAAKA,GA9C9D,SA+CqB,IAAIq0B,EAAiBtxC,KAAMW,GAAQ0sB,UA/CxD,uNAiDiB5f,EAAW8jC,EAAanuC,EAAcgb,GAjDvD,iFAkDqB,IAAIsJ,EAAa1nB,KAAM,CAACyN,GAAGA,EAAI8jC,KAAKA,EAAMnuC,MAAMA,EAAOgb,OAAOA,IAASiP,UAlD5F,sOAoD4B5f,EAAW8jC,EAAanuC,EAAcgb,GApDlE,iFAqDqB,IAAIozB,EAAmBxxC,KAAM,CAACyN,GAAGA,EAAI8jC,KAAKA,EAAMnuC,MAAMA,EAAOgb,OAAOA,IAASiP,UArDlG,kLAuDmBpQ,GAEX,IACIw0B,EADMx0B,EAAK,GACC,GAGhB,MAAO,CACHw0B,MAAOA,EACPx0B,KAJYjd,KAAK0xC,YAAYD,EAAMx0B,MAKnC00B,MAJQ10B,EAAK,MA5DzB,wEAmEmBxP,GAnEnB,uFAwEwB,IAAImkC,EAAe5xC,KAAMyN,GAAI4f,UAxErD,UAyE8B,KADlBntB,EAxEZ,QAyEgB,GAAG8E,OAzEnB,gCAyE8ChF,KAAK6xC,WAAWpkC,GAzE9D,wEA0EezN,KAAK8xC,OAAO5xC,IA1E3B,iLA4EqBuN,GA5ErB,uFAkFwB,IAAIskC,EAAmB/xC,KAAMyN,GAAI4f,UAlFzD,cAkFYntB,EAlFZ,yBAmFeF,KAAK8xC,OAAO5xC,IAnF3B,kLAsFsB6nB,EAAkBC,GAtFxC,8EA4FYrnB,EAAS,CAAConB,UAAUA,EAAWC,SAASA,GA5FpD,SA6FqB,IAAIgqB,EAAoBhyC,KAAMW,GAAQ0sB,UA7F3D,+NAgGyBjqB,EAAc2kB,EAAkBC,GAhGzD,8EAsGYrnB,EAAS,CAACyC,MAAMA,EAAO2kB,UAAUA,EAAWC,SAASA,GAtGjE,SAuGqB,IAAIiqB,EAAkBjyC,KAAMW,GAAQ0sB,UAvGzD,gMAyGkD,OAAO,IAAI6kB,EAAkBlyC,QAzG/E,kKAsHqB,IAAImyC,EAAsBnyC,UAAMS,GAAW4sB,UAtHhE,wNAyHqBjqB,EAAcuG,EAAaoe,EAAkBC,GAzHlE,8EA0HYrnB,EAAS,CAACyC,MAAMA,EAAOuG,KAAKA,EAAMoe,UAAUA,EAAWC,SAASA,GA1H5E,SA2HqB,IAAIoqB,EAAiBpyC,KAAMW,GAAQ0sB,UA3HxD,6NA8HmBjqB,EAAc2kB,EAAkBC,GA9HnD,8EAoIYrnB,EAAS,CAACyC,MAAMA,EAAO2kB,UAAUA,EAAWC,SAASA,GApIjE,SAqIqB,IAAIqqB,EAAeryC,KAAMW,GAAQ0sB,UArItD,kLAC6B,MAAO,YADpC,GAAmClM,MA4IpBmxB,E,4MAEQhJ,Y,uDADY,OAAOtpC,KAAK2mB,U,2BAExB,MAAM,SAAN,OAAgB3mB,KAAKymB,OAAO9e,KAA5B,YAAoC3H,KAAKspC,Y,GAH1B9iB,KAMhC6qB,E,4KAEa,IAAD,EACqBrxC,KAAKW,OAA/BywC,EADK,EACLA,IAAKD,EADA,EACAA,YAAal0B,EADb,EACaA,KACvB,MAAO,CACHm0B,IAAKA,EACLD,YAAaA,EACbl0B,KAAMjd,KAAKymB,OAAOoM,KAAK5V,M,8BAGvBtQ,GAAc,IACnBmf,EAAU9rB,KAAKymB,OAAfqF,OACL,QAAerrB,IAAXqrB,EAAsB,OAAOnf,EACjC,IAAI4lC,EAAY5lC,EAAImf,OACpB,QAAkBrrB,IAAd8xC,GAAgD,IAArBA,EAAUvtC,OAExC,OADA2H,EAAImf,YAASrrB,EACNkM,EANe,IAQlBkV,EAAWiK,EAAXjK,QAEC,OADNlV,EAAImf,OAAS9rB,KAAKymB,OAAOmB,cAAc2qB,EAAW1wB,GACrClV,I,2BAnBQ,MAAM,SAAN,OAAgB3M,KAAKymB,OAAO9e,U,GAD1B2qC,GAwBnBhB,E,mKACiB,MAAM,SAAN,OAAgBtxC,KAAKymB,OAAO9e,KAA5B,e,GADQ0pC,GAIzB3pB,E,4MACF5mB,OAAS,M,mDACU,MAAM,SAAN,OAAgBd,KAAKymB,OAAO9e,U,GAFxB2qC,GAKrBd,E,mKACiB,MAAM,SAAN,OAAgBxxC,KAAKymB,OAAO9e,KAA5B,e,GADU+f,GAI3BkqB,E,4MAEF9wC,OAAS,M,0FAIU,MAAM,SAAN,OAAgBd,KAAKymB,OAAO9e,KAA5B,gBAAwC3H,KAAKW,Y,GANvC2xC,GASvBP,E,4MAEFjxC,OAAS,M,0FAGU,MAAM,SAAN,OAAgBd,KAAKymB,OAAO9e,KAA5B,oBAA4C3H,KAAKW,Y,GALvC2xC,GAQ3BN,E,4MACiB1I,OAAS,W,YADEgJ,GAI5BL,E,4MACiB3I,OAAS,S,YADAgJ,GAI1BH,E,4MACFrxC,OAAS,M,EACUwoC,OAAS,a,sDACpB38B,GAEJ,OADe3M,KAAKymB,OAAfuqB,OACSppC,KAAI,SAAA6tB,GACd,IAAIxQ,EAAIwQ,EAAE9tB,KAAM6qC,EAAQ,EACpBj/B,EAAK5G,EAAcvF,MAAK,SAAAC,GAAC,OAAIA,EAAEjE,QAAU6hB,KAE7C,YADUxkB,IAAN8S,IAAiBi/B,EAAQj/B,EAAEi/B,OACxB,CAACpvC,MAAO6hB,EAAGutB,MAAOA,U,GATDF,GAc9BF,E,4MACiB9I,OAAS,c,sDACpB38B,GACJ,OAAOA,M,GAHgB2lC,GAOzBD,E,4MACiB/I,OAAS,Y,sDACpB38B,GACJ,OAAOA,M,GAHc2lC,GAOhBJ,EAAb,kDAEI,WAAYz/B,GAAe,IAAD,8BACtB,eAAM,IAFFA,WACkB,EAEtB,EAAKA,MAAQA,EACb,EAAKuV,SAAW,GAHM,EAF9B,iGAO6B3Q,EAAW0Q,EAAeC,GAPvD,uFAQkBhoB,KAAKyS,MAAMggC,eAAep7B,EAAO0Q,EAAWC,GAR9D,cAQM9nB,EARN,yBASS,CAAC+sB,MAAO/sB,IATjB,2IAiBqB4G,GACnB,YAAgBrG,IAATqG,EAAoB,EAAKA,EAAa2G,OAlB/C,GAAuCmf,M,+GC5Q1B6iB,EAAb,4MAEciD,aAAe,OAF7B,0DAI0B/xC,GAClB,OAAO,IAAIgyC,EAAgB3yC,KAAMW,KALzC,+BAC6B,MAAO,WADpC,GAA0BgsB,KASbgmB,EAAb,mKACuB,MAAM,QAAN,OAAe3yC,KAAKymB,OAAO9e,UADlD,GAAqCggB,M,+FCVxBgoB,EAAb,4MAEc+C,aAAe,UAF7B,uDAC6B,MAAO,cADpC,G,MAA6B/lB,I,8JCchB3X,EAAb,4MAEIW,UAFJ,IAGIs3B,QAAsB,GAH1B,EAIIE,QAAsB,GAJ1B,EAKIyF,gBALJ,0DAOctxB,GACN,iEAAgBA,GAChBthB,KAAK4yC,WAAa5yC,KAAKshB,OAAOzB,KAFZ,IAGbotB,EAA0B3rB,EAA1B2rB,QAASE,EAAiB7rB,EAAjB6rB,QAASx3B,EAAQ2L,EAAR3L,KAEvB,IAAK,IAAIxT,KADTnC,KAAKkG,GAAGsc,eAAexiB,KAAK2V,KAAOA,GACrBs3B,EAAS,CACnB,IAAI4F,EAAe5F,EAAQ9qC,GACtBwF,EAAQkrC,EAARlrC,KACDyW,EAASpe,KAAKkG,GAAG6pC,UAAUpoC,OAAMlH,GACrC2d,EAAOiE,UAAUwwB,GACjBz0B,EAAOkE,kBACNtiB,KAAKitC,QAAgB9qC,GAAKic,EAE/B,IAAK,IAAIjc,KAAKgrC,EAAS,CACnB,IAAI2F,EAAc3F,EAAQhrC,GACrBwF,EAAQmrC,EAARnrC,KACD4lB,EAAQvtB,KAAKkG,GAAG8pC,SAASroC,OAAMlH,GACnC8sB,EAAMlL,UAAUywB,GAChBvlB,EAAMjL,kBACLtiB,KAAKmtC,QAAgBhrC,GAAKorB,KA1BvC,mEA8BclW,GA9Bd,uFA+BwB,IAAI07B,EAAU/yC,KAAMqX,GAAOgW,UA/BnD,cA+BYntB,EA/BZ,yBAgCeA,GAhCf,0KAmCcmX,GAnCd,uFAoCwB,IAAI27B,EAAUhzC,KAAMqX,GAAOgW,UApCnD,cAoCYntB,EApCZ,yBAqCeA,GArCf,mQAyCwB,IAAI+yC,EAAUjzC,UAAMS,GAAW4sB,UAzCvD,cAyCYntB,EAzCZ,yBA0CeA,GA1Cf,0KA6CemX,EAAW0Q,EAAeC,GA7CzC,uFA8CwB,IAAIkrB,EAAWlzC,KAAM,CAAC+nB,UAAUA,EAAWC,SAASA,EAAU3Q,MAAMA,IAAQgW,UA9CpG,cA8CYntB,EA9CZ,yBA+CeA,GA/Cf,gLAkDgBmX,GAlDhB,gFAmDW87B,EAAK,IAAIC,EAAYpzC,KAAMqX,GAnDtC,SAoDuB87B,EAAG9lB,UApD1B,cAoDWntB,EApDX,yBAqDcA,GArDd,4KAuDgBS,GAvDhB,yFAwDwBX,KAAKutB,MAAM5sB,GAxDnC,OAwDYT,EAxDZ,qBAyDsBA,GAzDtB,oDAyDiBiC,EAzDjB,6BA0DmBjC,EAAIiC,IA1DvB,0KA6DcxB,GA7Dd,uFA8DwBX,KAAKwtB,MAAM7sB,GA9DnC,aA8DYT,EA9DZ,QA+DgB8E,OAAS,GA/DzB,yCA+DmC9E,EAAI,IA/DvC,6KAiEiBS,GAjEjB,yFAkEwBX,KAAKyV,IAAI9U,GAlEjC,OAkEYT,EAlEZ,qBAmEsBA,GAnEtB,oDAmEiBiC,EAnEjB,6BAmEkCjC,EAAIiC,IAnEtC,sIAC6B,MAAO,UADpC,GAAyBgf,KAuEVkyB,E,qSAOH3qB,EAAS1oB,KAAKszC,UAAUtzC,KAAKW,Q,SACjBX,KAAKymB,OAAO/E,MAAMoF,MAAM4B,G,cAApC/b,E,OACAzM,EAAMwoB,EAAOtB,QAAQza,EAAIA,K,kBACtB,CAACA,IAAKzM,I,0IAKb,OADK,sE,6BAboB,OAAOF,KAAK2mB,U,mCADZH,KAmB3BusB,E,wKACkB17B,GAChB,OAAO,IAAIk8B,EAAavzC,KAAKymB,OAAQzmB,KAAKymB,OAAOwmB,QAAQuG,IAAKn8B,O,GAF9Cg8B,GAMlBL,E,wKACkB37B,GAChB,OAAO,IAAIo8B,EAAazzC,KAAKymB,OAAQzmB,KAAKymB,OAAOwmB,QAAQuG,IAAKn8B,O,GAF9Cg8B,GAMlBJ,E,wKACkB57B,GAChB,OAAO,IAAIq8B,EAAa1zC,KAAKymB,OAAQzmB,KAAKymB,OAAO0mB,QAAQ/c,IAAK/Y,O,GAF9Cg8B,GAMlBH,E,wKACkB77B,GAChB,OAAO,IAAIs8B,EAAc3zC,KAAKymB,OAAQzmB,KAAKymB,OAAO0mB,QAAQn1B,KAAMX,O,GAF/Cg8B,GAMnBD,E,wKACkB/7B,GAChB,OAAO,IAAIu8B,EAAe5zC,KAAKymB,OAAQzmB,KAAKymB,OAAO0mB,QAAQ5f,MAAOlW,O,GAFhDg8B,GAMpBE,E,kDAEF,WAAY3rC,EAASwW,EAAezd,GAAa,IAAD,8BAC5C,cAAMyd,EAAQzd,IAFViH,SACwC,EAE5C,EAAKA,IAAMA,EAFiC,E,iDAK7B,MAAM,OAAN,OAAc5H,KAAK4H,IAAID,KAAvB,U,sCAPI+qB,KAWrB+gB,E,kDAEF,WAAY7rC,EAASwW,EAAezd,GAAa,IAAD,8BAC5C,cAAMyd,EAAQzd,IAFViH,SACwC,EAE5C,EAAKA,IAAMA,EAFiC,E,iDAK7B,MAAM,OAAN,OAAc5H,KAAK4H,IAAID,KAAvB,U,sCAPI+qB,KAWrBghB,E,kDAEF,WAAY9rC,EAAS2lB,EAAa5sB,GAAa,IAAD,8BAC1C,cAAM4sB,EAAO5sB,IAFTiH,SACsC,EAE1C,EAAKA,IAAMA,EAF+B,E,iDAK3B,MAAM,OAAN,OAAc5H,KAAK4H,IAAID,KAAvB,U,sCAPImgB,KAWrB6rB,E,kDAEF,WAAY/rC,EAAS2lB,EAAa5sB,GAAa,IAAD,8BAC1C,cAAM4sB,EAAO5sB,IAFTiH,SACsC,EAE1C,EAAKA,IAAMA,EAF+B,E,iDAK3B,MAAM,OAAN,OAAc5H,KAAK4H,IAAID,KAAvB,W,sCAPKmgB,KAWtB8rB,E,kDAEF,WAAYhsC,EAAS2lB,EAAa5sB,GAAa,IAAD,8BAC1C,cAAM4sB,EAAO5sB,IAFTiH,SACsC,EAE1C,EAAKA,IAAMA,EAF+B,E,iDAK3B,MAAM,OAAN,OAAc5H,KAAK4H,IAAID,KAAvB,Y,sCAPMggB,M,+FClLhBkoB,EAAb,4MAEc6C,aAAe,UAF7B,uDAC6B,MAAO,cADpC,G,MAA6B/lB,I,+FCAhB0iB,EAAb,uKAC6B,MAAO,WADpC,G,MAA4BluB,I,6BCF5B,miB,sKCmDa0yB,GAAb,aAMI,WAAYtyC,GAAkB,yBAL9Bqd,SAK6B,OAJrB0Z,KAAuB,GAIF,KAHrBwb,gBAGqB,OAF7BvyC,WAE6B,OAD7Bw5B,mBAC6B,EACzB/6B,KAAK4e,IAAMA,gBACX5e,KAAKuB,MAAQA,EACbvB,KAAK+zC,UAAUxyC,GACfvB,KAAK+6B,cAAgBx5B,EAAMw5B,cAC3B/6B,KAAKg0C,SAAWh0C,KAAKg0C,SAAS9c,KAAKl3B,MAX3C,yDAyBQ,IADa,EACTwkB,EAAS,GADA,cAEGxkB,KAAKs4B,MAFR,IAEb,2BAA2B,SACnBqB,WAAWnV,IAHN,8BAKb,OAAOA,IA7Bf,8BAgCa,IAAD,gBACYxkB,KAAKs4B,MADjB,IACJ,2BAA2B,SACnB/xB,SAFJ,iCAhCZ,oCAsCmB,IAAD,gBACMvG,KAAKs4B,MADX,IACV,2BAA2B,SACnBnB,eAFE,iCAtClB,+BA4CazU,EAAkBzgB,GAAe,IAAD,gBACrBjC,KAAKs4B,MADgB,IACrC,2BAA2B,SACnB4D,SAASxZ,EAAWzgB,IAFS,iCA5C7C,oCAkDkBgyC,GACV,QAAmBxzC,IAAfwzC,EAAJ,CAD0B,oBAEVj0C,KAAKs4B,MAFK,IAE1B,2BAA2B,SACnB6D,cAAc8X,IAHI,kCAlDlC,gCAyDsB1yC,GAAkB,IAC3B2yC,EAAuB3yC,EAAvB2yC,SAAUC,EAAa5yC,EAAb4yC,UACf,QAAiB1zC,IAAbyzC,EAAwB,CAAC,IAAD,gBACRA,GADQ,IACxB,2BAA0B,CAAC,IAAlB7vB,EAAiB,QACtBrkB,KAAKs4B,KAAKl2B,KAAKpC,KAAKo0C,SAAS/vB,EAAK8vB,KAFd,+BAII,IAAxBn0C,KAAKuB,MAAM8yC,WACXr0C,KAAK8zC,WAAa9zC,KAAKo0C,SAAS,CAACrZ,cAAc/6B,KAAKs0C,cAAcpd,KAAKl3B,YAAQS,SAInFT,KAAKs4B,KAAKl2B,KAAKo6B,YAAiBx8B,KAAM,qBAAKuC,UAAU,eAAf,iDApElD,+BAwEqBgyC,EAAkBC,GAC/B,IAAIL,EAaJ,YAXa1zC,IADD8zC,EAAwB/xC,KAEhC2xC,EAAY3X,SAIM/7B,KADlB0zC,EAAaI,EAA+CJ,iBAGtC1zC,KADlB0zC,EAAYK,KACiBL,EAAY5X,KAGvC4X,EAAUn0C,KAAMu0C,KArFlC,oCAyF0BvZ,EAAe3W,GACjC,OAAO,IAAImW,IAAeQ,KA1FlC,6BA8FQ,IADmB,EACfzD,GAAO,EADQ,cAEHv3B,KAAKs4B,MAFF,IAEnB,2BAA2B,SACdf,SAAQA,GAAO,IAHT,8BAKnB,OAAOA,IAlGf,+BAqG0B,IAAD,OACjB,OAAO,uBAAMyc,SAAUh0C,KAAKg0C,SAArB,UACFh0C,KAAKs4B,KAAK1wB,KAAI,SAACyc,EAAIxc,GAAL,OAAewc,EAAI7M,OAAO,EAAKoH,IAAM/W,MACnD7H,KAAKwY,eAxGlB,gCA6GQ,QAAwB/X,IAApBT,KAAK8zC,WACT,OAAO9zC,KAAK8zC,WAAWt8B,OAAOxX,KAAK4e,IAAM5e,KAAKs4B,KAAKtzB,UA9G3D,wEAiHmB6D,GAjHnB,0EAkHQA,EAAM0wB,iBACDv5B,KAAKu3B,OAnHlB,wDAoHY/S,EAASxkB,KAAK25B,aApH1B,SAqHc35B,KAAKuB,MAAMyyC,SAASxvB,GArHlC,sIAeQ,IAAItkB,EAAMF,KAAKs4B,KAAK1wB,KAAI,SAACP,EAAGQ,GAAJ,OAAcA,EAAQ,KAAOR,EAAEsvB,SAAW,QAElE,OADA7xB,QAAQC,IAAI7E,GACLF,KAAKs4B,KAAKmc,MAAK,SAAApwB,GAAG,OAAIA,EAAIsS,cAjBzC,8BAqBQ,OADU32B,KAAKs4B,KAAKoc,OAAM,SAAArwB,GAAG,OAAKA,EAAI+X,cApB9C,yCAcKxF,KAdL,wGAmBKA,KAnBL,wE,+LC9CA,oDAaI,WAAYr1B,GAAY,IAAD,uBACnB,cAAMA,IAbF+f,OAAsB,CAC1B,CAAC3Z,KAAK,OAAQnF,KAAK,UACnB,CAACmF,KAAK,OAAQnF,KAAK,UAUA,EARfmyC,SAAoB,CACxB//B,MAAO,CACH3D,KAAM,CAAC+U,OAAO,OAAQ9P,MAAM,eAAMiF,YAAY,0DAC9CnK,KAAM,CAACgV,OAAO,QAAS9P,MAAM,kBAKd,yCASf0+B,cATe,uCASC,WAAOrvB,EAAuB7K,EAAcE,GAA5C,eAAAtZ,EAAA,6DACfqG,EAAQ4d,EAAR5d,KADe,SAEdmJ,IAAQ+jC,YAAYltC,EAAM+S,GAFZ,OAGpB,EAAKuC,KAAKtV,GAAQ+S,EACHxX,MAAIyG,KACdhC,GAAQ+S,EACbxX,MAAImO,gBANgB,2CATD,gEAEAnO,MAAIyG,KAAlBsH,EAFc,EAEdA,KAAMD,EAFQ,EAERA,KAFQ,OAGnB,EAAKiM,KAAO,CACRhM,KAAMA,EACND,KAAMA,GALS,EAb3B,qDAgCQ,OAAO,cAAC,OAAD,CAAMnO,OAAO,2BAAb,SACH,cAAC,OAAD,CAAMye,OAAQthB,KAAKshB,OAAQqzB,SAAU30C,KAAK20C,SACtC13B,KAAMjd,KAAKid,KACX23B,cAAe50C,KAAK40C,sBAnCpC,GAAgClyC,aAAhC,kCAWKwR,KAXL,8D,OCHO,SAAejJ,IAAtB,+B,4CAAO,4BAAA3J,EAAA,sEACmB,yCADnB,cACFwzC,EADE,yBAEC,IAAIA,EAAaC,YAAOt0C,IAFzB,4C,qKCEDu0C,G,KAAiC,CAACzK,OAAQ,SAEnC0K,EAAb,WAEC,WAAYvZ,GAAW,yBADfA,SACc,EACrB17B,KAAK07B,IAAMA,EAHb,mDAKQlX,GACN,IAAIyc,EAOJ,OALCA,EADqB,kBAAXzc,EACF,CAACxkB,KAAK07B,IAAIwZ,WAAW1wB,IAGrBxkB,KAAK07B,IAAIyZ,aAAa3wB,GAExB,qBAAKjiB,UAAU,oBAAf,SAAoC0+B,EAAMr5B,KAAI,SAACD,EAAME,GAC3D,OAAO,qBAAiBtF,UAAU,iDAA3B,SAA6EoF,GAAnEE,UAdpB,mCAiBc4P,EAAe9V,GAAiD,IAAD,OACjEmJ,EAAU9K,KAAK07B,IAAIlX,OAAO5c,KAAI,SAACd,EAAKe,GAC7C,OAAO,qBAAKtF,UAAU,MAAf,SAAkC,EAAK6yC,YAAYtuC,EAAM2Q,EAAO9V,IAAtCkG,MAElC,OAAO7H,KAAKq1C,WAAW1zC,EAASmJ,KArBlC,mCAuBc0Z,EAAgB7iB,GAAiD,IAAD,OACxE0S,OAAe5T,IAAT+jB,OAAoB/jB,EAAY+jB,EAAO5G,MAAM,KAAKhW,KAAI,SAAAP,GAAC,OAAIkG,OAAOlG,MACxEyD,EAAU9K,KAAK07B,IAAIlX,OAAO5c,KAAI,SAACd,EAAKe,GACvC,IAAIgwB,OAAyBp3B,IAAN4T,OAAiB5T,EAAY4T,EAAIhB,QAAQvM,EAAK2G,KAAK,EAC1E,OAAO,qBAAKlL,UAAU,MAAf,SAAkC,EAAK+yC,YAAYxuC,EAAM+wB,EAASl2B,IAAxCkG,MAElC,OAAO7H,KAAKq1C,WAAW1zC,EAASmJ,KA7BlC,iCA+BoBnJ,EAAmCmJ,GAAc,IAC9DvI,EAA4BZ,EAA5BY,UAAWgzC,EAAiB5zC,EAAjB4zC,cAKhB,OAJAA,EAAgBA,EACf,OAASA,EAET,6CACM,qBAAKhzC,UAAWA,EAAWF,MAAO2yC,EAAlC,SACN,qBAAKzyC,UAAWgzC,EAAhB,SACczqC,QAvCjB,kCA2CqBhE,EAAe2Q,EAAe9V,GAAgD,IAC5F8L,EAAY3G,EAAZ2G,GAAI9F,EAAQb,EAARa,KACJ6tC,EAAoC7zC,EAApC6zC,OAAQC,EAA4B9zC,EAA5B8zC,UAAWC,EAAiB/zC,EAAjB+zC,cACpBzjB,EAAMujB,GAAW,SAACzb,GAAD,OAA0Byb,EAAO/nC,GAAIssB,GAC1D,OAAO,wBAAOx3B,UAAU,oBAAjB,UACN,uBAAO0vB,IAAKA,EAAKzvB,KAAK,QAAQmF,KAAM8tC,EACnCh+B,MAAOhK,EAAI4+B,eAAgB50B,IAAQhK,EACnC+M,SAAUk7B,IACV/tC,OAnDJ,kCAuDqBb,EAAe+wB,EAAkBl2B,GAAgD,IAC/F8L,EAAY3G,EAAZ2G,GAAI9F,EAAQb,EAARa,KACJ6tC,EAAyB7zC,EAAzB6zC,OAAQE,EAAiB/zC,EAAjB+zC,cACTzjB,EAAMujB,GAAW,SAACzb,GAAD,OAA0Byb,EAAO/nC,GAAIssB,GAC1D,OAAO,wBAAOx3B,UAAU,oBAAjB,UACN,uBAAO0vB,IAAKA,EAAKzvB,KAAK,WACrBiV,MAAOhK,EAAI4+B,eAAgBxU,EAC3Brd,SAAUk7B,IACV/tC,SA/DJ,KCGa+nC,EAAb,4MAEClrB,YAFD,IAGSmxB,KAAgC,GAHzC,EAKSC,WALT,2DAWYnoC,GACV,IAAIoX,EAAI7kB,KAAK21C,KAAKloC,GAClB,YAAWhN,IAAJokB,OAAepkB,EAAYokB,EAAEld,OAbtC,mCAgBc2M,GACZ,IADiC,EAC7BpU,EAAe,GADc,cAElBoU,EAAIsJ,MAAM,MAFQ,IAEjC,2BAA+B,CAAC,IAAvBnQ,EAAsB,QAC1BoX,EAAI7kB,KAAK21C,KAAKpoC,OAAOE,IACrB9F,OAAWlH,IAAJokB,OAAepkB,EAAYokB,EAAEld,UAC3BlH,IAATkH,GAAoBzH,EAAIkC,KAAKuF,IALD,8BAOjC,OAAOzH,IAvBT,yKA2BsBO,IAAhBT,KAAKwkB,OA3BX,yCA2BwCxkB,KAAKwkB,QA3B7C,cA4BExkB,KAAKwkB,OAAS,GA5BhB,SA6BkBxkB,KAAK0hB,MAAMzhB,IAAI,cAAgBD,KAAK2H,MA7BtD,eA8BclH,KADRP,EA7BN,yDA+BM21C,EAAS31C,EAAe0d,MAAM,MA/BpC,cAgCmBi4B,GAhCnB,8DAiCuB,KADZC,EAhCX,SAiCY9wC,OAjCZ,wDAkCO2Y,EAAQm4B,EAAKl4B,MAAM,MACnBnQ,EAAKF,OAAOoQ,EAAM,IAClBb,EAAM,CACTrP,GAAIA,EACJ9F,KAAMgW,EAAM,GACZo4B,IAAKp4B,EAAM,IAEZ3d,KAAKwkB,OAAOpiB,KAAK0a,GACjB9c,KAAK21C,KAAKloC,GAAMqP,EA1CnB,qFAAA/H,EAAA,mFA4CS/U,KAAKwkB,QA5Cd,sJAC6B,MAAO,QADpC,2BAOE,YAAmB/jB,IAAfT,KAAK41C,MAA4B51C,KAAK41C,MACnC51C,KAAK41C,MAAQ,IAAIX,EAAQj1C,UARlC,GAAyBmhB,M,4GCGZ60B,EAAuB,CAChC1lC,EAAG,CACC0nB,SAAU,WACVie,OAAQ,mBACRC,QAAS,oBACTjd,IAAK,sBACL7D,IAAK,uBAET+gB,GAAI,CACA7lC,EAAG,CACC0nB,SAAU,qBACVie,OAAQ,2BACRC,QAAS,2BACTjd,IAAK,iCACL7D,IAAK,oCCnBJghB,EAAuB,CAChC9lC,EAAG,CACC+lC,KAAM,UAEVF,GAAI,CACA7lC,EAAG,CACC+lC,KAAM,e,kCCblB,mE,6BCAA,qjK,kNCwBaC,EAAb,kDAGI,WAAY/0C,GAA6B,IAAD,8BACpC,cAAMA,IAHFg1C,UAEgC,IADhCC,YACgC,IAiBhCC,oBAAsB,SAACh8B,IACK,IAA5B,EAAKrX,MAAMszC,eACX,EAAKF,QAAU,EAAKA,OAAOG,SAASl8B,EAAIE,SACvC,EAAK47B,MAEV,EAAKK,WAtB+B,EAyBhCA,OAAS,WACb,EAAKtzC,SAAS,CACVozC,cAAe,EAAKtzC,MAAMszC,gBAzB9B,EAAKtzC,MAAQ,CACTszC,cAAc,GAHkB,EAH5C,gEAWQjrC,SAAS9F,iBAAiB,QAAS3F,KAAKy2C,qBACxChrC,SAAS9F,iBAAiB,aAAc3F,KAAKy2C,uBAZrD,6CAgBQhrC,SAAS8lB,oBAAoB,QAASvxB,KAAKy2C,qBAC3ChrC,SAAS8lB,oBAAoB,aAAcvxB,KAAKy2C,uBAjBxD,+BAkCc,IAAD,SACsEz2C,KAAKuB,MAA3EyP,EADA,EACAA,KAAMi8B,EADN,EACMA,QAAS4J,EADf,EACeA,QAASt0C,EADxB,EACwBA,UAAWu0C,EADnC,EACmCA,cAAeC,EADlD,EACkDA,sBACvCt2C,IAAZo2C,IAAuBA,GAAU,GACrC,IAAIG,EAAU/J,EAAQwH,MAAK,SAAAptC,GAAC,YAAa5G,IAAT4G,EAAE2J,QAC7B0lC,EAAgB12C,KAAKoD,MAArBszC,aAEPtjB,EAAK7wB,GAAa,4CAEhB,OAAO,sBAAKA,UAAW,WAAhB,UACZ,wBAAQ0vB,IAAK,SAAA5qB,GAAC,OAAE,EAAKmvC,OAAOnvC,GAC3B9E,UAAW6wB,EACC6jB,cAAY,WACZC,gBAAeR,EACfj0C,QAASzC,KAAK42C,OAJ3B,SAKa,mBAAGr0C,UAAW+V,IAAW,YAAa,OAAOtH,GAAM,mBAEvD,qBAAKihB,IAAK,SAAA5qB,GAAC,OAAI,EAAKkvC,KAAKlvC,GAAG9E,UAAW+V,IAAW,CAAC,iBAAgB,EAAM,sBAAsBu+B,EAAS,KAAOH,IAA/G,SAEQzJ,EAAQrlC,KAAI,SAACP,EAAEQ,GAC7B,IAAKR,EACiB,OAAO,qBAAK9E,UAAU,oBAAwBsF,GAF7B,IAOjB1F,EAHC6O,EAAkD3J,EAAlD2J,KAAMmH,EAA4C9Q,EAA5C8Q,QAASiG,EAAmC/W,EAAnC+W,OAAQ+4B,EAA2B9vC,EAA3B8vC,UAAWC,EAAgB/vC,EAAhB+vC,aACvC,QAAa32C,IAATuQ,QAAkCvQ,IAAZ0X,EACtB,OAAO,qBAAK5V,UAAU,qBAO1B,IALgB,IAAZy0C,SACav2C,IAATuQ,IAAoBA,EAAO,MAAQA,GAC5D7O,EAAI,mBAAGI,UAAW+V,IAAW,OAAQ,KAAMtH,EAAM,QAASmmC,GAAaL,GACtEO,eAAa,UAEkB52C,IAAX2d,EACA,OAAO,qBAAI7b,UAAU,kBAAd,UAAiCJ,EAAjC,IAAqCgW,KAShD,OAAO,oBAAG5V,UAAU,gBAA4B6Q,KAAK,KACjD3Q,QATkB,SAACgY,GACnBA,EAAI8e,iBACJnb,KAO0Bk5B,aALX,SAAC78B,GAChB2D,KAGG,UAEDjc,EAFC,IAEE,sBAAMI,UAAW60C,GAAgBL,EAAjC,SAAoD5+B,MAFpBtQ,eA3EjE,GAAqCnF,c,gJCd/B60C,EAA8B,CACnCC,GAAI,SAACC,EAAczkC,GAAf,gBAAkCykC,EAAlC,YAA2CzkC,IAC/C0kC,IAAK,SAACC,EAAaF,EAAczkC,GAA5B,gBAA+C2kC,EAA/C,YAAuDF,EAAvD,YAAgEzkC,IACrE4kC,UAAW,OACXC,MAAO,QACPC,SAAU,MACVC,IAAK,CACJP,GAAI,SAACC,EAAczkC,GAAf,gBAAkCykC,EAAlC,iBAA2CzkC,EAA3C,WACJ0kC,IAAK,SAACC,EAAaF,EAAczkC,GAA5B,gBAA+C2kC,EAA/C,iBAAuDF,EAAvD,iBAAgEzkC,EAAhE,WACL4kC,UAAW,eACXC,MAAO,eACPC,SAAU,gBAEXE,IAAK,CACJR,GAAI,SAACC,EAAczkC,GAAf,gBAAkCykC,EAAlC,YAA2CzkC,IAC/C0kC,IAAK,SAACC,EAAaF,EAAczkC,GAA5B,gBAA+C2kC,EAA/C,YAAuDF,EAAvD,YAAgEzkC,IACrE4kC,UAAW,OACXC,MAAO,QACPC,SAAU,QAMZ,SAASG,EAAGthC,GACX,OAAO4gC,EAAQ5gC,GAGhB,SAASuhC,EAAWC,EAAmBC,GAA2C,IAE1EplC,EAFiDqlC,EAAwB,wDAC7E,IAAKF,EAAO,OAAO,KAEnB,cAAeA,GACX,QAASnlC,EAAOmlC,EAAe,MAC/B,IAAK,SAAUnlC,EAAO,IAAIpO,KAAKuzC,GAAQ,MACvC,IAAK,SAAUnlC,EAAO,IAAIpO,KAAuB,IAAjBuzC,GAGpC,IACIxzC,EAAa2zC,EAAcC,EAAcd,EAAcE,EAAaa,EADpE3zC,EAAM,IAAID,KAEV2Q,EAAIvC,EACRrO,EAAOE,EAAIoO,UAAYsC,EAAEtC,UACzB,IAAIwlC,EAAKljC,EAAEmjC,WAAYC,EAAOpjC,EAAEqjC,aAChCN,EAAMzzC,EAAI6e,UACV60B,EAAMhjC,EAAEmO,UACR+zB,EAAMliC,EAAEkO,WAAW,EACnBk0B,EAAKpiC,EAAEiO,cACVg1B,EAAU3zC,EAAI2e,cAEd,IAAIq1B,GAAqB,EACrBC,EACCn0C,GAAO,MACNgzC,IAASa,GACZK,GAAa,EACNZ,EAAG,KAAHA,CAASR,EAAOc,KAGvBM,GAAa,EACNZ,EAAG,MAAHA,CAAUN,EAAMF,EAAOc,IAG5B5zC,EAAO,MACN4zC,IAAQD,GACXO,GAAa,EACNZ,EAAGtzC,EAAO,EAAG,WAAa,eAEnB,IAAXyzC,GACHS,GAAa,EACN,IAEDZ,EAAG,SAEPN,IAASa,EACLP,EAAG,KAAHA,CAASR,EAAOc,GAEjBN,EAAG,MAAHA,CAAUN,EAAMF,EAAOc,GAG3BQ,EAAKN,GAASE,EAAO,GAAG,KAAK,KAAOA,EAmBxC,OAAmB,IAAfE,IAAkC,IAAXR,EACnBS,EAAQ,IAAMC,EAEfD,EA7ERzsB,iBAAOkrB,EAASA,GAiFT,IAAMyB,EAAb,uKAEQ,OAAOd,EAAWl4C,KAAKuB,MAAMyR,MAAM,OAF3C,GAA8BtQ,aASjBu2C,EAAb,uKACc,IAAD,EACUj5C,KAAKuB,MACpB,OAAO22C,EAFF,EACNllC,MACyB,EAFnB,EACAqlC,YAFb,GAA8B31C,c,sIC9GjBw2C,EAAb,uKACc,IAEFC,EAFC,EACmCn5C,KAAKuB,MAAxCyP,EADA,EACAA,KAAMooC,EADN,EACMA,KAAMjI,EADZ,EACYA,YAAakI,EADzB,EACyBA,GAAIC,EAD7B,EAC6BA,GAG9BH,EADuB,kBAAhBhI,EACA,8BAAMA,IAENA,EACX,IAAI/d,EAAK9a,IACL,aACK7X,IAAL44C,EAAgB,OAAO,MAAMA,OACxB54C,IAAL64C,EAAgB,OAAO,MAAMA,GACjC,OAAO,sBAAK/2C,UAAW6wB,EAAhB,UACH,cAAC,QAAD,CAAO7wB,UAAU,iBAAiBsQ,IAAK7B,IACvC,sBAAKzO,UAAU,aAAf,UACI,oBAAIA,UAAU,OAAd,SAAsB62C,IACrBD,YAhBjB,GAA2Bz2C,c,gMCWd62C,GAAb,8MACYxf,WADZ,IAEYpzB,IAAc,KAF1B,6CAKY6T,SAAW,SAACC,GAChB,EAAK9T,IAAM8T,EAAIE,OAAOlD,WACLhX,IAAb,EAAKkG,MACL,EAAKA,IAAM,EAAKA,IAAIsxB,OACH,KAAb,EAAKtxB,MAAY,EAAKA,SAAMlG,KAEA,IAAhC,EAAKc,MAAMi4C,mBACX,EAAKh+B,UAAY,EAAK7U,MAZlC,EAeYqtC,SAfZ,uCAeuB,WAAOv5B,GAAP,SAAAnZ,EAAA,yDACfmZ,EAAI8e,iBACa,OAAb,EAAK5yB,MAAc,EAAKA,IAAM,EAAKpF,MAAMk4C,SAAW,KACpB,IAAhC,EAAKl4C,MAAMi4C,iBAHA,mBAIN,EAAK7yC,IAJC,iDAKP,EAAKozB,QAAO,EAAKA,MAAMve,UAAW,GAL3B,uBAOT,EAAKja,MAAMm4C,SAAS,EAAK/yC,KAPhB,OAQX,EAAKozB,QAAO,EAAKA,MAAMve,UAAW,GARvB,2CAfvB,4GA0BYxb,KAAK+5B,QAAO/5B,KAAK+5B,MAAMtiB,MAAQ,MA1B3C,+BA4Bc,IAGFkiC,EAHC,SAEkD35C,KAAKuB,MADvDgB,EADA,EACAA,UAAWq3C,EADX,EACWA,eAAgB5+B,EAD3B,EAC2BA,QAC5B9E,EAFC,EAEDA,MAAOiF,EAFN,EAEMA,YAAa0+B,EAFnB,EAEmBA,WAAY3+B,EAF/B,EAE+BA,UAEpC,OAJK,EAE0C8R,MAG3C,QACA,IAAK,KAAM2sB,EAAY,iBAAkB,MACzC,IAAK,KAAMA,EAAY,iBAAkB,MACzC,IAAK,KAAMA,EAAY,iBAE3B,OAAO,sBAAMp3C,UAAWA,EAAWyxC,SAAUh0C,KAAKg0C,SAA3C,SACH,sBAAKzxC,UAAW+V,IAAW,cAAeqhC,GAA1C,UACKzjC,GAAS,qBAAK3T,UAAU,2CAAf,SAA2D2T,IACrE,uBAAO+b,IAAK,SAAA5qB,GAAC,OAAE,EAAK0yB,MAAM1yB,GAAGmT,SAAUxa,KAAKwa,SACxChY,KAAK,OACLmF,KAAK,MACLqT,QAASA,EACTzY,UAAW+V,IAAW,eAAgBshC,GAAkB,kBACxDz+B,YAAaA,EACbQ,aAAc3b,KAAKuB,MAAMk4C,QACzBv+B,UAAWA,IACf,qBAAK3Y,UAAU,qBAAf,SACI,yBAAQA,UAAU,kBACdC,KAAK,SACLgZ,SAAUxb,KAAKwb,SAFnB,UAGI,mBAAGjZ,UAAU,iBACb,mBAAGA,UAAU,OACZs3C,gBAvDzB,GAA+Bn3C,aAA/B,sCAGKwR,KAHL,kE,+ICqCM4lC,EAAY,IAlDlB,WAKC,WAAYC,GAAqB,yBAJzBA,YAIwB,OAHxB7a,cAGwB,OAFxBt3B,IAAMsM,YAAW,IAAIc,UAGbvU,IAAXs5C,IAAsBA,EAAS,SAAC94C,GAAD,OAAiB6P,IAAQnH,KAAK1I,KACjEjB,KAAK+5C,OAASA,EAPhB,gDAUKtsC,EAAeyxB,GACbzxB,IACa,kBAAPA,IAAiBA,EAAKA,EAAGA,IAC/BA,IACLzN,KAAKk/B,SAAWA,EAChBzxB,EAAKF,OAAOE,QAEAhN,IADFT,KAAK4H,IAAI3H,IAAIwN,IAEtBzN,KAAK4H,IAAIlC,IAAI+H,EAAIA,OAlBpB,+BAsBUA,GAAoB,IAAD,OAC3B,GAAKA,EAAL,CACA,cAAeA,GACd,IAAK,SAEJ,KADAA,EAAKA,EAAGA,IACC,OAGX,IAAIvN,EAAMF,KAAK4H,IAAI3H,IAAIwN,GACvB,GAAKvN,EACL,cAAeA,GACf,QACC,OAAOA,EACR,IAAK,SACJ,OAAIA,EAAM,IACVF,KAAK4H,IAAIlC,IAAI+H,GAAKA,GAClBzN,KAAK+5C,OAAOtsC,GAAIic,MAAK,SAAAriB,GACfA,IAAGA,EAAI,MACZ,EAAKO,IAAIlC,IAAI+H,EAAIpG,GACb,EAAK63B,UAAU,EAAKA,SAAS73B,MAC/BwiB,OAAM,SAAA1gB,GACRrE,QAAQ7C,MAAMkH,OAPKsE,QApCvB,KAkDkB,MAAchN,GA4CnBu5C,GAlCWz+B,aAAS,SAACha,GAAsC,IAC/DgB,EAA6ChB,EAA7CgB,UAAWF,EAAkCd,EAAlCc,MAAOoL,EAA2BlM,EAA3BkM,GAAIghB,EAAuBltB,EAAvBktB,SAAUwrB,EAAa14C,EAAb04C,UACjCtwC,EAAOmwC,EAAUI,SAASzsC,GAC9B,cAAe9D,GAClB,IAAK,YACL,IAAK,SACE,OAAO,qBAAKpH,UAAW+V,IAAW/V,EAAW,cAAeF,MAAOA,EAA5D,SACF43C,GAAa,mBAAG13C,UAAU,mBAPgC,IAU9DyO,EAAQrH,EAARqH,KACL,OAAKA,IAKwB,IAAzBA,EAAKkO,WAAW,OAChBlO,EAAO9N,IAAIsF,OAASwI,EAAK9C,OAAO,IAE7B,qBAAK2E,IAAK7B,EAAMzO,UAAWA,EAAWmsB,IAAI,MAC7CrsB,MAAOA,EACPyP,QAAS,SAAA2I,GACSA,EAAIkU,cAAc9b,IAA5B4b,GACyB,8CAX1B,qBAAKlsB,UAAW+V,IAAW/V,EAAW,cAAeF,MAAOA,EAA5D,SACH,mBAAGE,UAAU,sBAqBDgZ,aAAS,SAACha,GAAsC,IAC/D44C,EAAkC54C,EAArCkM,GAAW9D,EAA0BpI,EAA1BoI,KAAM6N,EAAoBjW,EAApBiW,OAAQ0nB,EAAY39B,EAAZ29B,SAC9B,GAAa,OAATv1B,EAAe,OAAO,4CAC1B,cAAeA,GACd,IAAK,YACJA,EAAOmwC,EAAUI,SAASC,GAC1B,MACD,IAAK,SAAL,IACe1sC,EAAM9D,EAAN8D,GAEb2sC,EAAQ3sC,EAAIyxB,GACZv1B,EAAOmwC,EAAUI,SAASzsC,GAE3B,MACD,IAAK,SACJ2sC,EAAQzwC,EAAgBu1B,GACxBv1B,EAAOmwC,EAAUI,SAASvwC,GAC1B,MACD,IAAK,SACJywC,EAAQ7sC,OAAO5D,GAAOu1B,GACtBv1B,EAAOmwC,EAAUI,SAAS3sC,OAAO5D,IACjC,MACD,QACCA,OAAOlJ,EAGN,cAAekJ,GACjB,IAAK,YACL,IAAK,SACE,OAAO,mCAAGA,IAEf,OAAO6N,EAAO7N,OAGX,SAASywC,EAAQ3sC,EAAmByxB,GACrCzxB,IACc,kBAARA,IACVA,EAAMA,EAAWA,IAElBqsC,EAAUO,IAAI5sC,EAAIyxB,M,kHC9HNob,EAAK,SAACC,GAAsB,IACnCnnC,EAAsCmnC,EAAtCnnC,KAAMoJ,EAAgC+9B,EAAhC/9B,SAAUja,EAAsBg4C,EAAtBh4C,UAAWE,EAAW83C,EAAX93C,QAChC,IAAqB,IAAjBS,IAAImH,SAAmB,CAAC,IACtBmwC,EAAeD,EAAfC,WACL,IAAKpnC,EAAM,OAAO,sBAAM7Q,UAAU,cAAhB,2CAalB,OAAO,6CAAOg4C,GAAP,IAAgBh4C,UAAW+V,IAAW/V,EAAWi4C,GAAa/3C,QAZrD,SAACgY,GAEhB,IAAIva,EAQJ,OATAua,EAAI8e,iBAEA92B,EACHvC,EAAMuC,EAAQgY,IAGdvX,IAAI8M,SAASoD,GACblT,GAAM,GAEAA,GAED,SAAmFsc,KAErF,IACAi+B,EAAeF,EAAfE,YAOL,OANKh4C,IACJA,EAAU,WAET,OADAS,IAAIw3C,YAAYtnC,IACT,IAGF,sBAAM7Q,UAAW+V,IAAW/V,EAAW,iBAAkBk4C,GAAch4C,QAASA,EAAhF,SAA0F+Z,M,sMClCtFgyB,EAAb,WAII,WAAYtoC,GAAY,IAAD,gCAHNA,QAGM,OAFf6qC,eAEe,OADf4J,gBACe,OAafC,QAAU,WACd,EAAKC,kBADe,IAEfjN,EAAS,EAAK1nC,GAAd0nC,MACL,IAAK,IAAIzrC,KAAKyrC,EAAO,CACNA,EAAMzrC,GACZ24C,aAjBT96C,KAAKkG,GAAKA,EALlB,uDAQegpC,GACPlvC,KAAK66C,kBACL76C,KAAK26C,WAAa90C,IAAIC,WAAW,wBAAyB9F,KAAK46C,QAAS1L,KAVhF,6CAagCzuC,IAApBT,KAAK26C,aACT90C,IAAIE,aAAa/F,KAAK26C,YACtB36C,KAAK26C,gBAAal6C,KAf1B,iCA0BeswC,GACP,QAAkBtwC,IAAdswC,EAAJ,CACA,IAAIlsC,EAAMif,KAAKC,MAAMnf,KAAKC,MAAQ,UACXpE,IAAnBT,KAAK+wC,YACL/wC,KAAK+wC,UAAY/wC,KAAKkG,GAAGynC,eAAe1tC,WACjBQ,IAAnBT,KAAK+wC,YACL/wC,KAAK+wC,UAAY,CACb3b,IAAK2b,EACL5tC,QAAS0B,GAEb7E,KAAKkG,GAAGynC,eAAejoC,IAAI1F,KAAK+wC,aAVf,MAaJ/wC,KAAK+wC,UAArB3b,EAboB,EAapBA,IAEL,KAAIvwB,EAfqB,EAaf1B,QACI,SAEV4tC,GAAa3b,GAAjB,CACA,IAAI2lB,EAAsB,GACrBnN,EAAS5tC,KAAKkG,GAAd0nC,MACL,IAAK,IAAIzrC,KAAKyrC,EAEVmN,EAAW34C,KAAKD,GAEM,IAAtB44C,EAAW/1C,SACfhF,KAAK+wC,UAAU5tC,QAAU0B,EACzB7E,KAAKg7C,gBAAgBD,EAAW32B,KAAK,YAnD7C,+EAsDkC62B,GAtDlC,sHAuD6Bj7C,KAAKkG,GAArBwb,EAvDb,EAuDaA,MAAOksB,EAvDpB,EAuDoBA,MACPxY,EAAOp1B,KAAK+wC,UAAZ3b,IAxDb,SAyD0D1T,EAAMw5B,YAAY9lB,EAAK,GAAI6lB,GAzDrF,OAyDY/6C,EAzDZ,OA0DY+6B,EAAsD,GACtD8V,EAAmB,EA3D/B,cA4D2B7wC,EAAIi7C,OA5D/B,6DA4DiBC,EA5DjB,QA6DQ3tC,EAAmB2tC,EAAnB3tC,GAAIgZ,EAAe20B,EAAf30B,OAAQ9f,EAAOy0C,EAAPz0C,IA7DpB,gEAgEyBlG,KADTwiB,EAAO2qB,EAAMnnB,IA/D7B,6DAkEyBhmB,KADTqG,EAAOm0B,EAAMxU,MAEb3f,EAAOm0B,EAAMxU,GAAU,CAACxD,KAAMA,EAAM3O,IAAI,KAE5CxN,EAAKwN,IAAIlS,KAAKuE,GACV8G,EAAKsjC,IAAWA,EAAYtjC,GAtE5C,oFAAAsH,EAAA,wEAwEsBkmB,GAxEtB,sDAwEiB94B,EAxEjB,aAyE8B84B,EAAM94B,GAAnB8gB,EAzEjB,EAyEiBA,KAAM3O,EAzEvB,EAyEuBA,IAzEvB,UA0EkB2O,EAAKo4B,UAAU/mC,GA1EjC,gCA4EYzP,EAAMif,KAAKC,MAAMnf,KAAKC,MAAQ,KAClC7E,KAAK+wC,UAAY,CACb3b,IAAK2b,EACL5tC,QAAS0B,GAEb7E,KAAKkG,GAAGynC,eAAejoC,IAAI1F,KAAK+wC,WAjFxC,+H,wJCEauK,EAAb,WA6CI,WAAoBC,EAAqBxO,GAAU,yBAT3CyO,gBAS0C,OARjCzO,SAQiC,OANzChvB,cAMyC,OALzCC,aAKyC,OAJzCgE,cAIyC,OAHzCy5B,eAGyC,OAFlDhuC,QAEkD,EAC9CzN,KAAK+sC,IAAMA,GAAO,GAClB/sC,KAAK07C,WACL17C,KAAKw7C,WAAa,GAClB,IAAI79B,EAAQ49B,EAAa39B,MAAM,KAC/B,GAAqB,IAAjBD,EAAM3Y,OACN,MAAM,IAAI4J,MAAM,gDAEpB5O,KAAK+d,SAAWJ,EAAM,GACtB3d,KAAKge,QAAUL,EAAM,GACrB3d,KAAKgiB,SAAWnc,IAAIoP,QAAQrN,IAAI2zC,GAChCv7C,KAAKy7C,UAAYz7C,KAAKgiB,SAAS9M,MAAM,UAxD7C,+FAKmBqmC,EAAqBp1C,EAAgB4mC,GALxD,8FAMM4O,EAASL,EAAO7jC,MAAQ,IAAI6jC,EAAOC,EAAcxO,GAC1ChvB,EAAqB49B,EAArB59B,SAAUC,EAAW29B,EAAX39B,QACVy9B,EAAaE,EAAbF,WACDG,EAAsBH,EAAUx7C,QAClB27C,EAAUz1C,UAAYA,EAVhD,iCAWqBulB,YAAW3N,EAAUC,GAX1C,WAWG49B,EAXH,QAYkBnuC,GAZlB,0CAaW,CAAC,GAAD,OACHsQ,EADG,YACSC,EADT,iFAbX,QAiBY49B,EAAUz1C,QAAUA,EACpBs1C,EAAU/1C,IAAIk2C,GAlB1B,cAoB2BA,EAAUjwB,KApBrC,IAoBY,mCAAiC7X,YAAa,EApB1D,WAAAiB,EAAA,gCAsBatH,GAtBb,EAsBwBmuC,GAAXnuC,GAAIke,EAtBjB,EAsBiBA,IACTgwB,EAAOluC,GAAKA,EAvBpB,UAwBckuC,EAAO/1C,KAAK+lB,GAxB1B,yBAyB8BgwB,EAAO9c,OAzBrC,WA0BiC,KADrBgd,EAzBZ,QA0BsB72C,OA1BtB,oBA2BY62C,EAAUz5C,KAAV,MAAAy5C,EAAS,YAASF,EAAOG,wBACA,IAArBD,EAAU72C,OA5B1B,wBA6BgBs2C,EAAOS,KAAOJ,EAAOK,WA7BrC,2BAiCQV,EAAOW,OAASJ,EAjCxB,oJA4DU31C,GACFlG,KAAKw7C,WAAWt1C,EAAGyB,MAAQzB,IA7DnC,iCAiEQ,IAAK,IAAI/D,KAAKnC,KAAK+sC,IAAK,CACpB,IAAImP,EAAQl8C,KAAK+sC,IAAI5qC,GACrB,QAAc1B,IAAVy7C,EAAJ,CACA,IAAI/kC,EAAIhV,EAAE6L,cACV,GAAImJ,IAAMhV,EAEV,IAAK,IAAImuB,KADTtwB,KAAK+sC,IAAI51B,GAAK+kC,EACAA,EAAO,CACjB,IAAIz0B,EAAKy0B,EAAM5rB,GACf,QAAW7vB,IAAPgnB,EAAJ,CACA,IAAI00B,EAAK7rB,EAAEtiB,cACPmuC,IAAO7rB,IACX4rB,EAAMC,GAAM10B,SA5E5B,oEAiFe20B,GAjFf,qFAkFYC,EAAoCD,EAAQx0C,KAAI,SAAAilC,GAAW,IAC/DhvB,EAAmBgvB,EAAnBhvB,QAASC,EAAU+uB,EAAV/uB,OACVw+B,EAAaz+B,EAAU,IAAMC,EAK7B5X,EAAK,IAAI0mC,IAAM,EAAMC,OAAQpsC,EAAW,EAAKssC,IAAIuP,IAAe,EAAKvP,IAAIjvB,IAC7E,EAAK09B,WAAWc,GAAcp2C,EAC9B,IAAIq2C,EAAQD,EAAWtuC,cAIvB,OAHIuuC,IAAUD,IACb,EAAKd,WAAWe,GAASr2C,GAEnBA,EAAGN,UA/Fb,SAiGcuF,QAAQilB,IAAIisB,GAjG1B,+PAuGQ,IAASl6C,KAFL05C,EAAqB,GACrB/rB,EAAkC,GACxB9vB,KAAKw7C,WACXt1C,EAAKlG,KAAKw7C,WAAWr5C,GACzB2tB,EAAS1tB,KAAK8D,EAAGs2C,gBAzG7B,gBA2G4BrxC,QAAQilB,IAAIN,GA3GxC,OA2GYO,EA3GZ,qBA4G2BA,GA5G3B,4DA4GiBrQ,EA5GjB,aA+G6Bvf,KADbmpB,EAAW5J,GA9G3B,wBAgHgB67B,EAAUz5C,KAAKwnB,GAhH/B,2GAAA7U,EAAA,mFAoHe8mC,GApHf,uJAuHqB,IAAD,OACRvyB,EAAOtpB,KACP2rB,EAAU,GAFF,WAGHxpB,GAQL,IAPA,IAAIs6C,EAAQ,EAAKjB,WAAWr5C,GAExB2b,EAAS2+B,EAAM3+B,OACf3G,EAAI2G,EAAO9P,cACpB0uC,EAAe5+B,EAAOF,MAAM,SAASwG,KAAK,IAAIpW,cACrC4U,EAAW65B,EAAM75B,SAErB,MADWhN,OAAOD,KAAKiN,GACvB,eAAsB,CAAjB,IACG6D,EAAS7D,EADL,MAGpBA,EADa6D,EAAR9e,KACSqG,eAAiByY,EAEvB,IAAIk2B,EAAQhxB,EAAIxU,GAAK,IAAIylC,MAAMh6B,EAAU,CACrC3iB,IAAK,SAAS0a,EAAQhU,EAAKk2C,GACvB,IACI38C,EAAMya,EADAhU,EAAeqH,eAEzB,QAAYvN,IAARP,EAAmB,OAAOA,EAE7C,IAAIgC,EAAG,iBAAa4b,EAAb,YAAuBhL,OAAOnM,GAA9B,gBACQ7B,QAAQ7C,MAAMC,GACdonB,EAAKwzB,WAAW,uBAAU56C,MAIvCw6C,IAAUvlC,IAAGwU,EAAI+wB,GAASC,IAzBzB,IAAK,IAAIx6C,KAAKnC,KAAKw7C,WAAa,EAAvBr5C,GA4BT,OAAO,IAAIy6C,MAAMjxB,EAAK,CAClB1rB,IAAK,SAAU0a,EAAQhU,EAAKk2C,GACxB,IACI38C,EAAMya,EADAhU,EAAeqH,eAEzB,QAAYvN,IAARP,EAAmB,OAAOA,EAQ9B4E,QAAQ7C,MAAM,gBACdqnB,EAAKwzB,WAAL,wDAA8BhqC,OAAOnM,UAnKrD,wCA0KE,OAAO3G,KAAKw7C,aA1Kd,iCA6KuBh4C,GACfxD,KAAKgiB,SAAS+S,YACd7xB,MAAI8I,eAAexI,KA/K3B,4CAmLQ,IAAItD,EAAe,GACnB,IAAK,IAAIiC,KAAKnC,KAAKw7C,WAAY,CAC3B,IAD2B,EACvBt1C,EAAKlG,KAAKw7C,WAAWr5C,GADE,cAEV+D,EAAG4nC,SAFO,IAE3B,2BAA6B,CAAC,IAArB7qB,EAAoB,QACzB,IAAsB,IAAlBA,EAAK85B,SAAmB,CACxB,IAAI96C,EAAQjC,KAAKg9C,SAAS/5B,GACtBhhB,GAAO/B,EAAIkC,KAAKH,KALD,+BAS/B,OAAO/B,IA7Lf,+BAgMqB+8C,GAAgC,IACxCp9B,EAAQo9B,EAARp9B,KACDq9B,EAAWr9B,EAAK+wB,MAAQ,IAAM/wB,EAAK3Z,GACnCA,EAAKlG,KAAKw7C,WAAW0B,GACzB,QAAWz8C,IAAPyF,EAEA,MAAM,wCAAN,OAA+Cg3C,EAA/C,kBAEJ,IAAIC,EAAQF,EAAWt1C,KACnBsb,EAAO/c,EAAG+c,KAAKk6B,GACnB,YAAa18C,IAATwiB,EAEM,wCAAN,OAA+Ci6B,EAA/C,wBAAuEC,IAErD,IAAlBl6B,EAAK85B,SAEC,wCAAN,OAA+CG,EAA/C,iBAAgEC,EAAhE,mBAEJF,EAAWG,QAAQn6B,OAlN3B,KAAaq4B,EACLS,U,EADKT,EAEL7jC,W,EAFK6jC,EAGLW,Y,kECuSM,IAAI57B,WAAW,GACf,IAAIA,WAAW,GASf,IAAIA,WAAW,GACf,IAAIA,WAAW,I,6BC3R7B,sCAAMg9B,EAAe,CACjBC,EAAG,qBACHC,EAAG,eACHC,EAAG,sBAEA,SAASC,EAAYl9C,GACxB,OAAO88C,EAAa98C,EAAKiC,Q,+MC7BhBk7C,EADZniC,YACD,oDAEI,WAAYha,GAAuB,IAAD,8BAC9B,cAAMA,IAFVi1B,cACkC,EAE9B,EAAKA,SAAW,IAAIqd,IAAS,EAAKtyC,OAClC,EAAKi1B,SAAS2F,cAAc,EAAK56B,MAAM0yC,YAHT,EAFtC,sFAUc,IAAD,EACuBj0C,KAAKuB,MAA5BgB,EADA,EACAA,UAAWia,EADX,EACWA,SAChB,OAAO,qBAAKja,UAAWA,EAAhB,cAEc9B,IAAb+b,EACIxc,KAAKw2B,SAAShf,SACd,sBAAMw8B,SAAUh0C,KAAKw2B,SAASwd,SAA9B,SAAyCx3B,UAhB7D,GAA+B9Z,eAA/B,G,+JCoBai7C,EAAb,kDAII,WAAYp8C,GAAQ,IAAD,8BACf,cAAMA,IAJFijB,OAAc,GAGH,EAFXo5B,UAAwB,GAEb,EADXC,aACW,IA0CXC,OAAS,SAACt5B,GACdlU,IAAEsnB,OAAO,EAAKpT,OAAQA,GACtB,EAAKq5B,QAAU,EAAKD,UAAUr4C,MAC9B,EAAKjC,SAAS,CACVu6C,QAAS,EAAKA,QACdD,UAAW,EAAKA,aA/CL,EAkDXG,OAAS,SAACv5B,GACdlU,IAAEsnB,OAAO,EAAKpT,OAAQA,GADwC,IAO1Dw5B,EAJCC,EAAQ,EAAKJ,QAAQ1qC,KAArB8qC,KACL,QAAax9C,IAATw9C,EACA,OAAO,EAAK18C,MAAMyyC,SAAS,EAAKxvB,QAIhCw5B,EADgB,kBAATC,EACQA,EAGAA,EAAK,EAAKz5B,QAE7B,EAAK05B,QAAQF,IA9Db,EAAK56C,MAAQ,CACTy6C,aAASp9C,EACTm9C,UAAW,IAIf,EAAKM,QAAQ,EAAK38C,MAAM48C,OART,EAJvB,oDAeoBC,GACZ,IAAIjrC,EAAOnT,KAAKuB,MAAM88C,MAAMD,GAC5B,QAAa39C,IAAT0S,EAAJ,CAEA,IAAI2nB,EAAaJ,OADIj6B,IAAjBT,KAAK69C,SAAuB79C,KAAK49C,UAAUx7C,KAAKpC,KAAK69C,SAErD79C,KAAK49C,UAAU54C,OAAS,IACxB81B,EAAc,cAACwjB,EAAD,CAAcC,OAAO,OAAOjrC,KAAK,uBAC/ConB,EAAU16B,KAAK89C,QAGnB,IAAIU,OAA2B/9C,IAAd0S,EAAK8qC,KAClB,CAACM,OAAQ,eAAgBjrC,KAAMtT,KAAKuB,MAAMs5B,cAAgB,gBAC1D,CAACyO,OAAQ,cAAeh2B,KAAM,sBAC9BmrC,EAAY,CACZvK,SAAU/gC,EAAK+gC,SACfrZ,aAAc,cAACyjB,EAAD,eAAkBE,IAChCxK,SAAUh0C,KAAK+9C,OACfjjB,YAAaA,EACbJ,QAASA,GAGb16B,KAAK69C,QAAU,CACXO,SAAUA,EACVjrC,KAAMA,EACN5R,MAAOk9C,GAEXz+C,KAAKsD,SAAS,CACVu6C,QAAS79C,KAAK69C,QACdD,UAAW59C,KAAK49C,eA3C5B,+BAsEc,IAAD,EAC6B59C,KAAKuB,MAAlCgB,EADA,EACAA,UAAWM,EADX,EACWA,OAAQiX,EADnB,EACmBA,OADnB,EAEsB9Z,KAAKoD,MAA3By6C,EAFA,EAEAA,QAASD,EAFT,EAESA,UACTQ,EAAkBP,EAAlBO,SAAUjrC,EAAQ0qC,EAAR1qC,KAEXq0B,EAAMoW,EAAU54C,OAAS,EAC7B,OAAO,qBAAKzC,UAAWA,EAAhB,SACH,gCACKM,GAAUA,EAAOsQ,EAAMq0B,GACxB,cAAC,YAAD,aAA0ByM,WAAYj0C,KAAKwkB,QAAYq5B,EAAQt8C,OAA/C68C,GACftkC,GAAUA,EAAO3G,EAAMq0B,YAhFxC,GAA+B9kC,aAsFzB47C,EAAe,SAAC/8C,GAAsE,IAEpFm9C,EAAWC,EADVJ,EAAkBh9C,EAAlBg9C,OAAQjV,EAAU/nC,EAAV+nC,OAIb,YAFe7oC,IAAX89C,IAAsBG,EAAQ,mBAAGn8C,UAAWA,IAAU,KAAM,MAAQg8C,WACzD99C,IAAX6oC,IAAsBqV,EAAQ,mBAAGp8C,UAAWA,IAAU,KAAM,MAAQ+mC,MACjE,eAAC,WAAD,WAAiBoV,EAAjB,IAAyBn9C,EAAM+R,KAA/B,IAAsCqrC,O,4QC1H3BC,EAAtB,kCAOaC,EAAb,kDAEI,WAAYC,GAAkB,IAAD,8BACzB,gBAFIA,UACqB,EAEzB,EAAKA,KAAOA,EAFa,EAFjC,kDAMUC,EAAetnC,GACjB,IAAIvX,EAAMF,KAAK8+C,KAAKrnC,GACpB,QAAYhX,IAARP,EACJ,cAAeA,GACX,IAAK,YAAa,OAClB,IAAK,SAAoC,YAA1B6+C,EAAK38C,KAAKlC,GACzB,QAA4B,YAAnB6+C,EAAK38C,KAAL,MAAA28C,EAAI,YAAS7+C,SAZlC,GAAgC0+C,GAiBVI,EAAtB,kDAEI,WAAYryC,GAAe,IAAD,8BACtB,gBAFMA,SACgB,EAEtB,EAAKA,IAAMA,EAFW,EAF9B,UAA6CiyC,GAQhCK,EAAb,oKACUF,EAAetnC,GACjB,cAAeA,GACX,QACA,IAAK,UAAW,OAChB,IAAK,SACD,GAAc,OAAVA,EAAgB,OACpB,MACJ,IAAK,SACD,GAAKA,EAAiBwgB,OAAOjzB,OAAS,EAAG,OACzC,MACJ,IAAK,SACD,IAA+B,IAA3BkgB,MAAMzN,GAA4B,OACtC,MACJ,IAAK,aAGTsnC,EAAK38C,KAAKpC,KAAK2M,IAAIqrB,cAjB3B,GAAkCgnB,GAqBrBE,EAAb,kDAKI,WAAYvyC,EAAcssB,EAAc7D,GAAe,IAAD,8BAClD,cAAMzoB,IALFwyC,YAI8C,IAH9CC,YAG8C,IAF5CnmB,SAE4C,IAD5C7D,SAC4C,EAElD,EAAK+pB,OAAS7uC,IAAE+uC,SAAS1yC,EAAIssB,KAC7B,EAAKmmB,OAAS9uC,IAAE+uC,SAAS1yC,EAAIyoB,KAC7B,EAAK6D,IAAMA,EACX,EAAK7D,IAAMA,EALuC,EAL1D,kDAYU2pB,EAAetnC,GACjB,QAAchX,IAAVgX,GAAiC,OAAVA,EAA3B,CACA,IAAIwN,EAAI1X,OAAOkK,IACE,IAAbyN,MAAMD,GACN85B,EAAK38C,KAAKpC,KAAK2M,IAAIspC,QAGnBj2C,KAAKs/C,UAAUP,EAAM95B,MAnBjC,gCAuBwB85B,EAAetnC,QACdhX,IAAbT,KAAKi5B,KAAqB1rB,OAAOkK,GAASzX,KAAKi5B,KAC/C8lB,EAAK38C,KAAKpC,KAAKm/C,OAAO,CAAClmB,IAAIj5B,KAAKi5B,YAEnBx4B,IAAbT,KAAKo1B,KAAqB7nB,OAAOkK,GAASzX,KAAKo1B,KAC/C2pB,EAAK38C,KAAKpC,KAAKo/C,OAAO,CAAChqB,IAAIp1B,KAAKo1B,WA5B5C,GAA6B4pB,GAiChBO,EAAb,wKACwBR,EAAe95B,GAC/B,iEAAgB85B,EAAM95B,IACM,IAAxB1X,OAAOiyC,UAAUv6B,IACjB85B,EAAK38C,KAAKpC,KAAK2M,IAAIupC,aAJ/B,GAA6BgJ,G,QChFPO,GAAtB,aAiBI,WAAYC,EAAiBn6B,EAAuBo6B,EAAuBnjC,GAA4B,IAAD,gCAhBtG7U,UAgBsG,OAf5F+3C,aAe4F,OAd5FC,gBAc4F,OAb5FnjC,cAa4F,OAZ5FiJ,iBAY4F,OAX5Fm6B,SAW4F,OAV/FjkC,kBAU+F,OAT/FlE,WAS+F,OAR5FyO,WAQ4F,kFAJ5FmuB,cAI4F,OAH5F74B,cAG4F,0CA6G9FqkC,gBA7G8F,OA8G5FnK,cAAgB,SAACj7B,GACvB,EAAKqlC,YAAYrlC,EAAIE,OAAOlD,OAAO,IA/G+D,KAkKtGsoC,UAAYxkC,aAAS,WACjB,IAAqB,IAAjB,EAAKykC,QAAmB,OAAO,KADA,MAEd,EAAKN,QAArB1kB,EAF8B,EAE9BA,KACL,IAAe,IAHoB,EAExBilB,OACU,OAAO,EAAKzoC,SACjC,IAAItB,EAAY,EAAKA,MAIrB,OAHiC,IAA7B,EAAKqP,WAAWyS,WAAiD,IAA5BgD,EAAKz5B,MAAM2+C,cAClC,OAAVhqC,IAAgBA,EAAQ,qCAAGA,EAAH,OAAe,sBAAM3T,UAAU,cAAhB,mBAExCy4B,EAAKmlB,eAAejqC,EAAO,EAAKkqC,iBAzKvCpgD,KAAK0/C,QAAUA,EADmF,IAE7F/3C,EAAQ4d,EAAR5d,KAML,GALA3H,KAAK2H,KAAOA,EACZ3H,KAAKylB,YAAcF,EACnBvlB,KAAK2/C,WAAaA,EAClB3/C,KAAKwc,SAAWA,EAChBxc,KAAK4/C,IAAMF,EAAQW,UAAU14C,QACblH,IAAZT,KAAKqoB,GACLroB,KAAKq0C,UAAW,EAChBr0C,KAAKwb,UAAW,EAChBxb,KAAKggD,SAAU,MAEd,CAAC,IAAD,EACmChgD,KAAKqoB,GAApCgsB,EADJ,EACIA,SAAU74B,EADd,EACcA,SAAUwkC,EADxB,EACwBA,QACzBhgD,KAAKq0C,UAAyB,IAAbA,EACjBr0C,KAAKwb,UAAyB,IAAbA,EACjBxb,KAAKggD,WAAwB,IAAZA,GAErBhgD,KAAKyX,MAAQzX,KAAK2b,aAAgB+jC,EAAQxF,SAASvyC,GApC3D,qDAYgD,OAAQ3H,KAAKi8C,OAAOj3C,OAAShF,KAAKsgD,cAAct7C,OAAQ,MAZxG,4CAiDQ,GALAhF,KAAKkmB,MAAQ,IACoB,IAA7BlmB,KAAKulB,WAAWyS,UAChBh4B,KAAKkmB,MAAM9jB,KAAK,IAAI68C,EAAaj/C,KAAK0/C,QAAQ1kB,KAAKruB,MAEvD3M,KAAKugD,kBACW9/C,IAAZT,KAAKqoB,GAAT,CANG,IAOEnC,EAASlmB,KAAKqoB,GAAdnC,MACL,QAAczlB,IAAVylB,EACJ,IAA6B,IAAzBE,MAAMC,QAAQH,GAAlB,CATG,oBAacA,GAbd,IAaH,2BAAuC,CAAC,IAA/BK,EAA8B,QACnCvmB,KAAKkmB,MAAM9jB,KAAK,IAAIy8C,EAAWt4B,KAdhC,oCAUCvmB,KAAKkmB,MAAM9jB,KAAK,IAAIy8C,EAAW34B,OArD3C,yEAiEQ,IADS,EAMJ,EALD64B,EAAgB,GADX,cAEK/+C,KAAKkmB,OAFV,IAET,oCAA4Bkf,MAAM2Z,EAAM/+C,KAAKyX,QAFpC,8BAGW,IAAhBsnC,EAAK/5C,OACLhF,KAAK0/C,QAAQc,kBAAkBxgD,OAG/BA,KAAK0/C,QAAQe,eAAezgD,OAC5B,EAAAA,KAAKi8C,QAAO75C,KAAZ,QAAoB28C,MAxEhC,+BAgFa78C,GAAwB,IAAD,OAChBzB,IAARyB,IACe,kBAARA,EAAkBlC,KAAKi8C,OAAO75C,KAAKF,IACzC,EAAAlC,KAAKi8C,QAAO75C,KAAZ,oBAAoBF,OAnFjC,sCAsFoBA,GAAwB,IAAD,OACvBzB,IAARyB,IACe,kBAARA,EAAkBlC,KAAKsgD,cAAcl+C,KAAKF,IAChD,EAAAlC,KAAKsgD,eAAcl+C,KAAnB,oBAA2BF,OAzFxC,mCA6FQlC,KAAKi8C,OAAO/mB,OAAO,KA7F3B,0CAiGQl1B,KAAKsgD,cAAcprB,OAAO,KAjGlC,4BAoGoBzd,GAAgB,OAAOA,IApG3C,sCAsG8BA,MAtG9B,mCAuG2BA,IACK,IAApBzX,KAAK6/C,aACT7/C,KAAK0/C,QAAQgB,SAAS1gD,KAAK2H,MAAQ3H,KAAKyX,MAAQzX,KAAKmN,MAAMsK,MAzGnE,+BA4GaA,IACmB,IAApBzX,KAAK6/C,YAGT7/C,KAAK8/C,YAAYroC,GAAO,KAhHhC,iCAoHQ,OAAOzX,KAAK0/C,QAAQxF,SAASl6C,KAAK2H,QApH1C,oCAuH2B,OAAO3H,KAAKq0C,WAvHvC,oCAwH2B,OAAOr0C,KAAKwb,WAxHvC,mCAyH0B,OAAOxb,KAAKggD,UAzHtC,kCA0HgBvoC,GAAgBzX,KAAKq0C,SAAW58B,IA1HhD,kCA2HgBA,GAAgBzX,KAAKwb,SAAW/D,IA3HhD,iCA4HeA,GAAgBzX,KAAKggD,QAAUvoC,IA5H9C,kCAmI0BiD,EAAeimC,GACjC,IACIC,EACAC,EAFAC,EAAO9gD,KAAKyX,WAGAhX,IAAZT,KAAKqoB,KACLu4B,EAAa5gD,KAAKqoB,GAAGu4B,WACrBC,EAAY7gD,KAAKqoB,GAAGw4B,WAExB,IAAIE,GAAc,OACCtgD,IAAfmgD,IACA5gD,KAAK6/C,YAAa,EAClBkB,EAAcH,EAAW5gD,KAAK0/C,QAAS1/C,KAAKyX,MAAOqpC,GACnD9gD,KAAK6/C,YAAa,IAEF,IAAhBkB,IACA/gD,KAAKghD,aAAatmC,IACE,IAAhBimC,GAAsB3gD,KAAKihD,gBAAgBvmC,QAC7Bja,IAAdogD,IACA7gD,KAAK6/C,YAAa,EAClBgB,EAAU7gD,KAAK0/C,QAAS1/C,KAAKyX,MAAOqpC,GACpC9gD,KAAK6/C,YAAa,MAvJlC,mCAqKQ,IAAIqB,EACJ,IAAsB,IAAlBlhD,KAAK22B,UAAsB32B,KAAKqoB,GAAI,CAAC,IAAD,EACMroB,KAAKqoB,GAA1C8oB,EAD+B,EAC/BA,YAAagQ,EADkB,EAClBA,0BACW1gD,IAAzB0gD,IAAoCA,EAAuB,oBAC/DD,EAAgB,sBAAM3+C,UAAW4+C,EAAjB,SACXhQ,IAGT,OAAO,qCACFnxC,KAAKwX,SACL0pC,OA/Kb,sCA4MQ,QAAsBzgD,IAAlBT,KAAKwc,SACL,OAAO,mCAAGxc,KAAKwc,WAEnB,QAAgB/b,IAAZT,KAAKqoB,GAAT,CAJ8C,IAKzCtC,EAAW/lB,KAAKqoB,GAAhBtC,QACL,MAAuB,oBAAZA,EAA+BA,EAAQ/lB,KAAKyX,OAChDsO,KAlNf,qCAsNQ,IAAIq7B,EAAkB,sBAAOphD,KAAKi8C,QAAZ,YAAuBj8C,KAAKsgD,gBAClD,GAAyB,IAArBc,EAAUp8C,OAAc,OAAO,KAFd,IAIjB02B,GAAiB,IADN17B,KAAK0/C,QAAfO,OACsB,OAAS,MACpC,OAAOmB,EAAUx5C,KAAI,SAAA1F,GAAG,OAAIQ,gBAAoBg5B,EAC5C,CACI/0B,IAAKzE,EACLK,UAAW,wCAEf,qCAAE,mBAAGA,UAAU,6BAAf,QAAoDL,WA/NhE,iCAwC4C,OAAOlC,KAAKylB,cAxCxD,yBAyCgC,OAAOzlB,KAAK4/C,MAzC5C,2BA6EQ,OAA6B,IAAtB5/C,KAAKi8C,OAAOj3C,SA7E3B,gCA6JQ,IAAIq8C,EAEJ,OAD4B,IAAxBrhD,KAAK0/C,QAAQO,SAAkBoB,EAAa,gBACzC/oC,IAAW+oC,EAAYrhD,KAAK0/C,QAAQ1kB,KAAKsmB,WAAYthD,KAAKqoB,IAAMroB,KAAKqoB,GAAG9lB,aA/JvF,4BA+LQ,IAAI2T,EACJ,QAAgBzV,IAAZT,KAAKqoB,GACLnS,EAAQlW,KAAK2H,SAEZ,CACD,IAAI45C,EAAUvhD,KAAKqoB,GAAGnS,MACAA,EAAN,OAAZqrC,EAA0B,KACjBA,GAAWvhD,KAAK2H,KAEjC,OAAOuO,MAxMf,yCAUKhC,KAVL,wEAUmC,MAVnC,2CAWKA,KAXL,wEAWoD,MAXpD,oCAYK0iB,KAZL,0GAeK1iB,KAfL,8FA4EK0iB,KA5EL,oECJa4qB,GAAb,8MACcC,UAAY,OAD1B,EAGc1nB,WAHd,+CAWcte,UAXd,uCAW0B,WAAOhB,GAAP,iBAAAnZ,EAAA,yDAClB,EAAKogD,kBAAkBjnC,GACH,KAAhBA,EAAIiB,QAFU,yDAIFjb,KADXkhD,EAAW,EAAKjC,QAAQ1kB,KAAKz5B,MAA7BogD,SAHa,wDAMlB,EAAK7B,YAAYrlC,EAAIkU,cAAclX,OAAO,GAI1C,EAAKsiB,MAAM6nB,OAVO,UAYFD,EAAQ,EAAKh6C,KAAM,EAAK+3C,SAZtB,aAaNj/C,KADRP,EAZc,SAcd,EAAKw/C,QAAQxjB,SAAS,EAAKv0B,KAAMzH,GAdnB,4CAX1B,wDAgCc4a,OAAS,SAACL,GAChB,EAAKi7B,cAAcj7B,GACnB,EAAKonC,aACX,EAAKnC,QAAQoC,oBACb,EAAKC,UAAW,GApClB,EAsCc/mC,QAAU,SAACP,GACjB,EAAKjZ,aACL,EAAKk+C,QAAQc,kBAAb,gBACA,EAAKd,QAAQvoB,cACnB,EAAK4qB,UAAW,GA1ClB,8DAM8BtqC,GACH,OAAfzX,KAAK+5B,QACT/5B,KAAK+5B,MAAMtiB,MAAQA,KAR3B,wCA6BgCgD,MA7BhC,+BA4CuBA,MA5CvB,kCA+CgBhD,GACW,OAAfzX,KAAK+5B,QACT/5B,KAAK+5B,MAAMsa,SAAWr0C,KAAKq0C,SAAW58B,KAjD9C,kCAmDgBA,GACW,OAAfzX,KAAK+5B,QACT/5B,KAAK+5B,MAAMve,SAAWxb,KAAKwb,SAAW/D,KArD9C,+BAwDc,IAAD,OACDuqC,EAAgBhiD,KAAKgiD,gBACzB,QAAsBvhD,IAAlBuhD,EAA6B,OAAOA,EACxC,IAAI5uB,EAAS,GASb,OANsB,IAAlBpzB,KAAK22B,SACLvD,EAAG,eAAgB,EAGnBA,EAAG,kBAAgD,IAA7BpzB,KAAKulB,WAAWyS,SAEnC,qCAAE,uBAAO/F,IAAK,SAAA8H,GAAK,OAAE,EAAKA,MAAQA,GACrCx3B,UAAW+V,IAAWtY,KAAKuC,UAAW6wB,GACtC5wB,KAAMxC,KAAKyhD,UACX9lC,aAAc3b,KAAKyX,MACnB+C,SAAU,SAACC,GAAD,OAAiC,EAAKD,SAASC,IACzDU,YAAanb,KAAKmb,YAClBk5B,SAAUr0C,KAAKq0C,SACf74B,SAAUxb,KAAKwb,SACfC,UAAazb,KAAKyb,UAClBT,QAAWhb,KAAKgb,QAChBF,OAAQ9a,KAAK8a,OACbI,UAAYlb,KAAKulB,WAA4BrK,YAC5Clb,KAAKiiD,oBAhFlB,yBAEoC,OAAOjiD,KAAK4/C,MAFhD,kCAUiC,OAAQ5/C,KAAKqoB,IAAMroB,KAAKqoB,GAAGlN,aAAgBnb,KAAK2H,SAVjF,GAAgC83C,GAAhC,sCAIKvrC,KAJL,iECAaguC,EAAb,4MAEcnoB,WAFd,IAMc2b,cAAgB,SAACj7B,GACvB,EAAK0nC,SAAS1nC,EAAIkU,cAAclX,QAPxC,EAaWqD,OAAS,SAACL,GACb,EAAKi7B,cAAcj7B,GACnB,EAAKonC,aACL,EAAKnC,QAAQoC,qBAhBrB,EAkBc9mC,QAAU,SAACP,GACjB,EAAKjZ,aACL,EAAKk+C,QAAQc,kBAAb,gBACA,EAAKd,QAAQvoB,eArBrB,8DAK8B1f,GAAYzX,KAAK+5B,MAAMtiB,MAAQA,IAL7D,kCAUgBA,GAAgBzX,KAAK+5B,MAAMsa,SAAWr0C,KAAKq0C,SAAW58B,IAVtE,kCAWgBA,GAAgBzX,KAAK+5B,MAAMve,SAAWxb,KAAKwb,SAAW/D,IAXtE,+BAwBc,IAAD,OACDuqC,EAAgBhiD,KAAKgiD,gBACzB,QAAsBvhD,IAAlBuhD,EAA6B,OAAOA,EACxC,IAAI5uB,EAAS,GAOb,OANsB,IAAlBpzB,KAAK22B,SACLvD,EAAG,eAAgB,EAGnBA,EAAG,kBAAgD,IAA7BpzB,KAAKulB,WAAWyS,SAEnC,qCACZ,0BAAU/F,IAAK,SAAC8H,GAAD,OAAW,EAAKA,MAAMA,GACpCjf,OAAQ9a,KAAK8a,OACbE,QAAShb,KAAKgb,QACFzY,UAAW+V,IAAWtY,KAAKuC,UAAW6wB,GACtCkF,KAAMt4B,KAAKqoB,IAAMroB,KAAKqoB,GAAGiQ,KACzBpd,UAAWlb,KAAKulB,WAAWrK,UAC3BS,aAAc3b,KAAK2b,aAAcnB,SAAUxa,KAAK01C,gBACnD11C,KAAKiiD,oBA1ClB,iCAC8C,OAAOjiD,KAAKylB,cAD1D,yBAGwC,OAAOzlB,KAAK4/C,QAHpD,GAAoCH,GCHvB2C,EAAb,4MACcX,UAAY,WAD1B,YAAoCD,GAIvBa,EAAb,4MACcZ,UAAY,MAD1B,YAA+BD,GAIlBc,EAAb,4MACcb,UAAY,QAD1B,YAAiCD,GCNpBe,EAAb,4MACcd,UAAY,SAD1B,2DAKQ,mEACA,IAAI90C,EAAM3M,KAAK0/C,QAAQ1kB,KAAKruB,IAFT,EAGF3M,KAAKulB,WAAjB0T,EAHc,EAGdA,IAAK7D,EAHS,EAGTA,IACVp1B,KAAKkmB,MAAM9jB,KACkB,YAAzBpC,KAAKulB,WAAW/iB,KACZ,IAAI08C,EAAQvyC,EAAKssB,EAAK7D,GACtB,IAAImqB,EAAQ5yC,EAAKssB,EAAK7D,MAXtC,4BAuBoB3d,GACZ,QAAchX,IAAVgX,GAAiC,OAAVA,EAC3B,OAAOlK,OAAOkK,KAzBtB,iCAE+C,OAAOzX,KAAKylB,gBAF3D,GAAkC+7B,GCFrBgB,EAAb,4MACcf,UAAY,SAD1B,yDAGyB96C,GACjB,OAAa,KAANA,GAAkB,IAANA,GAAiB,KAANA,GAAkB,KAANA,GAClCA,GAAK,IAAMA,GAAK,IAChBA,GAAK,IAAMA,GAAK,KACX,MAANA,GAAmB,MAANA,IAP5B,wCAUgC8T,GACxB,IAAI9T,EAAM8T,EAAIiB,QACdxW,OAAO2D,MAAM45C,YAAcziD,KAAK0iD,WAAW/7C,OAZnD,GAAkC47C,GCArBI,GAAb,4MACclB,UAAY,OAD1B,YAAgCD,GAInBoB,GAAb,4MACcnB,UAAY,WAD1B,YAAoCD,GAIvBqB,GAAb,4MACcpB,UAAY,OAD1B,YAAgCD,GAInBsB,GAAb,4MACcrB,UAAY,QAD1B,YAAiCD,GCVpBuB,GAAb,4MACchpB,WADd,IAGcrC,eAHd,IAIcC,gBAJd,IA0Bc+d,cAAgB,SAACj7B,GACvB,IAAIpT,GAA2B,IAAvBoT,EAAIE,OAAOkd,QAAkB,EAAKH,UAAY,EAAKC,WAC3D,EAAKqpB,aAAa35C,IA5B1B,EA+Bc5E,QAAU,WAChB,EAAKi9C,QAAQvoB,eAhCrB,qDAQQ,GADA,kEACgB12B,IAAZT,KAAKqoB,GAAkB,CAAC,IAAD,EACOroB,KAAKqoB,GAA9BqP,EADkB,EAClBA,UAAWC,EADO,EACPA,WACa33B,KAAK03B,eAAhBj3B,IAAdi3B,GACkBA,EACQ13B,KAAK23B,gBAAhBl3B,IAAfk3B,GACmBA,OAGvB33B,KAAK03B,WAAY,EACjB13B,KAAK23B,YAAa,IAjB9B,sCAoB8BlgB,GACtBzX,KAAK+5B,MAAMlC,QAAUpgB,IAAUzX,KAAK03B,YArB5C,kCAuBgBjgB,GAAgBzX,KAAK+5B,MAAMsa,SAAWr0C,KAAKq0C,SAAW58B,IAvBtE,kCAwBgBA,GAAgBzX,KAAK+5B,MAAMve,SAAWxb,KAAKwb,SAAW/D,IAxBtE,+BAmCc,IAAD,OACD2b,EAAK9a,IAAWtY,KAAKuC,UAAW,yBAChCw3B,EAAQ,uBACR9H,IAAK,SAAC8H,GAAD,OAAS,EAAKA,MAAQA,GAC3Bx3B,UAAW,oBACXC,KAAK,WACL6pC,eAAgBrsC,KAAK2b,aACrBnB,SAAUxa,KAAK01C,cACfjzC,QAASzC,KAAKyC,UAClB,OAA4B,IAAxBzC,KAAK0/C,QAAQO,OACN,wBAAO19C,UAAW6wB,EAAlB,UACF2G,EADE,IACO/5B,KAAKqoB,IAAIroB,KAAKqoB,GAAGnS,OAAUlW,KAAK2H,QAIvC,qBAAKpF,UAAW6wB,EAAhB,SACH,uBAAO7wB,UAAU,iDAAjB,SAAmEw3B,QAnDnF,yBAEqC,OAAO/5B,KAAK4/C,QAFjD,GAAoCH,GCCvBuD,IAAb,8MACcC,YADd,+CAMcvN,cAAgB,SAACj7B,GACvB,EAAKumC,aAAavmC,EAAIE,OAAOlD,QAPrC,8DAK8BA,GAAYzX,KAAKijD,OAAOxrC,MAAQA,IAL9D,kCAUgBA,GAAgBzX,KAAKijD,OAAOznC,SAAWxb,KAAKq0C,UAAY58B,IAVxE,kCAWgBA,GAAgBzX,KAAKijD,OAAOznC,SAAWxb,KAAKwb,SAAW/D,IAXvE,+BAac,IAAD,OACL,IAAsB,IAAlBzX,KAAKq0C,SAAmB,CACxB,IAAI6O,EAASljD,KAAKqoB,GAAGpC,KAAK7e,MAAK,SAAAC,GAAC,OAAIA,EAAEoQ,QAAU,EAAKA,SACjDlU,OAAoB9C,IAAXyiD,EAAuB,QAAUA,EAAO3/C,MACrD,OAAO,sBAAMhB,UAAU,wBAAhB,SAAyCgB,IAEpD,OAAO,wBACH0uB,IAAK,SAACgxB,GAAD,OAAU,EAAKA,OAASA,GAC7B1gD,UAAW+V,IAAWtY,KAAKuC,UAAW,gBACtCoZ,aAAc3b,KAAK2b,aACnBnB,SAAUxa,KAAK01C,cAJZ,SAKF11C,KAAKqoB,GAAGpC,KAAKre,KAAI,SAACP,EAAEQ,GAAW,IACvBtE,EAAgB8D,EAAhB9D,MAAOkU,EAASpQ,EAAToQ,MAIZ,OAAO,wBAAQlV,UAHX6wB,UAGsC3b,MAAOA,EAA1C,SAAkDlU,GAASkU,GAA/B5P,UA7BnD,yBAEkC,OAAO7H,KAAK4/C,QAF9C,GAAkCH,GAAlC,sCAGKvrC,KAHL,iECEM8gC,GAAiC,CAACzK,OAAQ,QAEnC4Y,GAAb,4MACc3N,OAA6C,GAD3D,8DAI8B/9B,GACtB,IAAK,IAAItV,KAAKnC,KAAKw1C,OAAQ,CACvB,IAAIzb,EAAQ/5B,KAAKw1C,OAAOrzC,GACxB43B,EAAMlC,QAAUpgB,IAAUsiB,EAAMtiB,SAP5C,kCAUgBA,GAER,IAAK,IAAItV,KADTnC,KAAKq0C,SAAW58B,EACFzX,KAAKw1C,OAAQx1C,KAAKw1C,OAAOrzC,GAAGkyC,SAAW58B,IAZ7D,kCAcgBA,GAER,IAAK,IAAItV,KADTnC,KAAKwb,SAAW/D,EACFzX,KAAKw1C,OAAQx1C,KAAKw1C,OAAOrzC,GAAGqZ,SAAW/D,IAhB7D,+BAyBc,IAGF2rC,EAHC,SACsBpjD,KAAKqoB,GAA3B1M,EADA,EACAA,aAAcsK,EADd,EACcA,MAGL,IAFAjmB,KAAK0/C,QAAd2D,QAGDD,EAAUpjD,KAAK0/C,QAAuB0D,QAE1C,IAAIhwB,EAAK9a,IAAWtY,KAAKuC,UAAW,QACpC,OAAO,sBAAMA,UAAW6wB,EAAI/wB,MAAO2yC,GAA5B,SACE/uB,EAAKre,KAAI,SAACP,EAAEQ,GAAW,IACf4P,EAAgBpQ,EAAhBoQ,MAAOlU,EAAS8D,EAAT9D,MACRoE,EAAO,EAAKA,KAEhB,YADelH,IAAX2iD,IAAsBz7C,GAAQ,IAAMy7C,GACjC,wBAAmB7gD,UAAU,oBAA7B,UACH,uBAAO0vB,IAAK,SAAA8H,GAAK,OAAE,EAAKyb,OAAO3tC,GAAOkyB,GAAOv3B,KAAK,QAAQmF,KAAMA,EAC5D8P,MAAOA,EAAO40B,gBAAiB,EAAK1wB,cAAgBA,KAAgBlE,EACpE+C,SAAU,EAAKk7B,gBAClBnyC,GAASkU,IAJK5P,UAtCvC,yBAEiC,OAAO7H,KAAK4/C,QAF7C,GAAiCH,GCLpB6D,GAAb,4MACc7B,UAAY,QAD1B,EAEc1nB,WAFd,4DAKgBtiB,GAAgBzX,KAAK+5B,MAAMsa,SAAWr0C,KAAKq0C,SAAW58B,IALtE,kCAMgBA,GAAgBzX,KAAK+5B,MAAMve,SAAWxb,KAAKwb,SAAW/D,IANtE,+BAQc,IAAD,SACkBzX,KAAKqoB,GAAvB4Q,EADA,EACAA,IAAK7D,EADL,EACKA,IAAKjiB,EADV,EACUA,KACf,OAAO,mCAAE,uBAAO8e,IAAK,SAAA8H,GAAK,OAAE,EAAKA,MAAQA,GACrCx3B,UAAW+V,IAAWtY,KAAKuC,UAAW,eAAgB,YACtDC,KAAMxC,KAAKyhD,UACX9lC,aAAc3b,KAAK2b,aACnBnB,SAAUxa,KAAK01C,cACftgB,IAAKA,EACL6D,IAAKA,EACL9lB,KAAMA,QAjBlB,yBAGiC,OAAOnT,KAAK4/C,QAH7C,GAAiCH,GCC3BpJ,GAAO,uBAAO9zC,UAAU,aAAjB,sBAEAghD,IAAb,uPAMc9gD,QANd,sBAMwB,8BAAAnB,EAAA,8DAEDb,KADX+iD,EAAS,EAAKn7B,IAAM,EAAKA,GAAGm7B,QADhB,uBAGZtzC,MAAM,sBAHM,0CAMDszC,EAAO,EAAK9D,QAAS,EAAK/3C,KAAM,EAAK8P,OANpC,OAMZhK,EANY,OAOhB,EAAKuzC,aAAavzC,GAClB,EAAKjM,aACL,EAAKiiD,oBACL,EAAK5B,aAVW,4CANxB,0DAGgBpqC,GAAgBzX,KAAKq0C,SAAW58B,IAHhD,kCAIgBA,GAAgBzX,KAAKwb,SAAW/D,IAJhD,+BAoBQ,IAAI0D,EAAgC4K,OACpBtlB,IAAZT,KAAKqoB,KACLlN,EAAcnb,KAAKqoB,GAAGlN,YACtB4K,EAAU/lB,KAAKqoB,GAAGtC,SAEtB,IAMIjb,EANAsoB,EAAS,CACT,gBAAgB,EAChB,iBAA8C,IAA7BpzB,KAAKulB,WAAWyS,SACjC,kBAAkB,EAClB,aAAch4B,KAAK22B,UAGvB,QAAmBl2B,IAAfT,KAAKyX,OAAsC,OAAfzX,KAAKyX,MACjC3M,EAAUqQ,GAAek7B,GACzBjjB,EAAG,eAAgB,OAElB,QAAgB3yB,IAAZslB,EAAuB,CAC5B,IAAIlB,EACJ,GAAmB,OAAf7kB,KAAKyX,MACLoN,EAAI,YAGJ,cAAe7kB,KAAKyX,OAChB,IAAK,YAAaoN,EAAIwxB,GAAM,MAC5B,IAAK,SAAUxxB,EAAK7kB,KAAKyX,MAAchK,GAAI,MAC3C,QAASoX,EAAI7kB,KAAKyX,MAG1B3M,EAAU,mCAAG+Z,SAGb/Z,EADwB,oBAAZib,EACFA,EAAQ/lB,KAAKyX,OAGbsO,EAEd,OAAO,qCACH,qBAAKxjB,UAAW+V,IAAW8a,GAAK3wB,QAASzC,KAAKyC,QAA9C,SAAwDqI,IACvD9K,KAAKiiD,oBA1DlB,yBACkC,OAAOjiD,KAAK4/C,QAD9C,GAA8BH,GAA9B,mCAEKvrC,KAFL,iECJawvC,GAAU,SAACC,EAAmBC,EAAeC,GACtD,OAAO,uBAAMthD,UAAU,cAAhB,yBAA2CohD,EAA3C,kBAAoEE,GAAa,IAAIz/B,KAAK,MAA1F,kBAAgHw/B,EAAhH,SCCEE,GAAb,4MAGcrhD,QAHd,sBAGwB,8BAAAnB,EAAA,yDAChB,EAAKE,aACL,EAAKiiD,oBAFW,EAGG,EAAKl+B,WAAnB5d,EAHW,EAGXA,KACQ,WAJG,EAGLnF,KAHK,gCAKN,EAAKk9C,QAAQqE,OAAOp8C,GALd,2CAHxB,EAsBYq8C,eAAiBzoC,aAAS,WAAO,IAEjCwK,EAAqBqN,EAAWjb,EAFA,EACjB,EAAKoN,WAAnB5d,EAD+B,EAC/BA,KAAMnF,EADyB,EACzBA,KAEX,QAAgB/B,IAAZ,EAAK4nB,GAAkB,CAAC,IACZ47B,EAAc,EAAK57B,GAA1BrC,OACL,GAAmB,WAAfi+B,EAAyB,OAAOP,GAAQlhD,EAAMyhD,EAAY,CAAC,WAC/Dl+B,EAAU,EAAKsC,GAAGtC,QAClBqN,EAAK,EAAK/K,GAAG9lB,UACb4V,EAAU,EAAKkQ,GAAGnS,MARc,IAahCpL,EAbgC,EAUb,EAAK40C,QAAvB1kB,EAV+B,EAU/BA,KAAMrE,EAVyB,EAUzBA,SACP+oB,EAAU,EAAKA,QACflkC,EAAkB,WAAPhZ,GAAmBm0B,EAED7rB,OAAXrK,IAAlB,EAAK+b,SAAkC,EAAKA,SACpB,oBAAZuJ,EAAkCA,SAC7BtlB,IAAZslB,EAAiCA,EAC3B5N,EACf,IAAIq+B,EAAS,wBACTj0C,UAAW6wB,EACX5wB,KAAK,SACLgZ,SAAUA,EACV/Y,QAAS,EAAKA,QAJL,SAKRqI,GAAWnD,IAEhB,OAAuB,IAAnB+3C,EAAQO,OAAwB,qCAAGzJ,EAAQ,EAAKyL,kBAC7C,sBAAK1/C,UAAWy4B,EAAKkpB,YAArB,UACH,8BAAM,EAAKjC,iBACVzL,QAlDb,uDAyDQ,OAAO9zC,gBAAoB1C,KAAKgkD,kBAzDxC,yBACkC,OAAOhkD,KAAK4/C,MAD9C,4BAsDkC,OAAO,SAtDzC,GAAkCH,GCIZ0E,IAAtB,aAYI,WAAYnpB,EAAY2Z,EAAoB13B,EAAWgjC,EAAiBoD,GAAiB,IAAD,OAMpF,GANoF,yBAXhFe,iBAWgF,OAV/EppB,UAU+E,OAT/E2Z,cAS+E,OAR/E+L,cAQ+E,OAP/ET,YAO+E,OAN/EoE,QAAmC,GAM4C,KAL/En+B,WAK+E,OAJ/Em9B,WAI+E,iFA2LxFpB,aAAe1mC,aAAS,WAAoB,IACnC0gC,EAAU,EAAVA,OACL,OAAsB,IAAlBA,EAAOj3C,OAAqB,KACzB,mCACFi3C,EAAOr0C,KAAI,SAAA1F,GAAG,OAAI,uBAAgBK,UAAU,qCAA1B,UACf,mBAAGA,UAAU,6BADE,QACmCL,IADxBA,WA9LlClC,KAAKg7B,KAAOA,EACZh7B,KAAK20C,SAAWA,EAChB30C,KAAK0gD,SAAWzjC,EAChBjd,KAAKigD,OAASA,EACdjgD,KAAKqjD,MAAQA,OACI5iD,IAAbk0C,EAAwB,CAAC,IAEA,EADpBzuB,EAASyuB,EAATzuB,MACL,QAAczlB,IAAVylB,EACAlmB,KAAKkmB,MAAQ,IACgB,IAAzBE,MAAMC,QAAQH,GACdlmB,KAAKkmB,MAAM9jB,KAAK8jB,IAEhB,EAAAlmB,KAAKkmB,OAAM9jB,KAAX,oBAAmB8jB,KAzBvC,8DA8BsBvD,QACWliB,IAArBT,KAAKokD,cAA2BpkD,KAAKokD,YAAc,IACvD,IAAIE,EAAiBtkD,KAAKokD,YAAYzhC,GAEtC,YADuBliB,IAAnB6jD,IAA8BtkD,KAAKokD,YAAYzhC,GAAW2hC,EAAiB,IACxEA,IAlCf,+BAyCaC,GAAsB,OAAOvkD,KAAK0gD,SAAS6D,KAzCxD,+BA0CaA,EAAiB9sC,GACtBzX,KAAK0gD,SAAS6D,GAAY9sC,EAC1B,IAAIuO,EAAShmB,KAAKqkD,QAAQE,QACX9jD,IAAXulB,GAAsBA,EAAOm8B,SAAS1qC,KA7ClD,kCA+CgB8sC,GACR,IAAIv+B,EAAShmB,KAAKqkD,QAAQE,GAC1B,QAAe9jD,IAAXulB,EAAsB,OAAOA,EAAOw+B,gBAjDhD,kCAoDgBD,EAAiB9sC,GACzB,IAAIuO,EAAShmB,KAAKqkD,QAAQE,QACX9jD,IAAXulB,GAAsBA,EAAOy+B,YAAYhtC,KAtDrD,kCAwDgB8sC,GACR,IAAIv+B,EAAShmB,KAAKqkD,QAAQE,QACX9jD,IAAXulB,GAAsBA,EAAO0+B,gBA1DzC,kCA6DgBH,EAAiB9sC,GACzB,IAAIuO,EAAShmB,KAAKqkD,QAAQE,QACX9jD,IAAXulB,GAAsBA,EAAO2+B,YAAYltC,KA/DrD,iCAiEe8sC,GACP,IAAIv+B,EAAShmB,KAAKqkD,QAAQE,QACX9jD,IAAXulB,GAAsBA,EAAO4+B,eAnEzC,iCAsEeL,EAAiB9sC,GACxB,IAAIuO,EAAShmB,KAAKqkD,QAAQE,QACX9jD,IAAXulB,GAAsBA,EAAO6+B,WAAWptC,KAxEpD,sEA2EiBqtC,GA3EjB,oFA4EQ9kD,KAAK6hD,cACiB,IAAlB7hD,KAAK22B,SA7EjB,gBA8EgBz0B,EAAM,GA9EtB,cA+E2BlC,KAAK+kD,cA/EhC,IA+EY,2BAASC,EAAyB,QAC9B9iD,GAAO8iD,EAAGr9C,KAAO,MAAQq9C,EAAG/I,OAAO73B,KAAK,MAhFxD,WAAArP,EAAA,wBAkFYjQ,QAAQ7C,MAAMC,GAlF1B,kCAsF8BzB,KADjBwkD,EAAiBjlD,KAAKg7B,KAAKz5B,MAA3B0jD,eArFb,wBAuFY/0C,MAAM,UAAD,OAAW40C,EAAX,mDAvFjB,4CA0FwBG,EAAcH,EAAY9kD,MA1FlD,gBA2FoBS,KADRP,EA1FZ,2DA4FQF,KAAKk8B,SAAS4oB,EAAY5kD,GA5FlC,gJAiGQ,IAAK,IAAIiC,KAAKnC,KAAKqkD,QACfrkD,KAAKqkD,QAAQliD,GAAG0/C,aAEpB,QAAyBphD,IAArBT,KAAKokD,YACT,IAAK,IAAIjiD,KAAKnC,KAAKokD,YAAa,CAC5B,IAAIE,EAAiBtkD,KAAKokD,YAAYjiD,GACtC,IAAK,IAAImuB,KAAKg0B,EACVA,EAAeh0B,GAAG40B,qBAxGlC,0CA+GQ,GADAllD,KAAKm3B,mBACc12B,IAAfT,KAAKkmB,MAAT,CAFgB,oBAGClmB,KAAKkmB,OAHN,IAGhB,2BAA6B,CAAC,IAGO,EAF7BhmB,GAAMqmB,EADe,SACVvmB,MACf,QAAYS,IAARP,EACJ,IAA2B,IAAvBkmB,MAAMC,QAAQnmB,IACd,EAAAF,KAAKi8C,QAAO75C,KAAZ,oBAAoBlC,SAEnB,GAAmB,kBAARA,EACZF,KAAKi8C,OAAO75C,KAAKlC,QAGjB,IAAK,IAAIiC,KAAKjC,EAAeF,KAAKk8B,SAAS/5B,EAAIjC,EAAYiC,KAbnD,8BAgBhB,QAAyB1B,IAArBT,KAAKokD,YACT,IAAK,IAAIjiD,KAAKnC,KAAKokD,YAAa,CAC5B,IAAIE,EAAiBtkD,KAAKokD,YAAYjiD,GACtC,IAAK,IAAImuB,KAAKg0B,EAAgB,CAC1B,IAAIa,EAAab,EAAeh0B,GAChC60B,EAAWhuB,cACXguB,EAAWrD,yBAnI3B,+BAwIayC,EAAiBtiD,GACtB,IAAI+jB,EAAShmB,KAAKqkD,QAAQE,QACX9jD,IAAXulB,IACJA,EAAOo/B,gBAAgBnjD,GACvBjC,KAAKygD,eAAez6B,MA5I5B,2CAgJQ,IAAK,IAAI7jB,KAAKnC,KAAKqkD,QAAS,CACxB,IAAIr+B,EAAShmB,KAAKqkD,QAAQliD,QACX1B,IAAXulB,GACJA,EAAOy9B,uBAnJnB,2CAwJQ,IAAK,IAAIthD,KAAKnC,KAAKqkD,QAAS,CACxB,IAAIr+B,EAAShmB,KAAKqkD,QAAQliD,QACX1B,IAAXulB,GACJA,EAAOxkB,gBA3JnB,mCAgKQxB,KAAKm3B,cACLn3B,KAAKqlD,qBACLrlD,KAAKklD,mBACiB,IAAlBllD,KAAK22B,UACT32B,KAAK8hD,sBApKb,qCAuKmB97B,GACDhmB,KAAK+kD,aAAa/0B,WAAU,SAAA3oB,GAAC,OAAIA,IAAM2e,KACvC,GAAGhmB,KAAK+kD,aAAa3iD,KAAK4jB,KAzK5C,wCA2KsBA,GACd,IAAI3X,EAAMrO,KAAK+kD,aAAa/0B,WAAU,SAAA3oB,GAAC,OAAIA,IAAM2e,KAC7C3X,GAAO,GAAGrO,KAAK+kD,aAAa7vB,OAAO7mB,EAAK,KA7KpD,sCAkLQ,IAAY,IADDrO,KAAK+kD,aAAa//C,OAAShF,KAAKi8C,OAAOj3C,OAAU,EAC1C,OAAO,EACzB,QAAyBvE,IAArBT,KAAKokD,YAA2B,OAAO,EAC3C,IAAK,IAAIjiD,KAAKnC,KAAKokD,YAAa,CAC5B,IAAIE,EAAiBtkD,KAAKokD,YAAYjiD,GACtC,IAAK,IAAImuB,KAAKg0B,EACV,IAAmC,IAA/BA,EAAeh0B,GAAGqG,SAAmB,OAAO,EAGxD,OAAO,IA1Lf,oCAkMQ32B,KAAKi8C,OAAO/mB,OAAO,GACnBl1B,KAAK+kD,aAAa7vB,OAAO,GACzBl1B,KAAKslD,uBApMb,gEA8LQ,OAAOtlD,KAAKulD,oBA9LpB,yCASKrxC,KATL,wEASmC,MATnC,0CAUKA,KAVL,wEAUwC,MAVxC,oCA6LK0iB,KA7LL,wEAkNI4uB,GAAoB,EACXC,GAAb,kDAOI,WAAYC,EAAuBC,EAAsB1oC,EAAWgjC,GAAkB,IAAD,EAC7E2F,EAD6E,wBAE5EjR,EAAY+Q,EAAZ/Q,SACL,QAAiBl0C,IAAbk0C,EAAwB,CAAC,IACpB//B,EAAS+/B,EAAT//B,WACSnU,IAAVmU,IAAqBgxC,EAAQhxC,EAAM+wC,EAAUh+C,OAL4B,OAOjF,cAAM+9C,EAAc1qB,KAAM4qB,EAAO3oC,EAAMgjC,GAAQ,IAb1CyF,mBAM4E,IAL5EC,eAK4E,IAJ5EvC,YAI4E,IAH/EnmC,UAG+E,EAQjF,EAAKyoC,cAAgBA,EACrB,EAAKC,UAAYA,EACjB,EAAKvC,OAASoC,KACd,EAAKvoC,KAAOA,EAXqE,EAPzF,0DAoBkBsnC,GAA6B,OAAOvkD,KAAK2lD,UAAUE,YAAYtB,KApBjF,gCAqBcA,GACN,QAAsB9jD,IAAlBT,KAAK20C,SAAT,CAD8B,IAEzB//B,EAAS5U,KAAK20C,SAAd//B,MACL,QAAcnU,IAAVmU,EACJ,OAAOA,EAAM2vC,MAzBrB,oCA6BQ,oEACAvkD,KAAK0lD,cAAcvuB,gBA9B3B,8BA2B0B,OAAOn3B,KAAK2lD,UAAUh+C,OA3BhD,iCAiC0B,OAAO3H,KAAK0lD,cAAczoC,SAjCpD,GAAgCknC,IAoCnB2B,GAAb,kDACI,WAAY9qB,EAAWilB,GAAiB,uCAC9BjlB,EAAMA,EAAK2Z,SAAU3Z,EAAK/d,KAAMgjC,GAAQ,GAFtD,0DAKkBsE,GAA6B,OAAOvkD,KAAKg7B,KAAK6qB,YAAYtB,KAL5E,gCAMcA,GAAyB,IAC1B5P,EAAY30C,KAAKg7B,KAAjB2Z,SACL,QAAiBl0C,IAAbk0C,EAAJ,CAF8B,IAGzB//B,EAAS+/B,EAAT//B,MACL,QAAcnU,IAAVmU,EACJ,OAAOA,EAAM2vC,MAXrB,2BAIoB,OAAOvkD,KAAKg7B,KAAK/d,SAJrC,GAAiCknC,IAepB4B,GAAmBrjD,gBAA6B,ICtQhDsjD,GAAezqC,aAAS,YAEpC,IAQOwK,EACAkgC,EAAoBC,EAAmBC,EAV1CT,EACL,EADKA,cAAeC,EACpB,EADoBA,UAAWnpC,EAC/B,EAD+BA,SAEtB7U,EAAag+C,EAAbh+C,KAAM0M,EAAOsxC,EAAPtxC,IACP4I,EAAOyoC,EAAchF,SAAS/4C,GAC7BqzB,EAAQ0qB,EAAR1qB,KACDspB,EAAiBoB,EAAcU,kBAAkBz+C,GACpD0gB,EAAKq9B,EAAcrF,UAAU14C,GAC5B0+C,EAAyBh+B,EAAzBg+B,UAAWC,EAAcj+B,EAAdi+B,WACTC,EAAW5+C,EAGV6+C,EAAsDxrB,EAAtDwrB,aAAczqB,EAAwCf,EAAxCe,aAAc0qB,EAA0BzrB,EAA1ByrB,aAAc9R,EAAY3Z,EAAZ2Z,SAC/C,QAAiBl0C,IAAbk0C,EAAwB,CAAC,IACT+R,EAAsE/R,EAAjFsR,WAAqCU,EAA4ChS,EAAtDuR,UAAoCU,EAAkBjS,EAA7BwR,YACtC,IAAfF,IAAqBA,EAAaS,IACpB,IAAdR,IAAoBA,EAAYS,IACjB,IAAfR,IAAqBA,EAAaS,GAE1C,QAAWnmD,IAAP4nB,EAAkB,CAAC,IACP47B,EAGR57B,EAHCrC,OAAmB9P,EAGpBmS,EAHoBnS,MACT2wC,EAEXx+B,EAFA49B,WAAoCa,EAEpCz+B,EAF0B69B,UAAmCa,EAE7D1+B,EAFkD89B,WACrCa,EACb3+B,EADAm+B,aAA8BS,EAC9B5+B,EADiB0T,aAA8BmrB,EAC/C7+B,EADkCo+B,aAStC,QAPsBhmD,IAAlBomD,IAA6BZ,EAAaY,QACzBpmD,IAAjBqmD,IAA4BZ,EAAYY,QACtBrmD,IAAlBsmD,IAA6BZ,EAAaY,QACnCtmD,IAAPumD,IAAkBR,EAAeQ,QAC1BvmD,IAAPwmD,IAAkBlrB,EAAekrB,QAC1BxmD,IAAPymD,IAAkBT,EAAeS,GACrCnhC,EAAUsC,EAAGtC,QACM,QAAfk+B,EAAsB,OAAOP,GAAQiC,EAAUnjD,KAAMyhD,EAAY,CAAC,QACtEsC,EAAWrwC,GAASqwC,EAExB,IAAIpI,GAAQ,EACZ,OAAOqI,EAAaD,EAAU,mCACzBtpC,EAAKrV,KAAI,SAACyc,EAASxc,GAChB,IAAIs9C,EACAgC,EACAhhB,OAAM1lC,EAGV,IAFc,IAAV09C,EAAiBhY,EAAMsgB,EACtBtI,GAAQ,OACI19C,IAAb+b,EACA2oC,EAAa,IAAIM,GAAWC,EAAeC,EAAWthC,GAAK,GAC3D8iC,EAAa,mCAAG3qC,QAEf,CACD,IAAI4qC,SAAuBrhC,EACL,aAAlBqhC,GACAjC,EAAa,IAAIM,GAAWC,EAAeC,EAAWthC,GAAK,GAC3D8iC,EAAazkD,gBAAoB6Y,YAASwK,GAAsC1B,IAEzD,WAAlB+iC,GACLjC,EAAa,IAAIM,GAAWC,EAAeC,EAAWthC,GAAK,GAC3D8iC,EAAaphC,IAGbo/B,EAAa,IAAIM,GAAWC,EAAeC,EAAWthC,GAAK,GAC3D8iC,EAAa,mCACT9yC,EAAIzM,KAAI,SAACP,EAAGQ,GACR,OAAO,cAAC,WAAD,UACFw/C,GAAQlC,EAAY99C,OAAG5G,IADA4G,EAAEM,YAxBpB,IAkCtB2/C,EAAyBC,EAHxBnE,EAAU+B,EAAV/B,OAIL,GAHAkB,EAAelB,GAAU+B,GAGN,IAAfc,EAAqB,CAQrBqB,EAAc,qBAAK/kD,UAAU,oBAAf,SACV,uBAAOC,KAAK,WAAWC,QARb,SAACgY,GAA2C,IACjDod,EAAYpd,EAAIE,OAAhBkd,QACLxT,EAAImjC,YAAc3vB,EAFmC,IAGhD4vB,EAAWpjC,EAAXojC,aACWhnD,IAAZgnD,IAAuBA,EAAQD,YAAc3vB,GACjDstB,EAAWhuB,eAG8BkV,eAAgBhoB,EAAImjC,gBAGrE,IAAIE,SAA+BjnD,IAAjB4jB,EAAIsjC,aAA2C,IAAjBtjC,EAAIsjC,YACpD,IAAkB,IAAdzB,EAAoB,CACpB,IAAIl1C,EAAO02C,EAAW,UAAY,WAelCH,EAAa,qBAAKhlD,UAAU,0BAA0BE,QAdrC,WACb,IAAmB,IAAf0jD,EAAqB,CACrB9hC,EAAIsjC,YAAcD,EADG,IAEhBD,EAAWpjC,EAAXojC,aACPhnD,IAAZgnD,IAAuBA,EAAQE,YAAcD,GAC7CpB,GAAYA,EAAWjiC,OAER,CACD,IAAIpd,EAAIgW,EAAK5J,QAAQgR,GACnCpd,GAAG,GAAGgW,EAAKiY,OAAOjuB,EAAG,GACrBo/C,GAAWA,EAAUhiC,GAEX8gC,EAAWhuB,eAEF,SACT,mBAAG50B,UAAW+V,IAAW,KAAMtH,EAAM,aAG7C,IAAI42C,GAA6B,IAAb3B,IAAiC,IAAZC,EACrC,SAACp7C,GAAD,OAAiB,0BAAU0Q,SAAUksC,EAApB,SAA+B,sBAAKnlD,UAAW+V,IAAW,SAAU,CAAC,QAAUovC,EAAW,eAAerjC,EAAImjC,cAA9E,UAC3CF,EACD,qBAAK/kD,WAAwB,IAAb0jD,IAAiC,IAAZC,EAAkB,mBAAmB,qBAA1E,SAAiGp7C,IAChGy8C,QAGL,SAACz8C,GAAD,OAAiBA,GAErB,OAAO,eAACi7C,GAAiB8B,SAAlB,CAAwCpwC,MAAO0tC,EAA/C,UACFhf,EACApK,EAAa6rB,EAAc,qCAAE,cAACzC,EAAWlD,aAAZ,IAA4BkF,SAFvB/D,Y,kBClHtC0E,IAAb,8MACc/tB,WADd,+CAUct3B,QAVd,sBAUwB,8BAAAnB,EAAA,6DACZgkB,EAAO,IAAIsX,UAAcn8B,EAAW,EAAK8kB,WAAY,EAAK8C,GAAI,EAAKA,GAAGnS,MAAO,EAAKuB,OADtE,SAEA6N,EAAK9gB,QAFL,cAGJ,QADRtE,EAFY,UAIZ,EAAKiiD,SAASjiD,GACd,EAAK6nD,SAAW7nD,GALJ,SAOVolB,EAAK0iC,MAPK,2CAVxB,EAwBYhE,eAAiBzoC,aAAS,WAC9B,IAGI9Y,EAHA2wB,EAAK,CACL,8CAOJ,OAJK,EAAKihB,UAAa,EAAK74B,WACxB4X,EAAGhxB,KAAK,kBACRK,EAAU,EAAKA,SAEZ,qBAAKF,UAAW+V,IAAW8a,GAAK3wB,QAASA,EAAzC,SACH,cAAC,KAAD,CAAOoQ,IAAK,EAAKk1C,SAAUxlD,UAAU,mBAlCjD,qDAMQ,6DACAvC,KAAK+nD,SAAW/nD,KAAKyX,QAP7B,+BAqBQ,OAAO/U,gBAAoB1C,KAAKgkD,kBArBxC,yBAEqC,OAAOhkD,KAAK4/C,QAFjD,GAAiCH,GAAjC,sCAGKvrC,KAHL,iECHe+zC,G,4MACDzS,OAA6C,G,8DAG7B/9B,GACtB,IAAK,IAAItV,KAAKnC,KAAKw1C,OAAQ,CACvB,IAAIzb,EAAQ/5B,KAAKw1C,OAAOrzC,GACxB43B,EAAMlC,QAAUpgB,IAAUsiB,EAAMtiB,S,kCAG5BA,GAER,IAAK,IAAItV,KADTnC,KAAKq0C,SAAW58B,EACFzX,KAAKw1C,OAAQx1C,KAAKw1C,OAAOrzC,GAAGkyC,SAAW58B,I,kCAE7CA,GAER,IAAK,IAAItV,KADTnC,KAAKwb,SAAW/D,EACFzX,KAAKw1C,OAAQx1C,KAAKw1C,OAAOrzC,GAAGqZ,SAAW/D,I,yBAd9B,OAAOzX,KAAK4/C,Q,GAFVH,GCe3ByI,GAAkF,CACpFz6C,GAAI,CACAo2C,UAAW,CAAC,MACZ79B,OAAQu9B,IAEZjwC,KAAM,CACFuwC,UAAW,CAAC,UAAW,SAAU,UACjC79B,OAAQw7B,GAEZ2G,SAAU,CACNtE,UAAW,CAAC,UACZ79B,OAAQk8B,GAEZn2B,SAAU,CACN83B,UAAW,CAAC,UACZ79B,OAAQo8B,GAEZpvC,KAAM,CACF6wC,UAAW,CAAC,QACZ79B,OAAQ28B,IAEZyF,SAAU,CACNvE,UAAW,CAAC,QACZ79B,OAAQ48B,IAEZyF,KAAM,CACFxE,UAAW,CAAC,QACZ79B,OAAQ68B,IAEZpL,MAAO,CACHoM,UAAW,CAAC,QACZ79B,OAAQ88B,IAEZG,OAAQ,CACJY,UAAW,CAAC,UAAW,SAAU,SAAU,OAAQ,WACnD79B,OAAQg9B,IAEZthD,IAAK,CACDmiD,UAAW,CAAC,UACZ79B,OAAQq8B,GAEZiG,MAAO,CACHzE,UAAW,CAAC,UACZ79B,OAAQs8B,GAEZrM,OAAQ,CACJ4N,UAAW,CAAC,UAAW,UACvB79B,OAAQu8B,GAEZgG,OAAQ,CACJ1E,UAAW,CAAC,UAAW,UACvB79B,OAAQw8B,GAEZvvB,MAAO,GAGPu1B,SAAU,CACN3E,UAAW,CAAC,UAAW,UAAW,UAClC79B,OAAQ+8B,IAEZ0F,MAAO,CACH5E,UAAW,CAAC,UACZ79B,OAAQ8hC,IAEZY,WAAY,GAGZC,MAAO,CACH9E,UAAW,CAAC,UAAW,SAAU,SAAU,OAAQ,WACnD79B,OAAQm9B,IAEfyF,UAAW,CACV/E,UAAW,CAAC,WACZ79B,ODlEF,uKACW,IAICo9B,EAJF,EAC0BpjD,KAAKqoB,GAAlCwgC,EADG,EACHA,WAAYtT,EADT,EACSA,cACjB,QAAmB90C,IAAfooD,EAA0B,OAAO,mEAGjB,IAFA7oD,KAAK0/C,QAAd2D,QAGDD,EAAUpjD,KAAK0/C,QAAuB0D,QAE1C,IAAIhwB,EAAK9a,IAAWtY,KAAKuC,UAAW,QACtCoF,EAAO3H,KAAK2H,UACDlH,IAAX2iD,IAAsBz7C,GAAQ,IAAMy7C,GACxC,IAAIzhD,EAAmC,CACtCY,UAAW6wB,EACXqiB,UAAW9tC,EACX4tC,gBACAG,cAAe11C,KAAK01C,eAErB,OAAOmT,EAAWC,aAAa9oD,KAAK2b,aAAcha,OAlBpD,GAAqCsmD,KCoEpCc,SAAU,CACTlF,UAAW,CAAC,UACZ79B,ODhDF,4MACSgjC,gBADT,IAcctT,cAAgB,SAACj7B,GAC7B,IAAI+J,EAAkB,GACtB,IAAK,IAAIriB,KAAK,EAAKqzC,OAAQ,CAC1B,IAAIzb,EAAQ,EAAKyb,OAAOrzC,IACF,IAAlB43B,EAAMlC,SAAkBrT,EAAOpiB,KAAK23B,EAAMtiB,OAEzC,EAAKqoC,YAAYt7B,EAAOJ,KAAK,MAAM,IApB3C,qDAGE,6DACA,IAAI6kC,EAAMjpD,KAAK2b,aACf,cAAestC,GACd,QACCjpD,KAAKgpD,WAAa,GAClB,MACD,IAAK,SACJhpD,KAAKgpD,WAAaC,EAAIrrC,MAAM,KAAKhW,KAAI,SAAAP,GAAC,OAAIkG,OAAOlG,SAVrD,+BAsBW,IAAD,EAC0BrH,KAAKqoB,GAAlCwgC,EADG,EACHA,WAAYtT,EADT,EACSA,cACjB,QAAmB90C,IAAfooD,EAA0B,OAAO,kEAC/B,IACFlnD,EAAmC,CACtCY,UAFc+V,IAAWtY,KAAKuC,UAAW,QAGzCizC,OAAQx1C,KAAKw1C,OACbD,gBACAG,cAAe11C,KAAK01C,eAErB,OAAOmT,EAAWK,aAAalpD,KAAK2b,aAAcha,OAhCpD,GAAoCsmD,KCkDhCkB,MAAO,CACHtF,UAAW,CAAC,WACZ79B,OAAQs9B,IAEZ9M,OAAQ,CACJqN,UAAW,CAAC,SAAU,UACtB79B,OAAQ89B,KAIT,SAASuD,GAAQ3H,EAAkBn6B,EAAwB/I,EAA0BmjC,GACxF,QAAgBl/C,IAAZi/C,EAEA,OAAO,KAEX,QAAmBj/C,IAAf8kB,EAAJ,CAL6H,IAezH6jC,EATCzhD,EAAc4d,EAAd5d,KAAMnF,EAAQ+iB,EAAR/iB,KACX,OAAQA,GACR,IAAK,MACD,IAAImjD,EAAYjG,EAAQ2J,cAAc1hD,GACtC,OAAO,cAACq+C,GAAD,CAAcN,cAAehG,EAASiG,UAAWA,EAAWnpC,SAAUA,IAMjF,IAAI6L,EAAKq3B,EAAQW,UAAU14C,GAc3B,QAAWlH,IAAP4nB,EACA+gC,EAAaE,EAAc9mD,OAE1B,CAAC,IACUyhD,EAAc57B,EAArBrC,OACL,OAAQi+B,GACR,QACI,QAAmBxjD,IAAfwjD,EAEAmF,EADoBlB,GAAejE,GACRj+B,YAEZvlB,IAAf2oD,IAA0BA,EAAaE,EAAc9mD,IACzD,MACJ,IAAK,SACD4mD,EAAc/gC,EAAgBkhC,YAC9B,MACJ,IAAK,QACD,OAAO,qDA/C8G,IAoD3HlF,EAAW3E,EAAX2E,QACDr+B,EAASq+B,EAAQ18C,GAOlB,OANEqe,KACJA,EAAS,IAAIojC,EAAW1J,EAASn6B,EAAYo6B,EAAYnjC,IAClD5W,OACPy+C,EAAQ18C,GAAQqe,GAGP,cAACA,EAAO+5B,UAAR,IA3CP,SAASuJ,EAAcrzC,GACnB,OAAOA,GACP,QAAS,OAAOurC,EAChB,IAAK,KAAM,OAAO+B,GAClB,IAAK,UAAW,OAAOf,EACvB,IAAK,SAAU,OAAOD,EACtB,IAAK,SAAU,OAAOf,EACtB,IAAK,OAAQ,OAAOmB,GACpB,IAAK,UAAW,OAAOI,GACvB,IAAK,SACL,IAAK,SAAU,OAAOe,K,4BCzGjB0F,GAAb,kDAcI,WAAYjoD,GAAkB,IAAD,uBACzB,cAAMA,IAdD+f,YAaoB,IAZpBukC,iBAYoB,IAXpBlR,cAWoB,IAVpBhoC,SAUoB,IATnB88C,iBASmB,IARrBnjD,cAQqB,IAPpB2W,UAOoB,IALpBysC,eAKoB,IAJpBvJ,oBAIoB,IAHpBmB,gBAGoB,IAFpB4C,iBAEoB,IA2GrByF,MAAQ,gBAEKlpD,IADA,EAAKc,MAAjB2mC,UAGL,EAAK0hB,sBA/GoB,EA0KnBC,iBAAmB,SAAC/+C,GAC1B,OAAO,sBAAMvI,UAAW+V,IAAW,EAAK/W,MAAMgB,WAAYyxC,SAAU,SAAAj/B,GAAC,OAAEA,EAAEwkB,kBAAlE,SACFzuB,KA5KoB,EA+KnBg/C,sBAAwB,SAAC5zC,EAA0BpL,GAAsC,IAC1Fi/C,EAAkB,EAAKxoD,MAAvBwoD,eAEL,GAAIA,EAAiB,EAAG,CACpB,IAAIC,EACU,OAAV9zC,EACA6zC,EAAiB,EAGjBC,EAAY,uBAAOznD,UAAW+V,IAAW,UAAYyxC,EAAgB,kBAAzD,SAA6E7zC,IAE7F,IAAI+zC,EAAW,WAAa,GAAKF,GACjC,OAAO,sBAAKxnD,UAAU,iBAAf,UACFynD,EACD,qBAAKznD,UAAW0nD,EAAhB,SAA2Bn/C,OAGnC,OAAO,sBAAKvI,UAAU,aAAf,UACM,OAAR2T,EAAc,KAAK,uBAAO3T,UAAU,iBAAjB,SAAmC2T,IACtDpL,MAlMoB,EAqMnBo/C,uBAA2BzpD,EArMR,EAsMnB0pD,mBAAqB,mBAtMF,EAuMnBC,WAAqBp+B,aAAiBgqB,MAvMnB,EAyM7BwQ,aAAe,SAACtwC,EAAWpL,GACvB,OAAO,gCACH,qBAAKvI,UAAW+V,IAAW,6DAA3B,SAA0FpC,IACzFpL,MA5MoB,EA+M7BixB,aAAe,SAACjxB,GACZ,IAAIsoB,EAAK9a,IAAW,CAChB,QAAQ,IAEZ,OAAO,qBAAK/V,UAAW6wB,EAAhB,SAAqBtoB,KAnNH,EAqN7B27C,aAAe,qBAAKlkD,UAAU,kCArND,IAEpB+e,EAGD/f,EAHC+f,OAAQqzB,EAGTpzC,EAHSozC,SACT+U,EAEAnoD,EAFAmoD,UAAWvJ,EAEX5+C,EAFW4+C,eAAgBmB,EAE3B//C,EAF2B+/C,WAC3B4C,EACA3iD,EADA2iD,YAAav3C,EACbpL,EADaoL,IAEjB,EAAK+8C,UAAYA,GAAa,EAAKG,iBACnC,EAAK1J,eAAiBA,GAAkB,EAAK2J,sBAC7C,EAAKxI,gBAA0B7gD,IAAb6gD,GAAuC,KAAbA,GAA8B,OAAbA,EAAmBA,EAAa,EAAK4I,kBAClG,EAAKv9C,IAAMA,GAAO,EAAKy9C,WACvB,EAAKlG,YAAcA,GAAe,EAAKiG,mBAEvC,EAAK7oC,OAASA,EACd,EAAKukC,YAAc,GAbM,oBAcF,EAAKvkC,QAdH,IAczB,2BAAoC,CAAC,IAA5BiE,EAA2B,QAChC,EAAKsgC,YAAYtgC,EAAW5d,MAAQ4d,GAff,qCAiBzB,EAAKovB,SAAWA,EAEhB,EAAKruC,SAAW+jD,YAAQ,EAAKV,OAC7B,EAAK1sC,KAAO,GApBa,EAdjC,4DAqCiC,IAAD,OACxBjd,KAAK0gD,SAAS1gD,KAAKuB,MAAM2mC,UADD,IAQpBniB,EANCvJ,EAAYxc,KAAKuB,MAAjBib,SACL,YAAiB/b,IAAb+b,GACAxc,KAAKypD,YAAc,IAAI3D,GAAY9lD,MAAM,GAClC,mCAAGwc,WAIQ/b,IAAlBT,KAAK20C,WACL5uB,EAAU/lB,KAAK20C,SAAS5uB,cAEZtlB,IAAZslB,GACA/lB,KAAKypD,YAAc,IAAI3D,GAAY9lD,MAAM,GACd,oBAAb+lB,EAAyBA,EAAQ/lB,KAAKid,MAAQ8I,IAGjE/lB,KAAKypD,cACTzpD,KAAKypD,YAAc,IAAI3D,GAAY9lD,MAAM,IAE7B,mCAAGA,KAAKshB,OAAO1Z,KAAI,SAACP,EAAGQ,GAC1B,OAAO,cAAC,WAAD,UAA6Bw/C,GAAQ,EAAKoC,YAAapiD,EAAGmV,IAArC3U,YA1DxC,+BA8DqBqgC,GAEb,QADiBznC,IAAbynC,IAAwBA,EAAW,SACjBznC,IAAlBT,KAAK20C,SAAwB,CAAC,IACzB//B,EAAS5U,KAAK20C,SAAd//B,MACL,QAAcnU,IAAVmU,EACA,IAAK,IAAIzS,KAAKyS,EAAO,CACjB,IACI01C,EADK11C,EAAMzS,GACHwZ,kBACDlb,IAAP6pD,QACoB7pD,IAAhBynC,EAAS/lC,KACT+lC,EAAS/lC,GAAKmoD,IAVN,oBAgBLtqD,KAAKshB,QAhBA,IAgB5B,2BAAoC,CAAC,IAA5BiE,EAA2B,QAChCvlB,KAAKuqD,aAAahlC,EAAYvlB,KAAKid,KAAMirB,IAjBjB,iCA9DpC,mCAmFyB3iB,EAAwBtI,EAAUirB,GAAoB,IAClEvgC,EAAc4d,EAAd5d,KAAMnF,EAAQ+iB,EAAR/iB,KACX,GAAa,WAATA,EACJ,GAAa,QAATA,EAAJ,CAKA,IAAIgoD,EAAoBjlC,EACfklC,EAAYD,EAAhBn2C,IACL,QAAiB5T,IAAbgqD,EAAJ,CACA,IAXsE,EAWlEC,EAAcF,EAAQ3E,YAAc,GAX8B,cAYrD4E,GAZqD,IAYtE,2BAA2B,CAAC,IAAnB3jD,EAAkB,QACvB4jD,EAAQ5jD,EAAKa,MAAQb,GAb6C,8BAetE,IAAIgW,EAAYorB,EAASvgC,QACblH,IAARqc,EAAmBA,EAAM,IACG,IAAvBsJ,MAAMC,QAAQvJ,KAAgBA,EAAM,CAACA,IAC9C,IAlBsE,EAkBlEzI,EAAY,GAlBsD,cAmBtDyI,GAnBsD,IAmBtE,2BAAqB,CAAC,IAAD,EAAZuH,EAAY,QAEb9Q,EAAI,CACJk0C,QAASpjC,EACTmjC,YAH4BnjC,EAA3BmjC,YAIDG,WAJ4BtjC,EAAdsjC,YADD,cAOA8C,GAPA,IAOjB,2BAA2B,CAAC,IAAnB3jD,EAAkB,QACvB9G,KAAKuqD,aAAazjD,EAAMyM,EAAG8Q,IARd,8BAUjBhQ,EAAIjS,KAAKmR,IA7ByD,8BAiCtE0J,EAAKtV,GAAQuM,YAAWG,SA7BpB4I,EAAKtV,GAAQugC,EAASvgC,KAvFlC,2CA+HkC,IAAD,gBACF3H,KAAKshB,QADH,IACzB,2BAAoC,CAAC,IAA5BiE,EAA2B,QAChCvlB,KAAK2qD,gBAAgBplC,IAFA,iCA/HjC,sCAqI4BA,GAAyB,IACxC5d,EAAc4d,EAAd5d,KACL,GAAa,QADM4d,EAAR/iB,WAEO/B,IAAdT,KAAKid,KAAT,CACA,IAAI2tC,EAAa5qD,KAAKid,KAAKtV,GAC3B,QAAmBlH,IAAfmqD,EAAJ,CAL4C,MAMlCH,EAAYllC,EAAjBlR,IANuC,cAO5Bu2C,GAP4B,IAO5C,2BAA4B,CAAC,IAApBvmC,EAAmB,QACnBojC,EAAWpjC,EAAXojC,QACL,QAAgBhnD,IAAZgnD,EAAJ,CAFwB,IAGnBD,EAA2BC,EAA3BD,YAAaG,EAAcF,EAAdE,WAClBtjC,EAAImjC,YAAcA,EAClBnjC,EAAIsjC,WAAaA,EALO,oBAOP8C,GAPO,IAOxB,2BAA2B,CAAC,IAAnB3jD,EAAkB,QACvB9G,KAAK2qD,gBAAgB7jD,IARD,iCAPgB,mCArIpD,0CAyJyB,IACZ+jD,EAAc7qD,KAAKuB,MAAnBspD,gBACcpqD,IAAfoqD,GAA0BA,EAAW7qD,KAAKypD,eA3JtD,kDA+J8BhpD,IAAlBT,KAAKsG,UAAwBtG,KAAKsG,aA/J9C,+BAmKQ,IAAIwE,EAAU9K,KAAK8qD,gBACnB,OAAO,eAAC/E,GAAiB8B,SAAlB,CAA2BpwC,MAAOzX,KAAKypD,YAAvC,UACF/mD,gBAAoB1C,KAAKypD,YAAYxH,cACrCjiD,KAAK0pD,UAAU5+C,QAtK5B,2EA0KsBg6C,GA1KtB,4EA2KQ9kD,KAAKypD,YAAY5H,cACiB,IAA9B7hD,KAAKypD,YAAY9yB,SA5K7B,yDA+K8Bl2B,KADjBwkD,EAAiBjlD,KAAKypD,YAAYzuB,KAAKz5B,MAAvC0jD,eA9Kb,uBAgLY/0C,MAAM,wCAhLlB,0CAmLwB+0C,EAAcH,EAAY9kD,KAAKypD,aAnLvD,eAoLoBhpD,KADRP,EAnLZ,2DAqLQF,KAAKypD,YAAYvtB,SAAS4oB,EAAY5kD,GArL9C,6GAA0BwC,cCxB1B,uKAEc,IAAD,EACmB1C,KAAKuB,MAAxBoG,EADA,EACAA,KAAM6U,EADN,EACMA,SACPkjC,EAAkB1/C,KAAK0/C,QAC3B,QAAgBj/C,IAAZi/C,EAAuB,OAAO,sBAAMn9C,UAAU,cAAhB,4BAClC,IAAIgjB,EAAam6B,EAAQ2J,cAAc1hD,GACnCmD,EAAUu8C,GAAQ3H,EAASn6B,EAAY/I,EAAUxc,KAAKuB,OAC1D,YAAgBd,IAAZqK,EACO,uBAAMvI,UAAU,cAAhB,eAAiCoF,EAAjC,uBAEJmD,MAXf,GAA+BpI,cACpBqoD,YAAchF,I,yJCJZiF,G,KAAb,4MACSC,cADT,qDAGM5zC,GACJrX,KAAKirD,SAAW5zC,IAJlB,+BAMW,OAAyB,IAAlBrX,KAAKqK,UAA2B,6BANlD,+BAQE,OAAO,qBAAK9H,UAAU,0CAAf,SACN,wBAAQA,UAAU,0BAA0BE,QAASS,MAAI4I,SAAzD,0CATH,gCAcE,OAAO,sBAAKvJ,UAAU,4DAAf,UACN,uNACA,qBAAKA,UAAU,mBAAf,SACC,wBAAQA,UAAU,iBAAiBE,QAASzC,KAAKirD,SAAjD,6CAjBJ,2BAYkD,MAAO,YAZzD,GAA6B3xC,M,QCLd,MAA0B,iCCKlC,SAAS4xC,IACZ,OAAOhoD,MAAIuO,SAAS,sBAAKlP,UAAU,8CAAf,UAChB,qBAAKA,UAAU,kCAAkCsQ,IAAKs4C,EAAMz8B,IAAI,QAChE,sBAAKnsB,UAAU,2BAAf,UAA0C,sBAAMA,UAAU,oBAAhB,oBACtC,sBAAMA,UAAU,cAAhB,2BAWZ,IAAM6oD,EAAmB,CACrB,CAAC5oD,KAAK,SAAU2V,QAAQ,qBAAOkzC,MAAOx1C,KACtC,CAACrT,KAAK,QAAS2V,QAAQ,eAAMkzC,MAAOv1C,MAGjC,SAASw1C,EAAUjgC,GAEtB,OADa+/B,EAAQhkD,MAAK,SAAAC,GAAC,OAAyB,IAArBA,EAAEgkD,MAAMvnD,KAAKunB,MCnBhD,IAAM/J,EAAiB,CACnB,CAAC3Z,KAAM,WAAYnF,KAAM,SAAUw1B,UAAU,EAAM9c,UAAW,KAC9D,CAACvT,KAAM,WAAYnF,KAAM,SAAUw1B,UAAU,EAAM9c,UAAW,KAC9D,CAACvT,KAAM,QAASnF,KAAM,WAGb+oD,EAAb,4MACYC,aADZ,IAEY95C,cAFZ,IASYijC,SAAqB,CACzB//B,MAAO,CACH62C,SAAU,CAACtwC,YAAa,+CAAajF,MAAO,4BAC5C6V,SAAU,CAAC/F,OAAQ,WAAY7K,YAAa,eAAMjF,MAAO,gBACzDhL,MAAO,CAAC8a,OAAQ,SAAUzjB,UAAW,iCAAkC2T,MAAO,kBAb1F,EAiBY89B,SAjBZ,uCAiBuB,WAAOrsC,EAAa+3C,GAApB,uBAAAp+C,EAAA,yDACXkjB,EAASk7B,EAAQ1kB,KAAK/d,KACtBoO,EAAK7G,EAAM,cAEH/jB,KADRirD,EAAMlnC,EAAM,UAHD,yCAKJ,qCALI,uBAOL,EAAKgnC,QAAQngC,EAAIqgC,GAPZ,WAQT,IARS,iEAUjBC,EAASL,EAAUjgC,GACnB7oB,OAAyB/B,IAAXkrD,EAAsBA,EAAOxzC,QAAU,qBAXpC,kBAYd3V,EAAO,kCAZO,4CAjBvB,0DA+BYm/C,QA/BZ,uCA+BsB,WAAOh6C,EAAa+3C,GAApB,SAAAp+C,EAAA,yDACD,aAATqG,EADU,gCAEG,EAAKqsC,SAAS,QAAS0L,GAF1B,mFA/BtB,8GAIuG,IAAhG8L,EAA+F,EAA/FA,QAAS95C,EAAsF,EAAtFA,SACd1R,KAAKwrD,QAAUA,EACfxrD,KAAK0R,SAAWA,IANlB,+BAsCQ,OAAsB,IAAlB1R,KAAK0R,UACE,iBAvCnB,+BA6CQ,OAAO,sBAAKnP,UAAU,UAAf,UACH,qBAAKA,UAAU,cAAf,SACI,cAAC,KAAD,CAAI6Q,KAAK,YAAY7Q,UAAU,eAAeF,MAAO,CAACupD,OAAO,YAA7D,wCAIH1oD,MAAI2oD,oBAnDjB,gCAwDQ,OAAO,sBAAKtpD,UAAU,mEAAf,UACZ,qBAAKA,UAAU,cACf,sBAAKA,UAAU,QAAf,UACE2oD,IACD,qBAAK3oD,UAAU,SACf,cAAC,OAAD,CAAM+e,OAAQA,EAAQqzB,SAAU30C,KAAK20C,SACpCsQ,cAAejlD,KAAKg0C,SACpB2N,QAAS3hD,KAAK2hD,QACdzB,cAAc,IAEf,cAAC,KAAD,CAAI39C,UAAU,yBAAyB6Q,KAAK,UAA5C,yCAID,qBAAK7Q,UAAU,cACf,qBAAKA,UAAU,qBAvElB,GAA4B+W,K,QCPfwyC,EAAb,4MACYxqC,OAAuB,CAC3B,CAAC3Z,KAAK,cAAenF,KAAM,SAAU0Y,UAAW,GAAI8c,UAAU,GAC9D,CAACrwB,KAAK,cAAenF,KAAM,SAAU0Y,UAAW,GAAI8c,UAAU,GAC9D,CAACrwB,KAAK,eAAgBnF,KAAM,SAAU0Y,UAAW,GAAI8c,UAAU,GAC/D,CAACrwB,KAAK,SAAUnF,KAAM,WAL9B,EAOYmyC,SAAqB,CACzB//B,MAAO,CACHm3C,YAAa,CACT/lC,OAAQ,WACR9P,MAAO,qBACPiF,YAAa,8CAEjB6wC,YAAa,CACThmC,OAAQ,WACR9P,MAAO,qBACPiF,YAAa,8CAEjB8wC,aAAc,CACVjmC,OAAQ,WACR9P,MAAO,2BACPiF,YAAa,oDAEjB4oC,OAAQ,CACJ/9B,OAAQ,SACR9P,MAAO,eACP3T,UAAW,qBA3B3B,EAgCSiY,cAhCT,IAqCYw5B,SArCZ,uCAqCuB,WAAOrsC,EAAa+3C,GAApB,qBAAAp+C,EAAA,2DACgCo+C,EAAQziC,KAAlD8uC,EADU,EACVA,YAAaC,EADH,EACGA,YAAaC,EADhB,EACgBA,aAC3BD,IAAgBC,EAFL,uBAGXvM,EAAQxjB,SAAS,eAAgB,sEAHtB,0CAQL,EAAK1hB,SAASuxC,EAAaC,GARtB,WASH,IATG,+BAUXtM,EAAQxjB,SAAS,cAAe,kCAVrB,kCAafh5B,MAAI8O,QAAQ,cAAC,OAAD,CAAMnP,OAAO,2BAAOa,KAAK,QAAzB,SACR,qBAAKnB,UAAU,oBAAf,2DAdW,+DArCvB,2GAiCMiY,GACJxa,KAAKwa,SAAWA,IAlClB,+BA0DW,MAAO,6BA1DlB,gCA6DQ,OAAO,cAAC,OAAD,CACZjY,UAAU,MACV+e,OAAQthB,KAAKshB,OACbqzB,SAAU30C,KAAK20C,SACfsQ,cAAejlD,KAAKg0C,SACpB+V,eAAgB,QAlEnB,GAAqCzwC,KCAf4yC,EAAtB,4MACY5qC,OAAiB,CACrB,CAAC3Z,KAAM,OAAQnF,KAAM,SAAUw1B,UAAU,EAAM9c,UAAW,KAC1D,CAACvT,KAAM,SAAUnF,KAAM,WAH/B,EAKSmyC,cALT,IA2CYX,SA3CZ,uCA2CuB,WAAOrsC,EAAa+3C,GAApB,uBAAAp+C,EAAA,yDACfo+C,EAAQ4F,qBACJ37C,EAAO,OACP8N,EAAQioC,EAAQxF,SAASvwC,QAEdlJ,KADXkrD,EAASL,EAAU7zC,IAJR,uBAMXioC,EAAQxjB,SAASvyB,EAAM,0DANZ,6BAUF,YADTnH,EAAwBmpD,EAAOnpD,MATpB,oBAWU,KAAjBiV,EAAMzS,QAA8B,MAAbyS,EAAM,GAXtB,wBAYPioC,EAAQxjB,SAASvyB,EAAM,0DAZhB,kCAgBf,EAAK+O,WAAWmT,QAAUpU,EAC1B,EAAKiB,WAAWlW,KAAOA,EAjBR,UAkBC,EAAKkW,WAAWyzC,eAlBjB,aAmBH1rD,KADRP,EAlBW,SAmBQw/C,EAAQxjB,SAASvyB,EAAMzJ,GAnB/B,4CA3CvB,0DAiEYyhD,QAjEZ,uCAiEsB,WAAOh6C,EAAa+3C,GAApB,SAAAp+C,EAAA,yDACD,SAATqG,EADU,gCAEG,EAAKqsC,SAAS,SAAU0L,GAF3B,mFAjEtB,6GAWQ1/C,KAAK20C,SAAW,CACZ//B,MAAO,CACHjL,KAAM,CACFqc,OAAQ,OACR9P,MAAOlW,KAAKosD,aACZjxC,YAAa,wCAEjB2Q,OAAQ,CAAC9F,OAAQ,SAAUzjB,UAAW,iCAAkC2T,MAAO,sCAlB/F,+BAuBW,OAAOlW,KAAKqsD,cAvBvB,+BAyBE,OAAO,qBAAK9pD,UAAU,cAAf,SACN,cAAC,KAAD,CAAI6Q,KAAK,SAAS7Q,UAAU,eAA5B,wEA1BH,gCA+BQ,OAAO,sBAAKA,UAAU,sBACdF,MAAO,CAACiqD,WAAW,OAAQC,YAAY,QADxC,UAEXrB,IACD,qBAAK3oD,UAAU,SACf,cAAC,OAAD,CAAM+e,OAAQthB,KAAKshB,OAAQqzB,SAAU30C,KAAK20C,SACzCsQ,cAAejlD,KAAKg0C,SACpB2N,QAAS3hD,KAAK2hD,QACdzB,cAAc,IACdh9C,MAAI2oD,sBAvCR,GAAyDvyC,KAwE5CkzC,EAAb,2KAC4B,MAAO,iBADnC,kCAE2B,MAAO,+BAFlC,GAAoCN,GAKvBO,EAAb,uKACuB,OAAO,OAD9B,mCAE4B,MAAO,iBAFnC,kCAG2B,MAAO,+BAHlC,GAAkCP,GC9ErBQ,EAAb,4MACYprC,OAAiB,CACrB,CAAC3Z,KAAM,SAAUnF,KAAM,SAAUw1B,UAAU,EAAM9c,UAAW,GAC5D,CAACvT,KAAM,SAAUnF,KAAM,WAH/B,EAMYmqD,gBAAkB,SAACjN,EAAiBjoC,EAAWqpC,GACnDpB,EAAQ+E,YAAY,UAAWhtC,GAA2B,IAAjBA,EAAMzS,SAPvD,EASY2vC,SAAqB,CACzB//B,MAAO,CACHkX,OAAQ,CACJ9F,OAAQ,OACR9P,MAAO,qBACPiF,YAAa,uCACb0lC,UAAW,EAAK8L,iBAEpB5I,OAAQ,CACJ/9B,OAAQ,SACRzjB,UAAW,iCACX2T,MAAO,uBACPsF,UAAU,KArB1B,EA0BSoxC,cA1BT,IA+BS5Y,SA/BT,uCA+BoB,WAAOrsC,EAAa+3C,GAApB,eAAAp+C,EAAA,6DACRwqB,EAAS4zB,EAAQxF,SAAS,UADlB,SAEI,EAAK0S,SAAS9gC,GAFlB,UAGA,IAHA,8BAIR4zB,EAAQxjB,SAAS,SAAU,kCAJnB,8DA/BpB,0DAwCYylB,QAxCZ,uCAwCsB,WAAOh6C,EAAa+3C,GAApB,SAAAp+C,EAAA,yDACD,WAATqG,EADU,gCAEG,EAAKqsC,SAAS,SAAU0L,GAF3B,mFAxCtB,2GA2BMkN,GACJ5sD,KAAK4sD,SAAWA,IA5BlB,+BA8CW,MAAO,uBA9ClB,gCAiDQ,IAAIC,EAAiBC,EACrB,OAAQ9sD,KAAK0Y,WAAWlW,MACpB,IAAK,SAAUqqD,EAAW,qBAAO,MACjC,IAAK,QACDA,EAAW,eACXC,EAAQ,qCAAE,sBAAMvqD,UAAU,cAAhB,0BAAF,mFAAwD,0BAGxE,OAAO,sBAAKA,UAAU,sBAC3BF,MAAO,CAACiqD,WAAW,OAAQC,YAAY,QAD3B,6DAEHM,EAAS,uBAClB,qBAAKtqD,UAAU,uCAAf,SAAsD,4BAAIvC,KAAK0Y,WAAWmT,YACzEihC,EACD,qBAAKvqD,UAAU,SACf,cAAC,OAAD,CAAM+e,OAAQthB,KAAKshB,OAAQqzB,SAAU30C,KAAK20C,SACzCsQ,cAAejlD,KAAKg0C,SACpB2N,QAAS3hD,KAAK2hD,QACdzB,cAAc,WAlElB,GAA6B5mC,KCAPyzC,EAAtB,4MAMYzrC,OAAiB,CACrB,CAAC3Z,KAAM,MAAOnF,KAAM,SAAUw1B,UAAU,EAAM9c,UAAW,KACzD,CAACvT,KAAM,QAASnF,KAAM,SAAUw1B,UAAU,EAAM9c,UAAW,KAC3D,CAACvT,KAAM,SAAUnF,KAAM,WAT/B,EAYSwqD,eAZT,uCAY0B,WAAOrlD,EAAa+3C,GAApB,qBAAAp+C,EAAA,yDACdkjB,EAASk7B,EAAQ1kB,KAAK/d,KACrByuC,EAAclnC,EAAdknC,IAAKuB,EAASzoC,EAATyoC,MAELvB,GAAOA,IAAQuB,EAJF,gBAKdvN,EAAQyC,SAAS,MAAO,IACxBzC,EAAQyC,SAAS,QAAS,IAC1BlgD,EAAQ,iFACRy9C,EAAQxjB,SAAS,MAAOj6B,GARV,wCAWT,EAAKyW,WAAWw0C,iBAAiBxB,GAXxB,aAYAjrD,KADvBwB,EAXuB,SAaViB,MAAId,KAAK,cAAC,OAAD,CAAMS,OAAO,iCAAb,SAAqB,qBAAKN,UAAU,kBAAf,SAAkCN,OAbtD,iCAgBXA,GAhBW,4CAZ1B,0DA8BY0/C,QA9BZ,uCA8BsB,WAAOh6C,EAAa+3C,GAApB,SAAAp+C,EAAA,yDACD,UAATqG,EADU,gCAEG,EAAKqlD,eAAe,SAAUtN,GAFjC,mFA9BtB,+GAqCE,OAAO1/C,KAAKqsD,cArCd,gCAyCE,IAAI1X,EAAqB,CACxB//B,MAAO,CACN82C,IAAK,CAAC1lC,OAAQ,WAAY7K,YAAa,eAAMjF,MAAO,gBACpD+2C,MAAO,CAACjnC,OAAQ,WAAY7K,YAAa,2BAAQjF,MAAO,4BACxD6tC,OAAQ,CAAC/9B,OAAQ,SAAUzjB,UAAW,iCAAkC2T,MAAOlW,KAAKmtD,iBAGtF,OAAO,sBAAK5qD,UAAU,sBACrBF,MAAO,CAACiqD,WAAW,OAAQC,YAAY,QADjC,qCAEF,uBACJ,qBAAKhqD,UAAU,uCAAf,SAAsD,4BAAIvC,KAAK6rB,YAC/D,qBAAKtpB,UAAU,SACf,cAAC,OAAD,CAAM+e,OAAQthB,KAAKshB,OAAQqzB,SAAUA,EACpCsQ,cAAejlD,KAAKgtD,eACpBrL,QAAS3hD,KAAK2hD,QACdzB,cAAc,SAxDlB,8BAIuB,OAAOlgD,KAAK0Y,WAAWmT,YAJ9C,GAA4DvS,KA6D/C8zC,EAAb,0KAC2B,MAAO,6BADlC,oCAE6B,MAAO,qCAFpC,GAAuCL,GAK1BM,EAAb,0KAC2B,MAAO,6BADlC,oCAE6B,MAAO,yBAFpC,GAAqCN,GCnEfO,EAAtB,uKACW,OAAO,MADlB,GAAuCh0C,KAI1Bi0C,EAAb,wKACY,IAAD,EACmBvtD,KAAK0Y,WAAvBmT,EADD,EACCA,QAAS3gB,EADV,EACUA,MACnB,OAAO,qBAAK3I,UAAU,sBAAf,SACN,sBAAKA,UAAU,OAAf,UACC,sBAAKA,UAAU,mBAAf,0BACI,yBAAQA,UAAU,eAAlB,UAAkCspB,EAAlC,OADJ,qCAGA,wBAAQtpB,UAAU,4BAA4BC,KAAK,SAASC,QAAS,kBAAIyI,OAAMzK,IAA/E,+CARJ,GAAsC6sD,GAgBzBE,EAAb,wKACY,IACAtiD,EAASlL,KAAK0Y,WAAdxN,MACV,OAAO,qBAAK3I,UAAU,sBAAf,SACN,sBAAKA,UAAU,OAAf,UACC,qBAAKA,UAAU,gCAAf,kDACA,wBAAQA,UAAU,4BAA4BE,QAAS,kBAAIyI,KAA3D,+CANJ,GAAoCoiD,GChBdG,EAAtB,4MACI5hC,aADJ,IAEIrpB,UAFJ,IAGIupB,cAHJ,IAIID,YAJJ,IAgCI5gB,MAhCJ,uCAgCY,WAAO2gB,GAAP,eAAAvqB,EAAA,sEACgBwP,IAAQ5F,MAAM,CAACvB,KAAMkiB,GAAW,EAAKA,QAAS6/B,IAAK,EAAK3/B,SAAU3rB,MAAO8C,MAAI9C,QAD7F,eAEYK,KADZitD,EADA,+BAGAx9C,MAAM,oBAHN,0CAMJhN,MAAIyqD,YAAYD,GANZ,OAQN,EAAKrjD,UAAUnH,MAAI8M,SAAS,KARtB,2CAhCZ,8NAQQhQ,KAAK4tD,UAAU5tD,KAAKksD,QAR5B,uIAYgB,IAAD,OAEPlsD,KAAK4tD,UAAU5tD,KAAK0sD,QAApB,uCAA6B,WAAO5gC,GAAP,eAAAxqB,EAAA,6DAClC,EAAKwqB,OAASA,EADoB,SAElBhb,IAAQ+8C,YAAY,EAAKhiC,QAASC,GAFhB,UAGtB,KADR5rB,EAF8B,iDAGZA,GAHY,OAIlC,EAAK4tD,aAJ6B,2CAA7B,kCAAA9tD,KAAA,kBAdR,mCAwBQA,KAAK4tD,UAAU5tD,KAAK+sD,aAxB5B,kCA6BQ/sD,KAAK4tD,UAAU5tD,KAAKstD,YA7B5B,uKA4CwBx8C,IAAQi9C,SAAS/tD,KAAK6rB,SA5C9C,UA4CY3rB,EA5CZ,YA8CsBO,KADVwB,EAAQjC,KAAKguD,aAAa9tD,IA7CtC,yCA8CwC+B,GA9CxC,uBA+CoB6O,IAAQm9C,WAAWjuD,KAAK6rB,QAAS7rB,KAAKwC,KAAMU,MAAI+Q,KA/CpE,cA+CQ/T,EA/CR,OAgDQF,KAAKkuD,WAhDb,wJAW2D,OAAOxB,MAXlE,GAAuC32C,KAwD1Bo4C,EAAb,2KAI2BJ,GACnB,GAAIA,EAAW,EAAG,MAAO,qDALjC,gFAQ2BrC,GAR3B,2EASE1rD,KAAK+rB,SAAW2/B,EACN/qD,EAA4B,CAC5BsQ,UAAMxQ,EACNkJ,KAAM3J,KAAK6rB,QACX6/B,MACA0C,aAAS3tD,EACT4tD,YAAQ5tD,EACR6tD,mBAAe7tD,EACf6nD,WAAO7nD,EACPqrB,OAAQ9rB,KAAK8rB,QAlBzB,KAoBgB9rB,KAAKwC,KApBrB,OAqBiB,WArBjB,OAyBiB,UAzBjB,8BAsBgB7B,EAAO0tD,OAAS9gD,OAAOvN,KAAK6rB,SAC5BlrB,EAAO2tD,cAAc,GAvBrC,mCA0BgB3tD,EAAO2nD,MAAQtoD,KAAK6rB,QA1BpC,8CA6BwB/a,IAAQy9C,SAAS5tD,GA7BzC,WA8BoB,KADRT,EA7BZ,gCA+BYgD,MAAIqD,QACJvG,KAAKwuD,YAhCjB,kCAmCYvsD,EAAQjC,KAAKyuD,UAAUvuD,GAnCnC,kBAoCe+B,GApCf,wIAuCsBysD,GACd,IAAIlrD,EACJ,OAAQkrD,GACJ,QAAS,MAAO,6CAChB,KAAK,EAAG,MAAO,iCACf,KAAK,EAAG,OACR,KAAK,EAAGlrD,EAAM,sBAASxD,KAAK6rB,QAAS,MACrC,KAAK,EAAGroB,EAAM,uBAAUxD,KAAK6rB,QAAS,MACtC,KAAK,EAAGroB,EAAM,gBAAQxD,KAAK6rB,QAE/B,OAAOroB,EAAM,gDAjDrB,6BAC0D,OAAOgpD,IADjE,gCAE6D,OAAOY,IAFpE,+BAG4D,OAAOG,MAHnE,GAA+BE,GAqDlBkB,EAAb,2KAIwBZ,GAChB,GAAiB,IAAbA,EAAgB,MAAO,qDALnC,gFAO2BrC,GAP3B,8EAQE1rD,KAAK+rB,SAAW2/B,EARlB,SASkB56C,IAAQ89C,cAAc5uD,KAAK6rB,QAAS7rB,KAAK+rB,SAAU/rB,KAAK8rB,OAAQ9rB,KAAKwC,MATvF,UAUqB,IAVrB,OAUUwC,OAVV,sBAWO9C,EAAM,uCACV4C,QAAQC,IAAI7C,GACNA,EAbT,cAeQgB,MAAIqD,QACJvG,KAAKwuD,YAhBb,wJAC0D,OAAO/B,IADjE,gCAE6D,OAAOY,IAFpE,+BAG4D,OAAOG,MAHnE,GAA6BC,GCzGhB1Y,EAAb,2bAIiB7jC,EAAuCQ,GAJxD,uEAKM85C,EALN,uCAKgB,WAAOngC,EAAWqgC,GAAlB,eAAApqD,EAAA,sEACIwP,IAAQ5F,MAAM,CAC9BvB,KAAM0hB,EACNqgC,IAAKA,EACLtrD,MAAO8C,MAAI9C,QAJC,eAOAK,KANTkJ,EADS,kDAOkB,GAPlB,cAQb7E,QAAQC,IAAI,gCAAiC4E,EAAKhC,KAAMgC,EAAKtJ,OARhD,SASP6C,MAAIyqD,YAAYhkD,EAAMuH,GATf,iCAUN,GAVM,2CALhB,wDAiBElR,KAAK4tD,UAAUrC,EAAQ,CAACC,UAAS95C,aAjBnC,mLAoBqBR,GApBrB,iEAqBElR,KAAK4tD,UAAU5C,GAAS,WACvB9nD,MAAI0W,OAAO1I,MAtBd,mQA2BM29C,EAAY,IAAIV,EAAUnuD,KAAK2M,KA3BrC,SA4BQkiD,EAAUrqD,QA5BlB,gQAgCMsqD,EAAU,IAAIH,EAAQ3uD,KAAK2M,KAhCjC,SAiCQmiD,EAAQtqD,QAjChB,iJAqCE,OAAOsnD,IArCT,2JAwCMiD,EAAQ/uD,KAAKgvD,qBACjBhvD,KAAK4tD,UAAUmB,EAAf,uCAAsB,WAAOhD,EAAoBC,GAA3B,iBAAA1qD,EAAA,6DACjBwpB,EAAe,IAAIC,IAAa,WAAOtqB,GADtB,SAELqqB,EAAamkC,eAAe,CAAClD,cAAaC,gBAFrC,cAEjB9rD,EAFiB,yBAGdA,GAHc,2CAAtB,oCAAAF,KAAA,gBAzCF,2GAA4B+V,M,sKCEfm5C,EAAb,4MASY10C,SAAW,SAACC,GAChB,EAAKC,SAAWD,EAAIE,OAAOlD,MAC3B,IAAImD,EAAW,EAAKnD,MACpB,EAAKoD,UAAa,EAAKH,WAAaE,GAZ5C,EAeYE,OAAS,SAACL,GACd,EAAKM,eAhBb,EAmBYC,QAAU,WACd,EAAK/Y,WAAQxB,GApBrB,EA6BYuX,KAAOuD,aAAS,SAACha,GAAgF,IACtGK,EAAWL,EAAXK,QACDyZ,EAAS,WAEZ,GADA,EAAKN,mBACcta,IAAf,EAAKwB,MAAqB,CAC7B,IAAI6a,EAAM,EAAKpC,SACf9Y,EAAQkb,KAGAjD,EAAQ,wBACRtX,UAAU,gDACViZ,UAAW,EAAKX,UAChBpY,QAAS4Y,EAHD,0BATwF,EAgB7E,EAAK8zC,eAA7B3sD,EAhBqG,EAgBrGA,KAAM4yB,EAhB+F,EAgB/FA,IAAK6D,EAhB0F,EAgB1FA,IAAK9lB,EAhBqF,EAgBrFA,KACf,OAAO,cAAC,IAAD,CAAMtQ,OAAQ,EAAKqT,MAAO2D,MAAOA,EAAjC,SACH,sBAAKtX,UAAU,MAAf,UACR,uBAAOC,KAAMA,EACZgY,SAAU,EAAKA,SACfiB,UARa,SAAChB,GACI,KAAhBA,EAAIiB,SAAgBL,KAQPP,OAAQ,EAAKA,OACbE,QAAS,EAAKA,QACdzY,UAAU,eACVoZ,aAAc,EAAKlE,MAAOwhB,IAAKA,EAAK7D,IAAKA,EAAKjiB,KAAMA,IAEpD,EAAKqS,QAAU,qBAAKjjB,UAAU,kBAAf,SAAkC,EAAKijB,OAAOrK,cAEhE,EAAKlZ,OAAS,qBAAKM,UAAU,cAAf,SAA8B,EAAKN,gBA1DlE,4MAGe,IAAIkJ,SAAa,SAACvJ,EAASC,GAC9B,IAAIm1B,EAAUt0B,gBAAoB,EAAKsV,KAAM,CAACpW,UAASC,WACvDqB,IAAId,KAAK40B,EAAQn1B,OAL7B,sIAwBE,MAAO,CACNW,KAAM,UAzBT,6BAC8B,OAAOxC,KAAK0lB,YAD1C,GAAoCL,K,QCPvB+pC,EAAb,4MAgBY50C,SAAW,SAAC/C,GAChB,EAAKiD,SAAWjD,EAChB,IAAImD,EAAW,EAAKnD,MACpB,EAAKoD,UAAa,EAAKH,WAAaE,GAnB5C,EAsBY5C,KAAOuD,aAAS,SAACha,GAAgF,IAChGK,EAAWL,EAAXK,QACA+F,EAAQ,EAAK4d,WAAb5d,KACAse,EAAQ,EAAKT,OAAbS,KACDpM,EAAQ,wBACRtX,UAAU,2CACViZ,UAAW,EAAKX,UAChBpY,QAAS,WACL,EAAKsY,mBACcta,IAAf,EAAKwB,OAAqBL,EAAQ,EAAK8Y,WALvC,0BAOR5P,EAAUmb,EACVA,EAAKre,KAAI,SAACP,EAAGQ,GAAkB,IACtBtE,EAAgB8D,EAAhB9D,MAAOkU,EAASpQ,EAAToQ,MACZ,OAAO,qBAAiBlV,UAAU,MAA3B,SAAiC,wBAAOA,UAAU,2BAAjB,UACpC,uBAAOoF,KAAMA,EAAMnF,KAAK,QAAQiV,MAAOA,EACnChV,QAAS,kBAAI,EAAK+X,SAAS/C,IAC3B40B,eAAgB50B,IAAU,EAAKA,QAHC,IAGUlU,GAASkU,EAHnB,YAAvB5P,MAOrB,uDACJ,OAAO,cAAC,IAAD,CAAMhF,OAAQ,eAAO,EAAKqT,MAAO2D,MAAOA,EAAxC,SACH,qBAAKtX,UAAU,MAAf,SACR,qBAAKA,UAAU,6CAAf,SAA6DuI,WA9CjE,0DAI2BrK,IAAfT,KAAKyX,QACLzX,KAAKyX,WAAuBhX,IAAfT,KAAK0lB,aAAqBjlB,EAAYT,KAAK0lB,QAAQ/J,gBAL5E,oLAUe,IAAIxQ,SAAa,SAACvJ,EAASC,GAC9B,IAAIm1B,EAAUt0B,gBAAoB,EAAKsV,KAAM,CAACpW,QAAQA,EAASC,OAAOA,IACtEqB,IAAId,KAAK40B,EAAQn1B,OAZ7B,8HAC2B,OAAO7B,KAAK0lB,YADvC,GAAmCL,KCAtBgqC,EAAb,4MASY70C,SAAW,SAAC/C,GAChB,EAAKiD,SAAWjD,EAChB,IAAImD,EAAW,EAAKnD,MACpB,EAAKoD,UAAa,EAAKH,WAAaE,GAZ5C,EAeY5C,KAAOuD,aAAS,SAACha,GAAgF,IAChGK,EAAWL,EAAXK,QACAqkB,EAAQ,EAAKT,OAAbS,KACDnb,EAAUmb,EACVA,EAAKre,KAAI,SAACP,EAAGQ,GAAkB,IACtBtE,EAAgB8D,EAAhB9D,MAAOkU,EAASpQ,EAAToQ,MACZ,OAAO,qBAAiBlV,UAAU,yCAAyCE,QAAS,WAAK,EAAK+X,SAAS/C,GAAQ7V,EAAQ,EAAK8Y,WAArH,SACFnX,GAASkU,GADG5P,MAKrB,uDACJ,OAAO,cAAC,IAAD,CAAMhF,OAAQ,eAAO,EAAKqT,MAA1B,SACH,qBAAK3T,UAAU,OAAf,SACKuI,SA7BjB,4MAGe,IAAIK,SAAa,SAACvJ,EAASC,GAC9B,IAAIm1B,EAAUt0B,gBAAoB,EAAKsV,KAAM,CAACpW,QAAQA,EAASC,OAAOA,IACtEqB,IAAId,KAAK40B,EAAQn1B,OAL7B,8HAC4B,OAAO7B,KAAK0lB,YADxC,GAAoCL,KCDvBiqC,EAAb,4MAwBY90C,SAAW,SAAC/C,GAChB,EAAKiD,SAAWjD,EAChB,IAAImD,EAAW,EAAKnD,MACpB,EAAKoD,UAAa,EAAKH,WAAaE,GA3B5C,EA8BY5C,KAAOuD,aAAS,SAACha,GAmBrB,OAAO,cAAC,IAAD,CAAMsB,OAAQ,eAAO,EAAKqT,MAA1B,oBAjDf,4MAGe,IAAI/K,QAAJ,uCAAiB,WAAOvJ,EAASC,GAAhB,iBAAAP,EAAA,8DAKLb,KADV+iD,EAAU,EAAKh+B,OAAfg+B,QAJe,uBAMhBtzC,MAAM,iCANU,0CASFszC,OAAO/iD,OAAWA,EAAW,EAAKgX,OAThC,OAShBgN,EATgB,OAapB,EAAKjK,SAASiK,EAAMhX,IACpB7L,EAAQ6iB,GAdY,2CAAjB,0DAHf,sWAC4B,OAAOzkB,KAAK0lB,YADxC,GAAgCL,K,gBCCjBkqC,E,4MACJ/Z,OAA6C,G,EAC7CiM,e,IAuBCzpC,KAAOuD,aAAS,SAACha,GAAgF,IAChGK,EAAWL,EAAXK,QACDiY,EAAQ,wBACRtX,UAAU,2CACViZ,UAAW,EAAKX,UAChBpY,QAAS,WACL,EAAKsY,mBACcta,IAAf,EAAKwB,OAAqBL,EAAQ,EAAK8Y,WALvC,0BAoBZ,OAAO,cAAC,IAAD,CAAM7X,OAAQ,eAAO,EAAKqT,MAAO2D,MAAOA,EAAxC,SACZ,qBAAKtX,UAAU,MAAf,SACE,EAAKitD,sB,0DA3CiB/uD,IAAfT,KAAKyX,QACLzX,KAAKyX,WAAuBhX,IAAfT,KAAK0lB,aAAqBjlB,EAAYT,KAAK0lB,QAAQ/J,gB,oLAK7D,IAAIxQ,SAAa,SAACvJ,EAASC,GAC9B,IAAIm1B,EAAUt0B,gBAAoB,EAAKsV,KAAM,CAACpW,QAAQA,EAASC,OAAOA,IACtEqB,IAAId,KAAK40B,EAAQn1B,O,uIAK3B,IAAIgnD,EAAa7oD,KAAKwlB,OAAOqjC,WAC7B,YAAmBpoD,IAAfooD,EAAiC,sEAC9BA,EAAWrxC,OAAOxX,KAAKyX,S,6BAlBP,OAAOzX,KAAK0lB,Y,GAHFL,KAuDtBoqC,EAAb,4MACWhO,UAA+B,QAD1C,EAEc/L,cAAgB,SAACj7B,GAA8C,IACtEkU,EAAiBlU,EAAjBkU,cACL,IAA8B,IAA1BA,EAAckJ,QAAlB,CACM,EAAKnd,SAAWnN,OAAOohB,EAAclX,OACrC,IAAImD,EAAW,EAAKnD,MACpB,EAAKoD,UAAa,EAAKH,WAAaE,IAP5C,6DAUuC,IAChCiuC,EAAc7oD,KAAKwlB,OAAnBqjC,WACDlnD,EAAU,CACb6zC,OAAQx1C,KAAKw1C,OACbE,cAAe11C,KAAK01C,eAErB,OAAOmT,EAAWC,aAAa9oD,KAAKyX,MAAO9V,OAhB7C,GAAuC4tD,GAoB1BG,EAAb,4MAEWjO,UAA+B,WAF1C,EAIS/L,cAAgB,SAACj7B,GACxB,IAAI+J,EAAkB,GACtB,IAAK,IAAIriB,KAAK,EAAKqzC,OAAQ,CAC1B,IAAIzb,EAAQ,EAAKyb,OAAOrzC,IACF,IAAlB43B,EAAMlC,SAAkBrT,EAAOpiB,KAAK23B,EAAMtiB,OAEzC,EAAKiD,SAAW8J,EAAOJ,KAAK,KAE5B,IAAIxJ,EAAW,EAAKnD,MACpB,EAAKoD,UAAa,EAAKH,WAAaE,GAb5C,6DAeuC,IAChCiuC,EAAc7oD,KAAKwlB,OAAnBqjC,WACDlnD,EAAU,CACb6zC,OAAQx1C,KAAKw1C,OACbE,cAAe11C,KAAK01C,eAErB,OAAOmT,EAAWK,aAAalpD,KAAKyX,MAAO9V,OArB7C,GAAsC4tD,GC3EzBI,EAAb,4MASYn1C,SAAW,SAACC,GAChB,EAAKC,SAAWD,EAAIE,OAAOlD,MAC3B,IAAImD,EAAW,EAAKnD,MACpB,EAAKoD,UAAa,EAAKH,WAAaE,GAZ5C,EAeYE,OAAS,SAACL,GACd,EAAKM,eAhBb,EAmBYC,QAAU,WACd,EAAK/Y,WAAQxB,GApBrB,EAuBYuX,KAAOuD,aAAS,SAACha,GAAgF,IACtGK,EAAWL,EAAXK,QAQKiY,EAAQ,wBACRtX,UAAU,gDACViZ,UAAW,EAAKX,UAChBpY,QAVG,WAEZ,GADA,EAAKsY,mBACcta,IAAf,EAAKwB,MAAqB,CAC7B,IAAI6a,EAAM,EAAKpC,SACf9Y,EAAQkb,KAGQ,0BAOZ,OAAO,cAAC,IAAD,CAAMja,OAAQ,EAAKqT,MAAO2D,MAAOA,EAAjC,SACH,sBAAKtX,UAAU,MAAf,UACI,0BACXiY,SAAU,EAAKA,SACfiB,UAPa,SAAChB,KAQCK,OAAQ,EAAKA,OACbE,QAAS,EAAKA,QACdzY,UAAU,eACzBoZ,aAAc,EAAKlE,MACnB6gB,KAAM,IAES,EAAK9S,QAAU,qBAAKjjB,UAAU,kBAAf,SAAkC,EAAKijB,OAAOrK,cAEhE,EAAKlZ,OAAS,qBAAKM,UAAU,cAAf,SAA8B,EAAKN,gBApDlE,4MAGe,IAAIkJ,SAAa,SAACvJ,EAASC,GAC9B,IAAIm1B,EAAUt0B,gBAAoB,EAAKsV,KAAM,CAACpW,UAASC,WACvDqB,IAAId,KAAK40B,EAAQn1B,OAL7B,8HAC8B,OAAO7B,KAAK0lB,YAD1C,GAAsCL,K,QCHzBuqC,EAAb,4MACS71B,WADT,IA2BYvf,SAAW,SAACC,GAChB,EAAKC,SAAW,EAAKw/B,SAASz/B,EAAIE,OAAOkd,SACzC,IAAIjd,EAAW,EAAKnD,MAC1B,EAAKoD,UAAa,EAAKH,WAAaE,EACpC,EAAK0K,KAAKsvB,cAAV,eAA8B,EAAKl6B,WA/BrC,iLAKO1a,KAAK+5B,MALZ,yDAOiBt5B,IADFT,KAAKwlB,OANpB,yCAOmCxlB,KAAK+5B,MAAMlC,SAP9C,cAQOA,EAAW73B,KAAK+5B,MAAhBlC,QARP,kBASS73B,KAAKk6C,SAASriB,IATvB,4WAYkB,IAGZrd,EAHW,OACV65B,EAAYr0C,KAAKwlB,OAAjB6uB,SACD74B,GAAwB,IAAb64B,EAGf,OADiB,IAAbA,IAAmB75B,EAAWxa,KAAKwa,UAChC,uBAAOyX,IAAK,SAAA1e,GAAC,OAAI,EAAKwmB,MAAMxmB,GAAG/Q,KAAK,WAC1C6pC,eAAgBrsC,KAAKyX,MAAO+D,SAAUA,EACtChB,SAAUA,MAnBb,+BAsBkBqd,GAAmB,IAAD,EACJ73B,KAAKwlB,OAA9BkS,EAD6B,EAC7BA,UAAWC,EADkB,EAClBA,WACV,OAAmB,IAAZE,EAAA,OAAmBH,QAAnB,IAAmBA,KAAnB,OAAuCC,QAAvC,IAAuCA,OAxBtD,6BAE+B,OAAO33B,KAAK0lB,UAF3C,gCAG2B,OAAO,MAHlC,GAAsCL,KCDzBwqC,EAAb,6KAEE,IAAI52B,EAAY7D,EAAYjiB,EAM5B,OALInT,KAAK0lB,UACRuT,EAAOj5B,KAAK0lB,QAAoBuT,IAChC7D,EAAOp1B,KAAK0lB,QAAoB0P,IAChCjiB,EAAQnT,KAAK0lB,QAAoBvS,MAE3B,CACN3Q,KAAM,QACNy2B,MAAK7D,MAAKjiB,YAVb,GAAmC+7C,GCAtBY,EAAb,6KAEE,IAAI72B,EAAY7D,EAAYjiB,EAM5B,OALInT,KAAK0lB,UACRuT,EAAOj5B,KAAK0lB,QAAyBuT,IACrC7D,EAAOp1B,KAAK0lB,QAAyB0P,IACrCjiB,EAAQnT,KAAK0lB,QAAyBvS,MAEhC,CACN3Q,KAAM,SACNy2B,MAAK7D,MAAKjiB,YAVb,GAAoC+7C,GC4BvBa,EADZx0C,YACD,oDASI,WAAYha,GAAmB,IAAD,uBAC1B,cAAMA,IATFyuD,oBAAsB,iCAQA,EAPtBC,6BAA+B,+CAOT,EANtBC,eAMsB,IALtBC,kBAKsB,IAJtBC,2BAIsB,IAHtBjqB,SAGsB,IAFzBwO,cAEyB,IA8EzB0b,SA9EyB,uCA8Ed,WAAOC,GAAP,2BAAAhvD,EAAA,8DACDb,IAAb6vD,EADc,uBAEjBpgD,MAAM,oBAFW,6BAKbqV,EAAwC+qC,EAAxC/qC,WAAYC,EAA4B8qC,EAA5B9qC,OAAQ/N,EAAoB64C,EAApB74C,OACP,IAD2B64C,EAAbC,UALd,sDAOiC,EAAKhvD,MAA7CqzC,EAPO,EAOPA,cAAe4b,EAPR,EAOQA,aACT,IARC,EAOqBC,SAPrB,qDASO,KAAf,OAANjrC,QAAM,IAANA,OAAA,EAAAA,EAAQ6uB,UATM,2DAWQ5zC,IAAhB+vD,EAXQ,kCAYFA,EAAYjrC,EAAYC,EAAQ/N,GAZ9B,kDAgBKhX,IAAb6vD,EAhBQ,wBAiBRpgD,MAAM,wFAjBE,sDAqBYogD,EAAS9rD,QArBrB,YAqBRs7C,EArBQ,UAsBYroC,EAtBZ,oBAwBhB,EAAKlW,MAAM0b,KAAKsI,EAAW5d,MAAQm4C,OACDr/C,IAAlBm0C,EAzBA,iBA0BA1kC,MAAM,GAAD,OAAIqV,EAAW5d,KAAf,gCAA2Cm4C,EAA3C,kBAAgEroC,IA1BrE,yCA+BMm9B,EAAcrvB,EAAYu6B,EAAaroC,GA/B7C,yBAkCF64C,EAAStI,MAlCP,2DAsCjBljD,QAAQC,IAAI,oBACZD,QAAQ7C,MAAR,MAvCiB,2DA9Ec,0DAErByuD,EAA4FnvD,EAA5FmvD,mBAAoBC,EAAwEpvD,EAAxEovD,sBAAuBC,EAAiDrvD,EAAjDqvD,aAAcR,EAAmC7uD,EAAnC6uD,sBAAuBzb,EAAYpzC,EAAZozC,SAF3D,OAG1B,EAAKub,UAAY,qBAAK3tD,UAAWmuD,GAAsB,EAAKV,sBAC5D,EAAKG,aAAe,qBAAK5tD,UAAWouD,GAAyB,EAAKX,sBAClE,EAAKI,sBAAwBA,GAAyB,EAAKH,6BAE3D,EAAK9pB,IAAM,qBAAK5jC,UAAWquD,GAAgB,EAAKZ,sBACtD,EAAKrb,SAAYA,GAAYA,EAAS//B,OAAU,GARhB,EATlC,qDAoBc,IAERuxB,EAFO,OACA7kB,EAAUthB,KAAKuB,MAAf+f,OAEL,OAAO,gCACXthB,KAAKkwD,UACI5uC,EAAO1Z,KAAI,SAAC2d,EAAY1d,GAAW,IAIxCqO,EAAc2P,EAHb4qC,EAAY,EAAKlvD,MAAjBkvD,SACA9oD,EAAQ4d,EAAR5d,KACD6d,OAAyB/kB,IAAhB,EAAKk0C,cAAsBl0C,EAAY,EAAKk0C,SAAShtC,QAEnDlH,IAAX+kB,IACHtP,EAAQsP,EAAOtP,OAASvO,EACxBke,EAAYL,EAAOK,WAEpB,IAAIpO,EAAQ,EAAKlW,MAAM0b,KAAKtV,GACxB2oD,EAkGR,SAAwBhrC,EAAYC,EAAwBC,EAAetP,EAAcuB,GACxF,IAAIo5C,EACGP,EACJ,QAAe7vD,IAAX+kB,EACA,OAAQA,EAAOQ,QACX,QAAS,MACT,IAAK,KAAMsqC,EAAWhB,EAAY,MAC3C,IAAK,OAAQgB,EAAWpB,EAAgB,MACxC,IAAK,WAAYoB,EAAWX,EAAkB,MACrC,IAAK,QAASW,EAAW1zB,IAAe,MACjD,IAAK,SAAU0zB,EAAWjB,EAAgB,MAC1C,IAAK,QAASiB,EAAWT,EAAe,MACxC,IAAK,SACL,IAAK,SAAUS,EAAWR,EAAgB,MAC1C,IAAK,WAAYQ,EAAWV,EAAkB,MACrC,IAAK,QACbiB,EAAK,IAAIzB,EAAc9pC,EAAMC,EAAYC,EAAmBtP,EAAOuB,GACnE,MACD,IAAK,YACJo5C,EAAK,IAAIpB,EAAkBnqC,EAAMC,EAAYC,EAAuBtP,EAAOuB,GAC3E,MACD,IAAK,WACJo5C,EAAK,IAAInB,EAAiBpqC,EAAMC,EAAYC,EAAsBtP,EAAOuB,GAI5E,QAAWhX,IAAPowD,EAAkB,CACrB,QAAiBpwD,IAAb6vD,EACH,OAAQ/qC,EAAW/iB,MAClB,IAAK,SAAU8tD,EAAWpB,EAAgB,MAC1C,IAAK,QAASoB,EAAW1zB,IAAe,MACxC,IAAK,UAAW0zB,EAAWV,EAAkB,MAC7C,IAAK,SACL,IAAK,UAAWU,EAAWT,EAG7B,QAAiBpvD,IAAb6vD,EAAwB,OAC5BO,EAAK,IAAIP,EAAShrC,EAAMC,EAAYC,EAAQtP,EAAOuB,GAGpD,OADAo5C,EAAGjrD,OACIirD,EA1IWC,CAAe,EAAMvrC,EAAYC,EAAQtP,EAAOuB,GAC3D24C,EAAwB,EAAKA,sBAC5BG,EAAaD,EAAbC,WACa,IAAdA,IACc,IAAbE,IAAmBF,GAAY,IAElB,IAAdA,IAAqBH,GAAyB,mBAhBP,IAoBvCW,EADAC,GAAyB,IADZzrC,EAAZyS,UACgC,sBAAMz1B,UAAU,cAAhB,eACnB6wB,EAAY,qBACZ,IAAdvN,EACHkrC,OAAWtwD,GAGXswD,EAAW,gCAAM76C,EAAN,IAAc86C,KACzB59B,GAAM,uBAEP,IAAIlzB,EAAM,eAAC,WAAD,WACRimC,EACD,sBAAK5jC,UAAW,4BAA8B6tD,EAC7C3tD,QAAO,sBAAE,sBAAAnB,EAAA,sEAAgB,EAAK+uD,SAASC,GAA9B,mFADV,UAEES,EACD,qBAAKxuD,UAAW6wB,EAAhB,cACY3yB,IAAX6vD,OAAsB7vD,EAAW6vD,EAASxF,mBAE5B,IAAdyF,GAAuB,qBAAKhuD,UAAU,kBAAf,SAAiC,mBAAGA,UAAU,6BARzCsF,GAY/B,OADAs+B,EAAM,EAAKA,IACJjmC,KAEPF,KAAKmwD,kBAnET,6EAuEqBG,EAAmB51C,GAvExC,kFAwEO6K,EAA6B+qC,EAA7B/qC,WAAYC,EAAiB8qC,EAAjB9qC,OAAQ/N,EAAS64C,EAAT74C,MACzBzX,KAAKuB,MAAM0b,KAAKsI,EAAW5d,MAAQ+S,EAzErC,EA0EwC1a,KAAKuB,MAAhCqzC,EA1Eb,EA0EaA,eACM,IA3EnB,EA0E4B6b,SA1E5B,qDA4E2B,KAAf,OAANjrC,QAAM,IAANA,OAAA,EAAAA,EAAQ6uB,UA5Ed,yDA6EwB5zC,IAAlBm0C,EA7EN,iBA8EG1kC,MAAM,GAAD,OAAIqV,EAAW5d,KAAf,gCAA2C+S,EAA3C,kBAA6DjD,IA9ErE,yCAmFSm9B,EAAcrvB,EAAY7K,EAAUjD,GAnF7C,+GAA0B/U,eAA1B,G,4PCjBauuD,EAAY,IAZzB,oNACuB7f,GADvB,iFAEqBpxC,KAAKC,IAAI,qBAAsB,CAACmxC,IAAIA,IAFzD,yNAIqBnwC,GAJrB,iFAKqBjB,KAAKC,IAAI,mCAAoC,CAACgB,OAAOA,IAL1E,0NAOmBiwD,GAPnB,iFAQelxD,KAAKC,IAAI,oBAAqB,CAAC0G,IAAIuqD,IARlD,oJAA+B1wD,KAYN,CAAc,WAAOC,G,OCyBjC0wD,G,KAAb,4MAKYn5C,KAAO,YAAgD,IAA9C5I,EAA6C,EAA7CA,eACRzF,EAAQzG,MAARyG,KACDunD,EAAkBvnD,EAAMA,EAAKhC,KAAO,uBAFkB,EAGhC2zC,SAAO7jC,MAA5BsG,EAHqD,EAGrDA,SAAUC,EAH2C,EAG3CA,QACf,OAAO,cAAC,OAAD,CAAMnb,OAAO,8BAAU+W,QAAQ,EAA/B,SACH,sBAAKrX,UAAU,4BAAf,UACI,sBAAKA,UAAU,iBAAf,UACI,qBAAKA,UAAU,4BAAf,sCACA,qBAAKA,UAAU,mBAAf,SAAmC2uD,OAEvC,sBAAK3uD,UAAU,iBAAf,UACI,qBAAKA,UAAU,4BAAf,iBACA,qBAAKA,UAAU,mBAAf,mBAAsCwb,EAAtC,YAAkDC,QAEtD,sBAAKzb,UAAU,iBAAf,UACI,qBAAKA,UAAU,4BAAf,sCACA,qBAAKA,UAAU,mBAAf,SAAmC6M,GAAkB,uBAAO7M,UAAU,GAAjB,mDAEzD,sBAAKA,UAAU,iBAAf,UACI,sBAAKA,UAAU,4BAAf,qCACQ,cAAC,KAAD,CAAIoF,KAAK,4BAEjB,qBAAKpF,UAAU,mBAAf,SACI,qBAAIA,UAAU,MAAd,UACI,uEAAYyb,KACZ,+CAAO,4BAAIkzC,IAAX,gEAAoClzC,EAApC,wBAEI5O,GACA,2DAAS,4BAAIA,IAAb,gCAA0C4O,aAK1D,sBAAKzb,UAAU,iBAAf,UACI,sBAAKA,UAAU,4BAAf,yBAA8C6M,KAC9C,sBAAK7M,UAAU,mBAAf,uUAGmC,uBAHnC,8HAxCpB,4FACe6M,GADf,iEAEQpP,KAAK2X,SAAS3X,KAAKgY,KAAM,CAAC5I,eAAeA,IAFjD,4GAAsCkK,MAoDzB83C,EAAb,4MAKYC,UAAY,SAACvqD,EAAWe,GAA+B,IACtD4F,EAAkB3G,EAAlB2G,GAAIwD,EAAcnK,EAAdmK,KAAMtJ,EAAQb,EAARa,KACf,OAAO,cAAC,MAAD,CAAKpF,UAAU,YAAYsX,MAAO,OAASpM,EAA3C,SACH,8BAAMwD,GAAQtJ,OAR1B,EAWY2pD,WAXZ,uCAWyB,WAAOC,GAAP,SAAAjwD,EAAA,6DACvB0N,IAAWzO,KAAOgxD,EAAQ9jD,GAC1B,EAAKiL,WAAW84C,WAAWD,GAFJ,SAGX,EAAK74C,WAAWlU,QAHL,2CAXzB,wDAiBYwT,KAAO,WACX,OAAO,cAAC,OAAD,CAAMnV,OAAO,2BAAO+W,QAAQ,EAA5B,SACH,cAAC,OAAD,CAAMhF,MAAO,EAAK8D,WAAW+4C,SAAU3qD,KAAM,CAAC0Q,OAAQ,EAAK65C,UAAW5uD,QAAS,EAAK6uD,iBAnBhG,+JAEQtxD,KAAK2X,SAAS3X,KAAKgY,MAF3B,2GAAiCsB,KAwBpBo4C,EAAb,4MAKY15C,KAAO,SAACikC,GACZ,OAAO,cAAC,OAAD,CAAMp5C,OAAO,QAAb,SACH,sBAAKN,UAAU,MAAf,UACR,qBAAKA,UAAU,uDAAf,SACC,wBAAQA,UAAU,iBAAiBE,QAASS,MAAI4I,SAAhD,wCAGW,0EACCmwC,EAAOA,OAAOr0C,KAAI,SAAC2L,EAAGpR,GAAJ,OAAU,8BAAcoR,GAAJpR,YAbvD,4FACe85C,GADf,iEAEQj8C,KAAK2X,SAAS3X,KAAKgY,KAAM,CAACikC,OAAOA,IAFzC,4GAAiC3iC,KAmBpBq4C,EAAb,4MAKY35C,KAAO,YAA0B,IAAxB/V,EAAuB,EAAvBA,MACb,OAAO,cAAC,OAAD,CAAMY,OAAO,mBAAb,SACH,8BACsB,kBAAVZ,EAAoBA,EAAQA,EAAMW,aAR1D,4FACeX,GADf,iEAEQjC,KAAK2X,SAAS3X,KAAKgY,KAAM,CAAC/V,MAAMA,IAFxC,4GAAiCqX,KC3GXs4C,EAAtB,kDASI,WAAYC,GAAqB,IAAD,EAGlC,GAHkC,qBAClC,mBAAMpxD,IATCqxD,eAQ2B,IAPtB/V,UAOsB,IALbp0C,UAKa,IAJhBoqD,YAIgB,IAFhCN,cAEgC,IAuB3BF,aAvB2B,IAwB3BS,iBAxB2B,EAElC,EAAKF,UAAYD,GAAW3uD,MAAImF,YAC5B,EAAKypD,UAAW,CAAC,IAAD,EACK,EAAKA,UAAxB9zC,EADc,EACdA,QAAS+zC,EADK,EACLA,OAEd,GADA,EAAKpqD,KAAOqW,OACIvd,IAAZud,EACH,MAAM,IAAIpP,MAAM,0DAEjB,EAAKmjD,OAASA,EATmB,SATpC,sDAwBWp7C,GACT,OAAOV,YAAEU,KAzBX,6BA4BkBhK,GAChB2f,uBAAa3f,KA7Bf,8BAkCSgsB,GACP,IAAIs5B,EACJ,GAAoB,kBAATt5B,EAAmB,CAC7B,GAAoB,IAAhBA,EAAK3zB,OAAc,OAAO,EAC9B,IAAI6C,EAAQ7H,KAAKgyD,YAAYhiC,WAAU,SAAA3oB,GAAC,OAAIA,IAAMsxB,KAClD,GAAI9wB,EAAQ,EAAG,OAAO,EACtBoqD,EAAQ,GAAGpqD,OAGXoqD,EAAQt5B,EAET,OAAwC,KAAhC34B,KAAKuxD,QAAQW,MAAQD,KA7C/B,iCAgDYV,GACVvxD,KAAKuxD,QAAUA,EADQ,IAElBY,EAAYZ,EAAZY,SAEJnyD,KAAKgyD,YADFG,EACgBA,EAASv0C,MAAM,MAGf,KAvDtB,oLA6DG5d,KAAKoyD,cACApyD,KAAK8xD,UA9Db,0CA8D+B,GA9D/B,gBA+DiC9xD,KAAK8xD,UAA9B9zC,EA/DR,EA+DQA,QAAS7X,EA/DjB,EA+DiBA,QAAS4mC,EA/D1B,EA+D0BA,IA/D1B,SAgESuO,SAAOzc,KAAK7gB,EAAS7X,EAAS4mC,GAhEvC,UAiEG/sC,KAAK+7C,KAAOT,SAAOS,KAKfF,EAAYP,SAAOW,OACT7sC,EAAkBJ,IAAlBI,sBAEQ3O,KADRkJ,EAAQzG,MAARyG,OACqBA,EAAK8D,GAAK,GAzEhD,kCA0EuBwjD,EAAUoB,aAAa/W,SAAO7jC,MAAMhK,IA1E3D,WA0EQuS,EA1ER,OA2EIhgB,KAAKyxD,SAAWzxC,GAoBI,IAAhBhgB,KAAK+xD,OA/Fb,2CA+FqC,GA/FrC,aAgGwB/xD,KAAKyxD,SAASzsD,OAhGtC,OAiGyB,IAjGzB,QAoGyB,IApGzB,gCAkGwBhF,KAAKsyD,cAAcljD,GAlG3C,mBAmGa,GAnGb,WAqGUmiD,EAAUvxD,KAAKyxD,SAAS,GAC5BzxD,KAAKwxD,WAAWD,GACX9jD,EAAM8jD,EAAN9jD,UAE+BhN,KADd8xD,EAAY9kD,IACe8kD,EAAY,QACnB9xD,IAAnB2O,GAAgCmjD,IAAcnjD,GA1G3E,wBA4G4BpP,KAAKsyD,cAAcljD,GA5G/C,mBA6GmC,GA7GnC,eA+GwBJ,IAAWzO,KAAOgyD,EA/G1C,kCAkH4BnjD,EAAe,QAAwD3O,IAAnDT,KAAKyxD,SAASrqD,MAAK,SAAAC,GAAC,OAAIA,EAAEoG,KAAK2B,MAlH/E,wBAmH4BJ,IAAWzO,KAAO6O,EAnH9C,oCAsHwBpP,KAAK4tD,UAAUwD,GAtHvC,mBAuH+B,GAvH/B,gBA0H8B3wD,IAAdo7C,EA1HhB,wBA2HgB77C,KAAK4tD,UAAU8D,EAAa7V,GA3H5C,mBA4HuB,GA5HvB,kCA8HmB,GA9HnB,yCAiIY77C,KAAK4tD,UAAU+D,EAAf,MAjIZ,mBAkImB,GAlInB,6PAsIEzuD,MAAIsvD,eAtIN,2KAyIqBvxD,GAzIrB,iFA0IqBgwD,EAAUwB,WAAWxxD,GA1I1C,qKAkJE,OAAOiC,MAAI6M,GAAJ,2HAlJT,2EAuJ0BX,GAClBlM,MAAIqD,QACJvG,KAAK4tD,UAAUuD,EAAkB/hD,KAzJzC,0BAsBoB,OAAOpP,KAAK+7C,SAtBhC,GAAuChmC,KCzBhC,SAAevR,EAAtB,sC,4CAAO,WAAqBkuD,EAA2CZ,EAAsBlhD,GAAtF,uBAAAtP,EAAA,6DACFwwD,KACEa,EAAab,EAAba,aAEJlnD,SAASlI,MAAQovD,GAEdC,EAAOnnD,SAASoI,qBAAqB,SACrCg/C,EAAQD,EAAK,MAEZzsD,EADM,OACI0sD,QADJ,IACIA,OADJ,EACIA,EAAO9+C,aAAa,mBACrB+9C,EAAU3rD,QAAUA,IAI/B2sD,EAAO,IAAIJ,EAAKZ,GAdd,SAeGgB,EAAKtuD,MAAMoM,GAfd,4C,2DCEemiD,EAAtB,kDAII,WAAYD,GAAY,IAAD,8BACnB,cAAMA,EAAKnmD,MAJIovC,UAGI,IAFJiX,WAEI,EAEnB,EAAKA,MAAQF,EACb,EAAK/W,KAAO+W,GAAQA,EAAKnnC,IAHN,EAJ3B,oDAYSgN,GAA6B,IAAD,EACnC,iBAAO34B,KAAKgzD,aAAZ,aAAO,EAAYC,QAAQt6B,KAb7B,gCAgBWhiB,GACT,IAAIpD,EAAC,iEAAmBoD,GACxB,YAAQlW,IAAJ8S,EAAsBA,EACnBvT,KAAKgzD,MAAMp8C,UAAUD,KAnB9B,2BAsBoCnU,EAAuB6U,GACzD,IAAIwN,EAAI,IAAIriB,EAAKxC,KAAK8yD,MAEtB,OADAjuC,EAAEjf,KAAKyR,GACAwN,IAzBT,6BA4ByDriB,EAAuB6U,GAC9E,IAAIoe,EAAI,IAAIjzB,EAAKxC,MAEjB,OADAy1B,EAAE7vB,KAAKyR,GACAoe,IA/BT,kCAkC2B,IAAD,EACpBy9B,EAAE,UAAGlzD,KAAKgzD,aAAR,aAAG,EAAYG,YACrB,QAAW1yD,IAAPyyD,EAAJ,CACA,IAAIhzD,EAAMoQ,IAAEgN,MAAM41C,GAElB,OADA5iD,IAAEC,MAAMrQ,EAAKF,KAAKgX,QACX9W,KAvCT,0BAU8B,OAAOF,KAAK+7C,OAV1C,2BAWkB,OAAO/7C,KAAKgzD,UAX9B,GAAoCj9C,KA2Cdq9C,EAAtB,kDAGI,WAAYxiB,GAAW,IAAD,8BAClB,cAAMA,EAAMkiB,OAHNO,YAEY,EAElB,EAAKA,OAASziB,EAFI,EAH1B,sDAQWj6B,GACT,IAAIpD,EAAC,iEAAmBoD,GACxB,YAAQlW,IAAJ8S,EAAsBA,EACnBvT,KAAKqzD,OAAOz8C,UAAUD,KAX/B,kCAgB2B,IAAD,EACpBu8C,EAAE,UAAGlzD,KAAKgzD,aAAR,aAAG,EAAYG,YACrB,QAAW1yD,IAAPyyD,EAAJ,CAEA,IADA,IAAII,EAAyB,GACpBrsD,EAAIjH,KAAK4wC,WAAWnwC,IAAJwG,EAAeA,EAAC,UAAIA,SAAJ,aAAG,EAAY2pC,MAAO,CAAC,IAAD,EAC9D0iB,EAASlxD,KAAK6E,EAAE+P,QAGjB,IADA,IAAI9W,EAAMoQ,IAAEgN,MAAM41C,KACT,CACR,IAAIK,EAAMD,EAAS/tD,MACnB,QAAY9E,IAAR8yD,EAAmB,MACvBjjD,IAAEC,MAAMrQ,EAAKqzD,GAGd,OADAjjD,IAAEC,MAAMrQ,EAAKF,KAAKgX,QACX9W,KA9BT,4BAckC,OAAOF,KAAKqzD,WAd9C,GAAoDN,I,kLC1C9BS,GAAtB,aAEI,WAAYvtC,GAAa,yBADfA,UACc,OA2BfzO,YA3Be,EACpBxX,KAAKimB,KAAOA,EAHpB,6FA8B4Bnf,EAAUe,GAAe,IACxC2P,EAAUxX,KAAKimB,KAAK1kB,MAAMuF,KAA1B0Q,OACL,YAAe/W,IAAX+W,EAA6B,qBAAKjV,UAAU,YAAf,SAA4B2K,KAAKkE,UAAUtK,KACrE0Q,EAAO1Q,EAAMe,KAjC5B,8BAMQ,IAAI+M,EAAQ5U,KAAKimB,KAAK1kB,MAAMqT,MAC5B,OAAkB,OAAVA,QAA4BnU,IAAVmU,IAAgD,IAAzBwR,MAAMC,QAAQzR,KAPvE,4BAUQ,IAAIA,EAAQ5U,KAAKimB,KAAK1kB,MAAMqT,MAC5B,OAAc,OAAVA,EAAuB,UACbnU,IAAVmU,GACyB,IAAzBwR,MAAMC,QAAQzR,GACPA,EAECA,EAAyBA,WAJrC,IAZR,8BAmBQ,IAAIA,EAAQ5U,KAAKimB,KAAK1kB,MAAMqT,MAC5B,GAAc,OAAVA,EAAgB,OAAO,EAC3B,QAAcnU,IAAVmU,EAAqB,OAAO,EAChC,IAAI6+C,EAAY7+C,EAChB,YAAwBnU,IAApBgzD,EAAU7+C,OACP6+C,EAAU10B,UAxBzB,iFAkBKnI,KAlBL,uECDa88B,EAAb,4MACIl8C,OAAS,SAAC1Q,EAAUe,GAA8B,IAAD,EACb,EAAKoe,KAAK1kB,MAAMuF,KAA3CvE,EADwC,EACxCA,UAAWoE,EAD6B,EAC7BA,IAAKlE,EADwB,EACxBA,QACrB,OAAO,oBAA0CF,UAAW+V,IAAW,mBAAoB/V,GAAYE,QAAS,kBAAIA,GAAWA,EAAQqE,IAAhI,SACF,EAAKgkD,cAAchkD,EAAMe,SADRpH,IAANkG,EAAgBkB,EAAMlB,EAAIG,KAHlD,YAA+B0sD,G,QCClBG,EAAb,4MACIn8C,OAAS,SAAC1Q,EAAUe,GAA8B,IAAD,EACtB,EAAKoe,KAAK1kB,MAAMuF,KAAlCvE,EADwC,EACxCA,UAAWoE,EAD6B,EAC7BA,IAChB,GAAoB,kBAATG,EAAmB,CAC1B,IAAIssB,EAAK9a,IAAW,cAAe,OAAQ,QAC3C,OAAO,oBAAgB/V,UAAW6wB,EAA3B,SAAgCtsB,GAAvB8X,eAEpB,OAAO,oBAA0Crc,UAAW+V,IAAW/V,GAAhE,SACF,EAAKuoD,cAAchkD,EAAMe,SADRpH,IAANkG,EAAgBkB,EAAMlB,EAAIG,KAPlD,YAA4B0sD,G,gCCUfI,G,MAAb,oDAII,WAAY3tC,GAAa,IAAD,6BACpB,cAAMA,GADc,2CAFhB4tC,WAA8C,GAE9B,EAmChBC,WAAa,WAAO,IAEpBC,EAFmB,EAC+B,EAAK9tC,KAAK1kB,MAA3DqT,EADkB,EAClBA,MAAOo/C,EADW,EACXA,eAAgBC,EADL,EACKA,cAAeC,EADpB,EACoBA,QAE3C,QAAczzD,IAAVmU,EAIJ,GAAc,OAAVA,EAYV,GANUm/C,GADyB,IAAzB3tC,MAAMC,QAAQzR,GACDA,EAGCA,EAAyBA,MAG7Co/C,EAAgB,CACnB,IAAIG,EAAWJ,EAAWnsD,KAAI,SAAAP,GAC7B,MAAO,CACN4+B,SAAU+tB,EAAe3sD,GACzBP,KAAMO,EACN+sD,QAAQx1C,kBAGV,EAAKue,OAASg3B,MAEV,CACJ,IAAIE,EAEHA,OADe5zD,IAAZyzD,EACI,SAACptD,EAAUwtD,GAAX,OAA8BxtD,IAASwtD,GAGvCJ,EAER,IAAIC,EAAWJ,EAAWnsD,KAAI,SAAAP,GAO7B,MAAO,CACN4+B,cAJgCxlC,IAAlBwzD,QAE8BxzD,IAA1CwzD,EAAc7sD,MAAK,SAAAmtD,GAAE,OAAIF,EAAKhtD,EAAGktD,MAGnCztD,KAAMO,EACN+sD,QAAQx1C,kBAGV,EAAKue,OAASg3B,OA1CL,EAAKh3B,OAAS,UAJd,EAAKA,YAAS18B,GAvCE,EAmJxB+W,OAAS,SAAC1Q,EAAqBe,GAA8B,IACpDlB,EAAO,EAAKsf,KAAK1kB,MAAMuF,KAAvBH,IACX,OAAOjE,gBAAoB,EAAK2hB,IAAK,CAACvd,OAAMe,QAAOlB,SAAUlG,IAANkG,EAAgBkB,EAAMlB,EAAIG,MArJvD,EAwJhBud,IAAM9I,aAAS,SAACha,GAA4D,IAC3EuF,EAAevF,EAAfuF,KAAMe,EAAStG,EAATsG,MACNtF,EAAa,EAAK0jB,KAAK1kB,MAAMuF,KAA7BvE,UACA6xD,EAAkCttD,EAAlCstD,QAASnuB,EAAyBn/B,EAAzBm/B,SAAeuuB,EAAU1tD,EAAfA,KACxB,OAAO,oBAAIvE,UAAW+V,IAAW/V,GAA1B,SACH,sBAAKA,UAAU,iCAAf,UACI,uBAAO0vB,IAAK,SAAA8H,GAAYA,IAAO,EAAK85B,WAAWO,GAAWr6B,IACtDx3B,UAAU,GAAGC,KAAK,WAAWiV,MAAM,GAAGhK,GAAI2mD,EAC1C/nB,eAAgBpG,EAChBzrB,SAAU,SAACzF,GACP,EAAK0/C,SAAS3tD,EAAMiO,EAAE4F,OAAOkd,YAErC,uBAAOt1B,UAAU,GAAGF,MAAO,CAACqyD,KAAK,EAAGC,aAAa,GAAIC,QAASR,EAA9D,SACK,EAAKtJ,cAAc0J,EAAQ3sD,aAnKxC,EAAKisD,aACL,EAAKe,oBAHe,EAJ5B,gEAUiC,IAIrBd,EAJoB,OACnBn/C,EAAS5U,KAAKimB,KAAK1kB,MAAnBqT,WACSnU,IAAVmU,IACU,OAAVA,IAGAm/C,GADyB,IAAzB3tC,MAAMC,QAAQzR,GACDA,EAGCA,EAAyBA,OAEV,IAA7BkgD,YAAkBlgD,IAClBmgD,YAAQhB,GAAqC,SAACiB,GAC1C,GAAoB,WAAhBA,EAAOxyD,KAAmB,CAAC,IAAD,EACrBqF,EAA8BmtD,EAA9BntD,MAAOotD,EAAuBD,EAAvBC,aAAcC,EAASF,EAATE,MACtBC,EAASD,GAASA,EAAMttD,KAAI,SAAAP,GAC5B,MAAO,CACH4+B,UAAU,EACVn/B,KAAMO,EACN+sD,QAAQx1C,mBAGhB,IAAKue,QAAOjI,OAAZ,SAAmBrtB,EAAOotD,GAA1B,mBAA2CE,KAC3C,EAAKrB,iBAEV,OAnCf,+BAkGqB/jD,GACb,IAAK,IAAI5N,KAAKnC,KAAK6zD,WAAY7zD,KAAK6zD,WAAW1xD,GAAG01B,QAAU9nB,EADlC,oBAET/P,KAAKm9B,QAFI,IAE1B,oCAAmC8I,SAAWl2B,GAFpB,iCAlGlC,kCAwGQ/P,KAAKo1D,UAAS,GACdp1D,KAAKimB,KAAK1kB,MAAMuF,KAAK2tD,cAASh0D,GAAW,EAAMT,KAAKq1D,eAzG5D,oCA6GQr1D,KAAKo1D,UAAS,GACdp1D,KAAKimB,KAAK1kB,MAAMuF,KAAK2tD,cAASh0D,GAAW,EAAOT,KAAKq1D,eA9G7D,+BAuHqBvuD,EAAqBm/B,GAClCn/B,EAAKm/B,SAAWA,EAChBjmC,KAAKimB,KAAK1kB,MAAMuF,KAAK2tD,SAAS3tD,EAAKA,KAAMm/B,EAAUjmC,KAAKq1D,eAzHhE,4BAgGQ,OAAOr1D,KAAKm9B,SAhGpB,kCAsHuC,OAAOn9B,KAAKm9B,OAAOsX,MAAK,SAAAptC,GAAC,OAAIA,EAAE4+B,cAtHtE,oCA6HQ,OAAOjmC,KAAKm9B,OAAOkF,QAAO,SAAAh7B,GAAC,OAAmB,IAAfA,EAAE4+B,YAAmBr+B,KAAI,SAAAP,GAAC,OAAIA,EAAEP,YA7HvE,GAAgC0sD,GAAhC,oCACKt/C,KADL,iE,yBCwBaohD,EADZ/5C,aACD,sDAKI,WAAYha,GAAkB,IAAD,8BAC/B,cAAMA,IAHCg0D,cAEwB,IADxBtP,gBACwB,IAI7Br0B,SAAW,SAACF,GACR5sB,QAAQC,IAAI,mCAAqC2sB,IAHjD,EAAK8jC,YAFoB,EALjC,wDAYyB,IACZ1uD,EAAQ9G,KAAKuB,MAAbuF,KACArE,EAAqBqE,EAArBrE,aACYhC,IADSqG,EAAZ2tD,SAEVz0D,KAAKimD,WAAajmD,KAAKu1D,SAAW,IAAI3B,EAAW5zD,MAEjDA,KAAKu1D,cADY90D,IAAZgC,EACW,IAAIixD,EAAU1zD,MAEd,IAAI2zD,EAAO3zD,QApBvC,yCAsBoBy1D,EAAgCC,IACC,IAA/CplD,IAAEqlD,QAAQ31D,KAAKuB,MAAMuF,KAAM2uD,EAAU3uD,QACxC9G,KAAKw1D,YACLx1D,KAAK41D,iBAzBR,6CA6BQ51D,KAAKu1D,SAASxuD,YA7BtB,kCAgCY/G,KAAKimD,YAAYjmD,KAAKimD,WAAW4P,cAhC7C,oCAmCY71D,KAAKimD,YAAYjmD,KAAKimD,WAAW6P,gBAnC7C,+BAwCc,IAAD,SAC6D91D,KAAKuB,MAAlEgB,EADA,EACAA,UAAWM,EADX,EACWA,OAAQiX,EADnB,EACmBA,OAAQkpB,EAD3B,EAC2BA,OAAQjE,EADnC,EACmCA,QAASsX,EAD5C,EAC4CA,KAAMr7B,EADlD,EACkDA,aACxCva,IAAXuiC,IAAsBA,EAAS,UACnBviC,IAAZs+B,IAAuBA,EAAU,kBAAM,mBAAGx8B,UAAU,uDAC3C9B,IAAT41C,IAAoBA,EAAOif,EAAK3oD,IAAI0pC,MAJnC,IAgBDvrC,EAAairD,EAenBC,EA/BO,EAM4Bh2D,KAAKu1D,SAAjC3gD,EANA,EAMAA,MAAeqhD,EANf,EAMOl3B,QACZ,SAASm3B,EAAU7xC,EAAe7hB,GAC9B,GAAK6hB,EACL,cAAeA,GACX,QACA,IAAK,SAAU,OAAO,oBAAI9hB,UAAW,WAAWC,EAA1B,SAAiC6hB,IACvD,IAAK,WAAY,OAAO,oBAAI9hB,UAAW,WAAWC,EAA1B,SAAkC6hB,MAC1D,IAAK,SAAU,OAAO,6BAAKA,KAoBnC,OAfIvZ,EADU,OAAV8J,EACUshD,EAAUlzB,EAAQ,eACbviC,IAAVmU,EACKshD,EAAUn3B,EAAS,WACP,IAAjBnqB,EAAM5P,OACDkxD,EAAU7f,EAAM,QAEhBzhC,EAAMhN,KAAI,SAACd,EAAMe,GACvB,OAAO,EAAK0tD,SAAS/9C,OAAO1Q,EAAMe,OAGxB,IAAdouD,GAAsBrhD,IACtBmhD,EAAcG,EAAUn3B,EAAS,iBAG3Bt+B,IAAZua,IAAuBg7C,GAAY,GAC1B,qBAAIzzD,UAAW+V,IAAW,UAAW/V,GAAYyY,QAASA,EAASg7C,SAAUA,EAA7E,UACFE,EAAUrzD,EAAQ,UAClBiI,EACAirD,EACAG,EAAUp8C,EAAQ,eA7E/B,oCAsCQ,OAAO9Z,KAAKu1D,SAAStB,kBAtC7B,GAA0BvxD,aAA1B,EACgBiK,IAAcqf,YAAiBoqB,KAD/C,U,wIClCsB+f,EAAtB,kGACc3xC,QADd,KAKa4xC,EAAb,qKACWzvD,GACH,OAAO,qBAAuBpE,UAAU,GAAjC,SACH,qBAAKA,UAAU,QAAf,SACI,qBAAKF,MAAO,CAACg0D,UAAW,0BAFf,MAAQ1vD,OAFjC,GAAgCwvD,GAUnBG,EAAb,kDAEI,WAAYj/C,GAAiB,IAAD,8BACxB,gBAFIA,WACoB,EAExB,EAAKA,MAAQA,EAFW,EAFhC,mDAMW1Q,GACH,IAAI+jC,EACJ,OAAQ1qC,KAAKqX,OACT,QAASqzB,EAAI,OAAQ,MACrB,IAAK,IAAKA,EAAI,OAAQ,MACtB,IAAK,IAAKA,EAAI,OAElB,IAAItX,EAAK7wB,IAAUmoC,GACnB,OAAO,qBAAuBnoC,UAAW6wB,GAAxB,MAAQzsB,OAdjC,GAA6BwvD,GAkBvBI,EAAkB,wBAClBC,EAAmB,yBACnBC,EAAgB,sBACAC,EAAtB,kDAOI,WAAYC,EAAyBjhD,GAAoB,IAAD,8BACpD,gBAPMihD,eAM8C,IAL9CC,WAK8C,IAH9C9rD,aAG8C,IAF9C+rD,SAE8C,EAEpD,EAAKF,UAAYA,EACjB,EAAKC,MAAQlhD,EACb,EAAKmhD,KAAiC,IAA3BF,EAAUG,aAAuB,MAAQ,SAJA,EAP5D,iDAGsC,OAAO92D,KAAK42D,UAHlD,4CAcWjwD,GAAiB,IAAD,EACC3G,KAAK0V,KAApBjT,EADc,EACdA,QAASs0D,EADK,EACLA,GACV3jC,EAAK7wB,IAAU,CACf,sBAA8B9B,IAAZgC,EAClB,gBAAmBhC,IAAPs2D,EACZ,KAAO,IAEX,OAAO,sBAAex0D,UAAW6wB,EAAI3wB,QAASA,EAAvC,UACFzC,KAAKg3D,cACLh3D,KAAKi3D,eAFOtwD,KArBzB,oCA0BiC,IACpBuP,EAASlW,KAAK0V,KAAdQ,MACL,YAAczV,IAAVyV,EAA4B,KACzB,uBAAO3T,UAAWvC,KAAK62D,IAAM,oBAA7B,SACF3gD,MA9Bb,mCAiCgC,IAEpBghD,EAAOC,EADNjhD,EAASlW,KAAK0V,KAAdQ,MAEL,OAAQlW,KAAK22D,UAAUS,YACnB,IAAK,OAAQF,EAAQX,EAAiB,MACtC,IAAK,SAAUW,EAAQV,EAAkB,MACzC,IAAK,QAASU,EAAQT,EAE1B,OAAQz2D,KAAK0V,KAAKyhD,QACd,IAAK,MAAOA,EAAS,oBAAqB,MAC1C,QACA,IAAK,SAAUA,EAAS,qBAAsB,MAC9C,IAAK,SAAUA,EAAS,kBAAmB,MAC3C,IAAK,UAAWA,EAAS,sBAE7B,IAAIN,EAAa72D,KAAK62D,UAAep2D,IAARyV,EAAmB,MAAM,MAClDkd,EAAK7wB,IAAU20D,EAAOC,EAAQN,EAAK,UACvC,OAAO,qBAAKt0D,UAAW6wB,EAAhB,SACFpzB,KAAKq3D,qBAnDlB,uCAuDQ,OAAO,qBAAK90D,UAAU,yBAAf,SACFvC,KAAKs3D,wBAxDlB,0CA4DQ,OAAOt3D,KAAK8K,YA5DpB,GAA6CqrD,GAgEhCoB,EAAb,wKAEc/yC,GACoBxkB,KAAK8K,aAAhBrK,IAAX+jB,OAAqC/jB,EACrB+jB,EAAOxkB,KAAK0V,KAAK/N,QAJ7C,2BACsC,OAAO3H,KAAK42D,UADlD,GAAmCF,GAQtBc,EAAb,wKAEchzC,GACoBxkB,KAAK8K,aAAhBrK,IAAX+jB,OAAqC/jB,EACrB+jB,EAAOxkB,KAAK0V,KAAK/N,QAJ7C,2BACsC,OAAO3H,KAAK42D,UADlD,GAAmCF,GAQtBe,EAAb,wKAEcjzC,GACN,QAAe/jB,IAAX+jB,EAAsBxkB,KAAK8K,aAAUrK,MACpC,CACD,IAAIwlB,EAAOjmB,KAAK0V,KAAKuQ,KACSjmB,KAAK8K,QAAf,kBAATmb,EAAkCzB,EAAOyB,QAChCxlB,KAPhC,uCAUgC,IAAD,EACLT,KAAK0V,KAAlBuQ,EADkB,EAClBA,KAAM5B,EADY,EACZA,IACPzP,EAA8B,kBAATqR,EAAmBjmB,KAAK8K,QAAUmb,EAC3D,YAAcxlB,IAAVmU,EAA4B,wBAEzB,qBAAKrS,UAAU,QAAf,SAECqS,EAAMhN,KAAI,SAACd,EAAMe,GAAP,OAAiB,eAAC,WAAD,WACd,IAARA,EAAW,KAAM,qBAAKxF,MAAO,CAACioC,MAAM,OAAQotB,aAAa,uBACzDh1D,gBAAoB2hB,EAAKvd,KAFkBe,UAjBhE,2BACoC,OAAO7H,KAAK42D,UADhD,GAAiCF,GA0BpBiB,EAAb,+KAIQ,OADkB33D,KAAK0V,KAAlBukB,YAHb,mCAMgC,IAEpBi9B,EAAOC,EAaPN,EAfmB,EACH72D,KAAK0V,KAApBQ,EADkB,EAClBA,MAAOqrB,EADW,EACXA,KAEZ,OAAQvhC,KAAK22D,UAAUS,YACnB,IAAK,OAAQF,EAAQX,EAAiB,MACtC,IAAK,SAAUW,EAAQV,EAAkB,MACzC,IAAK,QAASU,EAAQT,EAE1B,OAAQz2D,KAAK0V,KAAKyhD,QACd,IAAK,MAAOA,EAAS,oBAAqB,MAC1C,QACA,IAAK,SAAUA,EAAS,qBAAsB,MAC9C,IAAK,SAAUA,EAAS,kBAAmB,MAC3C,IAAK,UAAWA,EAAS,sBAIzBN,GADS,IAATt1B,EACMvhC,KAAK62D,UAAep2D,IAARyV,EAAmB,MAAM,MAErC,QACV,IAAIkd,EAAK7wB,IAAU20D,EAAOC,EAAQN,EAAK,UACvC,OAAO,qBAAKt0D,UAAW6wB,EAAhB,SACFpzB,KAAKq3D,qBA5BlB,2BACyC,OAAOr3D,KAAK42D,UADrD,GAAsCF,GClGzBkB,EAAb,WAMI,WAAYjB,EAA0Bp1D,GAAgB,yBAL9Co1D,eAK6C,OAJ7Cp1D,WAI6C,OAF7C+2B,UAE6C,EACjDt4B,KAAK22D,UAAYA,EACjB32D,KAAKuB,MAAQA,EAEbvB,KAAK+zC,YAVb,wDAcQ/zC,KAAKs4B,KAAO,GACZ,IAFgB,EAEZu/B,GAAiB,EAFL,cAGC73D,KAAKuB,OAHN,IAGhB,2BAA6B,CAAC,IAArBmU,EAAoB,QACzB,GAAoB,kBAATA,EACP1V,KAAKs4B,KAAKl2B,KAAK,IAAIk0D,EAAQ5gD,IAC3BmiD,GAAQ,MAEP,CACIA,GAAO73D,KAAKs4B,KAAKl2B,KAAK,IAAIg0D,GAC/B,IAAI/xC,OAAG,EACP,OAAQ3O,EAAKlT,MACT,QAAS,SACT,IAAK,SAAU6hB,EAAM,IAAIkzC,EAAcv3D,KAAK22D,UAAWjhD,GAAO,MAC9D,IAAK,SAAU2O,EAAM,IAAImzC,EAAcx3D,KAAK22D,UAAWjhD,GAAO,MAC9D,IAAK,OAAQ2O,EAAM,IAAIozC,EAAYz3D,KAAK22D,UAAWjhD,GAAO,MAC1D,IAAK,YAAa2O,EAAM,IAAIszC,EAAiB33D,KAAK22D,UAAWjhD,GAEjE1V,KAAKs4B,KAAKl2B,KAAKiiB,GACfwzC,GAAQ,IAnBA,iCAbxB,gCAqCcrzC,GAAc,IAAD,gBACLxkB,KAAKs4B,MADA,IACnB,oCAA2Bw/B,UAAUtzC,IADlB,iCArC3B,+BA0CQ,OAAOxkB,KAAKs4B,KAAK1wB,KAAI,SAACyc,EAAKxc,GAAN,OAAgBwc,EAAI7M,OAAO1E,OAAOjL,WA1C/D,K,QCnCakwD,EADZx8C,YACD,yKACc,IAAD,EAC2Bvb,KAAKuB,MAAhCgB,EADA,EACAA,UAAW+1B,EADX,EACWA,KAAM9T,EADjB,EACiBA,OAClBwzC,EAAW,IAAIJ,EAAS53D,KAAKuB,MAAO+2B,GACxC0/B,EAASF,UAAUtzC,GACnB,IAAI4O,EAAK9a,IAAW,kBAAmB/V,GACvC,OAAO,qBAAKA,UAAW6wB,EAAhB,SACF4kC,EAASxgD,eAPtB,GAA8B9U,eAA9B,G,yOCLau1D,EAAb,WASI,WAAYC,GAAuB,yBAR3B/c,MAAkB,GAQQ,KAP7B15B,MAAQvN,IAAWtM,IAAI,GAAI,CAACulB,MAAM,IAOL,KAN7B4R,SAAkB,EAMW,KAJxBo5B,cAIwB,OAHxBC,WAAuB,GAGC,KAFxBC,eAEwB,OAyHxBC,aAAiB73D,EAxHvBT,KAAKq4D,UAAYH,EACjBl4D,KAAKu4D,eAXb,2DAeQv4D,KAAKm4D,SAAWn4D,KAAKq4D,UAAU52C,MAAMpN,IAAIrU,KAAKq4D,UAAU1wD,KAAO,UAfvE,4BAkBU8F,EAAWyhC,GACb,GAAKzhC,IACgB,IAAjB+qD,mBAAS/qD,GACb,IAA2B,IAAvBzN,KAAKyhB,MAAMg3C,IAAIhrD,GAMnB,GAFAzN,KAAKq4D,UAAUlpB,YAAmB,IAARD,EAAa,GAAG,IAC1ClvC,KAAKyhB,MAAM/b,IAAI+H,EAAIA,GACfzN,KAAKo4D,WAAWpoC,WAAU,SAAA3oB,GAAC,OAAIA,IAAMoG,MAAO,EAC5CzN,KAAK04D,WAAWjrD,OADpB,CAKA,GAAIzN,KAAKm7C,MAAMn2C,QAlCF,IAkC0B,CAEnC,IAAIuO,EAAIvT,KAAKm7C,MAAM1mC,QACnB,GAAIlB,IAAM9F,EAGN,YADAzN,KAAKm7C,MAAM/4C,KAAKmR,GAKpB,IAA0B,IAAtBvT,KAAKyhB,MAAMg3C,IAAIllD,GAEfvT,KAAKyhB,MAAM/M,OAAOnB,OAEjB,CAED,IAAI1L,EAAQ7H,KAAKo4D,WAAWpoC,WAAU,SAAA3oB,GAAC,OAAIA,IAAMkM,KACjDvT,KAAKo4D,WAAWljC,OAAOrtB,EAAO,IAGtC7H,KAAKo4D,WAAWh2D,KAAKqL,GACrBzN,KAAKm7C,MAAM/4C,KAAKqL,QA/BZzN,KAAK04D,WAAWjrD,KAtB5B,iCAyDuBA,GACf,IAAI5F,EAAQ7H,KAAKm7C,MAAMnrB,WAAU,SAAA3oB,GAAC,OAAIA,IAAMoG,KAC5CzN,KAAKm7C,MAAMjmB,OAAOrtB,EAAO,GACzB7H,KAAKm7C,MAAM/4C,KAAKqL,KA5DxB,+BA+DaA,GACL,OAAOzN,KAAKyhB,MAAMxhB,IAAIwN,KAhE9B,6BAmEWA,GACHzN,KAAKyhB,MAAM/M,OAAOjH,GAClB,IAAI5F,EAAQ7H,KAAKm7C,MAAMnrB,WAAU,SAAA3oB,GAAC,OAAIA,IAAMoG,KAClDzN,KAAKm7C,MAAMjmB,OAAOrtB,EAAO,GACzB7H,KAAKm4D,SAAShkC,WAAW1mB,KAvE3B,kCA0EgBA,GACR,IAAIkrD,EACJ,cAAelrD,GACX,IAAK,SAAUkrD,EAAOlrD,EAAaA,GAAI,MACvC,IAAK,SAAUkrD,EAAMlrD,EAAc,MACnC,QAAS,OAEb,OAAOzN,KAAKk6C,SAASye,KAjF7B,iCAoFelrD,GACPzN,KAAK4M,OAAOa,GACZzN,KAAK44D,MAAMnrD,KAtFnB,iCAyFeqP,GACP,QAAYrc,IAARqc,EAAmB,OAAO,EAC9B,IAAIrP,EAAKzN,KAAK4jB,aAAa9G,GAC3B,QAAWrc,IAAPgN,EAAkB,OAAO,EAC7B,IAAI5F,EAAQ7H,KAAKo4D,WAAWpoC,WAAU,SAAA3oB,GAAC,OAAIA,IAAMoG,KAGjD,OAFI5F,GAAO,GAAG7H,KAAKo4D,WAAWljC,OAAOrtB,EAAO,GAC5C7H,KAAKyhB,MAAM/b,IAAI+H,EAAIqP,IACZ,IAhGf,mCAkG2BA,GAAU,OAAO9c,KAAKq4D,UAAUz0C,aAAa9G,KAlGxE,oJAqGuC,IAA3B9c,KAAKo4D,WAAWpzD,OArG5B,iEAsGyBhF,KAAK46C,UAtG9B,eAuGqBn6C,KADfo4D,EAtGN,SAuGwD,IAAtBA,EAAW7zD,OAvG7C,uBAwGGhF,KAAKo4D,WAAWljC,OAAO,EAAGl1B,KAAKo4D,WAAWpzD,QAxG7C,0BA2GQhF,KAAK84D,cAAcD,GA3G3B,0IA8G0BA,GAClB,QAAmBp4D,IAAfo4D,EAAJ,CACA,IAFqC,EAEjCjrB,EAAQ5tC,KAAK+4D,cAAcF,GAFM,cAGfjrB,GAHe,IAGrC,2BAA6B,CAAC,IAArB7X,EAAoB,SACU,IAA/B/1B,KAAKg5D,WAAWjjC,IACpB/1B,KAAKi5D,qBAAqBljC,IALO,kCA9G7C,yEAsHoBzhB,GAtHpB,gGAuHwCtU,KAAKk5D,mBAAmB5kD,GAvHhE,UAuHYukD,EAvHZ,OA+HqC,KAPzBM,EAAgBN,EAAWx2B,QAAO,SAAAh7B,GAClC,IAAIJ,EAAII,EAAEgM,QAAQ,MACdpM,EAAE,IAAGA,EAAII,EAAErC,QACf,IAAIyI,EAAKF,OAAOlG,EAAE6G,OAAO,EAAGjH,IAE5B,YAAgBxG,IADN,EAAK03D,SAASjkC,QAAQzmB,OAGlBzI,OA/H1B,iDAgIQhF,KAAK84D,cAAcK,GAhI3B,2PAoIuB,IAAjBn5D,KAAK++B,QApIX,wDAqIE/+B,KAAK++B,SAAU,EArIjB,SAsIkB/+B,KAAKk5D,mBAAmBl5D,KAAKo4D,YAtI/C,cAsIMl4D,EAtIN,OAuIEF,KAAK++B,SAAU,EAvIjB,kBAwIe7+B,GAxIf,0IA0I4BskB,GACpB,OAAOxkB,KAAKq4D,UAAUU,cAAcv0C,KA3I5C,2CA6ImCuR,GAC3B/1B,KAAKq4D,UAAUY,qBAAqBljC,KA9I5C,yEAiJoBtoB,GAjJpB,yEAkJYqP,EAAM9c,KAAKyhB,MAAMxhB,IAAIwN,GAlJjC,YAmJuBqP,EAnJvB,OAoJiB,WApJjB,OAqJiB,WArJjB,+CAoJkCA,GApJlC,cAqJ2B9c,KAAKyhB,MAAM/b,IAAI+H,EAAIA,GArJ9C,2CAuJwBzN,KAAKk5D,mBAAmB,CAACzrD,IAvJjD,OAuJYvN,EAvJZ,OAwJQF,KAAK84D,cAAc54D,GAxJ3B,0LA2JqCoU,GA3JrC,kGA4JYpU,EAAe,GACfk5D,EAAkB,GA7J9B,cA8JuB9kD,GA9JvB,IA8JQ,2BAAS7G,EAAW,SACZgK,EAAQzX,KAAKm4D,SAASjkC,QAAQzmB,IAM9BvN,EAAIkC,KAAKqV,GAFT2hD,EAAOh3D,KAAKqL,GAnK5B,WAAAsH,EAAA,uBAuKY9P,EAAMm0D,EAAOp0D,QACP,GAxKlB,iCAyK+BhF,KAAKq4D,UAAUgB,YAAYr5D,KAAKs4D,QAASc,GAzKxE,OAyKgBE,EAzKhB,kBA0KqBn3D,GAGL,IAAIkiB,EAAai1C,EAAOn3D,GACxB,IAAKkiB,EAAK,iBACV,IAAIpd,EAAIod,EAAIhR,QAAQ,MAChBpM,EAAI,IAAGA,EAAIod,EAAIrf,QACnB,IAAIyI,EAAKF,OAAO8W,EAAInW,OAAO,EAAGjH,IAC1CqJ,IAAE1D,OAAOwsD,GAAQ,SAAA/xD,GAAC,OAAIA,IAAMoG,KAChBvN,EAAIkC,KAAKiiB,GACT,EAAK8zC,SAASrjD,QAAQrH,EAAI4W,IAVrBliB,EAAE,EA1KvB,aA0K0BA,EAAE8C,GA1K5B,mCA0KqB9C,GA1KrB,wDA0KiCA,IA1KjC,wBAuLY,IADA8C,EAAMm0D,EAAOp0D,OACJ7C,EAAE,EAAGA,EAAE8C,EAAK9C,IACjBnC,KAAKm4D,SAASrjD,QAAQskD,EAAOj3D,GAAI,IAxLjD,iCA2LejC,GA3Lf,+GA+Laq5D,EAAb,kDAII,WAAYrB,EAAqB9mC,GAAe,IAAD,8BAC3C,cAAM8mC,IAJF9mC,SAGuC,IAFrCknC,aAEqC,EAE3C,EAAKlnC,IAAMA,EACX,EAAKknC,QAAUlnC,EAAIzpB,KACnB,EAAKwwD,SAAWD,EAAUz2C,MAAMpN,IAAI6jD,EAAUvwD,KAAO,QAAU,EAAK2wD,SAJzB,EAJnD,iGAgB2Bx7C,GAAU,OAAO9c,KAAKoxB,IAAIxN,aAAa9G,KAhBlE,oCAiB4B0H,GACpB,OAAOxkB,KAAKoxB,IAAI2nC,cAAcv0C,KAlBtC,2CAoBmCuR,GAC3B/1B,KAAKoxB,IAAI6nC,qBAAqBljC,OArBtC,GAAgCkiC,GCrHVuB,EAAtB,4HAjEA,4MACcC,aADd,IAEaC,SAAkB,OAF/B,EAGcC,YAHd,IAIIx0B,YAJJ,IAKIy0B,YALJ,IAiDI7c,UAAW,EAjDf,wDAOqBz7B,GACb,iEAAgBA,GADS,IAEpB7T,EAAM6T,EAAN7T,GACLzN,KAAK25D,OAASlsD,IAVtB,qCAcQ,OAAO,IAAIosD,EAAQ75D,QAd3B,mCAiBiByV,GAAiB,OAAOA,EAAIzV,KAAK25D,UAjBlD,kCAkBsB35D,KAAKy5D,SAAU,IAlBrC,6GAgDoBnlD,GAhDpB,4LAwBgB7G,GACd,cAAeA,GACd,QAAmB,MAAM,IAAImB,MAAM,cACnC,IAAK,SAAU,OAAOnB,EAAGA,GACzB,IAAK,SAAU,OAAOA,KA5BzB,0BA+BeqsD,EAAwBC,GAC/B,YAAYt5D,IAARq5D,GAA6B,OAARA,SACnBr5D,IAARs5D,GAA6B,OAARA,GAClBP,EAAKQ,QAAQF,KAASN,EAAKQ,QAAQD,QAlC5C,GAAwC54C,MAoE3BouB,EAAb,kDAKI,WAAYrpC,EAAUyB,EAAayZ,GAAgB,IAAD,8BAC9C,cAAMlb,EAAIyB,EAAMyZ,IALZ64C,UAI0C,IAHxCC,iBAGwC,IAFxCC,aAEwC,IADxChC,cACwC,EAE9C,EAAKgC,QAAU,IAAIlC,EAAJ,gBACf,EAAKE,SAAW,EAAK12C,MAAMpN,IAAI,EAAK1M,KAAO,WACrB,IAAlBzB,EAAG4N,YAAqB,EAAKqkD,SAASpjC,YAJI,EALtD,sDAYqBzT,GACb,iEAAgBA,GADS,IAEpB3Y,EAAQ2Y,EAAR3Y,KACL,QAAalI,IAATkI,EAAoB,CACpB3I,KAAKi6D,KAAO,GADQ,oBAEJtxD,GAFI,IAEpB,2BAAsB,CAAC,IAAd0L,EAAa,QACb1M,EAAQ0M,EAAR1M,KACDyyD,EAAU,IAAIC,EAAQr6D,KAAKkG,GAAIlG,KAAM2H,GACzC3H,KAAKi6D,KAAKtyD,GAAQyyD,EAClBA,EAAQ/3C,UAAUhO,GAClB+lD,EAAQ93C,mBAPQ,kCAfhC,4BA2BU7U,EAAWyhC,IACQ,IAAjBlvC,KAAKy5D,SACJhsD,GACLzN,KAAKm6D,QAAQvB,MAAMnrD,EAAIyhC,KA9B/B,4BAgCUzhC,GACF,GAAKA,EAAL,CACA,GAAkB,kBAAPA,EAAiB,OAAOA,EACnCzN,KAAK44D,MAAMnrD,GAHQ,IAIdq/B,EAAe9sC,KAAKkG,GAApB4mC,YACL,OAAKA,EACEA,EAAY9sC,KAAMyN,GADA,CAACA,GAAIA,MArCtC,kCAwCgBA,GAAY,OAAOzN,KAAKm6D,QAAQjgB,SAASzsC,KAxCzD,iCAyCYA,GACQ,kBAAPA,IAAiBA,EAAKA,EAAGA,IACpCzN,KAAKm6D,QAAQG,WAAW7sD,KA3C1B,yEA6CwBA,GA7CxB,oEA8COA,EA9CP,uDA+CoB,kBAAPA,IAAiBA,EAAKA,EAAGA,IA/CtC,SAgDQzN,KAAKm6D,QAAQI,UAAU9sD,GAhD/B,gCAiDSzN,KAAKm6D,QAAQjgB,SAASzsC,IAjD/B,wIAsDQ,GADAzN,KAAKm6D,QAAQrf,gBACKr6C,IAAdT,KAAKi6D,KACT,IAAK,IAAI93D,KAAKnC,KAAKi6D,KAAMj6D,KAAKi6D,KAAK93D,GAAG24C,aAvD9C,yEAyDoBxmC,GAzDpB,iFA0DctU,KAAKm6D,QAAQ9e,UAAU/mC,GA1DrC,wIA4De46B,GAAelvC,KAAKkG,GAAGipC,WAAWD,KA5DjD,0BA8DQvnC,GACA,OAAO3H,KAAKi6D,MAAQj6D,KAAKi6D,KAAKtyD,KA/DtC,2EAiEsB2wD,EAAgBhkD,GAjEtC,uFAkE8B,IAAIkmD,EAAUx6D,KAAM,CAACs4D,QAAQA,EAAShkD,IAAIA,IAAM,GAAO+Y,UAlErF,cAkEYntB,EAlEZ,QAmEgB8E,OAAS,IAAGhF,KAAKmlC,QAAS,GAnE1C,kBAoEejlC,GApEf,iLAsEmBuN,GAtEnB,uEAuE0B,kBAAPA,IAAiBA,EAAKA,EAAGA,IAvE5C,SAwEczN,KAAKm6D,QAAQI,UAAU9sD,GAxErC,gCAyEezN,KAAKm6D,QAAQrkC,YAAYroB,IAzExC,2KA2EeA,GA3Ef,2FA4EmBhN,IAAPgN,GAA2B,IAAPA,EA5EhC,iDA+E0B,kBAAPA,IAAiBA,EAAKA,EAAGA,SACnBhN,EAhFzB,uCAsF2B,IAAIg6D,EAAUz6D,KAAMyN,GAAI4f,UAtFnD,QAsFY7I,EAtFZ,uBA2FuB/jB,IAAX+jB,EA3FZ,iEA4FsBxkB,KAAKshB,OAAOK,QA5FlC,8DA4FiBM,EA5FjB,aA8FyBxhB,KADRwiB,EAAQhB,EAARgB,MA7FjB,gEAgGsBxiB,KADNwV,EAAIjW,KAAKkG,GAAG4c,QAAQG,IA/FpC,wDAiGgBgC,EAAIhD,EAAEta,KACV6c,EAAOS,GAAKhP,EAAEwO,MAAMD,EAAOS,IAlGvC,qFAAAlQ,EAAA,iEAoGQ/U,KAAKm6D,QAAQnB,WAAWx0C,GACxBxkB,KAAKi5D,qBAAqBz0C,GArGlC,kBAsGeA,GAtGf,mKAyGyBA,GAAa,IAAD,EACRxkB,KAAKshB,OAArBK,EADwB,EACxBA,OAAQhZ,EADgB,EAChBA,KAEb,GADA3I,KAAK06D,mBAAmBl2C,EAAQ7C,QACnBlhB,IAATkI,EAAoB,CAAC,IAAD,gBACJA,GADI,IACpB,2BAAqC,CAAC,IAA7B0L,EAA4B,QAC5B1M,EAAgB0M,EAAhB1M,KAAMga,EAAUtN,EAAVsN,OACPg5C,EAAYn2C,EAAO7c,GACvB,QAAkBlH,IAAdk6D,EAAJ,CACA,IAJiC,EAI7BP,EAAUp6D,KAAKoxB,IAAIzpB,GAJU,cAKjBgzD,GALiB,IAKjC,2BAA2B,CAAC,IAAnBt2C,EAAkB,QAGvB+1C,EAAQpB,WAAW30C,GACnBrkB,KAAK06D,mBAAmBr2C,EAAK1C,IATA,iCADjB,kCA5GhC,wCA6HQ,wEADqB,MAE6B3hB,KAAKshB,OAAlDovB,EAFgB,EAEhBA,WAAYkqB,EAFI,EAEJA,QAASC,EAFL,EAEKA,QAASC,EAFd,EAEcA,YAEzC96D,KAAKk6D,YAAcxpB,GAAc1wC,KAAK2hB,QAClB,IAAhBm5C,KACa,IAAZF,GAAkB56D,KAAKk6D,YAAY93D,KAAK,CAACuF,KAAM,UAAWnF,KAAM,YAAamhB,WAAOljB,KACxE,IAAZo6D,GAAkB76D,KAAKk6D,YAAY93D,KAAK,CAACuF,KAAM,UAAWnF,KAAM,YAAamhB,WAAOljB,KAEnFT,KAAKkG,GAAGsc,eAAexiB,KAAKk6D,eArIpC,oCAwIkB11C,GACV,OAAOxkB,KAAK+6D,sBAAsBv2C,EAAQxkB,KAAKk6D,eAzIvD,oEA4IezsD,EAAWlM,GA5I1B,uFA6IwB,IAAI8vC,EAAWrxC,KAAM,CAACyN,GAAGA,EAAIlM,MAAMA,IAAQ8rB,UA7InE,cA6IYntB,EA7IZ,YA8ImBO,IAAPgN,IACAzN,KAAKm6D,QAAQvtD,OAAOa,GACpBzN,KAAKm4D,SAAShkC,WAAW1mB,IAhJrC,kBAkJevN,GAlJf,iLAoJgBuN,EAAWiI,EAAa+B,GApJxC,iFAqJQ,IAAIujD,EAAeh7D,KAAM,CAACyN,KAAIiI,OAAM+B,UAAQ4V,UArJpD,cAsJErtB,KAAKm6D,QAAQvtD,OAAOa,GAtJtB,SAuJQzN,KAAKm6D,QAAQI,UAAU9sD,GAvJ/B,uQA0J+B,IAAIwlC,EAAUjzC,KAAM,IAAIqtB,UA1JvD,cA0JYntB,EA1JZ,yBA2JeA,GA3Jf,4KA6JiByG,EAAYohB,EAAyBC,GA7JtD,uFA8J8BhoB,KAAKi7D,eAAUx6D,EAAWkG,EAAKohB,EAAWC,GA9JxE,cA8JY9nB,EA9JZ,yBA+JeA,GA/Jf,oLAiKoB0wC,EAAcjqC,EAAYohB,EAAyBC,GAjKvE,wFAoKYrnB,EAAa,CAAC0T,SAAI5T,EAAWmwC,MAAMA,EAAOjqC,IAAIA,EAAKohB,UAAUA,EAAWC,SAASA,GApK7F,SAqKwB,IAAIkzC,EAAal7D,KAAMW,GAAQ0sB,UArKvD,OAqKYntB,EArKZ,OAsKayhB,EAAU3hB,KAAKshB,OAAfK,OAtKb,cAuKwBzhB,GAvKxB,IAuKQ,2BAASmkB,EAAY,QACjBrkB,KAAK06D,mBAAmBr2C,EAAK1C,GAxKzC,WAAA5M,EAAA,0CA0Ke7U,GA1Kf,oLA4KkBmU,EAAYu8B,EAAcnjC,GA5K5C,yEA6KmBhN,IAAPgN,GAA2B,IAAPA,EA7KhC,iEAgLqB,IAAI0tD,EAAcn7D,KAAM,CAACqU,IAAIA,EAAKu8B,MAAMA,EAAOnjC,GAAGA,IAAK4f,UAhL5E,0NAkLkBhZ,EAAYu8B,EAAcnjC,EAAWlM,GAlLvD,iFAsLqB,IAAI65D,EAAcp7D,KAAM,CAACqU,IAAIA,EAAKu8B,MAAMA,EAAOnjC,GAAGA,EAAIlM,MAAMA,IAAQ8rB,UAtLzF,2NAyLiBhZ,EAAYu8B,EAAcnjC,EAAW4tD,GAzLtD,iFA2LqB,IAAIC,EAAat7D,KAAM,CAACqU,IAAIA,EAAKu8B,MAAMA,EAAOnjC,GAAGA,EAAI4tD,MAAMA,IAAQhuC,UA3LxF,0SA8Le,IAAIkuC,EAAav7D,UAAMS,GAAW4sB,UA9LjD,2KA6D0B,YAAmB5sB,IAAZT,KAAKi6D,SA7DtC,GAA+BT,GAkMhBgC,E,qKACmB,OAAOx7D,KAAK2mB,Y,GADTH,KAM/Bi0C,E,4MACF35D,OAAS,M,mDACU,MAAM,QAAN,OAAed,KAAKymB,OAAO9e,KAA3B,YAAmC3H,KAAKW,Y,GAFvC66D,GAKlBhB,E,4KAKiB,OAAOx6D,KAAKW,OAAO2T,M,8BAC9B3H,GACJ,OAAQA,EAAeiR,MAAM,Q,2BANd,IACV06C,EAAWt4D,KAAKW,OAAhB23D,QACL,MAAM,WAAN,OAAkBt4D,KAAKymB,OAAO9e,KAA9B,iBAAkDlH,IAAZ63D,EAAsBA,EAAQ,S,GAHpDkD,GAYlBnqB,E,4KAEiB,IAAD,EACOrxC,KAAKymB,OAAOnF,OAA5BK,EADS,EACTA,OAAQhZ,EADC,EACDA,KADC,EAEI3I,KAAKW,OAAlB8M,EAFS,EAETA,GAAIlM,EAFK,EAELA,MACLZ,EAAa,CAAC86D,IAAKhuD,GAEvB,GADAzN,KAAK07D,YAAY/6D,EAAQY,EAAOogB,QACnBlhB,IAATkI,EAAoB,CAAC,IAAD,gBACJA,GADI,IACpB,2BAAsB,CAAC,IAAd0L,EAAa,QACdsO,EAAUtO,EAAI1M,KACdg0D,EAAY,GACZ/5C,EAAYvN,EAAIsN,OAChBg5C,EAAYp5D,EAAMohB,GACtB,QAAkBliB,IAAdk6D,EAAyB,CAAC,IAAD,gBACJA,GADI,IACzB,2BAAgC,CAAC,IAAxBiB,EAAuB,QACxBv3C,EAAM,GACVrkB,KAAK07D,YAAYr3C,EAAKu3C,EAAUh6C,GAChC+5C,EAAUv5D,KAAKiiB,IAJM,+BAO7B1jB,EAAOgiB,GAAWg5C,GAbF,+BAgBxB,OAAOh7D,I,kCAES6jB,EAAY7jB,EAAYghB,GACxC,QAAelhB,IAAXE,EAAJ,CADwD,oBAEtCghB,GAFsC,IAExD,2BAA0B,CAAC,IAAlB2B,EAAiB,QACjB3b,EAAoB2b,EAApB3b,KAAMsb,EAAcK,EAAdL,KAAMzgB,EAAQ8gB,EAAR9gB,KACbsa,EAAMnc,EAAOgH,GACjB,QAAalH,IAATwiB,EACmB,kBAARnG,GACK,OAARA,IAAcA,EAAMA,EAAIrP,SAIhC,OAAQjL,GACJ,IAAK,OACDsa,EAAM9c,KAAKymB,OAAOo1C,eAAe/+C,GAGjC,MACJ,IAAK,WACDA,EAAM9c,KAAKymB,OAAOlD,mBAAmBzG,GAOjD0H,EAAO7c,GAAQmV,GAzBqC,kC,2BAxBzC,MAAM,QAAN,OAAe9c,KAAKymB,OAAO9e,U,GADzB6zD,GAuDnBN,E,mKACiB,MAAM,SAAN,OAAgBl7D,KAAKymB,OAAO9e,U,GADxB6zD,GAIrBvoB,E,4MACFnyC,OAAS,M,mDACU,MAAM,YAAN,OAAmBd,KAAKymB,OAAO9e,U,GAF9B6zD,GAKlBL,E,4MACFr6D,OAAS,M,mDACU,IAAD,EACSd,KAAKW,OAAvB0T,EADS,EACTA,IAAKu8B,EADI,EACJA,MAAOnjC,EADH,EACGA,GACjB,MAAM,YAAN,OAAmBzN,KAAKymB,OAAO9e,KAA/B,YAAuCipC,EAAvC,YAAgDv8B,EAAhD,YAAuD5G,O,GAJnC+tD,GAOtBR,E,mKACiB,MAAM,aAAN,OAAoBh7D,KAAKymB,OAAO9e,KAAhC,S,GADM6zD,GAGvBJ,E,4KAKiB,IAAD,EACIp7D,KAAKW,OAAlB8M,EADS,EACTA,GAAIlM,EADK,EACLA,MACLZ,EAAS2P,IAAEgN,MAAM/b,GAErB,OADAZ,EAAM,IAAU8M,EACT9M,I,2BARQ,IAAD,EACKX,KAAKW,OAAnB0T,EADS,EACTA,IAAKu8B,EADI,EACJA,MACV,MAAM,YAAN,OAAmB5wC,KAAKymB,OAAO9e,KAA/B,YAAuCipC,EAAvC,YAAgDv8B,EAAhD,S,GAHoBmnD,GAYtBF,E,4KAKiB,IAAD,EACIt7D,KAAKW,OACvB,MAAO,CAAEm7D,IAFK,EACTruD,GACasuD,OAFJ,EACLV,S,2BALM,IAAD,EACKr7D,KAAKW,OAAnB0T,EADS,EACTA,IAAKu8B,EADI,EACJA,MACV,MAAM,gBAAN,OAAuB5wC,KAAKymB,OAAO9e,KAAnC,YAA2CipC,EAA3C,YAAoDv8B,EAApD,S,GAHmBmnD,GAUrBD,E,4KAKJ,IAAIhmD,EAAI,IAAI3Q,KAIN,MAAO,CAAC+yC,KAHHpiC,EAAEiO,cAGOi0B,MAFRliC,EAAEkO,WAAa,EAEAzQ,KADhBuC,EAAEmO,a,2BANP,MAAM,WAAN,OAAkB1jB,KAAKymB,OAAO9e,KAA9B,S,GAFmB6zD,GAadlsB,EAAb,kDAGI,WAAYppC,EAAUyB,EAAayZ,EAAevB,GAAmB,IAAD,8BAChE,cAAM3Z,EAAIyB,EAAMyZ,IAHZ82C,eAE4D,IAO3Dr4C,UAP2D,IAQpEk9B,UAAW,EANP,EAAKl9B,KAAOA,EAFoD,EAHxE,oDAQYq4C,GAAuBl4D,KAAKk4D,UAAYA,IARpD,4BAaUzqD,GAAYzN,KAAKk4D,UAAUU,MAAMnrD,KAb3C,4BAcUA,GAAkB,OAAOzN,KAAKk4D,UAAUzzC,MAAMhX,KAdxD,kCAegBA,GAAY,OAAOzN,KAAKk4D,UAAUpiC,YAAYroB,KAf9D,iCAgBYA,GACVzN,KAAKk4D,UAAUoC,WAAW7sD,KAjB5B,yEAmBuBA,GAnBvB,iFAoBczN,KAAKk4D,UAAUriC,UAAUpoB,GApBvC,gCAqBSzN,KAAKk4D,UAAUpiC,YAAYroB,IArBpC,iIAwBQ9F,GAAsB,OAAO3H,KAAKk4D,UAAU9mC,IAAIzpB,KAxBxD,wEAyBmB8F,GAzBnB,uFA0BwBzN,KAAKk4D,UAAU8D,SAASvuD,GA1BhD,cA0BYvN,EA1BZ,yBA2BeA,GA3Bf,2KA6BeuN,GA7Bf,iFA8BqBzN,KAAKk4D,UAAUr5B,KAAKpxB,GA9BzC,mNAgCeA,EAAWlM,GAhC1B,iFAiCqBvB,KAAKk4D,UAAU+D,KAAKxuD,EAAIlM,GAjC7C,yNAmCgBkM,EAAWiI,EAAa+B,GAnCxC,iFAoCQzX,KAAKk4D,UAAUgE,SAASzuD,EAAIiI,EAAM+B,GApC1C,iQAuCqBzX,KAAKk4D,UAAU9nC,MAvCpC,oNAyCiBzpB,EAAYohB,EAAyBC,GAzCtD,iFA0CqBhoB,KAAKk4D,UAAUiE,OAAOx1D,EAAKohB,EAAWC,GA1C3D,4NA4CoB4oB,EAAcjqC,EAAYohB,EAAyBC,GA5CvE,iFA6CqBhoB,KAAKk4D,UAAU+C,UAAUrqB,EAAOjqC,EAAKohB,EAAWC,GA7CrE,4NA+CkB3T,EAAYu8B,EAAcnjC,GA/C5C,iFAgDqBzN,KAAKk4D,UAAUkE,QAAQ/nD,EAAKu8B,EAAOnjC,GAhDxD,0NAkDkB4G,EAAYu8B,EAAcnjC,EAAWlM,GAlDvD,iFAmDcvB,KAAKk4D,UAAUmE,QAAQhoD,EAAKu8B,EAAOnjC,EAAIlM,GAnDrD,mLAqDiB8S,EAAYu8B,EAAcnjC,EAAW4tD,GArDtD,iFAsDcr7D,KAAKk4D,UAAUoE,OAAOjoD,EAAKu8B,EAAOnjC,EAAI4tD,GAtDpD,kQAyDer7D,KAAKk4D,UAAU7/C,KAzD9B,2KAuB0B,OAAOrY,KAAKk4D,UAAUqE,WAvBhD,GAAgC/C,GA+DnBK,EAAb,WAGI,WAAY52C,GAAa,yBAFzBA,UAEwB,OADxB4tB,gBAAmBpwC,EAEfT,KAAKijB,KAAOA,EAJpB,kDAOUxV,GACF,OAAOzN,KAAKijB,KAAKwB,MAAMhX,KAR/B,mCAUiBgI,GACT,OAAOzV,KAAKijB,KAAKW,aAAanO,KAXtC,4BAaUhI,GACF,OAAOzN,KAAKijB,KAAK21C,MAAMnrD,KAd/B,2IAiBQyC,MAAM,4BAjBd,wGAsBamqD,EAAb,kDAUI,WAAYn0D,EAAW+c,EAAiBtb,GAAe,IAAD,8BAClD,cAAMzB,EAAIyB,EAAM,IAVX+xD,SAAkB,MAS2B,EAR5CQ,iBAQ4C,IAP5Cj3C,UAO4C,IAN5C02C,YAM4C,IAL5CQ,aAK4C,EAElD,EAAKl3C,KAAOA,EACZ,EAAK02C,OAAS,KACd,EAAKQ,QAAU,IAAIZ,EAAWt2C,EAAf,gBAJmC,EAV1D,8DAiCQ,wEADc,IAETytB,EAAc1wC,KAAKshB,OAAnBovB,WAEL1wC,KAAKkG,GAAGsc,eAAexiB,KAAKk6D,YAAcxpB,KApClD,sCAuCoBG,GACZ,OAAO,IAAI2rB,EAAWx8D,KAAKijB,KAAMjjB,KAAM6wC,KAxC/C,mCA2CiBp7B,GAAiB,OAAOA,EAAIzV,KAAK25D,UA3ClD,iCA4CeliD,GACPzX,KAAKm6D,QAAQnB,WAAWvhD,KA7ChC,4BAgDUhK,EAAWyhC,IACQ,IAAjBlvC,KAAKy5D,SACTz5D,KAAKm6D,QAAQvB,MAAMnrD,EAAIyhC,KAlD/B,kCA6DgBzhC,GACR,OAAOzN,KAAKm6D,QAAQjgB,SAASzsC,KA9DrC,yEAiEuBA,GAjEvB,iFAkEQzN,KAAKm6D,QAAQI,UAAU9sD,GAlE/B,gCAmESzN,KAAKm6D,QAAQjgB,SAASzsC,IAnE/B,kQAuEczN,KAAKm6D,QAAQrf,WAvE3B,iJA0EyBt2B,GACjB,IAAI7C,EAAS3hB,KAAKshB,OAAOK,OACzB3hB,KAAK06D,mBAAmBl2C,EAAQ7C,KA5ExC,oCA+EkB6C,GACV,OAAOxkB,KAAK+6D,sBAAsBv2C,EAAQxkB,KAAKk6D,eAhFvD,4BAiBiB,OAAOl6D,KAAKijB,SAjB7B,GAA6BssB,GAoFhBitB,EAAb,kDAGI,WAAYv5C,EAAYmO,EAAcyf,GAAoB,IAAD,8BACrD,cAAM5tB,IAHV4tB,gBAEyD,IADjDzf,SACiD,EAErD,EAAKA,IAAMA,EACX,EAAKyf,WAAaA,EAHmC,EAH7D,kDASUpjC,GACF,OAAOzN,KAAKoxB,IAAI3M,MAAMhX,KAV9B,mCAYiBgI,GACT,OAAOzV,KAAKoxB,IAAIxN,aAAanO,KAbrC,4BAeUhI,GACF,OAAOzN,KAAKoxB,IAAIwnC,MAAMnrD,OAhB9B,GAAgCosD,I,6WChZnB4C,EAAU,I,oNAlLArrB,G,iFACFpxC,KAAKC,IAAI,qBAAsB,CAACmxC,IAAIA,I,0SAGpCpxC,KAAKC,IAAI,cAAe,CAACuE,MAAM,EAAGwjB,SAAS,K,qSAI3ChoB,KAAKC,IAAI,WAAY,CAACuE,MAAM,EAAGwjB,SAAS,K,kNAG9CznB,G,iFACMP,KAAKC,IAAI,WAAY,CAACM,KAAKA,I,qNAG/BA,EAAa6wC,EAAY3zB,G,iFACrBzd,KAAKC,IAAI,cAAe,CAACM,KAAKA,EAAM6wC,IAAIA,EAAK3zB,QAAQA,I,yNAGzD9V,G,iFACI3H,KAAKC,IAAI,cAAe,CAAC0H,KAAKA,I,mNAGpC8F,G,iFACMzN,KAAKC,IAAI,WAAY,CAACwN,GAAGA,I,gTAIzBzN,KAAKC,IAAI,uBAAwB,I,yNAGhCy8D,EAAel6D,EAAasI,G,8EACrCvK,EAAQyO,aAARzO,KACU,E,SACFP,KAAKwoB,KAAK,mBAAoB,CACvChmB,KAAMA,EACNm6D,SAAUp8D,EACVq8D,QAJW,EAKXF,OAAQA,EACR5xD,QAASA,I,uNAINvK,G,iFACMP,KAAKC,IAAI,QAAS,CAACM,KAAKA,I,8NAGnBA,G,iFACLP,KAAKC,IAAI,oBAAqB,CAACM,KAAKA,I,yNAGpCA,G,iFACAP,KAAKC,IAAI,cAAe,CAACM,KAAKA,I,4NAG3BA,EAAa6wC,G,iFAChBpxC,KAAKC,IAAI,kBAAmB,CAACM,KAAKA,EAAM6wC,IAAIA,I,6NAG1CyrB,EAAet8D,EAAau8D,EAAgBC,EAAgB5mD,G,iFAC9DnW,KAAKwoB,KAAK,iBAAkB,CAACq0C,OAAOA,EAAQt8D,KAAKA,EAAMu8D,QAAQA,EAASC,QAAQA,EAAS5mD,MAAMA,I,mOAG7FxM,EAAapJ,EAAau8D,EAAgBC,EAAgB5mD,G,iFAC5DnW,KAAKwoB,KAAK,iBAAkB,CAAC7e,KAAKA,EAAMpJ,KAAKA,EAAMu8D,QAAQA,EAASC,QAAQA,EAAS5mD,U,mOAGnF5V,EAAaoJ,G,iFACf3J,KAAKwoB,KAAK,iBAAkB,CAAC7e,KAAKA,EAAMpJ,KAAKA,I,0NAG9CA,G,iFACCP,KAAKC,IAAI,kBAAmB,CAACM,KAAKA,I,qNAGtCA,EAAay8D,G,iFACTh9D,KAAKwoB,KAAK,eAAgB,CAACjoB,KAAKA,EAAMy8D,IAAIA,I,uNAG9Cz8D,EAAay8D,G,iFACTh9D,KAAKwoB,KAAK,eAAgB,CAACjoB,KAAKA,EAAMy8D,IAAIA,I,yNAG5Cz8D,G,iFACEP,KAAKC,IAAI,YAAa,CAACM,KAAKA,I,yNAG5BA,EAAa6wC,G,uFACVpxC,KAAKwoB,KAAK,eAAgB,CAACjoB,KAAKA,EAAM6wC,IAAIA,I,cAAtDlxC,E,yBACGA,G,sLAGSK,EAAa6wC,EAAY6rB,G,iFACnCj9D,KAAKwoB,KAAK,kBAAmB,CAACjoB,KAAKA,EAAM6wC,IAAIA,EAAK6rB,QAAQA,I,yLAG/C18D,EAAamV,EAAa+B,G,iFACrCzX,KAAKwoB,KAAK,mBAAoB,CAACjoB,KAAKA,EAAMmV,KAAKA,EAAM+B,MAAMA,I,oLAGrDlX,EAAaoG,EAAYohB,EAAeC,G,iFACvChoB,KAAKC,IAAI,kBAAmB,CAACM,KAAKA,EAAMoG,IAAIA,EAAKohB,UAAUA,EAAWC,SAASA,I,8NAGhFznB,G,iFACCP,KAAKC,IAAI,aAAc,CAACM,KAAKA,I,0NAG5BA,EAAaoH,EAAawpC,G,iFAC3BnxC,KAAKwoB,KAAK,gBAAiB,CAACjoB,KAAKA,EAAMoH,KAAKA,EAAMwpC,YAAYA,I,qOAGtD5wC,EAAao4B,EAAajjB,EAAa+B,G,iFACtDzX,KAAKwoB,KAAK,wBAAyB,CAACjoB,KAAKA,EAAMo4B,KAAKA,EAAMjjB,KAAKA,EAAM+B,MAAMA,I,yLAGlElX,EAAao4B,G,iFACf34B,KAAKC,IAAI,iBAAkB,CAACM,KAAKA,EAAMo4B,KAAKA,I,gOAGvCp4B,EAAao4B,EAAaukC,G,iFACtCl9D,KAAKwoB,KAAK,qBAAsB,CAACjoB,KAAKA,EAAMo4B,KAAKA,EAAMukC,KAAKA,I,sLAGpD38D,EAAao4B,EAAahyB,EAAYohB,EAAkBC,G,iFACzDhoB,KAAKC,IAAI,eAAgB,CAACM,KAAKA,EAAMo4B,KAAKA,EAAMhyB,MAAKohB,YAAWC,a,uOAG1DznB,EAAa48D,EAAeC,G,iFACzCp9D,KAAKwoB,KAAK,qBAAsB,CAACjoB,KAAKA,EAAM48D,OAAOA,EAAQC,SAASA,I,0LAGxD78D,EAAa48D,G,iFAClBn9D,KAAKC,IAAI,oBAAqB,CAACM,KAAKA,EAAM48D,OAAOA,I,mOAGzC58D,EAAa48D,EAAejL,G,iFAC3ClyD,KAAKwoB,KAAK,wBAAyB,CAACjoB,KAAKA,EAAM48D,OAAOA,EAAQjL,MAAMA,I,oLAG9D3xD,EAAaoG,EAAYohB,EAAkBC,G,iFAC1ChoB,KAAKC,IAAI,aAAc,CAACM,KAAMA,EAAMoG,IAAIA,EAAKohB,UAAUA,EAAWC,SAASA,I,iOAEzEznB,EAAaoG,EAAYohB,EAAkBC,G,iFAC7ChoB,KAAKC,IAAI,iBAAkB,CAACM,KAAMA,EAAMoG,IAAIA,EAAKohB,UAAUA,EAAWC,SAASA,I,oOAE1EznB,EAAa6wC,EAAYrpB,EAAkBC,G,iFAChDhoB,KAAKC,IAAI,qBAAsB,CAACM,KAAMA,EAAM6wC,IAAIA,EAAKrpB,UAAUA,EAAWC,SAASA,I,oOAE9EznB,EAAaoJ,EAAaoe,EAAkBC,G,iFACjDhoB,KAAKC,IAAI,qBAAsB,CAACM,KAAMA,EAAMoJ,KAAKA,EAAMoe,UAAUA,EAAWC,SAASA,I,qOAE/EznB,EAAa6wC,EAAYzqC,EAAYohB,EAAkBC,G,iFAC7DhoB,KAAKC,IAAI,sBAAuB,CAACM,KAAMA,EAAM6wC,IAAIA,EAAKzqC,IAAIA,EAAKohB,UAAUA,EAAWC,SAASA,I,uOAEvFznB,EAAaoJ,EAAahD,EAAYohB,EAAkBC,G,iFAC9DhoB,KAAKC,IAAI,sBAAuB,CAACM,KAAMA,EAAMoJ,KAAKA,EAAMhD,IAAIA,EAAKohB,UAAUA,EAAWC,SAASA,I,kOAE9FznB,EAAa6wC,EAAYznC,EAAautB,G,iFAC9Cl3B,KAAKwoB,KAAK,qBAAsB,CAACjoB,KAAMA,EAAM6wC,IAAIA,EAAKznC,KAAKA,EAAMutB,KAAKA,I,wLAG9DvwB,G,iFACD3G,KAAKC,IAAI,oBAAqB,CAAC0G,IAAIA,I,0NAElCpG,EAAaoJ,G,iFACrB3J,KAAKwoB,KAAK,gBAAiB,CAACjoB,KAAKA,EAAMoJ,KAAKA,I,oLAGpCpJ,EAAa6wC,EAAYznC,EAAahC,EAAao1D,G,iFACpD/8D,KAAKwoB,KAAK,qBAAsB,CAACjoB,KAAKA,EAAM6wC,IAAIA,EAAKznC,KAAKA,EAAMhC,KAAKA,EAAMo1D,QAAQA,I,kOAGlFx8D,EAAa6wC,EAAYznC,EAAahC,EAAauqD,G,iFACpDlyD,KAAKwoB,KAAK,qBAAsB,CAACjoB,KAAKA,EAAM6wC,IAAIA,EAAKznC,KAAKA,EAAMhC,KAAKA,EAAMuqD,MAAMA,I,4JA/KhF1xD,iBAmLC,CAAY,OAAO,GClE7B68D,EAAS,I,oNAhHCjsB,G,iFACFpxC,KAAKC,IAAI,qBAAsB,CAACmxC,IAAIA,I,oTAGjCpxC,KAAKC,IAAI,sBAAkBQ,G,cAAvCP,E,yBACGA,G,4KAEEK,G,iFACIP,KAAKC,IAAI,SAAU,CAACM,KAAKA,I,kNAEhCkN,G,iFACOzN,KAAKC,IAAI,MAAO,CAACwN,GAAGA,I,kNAE3BA,G,iFACOzN,KAAKC,IAAI,MAAO,CAACwN,GAAGA,I,iNAE5BA,G,iFACQzN,KAAKC,IAAI,KAAM,CAACwN,GAAGA,I,qNAEvBA,G,iFACIzN,KAAKC,IAAI,SAAU,CAACwN,GAAGA,I,mNAE7BlN,G,0FAAaynB,E,+BAAgB,G,SACvBhoB,KAAKC,IAAI,OAAQ,CAACM,KAAKA,EAAMynB,SAAUA,I,kNAE9CznB,G,0FAAaynB,E,+BAAgB,G,SACtBhoB,KAAKC,IAAI,MAAO,CAACM,KAAKA,EAAMynB,SAAUA,I,oNAE3CznB,G,0FAAaynB,E,+BAAgB,G,SACxBhoB,KAAKC,IAAI,QAAS,CAACM,KAAKA,EAAMynB,SAAUA,I,sNAE3CznB,G,0FAAaynB,E,+BAAgB,G,SAC1BhoB,KAAKC,IAAI,UAAW,CAACM,KAAKA,EAAMynB,SAAUA,I,uNAE5CznB,G,0FAAaynB,E,+BAAgB,G,SAC3BhoB,KAAKC,IAAI,WAAY,CAACM,KAAKA,EAAMynB,SAAUA,I,sNAE9CxD,G,iFACGxkB,KAAKwoB,KAAK,WAAYhE,G,qNAE1BA,G,iFACIxkB,KAAKwoB,KAAK,UAAWhE,G,sNAExBA,G,iFACGxkB,KAAKwoB,KAAK,WAAYhE,G,yNAEtBA,G,iFACAxkB,KAAKwoB,KAAK,cAAehE,G,0NAExBA,G,iFACDxkB,KAAKwoB,KAAK,eAAgBhE,G,qNAE9BjkB,EAAYkN,G,iFACRzN,KAAKwoB,KAAK,UAAW,CAACjoB,KAAKA,EAAMkN,GAAGA,I,sNAEzClN,EAAYkN,G,iFACPzN,KAAKwoB,KAAK,SAAU,CAACjoB,KAAKA,EAAMkN,GAAGA,I,uNAEvClN,EAAYkN,G,iFACRzN,KAAKwoB,KAAK,UAAW,CAACjoB,KAAKA,EAAMkN,GAAGA,I,0NAErClN,EAAYkN,G,iFACXzN,KAAKwoB,KAAK,aAAc,CAACjoB,KAAKA,EAAMkN,GAAGA,I,wNAE1ClN,EAAYkN,G,iFACTzN,KAAKwoB,KAAK,WAAY,CAACjoB,KAAKA,EAAMkN,GAAGA,I,2NAErClN,EAAYkN,G,iFACZzN,KAAKwoB,KAAK,cAAe,CAACjoB,KAAKA,EAAMkN,GAAGA,I,2NAExC2jC,G,iFACApxC,KAAKC,IAAI,UAAW,CAACmxC,IAAKA,I,wNAE3B7wC,EAAY6wC,EAAWzlB,G,8EAC/B2xC,EAAU3xC,EAAIvH,KAAK,K,SACjBpkB,KAAKwoB,KAAK,cAAe,CAACjoB,KAAKA,EAAM6wC,IAAIA,EAAKzlB,IAAI2xC,I,uLAEzC/8D,EAAa6wC,EAAYlrC,G,iFAClClG,KAAKwoB,KAAK,kBAAmB,CAACjoB,KAAKA,EAAM6wC,IAAIA,EAAKlrC,GAAGA,I,mLAEhD3F,EAAYoG,EAAWohB,EAAiBC,G,iFACtChoB,KAAKC,IAAI,YAAa,CAACM,KAAKA,EAAMoG,IAAIA,EAAKohB,UAAUA,EAAWC,SAASA,I,6NAE3EznB,G,iFACEP,KAAKC,IAAI,SAAU,CAACM,KAAKA,I,wNAE1BA,EAAYoG,EAAWohB,EAAiBC,G,iFACvChoB,KAAKC,IAAI,aAAc,CAACM,KAAKA,EAAMoG,IAAIA,EAAKohB,UAAUA,EAAWC,SAASA,I,iOAExEznB,EAAYoG,EAAWohB,EAAiBC,G,iFAC1ChoB,KAAKC,IAAI,gBAAiB,CAACM,KAAKA,EAAMoG,IAAIA,EAAKohB,UAAUA,EAAWC,SAASA,I,+NAE7EznB,EAAYoG,EAAWohB,EAAiBC,G,iFACxChoB,KAAKC,IAAI,cAAe,CAACM,KAAKA,EAAMoG,IAAIA,EAAKohB,UAAUA,EAAWC,SAASA,I,mOAEvEznB,EAAa2F,G,iFACjBlG,KAAKC,IAAI,cAAe,CAACM,KAAKA,EAAM2F,GAAGA,I,kOAEhC3F,EAAag9D,EAAgB7nD,EAAa+B,G,iFACjDzX,KAAKwoB,KAAK,sBAAuB,CAACjoB,KAAKA,EAAMg9D,QAAQA,EAAS7nD,KAAKA,EAAM+B,MAAMA,I,kOAE5ElX,EAAa2F,G,iFAChBlG,KAAKC,IAAI,kBAAmB,CAACM,KAAKA,EAAM2F,GAAGA,I,4NAE1CmR,G,iFACRrX,KAAKwoB,KAAK,gBAAiBnR,G,kLAEnBA,G,iFACRrX,KAAKwoB,KAAK,gBAAiBnR,G,4GA7GpB7W,iBAiHC,CAAW,WAAW,GC/GtCg9D,E,gNACuBlpD,G,oQAGD7G,G,iFACPgvD,EAAQl8D,KAAKkN,G,+IALT0G,YASnBspD,E,gNACuBnpD,G,oQAGD7G,G,iFACP4vD,EAAOn3D,GAAGuH,G,+IALR0G,YASjBupD,E,gNACuBppD,G,oQAGD7G,G,iFACP4vD,EAAOjsB,IAAI3jC,G,+IALR0G,YASlBwpD,E,gNACuBrpD,G,oQAGD7G,G,uFACJ4vD,EAAOO,IAAInwD,G,cAAvBvN,E,yBACGA,G,uGANUiU,YAUnB0pD,E,gNACuBvpD,G,oQAGD7G,G,uFACJgvD,EAAQ9yD,KAAK8D,G,cAAzBvN,E,yBACGA,G,uGANUiU,YAUnB2pD,E,gNACuBxpD,G,oQAGD7G,G,iFACP4vD,EAAOU,OAAOtwD,G,+IALR0G,YA+BdogB,EAAgB,I,WAdzB,aAAe,yBAPfwU,WAOc,OANdpd,SAMc,OALduxC,UAKc,OAJdc,WAIc,OAHdC,aAGc,OAFdC,WAEc,EACVl+D,KAAKo+B,Q,oDAILp+B,KAAK+oC,MAAQ,IAAIy0B,EACjBx9D,KAAK2rB,IAAM,IAAI8xC,EACfz9D,KAAKk9D,KAAO,IAAIQ,EAChB19D,KAAKg+D,MAAQ,IAAIL,EACjB39D,KAAKi+D,QAAU,IAAIH,EACnB99D,KAAKk+D,MAAQ,IAAIL,M,sEC/DHM,GAAtB,aAGI,WAAYC,EAAapB,GAAU,yBAFzBoB,WAEwB,OADxBpB,SACwB,kEAC9Bh9D,KAAKo+D,MAAQA,EACbp+D,KAAKg9D,IAAMA,EALnB,mLAYyBh9D,KAAKq+D,QAZ9B,OAYan+D,EAZb,OAaSF,KAAK4U,MAAQ1U,EAbtB,6KAgBkB4G,GAhBlB,gFAiBY0d,EAAa,QACA/jB,IAAbT,KAAKs+D,IACLhuD,IAAEsnB,OAAOpT,EAAQxkB,KAAKs+D,IAAKx3D,GAG3BwJ,IAAEsnB,OAAOpT,EAAQ1d,GAGrB0d,EAAOjkB,KAAOuG,EAAKvG,KAAOP,KAAKo+D,MAAM79D,KAAKkN,GAzBlD,SA0BuBzN,KAAKu+D,MAAM/5C,GA1BlC,UA0BY/W,EA1BZ,YA2ByBhN,IAAbT,KAAKs+D,IA3BjB,oBA4BuB,IAAP7wD,EA5BhB,0CA4BiC,GA5BjC,OA6BY+W,EAAO/W,GAAKA,OACOhN,IAAfT,KAAK4U,OAAqB5U,KAAK4U,MAAMqgB,QAAQzQ,GACjDxkB,KAAKw+D,OACLx+D,KAAKs+D,IAAMpqD,YAAWsQ,GAhClC,wBAmCYlU,IAAEsnB,OAAO53B,KAAKs+D,IAAK95C,GAnC/B,kCAqCe,GArCf,6KAuCgB1d,GAvChB,2FAwCe,GAxCf,sKA0CeA,GA1Cf,gFA2CY0d,EAAa,GACjBlU,IAAEsnB,OAAOpT,EAAQ1d,GAEjB0d,EAAOjkB,KAAOuG,EAAKvG,KAAOP,KAAKo+D,MAAM79D,KAAKkN,GA9ClD,SA+CuBzN,KAAKu+D,MAAM/5C,GA/ClC,UAgDmB,KADP/W,EA/CZ,gEAiDQ+W,EAAO/W,GAAKA,EAjDpB,kBAkDe+W,GAlDf,gQAuDkB/jB,KADNokB,EAAI7kB,KAAKs+D,KAtDrB,wDAwDY7wD,EAAKoX,EAAEpX,GAxDnB,SAyDczN,KAAKy+D,KAAK55C,GAzDxB,eA0D2BpkB,IAAfT,KAAK4U,MA1DjB,kDA2DY/M,EAAQ7H,KAAK4U,MAAMob,WAAU,SAAA3oB,GAAC,OAAIA,EAAEoG,KAAOA,OACpC,IACPzN,KAAK4U,MAAMsgB,OAAOrtB,EAAO,GACzB7H,KAAK0+D,QA9DjB,iJAQKxqD,KARL,uGASKA,KATL,yEAsEMyqD,G,idAKetB,EAAOH,KAAKl9D,KAAKo+D,MAAM79D,KAAKkN,I,mNAEvB3G,G,iFACLu2D,EAAOuB,QAAQ93D,G,8MAEXA,G,iFACXu2D,EAAOwB,OAAO7+D,KAAKo+D,MAAM79D,KAAKkN,GAAI3G,EAAK2G,I,oIAE9BzN,KAAKg9D,IAAI8B,OAAO1tB,Q,6BAChBpxC,KAAKg9D,IAAI8B,OAAO1tB,Q,mKAGfisB,EAAO3xC,WAAW1rB,KAAKs+D,IAAI7wD,I,OAAvCvN,E,OACJF,KAAK2rB,IAAMzrB,E,8KAEOyG,G,iFACO02D,EAAO0B,SAAS/+D,KAAKo+D,MAAM79D,KAAKkN,GAAI9G,EAAK,EAAGq4D,I,OAArEh/D,KAAKi/D,Y,mHArBMd,G,iCACdjqD,K,+GACAA,K,yEAsDCgrD,E,sSAEkB7B,EAAO1xC,IAAI3rB,KAAKo+D,MAAM79D,KAAKkN,I,cAAvCvN,E,yBACGA,G,2KAEW4G,G,iFAKLu2D,EAAO8B,OAAOr4D,G,8MAEVA,G,iFACXu2D,EAAO+B,MAAMp/D,KAAKo+D,MAAM79D,KAAKkN,GAAI3G,EAAK2G,I,oIAE7BzN,KAAKg9D,IAAI8B,OAAO54D,O,6BAChBlG,KAAKg9D,IAAI8B,OAAO54D,S,GAhBrBi4D,GAmBZkB,E,sSAEkBhC,EAAOW,MAAMh+D,KAAKo+D,MAAM79D,KAAKkN,I,cAAzCvN,E,yBACGA,G,2KAEW4G,G,iFACLu2D,EAAOiC,QAAQx4D,G,8MAEXA,G,iFACXu2D,EAAOkC,OAAOv/D,KAAKo+D,MAAM79D,KAAKkN,GAAI3G,EAAK2G,I,oIAE9BzN,KAAKg9D,IAAI8B,OAAOlB,Q,6BAChB59D,KAAKg9D,IAAI8B,OAAOlB,Q,qEACvB92D,G,6EACHwa,EAAUxa,EAAVwa,O,SAEGs8C,EAAM1wD,KAAKC,MAAMmU,G,cACPs8C,G,iDAALz7D,E,WAEQ,QADT2f,EAAO87C,EAAIz7D,UACe1B,IAATqhB,E,wBACjB5R,MAAM,QAAD,OAAS/N,EAAT,iD,mBACE,G,oBAEI2f,E,OACN,a,QAIA,Y,MACA,W,MACA,W,gCALD5R,MAAM,QAAD,OAAS/N,EAAT,iD,mBACE,G,eAKP+N,MAAM,QAAD,OAAS/N,EAAT,4D,mBACE,G,YAEa,IAAxBikB,MAAMC,QAAQvE,G,qBACkB,IAA5B09C,EAAa19C,EAAM87C,G,2CAAuB,G,oCAGb,IAA7B6B,EAAc39C,EAAM87C,G,2CAAuB,G,yDAGhD,G,yCAGP1tD,MAAM,KAAItN,S,mBACH,G,sHA7CCu7D,GAmDduB,EAAQ,UADK,CAAC,KAAM,SAAU,UACtB,CAAmB,UACjC,SAASC,EAAUC,EAAiBhC,GAChC,IAAI97C,EAAO87C,EAAIgC,GACf,YAAan/D,IAATqhB,GACA5R,MAAM,QAAD,OAAS0vD,EAAT,kBACE,IAEiB,IAAxBx5C,MAAMC,QAAQvE,IACd5R,MAAM,QAAD,OAAS0vD,EAAT,sCACE,GAEJC,EAAW/9C,EAAe87C,GAGrC,SAASiC,EAAWjrD,EAAagpD,GAAkB,IAAD,gBAC7BhpD,GAD6B,IAC9C,2BAAwB,CAAC,IAChBpS,EADe,QACfA,KACL,GAAI,CAAC,KAAM,SAAU,SAAU,SAAS6Q,QAAQ7Q,GAAQ,EAEpD,OADA0N,MAAM,QAAD,OAAS1N,EAAT,iDACE,GAL+B,8BAQ9C,OAAO,EAGX,SAASg9D,EAAa19C,EAAa87C,GAC/B,IAAK97C,GAAwB,kBAATA,EAEhB,OADA5R,MAAM,gBACC,EAHqC,oBAK9B4R,GAL8B,IAKhD,2BAAwB,CAAC,IAAhBwB,EAAe,QACf9gB,EAAQ8gB,EAAR9gB,KACL,QAAa/B,IAAT+B,EAEA,OADA0N,MAAM,qBACC,EAEN,GAAa,UAAT1N,IAE0B,IAA3Bm9D,EADWr8C,EAAV3B,OACiBi8C,GAClB,OAAO,EAGf,GAAI8B,EAASrsD,QAAQ7Q,GAAQ,EAOzB,MANa,SAATA,EACA0N,MAAM,iHAGNA,MAAM,8CAAD,OAAY1N,KAEd,GAxBiC,8BA2BhD,OAAO,EAGX,SAASi9D,EAAc39C,EAAW87C,GAC9B,IAAK,IAAIz7D,KAAK2f,EAAM,CAChB,IAAIhb,EAAOgb,EAAK3f,GAChB,OAAQA,GACJ,QAEI,OADA+N,MAAM/N,EAAI,gCACH,EACX,IAAK,QACD,IAAsC,IAAlC29D,EAAmBh5D,EAAM82D,GAAgB,OAAO,EACpD,MACJ,IAAK,UACD,IAAI/7C,EAAU/a,EACd,GAAoB,kBAATA,QAESrG,KADhBohB,EAAU+7C,EAAI92D,IAGV,OADAoJ,MAAMpJ,EAAO,oBACN,EAGf,IAAmC,IAA/B04D,EAAa39C,EAAS+7C,GAAgB,OAAO,GAI7D,OAAO,EAGX,SAASkC,EAAmBzoD,EAAYumD,GACpC,GAAc,OAAVvmD,QAA4B5W,IAAV4W,EAAtB,CACA,cAAeA,GACX,IAAK,SACD,OAAOsoD,EAAUtoD,EAAOumD,GAC5B,QACI,GAAIx3C,MAAMC,QAAQhP,GACd,OAAOwoD,EAAWxoD,GAK9B,OADAnH,MAAM,iDACC,G,uCAGL6vD,G,gSAEe1C,EAAOY,QAAQj+D,KAAKo+D,MAAM79D,KAAKkN,I,mNAE1B3G,G,iFACLu2D,EAAO2C,WAAWl5D,G,8MAEdA,G,iFACXu2D,EAAO4C,UAAUjgE,KAAKo+D,MAAM79D,KAAKkN,GAAI3G,EAAK2G,I,oIAEjCzN,KAAKg9D,IAAI8B,OAAOf,W,6BAChB/9D,KAAKg9D,IAAI8B,OAAOf,a,GAXjBI,GAahB+B,G,gSAEe7C,EAAO8C,SAASngE,KAAKo+D,MAAM79D,KAAKkN,I,mNAE3B3G,G,iFACLu2D,EAAO+C,YAAYt5D,G,8MAEfA,G,iFACXu2D,EAAOgD,WAAWrgE,KAAKo+D,MAAM79D,KAAKkN,GAAI3G,EAAK2G,I,oIAElCzN,KAAKg9D,IAAI8B,OAAOvB,Y,6BAChBv9D,KAAKg9D,IAAI8B,OAAOvB,Y,0EAClB7nD,EAAa+B,G,uFACV4lD,EAAOiD,kBAAkBtgE,KAAKo+D,MAAM79D,KAAKkN,GAAIzN,KAAKs+D,IAAI7wD,GAAIiI,EAAM+B,G,OAA5EvX,E,YACIwV,E,OACC,Q,OACA,Y,OACA,W,QACA,O,+BAHO1V,KAAKs+D,IAAI58D,IAAM+V,E,mCACXzX,KAAKs+D,IAAIngD,QAAU1G,E,oCACpBzX,KAAKs+D,IAAIP,OAAStmD,E,oCACtBzX,KAAKs+D,IAAI5gD,GAAKjG,E,sDAItBvX,G,wLAEUgG,G,uFACDm3D,EAAOkD,eAAevgE,KAAKo+D,MAAM79D,KAAKkN,GAAIvH,G,OAAtDhG,E,OACJF,KAAK4U,MAAQ1U,EAAI,G,4GA1BFi+D,GA8BjBa,GAAiB,GAEjBwB,I,aAKF,WAAYpC,EAAapB,EAASb,GAAgB,yBAJ1CiC,WAIyC,OAHzCpB,SAGyC,OAFzCb,YAEyC,wCAOjDh+B,WAAqB,EAP4B,KAQzCx3B,SARyC,OASzCohB,UAAY,EARhB/nB,KAAKo+D,MAAQA,EACbp+D,KAAKg9D,IAAMA,EACXh9D,KAAKm8D,OAASA,E,2FAQNx1D,G,wEACR3G,KAAK2G,IAAMA,EACX3G,KAAK4U,WAAQnU,EACbT,KAAKm+B,WAAY,EACjBn+B,KAAK+nB,UAAY,E,SACX/nB,KAAK6sB,O,4PAIY,IAAnB7sB,KAAKm+B,U,iEACOn+B,KAAKm8D,OAAOn8D,KAAKo+D,MAAM79D,KAAKkN,GAAIzN,KAAK2G,IAAK3G,KAAK+nB,UAAWi3C,I,OAAtE9+D,E,QACA+E,EAAM/E,EAAI8E,QACJg6D,IACNh/D,KAAKm+B,WAAY,IACfl5B,EACF/E,EAAIg1B,OAAOjwB,EAAK,IAGhBjF,KAAKm+B,WAAY,EAEjBl5B,EAAM,GACNjF,KAAK+nB,UAAY7nB,EAAI+E,EAAI,GAAGwI,QACThN,IAAfT,KAAK4U,MACL5U,KAAK4U,MAAQ1U,GAEb,EAAAF,KAAK4U,OAAMxS,KAAX,oBAAmBlC,KAGvBF,KAAK4U,MAAQ,G,gJAjCpBV,K,yEAsCQusD,IAAb,aAEI,WAAYrC,GAAc,yBADlBA,WACiB,yCAczBlB,UAAYz8D,EAda,KAezBkrB,SAAUlrB,EAfe,KAgBzBu9D,WAAcv9D,EAhBW,KAiBzBw9D,aAAkBx9D,EAjBO,KAmBzB0/D,cAAoB1/D,EAnBK,KAqBzBigE,eAAgCjgE,EArBP,KAsBzBs+D,cAA8Bt+D,EAtBL,KAuBzBkgE,kBAAsClgE,EAtBlCT,KAAKo+D,MAAQA,EACbp+D,KAAKk9D,KAAO,IAAIyB,EAAKP,EAAOp+D,MAC5BA,KAAK2rB,IAAM,IAAIuzC,EAAId,EAAOp+D,MAC1BA,KAAKg+D,MAAQ,IAAIqB,EAAMjB,EAAOp+D,MAC9BA,KAAKi+D,QAAU,IAAI8B,GAAQ3B,EAAOp+D,MAElCA,KAAKmgE,SAAW,IAAID,GAAS9B,EAAOp+D,MACpCA,KAAK0gE,UAAY,IAAIF,GAAoBpC,EAAOp+D,KAAMq9D,EAAOqD,UAAUxpC,KAAKmmC,IAC5Er9D,KAAK++D,SAAW,IAAIyB,GAAmBpC,EAAOp+D,KAAMq9D,EAAO0B,SAAS7nC,KAAKmmC,IACzEr9D,KAAK2gE,aAAe,IAAIH,GAAuBpC,EAAOp+D,KAAMq9D,EAAOsD,aAAazpC,KAAKmmC,IAZ7F,gLA6Ba98D,EAAQP,KAAKo+D,MAAb79D,KA7Bb,SA8B4B88D,EAAOyB,OAAOv+D,EAAKkN,IA9B/C,OA8BQzN,KAAK8+D,OA9Bb,wJAeK5qD,KAfL,yECpNakqD,GAAQ,IAtLrB,mDAEIpB,SAFJ,OAGI4D,cAHJ,8XAgBQ5gE,KAAKO,UAAOE,EACZT,KAAKk9D,UAAOz8D,EAEZT,KAAKg9D,IAAM,IAAIyD,GAAIzgE,QAnB3B,+BAwBQgP,aAAWZ,UAAO3N,EAIlBuO,aAAWzO,UAAOE,EAClBT,KAAK4F,OACL5F,KAAK6gE,iBAAcpgE,EACnBT,KAAKk9D,UAAOz8D,EACZT,KAAK24B,UAAOl4B,EACZT,KAAKkyD,WAAQzxD,EACbT,KAAK8gE,cAAWrgE,EAChBT,KAAK+gE,gBAAatgE,EAClBT,KAAKghE,iBAAcvgE,EACnBT,KAAKihE,iBAAcxgE,IArC3B,8BAwCYk4B,GACA34B,KAAK24B,OAASA,IAClB34B,KAAK24B,KAAOA,EACZ34B,KAAK8gE,cAAWrgE,EAChBT,KAAK+gE,gBAAatgE,EAClBT,KAAKghE,iBAAcvgE,EACnBT,KAAKihE,iBAAcxgE,KA9C3B,kCAiDgBkJ,GACJ3J,KAAK+gE,aAAep3D,IACxB3J,KAAK+gE,WAAap3D,EAClB3J,KAAKihE,iBAAcxgE,KApD3B,8EAuDyBiV,EAAa+B,GAvDtC,iFAwDcglD,EAAQyE,eAAelhE,KAAKO,KAAKkN,GAAIiI,EAAM+B,GAxDzD,OAyDQzX,KAAKO,KAAKmV,GAAQ+B,EAzD1B,4PA6D0BhX,IAAdT,KAAKk9D,KA7DjB,iEA8D0BT,EAAQ0E,SAASnhE,KAAK4N,QA9DhD,OA8DQ5N,KAAKk9D,KA9Db,0QAkE4Bz8D,IAAhBT,KAAK4N,OAlEjB,iEAmEwB6uD,EAAQl8D,KAAKP,KAAK4N,QAnE1C,cAmEY1N,EAnEZ,OAoEQF,KAAKO,KAAOL,EApEpB,SAqEiCu8D,EAAQ2E,gBAAgBphE,KAAK4N,QArE9D,cAqEQ5N,KAAK6gE,YArEb,iBAsE6BxD,EAAOgE,eAtEpC,QAsEYT,EAtEZ,OAuEal/D,EAAOk/D,EAAPl/D,IACL1B,KAAK4gE,SAAWzyD,OAAKsiB,cAAc/uB,EAAK,YAxEhD,kLA2EsB4/D,GA3EtB,iFA4Ec7E,EAAQ8E,cAAcvhE,KAAKO,KAAKkN,GAAI6zD,EAAO,GA5EzD,OA6EkBthE,KAAKk9D,KAAK91D,MAAK,SAAAC,GAAC,OAAIA,EAAEoG,KAAO6zD,KACnCE,OAAS,EA9ErB,qLAiFyBF,GAjFzB,uFAkFwB7E,EAAQgF,WAAWzhE,KAAKO,KAAKkN,GAAI6zD,GAlFzD,aAkFYphE,EAlFZ,SAmFmB,GAnFnB,yCAmF6BA,GAnF7B,cAoFkBF,KAAKk9D,KAAK91D,MAAK,SAAAC,GAAC,OAAIA,EAAEoG,KAAO6zD,KACnCE,OAAS,EArFrB,kBAsFe,GAtFf,iLAyFqBpwB,GAzFrB,uFA0FwBqrB,EAAQgF,WAAWzhE,KAAKO,KAAKkN,GAAI2jC,EAAI3jC,IA1F7D,aA0FYvN,EA1FZ,SA2FmB,GA3FnB,yCA2F6BA,GA3F7B,cA4FQF,KAAKk9D,KAAK96D,KAAKgvC,GA5FvB,kBA6Fe,GA7Ff,iQAiG2B3wC,IAAfT,KAAKkyD,MAjGjB,iEAkGwBuK,EAAQiF,UAAU1hE,KAAKO,KAAKkN,IAlGpD,QAkGYvN,EAlGZ,QAmGYoV,SAAQ,SAAAjO,GACR,OAAQA,EAAEoG,IACN,KAAK,EACDpG,EAAEM,KAAM,eACRN,EAAE8pC,YAAc,mDAChB,MACJ,KAAK,EACD9pC,EAAEM,KAAM,eACRN,EAAE8pC,YAAc,6DAI5BnxC,KAAKkyD,MAAQhyD,EA/GrB,iLAkHsByH,EAAawpC,GAlHnC,uFAmHuBsrB,EAAQkF,YAAY3hE,KAAKO,KAAKkN,GAAI9F,EAAMwpC,GAnH/D,cAmHY1jC,EAnHZ,QAoHiB,GACLzN,KAAKkyD,MAAM9vD,KAAK,CACZqL,GAAIA,EACJ9F,KAAMA,EACNwpC,YAAaA,EACbqB,WAAO/xC,IAzHvB,kBA4HegN,GA5Hf,uLA+HyBiI,EAAa+B,GA/HtC,iFAgIcglD,EAAQmF,mBAAmB5hE,KAAKO,KAAKkN,GAAIzN,KAAK24B,KAAKlrB,GAAIiI,EAAM+B,GAhI3E,OAiIQzX,KAAK24B,KAAKjjB,GAAQ+B,EAjI1B,qRAqIwBglD,EAAQoF,aAAa7hE,KAAKO,KAAKkN,GAAIzN,KAAK24B,KAAKlrB,IArIrE,OAqIYvN,EArIZ,OAsIQF,KAAK8gE,SAAW5gE,EAAI0H,KAAI,SAAAP,GACpB,OAAO,EAAK61D,KAAK91D,MAAK,SAAAgqC,GAAG,OAAEA,EAAI3jC,KAAOpG,EAAEoG,SAvIpD,iLA2IsByvD,GA3ItB,iFA4IcT,EAAQqF,gBAAgB9hE,KAAKO,KAAKkN,GAAIzN,KAAK24B,KAAKlrB,GAAIyvD,EAAKt1D,KAAI,SAAAP,GAAC,OAAEA,EAAEoG,OA5IhF,OA6IQzN,KAAK8gE,SAAW5D,EA7IxB,2QAiJwBT,EAAQsF,YAAY/hE,KAAKO,KAAKkN,QAAkBhN,IAAdT,KAAK24B,KAAoB,EAAE34B,KAAK24B,KAAKlrB,QAAIhN,EAAW,EAAG,KAjJjH,OAiJYP,EAjJZ,OAkJQF,KAAKghE,YAAc9gE,EAlJ3B,sLAqJ2Bk9D,GArJ3B,iFAsJcX,EAAQuF,iBAAiBhiE,KAAKO,KAAKkN,GAAIzN,KAAK+gE,WAAWtzD,GAAI2vD,GAtJzE,OAuJQp9D,KAAK+gE,WAAW3D,SAAWA,EAvJnC,wRA2JwBX,EAAQwF,gBAAgBjiE,KAAKO,KAAKkN,GAAIzN,KAAK+gE,WAAWtzD,IA3J9E,OA2JYvN,EA3JZ,OA4JYgyD,EAAehyD,EAAI0H,KAAI,SAAAP,GACvB,IAAI66D,EAAM76D,EAAEoG,GACRkrB,EAAO,EAAKu5B,MAAM9qD,MAAK,SAAAmM,GAAC,OAAIA,EAAE9F,KAAOy0D,KACzC,OAAO5xD,IAAEgN,MAAMqb,MAEnB34B,KAAKihE,YAAc/O,EAjK3B,oLAoKyB+O,GApKzB,4FAqKcxE,EAAQ0F,mBAAmBniE,KAAKO,KAAKkN,GAAIzN,KAAK+gE,WAAWtzD,GAAIwzD,EAAYr5D,KAAI,SAAAP,GAAC,OAAEA,EAAEoG,OArKhG,OAsKQzN,KAAKkyD,MAAM58C,SAAQ,SAAAqjB,GACf,IAAIupC,EAAMvpC,EAAKlrB,GACX20D,EAAM,EAAKnB,YAAY75D,MAAK,SAAAC,GAAC,OAAIA,EAAEoG,KAAOy0D,KAC1C5D,EAAM2C,EAAY75D,MAAK,SAAAC,GAAC,OAAIA,EAAEoG,KAAOy0D,KACzC,QAAYzhE,IAAR2hE,OAKQ3hE,IAAR69D,GACJ3lC,EAAK6Z,YANL,CACI,QAAY/xC,IAAR69D,EAAmB,OACvB3lC,EAAK6Z,YAMbxyC,KAAKihE,YAAcA,EAlL3B,oIACiC,OAAOjyD,aAAWzO,SADnD,wCAKK2T,KALL,wGAMKA,KANL,iGAOKA,KAPL,iGAQKA,KARL,kGASKA,KATL,qGAUKA,KAVL,uGAWKA,KAXL,wGAYKA,KAZL,wGAaKA,KAbL,iECHsBmuD,GAAtB,mKACuB,OAAOriE,KAAKgzD,UADnC,GAAsCD,S,IAKkBK,O,6CCD3CkP,GAAb,uKACc,IAAD,EAC0BtiE,KAAKuB,MAA/BghE,EADA,EACAA,UAAWC,EADX,EACWA,YAChB,OAAO,wBAAOjgE,UAAU,aAAjB,2BACC,cAAC,WAAD,CAAUyQ,KAAMwvD,IACpB,mBAAGjgE,UAAU,aAFV,iBAGC,cAAC,WAAD,CAAUyQ,KAAMuvD,WANhC,GAA6B7/D,aCLtB,SAAS+/D,GACZC,EACAngE,EACAE,EACAqI,GAEA,IAAI4wB,EACAn6B,EAeJ,OAde,IAAXmhE,GACAhnC,EAAM,IACNn6B,EAAQ,CACJgB,UAAW+V,KAAW/V,EAAW,kBACjCE,QAASA,EACT2Q,KAAM,OAIVsoB,EAAM,OACNn6B,EAAQ,CACJgB,UAAWA,IAGZG,gBAAoBg5B,EAAKn6B,EAAOuJ,GCXpC,I,oCAAM63D,GADZpnD,aACD,+MACI9Y,QAAU,SAACgY,GAGP,OAFAA,EAAI8e,iBACJr2B,MAAId,KAAK,cAAC,GAAD,CAAUqL,GAAI,EAAKlM,MAAMkM,OAC3B,GAJf,uDAMc,IAAD,EACyBzN,KAAKuB,MAA9BkM,EADA,EACAA,GAAIi1D,EADJ,EACIA,OAAQngE,EADZ,EACYA,UACjB,QAAW9B,IAAPgN,EAAkB,OAAO,KAC7B,IACI3C,EADAvK,EAAOg0B,EAAOwU,MAAM9oC,IAAIwN,GAEvB9F,EAA2BpH,EAA3BoH,KAAMsJ,EAAqB1Q,EAArB0Q,KAAMkgC,EAAe5wC,EAAf4wC,YACbyxB,EAAOzxB,GAAe,KAAOA,EAUjC,OARIrmC,EADAmG,EACU,qCAAGA,EAAH,SAAgB,wBAAO1O,UAAU,aAAjB,UAA+BoF,EAA/B,IAAsCi7D,QAE3Dj7D,EACK,qCAAGA,EAAH,SAAgB,uBAAOpF,UAAU,aAAjB,SAA+BqgE,OAG/Cn1D,EAEPg1D,GAAKC,EAAQngE,EAAWvC,KAAKyC,QAASqI,OAtBrD,GAA8BpI,eAA9B,GA2BamgE,GADZtnD,aACD,0KACc,IACD9N,EAAMzN,KAAKuB,MAAXkM,GACL,QAAWhN,IAAPgN,EAAkB,OAAO,KAC7B,IACK9F,EADM4sB,EAAOwU,MAAM9oC,IAAIwN,GACvB9F,KACL,OAAO,mCAAGA,QANlB,GAA8BjF,eAA9B,GAUMogE,G,4MACMxqC,U,yDAEJ,IAAI/3B,EAAOg0B,EAAOwU,MAAM9oC,IAAID,KAAKuB,MAAMkM,IAClC9F,EAA2BpH,EAA3BoH,KAAMqJ,EAAqBzQ,EAArByQ,KAAMmgC,EAAe5wC,EAAf4wC,YAMjB,OALAnxC,KAAKs4B,KAAO,CACR,GACA,CAAC91B,KAAM,YAAay3B,UAAW,cAAC,QAAD,CAAOjpB,KAAMA,EAAMooC,KAAMzxC,EAAMwpC,YAAaA,KAC3E,IAEG,cAAC,OAAD,CAAMtuC,OAAQ,0CAAd,SACH,cAAC,WAAD,CAAUy1B,KAAMt4B,KAAKs4B,KAAM9T,OAAQxkB,KAAKuB,c,GAX7BmB,aCnDVqgE,GAAU11D,sLAAY21D,eCiBtBC,IDhBc51D,sLAAY61D,oBCetC3nD,aACD,+MACI9Y,QAAU,SAACgY,GAGP,OAFAA,EAAI8e,iBACJr2B,MAAId,KAAK,cAAC,GAAD,CAAQqL,GAAI,EAAKlM,MAAMkM,OACzB,GAJf,uDAMc,IAGF3C,EAHC,EACyB9K,KAAKuB,MAA9BkM,EADA,EACAA,GAAIlL,EADJ,EACIA,UAAWmgE,EADf,EACeA,OAChBS,EAAM5uC,EAAO5I,IAAI1rB,IAAIwN,GAEzB,GAAY,OAAR01D,EACAr4D,EAAU2C,MAET,CAAC,IACG9F,EAAqBw7D,EAArBx7D,KAAMwpC,EAAegyB,EAAfhyB,YACPyxB,EAAOzxB,GAAe,KAAOA,EAE7BrmC,OADSrK,IAATkH,EACU,qCAAGA,EAAH,OAAc,uBAAOpF,UAAU,aAAjB,SAA+BqgE,OAG7Cn1D,EAGlB,OAAOg1D,GAAKC,EAAQngE,EAAWvC,KAAKyC,QAASqI,OAvBrD,GAA4BpI,eAA5B,IA4BM0gE,GADL7nD,a,+MAEW+c,U,yDAEJ,IAAIpyB,EAAKquB,EAAO5I,IAAI1rB,IAAID,KAAKuB,MAAMkM,IAC9B9F,EAAmDzB,EAAnDyB,KAAMwpC,EAA6CjrC,EAA7CirC,YAAa5wC,EAAgC2F,EAAhC3F,KAAMgiE,EAA0Br8D,EAA1Bq8D,UAAWC,EAAet8D,EAAfs8D,YACrCrpB,EAAO,gCACP,8BAAMhI,IACN,cAAC,GAAD,CAASqxB,YAAaA,EAAaD,UAAWA,OAQlD,OANAviE,KAAKs4B,KAAO,CACR,GACA,CAAC91B,KAAM,YAAay3B,UAAW,cAAC,QAAD,CAAOjpB,KAAM+xD,GAAS3pB,KAAMzxC,EAAMwpC,YAAagI,KAC9E,GACA,CAAC32C,KAAM,YAAa0T,MAAO,qBAAO+jB,UAAW,qBAAK13B,UAAU,OAAf,SAAsB,cAAC,GAAD,CAAUkL,GAAIlN,EAAMmiE,QAAQ,QAE5F,cAAC,OAAD,CAAM7/D,OAAQ,gCAAd,SACH,cAAC,WAAD,CAAUy1B,KAAMt4B,KAAKs4B,KAAM9T,OAAQxkB,KAAKuB,c,GAhB/BmB,e,GCGf2gE,IA/BL9nD,aACD,+MACI9Y,QAAU,SAACgY,GAGP,OAFAA,EAAI8e,iBACJr2B,MAAId,KAAK,cAAC,GAAD,CAASqL,GAAI,EAAKlM,MAAMkM,OAC1B,GAJf,uDAMc,IAGF3C,EAHC,EACyB9K,KAAKuB,MAA9BkM,EADA,EACAA,GAAIi1D,EADJ,EACIA,OAAQngE,EADZ,EACYA,UACb6uC,EAAM7c,EAAO2oC,KAAKj9D,IAAIwN,GAE1B,GAAY,OAAR2jC,EACAtmC,EAAU2C,MAET,CAAC,IACG9F,EAAqBypC,EAArBzpC,KAAMwpC,EAAeC,EAAfD,YAEPyxB,EAAOzxB,GAAe,KAAOA,EAE7BrmC,OADSrK,IAATkH,EACU,eAAC,WAAD,WAAiBA,EAAjB,SAA8B,uBAAOpF,UAAU,aAAjB,SAA+BqgE,OAG7Dn1D,EAGlB,OAAOg1D,GAAKC,EAAQngE,EAAWvC,KAAKyC,QAASqI,OAxBrD,GAA6BpI,cA6B5B6Y,c,+MAEW+c,U,sOASmB+kC,EAAO3xC,WAAW1rB,KAAKuB,MAAMkM,I,OAApDzN,KAAKsjE,KAAKr9C,K,4IAGV,IAAImrB,EAAM7c,EAAO2oC,KAAKj9D,IAAID,KAAKuB,MAAMkM,IAChClN,EAAyD6wC,EAAzD7wC,KAAMoH,EAAmDypC,EAAnDzpC,KAAMwpC,EAA6CC,EAA7CD,YAAangC,EAAgCogC,EAAhCpgC,KAAMuxD,EAA0BnxB,EAA1BmxB,UAAWC,EAAepxB,EAAfoxB,YAC3CrpB,EAAO,gCACP,8BAAMhI,IACN,cAAC,GAAD,CAASqxB,YAAaA,EAAaD,UAAWA,OASlD,OAPAviE,KAAKs4B,KAAO,CACR,GACA,CAAC91B,KAAM,YAAay3B,UAAW,cAAC,QAAD,CAAOjpB,KAAMA,EAAMooC,KAAMzxC,EAAMwpC,YAAagI,KAC3E,GACA,CAAC32C,KAAM,YAAa0T,MAAO,qBAAO+jB,UAAW,qBAAK13B,UAAU,OAAf,SAAsB,cAAC,GAAD,CAAUkL,GAAIlN,EAAMmiE,QAAQ,OAC/F1iE,KAAKsjE,MAEF,cAAC,OAAD,CAAMzgE,OAAQ,iCAAd,SACH,cAAC,WAAD,CAAUy1B,KAAMt4B,KAAKs4B,KAAM9T,OAAQxkB,KAAKuB,c,GA3B9BmB,a,oCAEjBwR,K,wEAAmC,CAChCgC,MAAO,kBAAS1T,KAAM,OAAQyjB,UAAMxlB,EAAW4jB,IAAKk/C,O,aA6BtDA,G,uKACQ,IAEFpqB,EAFC,EACqBn5C,KAAKuB,MAA1BoG,EADA,EACAA,KAAMwpC,EADN,EACMA,YAGX,OADIA,IAAagI,EAAO,qBAAK52C,UAAU,mBAAf,SAAmC4uC,KACpD,sBAAK5uC,UAAU,yBAAf,UACH,8BAAMoF,IACLwxC,S,GAPQz2C,aC/DR8gE,GADZjoD,aACD,+MACI9Y,QAAU,SAACgY,GAGP,OAFAA,EAAI8e,iBACJr2B,MAAId,KAAK,cAAC,GAAD,CAASqL,GAAI,EAAKlM,MAAMkM,OAC1B,GAJf,uDAMc,IAGF3C,EAHC,EACyB9K,KAAKuB,MAA9BkM,EADA,EACAA,GAAIlL,EADJ,EACIA,UAAWmgE,EADf,EACeA,OAChBS,EAAM5uC,EAAOypC,MAAM/9D,IAAIwN,GAE3B,GAAY,OAAR01D,EACAr4D,EAAU2C,MAET,CAAC,IACG9F,EAAew7D,EAAfx7D,KAAMipC,EAASuyB,EAATvyB,MAEP9lC,OADSrK,IAATkH,EACU,qCAAGA,EAAH,MAAYipC,KAGZnjC,EAGlB,OAAOg1D,GAAKC,EAAQngE,EAAWvC,KAAKyC,QAASqI,OAtBrD,GAA6BpI,eAA7B,GA2BM+gE,GADLloD,a,+MAEW+c,U,yDAEJ,IAAIpyB,EAAKquB,EAAOypC,MAAM/9D,IAAID,KAAKuB,MAAMkM,IAChC9F,EAAmDzB,EAAnDyB,KAAMwpC,EAA6CjrC,EAA7CirC,YAAa5wC,EAAgC2F,EAAhC3F,KAAMgiE,EAA0Br8D,EAA1Bq8D,UAAWC,EAAet8D,EAAfs8D,YACrCrpB,EAAO,gCACP,8BAAMhI,IACN,cAAC,GAAD,CAASqxB,YAAaA,EAAaD,UAAWA,OAQlD,OANAviE,KAAKs4B,KAAO,CACR,GACA,CAAC91B,KAAM,YAAay3B,UAAW,cAAC,QAAD,CAAOjpB,KAAM+xD,GAAS3pB,KAAMzxC,EAAMwpC,YAAagI,KAC9E,GACA,CAAC32C,KAAM,YAAa0T,MAAO,qBAAO+jB,UAAW,qBAAK13B,UAAU,OAAf,SAAsB,cAAC,GAAD,CAAUkL,GAAIlN,EAAMmiE,QAAQ,QAE5F,cAAC,OAAD,CAAM7/D,OAAQ,gCAAd,SACH,cAAC,WAAD,CAAUy1B,KAAMt4B,KAAKs4B,KAAM9T,OAAQxkB,KAAKuB,c,GAhB9BmB,e,GC5BTghE,GADZnoD,aACD,+MACI9Y,QAAU,SAACgY,GAGP,OAFAA,EAAI8e,iBACJr2B,MAAId,KAAK,cAAC,GAAD,CAAYqL,GAAI,EAAKlM,MAAMkM,OAC7B,GAJf,uDAMc,IAGF3C,EAHC,EACyB9K,KAAKuB,MAA9BkM,EADA,EACAA,GAAIi1D,EADJ,EACIA,OAAQngE,EADZ,EACYA,UACbw7D,EAASxpC,EAAO0pC,QAAQh+D,IAAIwN,GAEhC,GAAe,OAAXswD,EACAjzD,EAAU2C,MAET,CAAC,IACGk2D,EAAiB5F,EAAjB4F,GAAIh8D,EAAao2D,EAAbp2D,KAAMjG,EAAOq8D,EAAPr8D,IAEXoJ,OADSrK,IAATkH,EACU,qCACLA,EADK,QACO,uBAAOpF,UAAU,aAAjB,SAA+Bb,GAAOiiE,OAI7Cl2D,EAIlB,OADK3C,IAASA,EAAU,uBAAOvI,UAAU,aAAjB,uBACjBkgE,GAAKC,EAAQngE,EAAWvC,KAAKyC,QAASqI,OAzBrD,GAAgCpI,eAAhC,GA6BMkhE,G,4MACMtrC,U,yDAEJ,IAAIylC,EAASxpC,EAAO0pC,QAAQh+D,IAAID,KAAKuB,MAAMkM,IACtC0jC,EAAyB4sB,EAAzB5sB,YAAawyB,EAAY5F,EAAZ4F,GAAIpjE,EAAQw9D,EAARx9D,KActB,OAPAP,KAAKs4B,KAAO,CACR,GACA,CAAC91B,KAAM,YAAay3B,UAAW,cAAC,QAAD,CAAOjpB,KAAM+xD,GAAS3pB,KAAMjI,EAAaA,YAAawyB,KACrF,GACA,CAACnhE,KAAM,YAAa0T,MAAO,qBAAO+jB,UAAW,qBAAK13B,UAAU,OAAf,SAAsB,cAAC,GAAD,CAAUkL,GAAIlN,EAAMmiE,QAAQ,OAC/F,CAAClgE,KAAM,SAAU0T,MAAO,qBAAOvO,KAAM,UAElC,cAAC,OAAD,CAAM9E,OAAQ,gDAAd,SACH,cAAC,WAAD,CAAUy1B,KAAMt4B,KAAKs4B,KAAM9T,OAAQxkB,KAAKuB,c,GAnB3BmB,aC9BZmhE,GAAb,kDAGI,WAAYtiE,GAAQ,IAAD,8BACf,cAAMA,IAFAkW,WACS,IAYX+C,SAAW,SAACC,GAChB,IAAIqC,EAAM,EAAKvb,MAAMkW,MACjB2qD,EAAMtlD,GAAOA,EAAImb,OACrB,EAAKxgB,MAAQgD,EAAIkU,cAAclX,MAAMwgB,OACrC,EAAK30B,SAAS,CACVkY,SAAU4mD,IAAQ,EAAK3qD,SAjBZ,EAqBTu8B,SArBS,sBAqBE,oCAAA1yC,EAAA,yDACbwb,EAAM,EAAKvb,MAAMkW,MACjB2qD,EAAMtlD,GAAOA,EAAImb,OACjB5wB,EAAI,EAAKoQ,WAEKhX,KADdogD,EAAY,EAAKt/C,MAAMs/C,WAJV,iCAMGA,EAAUx5C,EAAG+6D,GANhB,UAOM,kBADfliE,EANS,gCAQT,EAAKoD,SAAS,CAACrB,MAAO/B,IARb,2BAWbgD,MAAIqC,MAXS,4CAnBjB,EAAKnC,MAAQ,CACToY,UAAU,GAHC,EAHvB,4DAuCQ,OAAO,uBAAOjZ,UAAU,qBAAqBC,KAAK,OAE9CmZ,aAAc3b,KAAKuB,MAAMkW,MACzB+C,SAAUxa,KAAKwa,aA1C3B,+BA4Cc,IAUFspD,EAVC,EAC2B9jE,KAAKuB,MAAhCgC,EADA,EACAA,MAAOs2C,EADP,EACOA,WAAYkqB,EADnB,EACmBA,KADnB,EAEmB/jE,KAAKoD,MAAxBoY,EAFA,EAEAA,SAAUvZ,EAFV,EAEUA,MACX4X,EAAQ,wBACRtX,UAAU,yBACViZ,SAAUA,EACV/Y,QAASzC,KAAKg0C,SAHN,SAKP6F,GAAY,iBAIjB,YADcp5C,IAAVwB,IAAqB6hE,EAAW,qBAAKvhE,UAAU,cAAf,SAA8BN,KAC3D,cAAC,OAAD,CAAMY,OAAQU,EAAOsW,MAAOA,EAA5B,SACH,sBAAKtX,UAAU,YAAf,UACKvC,KAAKy2B,gBACLqtC,EACD,uBAAOvhE,UAAU,0BAAjB,SAA4CwhE,aA5D5D,GAAqCrhE,aCGxBshE,GADZzoD,cACD,yPASY0oD,UAAY,SAACn9D,GAA4B,IAAD,EAChB,EAAKvF,OACjCK,EAF4C,EACvCA,UACGsiE,EAFoC,EAC9BA,YACKp9D,IACnB5D,MAAIqC,OAZZ,EAeYm0C,SAfZ,uCAeuB,WAAO/yC,GAAP,qBAAArF,EAAA,2DACgB,EAAKC,MAA/B4iE,EADU,EACVA,eAAgBxjE,EADN,EACMA,OACS,oBAAnBwjE,EAFI,gCAGKA,EAAexjE,EAAQgG,GAH5B,OAGPzG,EAHO,OAIX,EAAK0U,MAAQ1U,EAJF,4EAfvB,iPAIuCF,KAAKuB,MAA/B4iE,EAJb,EAIaA,eAAgBxjE,EAJ7B,EAI6BA,QACRylB,MAAMC,QAAQ89C,GALnC,qBAMYA,EANZ,sCAOoBA,EAAexjE,EAAQ,IAP3C,0BAKQX,KAAK4U,MALb,0IAuBc,IAAD,EACmC5U,KAAKuB,MAAxC4W,EADA,EACAA,QAASkM,EADT,EACSA,IAAK+/C,EADd,EACcA,kBACnB,OAAO,eAAC,OAAD,CAAMvhE,OAAQsV,EAASzU,KAAK,QAA5B,UACH,qBAAKnB,UAAU,YAAf,SACI,cAAC,YAAD,CAAWA,UAAU,OACjBm3C,SAAU15C,KAAK05C,SACfv+B,YAAaipD,EACblpD,UAAW,QAEnB,cAAC,OAAD,CAAMtG,MAAO5U,KAAK4U,MAAO9N,KAAM,CAACrE,QAAQzC,KAAKikE,UAAWzsD,OAAO6M,YAhC3E,GAAgC3hB,aAAhC,qCACKwR,KADL,0ECLO,SAASmwD,GAAa9iE,GACzB,OAAO,SAASugB,EAAkBnhB,GAC9B,OAAO,IAAIwK,SAAc,SAACvJ,EAASC,GAC/BqB,MAAId,KAAK,cAAC,GAAD,cAAYR,QAASA,EAASkgB,KAAMA,EAAMnhB,OAAQA,GAAYY,S,+KAc7EyiE,G,kDAEF,WAAYziE,GAAwB,IAAD,8BAC/B,cAAMA,IAFFqT,WAC2B,EAE/B,EAAKxR,MAAQ,CACTwR,MAAO,MAEX,EAAKqvD,UAAY,EAAKA,UAAU/sC,KAAf,gBACjB,EAAKwiB,SAAW,EAAKA,SAASxiB,KAAd,gBANe,E,yLASAl3B,KAAKuB,MAA/B4iE,E,EAAAA,eAAgBxjE,E,EAAAA,O,KACrBX,MACWomB,MAAMC,QAAQ89C,G,qBAAiBA,E,sCAAuBA,EAAexjE,EAAQ,I,0CAApFiU,M,WADCtR,S,uJAICwD,IAENlF,EADgB5B,KAAKuB,MAAhBK,SACGkF,GACR5D,MAAIqC,Q,wEAEOoB,G,kFAGoB3G,KAAKuB,MAA/B4iE,E,EAAAA,eAAgBxjE,E,EAAAA,OACS,oBAAnBwjE,E,gCACSA,EAAexjE,EAAQgG,G,OAAnCzG,E,OACJF,KAAKsD,SAAS,CAACsR,MAAO1U,I,sIAGpB,IAAD,EACmCF,KAAKuB,MAAxC4W,EADA,EACAA,QAASkM,EADT,EACSA,IAAK+/C,EADd,EACcA,kBACnB,OAAO,eAAC,OAAD,CAAMvhE,OAAQsV,EAASzU,KAAK,QAA5B,UACH,qBAAKnB,UAAU,YAAf,SACI,cAAC,YAAD,CAAWA,UAAU,OACjBm3C,SAAU15C,KAAK05C,SACfv+B,YAAaipD,EACblpD,UAAW,QAEnB,cAAC,OAAD,CAAMtG,MAAO5U,KAAKoD,MAAMwR,MAAO9N,KAAM,CAACrE,QAAQzC,KAAKikE,UAAWzsD,OAAO6M,Y,GAvCxD3hB,aCjBZ4hE,GADZ/oD,cACD,8PAMYgpD,YAAc,SAACC,EAAc38D,GAA8B,IAC1DF,EAA4B68D,EAA5B78D,KAAMipC,EAAsB4zB,EAAtB5zB,MAAOO,EAAeqzB,EAAfrzB,YAClB,OAAO,eAAC,MAAD,CAAK5uC,UAAU,OAAOsX,MAAO,uBAAOtX,UAAU,aAAjB,SAA+B4uC,IAA5D,UACFP,EADE,MACQjpC,MATvB,EAaY88D,IAbZ,sBAakB,wCAAAnjE,EAAA,2DACY,EAAKC,MAAtB6vC,EADK,EACLA,IAAKszB,EADA,EACAA,SACLj3D,EAAc2jC,EAAd3jC,GAAI+zD,EAAUpwB,EAAVowB,OACLmD,EAAmB,EACR,IAAXnD,EAJM,iCAKUpD,GAAMwG,eAAen3D,GAL/B,eAMK,GAAGyC,MAAM,wDANd,2BAQU,IAAXsxD,EARC,kCASApD,GAAMyG,YAAYp3D,GATlB,QAUNk3D,EAAY,EAVN,+BAaFG,EAAiBx0D,IAAEgN,MAAM8zB,IACtB3jC,GAAKA,EACZq3D,EAAOtD,OAAS,EAfV,UAgBUpD,GAAM2G,WAAWD,GAhB3B,gBAiBK,GAAG50D,MAAM,wDAjBd,aAmBOzP,IAAbikE,GACAA,EAASj3D,EAAIk3D,GAEjBzhE,MAAIqC,MAtBM,4CAblB,4LAGgC83D,EAAO3xC,WAAW1rB,KAAKuB,MAAM6vC,IAAI3jC,IAHjE,OAGQzN,KAAKglE,WAHb,4IAqCc,IAMFC,EAAe3xD,EAAa2f,EAN3B,EACiEjzB,KAAKuB,MAAM6vC,IAA5E7wC,EADA,EACAA,KAAMoH,EADN,EACMA,KAAMwpC,EADZ,EACYA,YAAangC,EADzB,EACyBA,KAAMwwD,EAD/B,EAC+BA,OAAQe,EADvC,EACuCA,UAAWC,EADlD,EACkDA,YACnDrpB,EAAO,gCACP,8BAAMhI,IACN,cAAC,GAAD,CAASqxB,YAAaA,EAAaD,UAAWA,OAGnC,IAAXf,GACAyD,EAAS,MACT3xD,EAAO,kBACP2f,EAAQ,cAEQ,IAAXuuC,GACLyD,EAAS,UACT3xD,EAAO,kBACP2f,EAAQ,gBAGRgyC,EAAS,OACT3xD,EAAO,kBACP2f,EAAQ,eAEZ,IAAIqF,EAAc,CACd,GACA,CACI91B,KAAM,YACNy3B,UAAW,cAAC,QAAD,CAAOjpB,KAAMA,EAAMooC,KAAMzxC,EAAMwpC,YAAagI,KAE3D,GACA,CACI32C,KAAM,YACN0T,MAAO,qBACP+jB,UAAW,qBAAK13B,UAAU,OAAf,SAAsB,cAAC,GAAD,CAAUkL,GAAIlN,EAAMmiE,QAAQ,OAEjE,CACIlgE,KAAM,YACN0T,MAAO,iBACP+jB,UAAW,cAAC,OAAD,CAAM13B,UAAU,QAAQqS,MAAO5U,KAAKglE,WAAYl+D,KAAM,CAAC0Q,OAAQxX,KAAKukE,gBAEnF,GACA,GACA,CACI/hE,KAAM,YACNu0D,GAAI,GACJ98B,UAAW,yBAAQ13B,UAAW+V,KAAW,MAAO,QAAS2a,GAAQxwB,QAASzC,KAAKykE,IAApE,UACP,cAAC,KAAD,CAAI98D,KAAMs9D,EAAQj4C,KAAK,OADhB,IACyB1Z,OAI5C,OAAO,8BACH,cAAC,WAAD,CAAUglB,KAAMA,EAAM9T,OAAQxkB,KAAKuB,cAvF/C,GAA0BmB,aAA1B,0CACKwR,KADL,0ECHMgxD,G,kDAEF,WAAYt3D,GAAgB,IAAD,8BACvB,gBAFIA,YACmB,EAEvB,EAAKA,OAASA,EAFS,E,iGASCyJ,EAAY0Q,EAAgBC,G,uFAG1Cy0C,EAAQiE,UAAU1gE,KAAK4N,OAAQ5N,KAAKqX,MAAOrX,KAAK+nB,UAAW/nB,KAAKgoB,U,cAA5E9nB,E,yBACG,CAAC+sB,MAAO/sB,I,8IAEU4G,GAEf9G,KAAK+nB,eADItnB,IAATqG,EACiB,EAEAA,EAAK2G,O,GArBXmf,aA0BVu4C,GADZ5pD,aACD,qDAEI,WAAYha,GAAY,IAAD,8BACnB,cAAMA,IAFF27D,UACe,IAIfxjB,SAJe,uCAIJ,WAAO/yC,GAAP,SAAArF,EAAA,sEACT,EAAK47D,KAAK/e,MAAMx3C,GADP,2CAJI,wDAOfy+D,SAAW,SAACh0B,GAChBluC,MAAId,KAAK,cAAC,OAAD,CAAMS,OAAO,8BAAb,SACL,cAAC,GAAD,CAAMuuC,IAAKA,EAAKszB,SAAU,EAAKA,eAThB,EAYfA,SAAW,SAACpD,EAAcE,GAC9B,IAAItE,EAAO,EAAKA,KAAKtoD,MACjBw8B,EAAM8rB,EAAK91D,MAAK,SAAAC,GAAC,OAAIA,EAAEoG,KAAO6zD,KAClClwB,EAAIowB,OAASA,EACbtE,EAAKlrD,QAAQ,CAACo/B,KAdd,EAAK8rB,KAAO,IAAIgI,GAAS9G,GAAM79D,KAAKkN,IAFjB,EAF3B,sDAoBsB2jC,GAA0B,IAEpCv3B,EADClS,EAAmCypC,EAAnCzpC,KAAMwpC,EAA6BC,EAA7BD,YAAangC,EAAgBogC,EAAhBpgC,KAAMwwD,EAAUpwB,EAAVowB,OAM9B,OAJe,IAAXA,EACA3nD,EAAQ,uDACQ,IAAX2nD,IACL3nD,EAAQ,wDACL,cAAC,MAAD,CAAKtX,UAAU,YAClBkF,KAAM,cAAC,QAAD,UAAO,cAAC,QAAD,CAAOoL,IAAK7B,MACzB6I,MAAOA,EAFJ,SAGH,sBAAKtX,UAAU,OAAf,UACI,8BAAMoF,IACN,uBAAOpF,UAAU,aAAjB,SAA+B4uC,WAhC/C,+BAqCQ,IAAIv8B,EAAQ5U,KAAKk9D,KAAKtoD,MAClBuH,EAAS,cAAC,YAAD,CAAWu9B,SAAU15C,KAAK05C,SACnCn3C,UAAU,aACV4Y,YAAY,kBACZD,UAAW,MACf,OAAO,cAAC,OAAD,CAAMrY,OAAQsZ,EAAd,SACH,cAAC,OAAD,CACIvH,MAAOA,EACP9N,KAAM,CAACrE,QAAQzC,KAAKolE,SAAU5tD,OAAOxX,KAAKqlE,WAC1CriC,OAAO,sCA9CvB,GAA4BtgC,eAA5B,GC1BqB4iE,GADpB/pD,a,+SAGa6iD,GAAMmH,W,kIAEGn0B,EAAavpC,GAAe,IAEvC29D,EADC79D,EAAmCypC,EAAnCzpC,KAAMwpC,EAA6BC,EAA7BD,YAAangC,EAAgBogC,EAAhBpgC,KAIxB,OAFe,IAFyBogC,EAAVowB,SAG1BgE,EAAM,cAAC,KAAD,CAAIjjE,UAAU,cAAcoF,KAAK,SACpC,cAAC,MAAD,CAAKpF,UAAU,YAClBkF,KAAM,cAAC,QAAD,UAAO,cAAC,QAAD,CAAOoL,IAAK7B,MACzB6I,MAAO2rD,EAFJ,SAGH,sBAAKjjE,UAAU,OAAf,UACI,8BAAMoF,IACN,uBAAOpF,UAAU,aAAjB,SAA+B4uC,W,+BAI1BC,GACbluC,MAAId,KAAK,cAAC,OAAD,CAAMS,OAAO,8BAAb,SACL,cAAC,GAAD,CAAMuuC,IAAKA,S,gCAIfluC,MAAId,KAAK,cAAC,GAAD,gBAAYpC,KAAKuB,W,+BAEpB,IAAD,OACDsY,EAAQ,wBACRtX,UAAU,gDACVE,QAAS,kBAAI,EAAKgjE,WAFV,SAEqB,cAAC,KAAD,CAAI99D,KAAK,WAC1C,OAAO,cAAC,OAAD,CAAM9E,OAAO,kBAAQgX,MAAOA,EAA5B,SACH,cAAC,OAAD,CAAMjF,MAAOwpD,GAAMlB,KAAMp2D,KAAM,CAAC0Q,OAAQxX,KAAK0lE,WAAYjjE,QAASzC,KAAKolE,kB,GA/B7C1iE,e,GCJzB4iE,GAAb,4MAIYttD,KAAO,WAAmB,IAAD,EACa,EAAKU,WAA1CitD,EADwB,EACxBA,QAASC,EADe,EACfA,aAAcC,EADC,EACDA,WACxBhsD,EAAQ,wBAAQtX,UAAU,8BAA8BE,QAASojE,EAAzD,SACjB,cAAC,KAAD,CAAIl+D,KAAK,WACJ,OAAO,cAAC,OAAD,CAAM9E,OAAO,MAAMgX,MAAOA,EAA1B,SACH,cAAC,OAAD,CAAMjF,MAAO+wD,EAAS7+D,KAAM,CAAC0Q,OAAQ,EAAKsuD,OAAQrjE,QAASmjE,QATvE,EAYYE,OAAS,SAACh/D,GAA6B,IACtCa,EAAkCb,EAAlCa,KAAMwQ,EAA4BrR,EAA5BqR,QAASnH,EAAmBlK,EAAnBkK,KAAMuxD,EAAaz7D,EAAby7D,UACtB96D,EAAO,cAAC,QAAD,CAAOulB,KAAK,KAAZ,SAAiB,cAAC,QAAD,CAAOna,IAAK7B,MAIpC+0D,EAAc5tD,EACd,qCAAE,qBAAK5V,UAAU,mBAAf,SAAmCoF,IAAW,8BAAK,4BAAIwQ,SACzD,8BAAK,4BAAIxQ,MAETkS,EAAQ,uBAAOtX,UAAU,aAAjB,SAA8B,cAAC,WAAD,CAAUyQ,KAAMuvD,MAC1D,OAAO,cAAC,MAAD,CAAKhgE,UAAU,gCAAgCkF,KAAMA,EAAMoS,MAAOA,EAAlE,SACH,qBAAKtX,UAAU,OAAf,SACKwjE,OAzBjB,4FACe1uD,GADf,iEAEQrX,KAAK2X,SAAS3X,KAAKgY,MAF3B,4GAA8BsB,SCMxB0sD,GAAgB,SAACl/D,GAAoB,IAClCqqC,EAA0BrqC,EAA1BqqC,YAAa80B,EAAan/D,EAAbm/D,MAAOtC,EAAM78D,EAAN68D,GACzB,OAAO,qCAAGxyB,EAAH,IAAiB80B,EAAjB,IAAyBtC,MAkB9BriD,GAAsB,CACxB,CAAC3Z,KAAM,OAAQnF,KAAM,SAAU0Y,UAAW,IAAK8c,UAAU,GACzD,CAACrwB,KAAM,UAAWnF,KAAM,SAAU0Y,UAAW,KAC7C,CAACvT,KAAM,cAAenF,KAAM,SAAU0Y,UAAW,KACjD,CAACvT,KAAM,MAAOnF,KAAM,SAAU0Y,UAAW,KACzC,CAACvT,KAAM,SAAUnF,KAAM,WACvB,CAACmF,KAAM,SAAUnF,KAAM,MACvB,CAACmF,KAAM,OAAQnF,KAAM,SACrB,CAACmF,KAAM,SAAUnF,KAAM,WAGL0jE,GAAtB,4MACY/B,eADZ,uCAC6B,WAAOxjE,EAAYgG,GAAnB,SAAArF,EAAA,sEACf88D,GAAMpB,IAAI2D,aAAaxiB,MAAMx3C,GADd,gCAEdy3D,GAAMpB,IAAI2D,aAAa/rD,OAFT,2CAD7B,0DAMYuxD,eANZ,sBAM6B,sBAAA7kE,EAAA,sEACf88D,GAAMpB,IAAI2D,aAAa9zC,OADR,2CAN7B,EAUYwkC,UAAY,SAACvqD,EAAgBe,GACjC,OAAO,qBAAKtF,UAAU,YAAf,SAA2B,cAAC,GAAD,gBAAmBuE,OAX7D,EAcYs/D,aAAe,SAAC1mB,EAAiB/3C,EAAa8P,GAClD,OAAO,IAAItM,SAAgB,SAACvJ,EAASC,GACjCqB,MAAId,KAAK,cAAC,GAAD,CACL+V,QAAQ,iCACRisD,kBAAkB,iCAClBD,eAAgB,EAAKA,eACrBgC,eAAgB,EAAKA,eACrB9hD,IAAK,EAAKgtC,UACV6S,WAAY,SAACp9D,GAAD,OAAoBA,EAAK2G,IACrC7L,QAASA,EAASjB,YAAQF,KAC1B,WACIoB,WAzBpB,EA8BYwkE,kBAAoB,SAACC,GACzB,OAAO,cAAC,GAAD,CAAY74D,GAAI64D,KA/B/B,EAkCY3xB,SAAoB,CACxB//B,MAAO,CACHjN,KAAM,CAACqe,OAAQ,OAAQ9P,MAAO,gBAC9BiC,QAAS,CAAC6N,OAAQ,OAAQ9P,MAAO,gBACjCi7B,YAAa,CAACnrB,OAAQ,WAAY9P,MAAO,eAAMoiB,KAAM,GACrD52B,IAAK,CAACskB,OAAQ,OAAQ9P,MAAO,MAAOiF,YAAa,6BACjD,OAAU,CAAC6K,OAAQ,WAAY9P,MAAO,gBACtC6nD,OAAQ,CAAC/3C,OAAQ,KAAM9P,MAAO,qBAAOstC,OAAQ,EAAK4iB,aAAcrgD,QAAS,EAAKsgD,mBAC9Er1D,KAAM,CAACgV,OAAQ,QAAS9P,MAAO,sBAC/B6tC,OAAQ,CAAC/9B,OAAQ,SAAU9P,MAAO,eAAM3T,UAAW,qBA3C/D,EAkDY0iD,cAlDZ,uCAkD4B,WAAOt9C,EAAa+3C,GAApB,iBAAAp+C,EAAA,6DACf2b,EAAQyiC,EAARziC,KACDm0B,EAAa9gC,IAAEgN,MAAM,EAAK5E,WAAW04B,MAAQ,GACjD9gC,IAAEC,MAAM6gC,EAAKn0B,GAHO,SAId,EAAKvE,WAAWkmD,QAAQxtB,GAJV,OAKpBluC,MAAIqC,MALgB,2CAlD5B,0DAyDcyS,UAzDd,IA0DcgjB,KAAOzf,cAAS,WACtB,OAAO,cAAC,OAAD,CAAMwuC,eAAgB,EACzBxnD,UAAU,MACV+e,OAAQA,GACRqzB,SAAU,EAAKA,SACfzM,SAAU,EAAK+L,WACfgR,cAAe,EAAKA,mBAhEhC,+JAgDQjlD,KAAK2X,SAAS3X,KAAKgY,MAhD3B,2GAA2CsB,SAqE9BitD,GAAb,4MAEcvuD,KAAO,WAAO,IAEfrQ,EADO,EAAK+Q,WAAZ04B,IACAzpC,KACL,OAAO,cAAC,OAAD,CAAM9E,OAAQ,qBAAa8E,EAAMjE,KAAK,QAAtC,SACFhB,gBAAoB,EAAKs4B,SANtC,yDAC0B,OAAOh7B,KAAK0Y,WAAW04B,QADjD,GAA8B80B,IAWjBM,GAAb,4MAEcxuD,KAAO,WACb,OAAO,cAAC,OAAD,CAAMnV,OAAQ,kBAASa,KAAK,QAA5B,SACFhB,gBAAoB,EAAKs4B,SAJtC,yDAC0B,MAAO,OADjC,GAA6BkrC,ICnHhBO,IAAb,uPAUY/sB,SAVZ,uCAUuB,WAAO/yC,GAAP,SAAArF,EAAA,6DACC,EACD,IAFA,SAGE,EAAKoX,WAAWqmD,SAASp4D,EAF1B,EACD,KAFA,OAGf,EAAKglB,IAHU,kDAVvB,wDAgBY3T,KAAOuD,cAAS,WAAO,IACtBmrD,EAAQ,EAAKhuD,WAAbguD,KACD7jE,EAAS,cAAC,YAAD,CAAWN,UAAU,aAC9B2T,MAAM,8BACNwjC,SAAU,EAAKA,SACfv+B,YAAY,6BACZD,UAAW,MACf,OAAO,cAAC,OAAD,CAAMxX,KAAK,QAAQb,OAAQA,EAA3B,SACH,cAAC,OAAD,CAAM+R,MAAO,EAAK+W,IAAK7kB,KAAM,CAAC0Q,OAAQ,EAAK6M,IAAK5hB,QAASikE,UAxBrE,EA4BYriD,IAAM,SAACne,GAAe,IACrB0qC,EAA4B1qC,EAA5B0qC,MAAOjpC,EAAqBzB,EAArByB,KAAMwpC,EAAejrC,EAAfirC,YAClB,OAAO,cAAC,MAAD,CAAK5uC,UAAU,YAAYsX,MAAOs3B,EAAlC,SACH,gCAAMP,EAAN,MAAgBjpC,QA/B5B,sKAKwB,EAAc,IALtC,SAMyB3H,KAAK0Y,WAAWqmD,SAAS,GAD1B,EAAc,KALtC,OAMQ/+D,KAAK2rB,IANb,OAOQ3rB,KAAK2X,SAAS3X,KAAKgY,MAP3B,2GAAkCsB,SAAlC,mCACKpF,KADL,kECGayyD,GAAb,4MAMYC,SANZ,sBAMuB,sBAAAtlE,EAAA,sEACT,EAAKssD,UAAU2Y,IADN,2CANvB,EAWYM,WAXZ,sBAWyB,sBAAAvlE,EAAA,0DACmC,IAAhD4D,OAAOvB,QAAQ,0JADF,gCAEP,EAAK+U,WAAWouD,YAFT,OAGb5jE,MAAIqC,MAHS,2CAXzB,EAkBYyS,KAAOuD,cAAS,WAAmB,IAAD,EACrB,EAAK7C,WAAjB04B,EADiC,EACjCA,IAAKzlB,EAD4B,EAC5BA,IAELprB,EAA0E6wC,EAA1E7wC,KAAMoH,EAAoEypC,EAApEzpC,KAAMwQ,EAA8Di5B,EAA9Dj5B,QAASg5B,EAAqDC,EAArDD,YAAangC,EAAwCogC,EAAxCpgC,KAAM+sD,EAAkC3sB,EAAlC2sB,OAAQwE,EAA0BnxB,EAA1BmxB,UAAWC,EAAepxB,EAAfoxB,YAC5DrpB,EAAO,gCACP,8BAAMhI,IACN,cAAC,GAAD,CAASqxB,YAAaA,EAAaD,UAAWA,OAE9CwE,EAAY,CAEZ,CAAC5uD,QAAQ,kBAASiG,OAAO,EAAKwoD,SAAU51D,KAAK,QAC7C,CAACmH,QAAQ,eAAMiG,OAAO,EAAKyoD,WAAY71D,KAAK,YAG5C6I,EAAQ,cAAC,kBAAD,CAAiBozB,QAAS85B,EAAWxkE,UAAU,qBACvDwjE,EAAc5tD,EACd,qCAAGxQ,EAAH,KAAU,4BAAIwQ,OACd,4BAAIxQ,IACJ2wB,EAAc,CACd,GACA,CACI91B,KAAM,YACNy3B,UAAW,cAAC,QAAD,CAAOjpB,KAAMA,EAAMooC,KAAM2sB,EAAa50B,YAAagI,KAElE,GACA,CACI32C,KAAM,YACN0T,MAAO,qBACP+jB,UAAW,qBAAK13B,UAAU,OAAf,SAAsB,cAAC,GAAD,CAAUkL,GAAIlN,EAAMmiE,QAAQ,OASjE,CACIxsD,MAAO,MACPvO,KAAM,MACNnF,KAAM,UAEV,CACIA,KAAM,YACN0T,MAAO,qBACP+jB,UAAW,cAAC,GAAD,CAAYxsB,GAAIswD,KAE/B,IAGAiJ,EAAW,wBACXzkE,UAAU,iCACVE,QAAS,kBAAI,EAAKmrD,UAAU6Y,KAFjB,4BAIf,OAAO,eAAC,OAAD,CAAM5jE,OAAQ,SAAW8E,EAAMkS,MAAOA,EAAtC,UACH,cAAC,WAAD,CAAUye,KAAMA,EAAM9T,OAAQ4sB,IAC9B,cAAC,MAAD,CAAK7uC,UAAU,iBAAiBsX,MAAOmtD,EAAvC,4BACA,cAAC,OAAD,CACIpyD,MAAO+W,EACP7kB,KAAM,CAAC0Q,OAAO,EAAK+sD,YAAa9hE,QAAQ,EAAKwkE,iBA7E7D,EAiFYA,QAAU,SAAC/gE,GACf,EAAKwS,WAAWguD,KAAKxgE,IAlF7B,EAqFYq+D,YAAc,SAACr+D,EAAU2B,GAC7B,QAAWpH,IAAPyF,EAAkB,OAAO,KAD6B,IAErDyB,EAA2BzB,EAA3ByB,KAAMwpC,EAAqBjrC,EAArBirC,YAAa5wC,EAAQ2F,EAAR3F,KACpBsZ,EAAQs3B,GAAe,sBAAK5uC,UAAU,mBAAf,mBAA2C4uC,KAClE+1B,EAAS,EAAKxuD,WAAWwuD,OAAOhhE,GAChCktB,EAAK9a,KAAW,yCAAkD,IAAT4uD,GAAiB,yBAC9E,OAAO,eAAC,MAAD,CAAK3kE,UAAW6wB,EAAIvZ,MAAOA,EAA3B,WACO,IAATqtD,GAAkB,cAAC,KAAD,CAAI3kE,UAAU,oBAAoBoF,KAAK,WACzD,cAAC,GAAD,CAAU8F,GAAIlN,IAFZ,MAEwBoH,MA7FvC,+JAGQ3H,KAAK2X,SAAS3X,KAAKgY,MAH3B,2GAA6BsB,SCLhB6tD,GAAb,4MACYjhE,QADZ,IASYkhE,WATZ,sBASyB,sBAAA9lE,EAAA,sEACX,EAAKoX,WAAW0uD,WAAW,EAAKlhE,IADrB,OAEjB,EAAKqS,UAAU,GAFE,2CATzB,EAcY8uD,aAdZ,sBAc2B,sBAAA/lE,EAAA,sEACb,EAAKoX,WAAW2uD,aAAa,EAAKnhE,IADrB,OAEnBhD,MAAIqC,MAFe,2CAd3B,EAmBY+hE,UAnBZ,sBAmBwB,sBAAAhmE,EAAA,sDAChB,EAAKoX,WAAW6uD,cAAc,EAAKrhE,IACnC,EAAKqS,YAFW,2CAnBxB,EAwBYP,KAAO,WAAkB,IAGzBwvD,EAAaC,EAHY,EAEI,EAAKvhE,GAAjC0qC,EAFwB,EAExBA,MAAOjpC,EAFiB,EAEjBA,KAAMwpC,EAFW,EAEXA,YAqClB,OAnC0C,IAAtC,EAAKz4B,WAAWgvD,SAAS,EAAKxhE,KAE1BshE,GADoC,IAApC,EAAK9uD,WAAWwuD,OAAO,EAAKhhE,IAClB,wBAAQ3D,UAAU,yBAAyBE,QAAS,EAAK6kE,UAAzD,kCAGA,gCAAK,cAAC,KAAD,CAAI/kE,UAAU,eAAeoF,KAAK,WAAvC,eAEd8/D,EAAW,wBAAQllE,UAAU,gCAAgCE,QAAS,EAAK4kE,aAAhE,uCAGXG,EAAU,wBAAQjlE,UAAU,yBAAyBE,QAAS,EAAK2kE,WAAzD,sCAyBP,cAAC,OAAD,CAAMvkE,OAAO,iBAAb,SACH,sBAAKN,UAAU,gCAAf,UACI,gCAAMquC,EAAN,MAAgBjpC,KAChB,qBAAKpF,UAAU,aAAf,SAA6B4uC,IAE7B,cAAC,MAAD,CAAK5uC,UAAU,OAAOsX,MAAO4tD,EAA7B,SAAwCD,UApExD,4FAIethE,GAJf,iEAKQlG,KAAKkG,GAAKA,EACVlG,KAAK2X,SAAS3X,KAAKgY,MAN3B,4GAAgCsB,SCWnBquD,IAAb,+MACY/5D,YADZ,IAEIwjC,SAFJ,gIAYIw0B,aAZJ,uCAYmB,WAAO9+D,GAAP,mBAAAxF,EAAA,6DACX,EAAK8vC,IAAMtqC,EACC8gE,EAAY9gE,EAAnB+gE,OAFM,SAGKxK,EAAO3xC,WAAW5kB,EAAK2G,IAH5B,OAGPvN,EAHO,OAKX,EAAKyrB,IAAMzrB,EAAI0H,KAAI,SAACP,EAAGQ,GAAW,IACzB+oC,EAA8DvpC,EAA9DupC,MAAOnjC,EAAuDpG,EAAvDoG,GACRvN,EAAM,CACFuN,GAAIA,EACJ9F,KAH2DN,EAAnDM,KAIRwpC,YAJ2D9pC,EAA7C8pC,YAKd5wC,KAL2D8G,EAAhC9G,KAO3BqwC,MAAOA,EACP2xB,UAR2Dl7D,EAA1Bk7D,UASjCC,YAT2Dn7D,EAAfm7D,YAU5CsF,mBAAernE,GAMvB,OAJIgN,IAAOm6D,IACP,EAAKC,OAAS3nE,EACd6nE,EAAWlgE,GAER3H,UAEMO,IAAbsnE,IACA,EAAKp8C,IAAIuJ,OAAO6yC,EAAU,GAC1B,EAAKp8C,IAAIsJ,QAAQ,EAAK4yC,SAE1B,EAAKja,UAAU+Y,IA5BJ,2CAZnB,wDA2CIY,cA3CJ,uCA2CoB,WAAOrhE,GAAP,SAAA5E,EAAA,sEACN+7D,EAAO2K,aAAa,EAAKp6D,OAAQ,EAAKwjC,IAAI3jC,GAAIvH,EAAGuH,IAD3C,OAEZ,EAAKw6D,UAAU/hE,GAFH,2CA3CpB,wDA2DI2/D,WAAa,WACT,EAAKz0B,SAAM3wC,EACX,EAAKmtD,UAAU4Y,KA7DvB,EAgEI5H,QAhEJ,uCAgEc,WAAOp6C,GAAP,qBAAAljB,EAAA,6DAEFuD,EAAM,IAAID,UACGnE,IAAb,EAAK2wC,KACLA,EAAM9gC,IAAEgN,MAAMkH,IACV+9C,UAAY19D,GAGhBusC,EAAM9gC,IAAEgN,MAAM,EAAK8zB,KACnB9gC,IAAEC,MAAM6gC,EAAK5sB,IAEjB4sB,EAAI7wC,KAAO,EAAKqN,OAChBwjC,EAAIoxB,YAAc39D,EAZZ,SAaUw4D,EAAOuB,QAAQxtB,GAbzB,OAaFlxC,EAbE,OAcNkxC,EAAI3jC,GAAKvN,OAEGO,KADR2hE,EAAM,EAAKuD,QAAQv+D,MAAK,SAAAC,GAAC,OAAIA,EAAEoG,KAAOvN,MAEtCoQ,IAAEC,MAAM6xD,EAAKhxB,GAGb,EAAKu0B,QAAQvjE,KAAKgvC,GApBhB,4CAhEd,wDAwFIs2B,SAAW,SAACxhE,GACR,OAAO,EAAKylB,IAAIqE,WAAU,SAAA3oB,GAAC,OAAIA,EAAEoG,KAAOvH,EAAGuH,OAAO,GAzF1D,EA4FIy5D,OAAS,SAAChhE,GACN,YAAuBzF,IAAhB,EAAKonE,QAAwB,EAAKA,OAAOp6D,KAAOvH,EAAGuH,IA7FlE,EAgGIq5D,UAhGJ,sBAgGgB,4BAAAxlE,EAAA,sEACF+7D,EAAOwB,OAAO,EAAKjxD,OAAQ,EAAKwjC,IAAI3jC,IADlC,QAEJ5F,EAAQ,EAAK89D,QAAQ31C,WAAU,SAAA3oB,GAAC,OAAIA,EAAEoG,KAAO,EAAK2jC,IAAI3jC,QAC7C,GAAG,EAAKk4D,QAAQzwC,OAAOrtB,EAAO,GAHnC,2CAhGhB,EAsGIk3D,SAtGJ,uCAsGe,WAAOp4D,EAAYohB,EAAkBC,GAArC,SAAA1mB,EAAA,sEACM+7D,EAAO0B,SAAS,EAAKnxD,OAAQjH,EAAKohB,EAAWC,GADnD,mFAtGf,4DA0GIkgD,SA1GJ,sBA0Ge,sBAAA5mE,EAAA,sEACM+7D,EAAO6K,SAAS,EAAKt6D,QAD3B,mFA1Gf,EA8GI84D,KAAO,SAACxgE,GACJ,EAAK0nD,UAAUuZ,GAAYjhE,IA/GnC,EAkHIkhE,WAlHJ,uCAkHiB,WAAOlhE,GAAP,eAAA5E,EAAA,6DACLqqB,EAAe,EAAKA,IAAI/jB,KAAI,SAAAP,GAAC,OAAIA,EAAEoG,MAC3Bke,EAAIqE,WAAU,SAAA3oB,GAAC,OAAIA,IAAMnB,EAAGuH,MAC5B,GAAGke,EAAIvpB,KAAK8D,EAAGuH,IAHlB,SAIH4vD,EAAO8K,UAAU,EAAKv6D,OAAQ,EAAKwjC,IAAI3jC,GAAIke,GAJxC,OAKT,EAAKA,IAAIvpB,KAAK8D,GACU,IAApB,EAAKylB,IAAI3mB,QACT,EAAKijE,UAAU/hE,GAPV,2CAlHjB,wDA6HImhE,aA7HJ,uCA6HmB,WAAOnhE,GAAP,uBAAA5E,EAAA,sDACPqqB,EAAe,GADR,cAEG,EAAKA,KAFR,IAEX,4BAAShN,EAAe,SACdlR,KAAOvH,EAAGuH,IAAIke,EAAIvpB,KAAKuc,EAAElR,IAHxB,8CAKL4vD,EAAO8K,UAAU,EAAKv6D,OAAQ,EAAKwjC,IAAI3jC,GAAIke,GALtC,QAMP9jB,EAAQ,EAAK8jB,IAAIqE,WAAU,SAAA3oB,GAAC,OAAIA,EAAEoG,KAAOvH,EAAGuH,QACrC,GAAG,EAAKke,IAAIuJ,OAAOrtB,EAAO,GACjC,EAAKggE,QAAU,EAAKA,OAAOp6D,KAAOvH,EAAGuH,KACrC,EAAKo6D,YAASpnE,GATP,2CA7HnB,2JAMkCmN,GANlC,wEAOQ5N,KAAK4N,OAASA,EAPtB,SAQ6ByvD,EAAOH,KAAKl9D,KAAK4N,QAR9C,OAQQ5N,KAAK2lE,QARb,OASQ3lE,KAAK4tD,UAAU0X,IATvB,uIAgDsBp/D,GACdlG,KAAK6nE,OAAS3hE,EACd,IAAI2B,EAAQ7H,KAAK2rB,IAAIqE,WAAU,SAAA3oB,GAAC,OAAIA,EAAEoG,KAAOvH,EAAGuH,MAC5C5F,GAAS,GACT7H,KAAK2rB,IAAIuJ,OAAOrtB,EAAO,GAE3B7H,KAAK2rB,IAAIsJ,QAAQ/uB,OAtDzB,GAAmC6P,cAAnC,uCAGK7B,KAHL,iGAIKA,KAJL,oGAKKA,KALL,kE,oBCXMk0D,GAAa,YACbC,GAAW,YAEKC,GAAtB,iDACIC,WADJ,OAEC/wD,YAFD,2DAIE,OAAOgxD,KAAeC,qBAAqBzoE,KAAKwX,YAJlD,iEAOM7P,GAAsB,OAAO,MAPnC,KAUM+gE,G,kDAEF,WAAYp1D,GAAc,IAAD,8BACrB,gBAFJA,UACyB,IAIzBkE,OAAS,WACL,GAAgC,IAA5B,EAAKlE,KAAK2kB,OAAOjzB,OAAc,OAAO,KAC1C,IAAI2Y,EAAQ,EAAKrK,KAAKsK,MAAM,MAC5B,OAAO,mCAAGD,EAAM/V,KAAI,SAACP,EAAGlF,GAAJ,OAAuB,IAAbkF,EAAErC,OAC5B,sCAAU7C,GACV,8BAAckF,GAAJlF,SAPd,EAAKmR,KAAOA,EAFS,E,UAFDg1D,IAgBtBK,I,qDAIF,WAAYhhE,EAAaszB,GAAiB,IAAD,8BAC3C,gBAJDtzB,UAG4C,IAFzCszB,WAEyC,+CA6CpCx4B,QAAU,WACjB,IAAIoiB,EAAI,EAAK+jD,QACH,IAAN/jD,IACSA,EAAH,IAANA,EAAa,EACR,EACT,EAAKgkD,WAAWhkD,KAlD2B,EA0DzCrN,OAAsB,WAElB,IACIjU,EASNulE,EAAeh+D,EAVTgrC,EAAO,EAAK7a,MAAM,GAEVh0B,EAAI6uC,EAAKziC,QAAQ,MAC7B,GAAIpM,EAAI,EAAGA,OAAIxG,MACV,CACD,IAAI0W,EAAI2+B,EAAKziC,QAAQ,KACjB8D,EAAIlQ,IAAGA,EAAIkQ,GAsBnB,OApBA5T,EAAQuyC,EAAKvnC,UANJ,EAMkBtH,GAGZ,IAAjB,EAAK2hE,QACRE,EAAY,cAAC,KAAD,CAAInhE,KAAK,UAAUpF,UAAU,yBAEZ,IAAf,EAAKqmE,SACVE,EAAY,cAAC,KAAD,CAAInhE,KAAK,kBAAkBpF,UAAU,iBACjDuI,EAAU,qBAAK2C,GAAI,EAAKs7D,IAAd,SAEF,EAAK9tC,MAAMrzB,KAAI,SAACP,EAAGlF,GACf,OAAwB,IAApBkF,EAAE4wB,OAAOjzB,OAAqB,KAC3B,qBAAK3C,MAAO,CAAC2mE,WAAY,YAAzB,SAA+C3hE,GAAJlF,SAM9D2mE,EAAY,cAAC,KAAD,CAAInhE,KAAK,oBAAoBpF,UAAU,iBAEhD,qCACH,sBAAKkL,GAAI,EAAKw7D,KAAM1mE,UAAU,8BAA8BE,QAAS,EAAKA,QAA1E,UAAoFqmE,EAApF,IAA+F,4BAAIvlE,OAClGuH,MAxFX,EAAKnD,KAAOA,EACN,EAAKszB,MAAQA,EACb,EAAK2tC,QAAU,EAJsB,E,uDAQjC/jD,GACV7kB,KAAK4oE,QAAU/jD,EACf,IAAIhY,EAAKpB,SAASqB,eAAe9M,KAAKipE,MAClCC,EAASr8D,EAAGs8D,kBAChB,GAAID,EAAQ,CACX,IAAIE,EACJ,OAAQvkD,GACP,KAAK,EAAGukD,EAAK,0BAA2B,MACxC,KAAK,EAAGA,EAAK,uCAAwC,MACrD,KAAK,EAAGA,EAAK,qCAEdF,EAAO3mE,UAAY6mE,EAEpB,GAAU,IAANvkD,EAAS,CACF,IAAI/Z,EAAU09D,KAAeC,qBAAqB,qBAAKh7D,GAAIzN,KAAK+oE,IAAd,SAE3C/oE,KAAKi7B,MAAMrzB,KAAI,SAACP,EAAGlF,GACf,OAAwB,IAApBkF,EAAE4wB,OAAOjzB,OAAqB,KAC3B,qBAAK3C,MAAO,CAAC2mE,WAAY,YAAzB,SAA+C3hE,GAAJlF,SAIjEgnD,EAAQ19C,SAAS49D,cACvBlgB,EAAMmgB,WAAWz8D,GACjB,IAAMqI,EAAQi0C,EAAMogB,yBAAyBz+D,GAC7C+B,EAAG28D,WAAWC,aAAav0D,EAAOrI,EAAG68D,iBAEjC,CACJ,IAAI7kD,EAAIpZ,SAASqB,eAAe9M,KAAK+oE,KACjClkD,GACHA,EAAE2kD,WAAWG,YAAY9kD,M,2BAIvBld,GACJ,OAAO3H,KAAK2H,OAASA,I,mCAUrB,IAAIkF,EAAKpB,SAASqB,eAAe9M,KAAKipE,MAClCp8D,GACHA,EAAGlH,iBAAiB,QAAS3F,KAAKyC,W,2BAjDxB,MAAO,IAAMzC,KAAKuoE,Q,0BACnB,MAAO,IAAMvoE,KAAKuoE,U,GAXHD,I,uCAGtBp0D,K,kEAgGC01D,G,kDAEL,WAAYjiE,GAAc,IAAD,8BAAC,gBAD1BA,UACyB,EAAU,EAAKA,KAAOA,EAAtB,E,UAFD2gE,IAKnBuB,G,kDAEF,WAAY5nE,GAAiB,IAAD,8BAAC,gBAD7BA,WAC4B,IAC5BuV,OAAS,WACL,OAAO,sBAAKjV,UAAU,cAAf,UACH,cAAC,KAAD,CAAIoF,KAAK,uBADN,OAEF,EAAK1F,MAAMmiB,OAAOxG,MAAM,MAAMhW,KAAI,SAACP,EAAGQ,GAAJ,OAAY,eAAC,IAAMiiE,SAAP,WAA6BziE,EAAE,yBAAVQ,UAJtC,EAAK5F,MAAQA,EAAvB,E,UAFLqmE,IAWdyB,IAAb,cAYC,WAAYC,GAAmC,yBAXpC12D,UAWmC,OAVnCrM,OAUmC,OATnCg0B,WASmC,OARnCgvC,UAQmC,gFAJnCC,UAAoB,EAIe,0CAFtCF,sBAEsC,EAC7ChqE,KAAKgqE,iBAAmBA,EAb1B,gDAgBQ12D,GASA,GARAtT,KAAKiqE,MAAO,OACMxpE,IAAdT,KAAKsT,MACLtT,KAAKiH,EAAI,EACTjH,KAAKsT,KAAOA,GAGZtT,KAAKsT,KAAOtT,KAAKsT,KAAOA,IAExBtT,KAAKsT,KAAKtO,OAAS,IACvB,MAAqB,IAAdhF,KAAKiqE,MACRjqE,KAAKmqE,aACLnqE,KAAKoqE,YA5BjB,8BAgCiB92D,GACf,IAAM61C,EAAQ19C,SAAS49D,cACvBlgB,EAAMmgB,WAAWtpE,KAAKgqE,kBACtB,IAAM90D,EAAQi0C,EAAMogB,yBAAyBj2D,GAC7CtT,KAAKgqE,iBAAiBK,YAAYn1D,KApCpC,iCAuCuBo1D,GACfA,EAAQ/B,MAAQvoE,KAAKkqE,UACrBlqE,KAAKkqE,YACXlqE,KAAKuqE,SAASnoE,KAAKkoE,GAOnB,IAAI1X,EAAO0X,EAAQE,aACnBxqE,KAAKyqE,QAAQ7X,GACb0X,EAAQI,eAnDV,+BAsDqBrqE,GACb,IAAI4E,EAAMjF,KAAKsT,KAAKtO,OAAS3E,EAAM2E,OACnC,GAAIhF,KAAKiH,EAAIhC,EAAK,OAAO,EACzB,IAAK,IAAI9C,EAAE,EAAGA,EAAE8C,EAAK9C,IACjB,GAAInC,KAAKsT,KAAK+M,WAAWrgB,KAAKiH,EAAI9E,KAAO9B,EAAMggB,WAAWle,GAAI,OAAO,EAEzE,OAAO,IA5Df,8BAkEQ,IAFA,IAAIK,EAAe,GACrByC,EAAMjF,KAAKi7B,MAAMj2B,OACN7C,EAAE,EAAGA,EAAE8C,EAAK9C,IAAK,CACtB,IAAI+d,EAAKlgB,KAAKi7B,MAAM94B,GAChBkM,EAAM6R,EAAG7M,QAAQ,MACrB,GAAIhF,EAAM,EACN7L,GAAQ0d,MADZ,CAIA1d,GAAQ0d,EAAGhS,OAAO,EAAGG,GACrB,IAAK,IAAIonB,EAAE,EAAGA,EAAEtzB,EAAE,EAAGszB,IAAKz1B,KAAKi7B,MAAMxmB,QAErC,OADAzU,KAAKi7B,MAAMhG,QAAQ/U,EAAGhS,OAAOG,EAAI,IACzB7L,GACJ,QACZ,IAAK,GACW,OAAO,IAAImmE,GAAanmE,EAAMxC,KAAKi7B,OACvC,IAAK,QAED,OADAj7B,KAAK22B,UAAW,EACT,IAAIkzC,GAAa7pE,KAAKi7B,SAG/C,OAAO,IAAI2uC,GAAWpnE,KArFxB,mCAyFQ,QAAmB/B,IAAfT,KAAKi7B,YACSx6B,IAAdT,KAAKsT,KAAT,CACA,IAAIrM,EAAIjH,KAAKsT,KAAKD,QAAQg1D,GAAUroE,KAAKiH,GACzC,GAAIA,EAAI,EAAG,CACP,IAAgC,IAA5BjH,KAAK2qE,SAAStC,IAAoB,OAKtC,OAJAroE,KAAKi7B,MAAM74B,KAAgB,IAAXpC,KAAKiH,EAASjH,KAAKsT,KAAOtT,KAAKsT,KAAKpF,OAAOlO,KAAKiH,IAChEjH,KAAKiH,EAAI,EACTjH,KAAKsT,UAAO7S,OACZT,KAAKiqE,MAAO,GAGtBjqE,KAAKi7B,MAAM74B,KAAKpC,KAAKsT,KAAK/E,UAAUvO,KAAKiH,EAAGA,IAC5C,IAAI2jE,EAAM5qE,KAAKmN,QACf,QAAmB1M,IAAfmqE,EAAIpzD,OACPxX,KAAK6qE,WAAWD,QAKhB,IAFA,IAAI3lD,EAAK2lD,EAAmBjjE,KAEnBxF,EADCnC,KAAKuqE,SAASvlE,OACT,EAAG7C,GAAG,EAAGA,IAAK,CAC5B,IAAIyoE,EAAM5qE,KAAKuqE,SAASpoE,GACxB,GAAKyoE,IACe,IAAhBA,EAAIjyD,KAAKsM,GAAa,CACxB2lD,EAAqB/B,WAAW,GACjC,OAIG7oE,KAAKi7B,WAAQx6B,EACbT,KAAKiH,EAAIA,EAAI,KAtHrB,gCA0HQ,QAAkBxG,IAAdT,KAAKsT,KAAT,CACA,IAAIrM,EAAIjH,KAAKsT,KAAKD,QAAQ+0D,GAAYpoE,KAAKiH,GAC3C,GAAIA,EAAI,EAAG,CACP,IAAkC,IAA9BjH,KAAK2qE,SAASvC,IAAsB,OAKxC,OAJApoE,KAAK6qE,WAAW,IAAInC,GAAyB,IAAX1oE,KAAKiH,EAASjH,KAAKsT,KAAOtT,KAAKsT,KAAKpF,OAAOlO,KAAKiH,KAClFjH,KAAKiH,EAAI,EACTjH,KAAKsT,UAAO7S,OACZT,KAAKiqE,MAAO,GAGtB,IAAIW,EAAM5qE,KAAKsT,KAAK/E,UAAUvO,KAAKiH,EAAGA,GAChCjH,KAAK6qE,WAAW,IAAInC,GAAckC,IAClC5qE,KAAKiH,EAAIA,EAAI,EACbjH,KAAKi7B,MAAQ,QAvIrB,6CAKK/mB,KALL,yEAKoC,KALpC,uCAMKA,KANL,sGASEA,KATF,wEAS4C,MAT5C,ICrIa42D,GADZvvD,aACD,qDAGI,WAAYha,GAA2B,IAAD,8BAClC,cAAMA,IAHFwpE,oBAE8B,IAD9BC,iBAC8B,IAIjCC,eAAwB,EAJS,EAKjCC,YAAa,EALoB,EAyC9BC,YAAc,WACxB,IAA2B,IAAvB,EAAKF,cAAT,CACM,IAAIG,EAAO3/D,SAASqB,eAAe,aAC/BssC,EAAO,EAAKiyB,UAAUD,GACrBhyB,IACDA,EAAKtoB,WAAasoB,EAAK3nB,aAAe,EACtC,EAAK65C,cAGL,EAAKC,oBAlDyB,EAqD9BC,cAAgB,EArDc,EAsD9BzxD,SAAW,SAAChF,GAChB,IAAIlI,EAAKkI,EAAE4F,OACNmW,EAAyCjkB,EAAzCikB,UAAWW,EAA8B5kB,EAA9B4kB,aAAcV,EAAgBlkB,EAAhBkkB,aAC1BD,GAAa,EAAK06C,cAClB,EAAKC,0BAEA36C,EAAYC,EAAeU,EAAe,IAC/C,EAAKi6C,0BAGT,EAAKF,cAAgB16C,GAhEa,EA6E9B66C,eA7E8B,IA8EjCC,WA9EiC,IAsJ9BC,WAAa,SAACvB,EAAiBziE,GACnC,OAAO,cAACyiE,EAAQ9yD,OAAT,GAAqB8yD,EAAQ/B,QArJpC,EAAKwC,eAAiB,IAAIhB,QAAetpE,GAFP,EAH1C,sEASuC,IAAD,QACT,IAAvBT,KAAKirE,gBACTjrE,KAAKkrE,YAAa,OACOzqE,IAArBT,KAAKgrE,cACHhrE,KAAKgrE,YAAc3nE,aAAY,WACpC,IAAwB,IAApB,EAAK6nE,WAAT,CACS,IAAIE,EAAO3/D,SAASqB,eAAe,aACnCs+D,GAAQA,EAAK/tC,oBACd,SAjBX,8CAmBqC,IAAD,OAC5Bv3B,YAAW,WAChB,EAAKolE,YAAa,EAClB,EAAKD,eAAgB,OACIxqE,IAArB,EAAKuqE,cACT/nE,cAAc,EAAK+nE,aACnB,EAAKA,iBAAcvqE,KACjB,OA1BL,gDA6BET,KAAKkrE,YAAa,IA7BpB,gCA+BsBr+D,GACd,GAAKA,EACL,MAAmB,SAAfA,EAAG63B,QAA2B73B,EAC3B7M,KAAKqrE,UAAUx+D,EAAGi/D,iBAlCjC,oCAqCQ,IAAIV,EAAO3/D,SAASqB,eAAe,UACnCs+D,GAAQA,EAAK/tC,mBAtCrB,uCAyCQ,IAAI+tC,EAAO3/D,SAASqB,eAAe,aACnCs+D,GAAQA,EAAK/tC,mBA1CrB,mCAsEyB0uC,GACjB,IAAIC,EAAgBl5D,OAAOm5D,aAAP,MAAAn5D,OAAM,YAAiBi5D,IAC3C,IACI,OAAO5qC,mBAAmB5c,OAAOynD,IAErC,MAAO9pE,GACH,OAAO8pE,KA5EnB,oEAkFuBpiC,EAA8BmhC,GAlFrD,iHAmFkBnhC,EAAOsiC,OAnFzB,UAmFMhsE,EAnFN,OAoFaisE,EAAejsE,EAAfisE,KAAM10D,EAASvX,EAATuX,OACP00D,EArFZ,oBAsFYnsE,KAAK+qE,eAAe5nE,SAAW,IAAIyB,MAAOqO,UAAYjT,KAAK2rE,UAAU14D,UAtFjF,EAuFqCjT,KAAKuB,MAAzB6c,EAvFjB,EAuFiBA,YACY3d,KADJ0/D,EAvFzB,EAuFyBA,UAvFzB,iBAyFoBt7D,EAAMD,KAAKC,MAAQ,IAzFvC,cA0FoCs7D,GA1FpC,2DA0FyB5C,EA1FzB,aA2F4Bn/C,EA3F5B,OA4F6B,SA5F7B,QA6F6B,WA7F7B,gCA4FqCm/C,EAAQ6O,aAAevnE,EA5F5D,oCA6FuC04D,EAAQ8O,YAAcxnE,EA7F7D,0GAAAkQ,EAAA,oFAiGmB,GAjGnB,QAoGE,IADIu3D,EAAiB70D,EACZxQ,EAAE,EAAGA,EAAEqlE,EAAItnE,OAAQiC,GAAG,MAC1B2jE,EAAM0B,EAAI7tD,MAAMxX,EAAGA,EAAE,OACrBqM,EAAOtT,KAAKusE,aAAa3B,GAE7BG,EAAev3B,IAAIlgC,GACnBtT,KAAK4rE,OAASn0D,EAAM+0D,WAzGvB,0BA2Ge,GA3Gf,+RA+GQtpE,MAAIkP,gBAAJ,sBAAoB,sBAAA9Q,EAAA,2DACZ,EAAKypE,eAAe5nE,SAAS,GADjB,0CAC2B,GAD3B,gCAET,IAAIgI,SAAiB,SAACvJ,EAASC,GAClC,IACI,IAA8D,IAA1DqD,OAAOvB,QAAP,sBAAoB,EAAKpC,MAAMkrE,WAA/B,2DAAgE,CAChE,IACI,EAAKlrE,MAAMmrE,gBAAgBC,QAE/B,MAAOzqE,GACH4C,QAAQ7C,MAAMC,GAElBN,GAAQ,QAGRA,GAAQ,GAGhB,MAAOM,GACHL,EAAOK,QAlBC,4CAuBpBlC,KAAK0rE,0BAtIb,SAwIgB9hC,EAAS5pC,KAAKuB,MAAMoL,IAAIgT,KAAKitD,YACjC5sE,KAAK2rE,UAAY,IAAI/mE,KAC9B5E,KAAK4rE,MAAQ,EACT5B,EAAmBv+D,SAASqB,eAAe,aAC3Ci+D,EAAiB,IAAIhB,GAAeC,GA5I3C,wBA8IwBhqE,KAAK6sE,KAAKjjC,EAAQmhC,GA9I1C,YA+IgC,IA/IhC,qIAmJYjmE,QAAQ7C,MAAR,MAnJZ,yBAsJYjC,KAAK8sE,wBAtJjB,kKA4Jc,IAIRjqE,EAJO,EAC2B7C,KAAKuB,MAAhC2E,EADA,EACAA,GAAIumE,EADJ,EACIA,WAAYt0D,EADhB,EACgBA,QADhB,EAEmCnY,KAAK+qE,eAAxC5nE,EAFA,EAEAA,QACD4pE,GAAsB,IAHrB,EAEuBp2C,SACI,2BAAS,eAMzC,OAJO9zB,EAATsV,EAAkB,IAAMA,EAAU,KACxB,QACG1X,IAAPyF,IAAkBrD,GAAUqD,EAAGyB,KAAO,OAChD9E,GAAU4pE,GAActpE,GAAS,EAAG4pE,EAAS,aAChC,eAAC,OAAD,CAAMlqE,OAAQA,EAAQa,KAAK,QAAQqW,SAAU/Z,KAAK+Z,SAAlD,UACH,qBAAKtM,GAAG,WACR,qBAAKA,GAAG,YACJu/D,cAAehtE,KAAKmrE,YACpB5oE,UAAU,YACVF,MAAO,CAACC,SAAU,aAAc0mE,WAAY,YAG/C7lE,GAAS,EAAG,sBAAKZ,UAAU,YAAYF,MAAO,CAAC4wB,MAAO,MAAOg6C,WAAY,QAA7D,UACRR,EADQ,6CACW3oD,KAAKC,MAAM5gB,EAAQ,KAD9B,iBAEJ1C,EACT,qBAAKgN,GAAG,qBAhLpB,GAAuC/K,IAAMqvB,aAA7C,GCFam7C,GAAb,kDAGI,WAAY3rE,GAAsB,IAAD,8BAC7B,cAAMA,IAHFymC,eAEyB,IAOzBM,cAAgB,SAAC7tB,GAIrB,IAHA,IAAI0yD,EAAgB,GACf5kC,EAAS9tB,EAAIE,OAAb4tB,MACDtjC,EAAMsjC,EAAMvjC,OACP7C,EAAE,EAAGA,EAAE8C,EAAK9C,IACjBgrE,EAAQ/qE,KAAKmmC,EAAMpmC,IAEvB,EAAKmB,SAAS,CACVilC,MAAO4kC,KAfkB,EAsCzBC,UAAY,SAACzkC,GACjB,IAAI0kC,EAAK,IAAIxjC,WACbwjC,EAAGtjC,OAAS,SAAS9nB,GACjB/e,MAAId,KAAK,cAAC,GAAD,CAAQuF,KAAMghC,EAAKhhC,KAAMmD,QAAS9K,KAAKggB,WAEpDqtD,EAAGC,WAAW3kC,EAAM,SA3CS,EA6CzBqL,SAAW,SAACv5B,GAChBA,EAAI8e,kBA9CyB,EA2EzBg0C,SA3EyB,sBA2Ed,sBAAAjsE,EAAA,6DACf4B,MAAIiP,WADW,SAET,EAAK81B,SAFI,2CAzEf,EAAK7kC,MAAQ,CACTmlC,WAAO9nC,GAHkB,EAHrC,uDAqBekoC,EAAU9gC,GAA2B,IACvCF,EAAgCghC,EAAhChhC,KAAMqlB,EAA0B2b,EAA1B3b,KAAMwgD,EAAoB7kC,EAApB6kC,iBAcjB,OAAO,eAAC,MAAD,CAAKjrE,UAAU,YAAYsX,MAAO,cAAC,QAAD,UAbzC,WACI,IAAIoL,EAAUtG,EAUd,OATIqO,EAAO,MACP/H,EAAI+H,EAAMrO,EAAI,KAETqO,EAAO,SACZ/H,EAAInB,KAAK2pD,MAAOzgD,EAAO,KAAQ,KAAK,IAAKrO,EAAI,MAG7CsG,EAAInB,KAAK2pD,MAAOzgD,EAAO,KAAO,KAAQ,KAAK,IAAKrO,EAAI,KAEjDsG,EAAI,IAAMtG,EAE4B+uD,KAA1C,UACH,8BAAM/lE,IACN,8BAAK,eAAC,QAAD,wCAAa,cAAC,WAAD,CAAUqL,KAAMw6D,cAtC9C,6JAwDQ,IAHIjlC,EAAiBvoC,KAAKgoC,UAAUO,MAChCtrB,EAAO,IAAIyrB,SACXzjC,EAAMsjC,EAAMvjC,OACP7C,EAAE,EAAGA,EAAE8C,EAAK9C,IACbwmC,EAAOJ,EAAMpmC,GACjB8a,EAAKorB,OAAO,UAAWM,EAAMA,EAAKhhC,MA1D9C,OA6DYjG,EAAM08D,GAAMwC,SAAW,cAAgB5gE,KAAKuB,MAAM2E,GAAGuH,GAAK,UA7DtE,SA+DgBi/D,EAAkB,IAAIiB,gBA/DtC,SAgE4BnhE,MAAM9K,EAAK,CACvBZ,OAAQ,OACR6e,KAAM1C,EACN2wD,OAAQlB,EAAgBkB,SAnExC,OAgEgBjhE,EAhEhB,OAqEGzJ,MAAId,KAAK,cAAC,GAAD,6BAAuBpC,KAAKuB,OAA5B,IACIkrE,WAAW,eACXruD,OAAO,SACPzR,IAAKA,EAAK+/D,gBAAiBA,MAxE3C,kDA2EY5nE,QAAQ7C,MAAM,QAASP,EAAvB,MA3EZ,+IAkFc,IAEFmsE,EAOAr3B,EATC,OACAjO,EAASvoC,KAAKoD,MAAdmlC,MAcL,YAZc9nC,IAAV8nC,IACAslC,EAAW,cAAC,OAAD,CACPtrE,UAAU,OACVqS,MAAO2zB,EACPzhC,KAAM,CAAC0Q,OAAQxX,KAAK8tE,WAAYrrE,QAASzC,KAAKotE,mBAGxC3sE,IAAV8nC,GAAuBA,EAAMvjC,OAAS,IACtCwxC,EAAS,qBAAKj0C,UAAU,cAAf,SACL,wBAAQA,UAAU,kBAAkBC,KAAK,SAASC,QAASzC,KAAKutE,SAAhE,+BAGD,cAAC,OAAD,CAAM1qE,OAAQ,oBAAY7C,KAAKuB,MAAM2E,GAAGyB,KAAxC,SACH,sBAAKpF,UAAU,YAAf,UACI,uBAAMA,UAAU,OAAOwrE,QAAQ,sBAAsB/5B,SAAUh0C,KAAKg0C,SAApE,UACI,sBAAKzxC,UAAU,OAAf,UACd,wBAAQA,UAAU,0BACjBE,QAAS,kBAAI,EAAKulC,UAAUgmC,SAD7B,0DAEA,uBACC/7C,IAAK,SAAC+V,GAAD,OAAe,EAAKA,UAAUA,GACnCxlC,KAAK,OACLD,UAAU,iCACVoF,KAAK,QAAQihC,UAAU,EACvBpuB,SAAUxa,KAAKsoC,mBAEDulC,EACAr3B,KAEL,8BAAMx2C,KAAKoD,MAAM6qE,WACjB,8BAAMjuE,KAAKoD,MAAMkQ,gBAlHjC,GAA8B5Q,aA+HxBoB,GAAe,CACjBsa,OAAQ,OACRjG,QAAS,qBACT+1D,KAAM,2BACNC,WAAY,2BACZC,YAAa,qCACT,wHACA,oMACA,kJAIFC,GAAiB,CACnBjwD,OAAQ,SACRjG,QAAS,qBACT+1D,KAAM,2BACNC,WAAY,2BACZC,YAAa,qCACT,0JACA,kLACA,kJAIKE,GAAb,kDAEI,WAAY/sE,GAAuB,IAAD,EAE9B,OAF8B,qBAC9B,cAAMA,IAFDI,aACyB,IAY1B4sE,UAZ0B,sBAYd,sBAAAjtE,EAAA,6DAChB4B,MAAIiP,YACa,EAFD,SAGV,EAAKq8D,QADM,OAFD,2CAZc,EAiB1BC,oBAjB0B,sBAiBJ,sBAAAntE,EAAA,6DAC1B4B,MAAIiP,YACa,EAFS,SAGpB,EAAKq8D,QADM,MAFS,2CAflBjtE,EAAM6c,QACV,IAAK,OACD,EAAKzc,QAAUmC,GACf,MACJ,IAAK,SACD,EAAKnC,QAAU0sE,GAPO,SAFtC,6FAwB0BK,GAxB1B,gGAyBkD1uE,KAAK2B,QAA1CwW,EAzBb,EAyBaA,QAASiG,EAzBtB,EAyBsBA,OAAQ+vD,EAzB9B,EAyB8BA,WAAYD,EAzB1C,EAyB0CA,KAC9BxsE,EAAM08D,GAAMwC,SAAW,cAAgB5gE,KAAKuB,MAAM2E,GAAGuH,GAAK,IAAM2Q,GAE/C,IAAjBswD,GACAjC,EAAa0B,EACbzsE,GAAO,eAGP+qE,EAAayB,EAjCzB,SAoCgBxB,EAAkB,IAAIiB,gBApCtC,SAqC4BnhE,MAAM9K,EAAK,CACvBZ,OAAQ,OACR8sE,OAAQlB,EAAgBkB,SAvCxC,OAqCgBjhE,EArChB,OAyCGzJ,MAAId,KAAK,cAAC,GAAD,6BAAuBpC,KAAKuB,OAA5B,IACR4W,QAASA,EACGiG,OAAQA,EACRquD,WAAYA,EACZ9/D,IAAKA,EAAK+/D,gBAAiBA,MA7C3C,kDAgDY5nE,QAAQ7C,MAAM,QAASP,EAAvB,MAhDZ,gJAmDc,IAAD,EAC0C1B,KAAK2B,QAA/CwW,EADA,EACAA,QAAS+1D,EADT,EACSA,KAAMC,EADf,EACeA,WAAYC,EAD3B,EAC2BA,YAChC,OAAO,cAAC,OAAD,CAAMvrE,OAAQsV,EAAU,MAAQnY,KAAKuB,MAAM2E,GAAGyB,KAA9C,SACH,sBAAKpF,UAAU,mBAAf,UACI,oBAAIA,UAAU,OAAd,SAAsB6rE,IACtB,sBAAK7rE,UAAU,aAAf,UACI,wBAAQA,UAAU,kBAAkBC,KAAK,SAASC,QAASzC,KAAKuuE,UAAhE,SAA4EL,IAC5E,qBAAK3rE,UAAU,qBACf,wBAAQA,UAAU,0BACdC,KAAK,SAASC,QAASzC,KAAKyuE,oBADhC,SACsDN,gBA5D1E,GAA8BzrE,aAuExBisE,G,uKAEE,OAAO,cAAC,OAAD,CAAM9rE,OAAQ7C,KAAKuB,MAAMoG,KAAzB,SACH,qBAAKpF,UAAU,YAAf,SAA4BvC,KAAKuB,MAAMuJ,gB,GAH9BpI,a,SCrOfsjE,GAAgB,SAACl/D,GAAoB,IAClCqqC,EAA0BrqC,EAA1BqqC,YAAa80B,EAAan/D,EAAbm/D,MAAOtC,EAAM78D,EAAN68D,GACzB,OAAO,qCAAGxyB,EAAH,IAAiB80B,EAAjB,IAAyBtC,MAG9BiL,GAAiC,CACnCz2D,QAAS,iCACTisD,kBAAmB,iCACnBD,eAAe,WAAD,4BAAE,WAAOxjE,EAAYgG,GAAnB,SAAArF,EAAA,sEACN88D,GAAMpB,IAAI2D,aAAaxiB,MAAMx3C,GADvB,gCAELy3D,GAAMpB,IAAI2D,aAAa/rD,OAFlB,2CAAF,qDAAC,GAIfuxD,eAAe,WAAD,4BAAE,sBAAA7kE,EAAA,sEACN88D,GAAMpB,IAAI2D,aAAa9zC,OADjB,2CAAF,kDAAC,GAGfxI,IAAK,SAACvd,EAAgBe,GAClB,OAAO,qBAAKtF,UAAU,YAAf,SAA2B,cAAC,GAAD,gBAAmBuE,QAuBvD4yB,GAAa,SAAC5yB,GACnB,MAAO,CACN2G,GAAI3G,EAAK2G,GACT0K,QAAS,cAAC,GAAD,gBAAmBrR,MAIxB+yB,GAAa,SAACpsB,GAAD,OAAa8mB,EAAO0pC,QAAQh+D,IAAIwN,IAE7CohE,GAAY,CACd34D,MAAO,iCACPoN,MA5BsB,CAAC3b,KAAM,SAAUnF,KAAM,MA6B7Csf,KAAM,CACFtf,KAAM,UACNs3B,YAAa,mDACbL,KAAM4qC,GAAauK,IACnBl1C,WAAYA,GACZG,WAAYA,KAIdi1C,GAAgB,CAClB54D,MAAO,iCACPoN,MAvC0B,CAAC3b,KAAM,aAAcnF,KAAM,MAwCrDsf,KAAM,CACFtf,KAAM,UACNs3B,YAAa,mDACbL,KAAM4qC,GAAauK,IACnBl1C,WAAYA,GACZG,WAAYA,KAedk1C,GAAQ,CACV74D,MAAO,iCACPoN,MA7DkB,CAAC3b,KAAM,KAAMnF,KAAM,SAAU0Y,UAAU,GAAI8c,UAAU,IA2E9Dg3C,GAAb,4MACYC,eADZ,IAEY/6B,SAAqB,CAG/B26B,GACAC,GAEMC,IARR,EAcY/6B,SAdZ,uCAcuB,WAAOxvB,GAAP,SAAAljB,EAAA,6DAOfkjB,EAAOhiB,KAAO,EACdgiB,EAAO0qD,KAAO,EAAKx2D,WAAWxS,GAAGuH,GARlB,SASC,EAAKiL,WAAW0nD,YAAY57C,GAT7B,UAUH,IAVG,+DAkBfthB,MAAIqC,MAlBW,8DAdvB,wDAmCYyS,KAAO,WACX,OAAO,cAAC,OAAD,CAAMnV,OAAO,sBAAb,SACH,cAAC,aAAD,CAAWovB,IAAK,SAAAhc,GAAC,OAAE,EAAKg5D,UAAUh5D,GAAG1T,UAAU,MAAM2xC,SAAU,EAAKA,SAAUF,SAAU,EAAKA,cArCzG,+JAYQh0C,KAAK2X,SAAS3X,KAAKgY,MAZ3B,2GAAoCsB,SClGvB61D,IAAb,2PA2BYC,YA3BZ,uCA2B0B,WAAO33D,EAAW43D,GAAlB,SAAA/tE,EAAA,sEACF,EAAKguE,WAAW,KAAM73D,GADpB,UAEN,IAFM,gDAGP,0CAHO,OAKlB,EAAK8lD,QAAQ7/C,GAAKjG,EALA,2CA3B1B,0DAkCY83D,aAlCZ,sBAkC2B,4BAAAjuE,EAAA,sEACH,EAAKoX,WAAW82D,aADb,OACftvE,EADe,OAEnB,EAAKovE,WAAW,SAAUpvE,GAC1B,EAAKq9D,QAAQQ,OAAS79D,EAHH,2CAlC3B,EAuCYuvE,iBAvCZ,sBAuC+B,4BAAAnuE,EAAA,sEACP,EAAKoX,WAAW82D,aADT,OACnBtvE,EADmB,OAEvB,EAAKovE,WAAW,cAAepvE,GAC/B,EAAKq9D,QAAQmS,WAAaxvE,EAHH,2CAvC/B,EA4CYyvE,cA5CZ,sBA4C4B,sBAAAruE,EAAA,0DACkC,IAAlD4D,OAAOvB,QAAQ,+IADC,iEAEd,EAAK+U,WAAW2nD,WAAW,EAAK9C,SAFlB,OAGpBr6D,MAAIqC,MAHgB,2CA5C5B,EAiDYyS,KAAOuD,cAAS,WAAO,IACtBrV,EAAM,EAAKwS,WAAXxS,GACDoyB,EAAc,CACd,GACA,CACI91B,KAAM,SACNmF,KAAM,KACNuO,MAAO,2BACPzT,QAAS,kBAAIS,MAAId,KAAK,cAAC,GAAD,CAClBmB,MAAM,iCACNkU,MAAO,EAAK8lD,QAAQ7/C,GACpBmjC,UAAW,EAAKuuB,iBAExB,GACA,CACI5sE,KAAM,YACN0T,MAAO,iCACP+jB,UAAW,cAAC,GAAD,CAAYxsB,GAAI,EAAK8vD,QAAQQ,SACxCt7D,QAAS,EAAK8sE,cAElB,CACI/sE,KAAM,YACN0T,MAAO,iCACP+jB,UAAW,cAAC,GAAD,CAAYxsB,GAAI,EAAK8vD,QAAQmS,aACxCjtE,QAAS,EAAKgtE,mBAwBlB51D,EAAQ,wBAAQpX,QAAS,EAAKktE,cAC9BptE,UAAU,2CADF,0BAEZ,OAAO,cAAC,OAAD,CAAMM,OAAQ,QAAUqD,EAAGyB,KAAMkS,MAAOA,EAAxC,SACH,cAAC,WAAD,CAAUye,KAAMA,EAAM9T,OAAQ,EAAK+4C,eApG/C,4FAEeA,GAFf,iEAGQv9D,KAAKu9D,QAAUA,EACfv9D,KAAK2X,SAAS3X,KAAKgY,MAJ3B,iLAM6BtC,EAAa+B,GAN1C,iFAOqBzX,KAAK0Y,WAAW4nD,kBAAkBtgE,KAAKu9D,QAAS7nD,EAAM+B,GAP3E,sJAAiC6B,SAAjC,uCACKpF,KADL,kECLMggC,GAAW,CACb,CACIh+B,MAAO,eACPoN,MAAO,CAAC3b,KAAM,OAAQnF,KAAM,SAAU0Y,UAAW,IAAK8c,UAAU,IAEpE,CACI9hB,MAAO,eACPoN,MAAO,CAAC3b,KAAM,cAAenF,KAAM,SAAU0Y,UAAW,KACxD4G,KAAM,CAACtf,KAAM,cAUC0jE,GAAtB,4MAIclyB,SAJd,uCAIyB,WAAOxvB,GAAP,SAAAljB,EAAA,sEACX,EAAKoX,WAAWymD,OAAO36C,GADZ,cAEjBthB,MAAIqC,MAFa,8DAJzB,wDAScyS,UATd,iKAEQhY,KAAK2X,SAAS3X,KAAKgY,MAF3B,iIAUmBi8B,GACX,OAAO,cAAC,aAAD,CACH1xC,UAAU,MACV2xC,SAAUA,GACVF,SAAUh0C,KAAKg0C,SAAUC,WAAYA,QAdjD,GAA2C36B,SAkB9BitD,GAAb,4MACcvuD,KAAO,WAAO,IACf9R,EAAM,EAAKwS,WAAXxS,GACAyB,EAAQzB,EAARyB,KACL,OAAO,cAAC,OAAD,CAAM9E,OAAQ,oBAAY8E,EAAMjE,KAAK,QAArC,SACF,EAAKs3B,KAAK90B,MALvB,YAA8BggE,IAUjBM,GAAb,4MACcxuD,KAAO,WACb,OAAO,cAAC,OAAD,CAAMnV,OAAQ,iBAAQa,KAAK,QAA3B,SACF,EAAKs3B,KAAK,OAHvB,YAA6BkrC,ICxChB0J,GAAb,4MAKYhJ,SALZ,sBAKuB,sBAAAtlE,EAAA,sEACT,EAAKssD,UAAU2Y,IADN,2CALvB,EAUYM,WAVZ,sBAUyB,sBAAAvlE,EAAA,0DACmB,IAAhC4D,OAAOvB,QAAQ,gDADF,gCAEP,EAAK+U,WAAWm3D,WAFT,OAGb3sE,MAAIqC,MAHS,2CAVzB,EAiBYyS,KAAOuD,cAAS,WAAmB,IA8DnCu0D,EACAC,EA6BAC,EA5FkC,EAC8C,EAAKt3D,WAApFu3D,EADiC,EACjCA,WAAYC,EADqB,EACrBA,SAAUC,EADW,EACXA,WAAYC,EADD,EACCA,cAAeC,EADhB,EACgBA,aAAcnqE,EAD9B,EAC8BA,GAAIi6D,EADlC,EACkCA,SAEnErD,EADQsB,GAAR79D,KACAu8D,QACAn1D,EAA0DzB,EAA1DyB,KAAMwpC,EAAoDjrC,EAApDirC,YAAkBvjC,EAAkC1H,EAAvC3F,KAAagiE,EAA0Br8D,EAA1Bq8D,UAAWC,EAAet8D,EAAfs8D,YAC5CrpB,EAAO,gCACP,8BAAMhI,IACN,cAAC,GAAD,CAASqxB,YAAaA,EAAaD,UAAWA,OAE9CwE,EAAY,CACZ,CAAC5uD,QAAQ,iBAAQiG,OAAO,EAAKwoD,SAAU51D,KAAK,QAC5C,CAACmH,QAAQ,eAAMiG,OAAO,EAAKyoD,WAAY71D,KAAK,YAE5C6I,EAAQijD,EAAQ,GAAK,cAAC,kBAAD,CAAiBv6D,UAAU,mBAAmB0qC,QAAS85B,IAC5EuJ,EAAQ,cAAC,KAAD,CAAI/tE,UAAU,oBAAoBoF,KAAK,gBAC/CyW,EAAS,SAACpN,EAAau/D,EAAer6D,EAAczT,GACpD,MAAO,CACHD,KAAM,YACN0T,WAAOzV,EACPw5B,UAAW,cAAC,MAAD,CAAKx3B,QAASA,EAASF,UAAU,4BACxCkF,KAAM,uBAAMlF,UAAU,oBAAhB,UAAoC,cAAC,KAAD,CAAIA,UAAWguE,EAAQ5oE,KAAMqJ,EAAMyiB,UAAU,IAAjF,SAAkGvd,KAAe2D,MAAOy2D,MAGtIh4C,EAAc,CACd,GACA,CACI91B,KAAM,YACNy3B,UAAW,eAAC,MAAD,CAAK13B,UAAU,OACtBkF,KAAM,cAAC,KAAD,CAAIE,KAAK,WAAWpF,UAAU,4BAD7B,UAEP,8BAAK,4BAAIoF,MACRwxC,MAGT,CACI32C,KAAM,YACN0T,MAAO,qBACP+jB,UAAW,qBAAK13B,UAAU,OAAf,SAAsB,cAAC,GAAD,CAAUkL,GAAIG,EAAQ80D,QAAQ,OAEnE,GACAtkD,EAAO,OAAQ,YAAa,yCAAY6xD,GAOxC7xD,EAAO,WAAY,eAAgB,wDAAiB8xD,GAOpD9xD,EAAO,WAAY,eAAgB,wDAAiB+xD,IAWxD,GAAIrT,EAAU,EAAG,CACbiT,EAAgB,wBACZxtE,UAAU,iCACVE,QAAS,kBAAI,EAAKiW,WAAW83D,sBAFjB,0BAKhB,IAAIC,EAAU,EAAK/3D,WAAWg4D,OAAOruC,QAAO,SAAAh7B,GAAC,OAAgB,IAAZA,EAAEy1D,WACnDgT,EAAW,qCACP,sBAAKvtE,UAAU,wCAAf,UACI,cAAC,QAAD,CAAOF,MAAO,CAACylC,QAAQ,QAAS4sB,KAAK,GAArC,gCACA,wBACInyD,UAAU,iCACVE,QAAS2tE,EAFb,6BAMJ,qBAAK7tE,UAAU,sCAAf,SAE2B,IAAnBkuE,EAAQzrE,OACR,qBAAKzC,UAAU,mBAAf,sBAEAkuE,EAAQ7oE,KAAI,SAACP,GACT,OAAO,qBAAoB9E,UAAU,YAA9B,SAA2C8E,EAAE4J,MAAQ5J,EAAEM,MAA7CN,EAAEpG,gBASvC,OAFI67D,EAAQ,IAAGkT,EAAiBK,GAEzB,eAAC,OAAD,CAAMxtE,OAAQ,QAAU8E,EAAMkS,MAAOA,EAArC,UACH,cAAC,WAAD,CAAUye,KAAMA,EAAM9T,OAAQte,IAC7B4pE,EACD,sBAAKvtE,UAAU,wCAAf,UACI,cAAC,QAAD,CAAOF,MAAO,CAACylC,QAAQ,QAAS4sB,KAAK,GAArC,qBACCqb,KAEL,cAAC,OAAD,CAAMn7D,MAAOurD,EAAUr5D,KAAM,CACrC0Q,OAAO,SAAC+lD,EAAoB11D,GAArB,OACNnF,gBAAoB,EAAKiuE,cAAe,CAACpT,UAAS11D,WACvCpF,QAAQutE,WA1HxB,EA8HYW,cAAgBp1D,cAAS,SAACha,GAA2D,IACpFg8D,EAAWh8D,EAAXg8D,QACA7/C,EAAuE6/C,EAAvE7/C,GAAsBqgD,EAAiDR,EAAjDQ,OAAQ2R,EAAyCnS,EAAzCmS,WAAYtD,EAA6B7O,EAA7B6O,aAAcC,EAAe9O,EAAf8O,YACzDmC,EAAWpC,EAGX,cAAC,WAAD,CAAUp5D,KAAMo5D,IAFhB,cAAC,QAAD,iCAGAiC,EAAUhC,EAGV,cAAC,WAAD,CAAUr5D,KAAMq5D,IAFhB,cAAC,QAAD,iCAIJ,OAAO,sBAAK9pE,UAAU,8CAAf,UACH,gCAAK,mEAAqBmb,KAC1B,cAAC,MAAD,CAAKnb,UAAU,qBACXsX,MAAO,gCAAQw0D,IADnB,SAEI,gCACI,uDACA,cAAC,GAAD,CAAY5gE,GAAIswD,SAGxB,cAAC,MAAD,CAAKx7D,UAAU,qBACXsX,MAAO,gCAAQ20D,IADnB,SAEI,gCACI,uDACA,cAAC,GAAD,CAAY/gE,GAAIiiE,eAvJpC,+JAEQ1vE,KAAKyZ,gBAAgB/W,gBAAoB1C,KAAKgY,OAFtD,2GAA4BsB,SCDfs3D,GAAb,4MAIYnL,QAAU,WACd,EAAK/sD,WAAWxS,QAAKzF,EACrB,EAAKmtD,UAAU4Y,KANvB,EAQYqK,aAAe,WACnB,EAAKl5D,SAAS,EAAKm5D,mBAT3B,EAWY94D,KAAO,WAAmB,IAAD,EACM,EAAKU,WAA3BuN,EADgB,EACxB8qD,OAAcnL,EADU,EACVA,aACd9I,EAAWsB,GAAM79D,KAAjBu8D,QACD7vB,EAA2B,CAC3B,CAACj8B,KAAK,OAAQmH,QAAQ,iBAAQiG,OAAQ,EAAKqnD,SAC3C,CAACz0D,KAAK,OAAQmH,QAAQ,2BAAQiG,OAAQ,EAAKyyD,eAE3Ch3D,EAAQijD,EAAQ,GAChB,cAAC,kBAAD,CAAiBv6D,UAAU,qCAAqCyO,KAAK,OAAOi8B,QAASA,EAArF,SACI,wBAAQ1qC,UAAU,yBAAyBE,QAAS,kBAAI,EAAKgjE,WAA7D,SAAwE,cAAC,KAAD,CAAI99D,KAAK,aAEzF,OAAO,cAAC,OAAD,CAAM9E,OAAO,KAAKgX,MAAOA,EAAzB,SACH,cAAC,OAAD,CAAMjF,MAAOqR,EAAMnf,KAAM,CAAC0Q,OAAQ,EAAKw5D,QAASvuE,QAASmjE,QAvBrE,EA0BYoL,QAAU,SAAClqE,GAA4B,IACtCa,EAAiDb,EAAjDa,KAAMwpC,EAA2CrqC,EAA3CqqC,YAAa22B,EAA8BhhE,EAA9BghE,cAAetF,EAAe17D,EAAf07D,YACvC,OAAO,cAAC,MAAD,CAAKjgE,UAAU,+BAClBkF,KAAM,cAAC,KAAD,CAAIE,KAAK,WAAWpF,UAAU,uBACpCsX,MAAO,sBAAKtX,UAAU,aAAf,UACH,gCAAK,uBAAOA,UAAU,aAAjB,iCAAL,IAAiDulE,KACjD,qBAAKvlE,UAAU,mBAAf,SAAkC,cAAC,WAAD,CAAUyQ,KAAMwvD,SAJnD,SAMH,sBAAKjgE,UAAU,YAAf,UACI,8BAAK,4BAAIoF,MACT,8BAAK,cAAC,QAAD,UAAQwpC,YApC7B,EAyCYsjB,SAAW,SAAC3tD,EAAY+gC,EAAoBwtB,KAzCxD,EA6CY4b,eAAiB,SAACnqE,GAA4B,IAC7Ca,EAAkCb,EAAlCa,KAAMwpC,EAA4BrqC,EAA5BqqC,YAAaqxB,EAAe17D,EAAf07D,YACxB,OAAO,cAAC,MAAD,CAAKjgE,UAAU,+BAClBkF,KAAM,cAAC,KAAD,CAAIE,KAAK,WAAWpF,UAAU,oBACpCsX,MAAO,qBAAKtX,UAAU,aAAf,SACH,qBAAKA,UAAU,mBAAf,SAAkC,cAAC,WAAD,CAAUyQ,KAAMwvD,QAHnD,SAKH,sBAAKjgE,UAAU,YAAf,UACI,8BAAK,4BAAIoF,MACT,8BAAK,cAAC,QAAD,UAAQwpC,YAtD7B,EA2DYlrB,UA3DZ,IA4DY4vC,UAAY,WAChB,EAAK5vC,KAAK4vC,aA7DlB,EA+DYC,YAAc,WAClB,EAAK7vC,KAAK6vC,eAhElB,EAkEYhyD,KAAO,WACX,EAAK0qE,QAAQ,QAAQ,IAnE7B,EAqEY0C,eAAiB,WACrB,EAAK1C,QAAQ,QAAQ,IAtE7B,EAwEYH,OAAS,WACb,EAAKG,QAAQ,UAAU,IAzE/B,EA2EY2C,iBAAmB,WACvB,EAAK3C,QAAQ,UAAU,IA5E/B,EAmHYsC,iBAAmB,WAAmB,IAC7B7qD,EAAQ,EAAKvN,WAArBq4D,OACDl3D,EAAQ,iCACR,wBAAQtX,UAAU,sBAAsBE,QAAS,EAAKozD,UAAtD,0BACA,wBAAQtzD,UAAU,sBAAsBE,QAAS,EAAKqzD,YAAtD,6BAEAsb,EAAQ,sCACRC,EAAM,uBAAM9uE,UAAU,yBAAhB,UACN,uBAAMA,UAAU,cAAhB,UACI,wBAAQA,UAAW6uE,EAAO3uE,QAAS,EAAKqB,KAAxC,0BACA,wBAAQvB,UAAW6uE,EAAO3uE,QAAS,EAAK4rE,OAAxC,0BACA,wBAAQ9rE,UAAW6uE,EAAO3uE,QAAS,EAAKyuE,eAAxC,sCACA,wBAAQ3uE,UAAW6uE,EAAO3uE,QAAS,EAAK0uE,iBAAxC,yCAEHt3D,KAGL,OAAO,cAAC,OAAD,CAAMhX,OAAO,2BAAOiX,OAAQu3D,EAA5B,SACH,cAAC,OAAD,CAAMp/C,IAAK,SAAAhM,GAAI,OAAE,EAAKA,KAAOA,GAAMrR,MAAOqR,EAAMnf,KAAM,CAAC0Q,OAAQ,EAAKy5D,eAAgBxc,SAAU,EAAKA,eArI/G,4FACep9C,GADf,iEAEQrX,KAAK2X,SAAS3X,KAAKgY,MAF3B,8KA8E0BoG,EAAwB+vD,GA9ElD,iFA+EYmD,EAActxE,KAAKimB,KAAKguC,cAExBvyD,EAAM08D,GAAMwC,SAAW,mBAjFnC,KAmFgBxiD,EAnFhB,OAoFiB,SApFjB,OAqFiB,WArFjB,6BAoFyBquD,EAAa,eApFtC,kCAqF2BA,EAAa,eArFxC,2CAwFgBC,EAAkB,IAAIiB,gBACtBhuD,EAAO,CACP7b,KAAiB,SAAXsa,EACN+vD,WAAYA,EACZxiD,IAAK2lD,EAAY1pE,KAAI,SAAAP,GAAC,OAAIA,EAAEoG,OA5F5C,UAgG4BjB,MAAM9K,EAAK,CACvBZ,OAAQ,OACR8sE,OAAQlB,EAAgBkB,OACxBhlD,QAAS,CAEL,eAAgB,oBAEpBjJ,KAAMzS,KAAKkE,UAAUuO,KAvGrC,QAgGgBhT,EAhGhB,OAyGYzJ,MAAId,KAAK,cAAC,GAAD,CAAmB8D,QAAIzF,EAAW0/D,cAAU1/D,EACjD2d,OAAQA,EACRquD,WAAYA,EACZ9/D,IAAKA,EAAK+/D,gBAAiBA,KA5G3C,kDA+GY5nE,QAAQ7C,MAAM,QAASP,EAAvB,MA/GZ,wHAA8B4X,SCJjBi4D,GAAb,4MAMY9c,SANZ,uCAMuB,WAAO+c,EAAW3pC,GAAlB,SAAAvmC,EAAA,sEACT,EAAKoX,WAAW+4D,WAAWD,EAAO3pC,GADzB,2CANvB,0DAUY7vB,KAAO,WAAmB,IAAD,EACN,EAAKU,WAAvBg4D,EADwB,EACxBA,OAAQgB,EADgB,EAChBA,OACTzd,EAAgByd,EAAOC,KAAKtvC,QAAO,SAAAh7B,GAAC,YAA4C5G,IAAxCiwE,EAAOtpE,MAAK,SAAAmO,GAAC,OAAIA,EAAEtU,SAAWoG,EAAEoG,SACxEmkE,EAAa,qBAAKrvE,UAAU,6BAAf,gCACjB,OAAO,cAAC,OAAD,CAAMM,OAAO,iCAAb,SACH,sBAAKN,UAAU,OAAf,UACKqvE,EACD,cAAC,OAAD,CACIh9D,MAAO88D,EAAOC,KACdt7B,KAAK,WACL4d,cAAiBA,EACjBntD,KAAM,CAAC2tD,SAAU,EAAKA,SAAUj9C,OAAQ,EAAK6M,aArBjE,EA2BYA,IAAM,YAAmC,IAAjCrT,EAAgC,EAAhCA,KAAMrJ,EAA0B,EAA1BA,KAAMsJ,EAAoB,EAApBA,KACpBnG,EAAUmG,EACV,qCAAE,4BAAIA,IAAN,SAAuB,uBAAO1O,UAAU,aAAjB,SAA+BoF,OAEtD,4BAAIA,IACJF,EAAO,cAAC,QAAD,CAAOlF,UAAU,gBAAgBsQ,IAAK7B,IACjD,OAAO,cAAC,MAAD,CAAKzO,UAAU,gCAAgCkF,KAAMA,EAArD,SACH,qBAAKlF,UAAU,OAAf,SAAuBuI,OAlCnC,+KAEc9K,KAAK0Y,WAAWm5D,aAF9B,OAGQ7xE,KAAK2X,SAAS3X,KAAKgY,MAH3B,2GAAkCsB,SCGrBw4D,GAAb,4MACIre,eADJ,IAaI/Z,SAbJ,uCAae,WAAO/yC,GAAP,SAAArF,EAAA,sEACD,EAAKmyD,UAAUtV,MAAMx3C,GADpB,2CAbf,8NAIQ3G,KAAKyzD,UAAY,IAAIse,GAJ7B,oPAQQ/xE,KAAKyzD,UAAY,IAAIse,GAR7B,SASc/xE,KAAKyzD,UAAUtV,MAAM,IATnC,uBAUqBn+C,KAAK6Y,MAAMm5D,IAVhC,mJAAiC3P,IAkB3B0P,G,mNAC0B16D,EAAW0Q,EAAeC,G,gFAC9Cpa,EAASwwD,GAAM79D,KAAKkN,G,SACR4vD,EAAOsD,aAAa/yD,EAAQyJ,EAAO0Q,EAAWC,G,cAA1D9nB,E,yBACH,CAAC+sB,MAAO/sB,I,yIAEU4G,GACnB9G,KAAK+nB,eAAqBtnB,IAATqG,EAAoB,EAAIA,EAAK2G,O,GAPxBmf,aAWxBolD,G,4MAKMC,aAAe,SAAClU,EAAkBl2D,GACtC,OAAO,qBAAKtF,UAAU,YAAf,SAA2B,cAAC,GAAD,CAAYkL,GAAIswD,EAAOtwD,Q,EAGrDykE,YAAc,SAACnU,GACnB,EAAKxlD,YACL,EAAKO,WAAWilD,EAAOtwD,K,EAGtB0kE,kBAAoB,WACrB,EAAK55D,YACL,EAAKO,WAAW,O,EAGZd,KAAOuD,cAAS,WACpB,IAAI62D,EAAY,cAAC,YAAD,CAAWl8D,MAAM,iCAAQwjC,SAAU,EAAKhhC,WAAWghC,WACnE,OAAO,eAAC,OAAD,CAAM72C,OAAQuvE,EAAd,UACZ,sBAAK7vE,UAAU,kDACdE,QAAS,EAAK0vE,kBADf,UAEC,sBAAM5vE,UAAU,mBAAhB,kBACA,uBAAOA,UAAU,aAAjB,iDAEQ,cAAC,OAAD,CAAMqS,MAAO,EAAK8D,WAAW+6C,UAAU7+C,MACnC9N,KAAM,CAAC0Q,OAAO,EAAKy6D,aAAcxvE,QAAQ,EAAKyvE,qB,+JA1BtDlyE,KAAK2X,SAAS3X,KAAKgY,M,2GAFDsB,SChCb+4D,IAAb,cAGI,WAAY9xE,GAA4B,yBADhCA,UAC+B,yIAEnCP,KAAKO,KAAOA,EALpB,mLAeqBE,KADTF,EAAOP,KAAKO,MAdxB,yDAgBwBE,IAAZF,EAAKkN,GAhBjB,yDAiB4BhN,IAAhBT,KAAK0xE,OAjBjB,iEAkBwBjV,EAAQ6V,WAAW/xE,EAAKkN,IAlBhD,OAkBY2iB,EAlBZ,OAmBYmiD,EAAqB,GACrBb,EAAqB,GACrBC,EAAmB,GACvBvhD,EAAI9a,SAAQ,SAAAk9D,GAAO,IACV1V,EAA2B0V,EAA3B1V,QAASC,EAAkByV,EAAlBzV,QAAkByV,EAATr8D,MAEnBw7D,EAAKvvE,KAAKowE,IAEM,IAAZ1V,GAAeyV,EAAOnwE,KAAKowE,GACf,IAAZzV,GAAe2U,EAAOtvE,KAAKowE,OAGvCxyE,KAAKuyE,OAASA,EACdvyE,KAAK0xE,OAASA,EACd1xE,KAAK2xE,KAAOA,EAjCpB,gJAoC+Bt9D,EAAkBo+D,GACzC,IAAI5qE,EAAQwM,EAAI2b,WAAU,SAAA3oB,GAAC,OAAIA,EAAEoG,KAAKglE,EAAUhlE,MAC5C5F,GAAQ,GAAGwM,EAAI6gB,OAAOrtB,EAAO,KAtCzC,sCAyC4B4qE,QACFhyE,IAAdgyE,IAAyBA,EAAYzyE,KAAKs+D,KAC9Ct+D,KAAK0yE,mBAAmB1yE,KAAKuyE,OAAQE,GACrCzyE,KAAK0yE,mBAAmB1yE,KAAK0xE,OAAQe,GACrCzyE,KAAK0yE,mBAAmB1yE,KAAK2xE,KAAMc,KA7C3C,4EAgDuB3V,EAAgBC,EAAgB5mD,GAhDvD,kFAiDYmoD,EAAMt+D,KAAKs+D,IACXqU,EAAWrU,EAAI7wD,GAAIG,EAAS5N,KAAKO,KAAKkN,GAlDlD,SAmDcgvD,EAAQmW,aAAaD,EAAU/kE,EAAQkvD,EAASC,EAAS5mD,GAnDvE,OAoDQmoD,EAAIxB,QAAUA,EACdwB,EAAIvB,QAAUA,EACd/8D,KAAK6yE,kBACW,IAAZ/V,GAA6B,IAAZC,EACjB/8D,KAAK2xE,KAAK18C,QAAQqpC,IAEF,IAAZxB,GAAe98D,KAAKuyE,OAAOt9C,QAAQqpC,GACvB,IAAZvB,GAAe/8D,KAAK0xE,OAAOz8C,QAAQqpC,IA3DnD,uLA+DuB30D,EAAamzD,EAAgBC,EAAgB5mD,GA/DpE,2FAgE0BsmD,EAAQqW,aAAanpE,EAAM3J,KAAKO,KAAKkN,GAAIqvD,EAASC,EAAS5mD,GAhErF,eAiEsB1V,KADV+wE,EAhEZ,iDAiEwC,gBAjExC,eAmEkB/wE,KADL8S,EAAKi+D,EAALj+D,GAlEb,yCAmEoCA,GAnEpC,cAqEY+qD,EAAMt+D,KAAKs+D,IAAMkT,EACrBxxE,KAAK6yE,kBACW,IAAZ/V,GAA6B,IAAZC,EACjB/8D,KAAK2xE,KAAK18C,QAAQqpC,IAEF,IAAZxB,GAAe98D,KAAKuyE,OAAOt9C,QAAQqpC,GACvB,IAAZvB,GAAe/8D,KAAK0xE,OAAOz8C,QAAQqpC,IA3EnD,kBA6EekT,GA7Ef,0LAgFuBiB,GAhFvB,iFAiFchW,EAAQsW,aAAa/yE,KAAKO,KAAKkN,GAAIglE,EAAUhlE,IAjF3D,OAkFYzN,KAAKs+D,MAAQmU,IAAWzyE,KAAKs+D,SAAM79D,GACvCT,KAAK6yE,gBAAgBJ,GAnF7B,iJAQKv+D,KARL,4GASKA,KATL,4GAUKA,KAVL,0GAWKA,KAXL,0ECUa8+D,IAAb,+MACYzyE,UADZ,IAEI2F,QAFJ,IAGIqkB,YAHJ,IAII3H,cAJJ,IAKI8uD,YALJ,oIAeI9L,aAfJ,uCAemB,WAAO9+D,GAAP,SAAAxF,EAAA,6DACX,EAAK4E,GAAKY,EADC,SAEL,EAAKmsE,eAAensE,EAAK2G,IAFpB,OAGX,EAAKmgD,UAAUgiB,IAHJ,2CAfnB,wDA2DIQ,cAAgB,WACZ,EAAKxiB,UAAU2jB,KA5DvB,EA+DIlB,aAAe,SAAC9S,GACZ,EAAK3P,UAAUuhB,GAAa5R,IAhEpC,EAmEI0S,WAnEJ,sBAmEiB,4BAAA3uE,EAAA,sDACLgV,EAAY,aAChBpT,MAAId,KAAK,cAAC,GAAD,CAAU8D,GAAI,EAAKA,GAAIi6D,SAAU,EAAKA,WAAc7pD,GAFpD,2CAnEjB,EAwEI45D,SAxEJ,sBAwEe,4BAAA5uE,EAAA,sDACHgV,EAAY,aAChBpT,MAAId,KAAK,cAAC,GAAD,CAAU8D,GAAI,EAAKA,GAAIkY,OAAO,OAAO+hD,SAAU,EAAKA,WAAc7pD,GAFpE,2CAxEf,EA6EI65D,WA7EJ,sBA6EiB,4BAAA7uE,EAAA,sDACLgV,EAAY,aAChBpT,MAAId,KAAK,cAAC,GAAD,CAAU8D,GAAI,EAAKA,GAAIkY,OAAO,SAAS+hD,SAAU,EAAKA,WAAc7pD,GAFpE,2CA7EjB,EAkFI6oD,OAlFJ,uCAkFa,WAAO36C,GAAP,iBAAAljB,EAAA,kEAEWb,IAAZ,EAAKyF,GACLA,EAAKoK,IAAEgN,MAAMkH,IAGbte,EAAKoK,IAAEgN,MAAM,EAAKpX,IAClBoK,IAAEC,MAAMrK,EAAIse,IAEhBte,EAAG3F,KAAO,EAAKA,KAAKkN,GATf,SAUW4vD,EAAO8B,OAAOj5D,GAVzB,OAUDhG,EAVC,OAWLgG,EAAGuH,GAAKvN,EACR,EAAK6wE,OAAO3uE,KAAK8D,GAZZ,2CAlFb,wDAiGI2pE,SAjGJ,sBAiGe,4BAAAvuE,EAAA,sEACD+7D,EAAO+B,MAAM,EAAK7+D,KAAKkN,GAAI,EAAKvH,GAAGuH,IADlC,QAEH5F,EAAQ,EAAKkpE,OAAO/gD,WAAU,SAAA3oB,GAAC,OAAIA,EAAEoG,KAAO,EAAKvH,GAAGuH,QAC3C,GAAG,EAAKsjE,OAAO77C,OAAOrtB,GAH5B,2CAjGf,EA2HI2oE,mBA3HJ,sBA2HyB,sBAAAlvE,EAAA,sEACX,EAAKssD,UAAUohB,IADJ,2CA3HzB,EA+HIQ,WA/HJ,sBA+HiB,4BAAAluE,EAAA,6DACL4xE,EAAc,EAAKC,KAAKrB,IADnB,SAEIoB,EAAYz5C,OAFhB,mFA/HjB,qGASkCl5B,GATlC,wEAUQP,KAAKO,KAAOA,EAVpB,SAW4B88D,EAAO1xC,IAAI3rB,KAAKO,KAAKkN,GAAI,KAXrD,OAWQzN,KAAK+wE,OAXb,OAYQ/wE,KAAK4tD,UAAUgjB,IAZvB,qLAqBiC1B,GArBjC,yFAsBwB7R,EAAO+V,cAAcpzE,KAAKO,KAAKkN,GAAIyhE,GAtB3D,OAsBYhvE,EAtBZ,OAuBYmzE,EAAKnzE,EAAI,GAAG,GAChBF,KAAKuqB,OAAS8oD,EAAG9oD,OACjBvqB,KAAK4iB,SAAWywD,EAAGzwD,SACnB5iB,KAAKmgE,SAAWjgE,EAAI,GACpBF,KAAK0wE,OAASxwE,EAAI,GA3B1B,2PA+BQF,KAAK0xE,OAAS,IAAIW,GAAOryE,KAAKO,MA/BtC,SAgCcP,KAAK0xE,OAAO7yC,OAhC1B,gLAmCqB2yC,EAAW3pC,GAnChC,4EAoCYxwB,EAAQ,CACR9W,KAAMP,KAAKO,KAAKkN,GAChBjL,KAAM,KACNw6D,IAAKh9D,KAAKkG,GAAGuH,GACb6lE,QAAS9B,EAAM/jE,KAEA,IAAfo6B,EA1CZ,gCA2CkBw1B,EAAOkW,YAAYl8D,GA3CrC,OA4CYrX,KAAK0wE,OAAOtuE,KAAK,CACbnB,OAAQuwE,EAAM/jE,GACduD,KAAMwgE,EAAMxgE,KACZrJ,KAAM6pE,EAAM7pE,KACZsJ,KAAMugE,EAAMvgE,KACZ6rD,QAAS,IAjDzB,uCAqDkBO,EAAOmW,YAAYn8D,GArDrC,OAsDgBxP,EAAQ7H,KAAK0wE,OAAO1gD,WAAU,SAAA3oB,GAAC,OAAIA,EAAEpG,SAAWuwE,EAAM/jE,MAC1DzN,KAAK0wE,OAAOx7C,OAAOrtB,EAAO,GAvDtC,2LAuG4B01D,EAAqB7nD,EAAa+B,GAvG9D,iFAwGqB4lD,EAAOiD,kBAAkBtgE,KAAKO,KAAKkN,GAAI8vD,EAAQ9vD,GAAIiI,EAAM+B,GAxG9E,8NA2GsB8lD,GA3GtB,gFA4GYkW,EAAMnjE,IAAEgN,MAAMigD,IACdh9D,KAAOP,KAAKO,KAAKkN,GAChBgmE,EAAIt1D,UAASs1D,EAAIt1D,QAAU,KA9GxC,SA+GwBk/C,EAAO+C,YAAYqT,GA/G3C,cA+GYvzE,EA/GZ,OAgHQuzE,EAAIhmE,GAAKvN,EACTF,KAAKmgE,SAAS/9D,KAAKqxE,GAjH3B,kBAkHevzE,GAlHf,iLAqHqBq9D,GArHrB,uFAsHcF,EAAOgD,WAAWrgE,KAAKO,KAAKkN,GAAI8vD,EAAQ9vD,IAtHtD,QAuHY5F,EAAQ7H,KAAKmgE,SAASnwC,WAAU,SAAA3oB,GAAC,OAAIA,EAAEoG,KAAO8vD,EAAQ9vD,QAC7C,GAAGzN,KAAKmgE,SAASjrC,OAAOrtB,GAxH7C,4GAAyBw6D,IAAzB,sCAMKnuD,KANL,oGAOKA,KAPL,sGAQKA,KARL,kECHMowD,GADL/oD,a,wZAKa,IAAD,EACyEvb,KAAKuB,MAA9EhB,EADA,EACAA,KAAMqwC,EADN,EACMA,MAAOjpC,EADb,EACaA,KAAMwpC,EADnB,EACmBA,YAAauiC,EADhC,EACgCA,KAAMvtE,EADtC,EACsCA,QAASo8D,EAD/C,EAC+CA,UAAWC,EAD1D,EAC0DA,YAC3DrpB,EAAO,kCACP,8BAAMhI,IACN,cAAC,GAAD,CAASqxB,YAAaA,EAAaD,UAAWA,OAE9CpqD,EAAcy4B,EAAQ,MAAQjpC,EACrB,IAAT+rE,IACAv7D,EAAU,4BAAIA,KAElB,IAAImgB,EAAc,CACd,GACA,CAAC91B,KAAM,YAAay3B,UAAW,cAAC,MAAD,CAAK13B,UAAU,OAC1CkF,KAAM,cAAC,KAAD,CAAIlF,UAAU,yBAAyBoF,KApB7C,OAoB4DqlB,KAAK,OADtC,SAE3B,sBAAKzqB,UAAU,OAAf,UACI,qBAAKA,UAAU,OAAf,SAAuB4V,IACtBghC,QAGT,GACA,CAAC32C,KAAM,YAAa0T,MAAO,qBAAO+jB,UAAW,qBAAK13B,UAAU,OAAf,SAAsB,cAAC,GAAD,CAAUkL,GAAIlN,EAAMmiE,QAAQ,OAC/F,CACIlgE,KAAM,YACN0T,MAAO,qBACP+jB,UAAW,cAAC,MAAD,CAAK13B,UAAU,aAAasX,MAAO,uBAAOtX,UAAU,aAAjB,SAA8B,cAAC,WAAD,CAAUyQ,KAAMwvD,MAAjF,SAA2Gr8D,KAC1H,GACA,CACI3D,KAAM,YACN0T,MAAO,SACPihD,OAAQ,UACRl9B,UAAW,cAAC,GAAD,MAGnB,OAAO,8BACH,cAAC,WAAD,CAAU3B,KAAMA,EAAM9T,OAAQxkB,KAAKuB,c,GAtC5BmB,e,GA4CNixE,GADZp4D,aACD,0KAEQ,IAAIqiD,EAAMQ,GAAMpB,IAAIgB,MAAMM,IAC1B,GAAY,OAARV,EAAc,MAAO,MACzB,IAAI9yD,EAAU8yD,EAAIt8C,OAClB,OAAO,qBAAK/e,UAAU,uCAAuCF,MAAO,CAACqyD,KAAK,GAAnE,SACH,8BACK5pD,UAPjB,GAAgCpI,eAAhC,GAqDekxE,GAvCyB,CACpCrwE,MAAO,MACP2wC,SAAU,CACN,CACIh+B,MAAO,eACPoN,MAAO,CAAC3b,KAAM,OAAQnF,KAAM,SAAU0Y,UAAW,IAAK8c,UAAU,IAEpE,CACI9hB,MAAO,eACPoN,MAAO,CAAC3b,KAAM,cAAenF,KAAM,SAAU0Y,UAAW,KACxD4G,KAAM,CAACtf,KAAM,aAEjB,CACI0T,MAAO,SACPoN,MAAO,CAAC3b,KAAM,SAAUnF,KAAM,SAAU0Y,UAAW,MACnD4G,KAAM,CAACtf,KAAM,WAAY81B,KAAM,KAGvCjU,IAAK,SAACvd,GAA6B,IAC1B8pC,EAAkC9pC,EAAlC8pC,MAAOjpC,EAA2Bb,EAA3Ba,KAAMwpC,EAAqBrqC,EAArBqqC,YAAauiC,EAAQ5sE,EAAR4sE,KAE3Bt6B,EAAOxI,EAAQ,MAAQjpC,EAC3B,OAAO,cAAC,MAAD,CAAKpF,UAAU,gCAClBkF,KAAM,cAAC,KAAD,CAAIlF,UAAU,yBAAyBoF,KAAK,OAAOqlB,KAAK,OAD3D,SAEH,sBAAKzqB,UAAU,OAAf,UACI,8BAAa,IAAPmxE,EAAU,4BAAIt6B,IAAYA,IAChC,8BAAK,cAAC,QAAD,UAAQjI,YAIzBv8B,MAAO,kBAAIwpD,GAAMpB,IAAIgB,OACrB6V,SAAU,CACNlsE,KAAM,OACNzF,IAAK,oDAET6hE,KAAMO,GACNwP,QAAS,SAAAlW,GAAG,OAAiB,IAAbA,EAAI8V,OCvBTK,GA9C8B,CACzCxwE,MAAO,SACPwgE,K,uKA/BU,IAAD,EACmD/jE,KAAKuB,MAAxDoG,EADA,EACAA,KAAMwpC,EADN,EACMA,YAAa5wC,EADnB,EACmBA,KAAMgiE,EADzB,EACyBA,UAAWC,EADpC,EACoCA,YACrCrpB,EAAO,gCACP,8BAAK,4BAAIxxC,MACT,8BAAMwpC,OAENt3B,EAAQ,sBAAKtX,UAAU,6CAAf,0BACL,cAAC,WAAD,CAAUyQ,KAAMwvD,IAAc,uBADzB,gBAEL,cAAC,WAAD,CAAUxvD,KAAMuvD,OAEnBjqC,EAAc,CACd,GACA,CAAC91B,KAAM,YAAay3B,UAAW,cAAC,MAAD,CAAK13B,UAAU,aAC1CkF,KAAM,cAAC,KAAD,CAAIE,KAAK,SAASpF,UAAU,4BAClCsX,MAAOA,EAFoB,SAG1Bs/B,KAEL,GACA,CAAC32C,KAAM,YAAa0T,MAAO,qBAAO+jB,UAAW,qBAAK13B,UAAU,OAAf,SAAsB,cAAC,GAAD,CAAUkL,GAAIlN,EAAMmiE,QAAQ,OAC/F,CAAClgE,KAAM,SAAU0T,MAAO,MAAOvO,KAAM,OACrC,CAACnF,KAAM,SAAU0T,MAAO,qBAAOvO,KAAM,SACrC,CAACnF,KAAM,SAAU0T,MAAO,KAAMvO,KAAM,OAExC,OAAO,8BACH,cAAC,WAAD,CAAU2wB,KAAMA,EAAM9T,OAAQxkB,KAAKuB,c,GAzB5BmB,aAiCfwxC,SAAU,CACN,CACIh+B,MAAO,eACPoN,MAAO,CAAC3b,KAAM,OAAQnF,KAAM,SAAU0Y,UAAW,GAAI8c,UAAU,IAEnE,CACI9hB,MAAO,MACPoN,MAAO,CAAC3b,KAAM,MAAOnF,KAAM,SAAU0Y,UAAW,IAAK8c,UAAU,IAEnE,CACI9hB,MAAO,iBACPoN,MAAO,CAAC3b,KAAM,KAAMnF,KAAM,SAAU0Y,UAAW,KAEnD,CACIhF,MAAO,eACPoN,MAAO,CAAC3b,KAAM,cAAenF,KAAM,SAAU0Y,UAAW,GAAI8c,UAAU,IAE1E,CACI9hB,MAAO,2BACPoN,MAAO,CAAC3b,KAAM,QAASnF,KAAM,SAAU0Y,UAAW,GAAI8c,UAAU,KAGxE3T,IAAK,SAACvd,GAAiC,IAC9Ba,EAA4Bb,EAA5Ba,KAAMwpC,EAAsBrqC,EAAtBqqC,YAAa80B,EAASn/D,EAATm/D,MACxB,OAAO,cAAC,MAAD,CAAK1jE,UAAU,+BAClBkF,KAAM,cAAC,KAAD,CAAIE,KAAK,SAASpF,UAAU,uBAD/B,SAEH,sBAAKA,UAAU,OAAf,UACR,gCAAK,mBAAGA,UAAU,OAAb,SAAqBoF,IAAS,cAAC,QAAD,UAAQs+D,OAC/B,qBAAK1jE,UAAU,mBAAf,SAAmC4uC,UAI/Cv8B,MAAO,kBAAIwpD,GAAMpB,IAAIiB,SACrB4V,SAAU,CACNlsE,KAAM,OACNzF,IAAK,gEAEZ4xE,QAAS,SAAA/V,GAAW,IAAD,EACOK,GAAM79D,KAA1Bu8D,EADa,EACbA,QAASC,EADI,EACJA,QACd,OAAOD,EAAQ,GAAKC,EAAQ,ICpEjBiX,GADZz4D,aACD,+MAWI0oD,UAAY,SAACn9D,GACT,EAAKvF,MAAMqT,QAAQ0pD,IAAMpqD,YAAWpN,GACpC5D,MAAId,KAAK,cAAC,GAAD,gBAAU,EAAKb,UAbhC,4LAEcvB,KAAKuB,MAAMqT,QAAQiqB,OAFjC,sIAQQ7+B,KAAKuB,MAAMqT,QAAQ0pD,SAAM79D,EACzByC,MAAId,KAAK,cAAC,GAAD,gBAASpC,KAAKuB,WAT/B,+BAec,IAAD,SACgBvB,KAAKuB,MAArBgC,EADA,EACAA,MAAOqR,EADP,EACOA,MAEdiF,EADkBukD,GAAM79D,KAAjBu8D,QACS,GAAK,wBAAQv6D,UAAU,8BAC1CE,QAAS,kBAAI,EAAKgjE,WADM,SACK,cAAC,KAAD,CAAI99D,KAAK,WACjC,OAAO,cAAC,OAAD,CAAM9E,OAAQU,EAAOsW,MAAOA,EAA5B,SACH,cAAC,OAAD,CAAMjF,MAAOA,IAAQA,MACjB9N,KAAM,CAAC0Q,OAAQxX,KAAKuB,MAAM8iB,IAAK5hB,QAASzC,KAAKikE,mBAtB7D,GAAmDvhE,eAAnD,GA4BMuxE,G,kDAEF,WAAY1yE,GAAwB,IAAD,8BAC/B,cAAMA,IAFL0tE,eAC8B,EAE/B,EAAKj7B,SAAW,EAAKA,SAAS9c,KAAd,gBAFe,E,8FAIpB1S,G,uFACDxkB,KAAKuB,MAAMqT,QAAQwwB,MAAM5gB,G,uBAAY,I,sEAC/BxkB,KAAKuB,MAAMqT,QAAQs/D,QAAQ1vD,G,cAC/B,I,OACRthB,MAAIqC,OAGAsuE,EAAW7zE,KAAKuB,MAAMsyE,SAC1B7zE,KAAKivE,UAAUz4C,SAAS0F,SAAS23C,EAASlsE,KAAMksE,EAAS3xE,M,0JAIvD,IACF4I,EADC,SAE4B9K,KAAKuB,MAAjCgC,EAFA,EAEAA,MAAO86C,EAFP,EAEOA,MAAO81B,EAFd,EAEcA,WAFd,EAGmBn0E,KAAKuB,MAAxB2yC,EAHA,EAGAA,SAAUt/B,EAHV,EAGUA,MAaf,OAXI9J,OADUrK,IAAV49C,EACU,cAAC,aAAD,CAAW97C,UAAU,OAAOM,OAAQsxE,EAAY91B,MAAOA,EAAOF,MAAM,QAAQnK,SAAUh0C,KAAKg0C,gBAEnFvzC,IAAbyzC,EACK,cAAC,aAAD,CAAWjiB,IAAK,SAAAhQ,GAAC,OAAI,EAAKgtD,UAAUhtD,GAC1C1f,UAAU,MACV2xC,SAAUA,EACVF,SAAUh0C,KAAKg0C,SAAUC,WAAYr/B,IAAQ0pD,MAGvC,yCAEP,cAAC,OAAD,CAAMz7D,OAAQ,eAAKU,EAAnB,SACFuH,Q,GAnC2BpI,aAyClC4hE,GADL/oD,a,+MAEWwrD,UAAY,CAChB,CAAC5uD,QAAQ,eAAO,EAAK5W,MAAMgC,MAAO6a,OAAO,EAAKwoD,SAAS1vC,KAAd,gBAA0BlmB,KAAK,QACxE,CAACmH,QAAQ,eAAMiG,OAAO,EAAKyoD,WAAW3vC,KAAhB,gBAA4BlmB,KAAK,Y,yKAGH,IAAhD9L,OAAOvB,QAAQ,0J,gCACT3D,KAAKuB,MAAMqT,QAAQw/D,M,OACzBlxE,MAAIqC,M,uIAIRrC,MAAId,KAAK,cAAC,GAAD,gBAAUpC,KAAKuB,W,+BAGxB,IAAIuF,EAAO9G,KAAKuB,MAAMqT,QAAQ0pD,IAC1BrxB,EAAU,GACV7jB,EAAKppB,KAAKuB,MAAM8yE,sBACT5zE,IAAP2oB,GAAkB6jB,EAAQ7qC,KAAR,MAAA6qC,EAAO,YAAS7jB,IACtC6jB,EAAQ7qC,KAAR,MAAA6qC,EAAO,YAASjtC,KAAK+mE,YACrB,IACIltD,EADAi6D,EAAU9zE,KAAKuB,MAAMuyE,QAMzB,OAJIA,IAA6B,IAAlBA,EAAQhtE,KACnB+S,EAAQ,cAAC,kBAAD,CAAiBozB,QAASA,EAAS1qC,UAAU,sBAGlD,cAAC,OAAD,CAAMM,OAAQ7C,KAAKuB,MAAMgC,MAAQ,8BAAWsW,MAAOA,EAAnD,SACFnX,gBAAoB1C,KAAKuB,MAAMwiE,KAAMj9D,S,GA3BTpE,e,GAgCnCqtD,G,kDAIF,WAAYxuD,GAAyB,IAAD,8BAChC,cAAMA,IAJF0rC,QAAU,CACd,CAAC90B,QAAQ,eAAMiG,OAAO,EAAKyoD,WAAW3vC,KAAhB,gBAA4BlmB,KAAK,YAIvD,EAAKgjC,SAAW,EAAKA,SAAS9c,KAAd,gBAFgB,E,8FAIrB1S,G,iFACDxkB,KAAKuB,MAAMqT,QAAQwwB,MAAM5gB,G,uBAAY,I,sEACzCxkB,KAAKuB,MAAMqT,QAAQs/D,QAAQ1vD,G,cACjCthB,MAAIqC,M,2QAIgD,IAAhDL,OAAOvB,QAAQ,0J,gCACT3D,KAAKuB,MAAMqT,QAAQw/D,M,OACzBlxE,MAAIqC,M,qIAIR,IAAIsU,EAAQ,cAAC,kBAAD,CAAiBozB,QAASjtC,KAAKitC,QAAS1qC,UAAU,qBAC9D,OAAO,cAAC,OAAD,CAAMM,OAAQ,gBAAM7C,KAAKuB,MAAMgC,MAAOsW,MAAOA,EAAOnW,KAAK,QAAzD,SACH,cAAC,aAAD,CACInB,UAAU,MACV2xC,SAAUl0C,KAAKuB,MAAM2yC,SACrBF,SAAUh0C,KAAKg0C,SAAUC,WAAYj0C,KAAKuB,MAAMqT,QAAQ0pD,Y,GA1B/B57D,aCjGnC4xE,GAAmB,YAyBnBC,GAAS,cAAC,KAAD,CAAI5sE,KAAK,gBAEX6sE,GAAb,4MAKYC,WAAwB,CAC5BlxE,MAAO,kBACPsW,MAAO06D,GACPvjE,KAAM,gBACNgH,KAAMstD,IATd,EAmBYoP,eAA4B,CAChCnxE,MAAO,wBACPsW,MAAO,qCAAE,uBAAOtX,UAAU,aAAjB,2DAAF,SAA2DgyE,MAClEvjE,KAAM,SACN0H,WAAY,EAAKA,WAAWi8D,QAvBpC,EAgCYC,aAA2B,CAC/BrxE,MAAOk6C,uBAAY,EAAK/kC,WAAWnY,MAAQ,eAC3CsZ,MAAO06D,GACPvjE,KAAM,mBAEN0H,WAAY,EAAKA,WAAWm8D,SArCpC,EA0DYC,WAAwB,CAC5BvxE,MAAO,yDACPyN,KAAM,mBA5Dd,EAsJYqT,IAAM,SAACvd,EAAWe,GACtB,GAAoB,kBAATf,EACP,OAAO,qBAAKvE,UAAU,iDAAiDF,MAAO,CAAC0yE,gBAAgB,WAAxF,SAAqGjuE,IAF7D,IAO/CW,EAAUutE,EAASzhE,EAHlB0hE,EAA4BnuE,EAA5BmuE,cAAe1yE,EAAauE,EAAbvE,UAIpB,QAHsB9B,IAAlBw0E,IAA6BA,EAAgBX,KAGrC,IAFAxtE,EAAPk2D,IAEa,CAAC,IAAD,EACal2D,EAAtBkK,EADS,EACTA,KAAMzN,EADG,EACHA,MAAOivC,EADJ,EACIA,MAClB/qC,EAAuB,kBAATuJ,EACV,cAAC,KAAD,CAAIzO,UAAW0yE,EAAettE,KAAMqJ,EAAMyiB,UAAU,EAAMzG,KAAK,OAE/Dhc,EACJgkE,EAAMzxE,EACNgQ,EAAIi/B,EAAM,GAAK,+BAAOA,QAErB,CAAC,IAAD,EAC0B1rC,EAAtB+S,EADJ,EACIA,MAAOtW,EADX,EACWA,MAAOyN,EADlB,EACkBA,KACnBvJ,EAAuB,kBAATuJ,EACV,cAAC,KAAD,CAAIzO,UAAW0yE,EAAettE,KAAMqJ,EAAMyiB,UAAU,EAAMzG,KAAK,OAC/DlmB,EAAKkK,KACTgkE,EAAMzxE,EACNgQ,EAAI,+BAAOsG,IAEf,OAAO,cAAC,MAAD,CAAKtX,UAAW+V,KAAW,+BAAgC/V,GAAYkF,KAAMA,EAAMoS,MAAOtG,EAA1F,SACH,qBAAKhR,UAAU,OAAf,SAAsB,4BAAIyyE,SAhLtC,EAmLY3kB,SAnLZ,uCAmLuB,WAAOvpD,GAAP,uBAAAxF,EAAA,yDACL4zE,GADK,EACSpuE,GAAnBkR,KAAQvV,EADE,EACFA,aACHhC,IAANy0E,EAFW,uBAGXhyE,MAAId,KAAK,cAAC8yE,EAAD,KAHE,8BAMXzyE,EANW,uBAOXA,IAPW,kCAWEhC,KADZ00E,EAAYruE,EAAZquE,UAVU,0CAYJjyE,MAAId,KAAK,cAAC,GAAD,gBAAa+yE,MAZlB,aAcVz8D,EAAc5R,EAAd4R,YAdU,kCAgBLA,EAAWlU,MAAM45D,GAAM79D,MAhBlB,8EAnLvB,wDAqNY6kE,SArNZ,uCAqNuB,WAAOh0B,GAAP,SAAA9vC,EAAA,sEACT,EAAKoX,WAAW08D,gBAAgBhkC,GADvB,2CArNvB,wDAgPYikC,iBAAmB,WACvB,EAAK57D,gBAAgB,cAAC,GAAD,MAjP7B,EAoPYzB,KAAOuD,cAAS,WACpB,IAAIhb,EAAY69D,GAAM79D,KACtB,QAAaE,IAATF,EAEA,OAAO,KAGX,IAIIsC,EAAYuC,EAJZwP,EAAQ,EAAKk/C,aACjB,QAAcrzD,IAAVmU,EACA,OAAO,cAAC,OAAD,CAAM/R,OAAO,KAGxB,QAAapC,IAATF,EAAoB,CAAC,IAEjBgD,EAAc+xE,EADb3tE,EAAiCpH,EAAjCoH,KAAMsJ,EAA2B1Q,EAA3B0Q,KAAMD,EAAqBzQ,EAArByQ,KAAMmgC,EAAe5wC,EAAf4wC,YAEnBlgC,GACA1N,EAAQ0N,EACRqkE,EAAO,6BAAI,uBAAO/yE,UAAU,iBAAjB,SAAmCoF,OAG9CpE,EAAQoE,EAEZ,IAAIwQ,EAAUslC,uBAAY,EAAK/kC,WAAWnY,WAC1BE,IAAZ0X,IAAuBtV,EAASsV,EAAU,MAAQ5U,GACtD6B,EAAM,cAAC,MAAD,CAAK7C,UAAU,yCAAyCE,QAAS,EAAK4yE,iBACxE5tE,KAAM,8BAAK,cAAC,QAAD,CAAOlF,UAAU,YAAYsQ,IAAK7B,MAD3C,SAEF,sBAAKzO,UAAU,OAAf,UACI,cAAC,MAAD,CAAKsX,MAAOy7D,EAAZ,SAAkB,oBAAI/yE,UAAU,6BAAd,SAA4CgB,MAC9D,qBAAKhB,UAAU,qCAAf,SAAqD4uC,cAK7DtuC,EAAS,2BAGb,OAAO,eAAC,OAAD,CAAMA,OAAQA,EAAQ+W,OAAQ,EAAKlB,WAAWkB,OAA9C,UACFxU,EACAwP,EAAM5P,OAAO,GAAK,cAAC,OAAD,CAAM4P,MAAOA,EAAO9N,KAAM,CAAC0Q,OAAO,EAAK6M,IAAK5hB,QAAQ,EAAK4tD,YAC3E,EAAKklB,kBA3RlB,+JAEQv1E,KAAK2X,SAAS3X,KAAKgY,MAF3B,yIA+DiC,IAAD,OACnBzX,EAAa69D,GAAb79D,KAAMy8D,EAAOoB,GAAPpB,IACND,EAAiCx8D,EAAjCw8D,QAASD,EAAwBv8D,EAAxBu8D,QAAS3mD,EAAe5V,EAAf4V,MAAO3T,EAAQjC,EAARiC,KAC1BoS,EAAe,GAWnB,GAVgB,IAAZkoD,GAA6B,IAAZC,GACjBnoD,EAAMxS,KAAKpC,KAAK40E,cAED,KAAP,EAAPpyE,IACe,IAAZu6D,GACAnoD,EAAMxS,KAAKpC,KAAK00E,gBAKL,KAAP,EAAPlyE,GAAiB,CAAC,IACds8D,EAAU9B,EAAV8B,OAML,GAJe,IAAX/B,GAA0B,IAAV5mD,GAChBvB,EAAMxS,KAAK,kCAGC,IAAZ26D,EAAe,CACf,IAAIyY,EAA8B,CAC9BjyE,MAAO,qBACPsW,MAAO06D,GACPvjE,KAAM,SACNvO,QAAQ,WAAD,4BAAE,sBAAAnB,EAAA,sEAAkB,EAAKoX,WAAW+8D,mBAAlC,mFAAF,kDAAC,GACRlzE,UAAW,gBACX0yE,cArHC,gBAuHLrgE,EAAMxS,KAAKozE,GAGf,GAAc,IAAVr/D,EAAc,CACd,GAAI2mD,EAAQ,EAAG,CACX,IAAI4Y,EAAgC,CAChC1Y,KAAK,EACLz5D,MAAO,MACPivC,MAAOssB,GAAUA,EAAO1tB,IACxBpgC,KAAM,SACNvO,QAAS,kBAAM,EAAKiW,WAAWi9D,SAASp1E,KAE5CqU,EAAMxS,KAAKszE,GAEf,IAAIE,EAA+B,CAC/B5Y,KAAK,EACLz5D,MAAO,KACPivC,MAAOssB,GAAUA,EAAO54D,GACxB8K,KAAM,WACNvO,QAAS,kBAAM,EAAKiW,WAAWm9D,QAAQt1E,KAEvCu1E,EAAgC,CAChC9Y,KAAK,EACLz5D,MAAO,MACPivC,MAAOssB,GAAUA,EAAOlB,IACxB5sD,KAAM,OACNmkE,SAAUvB,IAGd,GADAh/D,EAAMxS,KAAKwzE,EAAUE,GACjBhZ,EAAQ,EAAG,CACX,IAAIiZ,EAAmC,CACnC/Y,KAAK,EACLz5D,MAAO,SACPivC,MAAOssB,GAAUA,EAAOf,OACxB/sD,KAAM,SACNmkE,SAAUpB,IAEdn/D,EAAMxS,KAAK2zE,KAkBvB,OAAOnhE,IApJf,oCAwM0Bw8B,EAAavpC,GAAe,IACzCF,EAAmCypC,EAAnCzpC,KAAMwpC,EAA6BC,EAA7BD,YAAangC,EAAgBogC,EAAhBpgC,KACpBw0D,EAAkB,IADkBp0B,EAAVowB,QAE1B,cAAC,KAAD,CAAIj/D,UAAU,cAAcoF,KAAK,QACrC,OAAO,cAAC,MAAD,CAAKpF,UAAU,YAClBkF,KAAM,cAAC,QAAD,UAAO,cAAC,QAAD,CAAOoL,IAAK7B,MACzB6I,MAAO2rD,EAFJ,SAGH,sBAAKjjE,UAAU,OAAf,UACI,8BAAK,4BAAIoF,MACT,uBAAOpF,UAAU,aAAjB,SAA+B4uC,WAjN/C,gCA8NQjuC,MAAId,KAAK,cAAC,GAAD,OA9NjB,kCAgOyB,IAAD,OACX86D,EAAQkB,GAARlB,KACL,QAAaz8D,IAATy8D,GACgB,IAAhBA,EAAKl4D,OAAT,CAHgB,MAISo5D,GAAM79D,KAA1Bw8D,EAJW,EAIXA,QAASD,EAJE,EAIFA,QACVjjD,GAAoB,IAAVkjD,GAAyB,IAAVD,IAAgB,wBACzCv6D,UAAU,yBACVE,QAAS,kBAAI,EAAKgjE,WAFuB,SAEZ,cAAC,KAAD,CAAI99D,KAAK,WAC1C,OAAO,qCACH,cAAC,MAAD,CAAKpF,UAAU,kDAAkDsX,MAAOA,EAAxE,SACI,qBAAKtX,UAAU,iBAAf,mBAEJ,cAAC,OAAD,CAAMqS,MAAOwpD,GAAMlB,KAAMp2D,KAAM,CAAC0Q,OAAQxX,KAAKg2E,cAAevzE,QAASzC,KAAKolE,oBA5OtF,GAA2B9rD,SAiSrB28D,G,4MACM30D,OAAqB,CACzB,CAAC3Z,KAAM,OAAQnF,KAAM,SACrB,CAACmF,KAAM,OAAQnF,KAAM,UACrB,CAACmF,KAAM,cAAenF,KAAM,W,EAExBmyC,SAAoB,CACxB//B,MAAO,CACH3D,KAAM,CAAC+U,OAAO,OAAQ9P,MAAM,eAAMiF,YAAY,0DAC9CnK,KAAM,CAACgV,OAAO,QAAS9P,MAAM,sBAC7Bi7B,YAAa,CAACnrB,OAAO,OAAQ9P,MAAM,eAAMiF,YAAY,gD,EAWrDy5B,c,uCAAgB,WAAOrvB,EAAuB7K,EAAcE,GAA5C,eAAAtZ,EAAA,6DACfqG,EAAQ4d,EAAR5d,KADe,SAGdy2D,GAAM8C,eAAev5D,EAAM+S,GAHb,2C,iHAUpB,IAAIna,EAAY69D,GAAM79D,KACjB21E,EAA2B31E,EAA3B21E,OAAQpZ,EAAmBv8D,EAAnBu8D,QAASqZ,EAAU51E,EAAV41E,OAClBh+D,EAAUslC,uBAAYl9C,GAEtB61E,EAAYD,GAAU,qBAAK5zE,UAAU,MACrCyI,wBAAyB,CAACD,OAAOorE,KAErC,OAAO,eAAC,OAAD,CAAMtzE,OAAQsV,EAAU,eAAxB,UACH,cAAC,OAAD,CAAMmJ,OAAQthB,KAAKshB,OAAQqzB,SAAU30C,KAAK20C,SACtC13B,KAAMmhD,GAAM79D,KACZq0C,cAAe50C,KAAK40C,cACpB6b,WAAYylB,EAAO,GAAKpZ,EAAQ,KACnCsZ,S,GA3CW1zE,aCpUX2zE,GAAb,4MAkBYC,YAlBZ,uCAkB0B,WAAO7D,GAAP,SAAAnxE,EAAA,6DAClB,EAAKiX,YADa,SAEZ,EAAKG,WAAW69D,WAAW9D,GAFf,2CAlB1B,wDAuBY+D,eAAiB,WAAO,IAAD,EACmB,EAAK99D,WAA9C+9D,EADsB,EACtBA,SAAUC,EADY,EACZA,SAAUC,EADE,EACFA,UAAW/8D,EADT,EACSA,OAChC9S,EAAO,CAAC0Q,OAAQ,EAAKo/D,gBAAiBn0E,QAAS,EAAK6zE,aACpDrwD,EAAO,SAACrR,EAAmBsB,GAC3B,OAAOtB,EAAM5P,OAAO,GACpB,sBAAKzC,UAAU,OAAf,UACI,qBAAKA,UAAU,6BAAf,SAA6C2T,IAC7C,cAAC,OAAD,CAAMtB,MAAOA,EAAO9N,KAAMA,QAGlC,OAAO,eAAC,OAAD,CAAMjE,OAAO,iCAAQ+W,OAAQA,EAA7B,UACFqM,EAAKwwD,EAAU,gBACfxwD,EAAKywD,EAAU,sBACfzwD,EAAK0wD,EAAW,oBApC7B,EA0CYE,WAAa,WAAO,IAAD,EACF,EAAKn+D,WAArB/O,EADkB,EAClBA,KAAMiQ,EADY,EACZA,OACN3I,EAActH,EAAdsH,KAAMtJ,EAAQgC,EAARhC,KACX,OAAO,cAAC,OAAD,CAAM9E,OAAO,2BAAO+W,OAAQA,EAA5B,SACH,sBAAKrX,UAAU,sBAAf,UACK0O,GAAQtJ,EADb,iEA9CZ,EAsDYivE,gBAAkB,SAAC9vE,EAAiBe,GAA+B,IAEnEmJ,EAAaiiB,EADZtrB,EAAoBb,EAApBa,KAAMsJ,EAAcnK,EAAdmK,KAAMzO,EAAQsE,EAARtE,KAcjB,OAZW,EAAPA,GACAwO,EAAO,OACPiiB,EAAQ,gBAEI,EAAPzwB,GACLwO,EAAO,OACPiiB,EAAQ,iBAGRjiB,EAAO,QACPiiB,EAAQ,eAEL,cAAC,MAAD,CAAK1wB,UAAU,YAAYsX,MAAO,uBAAMtX,UAAU,mBAAhB,iBAAwCuE,EAAK2G,MAA/E,SACH,gCACI,cAAC,KAAD,CAAI9F,KAAMqJ,EAAMyiB,UAAU,EAAMlxB,UAAW+V,KAAW,OAAQ2a,KAC7DhiB,GAAQtJ,QAxEzB,8KAEyC3H,KAAK0Y,WAAjCo+D,EAFb,EAEaA,aAAcxE,EAF3B,EAE2BA,YACE,IAAjBwE,EAHZ,sBAIoBxE,EAAWttE,OAJ/B,OAMqB,IANrB,OAOqB,IAPrB,6BAKyBhF,KAAK2X,SAAS3X,KAAKw2E,gBAL5C,iCAMwBx2E,KAAK2X,SAAS3X,KAAK62E,YAN3C,2CAO8B72E,KAAK0Y,WAAW69D,WAAWjE,EAAW,IAPpE,kDAW2B7xE,IAAf29D,GAAM79D,KAXlB,wBAYYP,KAAK2X,SAAS3X,KAAK62E,YAZ/B,4CAec72E,KAAK0Y,WAAW69D,WAAWjE,EAAW,IAfpD,0IAA2Bh5D,SCDdy9D,GAAb,4MAKY/+D,KAAOuD,cAAS,WAAO,IAAD,EACyC,EAAK7C,WAAnEs+D,EADqB,EACrBA,YAAaC,EADQ,EACRA,WAAY/Y,EADJ,EACIA,MAAOgZ,EADX,EACWA,aACjCvhC,GAAOwhC,EAFe,EACyBA,gBAE9CxvE,EAAmDqvE,EAAnDrvE,KAAMwpC,EAA6C6lC,EAA7C7lC,YAAangC,EAAgCgmE,EAAhChmE,KAAMuxD,EAA0ByU,EAA1BzU,UAAWC,EAAewU,EAAfxU,YACrCrpB,EAAO,gCACP,8BAAMhI,IACN,cAAC,GAAD,CAASqxB,YAAaA,EAAaD,UAAWA,OAEpD1oD,EAAQ,wBAAQtX,UAAU,gDAC7BE,QAASw0E,EADE,SACU,cAAC,KAAD,CAAItvE,KAAK,aAAa8rB,UAAU,MAC5C6E,EAAc,CACd,GACA,CACI91B,KAAM,YACNy3B,UAAW,cAAC,QAAD,CAAOjpB,KAAMA,EAAMooC,KAAMzxC,EAAMwpC,YAAagI,KAE3D,IAEJ,OAAO,eAAC,OAAD,CAAMt2C,OAAQ,SAAW8E,EAAMkS,MAAOA,EAAtC,UACH,cAAC,WAAD,CAAUye,KAAMA,EAAM9T,OAAQ,KAC7B,EAAK4yD,aAAazhC,GAClB,EAAK0hC,YAAY1hC,GACjB,EAAK2hC,YAAY3hC,GAClB,qBAAKpzC,UAAU,SACd,EAAK8hB,IAAI,2BAAQ65C,EAAMl5D,OAAQkyE,EAAc,YAAa,cA7BvE,+JAEQl3E,KAAK2X,SAAS3X,KAAKgY,MAF3B,gIAiCgBlN,EAA4B0nC,EAAc/vC,EAAkBwwB,EAAcjiB,GAClF,IAAIvJ,EAAO,cAAC,KAAD,CAAIlF,UAAW,QAAU0wB,EAAQQ,UAAU,EAAM9rB,KAAMqJ,GAAQ,OAAQgc,KAAK,OACnFnT,EAAQ,qCAAG24B,EAAH,cAAwB,cAAC,KAAD,CAAIjwC,UAAU,oBAAoBoF,KAAK,mBAC3E,OAAO,cAAC,MAAD,CAAKpF,UAAU,6CAClBE,QAASA,EAASgF,KAAMA,EAAMoS,MAAOA,EADlC,SAC0C/O,MArCzD,mCAwCyB6qC,GAAwB,IAAD,EACf31C,KAAK0Y,WAAzB6+D,EADmC,EACnCA,WACL,GAAqB,IAFmB,EACvBh3E,KACRw8D,QACL,OAAO/8D,KAAKqkB,IAAI,qBAAOsxB,EAAK+7B,OAAO1sE,OAAQuyE,EAAY,iBA3CnE,kCA+CwB5hC,GAAwB,IAAD,EACN31C,KAAK0Y,WAAjC8+D,EADkC,EAClCA,UAAWC,EADuB,EACvBA,cAEhB,GADkB9hC,EAAb+hC,UAEL,OAAO13E,KAAKqkB,IAAI,2BAAQozD,EAAeD,EAAW,kBAnD1D,kCAsDwB7hC,GAAwB,IACnCgiC,EAAa33E,KAAK0Y,WAAlBi/D,UACL,OAAO33E,KAAKqkB,IAAI,2BAAQsxB,EAAKuoB,MAAMl5D,OAAQ2yE,EAAW,iBAxD9D,GAA0Br+D,SCAbs+D,GAAb,4MAKYrT,YAAc,SAACC,EAAc38D,GAA8B,IAC1DF,EAA4B68D,EAA5B78D,KAAMipC,EAAsB4zB,EAAtB5zB,MAAOO,EAAeqzB,EAAfrzB,YAClB,OAAO,eAAC,MAAD,CAAK5uC,UAAU,OAAOsX,MAAO,uBAAOtX,UAAU,aAAjB,SAA+B4uC,IAA5D,UACFP,EADE,MACQjpC,MARvB,EAYYkwE,YAZZ,sBAY0B,sBAAAv2E,EAAA,sEACR,EAAKoX,WAAWo/D,eADR,uBAC2B,IAD3B,qBAEd,EAAKv/D,YAFS,2CAZ1B,EAqBYqsB,OAAS,WAAmB,IAE5BtxB,EAAauG,EADZ2nD,EAAU,EAAK9oD,WAAWs+D,YAA1BxV,OAoBL,OAlBe,IAAXA,GACA3nD,EAAQ,yBAAQtX,UAAU,iBAAiBE,QAAS,EAAKo1E,YAAjD,UACJ,cAAC,KAAD,CAAIlwE,KAAK,QADL,sBAGR2L,EAAO,sBAES,IAAXkuD,GACL3nD,EAAQ,yBAAQtX,UAAU,kBAAkBE,QAAS,EAAKo1E,YAAlD,UACJ,cAAC,KAAD,CAAIlwE,KAAK,UAAUqlB,KAAK,OADpB,sBAGR1Z,EAAO,uBAGPuG,EAAQ,yBAAQtX,UAAU,kBAAkBE,QAAS,EAAKo1E,YAAlD,UACJ,cAAC,KAAD,CAAIlwE,KAAK,OAAOqlB,KAAK,OADjB,mBAGR1Z,EAAO,mBAEJ,cAAC,MAAD,CAAK/Q,UAAU,gCAAgCsX,MAAOA,EAAtD,SAA8DvG,KA1C7E,EA6CY0E,KAAOuD,cAAS,WAAO,IAAD,EACM,EAAK7C,WAAhCs+D,EADqB,EACrBA,YAAahS,EADQ,EACRA,WACbzkE,EAAyDy2E,EAAzDz2E,KAAMoH,EAAmDqvE,EAAnDrvE,KAAMwpC,EAA6C6lC,EAA7C7lC,YAAangC,EAAgCgmE,EAAhChmE,KAAMuxD,EAA0ByU,EAA1BzU,UAAWC,EAAewU,EAAfxU,YAC3CrpB,EAAO,gCACP,8BAAMhI,IACN,cAAC,GAAD,CAASqxB,YAAaA,EAAaD,UAAWA,OAE9CjqC,EAAc,CACd,GACA,CACI91B,KAAM,YACNy3B,UAAW,cAAC,QAAD,CAAOjpB,KAAMA,EAAMooC,KAAMzxC,EAAMwpC,YAAagI,KAE3D,GACA,CACI32C,KAAM,YACN0T,MAAO,qBACP+jB,UAAW,qBAAK13B,UAAU,OAAf,SAAsB,cAAC,GAAD,CAAUkL,GAAIlN,EAAMmiE,QAAQ,OAEjE,CACIlgE,KAAM,YACN0T,MAAO,iBACP+jB,UAAW,cAAC,OAAD,CAAM13B,UAAU,QAAQqS,MAAOowD,EACtCl+D,KAAM,CAAC0Q,OAAQ,EAAK+sD,gBAE5B,GACA,CACI/hE,KAAM,YACN0T,MAAO,eACP+jB,UAAW,EAAK2K,WAGxB,OAAO,cAAC,OAAD,CAAM/hC,OAAQ,qBAAa8E,EAA3B,SACH,cAAC,WAAD,CAAU2wB,KAAMA,EAAM9T,OAAQ,GAAIsyC,cAAc,SA9E5D,+JAEQ92D,KAAK2X,SAAS3X,KAAKgY,MAF3B,2GAA6BsB,SCAhBy+D,GAAb,4MAMY1zD,IAAM9I,cAAS,SAACha,GAAyB,IACxCoI,EAAQpI,EAARoI,KACDgV,EAAI4V,EAAO2pC,MAAMj+D,IAAI0J,EAAK8D,IAC9B,GAAU,OAANkR,EAAJ,CAH4C,IAIvChX,EAAoBgX,EAApBhX,KAAMsJ,EAAc0N,EAAd1N,KAAMD,EAAQ2N,EAAR3N,KACZosD,EAA+BzzD,EAA/ByzD,SAAUL,EAAqBpzD,EAArBozD,QAASib,EAAYruE,EAAZquE,SAExB,QADiBv3E,IAAb28D,IAAwBnsD,EAAOmsD,QACtB38D,IAATkH,EAAoB,CAAC,IAAD,EAC0B,EAAK+Q,WAA9Cu/D,EADe,EACfA,QAASC,EADM,EACNA,iBAAuB/iE,EADjB,EACYxL,KAC5BlC,EAAO,cAAC,QAAD,CAAOlF,UAAU,iBAAiBsQ,IAAK7B,IAE9CmH,GAAuB,KADhBxO,EAAK8D,KAAO0H,EAAM1H,IAEzB,gCACKwD,EAAM,qCAAE,4BAAIA,IAAN,IAAiBtJ,KAAW,mCAAE,4BAAIA,MAD7C,QAEW,uBAAOpF,UAAU,aAAjB,+BAGX,8BAAM0O,EAAM,qCAAGA,EAAH,IAAS,gCAAQtJ,OAAmB,mCAAGA,MACnDwwE,EAAiB,GACrB,QAAgB13E,IAAZw3E,EAEA,IADA,IAAIhzE,EAAMgzE,EAAQjzE,OACT7C,EAAE,EAAGA,EAAE8C,EAAK9C,IACW,KAAvB61E,EAAY,GAAG71E,IACpBg2E,EAAS/1E,KAAK,EAAKg2E,IAAIH,EAAQ91E,GAAI,8CAI3C,OAAO,eAAC,MAAD,CAAKI,UAAU,2BAA2BkF,KAAMA,EAAMhF,QAAS,kBAAIy1E,EAAiBvuE,IAApF,UACFwO,EACD,sBAAK5V,UAAU,wBAAf,WACe,IAAVw6D,GAAkB,EAAKqb,IAAI,qBAAO,6CAClCD,aArCrB,EA2CYC,IAAM,SAAC9kE,EAAa8f,GACxB,OAAO,qBAAK7wB,UAAW,kCAAoC6wB,EAApD,SAAoE9f,GAAPA,IA5C5E,qDACW3J,GAET,OAAOjH,gBAAoB1C,KAAKqkB,IAAK,CAAC1a,aAHxC,GAA2B8O,QAgDd4/D,GAAb,qKACWC,GAA6B,IAAD,OAC/B,OAAO,wBACH/1E,UAAU,gDACVE,QAAS,kBAAI,EAAKiW,WAAW6/D,gBAAgBD,IAF1C,SAGC,cAAC,KAAD,CAAI3wE,KAAK,eALzB,GAA8B8Q,QChDjB+/D,GAAb,4MAKYxgE,KAAOuD,cAAS,WAAO,IAAD,EACM,EAAK7C,WAAhCs+D,EADqB,EACrBA,YAAa/9D,EADQ,EACRA,WACbtR,EAAQqvE,EAARrvE,KACDguC,EAAO,EAAKj9B,WAAWy+D,eAC3B,OAAO,cAAC,OAAD,CAAMt0E,OAAQ,wBAAW8E,EAAMkS,MAAO,EAAK4+D,SAASJ,IAAW,GAA/D,SACH,cAAC,OAAD,CAAMzjE,MAAO+gC,EAAK+7B,OAAQ5qE,KAAM,CAAC0Q,OAAQyB,UAVrD,+JAEQjZ,KAAK2X,SAAS3X,KAAKgY,MAF3B,2GAA6BsB,SCAhBo/D,GAAb,4MAKY1gE,KAAOuD,cAAS,WAAO,IAEtB5T,EADe,EAAK+Q,WAApBs+D,YACArvE,KAEA+vE,EADM,EAAKh/D,WAAWy+D,eACtBO,UACL,OAAO,cAAC,OAAD,CAAM70E,OAAQ,8BAAY8E,EAA1B,SACH,qBAAKpF,UAAU,OAAf,SACKm1E,GAAaA,EAAU9vE,KAAI,SAACP,EAAGQ,GAC5B,OAAO,EAAK8wE,WAAWtxE,EAAGQ,aAb9C,EAmBY8wE,WAAa,SAACza,EAAcr2D,GAAkB,IAAD,EACrB,EAAK6Q,WAA5Bu/D,EAD4C,EAC5CA,QAASh/D,EADmC,EACnCA,WAEd,GADWg/D,EAAQpwE,GAEnB,OAAO,sBAAiBtF,UAAU,OAA3B,UACH,cAAC,MAAD,CAAKA,UAAU,4BAA4BsX,MAAO,EAAK4+D,SAASJ,GAAUxwE,EAAM,GAAhF,SAAqFowE,EAAQpwE,KAC7F,cAAC,OAAD,CAAM+M,MAAOspD,EAAOp3D,KAAM,CAAC0Q,OAAQyB,GAAao9B,KAAM,kBAAI,uBAAO9zC,UAAU,aAAjB,2BAF7CsF,IAvBzB,+JAEQ7H,KAAK2X,SAAS3X,KAAKgY,MAF3B,2GAAgCsB,SCAnBs/D,GAAb,4MAKY5gE,KAAOuD,cAAS,WAAO,IAAD,EACM,EAAK7C,WAAhCs+D,EADqB,EACrBA,YAAa/9D,EADQ,EACRA,WACbtR,EAAQqvE,EAARrvE,KACDguC,EAAO,EAAKj9B,WAAWy+D,eAC3B,OAAO,cAAC,OAAD,CAAMt0E,OAAQ,8BAAY8E,EAAMkS,MAAO,EAAK4+D,SAASJ,IAAW,GAAhE,SACH,cAAC,OAAD,CAAMzjE,MAAO+gC,EAAKuoB,MAAOp3D,KAAM,CAAC0Q,OAAQyB,UAVpD,+JAEQjZ,KAAK2X,SAAS3X,KAAKgY,MAF3B,2GAAkCsB,SCFrBu/D,GAAb,4MACYP,aADZ,IAEYh3D,OAAgB,CACpB,CAAC3Z,KAAM,OAAQnF,KAAM,SAAUw1B,UAAU,GACzC,CAACrwB,KAAM,SAAUnF,KAAM,WAJ/B,EAMYmyC,SAAoB,CACxB//B,MAAO,CACH,KAAQ,CAACoR,OAAQ,OAAQ9P,MAAO,eAAMiF,YAAa,8CACnD,OAAU,CAAC6K,OAAQ,SAAU9P,MAAO,eAAM3T,UAAW,qBATjE,EAiBYyxC,SAjBZ,uCAiBuB,WAAOrsC,EAAa+3C,GAApB,eAAAp+C,EAAA,sEACC,EAAKoX,WAAWogE,QAAQ,EAAKR,QAAS54B,EAAQziC,KAAKtT,MADpD,eAEHlJ,KADRP,EADW,+BAGX,EAAKqY,YAHM,0BAMfmnC,EAAQxjB,SAAS,OAAQh8B,GANV,2CAjBvB,0DA0BYyhD,QA1BZ,uCA0BsB,WAAOh6C,EAAa+3C,GAApB,SAAAp+C,EAAA,yDACD,SAATqG,EADU,gCAEJ,EAAKqsC,SAAS,QAAS0L,GAFnB,4EA1BtB,0DAiCY1nC,KAAO,WACX,IAAI+gE,EAAc,EAAKrgE,WAAWsgE,eAAe,EAAKV,SACtD,OAAO,cAAC,OAAD,CAAMz1E,OAAQ,kBAAUk2E,EAAar1E,KAAK,QAA1C,SACH,qBAAKnB,UAAU,wCAAf,SACI,cAAC,OAAD,CAAM+e,OAAQ,EAAKA,OAAQqzB,SAAU,EAAKA,SACtCgN,QAAS,EAAKA,QACdsD,cAAe,EAAKjR,gBAvCxC,4FAYeskC,GAZf,iEAaQt4E,KAAKs4E,QAAUA,EACft4E,KAAK2X,SAAS3X,KAAKgY,MAd3B,4GAAkCsB,SCCrB2/D,GAAb,4MAKYjhE,KAAOuD,cAAS,WAAO,IAAD,EACa,EAAK7C,WAAvCs+D,EADqB,EACrBA,YAAa9Y,EADQ,EACRA,MAAOjlD,EADC,EACDA,WACpBtR,EAAQqvE,EAARrvE,KACL,OAAO,cAAC,OAAD,CAAM9E,OAAQ,8BAAY8E,EAA1B,SACH,cAAC,OAAD,CAAMiN,MAAOspD,EAAOp3D,KAAM,CAAC0Q,OAAQyB,UAT/C,+JAEQjZ,KAAK2X,SAAS3X,KAAKgY,MAF3B,2GAA+BsB,SCUlB4/D,GADZ39D,aACD,+MACI9Y,QAAU,SAACgY,GAGP,OAFAA,EAAI8e,iBACJr2B,MAAId,KAAK,cAAC,GAAD,CAAUqL,GAAI,EAAKlM,MAAMkM,OAC3B,GAJf,uDAMc,IAGF3C,EAHC,EACmC9K,KAAKuB,MAAxCkM,EADA,EACAA,GAAIlL,EADJ,EACIA,UAAW66D,EADf,EACeA,SAAUsF,EADzB,EACyBA,OAC1BS,EAAM5uC,EAAO2pC,MAAMj+D,IAAIwN,GAE3B,GAAY,OAAR01D,EACAr4D,EAAU2C,MAET,CAAC,IACG9F,EAAcw7D,EAAdx7D,KAAMsJ,EAAQkyD,EAARlyD,UACMxQ,IAAb28D,IAAwBnsD,EAAOmsD,GAE/BtyD,OADSrK,IAATkH,EACUsJ,EAAM,qCAAE,4BAAIA,IAAN,IAAiBtJ,KAAW,mCAAE,4BAAIA,MAGxC8F,EAGlB,OAAOg1D,GAAKC,EAAQngE,EAAWvC,KAAKyC,QAASqI,OAvBrD,GAA8BpI,eAA9B,GA4BMy2E,GADL59D,a,+MAEW+c,U,yDAEJ,IAAIpyB,EAAKquB,EAAO2pC,MAAMj+D,IAAID,KAAKuB,MAAMkM,IAChC9F,EAAoBzB,EAApByB,KAAMsJ,EAAc/K,EAAd+K,KAAMD,EAAQ9K,EAAR8K,KAMjB,OALAhR,KAAKs4B,KAAO,CACR,GACA,CAAC91B,KAAM,YAAay3B,UAAW,cAAC,QAAD,CAAOjpB,KAAMA,EAAMooC,KAAMnoC,EAAMkgC,YAAaxpC,KAC3E,IAEG,cAAC,OAAD,CAAM9E,OAAQ,0CAAd,SACH,cAAC,WAAD,CAAUy1B,KAAMt4B,KAAKs4B,KAAM9T,OAAQxkB,KAAKuB,c,GAX7BmB,e,GCrCV02E,GAAb,4MACYzvE,UADZ,IAOY0a,IAAM,SAAClM,EAAiBib,EAC5BimD,EACAC,EACA9+D,GAEA,GAAKrC,EACL,OAAO,wBAAO5V,UAAW+V,KACrB,8DACA,CAAC,kBAAkBghE,IAFhB,UAGH,uBAAO92E,KAAK,WAAWD,UAAU,OAAO8pC,eAAgBgtC,EACpD79D,SAAU89D,EACV9+D,SAAUA,IACd,sBAAMjY,UAAW6wB,EAAjB,SAAsBjb,QAnBlC,EAuBYohE,eAvBZ,uCAuB6B,WAAO9hE,GAAP,eAAAnW,EAAA,sEACL,EAAKoX,WAAW8gE,YAAY,EAAK7vE,KAAM8N,GADlC,YAEThX,KADRP,EADiB,QAEE,EAAKqY,YACvBrI,MAAMhQ,GAHU,2CAvB7B,wDA6BYu5E,cA7BZ,uCA6B4B,WAAOhiE,EAAe6gE,GAAtB,eAAAh3E,EAAA,sEACJ,EAAKoX,WAAWghE,WAAW,EAAK/vE,KAAM2uE,EAAS7gE,GAD3C,YAIRhX,KAHRP,EADgB,SAIGgQ,MAAMhQ,GAJT,2CA7B5B,0DAoCYy5E,SApCZ,sBAoCuB,4BAAAr4E,EAAA,sEACC,EAAKoX,WAAWkhE,QAAQ,EAAKjwE,MAD9B,YAEHlJ,KADRP,EADW,QAEQ,EAAKqY,YACvBrI,MAAMhQ,GAHI,2CApCvB,EA0CY8X,KAAO,WAAO,IAAD,EACS,EAAKrO,KAA1BozD,EADY,EACZA,QAASib,EADG,EACHA,SACVn1E,EAAS,0DAAY,cAAC,GAAD,CAAU4K,GAAI,EAAK9D,KAAK8D,QAC7CosE,EAAS,EAAKlwE,KAAK8D,KAAO,EAAKiL,WAAW/O,KAAK8D,IAC5C,qBAAKlL,UAAU,iBAAf,SAAgC,yBAAQE,QAAS,EAAKk3E,SACjDp3E,UAAU,iCADiB,UAE9B,cAAC,KAAD,CAAIoF,KAAK,UAFqB,oCAInC2xE,EAAY,EAAK3vE,KAAK8D,KAAO,EAAKiL,WAAW/O,KAAK8D,GAClDqsE,EAAa,uCAAG,WAAOjxE,GAAP,SAAAvH,EAAA,sEACV,EAAKi4E,eAAe1wE,EAAM8R,OAAOkd,SADvB,2CAAH,sDAGjB,OAAO,cAAC,OAAD,CAAMh1B,OAAQA,EAAd,SACH,sBAAKN,UAAU,OAAf,UACK,EAAK8hB,IAAI,wBAAU,gCAAiC04C,EAASuc,EAAWQ,GACzE,qBAAKv3E,UAAU,SACd,EAAKmW,WAAWu/D,QAAQrwE,KAAI,SAACP,EAAGQ,GAC7B,IAAIkyE,EAAY,uCAAG,WAAOlxE,GAAP,SAAAvH,EAAA,sEACT,EAAKm4E,cAAc5wE,EAAM8R,OAAOkd,QAAShwB,GADhC,2CAAH,sDAGZwxE,EAAwC,KAA3BrB,EAAY,GAAGnwE,GAChC,OAAO,EAAKwc,IAAIhd,EAAG,eAAgBgyE,GAAW,EAAOU,MAExDF,QAjEjB,4FAEelwE,GAFf,iEAGQ3J,KAAK2J,KAAOA,EACZ3J,KAAK2X,SAAS3X,KAAKgY,MAJ3B,4GAAmCsB,SCuBtB0gE,IAAb,+MACIz5E,UADJ,IAEIy2E,iBAFJ,IAGIhS,gBAHJ,IAII6C,YAJJ,IAKIoQ,aALJ,0IA2EId,aAAe,WACX,IAEIO,EAFAhG,EAAgB,GAChBxT,EAAe,GAEfuZ,EAAgB,EAChBxyE,EAAM,EACV,GAAI,EAAKgzE,QAAS,CACdhzE,EAAM,EAAKgzE,QAAQjzE,OACnB0yE,EAAY,GACZ,IAAK,IAAIv1E,EAAE,EAAGA,EAAE8C,EAAK9C,IAAKu1E,EAAUt1E,KAAK,IATtB,oBAWN,EAAK87D,OAXC,IAWvB,2BAA6B,CAAC,IAArBv0D,EAAoB,QACpBozD,EAAqBpzD,EAArBozD,QAASib,EAAYruE,EAAZquE,SACViC,GAAS,EAAMC,GAAS,GACZ,IAAZnd,IACA2U,EAAOtvE,KAAKuH,GACZswE,GAAS,GAIb,IADA,IAAIE,EAAO,EACFh4E,EAAE,EAAGA,EAAE8C,EAAK9C,IAAKg4E,IAAO,EAC7B,GAA0B,KAArBnC,EAAWmC,GAAa,CACzB,IAAIC,EAAM1C,EAAUv1E,GAChB,EAAKwH,KAAK8D,KAAO9D,EAAK8D,GACtB2sE,EAAInlD,QAAQtrB,GAEZywE,EAAIh4E,KAAKuH,GACbswE,GAAS,EACTC,GAAS,GAGF,IAAXA,KACEzC,GAES,IAAXwC,GACA/b,EAAM97D,KAAKuH,IAnCI,8BAuCvB,OADA,EAAK8tE,cAAgBA,EACd,CACH/F,OAAQA,EACRxT,MAAOA,EACPwZ,UAAWA,IArHvB,EAyHIT,WAzHJ,sBAyHiB,sBAAA31E,EAAA,sEACe+7D,EAAO3xC,WAAW,EAAKsrD,YAAYvpE,IADlD,OACT,EAAKu3D,WADI,OAET,EAAKpX,UAAUgqB,IAFN,2CAzHjB,EA8HIE,aA9HJ,sBA8HmB,oCAAAx2E,EAAA,2DACc,EAAK01E,YAAzBvpE,EADM,EACNA,GAAI+zD,EADE,EACFA,OAAQ75D,EADN,EACMA,KAEF,IAAX65D,EAHO,gCAISpD,GAAMwG,eAAen3D,GAJ9B,oBAKI,GALJ,uBAMHyC,MAAM,wDANH,mBAOI,GAPJ,iCASA,GATA,UAYI,IAAXsxD,EAZO,kCAaS,EAAK79D,QAAQ,CACzBwU,QAAS,kBAAUxQ,EACnB/E,QAAS,4GACTmJ,GAAI,iBAhBD,WAkBK,OAlBL,kDAkBkB,GAlBlB,yBAmBDqyD,GAAMyG,YAAYp3D,GAnBjB,kCAqBA,GArBA,eAwBPq3D,EAAiBx0D,IAAEgN,MAAM,EAAK05D,cAC3BvpE,GAAKA,EACZq3D,EAAOtD,OAAS,EA1BL,UA2BKpD,GAAM2G,WAAWD,GA3BtB,qBA4BA,GA5BA,wBA6BP50D,MAAM,wDA7BC,mBA8BA,GA9BA,kCAgCJ,GAhCI,4CA9HnB,EAiKIqnE,WAjKJ,sBAiKiB,sBAAAj2E,EAAA,sDACT,EAAKssD,UAAU4qB,IADN,2CAjKjB,EAqKIhB,UArKJ,sBAqKgB,sBAAAl2E,EAAA,sDACR,EAAKssD,UAAU8qB,IADP,2CArKhB,EAyKIf,UAzKJ,sBAyKgB,sBAAAr2E,EAAA,sDACR,EAAKssD,UAAUgrB,IADP,2CAzKhB,EA6KI1B,aA7KJ,sBA6KmB,sBAAA51E,EAAA,sDACX,EAAKssD,UAAUqrB,IADJ,2CA7KnB,EAiLIV,gBAAkB,SAACD,GACf,EAAK1qB,UAAUirB,GAAcP,IAlLrC,EAqLIJ,iBAAmB,SAACvuE,GAChB,EAAKikD,UAAUwrB,GAAezvE,IAtLtC,EAwNIsP,WAAa,SAACtP,EAAW9B,GACrB,OAAO,EAAKwtC,WAAW0iC,GAAOpuE,IAzNtC,EAmQIiwE,QAnQJ,uCAmQc,WAAOjwE,GAAP,qBAAArI,EAAA,sEACUm7D,EAAQ4d,YAAY,EAAK95E,KAAKkN,GAAI,EAAKupE,YAAYvpE,GAAI9D,EAAK8D,QAAIhN,EAAW,GADrF,eAEMA,KADRP,EADE,iDAEwB,gBAFxB,UAGDuN,EAASvN,EAATuN,QACKhN,KADD8S,EAAKrT,EAALqT,GAHH,yCAIsBA,GAJtB,OAKF1L,EAAQ,EAAKq2D,MAAMluC,WAAU,SAAA3oB,GAAC,OAAIA,EAAEoG,KAAOA,KAC/C,EAAKywD,MAAMhpC,OAAOrtB,EAAO,GANnB,4CAnQd,2JAWwBtH,EAAWy2E,GAXnC,wEAYQh3E,KAAKO,KAAOA,EACZP,KAAKg3E,YAAcA,EACnBh3E,KAAKs6E,SAAoC,IAAzBtD,EAAYsD,SAdpC,SAect6E,KAAKu6E,gBAfnB,OAgBQv6E,KAAK4tD,UAAUmpB,IAhBvB,yTAoBgCta,EAAQ+d,cAAcx6E,KAAKO,KAAKkN,GAAIzN,KAAKg3E,YAAYvpE,IApBrF,OAoBYvN,EApBZ,SAqB+BA,EAAI,GAAG,GAAzBu6E,EArBb,EAqBaA,QAASvoB,EArBtB,EAqBsBA,MACdlyD,KAAK6nE,OAAS4S,EACVvoB,IACAlyD,KAAKi4E,QAAW/lB,EAAiBt0C,MAAM,OAE3C5d,KAAKk+D,MAAQ,GA1BrB,cA2B0Bh+D,EAAI,IA3B9B,IA2BQ,2BAASsxE,EAAiB,QACZ/jE,EAAM+jE,EAAX7nE,MACDxH,EAAInC,KAAK06E,WAAWjtE,KACjB,IAAGzN,KAAKk+D,MAAM/7D,GAAG46D,SAAU,GA9B9C,WAAAhoD,EAAA,iBAgCY0iE,EAAgB,EAhC5B,cAiC8Bv3E,EAAI,IAjClC,IAiCQ,2BAASy6E,EAAqB,QAChBltE,EAAaktE,EAAlBhxE,KAASuoD,EAASyoB,EAATzoB,OACV/vD,EAAInC,KAAK06E,WAAWjtE,KACjB,IAEHzN,KAAKk+D,MAAM/7D,GAAG61E,SAAW9lB,EAEpBA,GAAOulB,KAxC5B,WAAA1iE,EAAA,+BA2CyB7U,EAAI,IA3C7B,IA2CQ,2BAAS4G,EAAgB,QACX2G,EAAgB3G,EAArB6C,KAASyzD,EAAYt2D,EAAZs2D,UACVj7D,EAAInC,KAAK06E,WAAWjtE,KACjB,IAAGzN,KAAKk+D,MAAM/7D,GAAGi7D,SAAWA,GA9C/C,WAAAroD,EAAA,iBAgDQ/U,KAAKy3E,cAAgBA,EAhD7B,wIAmDuBhqE,GACf,IACItL,EADA8C,EAAMjF,KAAKk+D,MAAMl5D,OAErB,IAAK7C,EAAE,EAAGA,EAAE8C,EAAK9C,IAAK,CAClB,IACIyc,EADI5e,KAAKk+D,MAAM/7D,GACPsL,GACZ,GAAIA,IAAOmR,EAAK,OAAOzc,EACvB,GAAIsL,EAAKmR,EAAK,MAGlB,OADA5e,KAAKk+D,MAAMhpC,OAAO/yB,EAAG,EAAG,CAACsL,GAAGA,IACrBtL,IA7Df,iCAgEuB8iB,GACf,QAAqBxkB,IAAjBT,KAAKi4E,QAAT,CAIA,IAHA,IAAI/3E,EAAe,GACf+E,EAAMjF,KAAKi4E,QAAQjzE,OACnBm1E,EAAO,EACFh4E,EAAE,EAAEA,EAAE8C,EAAK9C,IAAKg4E,IAAO,GACvBl1D,EAAIk1D,KAAUA,GAAMj6E,EAAIkC,KAAKD,GAEtC,OAAOjC,KAxEf,qCAyLmBo4E,GACX,OAAOA,GACH,KAAM,EAAG,MAAO,0BAChB,KAAM,EAAG,MAAO,6BAChB,QAAS,OAAOt4E,KAAKi4E,QAAQK,MA7LzC,uEAiMkBA,EAAgBpnB,GAjMlC,wFAkMY0pB,EAAiBtC,GAAS,EAAGA,EAAU,GAAIA,EAAQ,EAlM/D,SAmMwB7b,EAAQ4d,YAAYr6E,KAAKO,KAAKkN,GAAIzN,KAAKg3E,YAAYvpE,QAAIhN,EAAWywD,EAAU0pB,GAnMpG,eAoMoBn6E,KADRP,EAnMZ,iDAoMsC,gBApMtC,UAqMaqT,EAASrT,EAATqT,EAAG9F,EAAMvN,EAANuN,QACEhN,IAAN8S,EAtMZ,yCAsMoCA,GAtMpC,OAwMYpR,EAAInC,KAAK06E,WAAWjtE,GAEpB9D,EAAO3J,KAAKk+D,MAAM/7D,GAClBm2E,EAAU,EACV3uE,EAAKquE,UAAa,GAAGM,EAAQ,GAEX,IAAbA,IAEL3uE,EAAKozD,SAAU,GAhN3B,qLA4NsBpzD,EAAWoG,GA5NjC,wFA6NatC,EAAmC9D,EAAnC8D,GAAIsvD,EAA+BpzD,EAA/BozD,QAASib,EAAsBruE,EAAtBquE,SAAU5a,EAAYzzD,EAAZyzD,SAC5BL,EAAUhtD,EA9NlB,SA+NwB0sD,EAAQ+c,YACpBx5E,KAAKO,KAAKkN,GAAIzN,KAAKg3E,YAAYvpE,GAC/BA,OAAIhN,GAAqB,IAAVs8D,EAAgB,EAAE,GAjO7C,eAkOoBt8D,KAHRP,EA/NZ,iDAmOmB,gBAnOnB,eAsOkBO,KADL8S,EAAKrT,EAALqT,GArOb,0CAsOoCA,GAtOpC,QAwOQvT,KAAK66E,UAAUlxE,EAAMozD,EAASib,EAAU5a,GAxOhD,oLA2OqBzzD,EAAW2uE,EAAgBvoE,GA3OhD,wFA4OatC,EAAyB9D,EAAzB8D,GAAIsvD,EAAqBpzD,EAArBozD,QAASK,EAAYzzD,EAAZyzD,UACP,IAAPrtD,EACApG,EAAKquE,UAAY,GAAGM,EAGpB3uE,EAAKquE,YAAc,GAAGM,GAEtBN,EAAWruE,EAAKquE,SAnP5B,SAoPwBvb,EAAQ4d,YACpBr6E,KAAKO,KAAKkN,GAAIzN,KAAKg3E,YAAYvpE,GAC/BA,OAAIhN,EAAWu3E,GAtP3B,eAuPoBv3E,KAHRP,EApPZ,iDAuPsC,gBAvPtC,eAyPkBO,KADL8S,EAAKrT,EAALqT,GAxPb,0CAyPoCA,GAzPpC,QA0PQvT,KAAK66E,UAAUlxE,EAAMozD,EAASib,EAAU5a,GA1PhD,4IA6PsBzzD,EAAWozD,EAAiBib,EAAiB5a,GAAkB,IACxE3vD,EAAM9D,EAAN8D,GACD5F,EAAQ7H,KAAKk+D,MAAMluC,WAAU,SAAA3oB,GAAC,OAAIA,EAAEoG,KAAOA,KAC/CzN,KAAKk+D,MAAMr2D,GAAS,CAAC4F,KAAIsvD,UAASib,WAAU5a,gBAhQpD,GAAkCiF,IAAlC,qCAOKnuD,KAPL,sGAQKA,KARL,2GASKA,KATL,kECtBa4mE,GAAb,4MAKYC,mBAAqB,SAACpxE,EAAa9B,GACvC,IAGIiD,EAHAkwE,EAA6B,EAAKtiE,WAAWuiE,UAAUC,gBAAgBvxE,GACtEgiB,EAAcqvD,EAAdrvD,IAAKqyC,EAASgd,EAAThd,MACNmd,EAAU5mD,EAAO2pC,MAAMj+D,IAAI0J,GAE/B,GAAgB,OAAZwxE,EAAkB,CAAC,IACdxzE,EAAoBwzE,EAApBxzE,KAAMsJ,EAAckqE,EAAdlqE,KAAMD,EAAQmqE,EAARnqE,KACjBlG,EAAU,cAAC,MAAD,CAAKvI,UAAU,QACrBkF,KAAM,cAAC,QAAD,CAAOlF,UAAU,iBAAiBsQ,IAAK7B,IAC7C6I,MAAO,sBAAKtX,UAAU,aAAf,iBAAiCopB,EAAI3mB,OAAO,uBAA5C,QAAuDg5D,EAAMh5D,UAF9D,SAGN,8BAAMiM,EAAM,qCAAE,4BAAIA,IAAS,uBAAK,uBAAO1O,UAAU,aAAjB,SAA+BoF,OAAmB,mCAAE,4BAAIA,UAGhG,OAAO,qBAAKpF,UAAU,YAAf,SAA4BuI,KAlB3C,EAqBYswE,oBAAsB,SAACzxE,GAC3B,EAAK+O,WAAW2iE,iBAAiB1xE,IAtBzC,EAyBY2xE,UAAY,WAChB,EAAK5iE,WAAW6iE,oBA1BxB,EA6BYvjE,KAAOuD,cAAS,WAAO,IACtB0/D,EAAa,EAAKviE,WAAlBuiE,UACA16E,EAAe06E,EAAf16E,KAAM29D,EAAS+c,EAAT/c,MACPrkD,EAAQ,wBAAQtX,UAAU,gDAAgDE,QAAS,EAAK64E,UAAhF,SAA2F,cAAC,KAAD,CAAI3zE,KAAK,WAChH,OAAO,cAAC,OAAD,CAAM9E,OAAQ,wBAAWtC,EAAKoH,KAAMkS,MAAOA,EAA3C,SACH,cAAC,OAAD,CAAMtX,UAAU,OAAOqS,MAAOspD,EAC1Bp3D,KAAM,CAAC0Q,OAAQ,EAAKujE,mBAAoBt4E,QAAS,EAAK24E,4BAnCtE,+JAEQp7E,KAAK2X,SAAS3X,KAAKgY,MAF3B,2GAAiCsB,SCApBkiE,GAAb,4MACY7xE,UADZ,IAOY8xE,SAAW,SAACv1E,EAAY2B,GAC5B,OAAO,sBAAKtF,UAAU,+BAAf,UACH,cAAC,KAAD,CAAIA,UAAU,eAAeyqB,KAAK,KAAKrlB,KAAK,WAAW8rB,UAAU,IACjE,qBAAKlxB,UAAU,OAAf,SAAsB,cAAC,GAAD,CAAQkL,GAAIvH,UAV9C,EAcYw1E,WAAa,WACjB,EAAKhjE,WAAWijE,YAAY,EAAKhyE,OAfzC,EAkBYiyE,UAAY,SAAChe,EAAa/1D,GAC9B,OAAO,sBAAKtF,UAAU,+BAAf,UACH,cAAC,KAAD,CAAIA,UAAU,eAAeyqB,KAAK,KAAKrlB,KAAK,OAAO8rB,UAAU,IAC7D,qBAAKlxB,UAAU,OAAf,SAAsB,cAAC,GAAD,CAASkL,GAAImwD,UArB/C,EAyBYie,YAAc,WAClB,EAAKnjE,WAAWojE,cAAc,EAAKnyE,OA1B3C,EA6BYoyE,SA7BZ,sBA6BuB,sBAAAz6E,EAAA,sEACL,EAAKoX,WAAW/U,QAAQ,CAC9Bf,QAAS,2EACTmJ,GAAI,iBAHO,sBAIR,OAJQ,qCAKL,EAAK2M,WAAWsjE,OAAO,EAAKryE,MALvB,OAMX,EAAK4O,YANM,2CA7BvB,EAuCYP,KAAOuD,cAAS,WAAO,IAAD,EACD,EAAK7C,WAAWuiE,UAAUC,gBAAgB,EAAKvxE,MAAnEA,EADqB,EACrBA,KAAMgiB,EADe,EACfA,IAAKqyC,EADU,EACVA,MACZie,EAAW,wBAAQ15E,UAAU,yBAAyBE,QAAS,EAAKi5E,WAAzD,SAAqE,cAAC,KAAD,CAAI/zE,KAAK,aACzFu0E,EAAW,cAAC,MAAD,CAAK35E,UAAU,4BAA4BsX,MAAOoiE,EAAlD,gBACXE,EAAY,wBAAQ55E,UAAU,yBAAyBE,QAAS,EAAKo5E,YAAzD,SAAsE,cAAC,KAAD,CAAIl0E,KAAK,aAC3Fy0E,EAAY,cAAC,MAAD,CAAK75E,UAAU,4BAA4BsX,MAAOsiE,EAAlD,iBACZtiE,EAAQ,wBAAQtX,UAAU,qDAAqDE,QAAS,EAAKs5E,SAArF,SAA+F,cAAC,KAAD,CAAIp0E,KAAK,YAEpH,OAAO,eAAC,OAAD,CAAM9E,OAAO,8BAAegX,MAAOA,EAAnC,UACH,qBAAKtX,UAAU,YAAf,SAA2B,cAAC,GAAD,CAAUkL,GAAI9D,MACzC,qBAAKpH,UAAU,SAEd25E,EACD,cAAC,OAAD,CAAM35E,UAAU,OAAOqS,MAAO+W,EAC1B7kB,KAAM,CAAC0Q,OAAQ,EAAKikE,SAAUh5E,aAAShC,KAC3C,qBAAK8B,UAAU,SACd65E,EACD,cAAC,OAAD,CAAM75E,UAAU,OAAOqS,MAAOopD,EAC1Bl3D,KAAM,CAAC0Q,OAAQ,EAAKokE,UAAWn5E,aAAShC,WAzDxD,4FAEekJ,GAFf,iEAGQ3J,KAAK2J,KAAOA,EACZ3J,KAAK2X,SAAS3X,KAAKgY,MAJ3B,4GAA+BsB,SCAlB+iE,GAAb,4MACY1yE,UADZ,IAOY2yE,eAPZ,uCAO6B,WAAO7hE,EAAyCuiD,GAAhD,SAAA17D,EAAA,sEACf,EAAKoX,WAAW6jE,cAAc9hE,EAAIE,OAAOkd,QAAS,KAAM,EAAKluB,KAAMqzD,GADpD,2CAP7B,0DAWYwf,aAAe,SAAC11E,EAAsCe,GAAmB,IACxEm1D,EAAiBl2D,EAAjBk2D,IAAK/2B,EAAYn/B,EAAZm/B,SACV,OAAO,wBAAO1jC,UAAU,oCAAjB,UACH,uBAAOA,UAAU,OAAOC,KAAK,WAAW6pC,eAAgBpG,EACpDzrB,SAAQ,uCAAE,WAAMC,GAAN,SAAAnZ,EAAA,sEAAmB,EAAKg7E,eAAe7hE,EAAKuiD,GAA5C,mFAAF,wDACZ,cAAC,KAAD,CAAIz6D,UAAU,eAAeyqB,KAAK,KAAKrlB,KAAK,WAAW8rB,UAAU,IACjE,qBAAKlxB,UAAU,OAAf,SAAsB,cAAC,GAAD,CAAQkL,GAAIuvD,UAjB9C,EAqBYyf,UAAY,SAACv2E,KArBzB,EAwBY8R,KAAOuD,cAAS,WAAO,IACtB0/D,EAAa,EAAKviE,WAAlBuiE,UACAvK,EAAUuK,EAAVvK,OAFqB,EAGRuK,EAAUC,gBAAgB,EAAKvxE,MAA5CA,EAHqB,EAGrBA,KAAMgiB,EAHe,EAGfA,IACP+wD,EAA2ChM,EAAO9oE,KAAI,SAAA1B,GACtD,MAAO,CACH82D,IAAK92D,EACL+/B,SAAUta,EAAIqE,WAAU,SAAA3oB,GAAC,OAAIA,IAAInB,MAAO,MAGhD,OAAO,eAAC,OAAD,CAAMrD,OAAO,oBAAb,UACH,qBAAKN,UAAU,YAAf,SAA2B,cAAC,GAAD,CAAUkL,GAAI9D,MACzC,qBAAKpH,UAAU,SAEf,cAAC,OAAD,CAAMA,UAAU,OAAOqS,MAAO8nE,EAC1B51E,KAAM,CAAC0Q,OAAQ,EAAKglE,aAAc/5E,QAAS,EAAKg6E,aACpD,qBAAKl6E,UAAU,eAxC3B,4FAEeoH,GAFf,iEAGQ3J,KAAK2J,KAAOA,EACZ3J,KAAK2X,SAAS3X,KAAKgY,MAJ3B,4GAA0BsB,SCAbqjE,GAAb,4MACYhzE,UADZ,IAOY2yE,eAPZ,uCAO6B,WAAO7hE,EAAyCuiD,GAAhD,SAAA17D,EAAA,sEACf,EAAKoX,WAAW6jE,cAAc9hE,EAAIE,OAAOkd,QAAS,MAAO,EAAKluB,KAAMqzD,GADrD,2CAP7B,0DAWY4f,cAAgB,SAAC91E,EAAsCe,GAAmB,IACzEm1D,EAAiBl2D,EAAjBk2D,IAAK/2B,EAAYn/B,EAAZm/B,SACV,OAAO,wBAAO1jC,UAAU,oCAAjB,UACH,uBAAOA,UAAU,OAAOC,KAAK,WAAW6pC,eAAgBpG,EACpDzrB,SAAQ,uCAAE,WAAMC,GAAN,SAAAnZ,EAAA,sEAAmB,EAAKg7E,eAAe7hE,EAAKuiD,GAA5C,mFAAF,wDACZ,cAAC,KAAD,CAAIz6D,UAAU,eAAeyqB,KAAK,KAAKrlB,KAAK,WAAW8rB,UAAU,IACjE,qBAAKlxB,UAAU,OAAf,SAAsB,cAAC,GAAD,CAASkL,GAAIuvD,UAjB/C,EAqBY6f,eAAiB,SAACjf,KArB9B,EAwBY5lD,KAAOuD,cAAS,WAAO,IACtB0/D,EAAa,EAAKviE,WAAlBuiE,UACAjd,EAASid,EAATjd,MAFqB,EAGIid,EAAUC,gBAAgB,EAAKvxE,MAAxDA,EAHqB,EAGrBA,KAAYmzE,EAHS,EAGf9e,MACPppD,EAAyCopD,EAAMp2D,KAAI,SAAAo1D,GACnD,MAAO,CACHA,IAAKA,EACL/2B,SAAU62C,EAAU9sD,WAAU,SAAA3oB,GAAC,OAAIA,IAAI21D,MAAQ,MAGvD,OAAO,eAAC,OAAD,CAAMn6D,OAAO,oBAAb,UACH,qBAAKN,UAAU,YAAf,SAA2B,cAAC,GAAD,CAAUkL,GAAI9D,MACzC,qBAAKpH,UAAU,SAEf,cAAC,OAAD,CAAMA,UAAU,OAAOqS,MAAOA,EAC1B9N,KAAM,CAAC0Q,OAAQ,EAAKolE,cAAen6E,QAAS,EAAKo6E,kBACrD,qBAAKt6E,UAAU,eAxC3B,4FAEeoH,GAFf,iEAGQ3J,KAAK2J,KAAOA,EACZ3J,KAAK2X,SAAS3X,KAAKgY,MAJ3B,4GAA4BsB,SCFfyjE,GAAb,4MAKYC,cALZ,uCAK4B,WAAOr1E,EAAa+3C,GAApB,mBAAAp+C,EAAA,sEACJ,EAAKoX,WAAWukE,OAAOv9B,EAAQziC,KAAKtT,MADhC,UAChBzJ,EADgB,OAGV,aADLqT,EAAKrT,EAALqT,GAFe,uBAIhB,EAAKgF,YAJW,+BAQZhF,EARY,OASX,YATW,QAUX,aAVW,QAWX,aAXW,QAYX,WAZW,gCASAtR,EAAQ,iFATR,oCAUCA,EAAQ,iFAVT,oCAWCA,EAAQ,iFAXT,oCAYDA,EAAQ,6CAZP,6BAcpBy9C,EAAQxjB,SAAS,OAAQj6B,GAdL,4CAL5B,0DAsBY+V,KAAO,WAWX,OAAO,cAAC,OAAD,CAAMnV,OAAO,iCAAb,SACH,cAAC,OAAD,CAAMN,UAAU,MAAM+e,OAXC,CACvB,CAAC3Z,KAAM,OAAQnF,KAAM,SAAU0Y,UAAW,GAAI8c,UAAU,GACxD,CAACrwB,KAAM,SAAUnF,KAAM,WASemyC,SAPjB,CACrB//B,MAAO,CACHjL,KAAM,CAACqc,OAAQ,OAAQ9P,MAAO,qBAAOiF,YAAa,0DAClD4oC,OAAQ,CAAC/9B,OAAQ,SAAU9P,MAAO,eAAM3T,UAAU,qBAKlDo/C,QAAS,EAAKq7B,cACd/3B,cAAe,EAAK+3B,mBApCpC,+JAEQh9E,KAAK2X,SAAS3X,KAAKgY,MAF3B,2GAAmCsB,SCItB4jE,GAAb,4MACIjC,eADJ,uGAGkCA,GAHlC,iEAIQj7E,KAAKi7E,UAAYA,EACjBj7E,KAAK4tD,UAAUktB,IALvB,8IAQqBnxE,GACb3J,KAAK4tD,UAAU4tB,GAAW7xE,KATlC,kCAYgBA,GACR3J,KAAK4tD,UAAUyuB,GAAM1yE,KAb7B,oCAgBkBA,GACV3J,KAAK4tD,UAAU+uB,GAAQhzE,KAjB/B,6EAoBwBk+B,EAAoBrlC,EAAiBmH,EAAaqzD,GApB1E,2EAqB2B,IAAfn1B,EArBZ,gCAsBkBw1B,EAAOkW,YAAY,CAAChzE,KAAMP,KAAKi7E,UAAU16E,KAAKkN,GAAIjL,KAAMA,EAAMw6D,IAAKA,EAAKsW,QAAS3pE,IAtBnG,OAuBY3J,KAAKi7E,UAAUtJ,KAAKvvE,KAAK,CACrBI,KAAMA,EACNmH,KAAMA,EACNqzD,IAAKA,IA1BrB,uCA8BkBK,EAAOmW,YAAY,CAACjzE,KAAMP,KAAKi7E,UAAU16E,KAAKkN,GAAIjL,KAAMA,EAAMw6D,IAAKA,EAAKsW,QAAS3pE,IA9BnG,QA+BgB9B,EAAQ7H,KAAKi7E,UAAUtJ,KAAK3hD,WAAU,SAAA3oB,GAAC,OAAIA,EAAE21D,MAAMA,GAAO31D,EAAE7E,OAAOA,GAAQ6E,EAAEsC,OAAOA,OAC3E,GAAG3J,KAAKi7E,UAAUtJ,KAAKz8C,OAAOrtB,EAAO,GAhC9D,uJAqCQ7H,KAAK4tD,UAAUmvB,MArCvB,sEAwCiB/f,GAxCjB,0FAyC4Bh9D,KAAKi7E,UAApB/c,EAzCb,EAyCaA,MAAO39D,EAzCpB,EAyCoBA,KAzCpB,SA0CwBk8D,EAAQwgB,OAAO18E,EAAKkN,GAAIuvD,GA1ChD,eA2CoBv8D,KADRP,EA1CZ,8BA4CkB,IAAI0O,MAAM,iBA5C5B,cA8Ca2E,EAASrT,EAATqT,EAAG9F,EAAMvN,EAANuN,GACE,YAAN8F,GACA2qD,EAAM97D,KAAKqL,GAhDvB,kBAkDevN,GAlDf,6KAqDiByJ,GArDjB,sFAsD4B3J,KAAKi7E,UAApB/c,EAtDb,EAsDaA,MAAO39D,EAtDpB,EAsDoBA,KAtDpB,SAuDck8D,EAAQuf,OAAOz7E,EAAKkN,GAAI9D,GAvDtC,QAwDY9B,EAAQq2D,EAAMluC,WAAU,SAAA3oB,GAAC,OAAIA,IAAMsC,OAC1B,GAAGu0D,EAAMhpC,OAAOrtB,EAAO,GAzD5C,4GAAiCw6D,ICiBpB8a,IAAb,cAQI,WAAY58E,GAAa,yBAPjB29B,QAAiB,EAOD,KANxB39B,UAMwB,0IACpBP,KAAKO,KAAOA,EATpB,uKAa4B,IAAhBP,KAAKk+B,OAbjB,iEAcwBu+B,EAAQwe,UAAUj7E,KAAKO,KAAKkN,IAdpD,OAcYvN,EAdZ,OAeQF,KAAKk+B,QAAS,EACdl+B,KAAKk+D,MAAQh+D,EAAI,GAAG0H,KAAI,SAAAP,GAAC,OAAIA,EAAEsC,QAC/B3J,KAAK2xE,KAAOzxE,EAAI,GAChBF,KAAK0wE,OAASxwE,EAAI,GAAG0H,KAAI,SAAAP,GAAC,OAAIA,EAAEoG,MAChCzN,KAAKg+D,MAAQ99D,EAAI,GAAG0H,KAAI,SAAAP,GAAC,OAAIA,EAAEoG,MAnBvC,6IAsBoB9D,GAGR,IAHmC,EAG/BgiB,EAAgB,GAChBqyC,EAAkB,GAClB99D,EAAM,CACNyJ,KAAMA,EACNgiB,IAAKA,EACLqyC,MAAOA,GARwB,cAUnBh+D,KAAK2xE,MAVc,IAUnC,2BAA2B,CAAC,IAAnB3U,EAAkB,QACvB,GAAIA,EAAIrzD,OAASA,EACb,OAAQqzD,EAAIx6D,MACR,IAAK,KAAMmpB,EAAIvpB,KAAK46D,EAAIA,KAAM,MAC9B,IAAK,MAAOgB,EAAM57D,KAAK46D,EAAIA,OAdJ,8BAmBvC,OAAO98D,IAzCf,mCA6CQ,IADoB,EAChBA,EAAgB,GADA,cAELF,KAAK0wE,QAFA,IAEpB,2BAA4B,CAAC,IAApBxqE,EAAmB,QACpBg4D,EAAkB,GACtBh+D,EAAIkC,KAAK,CACL8D,GAAIA,EACJg4D,MAAOA,IAJa,oBAMRl+D,KAAK2xE,MANG,IAMxB,2BAA2B,CAAC,IAAnB3U,EAAkB,QACN,OAAbA,EAAIx6D,MAAiBw6D,EAAIA,MAAQ92D,GACjCg4D,EAAM97D,KAAK46D,EAAIrzD,OARC,gCAFR,8BAcpB,OAAOzJ,IA1Df,oCA8DQ,IADsB,EAClBA,EAAiB,GADC,cAENF,KAAKg+D,OAFC,IAEtB,2BAA4B,CAAC,IAApBJ,EAAmB,QACpBM,EAAkB,GACtBh+D,EAAIkC,KAAK,CACLw7D,IAAKA,EACLM,MAAOA,IAJa,oBAMRl+D,KAAK2xE,MANG,IAMxB,2BAA2B,CAAC,IAAnB3U,EAAkB,QACN,QAAbA,EAAIx6D,MAAkBw6D,EAAIA,MAAQY,GAClCM,EAAM97D,KAAK46D,EAAIrzD,OARC,gCAFN,8BActB,OAAOzJ,MA3Ef,0CAGKgU,KAHL,oGAIKA,KAJL,mGAKKA,KALL,kGAMKA,KANL,kECpBakpE,GAAb,4MAKYppC,SALZ,uCAKuB,WAAOrsC,EAAa+3C,GAApB,mBAAAp+C,EAAA,+DACUo+C,EAAQ1kB,KAAK/d,KAAjC6/C,EADU,EACVA,QAASC,EADC,EACDA,QADC,SAET,EAAKrkD,WAAW2kE,SAASvgB,EAASC,GAFzB,OAGf,EAAKxkD,YAHU,2CALvB,0DAUYP,KAAOuD,cAAS,WAAM,IAOtB+F,EAPqB,EACJ,EAAK5I,WAArBnY,EADoB,EACpBA,KAAMmxE,EADc,EACdA,OACNwE,EAAmB31E,EAAnB21E,OAAQpZ,EAAWv8D,EAAXu8D,QACT2V,EAAYf,EAAOpT,IAEnBkT,EAAmB,CAAC7pE,KAAM,UAAWnF,KAAM,WAC3CuhD,EAAsB,CAACp8C,KAAM,SAAUnF,KAAM,UAElC,IAAX0zE,EAAc50D,EAAS,CAJJ,CAAC3Z,KAAM,UAAWnF,KAAM,WAIZgvE,EAAOztB,GACrB,IAAZ+Y,IAAex7C,EAAS,CAACkwD,EAAOztB,IACzC,IAAI9mC,EAAO,CACP6/C,QAAS2V,EAAU3V,QACnBC,QAAS0V,EAAU1V,SAWvB,OAAO,cAAC,OAAD,CAAMl6D,OAAO,eAAb,SACH,sBAAKN,UAAU,OAAf,UACI,cAAC,GAAD,gBAAYmvE,EAAOpT,MACnB,cAAC,OAAD,CAAMh9C,OAAQA,EAAQqzB,SAXf,CACX//B,MAAO,CACH,QAAW,CAACoR,OAAQ,WAAY9P,MAAO,eAAMwhB,UAAU,EAAGC,WAAW,GACrE,QAAW,CAAC3R,OAAQ,WAAY9P,MAAO,qBAAOwhB,UAAU,EAAGC,WAAW,GACtE,OAAU,CAAC3R,OAAQ,SAAU9P,MAAO,eAAM3T,UAAW,qBAOX2lC,SAAUjrB,EAAMgoC,cAAe,EAAKjR,mBApC9F,+JAEQh0C,KAAK2X,SAAS3X,KAAKgY,MAF3B,2GAAgCsB,SA0C1BgkE,GAAS,SAAC/7E,GAAqB,IAC5BoG,EAAoBpG,EAApBoG,KAAMsJ,EAAc1P,EAAd0P,KAAMD,EAAQzP,EAARyP,KAEjB,OAAO,gCACH,sBAAKzO,UAAU,cAAf,UACI,cAAC,QAAD,CAAOA,UAAU,iBAAiBsQ,IAAK7B,IACvC,sBAAKzO,UAAU,GAAf,UACI,oBAAIA,UAAU,YAAd,SAA2BoF,IAC1BsJ,GAAQ,6BAAI,uBAAO1O,UAAU,iBAAjB,SAAmC0O,YAGxD,oBAAI1O,UAAU,aCtDTg7E,GAAb,4MACYjF,aADZ,IAEYh3D,OAAgB,CACpB,CAAC3Z,KAAM,OAAQnF,KAAM,SAAUw1B,UAAU,GACzC,CAACrwB,KAAM,SAAUnF,KAAM,WAJ/B,EAMYmyC,SAAoB,CACxB//B,MAAO,CACH,KAAQ,CAACoR,OAAQ,OAAQ9P,MAAO,eAAMiF,YAAa,8CACnD,OAAU,CAAC6K,OAAQ,SAAU9P,MAAO,eAAM3T,UAAW,qBATjE,EAiBYyxC,SAjBZ,uCAiBuB,WAAOrsC,EAAa+3C,GAApB,iBAAAp+C,EAAA,sEACC,EAAKoX,WAAW8kE,SAAS99B,EAAQziC,KAAKtT,MADvC,eAEHlJ,KADRP,EADW,+BAGX,EAAKqY,YAHM,+BAOPrY,EAPO,OASN,aATM,QAUN,OAVM,QAWN,UAXM,8BAQFgC,EAAM,2BARJ,oCASMA,EAAM,iCATZ,oCAUAA,EAAM,yDAVN,oCAWGA,EAAM,uCAXT,6BAafw9C,EAAQxjB,SAAS,OAAQh6B,GAbV,4CAjBvB,0DAiCYy/C,QAjCZ,uCAiCsB,WAAOh6C,EAAa+3C,GAApB,SAAAp+C,EAAA,yDACD,SAATqG,EADU,gCAEJ,EAAKqsC,SAAS,QAAS0L,GAFnB,4EAjCtB,0DAwCY1nC,KAAO,WAEX,OAAO,cAAC,OAAD,CAAMnV,OAAQ,kBAAU46C,uBAAY,EAAK/kC,WAAWnY,MAAQ,qBAAOmD,KAAK,QAAxE,SACH,qBAAKnB,UAAU,wCAAf,SACI,cAAC,OAAD,CAAM+e,OAAQ,EAAKA,OAAQqzB,SAAU,EAAKA,SACtCgN,QAAS,EAAKA,QACdsD,cAAe,EAAKjR,gBA9CxC,4FAYeskC,GAZf,iEAaQt4E,KAAKs4E,QAAUA,EACft4E,KAAK2X,SAAS3X,KAAKgY,MAd3B,4GAA+BsB,SCIlBk/D,IAAb,+MACYvyD,UADZ,4JAUYw3D,YAAc,aAV1B,EAaYjtB,YAAc,SAACgiB,GAEnB,EAAK95D,WAAWg5D,OAAOpT,IAAMkU,EAC7B,EAAK5kB,UAAUwvB,KAhBvB,EAmBYM,aAAe,SAAClL,EAAc3qC,EAAoBwtB,GACtD,EAAKsoB,YAActoB,GApB3B,EAuBYuoB,YAAc,WAClB,EAAK33D,KAAK4vC,aAxBlB,EA2BYgoB,WAAa,WACjB,EAAK53D,KAAK6vC,eA5BlB,EA+BYgoB,MA/BZ,sBA+BoB,sBAAAx8E,EAAA,sEACN,EAAKoX,WAAWqlE,UAAU,EAAK93D,KAAKguC,eAD9B,2CA/BpB,EAmCY5vC,IAAM,YAAmC,IAAjCrT,EAAgC,EAAhCA,KAAMrJ,EAA0B,EAA1BA,KAAMsJ,EAAoB,EAApBA,KACpBnG,EAAUmG,EACV,qCAAE,4BAAIA,IAAN,SAAuB,uBAAO1O,UAAU,aAAjB,SAA+BoF,OAEtD,4BAAIA,IACJF,EAAO,cAAC,QAAD,CAAOlF,UAAU,gBAAgBsQ,IAAK7B,IACjD,OAAO,cAAC,MAAD,CAAKzO,UAAU,gCAAgCkF,KAAMA,EAArD,SACH,qBAAKlF,UAAU,OAAf,SAAuBuI,OA1CnC,EA8CIkzE,WAAa,WACT,EAAKpwB,UAAU2vB,KA/CvB,EAkDYvlE,KAAOuD,cAAS,WAAO,IACtBm2D,EAAU,EAAKh5D,WAAfg5D,OACD73D,EAAQ,wBACRtX,UAAU,gDACVE,QAAS,EAAKu7E,WAFN,SAEkB,cAAC,KAAD,CAAIr2E,KAAK,WAkCnCs2E,EAAa,cAAC,OAAD,CAAMhsD,IAAK,SAAChM,GAAD,OAAU,EAAKA,KAAOA,GAC9C1jB,UAAU,OAAOqS,MAAO88D,EAAOA,OAC/Br7B,KAAK,WACLvvC,KAAM,CAAC0Q,OAAQ,EAAK6M,IAAKowC,SAAU,EAAKipB,gBAExCtM,EAAQ,mCACR54D,EAAUk5D,EAAOA,OAAO1sE,OAAS,GAAK,sBAAKzC,UAAU,OAAf,UACtC,wBAAQA,UAAW6uE,EAAO3uE,QAAS,EAAKm7E,YAAxC,0BACA,wBAAQr7E,UAAW6uE,EAAO3uE,QAAS,EAAKo7E,WAAxC,0BACA,wBAAQt7E,UAAW6uE,EAAO51D,SAAU,EAAKmiE,WAAYl7E,QAAS,EAAKq7E,MAAnE,6BAGJ,OAAO,cAAC,OAAD,CAAMj7E,OAAO,qBAAMgX,MAAOA,EAA1B,SACH,sBAAKtX,UAAU,OAAf,UACKiW,EACAylE,EACAzlE,UAxGjB,+JAOQxY,KAAK2X,SAAS3X,KAAKgY,MAP3B,2GAA6BsB,SAA7B,gDAEKpF,KAFL,yEAE4C,KAF5C,kDAGKA,KAHL,yEAG8C,KAH9C,0CAIKA,KAJL,yEAIsC,KAJtC,ICJagqE,GAAb,4MACI39E,UADJ,IAEImxE,YAFJ,IAWI2L,SAXJ,uCAWe,WAAOvgB,EAAgBC,GAAvB,SAAAz7D,EAAA,sEACD,EAAKowE,OAAOkB,aAAa9V,EAASC,EAAS,GAD1C,2CAXf,0DAeIygB,SAfJ,uCAee,WAAO7zE,GAAP,eAAArI,EAAA,sEACS,EAAKowE,OAAOoB,aAAanpE,EAAM,EAAG,EAAG,GAD9C,UAEY,kBADfzJ,EADG,kFAGAA,GAHA,2CAff,wDAqBI69E,UArBJ,uCAqBgB,WAAOzL,GAAP,eAAAhxE,EAAA,sEACE,EAAKqC,QAAQ,CACnBwU,QAAS,2BACTvV,QAAS,2EAAiB0vE,EAAW1qE,KAAI,SAAAP,GAAC,OAAIA,EAAEM,QAAMyc,KAAK,KAC3DrY,GAAI,iBAJA,sBAKD,OALC,4BAMA+jB,EAA0BwiD,EAAW1qE,KAAI,SAAAP,GAAC,OAAI,EAAKqqE,OAAOqB,aAAa1rE,MANvE,SAOE8D,QAAQilB,IAAIN,GAPd,2CArBhB,2JAGkCvvB,GAHlC,wEAIQP,KAAKO,KAAOA,EACZP,KAAK0xE,OAAS,IAAIW,GAAO9xE,GALjC,SAMcP,KAAK0xE,OAAO7yC,OAN1B,OAQQ7+B,KAAK4tD,UAAU4qB,IARvB,4GAA6BnW,ICChB8b,GAAb,4MAKY9sB,UAAY,SAAC+sB,EAAoBv2E,GAA8B,IAC9DupC,EAAoBgtC,EAApBhtC,IAAKvkB,EAAeuxD,EAAfvxD,KAAMqxC,EAASkgB,EAATlgB,MACXv2D,EAAqBypC,EAArBzpC,KAAMwpC,EAAeC,EAAfD,YACPt3B,EAAQ,uBAAOtX,UAAU,aAAjB,SAA+B4uC,IAC3C,OAAO,sBAAK5uC,UAAU,oBAAf,UACH,eAAC,MAAD,CAAKA,UAAU,OAAOsX,MAAOA,EAA7B,UACI,cAAC,KAAD,CAAIlS,KAAK,iBAAiBpF,UAAU,sBACpC,4BAAIoF,OAER,gCACI,uBAAOpF,UAAU,aAAjB,4BACgB,IAAf27D,EAAMl5D,OACH,WACAk5D,EAAMt2D,KAAI,SAAA+W,GAAC,OAAIA,EAAEy+C,UAAYz+C,EAAE1N,MAAQ0N,EAAEhX,QAAMyc,KAAK,QAAgB,IAAPyI,EAAa,OAAS,WAlBvG,EAuBY7U,KAAOuD,cAAS,WAAO,IAAD,EACmB,EAAK7C,WAA7C2lE,EADqB,EACrBA,aAAc3d,EADO,EACPA,UAAW4d,EADJ,EACIA,YAC1BlM,EAAY,cAAC,YAAD,CAAW7vE,UAAU,aACjCm3C,SAAUgnB,EACVvlD,YAAY,kBACZq+B,kBAAkB,IACtB,OAAO,cAAC,OAAD,CAAM32C,OAAQuvE,EAAd,SACH,cAAC,OAAD,CAAMx9D,MAAOypE,EACTv3E,KAAM,CAAC0Q,OAAQ,EAAK65C,UAAW5uD,QAAQ67E,EAAc33E,IAAM,SAAAG,GAAI,OAAEA,EAAKsqC,IAAI3jC,YA/B1F,+JAEQzN,KAAK2X,SAAS3X,KAAKgY,MAF3B,2GAA2BsB,SCAdilE,GAAb,4MAKYltB,UAAY,SAACmtB,EAAoB32E,GAA8B,IAC9D8B,EAAc60E,EAAd70E,KAAMuzD,EAAQshB,EAARthB,KACNv1D,EAAwBgC,EAAxBhC,KAAMsJ,EAAkBtH,EAAlBsH,KAAMmsD,EAAYzzD,EAAZyzD,SACb31D,EAAO,cAAC,KAAD,CAAIE,KAAK,SAASqlB,KAAK,KAAKzqB,UAAU,sBAAsBkxB,UAAU,IACjF,OAAO,eAAC,MAAD,CAAKlxB,UAAU,OAAOkF,KAAMA,EAA5B,UACH,qBAAKlF,UAAU,OAAf,SACI,4BAAI66D,GAAYnsD,GAAQtJ,MAE5B,qBAAKpF,UAAU,wBAAf,SACsB,IAAd26D,EAAKl4D,OACL,uBAAOzC,UAAU,aAAjB,sBAEA26D,EAAKt1D,KAAI,SAAAtG,GAAC,OAAI,EAAK82E,IAAI92E,EAAEqG,KAAM,iDAjBnD,EAuBYywE,IAAM,SAAC9kE,EAAa8f,GACxB,OAAO,qBAAK7wB,UAAW,uCAAyC6wB,EAAzD,SAAyE9f,GAAPA,IAxBjF,EA2BY0E,KAAOuD,cAAS,WAAO,IAAD,EACqB,EAAK7C,WAA/C+lE,EADqB,EACrBA,aAAcC,EADO,EACPA,WAAYC,EADL,EACKA,aAC3BvM,EAAY,cAAC,YAAD,CAAW7vE,UAAU,aAAa2T,MAAM,8BACpDwjC,SAAUglC,EACVvjE,YAAY,iCACZq+B,kBAAkB,IACtB,OAAO,cAAC,OAAD,CAAM32C,OAAQuvE,EAAd,SACH,cAAC,OAAD,CAAMx9D,MAAO6pE,EACT33E,KAAM,CAAC0Q,OAAQ,EAAK65C,UAAW5uD,QAAQk8E,EAAch4E,IAAM,SAAAG,GAAI,OAAEA,EAAK6C,KAAK8D,YAnC3F,+JAEQzN,KAAK2X,SAAS3X,KAAKgY,MAF3B,2GAA4BsB,SCAfy9D,GAAb,4MAKY/+D,KAAOuD,cAAS,WAAO,IAAD,EACkB,EAAK7C,WAA5CkmE,EADqB,EACrBA,OAAQC,EADa,EACbA,YAAaC,EADA,EACAA,eACtBjlE,EAAQ,wBAAQtX,UAAU,yBAAyBE,QAAS,kBAAIq8E,KAAxD,sCACZ,OAAO,cAAC,OAAD,CAAMj8E,OAAQ,SAAY+7E,EAAOj3E,KAAOkS,MAAOA,EAA/C,SACH,cAAC,OAAD,CAAMjF,MAAOiqE,EAAa/3E,KAAM,CAAC0Q,OAAO,EAAK6tD,kBATzD,EAaYA,UAAY,SAAC17D,EAAY9B,GAA8B,IAEvDiD,EADCnD,EAAwBgC,EAAxBhC,KAAMsJ,EAAkBtH,EAAlBsH,KAAMmsD,EAAYzzD,EAAZyzD,SAQjB,OALItyD,EADAsyD,EACU,iCAAOA,EAAP,SAAwB,uBAAO76D,UAAU,aAAjB,SAA+BoF,OAC5DsJ,EACK,iCAAOA,EAAP,SAAoB,uBAAO1O,UAAU,aAAjB,SAA+BoF,OAEnD,mCAAGA,IACV,qBAAKpF,UAAU,YAAf,SAA4BuI,KAtB3C,+JAEQ9K,KAAK2X,SAAS3X,KAAKgY,MAF3B,2GAA0BsB,SCAby+D,GAAb,4MAKY//D,KAAOuD,cAAS,WAAO,IAAD,EACmB,EAAK7C,WAA7CqmE,EADqB,EACrBA,QAASC,EADY,EACZA,YAAaC,EADD,EACCA,eACvBplE,EAAQ,wBAAQtX,UAAU,gDAAgDE,QAAS,kBAAIw8E,KAA/E,6BACZ,OAAO,cAAC,OAAD,CAAMp8E,OAAQ,mBAAWk8E,EAAQ3hB,UAAY2hB,EAAQ9tE,MAAQ8tE,EAAQp3E,MACxEkS,MAAOA,EADJ,SAEH,cAAC,OAAD,CAAMjF,MAAOoqE,EAAal4E,KAAM,CAAC0Q,OAAO,EAAK6tD,kBAVzD,EAcYA,UAAY,SAACj0B,EAAUvpC,GAA8B,IACpDF,EAAqBypC,EAArBzpC,KAAMwpC,EAAeC,EAAfD,YACP1pC,EAAO,cAAC,KAAD,CAAIE,KAAK,uBAAuBqlB,KAAK,KAAKzqB,UAAU,wBAC3DsX,EAAQ,uBAAOtX,UAAU,aAAjB,SAA+B4uC,IAC3C,OAAO,cAAC,MAAD,CAAK5uC,UAAU,YAAYkF,KAAMA,EAAMoS,MAAOA,EAA9C,SAAqD,4BAAIlS,OAlBxE,+JAEQ3H,KAAK2X,SAAS3X,KAAKgY,MAF3B,2GAA2BsB,SCAd4lE,GAAb,4MAKYlnE,KAAOuD,cAAS,WAAO,IAAD,EACG,EAAK7C,WAA7BkmE,EADqB,EACrBA,OAAQO,EADa,EACbA,aACb,OAAO,cAAC,OAAD,CAAMt8E,OAAQ+7E,EAAOj3E,KAAO,8BAA5B,SACH,cAAC,OAAD,CAAMiN,MAAOuqE,EAAcr4E,KAAM,CAAC0Q,OAAO,EAAK4nE,uBAR1D,EAYYA,eAAiB,SAACC,EAAoBx3E,GAA8B,IAEpEiD,EADCnD,EAA8B03E,EAA9B13E,KAAMsJ,EAAwBouE,EAAxBpuE,KAAMmsD,EAAkBiiB,EAAlBjiB,SAAUlmC,EAAQmoD,EAARnoD,KAGvBpsB,EADAsyD,EACU,qCAAGA,EAAH,IAAa,cAAC,QAAD,UAAQz1D,OAC1BsJ,EACK,qCAAGA,EAAH,IAAS,cAAC,QAAD,UAAQtJ,OAEjB,mCAAGA,IACjB,IAAIkS,EAAQ,uBAAOrX,KAAK,WAAW6pC,eAAuB,IAAPnV,EAC/C1c,SAAU,SAACC,GAAD,OAAO,EAAK6kE,cAAcD,EAAU5kE,EAAIE,OAAOkd,YAC7D,OAAO,cAAC,MAAD,CAAKt1B,UAAU,+BAA+BsX,MAAOA,EAArD,SACF/O,KAxBb,EA4BYw0E,cA5BZ,uCA4B4B,WAAOD,EAAoBxnD,GAA3B,SAAAv2B,EAAA,sEACd,EAAKoX,WAAW6mE,YAAYF,EAAUxnD,GADxB,OAEpBwnD,EAASnoD,MAAiB,IAAVW,EAAgB,EAAG,EAFf,2CA5B5B,uNAEQ73B,KAAK2X,SAAS3X,KAAKgY,MAF3B,2GAAmCsB,SCAtBkmE,GAAb,4MAKYxnE,KAAOuD,cAAS,WAAO,IAAD,EACI,EAAK7C,WAA9BqmE,EADqB,EACrBA,QAASU,EADY,EACZA,aACd,OAAO,cAAC,OAAD,CAAM58E,OAAQ,sBAAck8E,EAAQ3hB,UAAY2hB,EAAQ9tE,MAAQ8tE,EAAQp3E,MAAxE,SACH,cAAC,OAAD,CAAMiN,MAAO6qE,EAAc34E,KAAM,CAAC0Q,OAAO,EAAK6tD,kBAR1D,EAYYA,UAAY,SAACqa,EAAkB73E,GAA8B,IAC5DF,EAA2B+3E,EAA3B/3E,KAAMwpC,EAAqBuuC,EAArBvuC,YAAaja,EAAQwoD,EAARxoD,KACpBrd,EAAQ,uBAAOrX,KAAK,WAAW6pC,eAAuB,IAAPnV,EAC/C1c,SAAU,SAACC,GAAD,OAAO,EAAKklE,aAAaD,EAASjlE,EAAIE,OAAOkd,YAC3D,OAAO,eAAC,MAAD,CAAKt1B,UAAU,YAAYsX,MAAOA,EAAlC,UACFlS,EADE,IACKwpC,MAjBpB,EAqBYwuC,aArBZ,uCAqB2B,WAAOD,EAAkB7nD,GAAzB,SAAAv2B,EAAA,sEACb,EAAKoX,WAAWknE,YAAYF,EAAS7nD,GADxB,OAEnB6nD,EAAQxoD,MAAiB,IAAVW,EAAgB,EAAG,EAFf,2CArB3B,uNAEQ73B,KAAK2X,SAAS3X,KAAKgY,MAF3B,2GAAmCsB,SCEtB++D,IAAb,wPAGYjG,eAHZ,IAQYp6D,KAAOuD,cAAS,WACpB,IAMIzQ,EANAsnE,EAAY,cAAC,YAAD,CAAWngD,IAAK,SAAA5qB,GAAC,OAAE,EAAK+qE,UAAU/qE,GAC9C9E,UAAU,QACVm3C,SAAU,EAAKA,SACf1+B,QAAS,EAAK6kE,cACd1kE,YAAY,6DAGhB,GAAkB,OAAd,EAAKxR,WAEJ,QAAkBlJ,IAAd,EAAKkJ,KACVmB,EAAU,qBAAKvI,UAAU,gBAAf,sDAET,CAAC,IAEEu9E,EAFH,EACwB,EAAKn2E,KAAzBhC,EADJ,EACIA,KAAMsJ,EADV,EACUA,KAAMD,EADhB,EACgBA,KAGb8uE,EADA7uE,EACU,qCAAE,8BAAK,4BAAIA,MAAe,8BAAMtJ,OAGhC,8BAAK,4BAAIA,MAEvBmD,EAAU,gCACN,sBAAKvI,UAAU,0BAAf,UACI,cAAC,QAAD,CAAOsQ,IAAK7B,IACZ,qBAAKzO,UAAU,OAAf,SAAuBu9E,OAE3B,qBAAKv9E,UAAU,gCAAf,SACI,wBAAQA,UAAU,8BAA8BE,QAAS,EAAK64E,UAA9D,2CAkBZ,OAAO,cAAC,OAAD,CAAMz4E,OAAQuvE,EAAd,SACFtnE,OAvDb,EA4DY4uC,SA5DZ,uCA4DuB,WAAO/yC,GAAP,SAAArF,EAAA,sEACGm7D,EAAQsjB,YAAYp5E,GADvB,OACf,EAAKgD,KADU,kDA5DvB,wDAgEY2xE,UAhEZ,sBAgEwB,sBAAAh6E,EAAA,sEACV,EAAKoX,WAAWogE,QAAQ,EAAKnvE,KAAK8D,IADxB,OAEhB,EAAKiL,WAAWqmE,QAAU,EAAKp1E,KAC/B,EAAKA,KAAO,KACZ,EAAKyoE,UAAU7rE,QACf,EAAK2S,YAAY,EAAK8mE,WALN,2CAhExB,EAwEYH,cAAgB,WACpB,EAAKl2E,KAAO,KAER,EAAKyoE,WAAW,EAAKA,UAAU7rE,SA3E3C,EA8EY05E,UAAY,WAChB,EAAK1nE,YACL,EAAKG,WAAWumE,kBAhFxB,EAmFYiB,kBAAoB,WACxB,EAAK3nE,YACL,EAAKG,WAAW4iE,aArFxB,EAwFY0E,UAAY,WAChB,OAAO,cAAC,OAAD,CAAMn9E,OAAO,2BAAb,SACH,sBAAKN,UAAU,kBAAf,UACI,6DACW,EAAKmW,WAAWqmE,QAAQp3E,QAEnC,sBAAKpF,UAAU,OAAf,UACI,wBAAQA,UAAU,uBACdE,QAAS,EAAKw9E,UADlB,+CAIA,wBAAQ19E,UAAU,0BACdE,QAAS,EAAKy9E,kBADlB,iEAnGpB,+JAKQlgF,KAAK2X,SAAS3X,KAAKgY,MAL3B,2GAA8BsB,SAA9B,oCACKpF,KADL,yEACqC,QADrC,ICgCaisE,IAAb,+MACY5/E,UADZ,oGAIIw+E,aAJJ,mGAOIH,YAPJ,mGAmBYwB,WAnBZ,sBAmByB,sBAAA9+E,EAAA,sEACX,EAAK++E,kBAAa5/E,GADP,OAEjB,EAAKmtD,UAAUuwB,IAFE,2CAnBzB,EAwBYmC,WAxBZ,sBAwByB,sBAAAh/E,EAAA,sEACX,EAAKi/E,kBAAa9/E,GADP,OAEjB,EAAKmtD,UAAU2wB,IAFE,2CAxBzB,EA8FIG,WA9FJ,uCA8FiB,WAAM/3E,GAAN,SAAArF,EAAA,sEACH,EAAKi/E,aAAa55E,GADf,2CA9FjB,wDAkGI+5D,UAlGJ,uCAkGgB,WAAM/5D,GAAN,SAAArF,EAAA,sEACF,EAAK++E,aAAa15E,GADhB,2CAlGhB,wDAsGI23E,YAtGJ,uCAsGkB,WAAOF,GAAP,SAAA98E,EAAA,6DACV,EAAKs9E,OAASR,EAAShtC,IACP,EACD,IAHL,SAIeqrB,EAAQ+jB,gBAAgB,EAAKjgF,KAAKkN,GAAI,EAAKmxE,OAAOnxE,GAF3D,EACD,KAHL,OAIV,EAAKoxE,YAJK,OAKV,EAAKjxB,UAAUmpB,IALL,2CAtGlB,wDA8GI4H,aA9GJ,uCA8GmB,WAAOH,GAAP,SAAAl9E,EAAA,6DACX,EAAKy9E,QAAUP,EAAS70E,KACR,EACD,IAHJ,SAIc8yD,EAAQgkB,gBAAgB,EAAKlgF,KAAKkN,GAAI,EAAKsxE,QAAQtxE,GAF5D,EACD,KAHJ,OAIX,EAAKuxE,YAJM,OAKX,EAAKpxB,UAAUmqB,IALJ,2CA9GnB,wDAsHI+G,eAtHJ,uCAsHqB,WAAOn4E,GAAP,SAAArF,EAAA,6DACG,EACD,IAFF,SAGam7D,EAAQikB,iBAAiB,EAAKngF,KAAKkN,GAAI,EAAKmxE,OAAOnxE,GAAI9G,EAFjE,EACD,KAFF,OAGb,EAAKw4E,aAHQ,OAIb,EAAKvxB,UAAUsxB,IAJF,2CAtHrB,wDA6HI5D,UAAY,WACR,EAAK1tB,UAAUyqB,KA9HvB,EAiII4G,eAjIJ,uCAiIqB,WAAOt4E,GAAP,SAAArF,EAAA,6DACG,EACD,IAFF,SAGam7D,EAAQkkB,iBAAiB,EAAKpgF,KAAKkN,GAAI,EAAKsxE,QAAQtxE,GAAI9G,EAFlE,EACD,KAFF,OAGb,EAAK84E,aAHQ,OAIb,EAAK7xB,UAAU4xB,IAJF,2CAjIrB,wDAwIID,YAxIJ,uCAwIkB,WAAM51E,EAAWkuB,GAAjB,iBAAAv2B,EAAA,sEACJm7D,EAAQ8iB,YAAY,EAAKh/E,KAAKkN,GAAI,EAAKmxE,OAAOnxE,GAAI9D,EAAK8D,IAAc,IAAVoqB,EAAgB,EAAE,GADzE,OAENumD,EAAW,EAAKC,aAAaj3E,MAAK,SAAAC,GAAC,OAAIA,EAAE+pC,IAAI3jC,KAAO,EAAKmxE,OAAOnxE,OACpD,IAAZoqB,GACA,EAAKgnD,YAAYz8E,KAAKuH,GAClBy0E,GAAUA,EAASlgB,MAAM97D,KAAKuH,MAG9B9B,EAAQ,EAAKg3E,YAAY7uD,WAAU,SAAA3oB,GAAC,OAAIA,EAAEoG,KAAO9D,EAAK8D,QAC/C,GAAG,EAAKoxE,YAAY3pD,OAAOrtB,EAAO,GACzCu2E,IACAv2E,EAAQu2E,EAASlgB,MAAMluC,WAAU,SAAA3oB,GAAC,OAAIA,EAAEoG,KAAO9D,EAAK8D,QACzC,GAAG2wE,EAASlgB,MAAMhpC,OAAOrtB,EAAO,IAZzC,2CAxIlB,0DAyJI+3E,YAzJJ,uCAyJkB,WAAMxuC,EAASvZ,GAAf,iBAAAv2B,EAAA,sEACJm7D,EAAQ8iB,YAAY,EAAKh/E,KAAKkN,GAAI2jC,EAAI3jC,GAAI,EAAKsxE,QAAQtxE,IAAc,IAAVoqB,EAAgB,EAAE,GADzE,eAEgBp3B,IAAtB,EAAKg+E,aAFC,iDAGND,EAAW,EAAKC,aAAar3E,MAAK,SAAAC,GAAC,OAAIA,EAAEsC,KAAK8D,KAAO,EAAKsxE,QAAQtxE,OACtD,IAAZoqB,GACA,EAAKmnD,YAAY58E,KAAKgvC,GAClBotC,GAAUA,EAASthB,KAAK96D,KAAKgvC,MAG7BvpC,EAAQ,EAAKm3E,YAAYhvD,WAAU,SAAA3oB,GAAC,OAAIA,EAAEoG,KAAO2jC,EAAI3jC,QAC9C,GAAG,EAAKuxE,YAAY9pD,OAAOrtB,EAAO,GACzC22E,IACA32E,EAAQ22E,EAASthB,KAAKltC,WAAU,SAAA3oB,GAAC,OAAIA,EAAEoG,KAAO2jC,EAAI3jC,QACvC,GAAG+wE,EAASthB,KAAKhoC,OAAOrtB,EAAO,IAbxC,2CAzJlB,0DA2KIixE,QA3KJ,uCA2Kc,WAAO73E,GAAP,SAAAK,EAAA,sEACAm7D,EAAQmkB,YAAY,EAAKrgF,KAAKkN,GAAIxM,GADlC,2CA3Kd,2JAWkCV,GAXlC,wEAYQP,KAAKO,KAAOA,EAZpB,SAccP,KAAKugF,kBAAa9/E,GAdhC,OAgBQT,KAAK4tD,UAAU2wB,IAhBvB,mLA6B+B53E,GA7B/B,0GA8BYsf,EAAkB,GACN,EACD,IAhCvB,SAiCwBw2C,EAAQokB,aAAa7gF,KAAKO,KAAKkN,GAAI9G,EAFnC,EACD,KAhCvB,OAiCYzG,EAjCZ,OAkCMg9D,EAAOh9D,EAAI,GACLg+D,EAAQh+D,EAAI,GACZy1C,EAA+B,GApC3C,cAqCsBunB,GArCtB,IAqCQ,2BAAS57D,EAAW,QACZ8vC,EAAU,CACV3jC,GAAInM,EAAEmM,GACN9F,KAAMrG,EAAEqG,KACRwpC,YAAa7vC,EAAE6vC,aAEnBlrB,EAAK7jB,KAAKuzC,EAAKr0C,EAAEmM,IAAM,CAAC2jC,IAAIA,EAAKvkB,MAAK,EAAOqxC,MAAM,KA3C/D,WAAAnpD,EAAA,+BA6CsBmpD,GA7CtB,IA6CQ,2BAASv/C,EAAY,QACbhV,EAAY,CACZ8D,GAAIkR,EAAEhV,KACNhC,KAAMgX,EAAEhX,KACRsJ,KAAM0N,EAAE1N,KACRD,KAAM2N,EAAE3N,KACRosD,SAAUz+C,EAAEy+C,UAEZt2D,EAAO6uC,EAAKh3B,EAAEyyB,MACb8sB,EAASp3D,EAATo3D,OACKl5D,QAAU,EAChB8B,EAAK+lB,MAAO,EAGZqxC,EAAM97D,KAAKuH,GA3D3B,WAAAoL,EAAA,iBA8DQ/U,KAAKq+E,aAAep4D,EA9D5B,oLAiE+Btf,GAjE/B,sGAkEYsf,EAAkB,GACN,EACD,IApEvB,SAqEwBw2C,EAAQqkB,UAAU9gF,KAAKO,KAAKkN,GAAI9G,EAFhC,EACD,KApEvB,OAqEYzG,EArEZ,OAsEYg+D,EAAQh+D,EAAI,GACZg9D,EAAOh9D,EAAI,GACXy1C,EAA+B,GAxE3C,cAyEsBuoB,GAzEtB,IAyEQ,2BAASv/C,EAAY,QACbhV,EAAY,CACZ8D,GAAIkR,EAAElR,GACN9F,KAAMgX,EAAEhX,KACRsJ,KAAM0N,EAAE1N,KACRD,KAAM2N,EAAE3N,KACRosD,SAAUz+C,EAAEy+C,UAEhBn3C,EAAK7jB,KAAKuzC,EAAKh3B,EAAElR,IAAM,CAAC9D,KAAKA,EAAMuzD,KAAK,KAjFpD,WAAAnoD,EAAA,+BAmFsBmoD,GAnFtB,IAmFQ,2BAAS57D,EAAW,QACZ8vC,EAAU,CACV3jC,GAAInM,EAAE8vC,IACNzpC,KAAMrG,EAAEqG,KACRwpC,YAAa7vC,EAAE6vC,aAEnBwE,EAAKr0C,EAAEqI,MAAMuzD,KAAK96D,KAAKgvC,GAzFnC,WAAAr8B,EAAA,iBA2FQ/U,KAAKy+E,aAAex4D,EA3F5B,6GAA4BlQ,cAA5B,4CAEK7B,KAFL,0GAGKA,KAHL,yGAKKA,KALL,0GAMKA,KANL,yGAQKA,KARL,0GASKA,KATL,kEC1Ba6sE,GAAb,4MACIxgF,UADJ,IAEIu2E,kBAFJ,IAGIxE,gBAHJ,IAIImE,cAJJ,IAKIC,cALJ,IAMIC,eANJ,IAOCsE,eAPD,IAQCpG,aARD,IASCF,YATD,IAqDCkB,QAAU,SAACt1E,GACA,EAAK4yE,KAAKH,IAChBxuE,MAAMjE,IAvDZ,EA0DCo1E,SAAW,SAACp1E,GACS,IAAIonE,GAAc,EAAKh7D,KAC7BnI,MAAMjE,EAAKkN,KA5D3B,EA+DI8oE,WA/DJ,uCA+DiB,WAAOzvE,GAAP,mBAAAxF,EAAA,6DACT0N,aAAWzO,KAAOuG,EAAK2G,GACvB2wD,GAAMx4D,OAFG,SAGHw4D,GAAM4iB,WAHH,UAKJzgF,EAAQ69D,GAAR79D,KACL,EAAK06E,UAAY,IAAIkC,GAAU58E,GAE1B4V,EAAe5V,EAAf4V,MAAO3T,EAAQjC,EAARiC,KACE,IAAV2T,EATK,oBAWc,KAAP,EAAP3T,GAXA,kCAYK47D,GAAMpB,IAAIikB,aAZf,WAgBc,KAAP,EAAPz+E,GAhBA,kCAiBK47D,GAAMmH,WAjBX,QAoBT,EAAKhlE,KAAOA,EACZ,EAAKqtD,UAAU4mB,IArBN,4CA/DjB,wDAuFI56D,OAvFJ,sBAuFa,sBAAAtY,EAAA,sDACL88D,GAAMxkD,SADD,2CAvFb,EA2FIw7D,gBA3FJ,uCA2FsB,WAAO4B,GAAP,eAAA11E,EAAA,6DACV4/E,EAAe,EAAK/N,KAAK6G,IADf,SAERkH,EAAa18E,MAAM,EAAKjE,KAAMy2E,GAFtB,2CA3FtB,+PAYwBva,EAAQ0kB,iBAZhC,UAYYjhF,EAZZ,OAckC,KADtBoyE,EAAatyE,KAAKsyE,WAAapyE,EAAI,IACxB8E,OAdvB,wBAeYgK,aAAWzO,KAAO+xE,EAAW,GAAG7kE,GAf5C,SAgBkB2wD,GAAM4iB,WAhBxB,+BAmBYhhF,KAAKy2E,SAAW,GAChBz2E,KAAK02E,SAAW,GAChB12E,KAAK22E,UAAY,GArB7B,cAsB2BrE,GAtB3B,IAsBY,2BAASE,EAAkB,QAEJ,KAAP,GADPhwE,EAAQgwE,EAARhwE,OAEDxC,KAAK22E,UAAUv0E,KAAKowE,GAEA,KAAP,EAAPhwE,GACNxC,KAAK02E,SAASt0E,KAAKowE,GAEC,KAAP,EAAPhwE,IACNxC,KAAKy2E,SAASr0E,KAAKowE,GA/BvC,WAAAz9D,EAAA,qMAoCkCsC,GApClC,oEAqCErX,KAAK60E,QAAU70E,KAAKmzE,KAAK+K,IACzBl+E,KAAK20E,OAAS,IAAIwL,GAAOngF,KAAK2M,KACxByxD,GAAMx4D,OAEN5F,KAAK82E,aAAerrE,SAASC,SAAS0C,KAAK8Q,WAAW,OACtDpa,QAAQC,IAAI,yBAA0B/E,KAAK82E,eAEjB,IAAtB92E,KAAK82E,aA5CjB,iCA6CkB92E,KAAKohF,iBA7CvB,gDAgDkBhjB,GAAM4iB,WAhDxB,QAkDQhhF,KAAK4tD,UAAUyoB,IAlDvB,2QAiGcr2E,KAAKi7E,UAAUp8C,OAjG7B,OAkGgB7+B,KAAKmzE,KAAK+J,IAChB14E,MAAMxE,KAAKi7E,WAnGrB,2GAA2B5Y,ICPd3P,GAAb,4MAGI2uB,WAHJ,qDAWsC7+E,GAC9B,OAAO,IAAIA,EAAKxC,QAZxB,gJAgBQA,KAAKqhF,MAAQrhF,KAAKmzE,KAAK4N,IAQvB/gF,KAAKqhF,MAAM78E,QAxBnB,2GAA0BotD,YCiCX0vB,OAVf,WACI,IAAIzwE,EAAS,uCAAG,sBAAAvP,EAAA,6DAClB4B,MAAIqD,QADc,SAEZ/B,gBAAMkuD,QAAMjyD,GAFA,2CAAH,qDAMhB,OAAQ,cAAC,UAAD,CAASoQ,UAAWA,KCvBd0wE,GAZS,SAACC,GACnBA,GAAeA,aAAuBC,UACxC,8BAAqB/3D,MAAK,YAAkD,IAA/Cg4D,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOF,GACPG,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAQN,OCFdO,IAASvqE,OACP,cAAC,IAAMwqE,WAAP,UACE,cAAC,GAAD,MAEFv2E,SAASqB,eAAe,SAM1By0E,O","file":"static/js/main.20b188c2.chunk.js","sourcesContent":["export * from './tool';\r\nexport * from './net';\r\nexport * from './components';\r\nexport * from './auth';\r\nexport * from './uq';\r\nexport * from './app';\r\nexport * from './vm';\r\n","export * from './navigo';\r\nexport * from './nav';\r\nexport * from './page';\r\nexport * from './schema';\r\nexport * from './form';\r\nexport * from './edit';\r\nexport * from '../res/res';\r\nexport * from './loading';\r\nexport * from './image';\r\nexport * from './resUploader';\r\nexport * from './list';\r\nexport * from './dropDownActions';\r\nexport * from './easyDate';\r\nexport * from './propGrid';\r\nexport * from './simple';\r\nexport * from './media';\r\nexport * from './searchBox';\r\nexport * from './userIcon';\r\nexport * from './ax';\r\nexport * from './autoHideTips';\r\nexport * from './login';","import { decodeGuestToken } from '../tool/user';\r\nimport { CenterApiBase } from './uqApi';\r\n\r\nexport class GuestApi extends CenterApiBase {\r\n    async guest(): Promise<any> {\r\n        //let guest = nav.local.guest.get();\r\n        let ret = await this.get('', {});\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeGuestToken(ret);\r\n            case 'object':\r\n                let guest = decodeGuestToken(ret.token);\r\n                return guest;\r\n        }\r\n    }\r\n\r\n    async unitFromName(unitName:string): Promise<number> {\r\n        let ret = await this.get(unitName);\r\n        return ret && ret.unit;\r\n    }\r\n}\r\n\r\nexport const guestApi = new GuestApi('tv/guest/', undefined);\r\n","export abstract class Caller<T> {\r\n    protected readonly _params: T;\r\n    constructor(params: T, waiting: boolean) {\r\n        this._params = params;\r\n        this.waiting = waiting;\r\n    }\r\n    protected get params():any {return this._params;}\r\n    buildParams():any {return this.params;}\r\n    method: string  = 'POST';\r\n    abstract get path(): string;\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    waiting: boolean;\r\n}\r\n","import * as React from 'react';\r\nimport {observable} from 'mobx';\r\nimport _ from 'lodash';\r\nimport {User, Guest/*, UserInNav*/} from '../tool/user';\r\nimport {Page} from './page/page';\r\nimport {netToken} from '../net/netToken';\r\nimport FetchErrorView, { SystemNotifyPage } from './fetchErrorView';\r\nimport {FetchError} from '../net/fetchError';\r\nimport {appUrl, setAppInFrame, getExHash, getExHashPos} from '../net/appBridge';\r\nimport {LocalData, env} from '../tool';\r\nimport {guestApi, logoutApis, setCenterUrl, setCenterToken, appInFrame, host, resUrlFromHost, messageHub} from '../net';\r\nimport { resOptions } from '../res/res';\r\nimport { Loading } from './loading';\r\nimport { Navigo, RouteFunc, Hooks, NamedRoute } from './navigo';\r\n\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport '../css/va-form.css';\r\nimport '../css/va.css';\r\nimport '../css/animation.css';\r\nimport { FA } from './simple';\r\nimport { userApi } from '../net';\r\nimport { ReloadPage, ConfirmReloadPage } from './reloadPage';\r\nimport { PageWebNav } from './page';\r\nimport { Login } from './login';\r\nimport { createLogin } from '../auth';\r\n\r\nconst regEx = new RegExp('Android|webOS|iPhone|iPad|' +\r\n    'BlackBerry|Windows Phone|'  +\r\n    'Opera Mini|IEMobile|Mobile' , \r\n    'i');\r\nconst isMobile = regEx.test(navigator.userAgent);\r\n\r\n/*\r\nexport const mobileHeaderStyle = isMobile? {\r\n    minHeight:  '3em'\r\n} : undefined;\r\n*/\r\n//const logo = require('../img/logo.svg');\r\nlet logMark: number;\r\nconst logs:string[] = [];\r\nexport type NavPage = (params:any) => Promise<void>;\r\n\r\nexport interface Props\r\n{\r\n    onLogined: (isUserLogin?:boolean)=>Promise<void>;\r\n    notLogined?: ()=>Promise<void>;\r\n};\r\nlet stackKey = 1;\r\nexport interface StackItem {\r\n    key: number;\r\n    view: JSX.Element;\r\n    ceased: boolean;\r\n    confirmClose?: ()=>Promise<boolean>;\r\n    disposer?: ()=>void;\r\n}\r\nexport interface NavViewState {\r\n    stack: StackItem[];\r\n    wait: 0|1|2;\r\n    fetchError: FetchError\r\n}\r\n\r\nexport class NavView extends React.Component<Props, NavViewState> {\r\n    private stack: StackItem[];\r\n    private waitCount: number = 0;\r\n    private waitTimeHandler?: NodeJS.Timer;\r\n\r\n    constructor(props:Props) {\r\n        super(props);\r\n        this.stack = [];\r\n        this.state = {\r\n            stack: this.stack,\r\n            wait: 0,\r\n            fetchError: undefined\r\n        };\r\n        nav.set(this);\r\n    }\r\n    async componentDidMount()\r\n    {\r\n\t\twindow.addEventListener('popstate', this.navBack);\r\n\t\t//if (nav.isRouting === false) {\r\n\t\tawait nav.init();\r\n\t\t//}\r\n        await nav.start();\r\n    }\r\n\r\n    get level(): number {\r\n        return this.stack.length;\r\n    }\r\n\r\n    startWait() {\r\n        if (this.waitCount === 0) {\r\n            this.setState({wait: 1});\r\n            this.waitTimeHandler = env.setTimeout(\r\n                'NavView.startWait',\r\n                () => {\r\n                    this.waitTimeHandler = undefined;\r\n                    this.setState({wait: 2});\r\n                },\r\n                1000) as NodeJS.Timer;\r\n        }\r\n        ++this.waitCount;\r\n        this.setState({\r\n            fetchError: undefined,\r\n        });\r\n    }\r\n\r\n    endWait() {\r\n        env.setTimeout(\r\n            undefined, //'NavView.endWait',\r\n            () => {\r\n            /*\r\n            this.setState({\r\n                fetchError: undefined,\r\n            });*/\r\n            --this.waitCount;\r\n            if (this.waitCount === 0) {\r\n                if (this.waitTimeHandler !== undefined) {\r\n                    env.clearTimeout(this.waitTimeHandler);\r\n                    this.waitTimeHandler = undefined;\r\n                }\r\n                this.setState({wait: 0});\r\n            }\r\n        },100);\r\n    }\r\n\r\n    async onError(fetchError: FetchError)\r\n    {\r\n        let err = fetchError.error;\r\n        if (err !== undefined) {\r\n            if (err.unauthorized === true) {\r\n\t\t\t\tawait nav.showLogin(undefined);\r\n\t\t\t\t//nav.navigateToLogin();\r\n                return;\r\n            }\r\n            switch (err.type) {\r\n                case 'unauthorized':\r\n                    await nav.showLogin(undefined);\r\n\t\t\t\t\t//nav.navigateToLogin();\r\n                    return;\r\n                case 'sheet-processing':\r\n                    nav.push(<SystemNotifyPage message=\"\" />);\r\n                    return;\r\n            }\r\n        }\r\n        this.setState({\r\n            fetchError: fetchError,\r\n        });\r\n    }\r\n\r\n    private upgradeUq = () => {\r\n        nav.start();\r\n    }\r\n\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        this.show(<Page header={false}>\r\n            <div>\r\n                UQ <br />\r\n                <small className=\"text-muted\">{uq} ver-{version}</small>\r\n                <button className=\"btn btn-primary\" onClick={this.upgradeUq}></button>\r\n            </div>\r\n        </Page>)\r\n    }\r\n\r\n    show(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.clear();\r\n        return this.push(view, disposer);\r\n    }\r\n\r\n    push(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.removeCeased();\r\n        if (this.stack.length > 0) {\r\n            window.history.pushState('forward', null, null);\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key,\r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        this.refresh();\r\n        //console.log('push: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    replace(view: JSX.Element, disposer?: ()=>void): number {\r\n        let item:StackItem = undefined;\r\n        let stack = this.stack;\r\n        if (stack.length > 0) {\r\n            item = stack.pop();\r\n            //this.popAndDispose();\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key, \r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        if (item !== undefined) this.dispose(item.disposer);\r\n        this.refresh();\r\n        //console.log('replace: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    ceaseTop(level:number = 1) {\r\n        let p = this.stack.length - 1;\r\n        for (let i=0; i<level; i++, p--) {\r\n            if (p < 0) break;\r\n            let item = this.stack[p];\r\n            item.ceased = true;\r\n        }\r\n    }\r\n\r\n    pop(level:number = 1) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        //console.log('pop start: %s pages level=%s', len, level);\r\n        if (level <= 0 || len <= 1) return;\r\n        if (len < level) level = len;\r\n        let backLevel = 0;\r\n        for (let i = 0; i < level; i++) {\r\n            if (stack.length === 0) break;\r\n            //stack.pop();\r\n            this.popAndDispose();\r\n            ++backLevel;\r\n        }\r\n        if (backLevel >= len) backLevel--;\r\n        this.refresh();\r\n        if (this.isHistoryBack !== true) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(backLevel);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n        //console.log('pop: %s pages', stack.length);\r\n    }\r\n\r\n    popTo(key: number) {\r\n        if (key === undefined) return;\r\n        if (this.stack.find(v => v.key === key) === undefined) return;\r\n        while (this.stack.length >0) {\r\n            let len = this.stack.length;\r\n            let top = this.stack[len-1];\r\n            if (top.key === key) break;\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    topKey():number {\r\n        let len = this.stack.length;\r\n        if (len === 0) return undefined;\r\n        return this.stack[len-1].key;\r\n    }\r\n\r\n    removeCeased() {\r\n        for (;;) {\r\n            let p=this.stack.length-1;\r\n            if (p < 0) break;\r\n            let top = this.stack[p];\r\n            if (top.ceased === false) break;\r\n            let item = this.stack.pop();\r\n            let {disposer} = item;\r\n            this.dispose(disposer);\r\n        }\r\n        this.refresh();\r\n    }\r\n\r\n    private popAndDispose() {\r\n        this.removeCeased();\r\n        let item = this.stack.pop();\r\n\t\tif (item === undefined) return;\r\n\t\t//if (nav.isRouting) {\r\n\t\t//\twindow.history.back();\r\n\t\t//}\r\n        let {disposer} = item;\r\n        this.dispose(disposer);\r\n        this.removeCeased();\r\n        return item;\r\n    }\r\n\r\n    private dispose(disposer:()=>void) {\r\n        if (disposer === undefined) return;\r\n        let item = this.stack.find(v => v.disposer === disposer);\r\n        if (item === undefined) disposer();\r\n    }\r\n\r\n    clear() {\r\n        let len = this.stack.length;\r\n        while (this.stack.length > 0) this.popAndDispose();\r\n        //this.refresh();\r\n        if (len > 1) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(len-1);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n    }\r\n\r\n    regConfirmClose(confirmClose:()=>Promise<boolean>) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        let top = stack[len-1];\r\n        top.confirmClose = confirmClose;\r\n    }\r\n\r\n    private isHistoryBack:boolean = false;\r\n    navBack = () => {\r\n        //nav.log('backbutton pressed - nav level: ' + this.stack.length);\r\n        let tick = Date.now();\r\n        this.isHistoryBack = true;\r\n        this.back(true);\r\n        this.isHistoryBack = false;\r\n        console.log(`///\\\\\\\\ ${Date.now()-tick}ms backbutton pressed - nav level: ${this.stack.length}`);\r\n    }\r\n\r\n    back = async (confirm:boolean = true) => {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        if (len === 1) {\r\n            if (window.self !== window.top) {\r\n                window.top.postMessage({type:'pop-app'}, '*');\r\n            }\r\n            return;\r\n        }\r\n        let top = stack[len-1];\r\n        if (confirm===true && top.confirmClose) {\r\n            if (await top.confirmClose()===true) this.pop();\r\n        }\r\n        else {\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    confirmBox(message?:string): boolean {\r\n        return window.confirm(message);\r\n    }\r\n    clearError = () => {\r\n        this.setState({fetchError: undefined});\r\n    }\r\n    render() {\r\n        const {wait, fetchError} = this.state;\r\n        let {stack} = this.state;\r\n        let top = stack.length - 1;\r\n        let elWait = null, elError = null;\r\n        switch (wait) {\r\n            case 1:\r\n                elWait = <div className=\"va-wait va-wait1\">\r\n                </div>;\r\n                break;\r\n            case 2:\r\n                elWait = <div className=\"va-wait va-wait2\">\r\n                    <Loading />\r\n                </div>;\r\n                break;\r\n        }\r\n        if (fetchError)\r\n            elError = <FetchErrorView clearError={this.clearError} {...fetchError} />;\r\n        let test = nav.testing===true && \r\n\t\t\t<span className=\"cursor-pointer position-fixed\" style={{top:0,left:'0.2rem',zIndex:90001}}>\r\n                <FA className=\"text-warning\" name=\"info-circle\" />\r\n\t\t\t</span>;\r\n        return <>\r\n\t\t\t{stack.map((item, index) => {\r\n\t\t\t\tlet {key, view} = item;\r\n\t\t\t\treturn <div key={key} style={index<top? {visibility: 'hidden', position: 'absolute'}:undefined}>\r\n\t\t\t\t\t{view}\r\n\t\t\t\t</div>\r\n\t\t\t})}\r\n\t\t\t{elWait}\r\n\t\t\t{elError}\r\n\t\t\t{test}\r\n\t\t</>;\r\n    }\r\n\r\n    private refresh() {\r\n        this.setState({stack: this.stack });\r\n    }\r\n}\r\n\r\nexport interface NavSettings {\r\n    oem?: string;\r\n    loginTop?: JSX.Element;\r\n    privacy?: string;\r\n}\r\n\r\nexport class Nav {\r\n    private navView:NavView;\r\n    //private ws: WsBase;\r\n\tprivate wsHost: string;\r\n    private local: LocalData = new LocalData();\r\n\tprivate navigo: Navigo;\r\n\t//isRouting: boolean = false;\r\n\tnavSettings: NavSettings;\r\n    @observable user: User/*InNav*/ = undefined;\r\n    testing: boolean;\r\n    language: string;\r\n    culture: string;\r\n    resUrl: string;\r\n\r\n    constructor() {\r\n        let {lang, district} = resOptions;\r\n        this.language = lang;\r\n        this.culture = district;\r\n\t\tthis.testing = false;\r\n    }\r\n\r\n    get guest(): number {\r\n        let guest = this.local.guest;\r\n        if (guest === undefined) return 0;\r\n        let g = guest.get();\r\n        if (g === undefined) return 0;\r\n        return g.guest;\r\n    }\r\n\r\n    set(navView:NavView) {\r\n        //this.logo = logo;\r\n        this.navView = navView;\r\n\t}\r\n\t/*\r\n    registerReceiveHandler(handler: (message:any)=>Promise<void>):number {\r\n        //if (this.ws === undefined) return;\r\n        return messageHub.onReceiveAny(handler);\r\n    }\r\n\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        //if (this.ws === undefined) return;\r\n        if (handlerId === undefined) return;\r\n        messageHub.endReceive(handlerId);\r\n    }\r\n\t*/\r\n    async onReceive(msg:any) {\r\n        //if (this.ws === undefined) return;\r\n        await messageHub.dispatch(msg);\r\n    }\r\n\r\n\tprivate async loadUnitJson() {\r\n\t\ttry {\r\n\t\t\tlet unitJsonPath = this.unitJsonPath();\r\n\t\t\tlet unitRes = await fetch(unitJsonPath, {});\r\n\t\t\tlet res = await unitRes.json();\r\n\t\t\treturn res.unit;\r\n\t\t}\r\n\t\tcatch (err1) {\r\n\t\t\tthis.local.unit.remove();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n    private async getPredefinedUnitName() {\t\t\r\n\t\tlet el = document.getElementById('unit');\r\n\t\tif (el) {\r\n\t\t\treturn el.innerText;\r\n\t\t}\r\n\t\tel = document.getElementById('unit.json');\r\n\t\tif (!el) {\r\n\t\t\treturn await this.loadUnitJson();\r\n\t\t}\r\n\t\ttry {\r\n            let json = el.innerHTML;\r\n            let res = JSON.parse(json);\r\n            return res.unit;\r\n        }\r\n        catch (err) {\r\n\t\t\treturn await this.loadUnitJson();\r\n        }\r\n    }\r\n\r\n    private async loadPredefinedUnit() {\r\n        let envUnit = process.env.REACT_APP_UNIT;\r\n        if (envUnit !== undefined) {\r\n            return Number(envUnit);\r\n        }\r\n        let unitName:string;\r\n        let unit = this.local.unit.get();\r\n        if (unit !== undefined) {\r\n            if (env.isDevelopment !== true) return unit.id;\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n            if (unit.name === unitName) return unit.id;\r\n        }\r\n        else {\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n        }\r\n        let unitId = await guestApi.unitFromName(unitName);\r\n        if (unitId !== undefined) {\r\n            this.local.unit.set({id: unitId, name: unitName});\r\n        }\r\n        return unitId;\r\n    }\r\n\r\n    setSettings(settings?: NavSettings) {\r\n        this.navSettings = settings;\r\n    }\r\n\r\n    get oem():string {\r\n        return this.navSettings && this.navSettings.oem;\r\n    }\r\n\r\n    hashParam: string;\r\n    private centerHost: string;\r\n    private arrs = ['/test', '/test/'];\r\n    private unitJsonPath():string {\r\n        let {origin, pathname} = document.location;\r\n\t\tpathname = pathname.toLowerCase();\r\n        for (let item of this.arrs) {\r\n            if (pathname.endsWith(item) === true) {\r\n                pathname = pathname.substr(0, pathname.length - item.length);\r\n                break;\r\n            }\r\n        }\r\n        if (pathname.endsWith('/') === true || pathname.endsWith('\\\\') === true) {\r\n            pathname = pathname.substr(0, pathname.length-1);\r\n        }\r\n        return origin + pathname + '/unit.json';\r\n    }\r\n    private windowOnError = (event: Event | string, source?: string, lineno?: number, colno?: number, error?: Error) => {\r\n\t\tdebugger;\r\n        console.error('windowOnError');\r\n        console.error(error);\r\n    }\r\n    private windowOnUnhandledRejection = (ev: PromiseRejectionEvent) => {\r\n\t\tdebugger;\r\n        console.error('windowOnUnhandledRejection');\r\n        console.error(ev.reason);\r\n    }\r\n    private windowOnClick = (ev: MouseEvent) => {\r\n        console.error('windowOnClick');\r\n    }\r\n    private windowOnMouseMove = (ev: MouseEvent) => {\r\n        console.log('navigator.userAgent: ' + navigator.userAgent);\r\n        console.log('mouse move (%s, %s)', ev.x, ev.y);\r\n    }\r\n    private windowOnScroll = (ev: Event) => {\r\n        console.log('scroll event');\r\n\t}\r\n\r\n\tforceDevelopment:boolean;\r\n\t\r\n\tasync init() {\r\n\t\tthis.testing = env.testing;\r\n\t\tif (this.forceDevelopment === true) {\r\n\t\t\tenv.isDevelopment = true;\r\n\t\t}\r\n\t\tawait host.start(this.testing);\r\n\t\tlet hash = document.location.hash;\r\n\t\tif (hash !== undefined && hash.length > 0) {\r\n\t\t\tlet pos = getExHashPos();\r\n\t\t\tif (pos < 0) pos = undefined;\r\n\t\t\tthis.hashParam = hash.substring(1, pos);\r\n\t\t}\r\n\t\tlet {url, ws, resHost} = host;\r\n\t\tthis.centerHost = url;\r\n\t\tthis.resUrl = resUrlFromHost( resHost);\r\n\t\tthis.wsHost = ws;\r\n\t\tsetCenterUrl(url);\r\n\r\n\t\tlet guest:Guest = this.local.guest.get();\r\n\t\tif (guest === undefined) {\r\n\t\t\tguest = await guestApi.guest();\r\n\t\t}\r\n\t\tif (!guest) {\r\n\t\t\tdebugger;\r\n\t\t\tthrow Error('guest can not be undefined');\r\n\t\t}\r\n\t\tnav.setGuest(guest);\r\n\r\n\t\tlet exHash = getExHash();\r\n\t\tlet appInFrame = setAppInFrame(exHash);\r\n\t\tif (exHash !== undefined && window !== window.parent) {\r\n\t\t\t// is in frame\r\n\t\t\tif (appInFrame !== undefined) {\r\n\t\t\t\t//this.ws = wsBridge;\r\n\t\t\t\tconsole.log('this.ws = wsBridge in sub frame');\r\n\t\t\t\t//nav.user = {id:0} as User;\r\n\t\t\t\tif (window.self !== window.parent) {\r\n\t\t\t\t\twindow.parent.postMessage({type:'sub-frame-started', hash: appInFrame.hash}, '*');\r\n\t\t\t\t}\r\n\t\t\t\t//  appBridge.ts  initSubWinmain frameuser\r\n\t\t\t\t//await this.showAppView();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet predefinedUnit = await this.loadPredefinedUnit();\r\n\t\tappInFrame.predefinedUnit = predefinedUnit;\r\n\t}\r\n\r\n    async start() {\r\n        try {\r\n\t\t\twindow.onerror = this.windowOnError;\r\n            window.onunhandledrejection = this.windowOnUnhandledRejection;\r\n            //window.addEventListener('click', this.windowOnClick);\r\n            //window.addEventListener('mousemove', this.windowOnMouseMove);\r\n            //window.addEventListener('touchmove', this.windowOnMouseMove);\r\n            //window.addEventListener('scroll', this.windowOnScroll);\r\n            if (isMobile === true) {\r\n                document.onselectstart = function() {return false;}\r\n                document.oncontextmenu = function() {return false;}\r\n            }\r\n            //window.setInterval(()=>console.error('tick every 5 seconds'), 5000);\r\n\t\t\tnav.clear();\r\n\t\t\t//nav.onSysNavRoutes();\r\n\t\t\tthis.startWait();\r\n            \r\n            let user: User = this.local.user.get();\r\n            if (user === undefined) {\r\n                let {notLogined} = this.navView.props;\r\n                if (notLogined !== undefined) {\r\n                    await notLogined();\r\n                }\r\n                else {\r\n                    await nav.showLogin(undefined);\r\n\t\t\t\t\t//nav.navigateToLogin();\r\n                }\r\n                return;\r\n            }\r\n\r\n            await nav.logined(user);\r\n        }\r\n        catch (err) {\r\n\t\t\tconsole.error(err);\r\n\t\t\tdebugger;\r\n        }\r\n        finally {\r\n            this.endWait();\r\n        }\r\n\t}\r\n\r\n\tresolveRoute() {\r\n\t\t//if (this.isRouting === false) return;\r\n\t\tif (this.navigo === undefined) return;\r\n\t\tthis.navigo.resolve();\r\n\t}\r\n\r\n\ton(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\ton(...args:any[]):Navigo {\r\n\t\tif (this.navigo === undefined) {\r\n\t\t\tthis.navigo = new Navigo();\r\n\t\t\tif (this.isWebNav !== true) this.navigo.historyAPIUpdateMethod('replaceState');\r\n\t\t}\r\n\t\treturn this.navigo.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tprivate navLogin:NavPage = async (params:any) => {\r\n\t\tnav.showLogin(async (user: User) => window.history.back(), false);\r\n\t}\r\n\r\n\tprivate navLogout:NavPage = async (params:any) => {\r\n\t\tnav.showLogout(async () => window.history.back());\r\n\t}\r\n\r\n\tprivate navRegister:NavPage = async (params:any) => {\r\n\t\tnav.showRegister();\r\n\t}\r\n\r\n\tprivate navForget:NavPage = async (params:any) => {\r\n\t\tnav.showForget();\r\n\t}\r\n\r\n\tnavigateToLogin() {\r\n\t\tnav.navigate('/login');\r\n\t}\r\n\r\n\topenSysPage(url: string) {\r\n\t\tlet navPage: NavPage = this.sysRoutes[url];\r\n\t\tif (navPage === undefined) {\r\n\t\t\talert(url + ' is not defined in sysRoutes');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tnavPage(undefined);\r\n\t}\r\n\r\n\tprivate navPageRoutes: {[url:string]: NavPage};\r\n\tprivate routeFromNavPage(navPage: NavPage) {\r\n\t\treturn (params: any, queryStr: any) => {\r\n\t\t\tif (navPage) {\r\n\t\t\t\tif (this.isWebNav) nav.clear();\r\n\t\t\t\tnavPage(params);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tonNavRoute(navPage: NavPage) {\r\n\t\tthis.on(this.routeFromNavPage(navPage));\r\n\t}\r\n\tprivate doneSysRoutes:boolean = false;\r\n\tprivate sysRoutes: { [route: string]: NavPage } = {\r\n\t\t'/login': this.navLogin,\r\n\t\t'/logout': this.navLogout,\r\n\t\t'/register': this.navRegister,\r\n\t\t'/forget': this.navForget,\r\n\t}\r\n\t/*\r\n\tonSysNavRoutes() {\r\n\t\tthis.onNavRoutes(this.sysRoutes);\r\n\t}\r\n\t*/\r\n\tonNavRoutes(navPageRoutes: {[url:string]: NavPage}) {\r\n\t\tif (this.doneSysRoutes === false) {\r\n\t\t\tthis.doneSysRoutes = true;\r\n\t\t\tthis.internalOnNavRoutes(this.sysRoutes);\r\n\t\t}\r\n\t\tthis.internalOnNavRoutes(navPageRoutes);\r\n\t}\r\n\r\n\tprivate internalOnNavRoutes(navPageRoutes: {[url:string]: NavPage}) {\r\n\t\tif (!navPageRoutes) return;\r\n\t\tthis.navPageRoutes = _.merge(this.navPageRoutes, navPageRoutes);\r\n\t\tlet navOns: { [route: string]: (params: any, queryStr: any) => void } = {};\r\n\t\tfor (let route in navPageRoutes) {\r\n\t\t\tlet navPage = navPageRoutes[route];\r\n\t\t\tnavOns[route] = this.routeFromNavPage(navPage);\r\n\t\t}\r\n\t\tthis.on(navOns);\r\n\t}\r\n\r\n\t/*\r\n\tget isWebNav():boolean { \r\n\t\tif (!this.navigo) return false;\r\n\t\treturn !isMobile;\r\n\t}\r\n\t*/\r\n\tisWebNav:boolean = false;\r\n\tbackIcon = <i className=\"fa fa-angle-left\" />;\r\n\tcloseIcon = <i className=\"fa fa-close\" />;\r\n\tsetIsWebNav() {\r\n\t\tthis.isWebNav = true;\r\n\t\tthis.backIcon = <i className=\"fa fa-arrow-left\" />;\r\n\t\tthis.closeIcon = <i className=\"fa fa-close\" />;\r\n\t}\r\n\r\n\tpageWebNav: PageWebNav;\r\n\r\n\tget isMobile():boolean {return isMobile;}\r\n\r\n\tnavigate(url:string, absolute?:boolean) {\r\n\t\tif (!this.navigo) {\r\n\t\t\talert('Is not in webnav state, cannot navigate to url \"' + url + '\"');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.testing === true) {\r\n\t\t\turl += '#test';\r\n\t\t}\r\n\t\treturn this.navigo.navigate(url, absolute);\r\n\t}\r\n\r\n\tgo(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tif (this.navigo !== undefined) {\r\n\t\t\tthis.navigate(url, absolute);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tshowPage();\r\n\t\t}\r\n\t}\r\n\r\n    async showAppView(isUserLogin?: boolean) {\r\n        let {onLogined} = this.navView.props;\r\n        if (onLogined === undefined) {\r\n            nav.push(<div>NavView has no prop onLogined</div>);\r\n            return;\r\n        }\r\n        nav.clear();\r\n        await onLogined(isUserLogin);\r\n    }\r\n\r\n    setGuest(guest: Guest) {\r\n        this.local.guest.set(guest);\r\n        netToken.set(0, guest.token);\r\n    }\r\n\r\n    saveLocalUser() {\r\n        this.local.user.set(this.user);\r\n    }\r\n\r\n    async loadMe() {\r\n        let me = await userApi.me();\r\n        this.user.icon = me.icon;\r\n        this.user.nick = me.nick;\r\n    }\r\n\r\n\tprivate async internalLogined(user: User, callback: (user:User)=>Promise<void>, isUserLogin:boolean) {\r\n        logoutApis();\r\n        console.log(\"logined: %s\", JSON.stringify(user));\r\n        this.user = user;\r\n        this.saveLocalUser();\r\n\t\tnetToken.set(user.id, user.token);\r\n\t\tnav.clear();\r\n\r\n        if (callback !== undefined) //this.loginCallbacks.has)\r\n            callback(user);\r\n            //this.loginCallbacks.call(user);\r\n        else if (this.isWebNav === true) {\r\n\t\t\tthis.navigate('/index');\r\n\t\t}\r\n\t\telse {\r\n            await this.showAppView(isUserLogin);\r\n        }\r\n\t}\r\n\r\n\t// \r\n    async logined(user: User, callback?: (user:User)=>Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, false);\r\n    }\r\n\r\n\t// \r\n    async userLogined(user: User, callback?: (user:User)=>Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, true);\r\n    }\r\n\r\n    //wsConnect() {\r\n        //let ws:WSChannel = this.ws = new WSChannel(this.wsHost, this.user.token);\r\n        //ws.connect();\r\n    //}\r\n\r\n    loginTop(defaultTop:JSX.Element) {\r\n        return (this.navSettings && this.navSettings.loginTop) || defaultTop;\r\n    }\r\n\r\n    privacyEntry() {\r\n        if (!this.getPrivacyContent()) return;\r\n        return <div className=\"text-center\">\r\n            <button className=\"btn btn-sm btn-link\"\r\n                onClick={this.showPrivacyPage}>\r\n                <small className=\"text-muted\"></small>\r\n            </button>\r\n        </div>;\r\n    }\r\n\r\n    private getPrivacyContent():string {\r\n        if (!this.navSettings) return;\r\n        let {privacy} = this.navSettings;\r\n        return privacy;\r\n    }\r\n\r\n    showPrivacyPage = () => {\r\n        let privacy = this.getPrivacyContent();\r\n        if (privacy) {\r\n            this.privacyPage(privacy);\r\n        }\r\n        else {\r\n            nav.push(<Page header=\"\">\r\n                <div className=\"p-3\">AppConfig  privacyurlmarkdown</div>\r\n            </Page>);\r\n        }\r\n    }\r\n\r\n    private privacyPage = async (htmlString: string) => {\r\n        //let html = await this.getPrivacy(privacy);\r\n\t\t//let content = {__html: marked(html)};\r\n\t\tlet content = {__html: htmlString};\r\n        nav.push(<Page header=\"\">\r\n            <div className=\"p-3\" dangerouslySetInnerHTML={content} />\r\n        </Page>);\r\n    }\r\n\r\n\tprivate createLogin = createLogin;\r\n\tsetCreateLogin(createLogin: ()=>Promise<Login>) {\r\n\t\tthis.createLogin = createLogin;\r\n\t}\r\n\r\n\tprivate login: Login;\r\n\tprivate async getLogin():Promise<Login> {\r\n\t\tif (this.login) return this.login;\r\n\t\treturn this.login = await this.createLogin();\r\n\t}\r\n\tasync showLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean) {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showLogin(callback, withBack);\r\n    }\r\n\r\n    async showLogout(callback?: ()=>Promise<void>) {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showLogout(callback);\r\n\t}\r\n\t\r\n\tasync showRegister() {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showRegister();\r\n\t}\r\n\r\n\tasync showForget() {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showForget();\r\n\t}\r\n\r\n    async logout(callback?:()=>Promise<void>) { //notShowLogin?:boolean) {\r\n        appInFrame.unit = undefined;\r\n        this.local.logoutClear();\r\n        this.user = undefined; //{} as User;\r\n        logoutApis();\r\n        let guest = this.local.guest.get();\r\n        setCenterToken(0, guest && guest.token);\r\n\t\t//this.ws = undefined;\r\n\t\tthis.clear();\r\n        if (callback === undefined)\r\n            await nav.start();\r\n        else\r\n            await callback();\r\n    }\r\n\r\n    async changePassword() {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showChangePassword();\r\n    }\r\n\r\n    get level(): number {\r\n        return this.navView.level;\r\n    }\r\n    startWait() {\r\n        this.navView?.startWait();\r\n    }\r\n    endWait() {\r\n        this.navView?.endWait();\r\n    }\r\n    async onError(error: FetchError) {\r\n        await this.navView.onError(error);\r\n    }\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await this.navView.showUpgradeUq(uq, version);\r\n    }\r\n\r\n    show (view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.show(view, disposer);\r\n    }\r\n    push(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.push(view, disposer);\r\n    }\r\n    replace(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.replace(view, disposer);\r\n    }\r\n    pop(level:number = 1) {\r\n        this.navView.pop(level);\r\n    }\r\n    topKey():number {\r\n        return this.navView.topKey();\r\n    }\r\n    popTo(key:number) {\r\n        this.navView.popTo(key);\r\n    }\r\n    clear() {\r\n        this.navView?.clear();\r\n    }\r\n    navBack() {\r\n        this.navView.navBack();\r\n    }\r\n    ceaseTop(level?:number) {\r\n        this.navView.ceaseTop(level);\r\n    }\r\n    removeCeased() {\r\n        this.navView.removeCeased();\r\n    }\r\n    async back(confirm:boolean = true) {\r\n        await this.navView.back(confirm);\r\n    }\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.navView.regConfirmClose(confirmClose);\r\n    }\r\n    confirmBox(message?:string): boolean {\r\n        return this.navView.confirmBox(message);\r\n    }\r\n    async navToApp(url: string, unitId: number, apiId?:number, sheetType?:number, sheetId?:number):Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            let sheet = this.centerHost.includes('http://localhost:') === true? 'sheet_debug':'sheet'\r\n            let uh = sheetId === undefined?\r\n                    appUrl(url, unitId) :\r\n                    appUrl(url, unitId, sheet, [apiId, sheetType, sheetId]);\r\n            console.log('navToApp: %s', JSON.stringify(uh));\r\n            nav.push(<article className='app-container'>\r\n                <span id={uh.hash} onClick={()=>this.back()} /*style={mobileHeaderStyle}*/>\r\n                    <i className=\"fa fa-arrow-left\" />\r\n                </span>\r\n                {\r\n                    // eslint-disable-next-line \r\n                    <iframe src={uh.url} title={String(sheetId)} />\r\n                }\r\n            </article>, \r\n            ()=> {\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n\r\n    navToSite(url: string) {\r\n        // show in new window\r\n        window.open(url);\r\n    }\r\n\r\n    get logs() {return logs};\r\n    log(msg:string) {\r\n        logs.push(msg);\r\n    }\r\n    logMark() {\r\n        let date = new Date();\r\n        logMark = date.getTime();\r\n        logs.push('log-mark: ' + date.toTimeString());\r\n    }\r\n    logStep(step:string) {\r\n        logs.push(step + ': ' + (new Date().getTime() - logMark));\r\n    }\r\n\r\n    showReloadPage(msg: string) {\r\n        let seconds = -1;\r\n\t\tthis.push(<ReloadPage message={msg} seconds={seconds} />);\r\n\t\t/*\r\n\t\tif (seconds > 0) {\r\n\t\t\tenv.setTimeout(undefined, this.reload, seconds*1000);\r\n\t\t}\r\n\t\t*/\r\n    }\r\n\r\n    reload = async () => {\r\n        let waiting:Promise<void> = new Promise<void>((resolve, reject) => {\r\n            setTimeout(resolve, 100);\r\n        });\r\n\r\n        if ('serviceWorker' in navigator) {\r\n            let registration =await Promise.race([waiting, navigator.serviceWorker.ready]);\r\n            if (registration) registration.unregister();\r\n        }\r\n\t\twindow.document.location.reload();\r\n\t\t// dcloud hbuilderappwebview\r\n\t\tlet plus = (window as any).plus;\r\n\t\tif (plus) {\r\n\t\t\tlet webview = plus.webview;\r\n\t\t\tif (webview) {\r\n\t\t\t\tif (webview.reload) webview.reload(true);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet webView = plus.webView;\r\n\t\t\t\tif (webView) {\r\n\t\t\t\t\tif (webView.reload) webView.reload(true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//plus.webview.reload(true)\r\n\t\t}\r\n    }\r\n\r\n    resetAll = () => {\r\n        this.push(<ConfirmReloadPage confirm={(ok:boolean):Promise<void> => {\r\n            if (ok === true) {\r\n                this.showReloadPage('');\r\n\t\t\t\tlocalStorage.clear();\r\n\t\t\t\t/*\r\n                this.local.readToMemory();\r\n                env.localDb.removeAll();\r\n\t\t\t\tthis.local.saveToLocalStorage();\r\n\t\t\t\t*/\r\n            }\r\n            else {\r\n                this.pop();\r\n            }\r\n            return;\r\n        }} />);\r\n    }\r\n\r\n    async checkVersion():Promise<string> {\r\n        let {href} = document.location;\r\n        href += (href.indexOf('?')>=0? '&':'?') + '_t_t_=' + new Date().getTime();\r\n        let ret = await fetch(href);\r\n        let r = await ret.text();\r\n        let parser = new DOMParser();\r\n        let htmlDoc = parser.parseFromString(r, 'text/html');\r\n        let elHtml = htmlDoc.getElementsByTagName('html');\r\n        let newVersion = elHtml[0].getAttribute('data-version');\r\n        return newVersion;\r\n    }\r\n}\r\nexport const nav: Nav = new Nav();\r\n\r\nexport class TonvaView extends NavView {\r\n\r\n}\r\n","\r\nimport {setCenterToken} from './uqApi';\r\nimport {WSChannel} from './wsChannel';\r\n\r\nexport const netToken = {\r\n    set(userId:number, token:string) {\r\n        setCenterToken(userId, token);\r\n        WSChannel.setCenterToken(token);\r\n    },\r\n    clear() {\r\n        setCenterToken(0, undefined);\r\n        WSChannel.setCenterToken(undefined);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport {FetchError} from '../net/fetchError';\r\nimport { refetchApi } from '../net';\r\nimport { Page } from './page/page';\r\n\r\nexport interface FetchErrorProps extends FetchError {\r\n    clearError: ()=>void\r\n}\r\n\r\nexport default class FetchErrorView extends React.Component<FetchErrorProps, null> {\r\n    private reApi = async () => {\r\n        this.props.clearError();\r\n        const {channel, url, options, resolve, reject} = this.props;\r\n        await refetchApi(channel, url, options, resolve, reject);\r\n    }\r\n    private close = async () => {\r\n        this.props.clearError();\r\n    }\r\n    render() {\r\n        let {error, url} = this.props;\r\n        let errContent:any;\r\n        if (typeof error === 'object') {\r\n            let err = [];\r\n            for (let i in error) {\r\n                err.push(<li key={i}><label>{i}</label><div style={{wordWrap:\"break-word\"}}>{error[i]}</div></li>);\r\n            }\r\n            errContent = <ul>{err}</ul>;\r\n        }\r\n        else {\r\n            errContent = <div>{error}</div>;\r\n        }\r\n        return <div>\r\n            <article>\r\n\t\t\t\t<main className=\"va-error\">\r\n\t\t\t\t\t<div></div>\r\n\t\t\t\t\t<div></div>\r\n\t\t\t\t\t<div style={{wordWrap:\"break-word\"}}>url: {url}</div>\r\n\t\t\t\t\t{errContent}\r\n\t\t\t\t\t<div className=\"p-3\">\r\n\t\t\t\t\t\t<button type='button' onClick={this.reApi}>API</button>\r\n\t\t\t\t\t\t<button type='button' onClick={this.close}></button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</main>\r\n            </article>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport const SystemNotifyPage = ({message}:{message:string}):JSX.Element => {\r\n    return <Page header=\"\">\r\n        <div className=\"px-3\">{message}</div>\r\n    </Page>;\r\n}","import * as React from 'react';\r\nimport { nav } from './nav';\r\nimport { Page } from './page/page';\r\n\r\ninterface Props {\r\n    message: string,\r\n    seconds: number\r\n}\r\n\r\ninterface State {\r\n    seconds: number\r\n}\r\n\r\nexport class ReloadPage extends React.Component<Props, State> {\r\n    private timerHandler:any;\r\n    constructor(props:Props) {\r\n\t\tsuper(props);\r\n\t\tlet {seconds} = props;\r\n\t\tif (seconds===undefined) return;\r\n        this.state = {seconds};\r\n\t\tif (seconds <= 0) return;\r\n        this.timerHandler = setInterval(() => {\r\n\t\t\tlet {seconds} = this.state;\r\n            seconds--;\r\n            if (seconds <= 0) {\r\n                this.reload();\r\n            }\r\n            else {\r\n                this.setState({seconds: seconds});\r\n            }\r\n        }, 1000);\r\n    }\r\n    private reload = () => {\r\n        clearInterval(this.timerHandler);\r\n        nav.reload();\r\n    }\r\n    render() {\r\n\t\tlet {seconds} = this.state;\r\n\t\tlet title:string, msg:string;\t\t\r\n\t\tif (seconds > 0) {\r\n\t\t\ttitle = '...';\r\n\t\t\tmsg = this.state.seconds + '';\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttitle = '';\r\n\t\t\tmsg = '';\r\n\t\t}\r\n        return <Page header={false}>\r\n            <div className=\"text-center p-5\">\r\n                <div className=\"text-info py-5\">\r\n\t\t\t\t\t<span className=\"text-danger\">{title}</span>\r\n\t\t\t\t\t<br/>\r\n\t\t\t\t\t{msg}\r\n                    <br/>\r\n                    <span className=\"small text-muted\">{this.props.message}</span>\r\n                </div>\r\n                <button className=\"btn btn-danger\" onClick={this.reload}></button>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface ConfirmReloadPageProps {\r\n    confirm: (ok: boolean)=>Promise<void>;\r\n}\r\nexport const ConfirmReloadPage = (props: ConfirmReloadPageProps):JSX.Element => {\r\n    return <Page header=\"\" back=\"close\">\r\n        <div className=\"py-5 px-3 my-5 mx-2 border bg-white rounded\">\r\n            <div className=\"text-center text-info\">\r\n                \r\n            </div>\r\n            <div className=\"text-center mt-5\">\r\n                <button className=\"btn btn-danger mr-3\" onClick={()=>props.confirm(true)}></button>\r\n            </div>\r\n        </div>\r\n    </Page>;\r\n    // <button className=\"btn btn-outline-danger\" onClick={()=>props.confirm(false)}></button>\r\n}\r\n","import {observable} from 'mobx';\r\n\r\nexport interface Id {\r\n    id: number;\r\n}\r\n\r\nexport abstract class CacheIds<T extends Id> {\r\n    constructor(maxCount:number = 100) {\r\n        this.maxCount = maxCount;\r\n    }\r\n    private maxCount:number;\r\n    private arr:T[] = [];\r\n    @observable dict = new Map<number, T>();\r\n\r\n    loadIds(ids:number[]) {\r\n        let arr:number[] = [];\r\n        for (let id of ids) {\r\n            if (id === null) continue;\r\n            let item = this.dict.get(id);\r\n            if (item === undefined) {\r\n                arr.push(id);\r\n                item = {id:id} as T;\r\n                this.dict.set(id, item);\r\n            }\r\n        }                \r\n        this.loadId(arr);\r\n    }\r\n\r\n    get(id:number):T {\r\n        if (id === undefined || id === null) return null;\r\n        let item = this.dict.get(id);\r\n        if (item === undefined) {\r\n            this.dict.set(id, {id:id} as T);\r\n            this.loadId([id]);\r\n            item = this.dict.get(id);\r\n        }\r\n        return item;\r\n    }\r\n    private setItem(id:number, item:T) {\r\n        if (item === undefined) {\r\n            this.dict.set(id, null);\r\n            this.arr.push({id: id} as T);\r\n        }\r\n        else {\r\n            this.dict.set(id, item);\r\n            this.arr.push(item);\r\n        }\r\n        if (this.arr.length > this.maxCount) {\r\n            item = this.arr.shift();\r\n            this.dict.delete(item.id);\r\n        }\r\n    }\r\n    private async loadId(ids:number[]) {\r\n        let items = await this._loadIds(ids);\r\n        if (items === undefined) {\r\n            for (let id of ids) {\r\n                if (id === null) continue;\r\n                let item = await this._loadId(id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n        else {\r\n            for (let id of ids) {\r\n                let item = items.find(v => v.id === id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected abstract _loadIds(ids:number[]):Promise<T[]>;\r\n    protected abstract _loadId(id:number):Promise<T>;\r\n}\r\n","import { env } from './env';\r\n\r\nexport class LocalData {\r\n    user = env.localDb.child('user');\r\n    guest = env.localDb.child('guest');\r\n    unit = env.localDb.child('unit');\r\n\r\n    private _user:string;\r\n    private _guest:string;\r\n    private _unit:string;\r\n    readToMemory() {\r\n        this._user = this.user.get();\r\n        this._guest = this.guest.get();\r\n        this._unit = this.unit.get();\r\n    }\r\n    saveToLocalStorage() {\r\n        this.user.set(this._user);\r\n        this.guest.set(this._guest);\r\n        this.unit.set(this._unit);\r\n    }\r\n\r\n    logoutClear() {\r\n        [\r\n            this.user,\r\n            this.unit,\r\n        ].forEach(d => d.remove());\r\n    }\r\n}\r\n","export function getObjPropIgnoreCase(obj:any, prop:string):any {\r\n\tif (!obj) return;\r\n\tif (!prop) return;\r\n\tlet keys = Object.keys(obj);\r\n\tprop = prop.toLowerCase();\r\n\tfor (let key of keys) {\r\n\t\tif (key.toLowerCase() === prop) return obj[key];\r\n\t}\r\n\treturn;\r\n}\r\n","\r\nexport const mobileRegex = /^[0-9]*$/;\r\nexport const emailRegex = /\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*/;\r\n// /^([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+\\.[a-zA-Z]{2,3}$/\r\n\r\nexport const EmailFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '';\r\n}\r\n\r\nexport const MobileFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '';\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport {nav, Page, resOptions, PageHeaderProps, PageWebNav} from '../components';\r\nimport { User, env } from '../tool';\r\nimport { VPage } from './vpage';\r\nimport { View } from './view';\r\nimport { messageHub } from '../net';\r\n\r\nexport interface ConfirmOptions {\r\n    caption?: string;\r\n    message: string | JSX.Element;\r\n    classNames?: string;\r\n    ok?: string;\r\n    yes?: string;\r\n    no?: string;\r\n}\r\n\r\nexport interface WebNav<C extends Controller> {\r\n\tVNavHeader?: new (controller: C) => View<C>;\r\n\tVNavRawHeader?: new (controller: C) => View<C>;\r\n\tVNavFooter?: new (controller: C) => View<C>;\r\n\tVNavRawFooter?: new (controller: C) => View<C>;\r\n\trenderPageHeader?: (props: PageHeaderProps) => JSX.Element;\r\n}\r\n\r\nexport abstract class Controller {\r\n    readonly res: any;\r\n\treadonly x: any;\r\n\tprivate _t: any = {};\r\n\treadonly t: (str:string)=>any;\r\n    icon: string|JSX.Element;\r\n    label:string;\r\n\treadonly isDev:boolean = env.isDevelopment;\r\n\tpageWebNav: PageWebNav;\r\n    get user():User {return nav.user}\r\n    get isLogined():boolean {\r\n        let {user} = nav;\r\n        if (user === undefined) return false;\r\n        return user.id > 0;\r\n    }\r\n    constructor(res:any) {\r\n        this.res = res || {};\r\n\t\tthis.x = this.res.x || {};\r\n\t\tthis.t = (str:string):any => this.internalT(str) || str;\r\n\t}\r\n\r\n\tprotected beforeInit() {}\r\n\tprotected afterInit() {}\r\n\r\n\tinit(...param: any[]) {\r\n\t\tthis.beforeInit();\r\n\t\tthis.pageWebNav = this.getPageWebNav();\r\n\t\tthis.afterInit();\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\treturn this._t[str];\r\n\t}\r\n\r\n\tget webNav(): WebNav<any> {return undefined;}\r\n\r\n\tgetWebNav(): WebNav<any> {return this.webNav;}\r\n\r\n\tgetPageWebNav(): PageWebNav {return undefined;}\r\n\r\n\tget isWebNav(): boolean {return nav.isWebNav}\r\n\tnavigate(url:string) {\r\n\t\tnav.navigate(url);\r\n\t}\r\n\t\r\n\tprotected setRes(res:any) {\r\n\t\tif (res === undefined) return;\r\n\t\tlet {$lang, $district} = resOptions;\r\n\t\t_.merge(this._t, res);\r\n\t\tif ($lang !== undefined) {\r\n\t\t\tlet l = res[$lang];\r\n\t\t\tif (l !== undefined) {\r\n\t\t\t\t_.merge(this._t, l);\r\n\t\t\t\tlet d = l[$district];\r\n\t\t\t\tif (d !== undefined) {\r\n\t\t\t\t\t_.merge(this._t, d);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t}\r\n\r\n    private receiveHandlerId:number;\r\n    //private disposer:()=>void;\r\n\r\n    protected dispose = () => {\r\n        // message listener\r\n\t\t//nav.unregisterReceiveHandler(this.receiveHandlerId);\r\n\t\tmessageHub.unregisterReceiveHandler(this.receiveHandlerId);\r\n        this.onDispose();\r\n    }\r\n\r\n    protected onDispose() {\r\n\t}\r\n\t\r\n\t//get isRouting() {return nav.isRouting;}\r\n\r\n\tisMe(id:any):boolean {\r\n\t\tif (id === null) return false;\r\n\t\tlet {user} = this;\r\n\t\tlet userId = user.id;\r\n\t\tswitch (typeof id) {\r\n\t\t\tdefault: return false;\r\n\t\t\tcase 'string': return Number(id) === userId;\r\n\t\t\tcase 'number': return id === userId;\r\n\t\t\tcase 'object': return id.id === userId;\r\n\t\t}\r\n\t}\r\n\r\n    protected async openVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C)=>P, param?:any, afterBack?:(ret:any)=>void):Promise<P> {\r\n\t\tlet ret = new vp((this as any) as C);\r\n\t\tawait ret.open(param, afterBack);\r\n\t\treturn ret;\r\n    }\r\n\r\n    protected async replaceVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C)=>P, param?:any, afterBack?:(ret:any)=>void):Promise<P> {\r\n\t\tlet ret = new vp((this as any) as C);\r\n\t\tawait ret.replaceOpen(param, afterBack);\r\n\t\treturn ret;\r\n    }\r\n\r\n    protected renderView<C extends Controller, V extends View<C>>(view: new (controller: C)=>V, param?:any):JSX.Element {\r\n\t\tlet v = new view((this as any) as C);\r\n\t\treturn v.render(param);\r\n    }\r\n\r\n    async event(type:string, value:any) {\r\n        await this.onEvent(type, value);\r\n    }\r\n\r\n    protected async onEvent(type:string, value:any) {\r\n    }\r\n\r\n    protected msg(text:string) {\r\n        alert(text);\r\n    }\r\n    protected errorPage(header:string, err:any) {\r\n        this.openPage(<Page header=\"App error!\">\r\n            <pre>\r\n                {typeof err === 'string'? err : err.message}\r\n            </pre>\r\n        </Page>);\r\n    }\r\n\r\n    protected onMessage(message:any):Promise<void> {\r\n        return;\r\n    }\r\n\r\n    private onMessageReceive = async (message:any):Promise<void> => {\r\n        await this.onMessage(message);\r\n    }\r\n\r\n    protected async beforeStart():Promise<boolean> {\r\n        /*\r\n        console.log('this.receiveHandlerId = nav.registerReceiveHandler(this.onMessageReceive);');\r\n        this.receiveHandlerId = nav.registerReceiveHandler(this.onMessageReceive);\r\n        console.log('return true');\r\n        */\r\n        return true;\r\n\t}\r\n\tprotected async afterStart():Promise<void> {\r\n\t}\r\n    protected registerReceiveHandler() {\r\n        this.receiveHandlerId = messageHub.registerReceiveHandler(this.onMessageReceive);\r\n    }\r\n\r\n    protected abstract internalStart(param?:any, ...params:any[]):Promise<void>;\r\n    async start(param?:any, ...params:any[]):Promise<void> {\r\n        //this.disposer = this.dispose;\r\n\t\tthis.registerReceiveHandler();\r\n        let ret = await this.beforeStart();\r\n        if (ret === false) return;\r\n\t\tawait this.internalStart(param, ...params);\r\n\t\tawait this.afterStart();\r\n    }\r\n\r\n    get isCalling():boolean {return this._resolve_$ !== undefined}\r\n\r\n    private _resolve_$:((value:any) => void)[];\r\n    async call<T>(param?:any, ...params:any[]):Promise<T> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<T> (async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await this.start(param, ...params);\r\n        });\r\n    }\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<any> (async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await (new vp(this as any)).open(param);\r\n        });\r\n    }\r\n\r\n    returnCall(value:any) {\r\n        if (this._resolve_$ === undefined) return;\r\n        let resolve = this._resolve_$.pop();\r\n        if (resolve === undefined) {\r\n            alert('the Controller call already returned, or not called');\r\n            return;\r\n        }\r\n        resolve(value);\r\n    }\r\n\r\n    openPage(page:JSX.Element, onClosePage?: (ret:any)=>void) {\r\n\t\tlet disposer: ()=>void;\r\n\t\tif (onClosePage !== undefined) {\r\n\t\t\tdisposer = () => {\r\n\t\t\t\t//if (this.disposer) this.disposer();\r\n\t\t\t\tonClosePage(undefined);\r\n\t\t\t}\r\n\t\t}\r\n\r\n        nav.push(page, disposer);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    replacePage(page:JSX.Element, onClosePage?: ()=>void) {\r\n        nav.replace(page, onClosePage);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    backPage() {\r\n        nav.back();\r\n    }\r\n\r\n    closePage(level?:number) {\r\n        nav.pop(level);\r\n    }\r\n\r\n    ceasePage(level?:number) {\r\n        nav.ceaseTop(level);\r\n\t}\r\n\t\r\n\tgo(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tnav.go(showPage, url, absolute);\r\n\t}\r\n\r\n    removeCeased() {\r\n        nav.removeCeased();\r\n    }\r\n\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        nav.regConfirmClose(confirmClose);\r\n\t}\r\n\r\n\tprivate topPageKey:any;\r\n\tprotected startAction() {\r\n\t\tthis.topPageKey = nav.topKey();\r\n    }\r\n    get TopKey() {\r\n        return this.topPageKey;\r\n    }\r\n    SetTopKey(key:any) {\r\n        this.topPageKey = key;\r\n    }\r\n\tpublic popToTopPage() {\r\n\t\tnav.popTo(this.topPageKey);\r\n\t}\r\n\r\n    async confirm(options: ConfirmOptions): Promise<'ok'|'yes'|'no'|undefined> {\r\n        return new Promise<'ok'|'yes'|'no'|undefined> (async (resolve, reject) => {\r\n            let {caption, message, ok, yes, no, classNames} = options;\r\n            let close = (res:'ok'|'yes'|'no'|undefined) => {\r\n                this.closePage();\r\n                resolve(res);\r\n            }\r\n            let buttons:any[] = [];\r\n            if (ok !== undefined) {\r\n                buttons.push(<button key=\"ok\" className=\"btn btn-primary mr-3\" onClick={()=>close('ok')}>{ok}</button>);\r\n            }\r\n            if (yes !== undefined) {\r\n                buttons.push(<button key=\"yes\" className=\"btn btn-success mr-3\" onClick={()=>close('yes')}>{yes}</button>);\r\n            }\r\n            if (no !== undefined) {\r\n                buttons.push(<button key=\"no\" className=\"btn btn-outline-danger mr-3\" onClick={()=>close('no')}>{no}</button>);\r\n            }\r\n            this.openPage(<Page header={caption || ''} back=\"close\">\r\n                <div className={classNames || \"rounded bg-white m-5 p-3 border\"}>\r\n                    <div className=\"d-flex align-items-center justify-content-center\">\r\n                        {message}\r\n                    </div>\r\n                    <div className=\"mt-3 d-flex align-items-center justify-content-center\">\r\n                        {buttons}\r\n                    </div>\r\n                </div>\r\n            </Page>);\r\n            nav.regConfirmClose(async ():Promise<boolean> => {\r\n                resolve(undefined);\r\n                return true;\r\n            });\r\n        });\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Page, Image, UserView } from '../components';\r\nimport { env, User } from '../tool';\r\nimport { Controller } from './controller';\r\nimport { VPage } from './vpage';\r\n\r\nexport abstract class View<C extends Controller> {\r\n    protected controller: C;\r\n    protected readonly res: any;\r\n\tprotected readonly x: any;\r\n\tprotected readonly t: (str:string)=>any;\r\n\r\n    constructor(controller: C) {\r\n        this.controller = controller;\r\n        this.res = controller.res;\r\n\t\tthis.x = controller.x;\r\n\t\tthis.t = controller.t;\r\n    }\r\n\r\n\tprotected get isDev() {return  env.isDevelopment}\r\n\tget isWebNav(): boolean {return this.controller.isWebNav}\r\n\tnavigate(url:string) {this.controller.navigate(url)}\r\n\tprotected isMe(id:any) {return this.controller.isMe(id)}\r\n    abstract render(param?:any): JSX.Element;\r\n\r\n    protected renderVm(vm: new (controller: C)=>View<C>, param?:any) {\r\n        return (new vm(this.controller)).render(param);\r\n    }\r\n\r\n    protected async openVPage(vp: new (controller: C)=>VPage<C>, param?:any, afterBack?:()=>Promise<void>):Promise<void> {\r\n        await (new vp(this.controller)).open(param, afterBack);\r\n    }\r\n\r\n    protected async event(type:string, value?:any) {\r\n        await this.controller.event(type, value);\r\n\t}\r\n\t\r\n\tprotected go(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tthis.controller.go(showPage, url, absolute);\r\n\t}\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        return await this.controller.vCall(vp, param);\r\n    }\r\n\r\n    protected returnCall(value:any) {\r\n        this.controller.returnCall(value);\r\n    }\r\n\r\n\tprotected renderUser(user:any, imageClassName?:string, textClassName?:string) {\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick, icon} = user;\r\n\t\t\treturn <>\r\n\t\t\t\t<Image src={icon} className={imageClassName || 'w-1c h-1c mr-2'} />\r\n\t\t\t\t<span className={textClassName}>{nick || name}</span>\r\n\t\t\t</>;\r\n\t\t}\r\n\t\treturn <UserView user={user} render={renderUser} />\r\n\t}\r\n\r\n\tprotected renderUserText(user:any) {\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick} = user;\r\n\t\t\treturn <>{nick || name}</>;\r\n\t\t}\r\n\t\treturn <UserView user={user} render={renderUser} />\r\n\t}\r\n\r\n\tprotected renderMe(imageClassName?:string, textClassName?:string) {\r\n\t\tlet {user} = this.controller;\r\n\t\tif (!user) return;\r\n\t\treturn this.renderUser(user.id, imageClassName, textClassName);\r\n\t}\r\n\r\n    protected openPage(view: React.StatelessComponent<any>, param?:any, onClosePage?:(ret:any)=>void) {\r\n        let type = typeof param;\r\n        if (type === 'object' || type === 'undefined') {\r\n            this.controller.openPage(React.createElement(view, param), onClosePage);\r\n        }\r\n        else {\r\n            this.controller.openPage(<Page header=\"param type error\">\r\n                View.openPage param must be object, but here is {type}\r\n            </Page>, onClosePage);\r\n        }\r\n    }\r\n\r\n    protected replacePage(view: React.StatelessComponent<any>, param?:any) {\r\n        this.controller.replacePage(React.createElement(view, param));\r\n    }\r\n\r\n    protected openPageElement(page: JSX.Element, onClosePage?: ()=>void) {\r\n        this.controller.openPage(page, onClosePage);\r\n    }\r\n\r\n    protected replacePageElement(page: JSX.Element, onClosePage?: ()=>void) {\r\n        this.controller.replacePage(page, onClosePage);\r\n    }\r\n\r\n    protected backPage() {\r\n        this.controller.backPage();\r\n    }\r\n\r\n    protected closePage(level?:number) {\r\n        this.controller.closePage(level);\r\n    }\r\n\r\n    protected ceasePage(level?:number) {\r\n        this.controller.ceasePage(level);\r\n    }\r\n\r\n    protected removeCeased() {\r\n        this.controller.removeCeased();\r\n    }\r\n\r\n    protected regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.controller.regConfirmClose(confirmClose);\r\n\t}\r\n\r\n\tprotected popToTopPage() {\r\n\t\tthis.controller.popToTopPage();\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { Page, Scroller, TabsProps } from \"../components\";\r\nimport { View } from \"./view\";\r\nimport { Controller } from \"./controller\";\r\n\r\nexport abstract class VPage<C extends Controller> extends View<C> {\r\n\tprotected retOnClosePage: any;\r\n\r\n    open(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.openPageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n    replaceOpen(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.replacePageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n\trender(param?:any):JSX.Element {\r\n\t\tthis.init(param);\r\n\t\treturn this.renderPage();\r\n\t}\r\n\r\n\tinit(param?:any):void {return;}\r\n\r\n\theader():string|boolean|JSX.Element {return null;}\r\n\tright():JSX.Element {return null;}\r\n\tcontent():JSX.Element {return null;}\r\n\tfooter():JSX.Element {return null;}\r\n\tlogout(): boolean | (()=>Promise<void>) {return false;}\r\n\tprotected renderPage():JSX.Element {\r\n\t\tlet header = this.header();\r\n\t\tif (!header) header = false;\r\n\t\tlet logout = this.logout();\r\n\t\treturn <Page\r\n\t\t\theader={header} right={this.right()} footer={this.footer()}\r\n\t\t\tonScroll={(e:any)=>this.onPageScroll(e)}\r\n\t\t\tonScrollTop={(scroller: Scroller) => this.onPageScrollTop(scroller)}\r\n\t\t\tonScrollBottom={(scroller: Scroller) => this.onPageScrollBottom(scroller)}\r\n\t\t\tback={this.back}\r\n\t\t\theaderClassName={this.headerClassName}\r\n\t\t\tclassName={this.className}\r\n\t\t\tafterBack={()=>this.afterBack()}\r\n\t\t\ttabsProps={this.tabsProps}\r\n\t\t\tlogout={logout}\r\n\t\t\twebNav={this.controller.pageWebNav}\r\n\t\t>\r\n\t\t\t{this.content()}\r\n\t\t</Page>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {return;}\r\n\tprotected afterBack():void {}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'back'}\r\n\tprotected get headerClassName(): string {return null;}\r\n\tprotected get className(): string {return null;}\r\n\tprotected get tabsProps(): TabsProps {return null;}\r\n}\r\n","import React from 'react';\r\nimport _ from 'lodash';\r\nimport { FA, Page } from '../../components';\r\nimport { Controller } from \"../controller\";\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport interface CStringEditProps {\r\n\tlabel?: string;\r\n\tplaceholder?: string;\r\n\tmaxLength?: number;\r\n\tonValueChange?: (value: string) => Promise<void>;\r\n}\r\n\r\nexport class CStringEdit extends Controller {\r\n\tprivate props: CStringEditProps = {\r\n\t\tlabel: ''\r\n\t}\r\n\t@observable value: string;\r\n\t@observable private newValue: string;\r\n\t@observable private isChanged: boolean;\r\n\t@observable private error: string;\r\n\r\n\tprotected async internalStart() {}\r\n\trender(value:string, props?:CStringEditProps) {\r\n\t\tthis.value = value;\r\n\t\tif (props) _.merge(this.props, props);\r\n\t\treturn React.createElement(observer(()=><>{this.renderValue()}{this.renderPencil()}</>))\r\n\t}\r\n\r\n\tprotected renderValue() {return <>{this.value}</>}\r\n\tprotected renderPencil() {\r\n\t\treturn <span onClick={this.onEdit} className=\"cursor-pointer\">\r\n\t\t\t&nbsp; <FA className=\"text-info\" name=\"pencil-square-o\" /> &nbsp;\r\n\t\t</span>;\r\n\t}\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.verifyValue();\r\n\t}\r\n\t\r\n\tprotected verifyValue() {}\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n\t}\r\n\t\r\n\tprivate onEdit = () => {\r\n\t\tlet {label, maxLength, placeholder, onValueChange} = this.props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tthis.value = this.newValue;\r\n\t\t\t\tthis.closePage();\r\n\t\t\t\tif (onValueChange) onValueChange(this.value);\r\n\t\t\t}\r\n\t\t}\r\n        let right = React.createElement(observer(() => <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}></button>));\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\t\tif (evt.keyCode === 13) onSave();\r\n\t\t}\r\n\t\tthis.openPage(<Page header={label} right={right}>\r\n            <div className=\"m-3\">\r\n\t\t\t\t<input type=\"text\"\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n\t\t\t\t\tclassName=\"form-control\"\r\n\t\t\t\t\tdefaultValue={this.value}\r\n\t\t\t\t\tmaxLength={maxLength} />\r\n                {\r\n\t\t\t\t\tReact.createElement(observer(()=> placeholder && <div className=\"small muted m-2\">{placeholder}</div>))                    \r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n\t\t</Page>);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {PageHeaderProps, renderPageHeader} from './pageHeader';\r\nimport { TabsProps, TabsView } from './tabs';\r\nimport { ScrollProps, ScrollView, PageWebNav, WebNavScrollView } from './scrollView';\r\nimport { nav } from '../nav';\r\n\r\nexport interface IVPage {\r\n\tcontent():JSX.Element;\r\n\theader():JSX.Element|string;\r\n\tfooter():JSX.Element;\r\n}\r\n\r\nexport interface PageProps extends ScrollProps {\r\n    back?: 'close' | 'back' | 'none';\r\n    header?: boolean | string | JSX.Element;\r\n    right?: JSX.Element;\r\n    footer?: JSX.Element;\r\n    logout?: boolean | (()=>Promise<void>);\r\n\theaderClassName?: string;\r\n\tclassName?: string;\r\n\tafterBack?: () => void;\r\n\ttabsProps?: TabsProps;\r\n\twebNav?: PageWebNav;\r\n}\r\n\r\n@observer\r\nexport class Page extends React.Component<PageProps> {\r\n\tprivate tabsView: TabsView;\r\n    constructor(props: PageProps) {\r\n\t\tsuper(props);\r\n\t\tlet {tabsProps} = props;\r\n\t\tif (tabsProps) {\r\n\t\t\tthis.tabsView = new TabsView(tabsProps);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderHeader(webNav?: PageWebNav) {\r\n\t\tconst {back, header, right, headerClassName, afterBack, logout} = this.props;\r\n\t\tif (header === false) return;\r\n\t\t//const {webNav} = this.props;\r\n\t\tlet inWebNav = false;\r\n\t\tlet pageHeaderProps:PageHeaderProps = {\r\n\t\t\tback,\r\n\t\t\tcenter: header as any,\r\n\t\t\tright,\r\n\t\t\tlogout,\r\n\t\t\tclassName: headerClassName,\r\n\t\t\tafterBack,\r\n\t\t};\r\n\t\tif (webNav !== undefined) {\r\n\t\t\tinWebNav = true;\r\n\t\t\tlet {renderPageHeader: rph} = webNav;\r\n\t\t\tif (rph) return rph(pageHeaderProps);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinWebNav = false;\r\n\t\t}\r\n\t\treturn renderPageHeader(pageHeaderProps, inWebNav);\r\n\t\t/*\r\n\t\tlet pageHeader = header !== false && <PageHeader \r\n\t\t\tback={back} \r\n\t\t\tcenter={header as any}\r\n\t\t\tright={right}\r\n\t\t\tlogout={this.props.logout}\r\n\t\t\tclassName={headerClassName}\r\n\t\t\tafterBack={afterBack}\r\n\t\t\t/>;\r\n\t\treturn pageHeader;\r\n\t\t*/\r\n\t}\r\n\r\n\tprivate renderFooter(webNav?: PageWebNav) {\r\n\t\tconst {footer} = this.props;\r\n\t\tif (!footer) return;\r\n\t\tlet elFooter = <footer>{footer}</footer>;\r\n\t\tif (webNav) return elFooter;\r\n\t\treturn <>\r\n\t\t\t<section className=\"tv-page-footer\">{elFooter}</section>\r\n\t\t\t{elFooter}\r\n\t\t</>;\r\n\t}\r\n\r\n\tcomponentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n\t\t// You can also log the error to an error reporting service\r\n\t\t//logErrorToMyService(error, errorInfo);\r\n\t\tdebugger;\r\n\t}\r\n\t\r\n    render() {\r\n\t\tif (this.tabsView) {\r\n\t\t\treturn React.createElement(this.tabsView.content);\r\n\t\t}\r\n\t\tconst {onScroll, onScrollTop, onScrollBottom, children, className, webNav} = this.props;\r\n\t\tlet pageWebNav:PageWebNav;\r\n\t\tif (!webNav) {\r\n\t\t\tpageWebNav = nav.pageWebNav;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tpageWebNav = webNav;\r\n\t\t}\r\n\t\tlet content = <>\r\n\t\t\t{this.renderHeader(pageWebNav)}\r\n\t\t\t<main>{children}</main>\r\n\t\t\t{this.renderFooter(pageWebNav)}\r\n\t\t</>;\r\n\t\tif (pageWebNav) {\r\n\t\t\treturn <WebNavScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t\twebNav={pageWebNav}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</WebNavScrollView>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn <ScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</ScrollView>;\r\n\t\t}\r\n\t}\r\n}\r\n","import _ from 'lodash';\r\nimport {nav} from '../components';\r\nimport {uid} from '../tool/uid';\r\nimport {uqTokenApi, callCenterapi, centerToken, setCenterToken} from './uqApi';\r\nimport {setSubAppWindow} from './wsChannel';\r\nimport { host } from './host';\r\n\r\nexport interface UqToken {\r\n    name: string;\r\n    db: string;\r\n    url: string;\r\n    token: string;\r\n}\r\nconst uqTokens:{[uqName:string]: UqToken}  = {};\r\nexport function logoutUqTokens() {\r\n    for (let i in uqTokens) {\r\n        uqTokens[i] = undefined;\r\n    }\r\n}\r\n\r\nexport interface AppInFrame {\r\n    hash: string;\r\n    unit: number;       // unit id\r\n    page?: string;\r\n    param?: string[];\r\n    predefinedUnit?: number;  // Cartunit.jsonunitName\r\n}\r\nconst appsInFrame:{[key:string]:AppInFrame} = {};\r\n\r\nclass AppInFrameClass implements AppInFrame {\r\n    hash: string;\r\n    private _unit: number;\r\n    get unit(): number {return this._unit;}       // unit id\r\n    set unit(val:number) { this._unit=val;}\r\n    page?: string;\r\n    param?: string[];\r\n}\r\n\r\nexport let appInFrame:AppInFrame = new AppInFrameClass();\r\n/* {\r\n    hash: undefined,\r\n    get unit():number {return } undefined, //debugUnitId,\r\n    page: undefined;\r\n    param: undefined,\r\n}*/\r\n\r\nexport function isBridged():boolean {\r\n    return window.self !== window.parent;\r\n}\r\n\r\nwindow.addEventListener('message', async function(evt) {\r\n    var message = evt.data;\r\n    switch (message.type) {\r\n        case 'sub-frame-started':\r\n            subFrameStarted(evt);\r\n            break;\r\n        case 'ws':\r\n            //wsBridge.receive(message.msg);\r\n            await nav.onReceive(message.msg);\r\n            break;\r\n        case 'init-sub-win':\r\n            await initSubWin(message);\r\n            break;\r\n        case 'pop-app':\r\n            window.console.log('///\\\\\\\\\\\\ pop-app');\r\n            nav.navBack();\r\n            break;\r\n        case 'center-api':\r\n            await callCenterApiFromMessage(evt.source as Window, message);\r\n            break;\r\n        case 'center-api-return':\r\n            bridgeCenterApiReturn(message);\r\n            break;\r\n        case 'app-api':\r\n            let ret = await onReceiveAppApiMessage(message.hash, message.apiName);\r\n            (evt.source as Window).postMessage({\r\n                type: 'app-api-return', \r\n                apiName: message.apiName,\r\n                db: ret.db,\r\n                url: ret.url,\r\n                token: ret.token} as any, \"*\");\r\n            break;\r\n        case 'app-api-return':\r\n            console.log(\"app-api-return: %s\", JSON.stringify(message));\r\n            console.log('await onAppApiReturn(message);');\r\n            await onAppApiReturn(message);\r\n            break;\r\n        default:\r\n\t\t\tif ((message.source as string)?.startsWith('react-devtools') === true) break;\r\n            window.console.log('message: %s', JSON.stringify(message));\r\n            break;\r\n    }\r\n});\r\n\r\nfunction subFrameStarted(evt:any) {\r\n    var message = evt.data;\r\n    let subWin = evt.source as Window;\r\n    setSubAppWindow(subWin);\r\n    hideFrameBack(message.hash);\r\n    let msg:any = _.clone(nav.user);\r\n    msg.type = 'init-sub-win';\r\n    subWin.postMessage(msg, '*');\r\n}\r\nfunction hideFrameBack(hash:string) {\r\n    let el = document.getElementById(hash);\r\n    if (el !== undefined) el.hidden = true;\r\n}\r\nasync function initSubWin(message:any) {\r\n    console.log('initSubWin: set nav.user', message);\r\n    let user = nav.user = message; // message.user;\r\n    setCenterToken(user.id, user.token);\r\n    await nav.showAppView();\r\n}\r\nasync function onReceiveAppApiMessage(hash: string, apiName: string): Promise<UqToken> {\r\n    let appInFrame = appsInFrame[hash];\r\n    if (appInFrame === undefined) return {name:apiName, db:undefined, url:undefined, token:undefined};\r\n    //let unit = getUnit();\r\n    let {unit, predefinedUnit} = appInFrame;\r\n    unit = unit || predefinedUnit;\r\n    if (!unit) {\r\n        console.error('no unit defined in unit.json or in index.html, or not logined in', unit);\r\n    }\r\n    let parts = apiName.split('/');\r\n    let param = {unit: unit, uqOwner: parts[0], uqName: parts[1], appOwner: parts[2], appName:parts[3]};\r\n    console.log('uqTokenApi.uq onReceiveAppApiMessage', param);\r\n    let ret = await uqTokenApi.uq(param);\r\n    let {db, url, token} = ret;\r\n    return {name: apiName, db:db, url: url, token: token};\r\n}\r\n\r\nasync function onAppApiReturn(message:any) {\r\n    let {apiName, db, url, urlTest, token} = message;\r\n    let action = uqTokenActions[apiName];\r\n    if (action === undefined) {\r\n        throw new Error('error app api return');\r\n        //return;\r\n    }\r\n    let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n    console.log('onAppApiReturn(message:any): url=' + url + ', real=' + realUrl);\r\n    //action.url = realUrl;\r\n    //action.token = token;\r\n    action.resolve({\r\n        name: apiName,\r\n        db: db,\r\n        url: realUrl,\r\n        token: token,\r\n    } as UqToken);\r\n}\r\n\r\nexport function setAppInFrame(appHash: string):AppInFrame {\r\n    if (appHash) {\r\n        let parts = appHash.split('-');\r\n        let len = parts.length;\r\n        if (len > 0) {\r\n            let p = 1;\r\n            appInFrame.hash = parts[p++];\r\n            if (len>0) appInFrame.unit = Number(parts[p++]);\r\n            if (len>1) appInFrame.page = parts[p++];\r\n            if (len>2) appInFrame.param = parts.slice(p++);\r\n        }\r\n    }\r\n    return appInFrame;\r\n}\r\n\r\nexport function getExHashPos():number {\r\n    let hash = document.location.hash;\r\n    if (hash !== undefined && hash.length > 0) {\r\n        let pos = hash.lastIndexOf('#tv-');\r\n        if (pos < 0) pos = hash.lastIndexOf('#tvdebug-');\r\n        return pos;\r\n    }\r\n    return -1;\r\n}\r\n\r\nexport function getExHash():string {\r\n    let pos = getExHashPos();\r\n    if (pos < 0) return undefined;\r\n    return document.location.hash.substring(pos);\r\n}\r\n\r\nexport function appUrl(url: string, unitId: number, page?:string, param?:any[]):{url:string; hash:string} {\r\n    let u:string;\r\n    for (;;) {\r\n        u = uid();\r\n        let a = appsInFrame[u];\r\n        if (a === undefined) {\r\n            appsInFrame[u] = {hash:u, unit:unitId};\r\n            break;\r\n        }\r\n    }\r\n    url += '#tv-' + u + '-' + unitId;\r\n    if (page !== undefined) {\r\n        url += '-' + page;\r\n        if (param !== undefined) {\r\n            for (let i=0; i<param.length; i++) {\r\n                url += '-' + param[i];\r\n            }\r\n        }\r\n    }\r\n    return {url: url, hash: u};\r\n}\r\n\r\nfunction getUnit():number {\r\n\tlet {unit, predefinedUnit} = appInFrame;\r\n    let realUnit = unit || predefinedUnit;\r\n    if (realUnit === undefined) {\r\n        throw new Error('no unit defined in unit.json or not logined in');\r\n\t}\r\n    return realUnit;\r\n}\r\n\r\ninterface UqTokenAction {\r\n    resolve: (value?: UqToken | PromiseLike<UqToken>) => void;\r\n    reject: (reason?: any) => void;\r\n}\r\nconst uqTokenActions:{[uq:string]: UqTokenAction} = {};\r\nexport async function buildAppUq(uq:string, uqOwner:string, uqName:string, appOwner:string, appName:string):Promise<void> {\r\n    if (!isBridged()) {\r\n        let unit = getUnit();\r\n        let uqToken = await uqTokenApi.uq({unit,  uqOwner, uqName, appOwner, appName});\r\n        if (uqToken.token === undefined) uqToken.token = centerToken;\r\n        let {db, url, urlTest} = uqToken;\r\n        let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n        console.log('realUrl: %s', realUrl);\r\n        uqToken.url = realUrl;\r\n        uqTokens[uq] = uqToken;\r\n        return uqToken;\r\n    }\r\n    console.log(\"**** before buildAppUq ****\", appInFrame);\r\n    let bp = uqTokenActions[uq];\r\n    if (bp !== undefined) return;\r\n    return new Promise<void>((resolve, reject) => {\r\n        uqTokenActions[uq] = {\r\n            resolve: async (at:any) => {\r\n                let {db, url, token} = await at;\r\n                uqTokens[uq] = {\r\n                    name: uq,\r\n                    db: db,\r\n                    url: url,\r\n                    token: token,\r\n                };\r\n                uqTokenActions[uq] = undefined;\r\n                console.log(\"**** after buildAppUq ****\", appInFrame);\r\n                resolve();\r\n            },\r\n            reject: reject,\r\n        };\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'app-api',\r\n            apiName: uq,\r\n            hash: appInFrame.hash,\r\n        }, \"*\");\r\n    });\r\n}\r\n\r\nexport function appUq(uq:string):UqToken {\r\n    let uts = uqTokens;\r\n    return uts[uq];\r\n}\r\n\r\ninterface BridgeCenterApi {\r\n    id: string;\r\n    resolve: (value?:any)=>any;\r\n    reject: (reason?:any)=>void;\r\n}\r\nconst brideCenterApis:{[id:string]: BridgeCenterApi} = {};\r\nexport async function bridgeCenterApi(url:string, method:string, body:any):Promise<any> {\r\n    console.log('bridgeCenterApi: url=%s, method=%s', url, method);\r\n    return await new Promise<any>(async (resolve, reject) => {\r\n        let callId:string;\r\n        for (;;) {\r\n            callId = uid();\r\n            let bca = brideCenterApis[callId];\r\n            if (bca === undefined) {\r\n                brideCenterApis[callId] = {\r\n                    id: callId,\r\n                    resolve: resolve,\r\n                    reject: reject,\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'center-api',\r\n            callId: callId,\r\n            url: url,\r\n            method: method,\r\n            body: body\r\n        }, '*');\r\n    });\r\n}\r\n\r\nasync function callCenterApiFromMessage(from:Window, message:any):Promise<void> {\r\n    let {callId, url, method, body} = message;\r\n    let result = await callCenterapi.directCall(url, method, body);\r\n    from.postMessage({\r\n        type: 'center-api-return',\r\n        callId: callId,\r\n        result: result,\r\n    }, '*');\r\n}\r\n\r\nfunction bridgeCenterApiReturn(message:any) {\r\n    let {callId, result} = message;\r\n    let bca = brideCenterApis[callId];\r\n    if (bca === undefined) return;\r\n    brideCenterApis[callId] = undefined;\r\n    bca.resolve(result);\r\n}\r\n","import { UqApi } from '../net';\r\nimport { LocalCache } from '../tool';\r\nimport { UqMan, Field, ArrFields, FieldMap } from './uqMan';\r\nimport { Tuid } from './tuid';\r\nimport { getObjPropIgnoreCase } from '../tool';\r\n\r\nconst tab = '\\t';\r\nconst ln = '\\n';\r\nconst chars = '\\\\ntbfvr';\r\nconst codeBackSlash = chars.charCodeAt(0);\r\nconst codeN = chars.charCodeAt(1);\r\nconst codeT = chars.charCodeAt(2);\r\nconst codeB = chars.charCodeAt(3);\r\nconst codeF = chars.charCodeAt(4);\r\nconst codeV = chars.charCodeAt(5);\r\nconst codeR = chars.charCodeAt(6);\r\n\r\nconst codes = '\\n\\t\\b\\f\\v\\r';\r\nconst codeBN = codes.charCodeAt(0);\r\nconst codeBT = codes.charCodeAt(1);\r\nconst codeBB = codes.charCodeAt(2);\r\nconst codeBF = codes.charCodeAt(3);\r\nconst codeBV = codes.charCodeAt(4);\r\nconst codeBR = codes.charCodeAt(5);\r\n\r\nexport abstract class Entity {\r\n    private jName: string;\r\n    schema: any;\r\n    ver: number = 0;\r\n    sys?: boolean;\r\n    readonly uq: UqMan;\r\n    readonly name: string;\r\n    readonly typeId: number;\r\n    readonly cache: LocalCache;\r\n    readonly uqApi: UqApi;\r\n    abstract get typeName(): string;\r\n    get sName():string {return this.jName || this.name}\r\n    fields: Field[];\r\n    arrFields: ArrFields[];\r\n    returns: ArrFields[];\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        this.uq = uq;\r\n        this.name = name;\r\n        this.typeId = typeId;\r\n        this.sys = this.name.indexOf('$') >= 0;\r\n        this.cache = this.uq.localMap.item(this.name); // new EntityCache(this);\r\n        this.uqApi = this.uq.uqApi;\r\n    }\r\n\r\n    public face: any;           // label, placeHolder\r\n\r\n    //getApiFrom() {return this.entities.uqApi;}\r\n\r\n    private fieldMaps: {[arr:string]: FieldMap} = {};\r\n    fieldMap(arr?:string): FieldMap {\r\n        if (arr === undefined) arr = '$';\r\n        let ret = this.fieldMaps[arr];\r\n        if (ret === undefined) {\r\n            let fields:Field[];\r\n            if (arr === '$') fields = this.fields;\r\n            else if (this.arrFields !== undefined) {\r\n                let arrFields = this.arrFields.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            else if (this.returns !== undefined) {\r\n                let arrFields = this.returns.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            if (fields === undefined) return {};\r\n            ret = {};\r\n            for (let f of fields) ret[f.name] = f;\r\n            this.fieldMaps[arr] = ret;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public async loadSchema():Promise<void> {\r\n        if (this.schema !== undefined) return;\r\n        let schema = this.cache.get();\r\n        if (!schema) {\r\n            schema = await this.uq.loadEntitySchema(this.name);\r\n        }\r\n        //this.setSchema(schema);\r\n\t\t//this.buildFieldsTuid();\r\n\t\tthis.buildSchema(schema);\r\n\t\tawait this.loadValues();\r\n\t}\r\n\r\n\tbuildSchema(schema: any) {\r\n        this.setSchema(schema);\r\n\t\tthis.buildFieldsTuid();\r\n\t\t//await this.loadValues();\r\n\t}\r\n\t\r\n\tprotected async loadValues():Promise<any> {}\r\n\r\n    // setSchemacacheclearSchema\r\n    public clearSchema() {\r\n        this.schema = undefined;\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        if (schema === undefined) return;\r\n        let {name, version} = schema;\r\n        this.ver = version || 0;\r\n\t\tthis.setJName(name);\r\n        this.cache.set(schema);\r\n\t\tthis.schema = schema;\r\n\t\tthis.buildFieldsTuid();\r\n\t}\r\n\t\r\n\tprotected setJName(name:string) {\r\n        if (name !== this.name) this.jName = name;\r\n\t}\r\n\r\n    public buildFieldsTuid() {\r\n        let {fields, arrs, returns} = this.schema;\r\n        this.uq.buildFieldTuid(this.fields = fields);\r\n        this.uq.buildArrFieldsTuid(this.arrFields = arrs, fields);\r\n        this.uq.buildArrFieldsTuid(this.returns = returns, fields);\r\n    }\r\n\r\n    schemaStringify():string {\r\n        return JSON.stringify(this.schema, (key:string, value:any) => {\r\n            if (key === '_tuid') return undefined;\r\n            return value;\r\n        }, 4);\r\n    }\r\n\r\n    tuidFromName(fieldName:string, arrName?:string):Tuid {\r\n        if (this.schema === undefined) return;\r\n        let {fields, arrs} = this.schema;\r\n        let entities = this.uq;\r\n        function getTuid(fn:string, fieldArr:Field[]) {\r\n            if (fieldArr === undefined) return;\r\n            let f = fieldArr.find(v => v.name === fn);\r\n            if (f === undefined) return;\r\n            return entities.getTuid(f.tuid);\r\n        }\r\n        let fn = fieldName.toLowerCase();\r\n        if (arrName === undefined) return getTuid(fn, fields);\r\n        if (arrs === undefined) return;\r\n        let an = arrName.toLowerCase();\r\n        let arr = (arrs as ArrFields[]).find(v => v.name === an);\r\n        if (arr === undefined) return;\r\n        return getTuid(fn, arr.fields);\r\n    }\r\n\r\n    buildParams(params:any):any {\r\n        let result:any = {};\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.buildFieldsParams(result, fields, params);\r\n        let arrs = this.arrFields;\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let {name, fields} = arr;\r\n                let paramsArr:any[] = params[name];\r\n                if (paramsArr === undefined) continue;\r\n                let arrResult:any[] = [];\r\n                result[name] = arrResult;\r\n                for (let pa of params) {\r\n                    let rowResult = {};\r\n                    this.buildFieldsParams(rowResult, fields, pa);\r\n                    arrResult.push(rowResult);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private buildFieldsParams(result:any, fields:Field[], params:any) {\r\n        for (let field of fields) {\r\n            let {name, type} = field;            \r\n            let d = params[name];\r\n            let val:any;\r\n            switch (type) {\r\n\t\t\t\tcase 'datetime':\r\n                \tval = this.buildDateTimeParam(d);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'date':\r\n\t\t\t\t\tif (d instanceof Date) {\r\n\t\t\t\t\t\tval = `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tval = d;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tswitch (typeof d) {\r\n\t\t\t\t\t\tdefault: val = d; break;\r\n\t\t\t\t\t\tcase 'object':\r\n\t\t\t\t\t\t\tif (d instanceof Date) {\r\n\t\t\t\t\t\t\t\tval = d;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlet tuid = field._tuid;\r\n\t\t\t\t\t\t\tif (tuid === undefined) val = d.id;\r\n\t\t\t\t\t\t\telse val = tuid.getIdFromObj(d);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n            }\r\n            result[name] = val;\r\n        }\r\n    }\r\n\r\n    buildDateTimeParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return undefined;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'string':\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        return Math.floor(dt.getTime()/1000);\r\n    }\r\n\r\n    buildDateParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return '';\r\n            case 'string': return val;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        let ret = dt.toISOString();\r\n        let p = ret.indexOf('T');\r\n        return p>0? ret.substr(0, p) : ret;\r\n    }\r\n\r\n    pack(data:any):string {\r\n        let ret:string[] = [];\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.packRow(ret, fields, data);\r\n        let arrs = this.arrFields; \r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n\t\t\t\tlet {name, fields} = arr;\r\n\t\t\t\tlet arrData = getObjPropIgnoreCase(data, name);\r\n\t\t\t\t//if (!arrData) arrData = data[name.toLowerCase()];\r\n                this.packArr(ret, fields, arrData);\r\n            }\r\n        }\r\n        return ret.join('');\r\n    }\r\n\r\n    private escape(row:any, field:Field):any {\r\n        let d = row[field.name];\r\n        switch (field.type) {\r\n            case 'datetime':\r\n                return this.buildDateTimeParam(d);\r\n            default:\r\n                switch (typeof d) {\r\n                    default: return d;\r\n                    case 'object':\r\n                        let tuid = field._tuid;\r\n                        if (tuid === undefined) return d.id;\r\n                        return tuid.getIdFromObj(d);\r\n                    case 'string':\r\n                        let len = d.length;\r\n                        let r = '', p = 0;\r\n                        for (let i=0;i<len;i++) {\r\n                            let c:number = d.charCodeAt(i), ch:string;\r\n                            switch(c) {\r\n\t\t\t\t\t\t\t\tdefault: continue;\r\n\t\t\t\t\t\t\t\tcase codeBackSlash: ch = '\\\\\\\\'; break;\r\n                                case codeBT: ch = '\\\\t'; break;\r\n\t\t\t\t\t\t\t\tcase codeBN: ch = '\\\\n'; break;\r\n\t\t\t\t\t\t\t\tcase codeBF: ch = '\\\\f'; break;\r\n\t\t\t\t\t\t\t\tcase codeBV: ch = '\\\\v'; break;\r\n\t\t\t\t\t\t\t\tcase codeBB: ch = '\\\\b'; break;\r\n\t\t\t\t\t\t\t\tcase codeBR: ch = '\\\\r'; break;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tr += d.substring(p, i) + ch;\r\n\t\t\t\t\t\t\tp = i+1;\r\n                        }\r\n                        return r + d.substring(p);\r\n                    case 'undefined': return '';\r\n                }\r\n        }\r\n    }\r\n\r\n    private packRow(result:string[], fields:Field[], data:any) {\r\n        let len = fields.length;\r\n        if (len === 0) return;\r\n        let ret = '';\r\n        ret += this.escape(data, fields[0]);\r\n        for (let i=1;i<len;i++) {\r\n            let f = fields[i];\r\n            ret += tab + this.escape(data, f);\r\n        }\r\n        result.push(ret + ln);\r\n    }\r\n\r\n    private packArr(result:string[], fields:Field[], data:any[]) {\r\n        if (data !== undefined) {\r\n\t\t\tif (data.length === 0) {\r\n\t\t\t\tresult.push(ln);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (let row of data) {\r\n\t\t\t\t\tthis.packRow(result, fields, row);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tresult.push(ln);\r\n\t\t}\r\n        result.push(ln);\r\n    }\r\n    protected cacheFieldsInValue(values:any, fields:Field[]) {\r\n        for (let f of fields as Field[]) {\r\n            let {name, _tuid} = f;\r\n            if (_tuid === undefined) continue;\r\n            let id = values[name];\r\n            //_tuid.useId(id);\r\n            values[name] = _tuid.boxId(id);\r\n        }\r\n    }\r\n\r\n    protected unpackTuidIdsOfFields(values:string[], fields: Field[]):any[] {\r\n        if (fields === undefined) return values as any[];\r\n        //if (this.fields === undefined) return values as any[];\r\n        let ret:any[] = []\r\n        for (let ln of values) {\r\n            if (!ln) continue;\r\n            let len = ln.length;\r\n            let p = 0;\r\n            while (p<len) {\r\n                let ch = ln.charCodeAt(p);\r\n                if (ch === 10) {\r\n                    ++p;\r\n                    break;\r\n                }\r\n                let row = {};\r\n                p = this.unpackRow(row, fields, ln, p);\r\n                ret.push(row);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    unpackSheet(data:string):any {\r\n        let ret = {} as any; //new this.newMain();\r\n        //if (schema === undefined || data === undefined) return;\r\n        let fields = this.fields;\r\n        let p = 0;\r\n        if (fields !== undefined) p = this.unpackRow(ret, fields, data, p);\r\n        let arrs = this.arrFields; //schema['arrs'];\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                p = this.unpackArr(ret, arr, data, p);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n\tunpackReturns(data:string, returns?:ArrFields[]):{[name:string]:any[]} {\r\n\t\tif (data === undefined) debugger;\r\n\t\tlet ret = {} as any;\r\n\t\tlet p = 0;\r\n\t\tlet arrs = returns || this.returns;\r\n\t\tif (arrs !== undefined) {\r\n\t\t\tfor (let arr of arrs) {\r\n\t\t\t\tp = this.unpackArr(ret, arr, data, p);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n    protected unpackRow(ret:any, fields:Field[], data:string, p:number):number {\r\n        let ch0 = 0, ch = 0, c = p, i = 0, len = data.length, fLen = fields.length;\r\n        for (;p<len;p++) {\r\n            ch0 = ch;\r\n            ch = data.charCodeAt(p);\r\n            if (ch === 9) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                c = p+1;\r\n                ++i;\r\n                if (i>=fLen) {\r\n                    p = data.indexOf('\\n', c);\r\n                    if (p >= 0) ++p;\r\n                    else p = len;\r\n                    return p;\r\n                }\r\n            }\r\n            else if (ch === 10) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                ++p;\r\n                ++i;\r\n                return p;\r\n            }\r\n        }\r\n        let f = fields[i];\r\n        let {name} = f;\r\n        if (ch0 !== 8) {\r\n            let v = data.substring(c);\r\n            ret[name] = this.to(ret, v, f);\r\n        }\r\n        return len;\r\n    }\r\n\r\n    private to(ret:any, v:string, f:Field):any {\r\n        switch (f.type) {\r\n\t\t\tdefault: return v;\r\n\t\t\tcase 'text':\r\n\t\t\tcase 'char':\r\n\t\t\t\treturn this.reverseNT(v);\r\n            case 'datetime':\r\n            case 'time':\r\n\t\t\tcase 'timestamp':\r\n                let n = Number(v);\r\n                let date = isNaN(n) === true? new Date(v) : new Date(n*1000);\r\n                return date;\r\n            case 'date':\r\n                let parts = v.split('-');\r\n                return new Date(Number(parts[0]), Number(parts[1])-1, Number(parts[2]));\r\n            case 'tinyint':\r\n            case 'smallint':\r\n            case 'int':\r\n            case 'bigint':\r\n            case 'dec':\r\n                return Number(v);\r\n            case 'id':\r\n                let id = Number(v);\r\n                let {_tuid} = f;\r\n                if (_tuid === undefined) return id;\r\n                return _tuid.boxId(id);\r\n        }\r\n\t}\r\n\t\r\n\tprivate reverseNT(text:string):string {\r\n\t\tif (text === undefined) return;\r\n\t\tif (text === null) return;\r\n\t\tlet len = text.length;\r\n\t\tlet r = '';\r\n\t\tlet p = 0;\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet c = text.charCodeAt(i);\r\n\t\t\tif (c === codeBackSlash) {\r\n\t\t\t\tif (i===len-1) break;\r\n\t\t\t\tlet c1 = text.charCodeAt(i+1);\r\n\t\t\t\tlet ch:string;\r\n\t\t\t\tswitch (c1) {\r\n\t\t\t\t\tdefault: continue;\r\n\t\t\t\t\tcase codeBackSlash: ch = '\\\\'; break;\r\n\t\t\t\t\tcase codeN: ch = '\\n'; break;\r\n\t\t\t\t\tcase codeT: ch = '\\t'; break;\r\n\t\t\t\t\tcase codeB: ch = '\\b'; break;\r\n\t\t\t\t\tcase codeF: ch = '\\f'; break;\r\n\t\t\t\t\tcase codeV: ch = '\\v'; break;\r\n\t\t\t\t\tcase codeR: ch = '\\r'; break;\r\n\t\t\t\t}\r\n\t\t\t\tr += text.substring(p, i) + ch;\r\n\t\t\t\tp = i+2;\r\n\t\t\t\t++i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tr += text.substring(p, len);\r\n\t\treturn r;\r\n\t}\r\n\r\n    private unpackArr(ret:any, arr:ArrFields, data:string, p:number):number {\r\n\t\tlet p0 = p;\r\n        let vals:any[] = [], len = data.length;\r\n        let {name, fields} = arr;\r\n        while (p<len) {\r\n            let ch = data.charCodeAt(p);\r\n            if (ch === 10) {\r\n\t\t\t\tif (p === p0) {\r\n\t\t\t\t\tch = data.charCodeAt(p);\r\n\t\t\t\t\tif (ch !== 10) {\r\n\t\t\t\t\t\tthrow new Error('upackArr: arr1010arr')\r\n\t\t\t\t\t}\r\n\t\t\t\t\t++p;\r\n\t\t\t\t}\r\n                ++p;\r\n                break;\r\n            }\r\n            let val = {} as any; //new creater();\r\n            vals.push(val);\r\n            p = this.unpackRow(val, fields, data, p);\r\n        }\r\n        ret[name] = vals;\r\n        return p;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { ItemSchema, UiItem, UiSelectBase } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { observable } from 'mobx';\r\nimport { FieldRule } from '../form/rules';\r\nimport { Image } from '../image';\r\nimport { Edit } from './edit';\r\n\r\nexport abstract class ItemEdit {\r\n\tprotected edit: Edit;\r\n\tprotected name: string;\r\n\tprotected _itemSchema: ItemSchema;\r\n    get itemSchema(): ItemSchema {return this._itemSchema}\r\n    protected _uiItem:UiItem;\r\n    get uiItem():UiItem {return this._uiItem}\r\n    value: any;\r\n\tlabel: string;\r\n\tget editInRow(): boolean {return false;}\r\n\r\n    @observable protected error: string;\r\n    @observable protected isChanged: boolean = false;\r\n    protected newValue: any;\r\n\r\n    constructor(edit:Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string, value: any) {\r\n\t\tthis.edit = edit;\r\n        this._itemSchema = itemSchema;\r\n        this._uiItem = uiItem\r\n        this.value = value;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this.label = label;\r\n\t}\r\n\t\r\n\tinit() {\t\t\r\n\t}\r\n\r\n    async start():Promise<any> {\r\n        return await this.internalStart();\r\n    }\r\n\r\n    protected abstract internalStart():Promise<any>;\r\n\r\n    async end():Promise<any> {\r\n        await this.internalEnd()\r\n    }\r\n\r\n\trenderContent() {\r\n        let {name, type} = this._itemSchema;\r\n        let divValue:any;\r\n        let uiItem = this._uiItem;\r\n        let label:string, labelHide:boolean;\r\n        if (uiItem === undefined) {\r\n            label = name;\r\n        }\r\n        else {\r\n\t\t\tlabel = uiItem.label;\r\n\t\t\tlabelHide = uiItem.labelHide;\r\n            let templet = uiItem.Templet;\r\n            if (templet !== undefined) {\r\n                if (typeof templet === 'function') {\r\n\t\t\t\t\tif (this.value !== undefined) divValue = templet(this.value);\r\n\t\t\t\t}\r\n                else {\r\n\t\t\t\t\tdivValue = {templet};\r\n\t\t\t\t}\r\n            }\r\n            else if (this.value !== undefined) {\r\n                switch (uiItem.widget) {\r\n                    case 'radio':\r\n                    case 'select':\r\n                        let {list} = uiItem as UiSelectBase;\r\n                        divValue = <b>{list.find(v => v.value === this.value).title}</b>;\r\n                        break;\r\n                    case 'id':\r\n                        divValue = <b>no templet for {name}={this.value}</b>\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        if (divValue === undefined) {\r\n            switch (type) {\r\n                default:\r\n                    divValue = this.value? \r\n\t\t\t\t\t\t<b>{this.value}</b> \r\n\t\t\t\t\t\t:\r\n\t\t\t\t\t\t<small className=\"text-muted\">[{labelHide===true? label:''}]</small>;\r\n                    break;\r\n                case 'image':\r\n                    divValue = <Image className=\"w-4c h-4c\" src={this.value} />;\r\n                    break;\r\n            }\r\n\t\t}\r\n\t\treturn divValue;\r\n\t}\r\n\r\n    protected async internalEnd():Promise<void> {nav.pop()}\r\n\r\n    protected verifyValue() {\r\n        if (this.uiItem === undefined) return;\r\n        let {rules} = this.uiItem;\r\n        if (rules === undefined) return;\r\n        let nv = this.newValue;\r\n        function verifyRule(rule:FieldRule, value: any):string {\r\n            let error = rule(nv);\r\n            if (error !== undefined) {\r\n                if (typeof error !== 'object')\r\n                    return error;\r\n                else\r\n                    return JSON.stringify(error);\r\n            }\r\n        }\r\n        if (Array.isArray(rules)) {\r\n            for (let rule of rules) {\r\n                let error = verifyRule(rule as FieldRule, nv);\r\n                if (error !== undefined) {\r\n                    this.error = error;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.error = verifyRule(rules as FieldRule, nv);\r\n        }\r\n    }\r\n}\r\n","//import _ from 'lodash';\r\nimport { Caller } from '../net';\r\nimport { Entity } from './entity';\r\nimport { Action } from './action';\r\nimport { Query } from './query';\r\n\r\ninterface UqResponseSchema {\r\n    uq: any;\r\n    entity: any;\r\n}\r\n\r\nexport abstract class EntityCaller<T> extends Caller<T> {\r\n    private tries: number;\r\n    protected _entity: Entity;\r\n\r\n    constructor(entity: Entity, params:T, waiting: boolean = true) {\r\n        super(params, waiting);\r\n        this.tries = 0;\r\n        this._entity = entity;\r\n    }\r\n\r\n    protected get entity(): Entity {return this._entity;}\r\n\r\n    //entityCaller\r\n    //buildParams() {return this.entity.buildParams(this.params);}\r\n    \r\n    async request(): Promise<any> {\r\n        await this.entity.loadSchema();\r\n        let ret = await this.innerRequest();\r\n        return ret;\r\n    }\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        return await this.entity.uqApi.xcall(this);\r\n    }\r\n\r\n    async innerRequest(): Promise<any> {\r\n        let jsonResult = await this.innerCall();\r\n        let {$uq, $modify, res} = jsonResult;\r\n        this.entity.uq.pullModify($modify);\r\n        if ($uq === undefined) {\r\n            //if (res === undefined) debugger;\r\n            let ret = this.xresult(res);\r\n            //if (ret === undefined) debugger;\r\n            return ret;\r\n        }\r\n        return await this.retry($uq);\r\n    }\r\n\r\n    xresult(res:any):any {return res}\r\n\r\n    get headers(): {[header:string]: string} {\r\n        let {ver, uq} = this.entity;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }\r\n\r\n    private async retry(schema: UqResponseSchema) {\r\n        ++this.tries;\r\n        if (this.tries > 5) throw new Error('can not get right uq response schema, 5 tries');\r\n        this.rebuildSchema(schema);\r\n        return await this.innerRequest();\r\n    }\r\n\r\n    private rebuildSchema(schema: UqResponseSchema) {\r\n        let {uq, entity} = schema;\r\n        if (uq !== undefined) {\r\n\t\t\tthis.entity.uq.buildEntities(uq);\r\n\t\t}\r\n        if (entity !== undefined) {\r\n\t\t\tthis.entity.setSchema(entity);\r\n\t\t}\r\n    }\r\n}\r\n\r\nexport abstract class ActionCaller extends EntityCaller<any> {\r\n    protected get entity(): Action {return this._entity as Action;}\r\n}\r\n\r\nexport class QueryQueryCaller extends EntityCaller<any> {\r\n    protected get entity(): Query {return this._entity as Query};\r\n    get path():string {return `query/${this.entity.name}`;}\r\n    xresult(res:any) {\r\n        let data = this.entity.unpackReturns(res);\r\n        return data;\r\n    }\r\n    buildParams() {return this.entity.buildParams(this.params);}\r\n}\r\n\r\nexport class QueryPageCaller extends EntityCaller<any> {\r\n    protected get params(): {pageStart:any; pageSize:number, params:any} {return this._params};\r\n\tprotected get entity(): Query {return this._entity as Query};\r\n\t//results: {[name:string]:any[]};\r\n\tget path():string {return `query-page/${this.entity.name}`;}\t\r\n    buildParams() {\r\n        let {pageStart, pageSize, params} = this.params;\r\n        let p:any;\r\n        if (params === undefined) {\r\n            p = {key: ''};\r\n        }\r\n        else {\r\n            p = this.entity.buildParams(params);\r\n        }\r\n        /*\r\n        switch (typeof params) {\r\n            case 'undefined': p = {key: ''}; break;\r\n            default: p = _.clone(params); break;\r\n        }\r\n        */\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        return p;\r\n    };\r\n    xresult(res:any): {[name:string]:any[]} {\r\n        let ret = this.entity.unpackReturns(res);\r\n\t\t//return this.results.$page;// as any[];\r\n\t\treturn ret;\r\n    }\r\n}\r\n","import {bridgeCenterApi, isBridged} from './appBridge';\r\nimport {FetchError} from './fetchError';\r\nimport {HttpChannelUI} from './httpChannelUI';\r\nimport {nav} from '../components/nav';\r\nimport { Caller } from './caller';\r\nimport { env } from '../tool';\r\n\r\n/*\r\nexport async function httpGet(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.get('', params);\r\n    return ret;\r\n}\r\n\r\nexport async function httpPost(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.post('', params);\r\n    return ret;\r\n}\r\n*/\r\n\r\nconst methodsWithBody = ['POST', 'PUT'];\r\n\r\nexport abstract class HttpChannel {\r\n    private timeout: number;\r\n    protected ui?: HttpChannelUI;\r\n    protected hostUrl: string;\r\n    protected apiToken: string;\r\n\r\n    constructor(hostUrl: string, apiToken:string, ui?: HttpChannelUI) {\r\n        this.hostUrl = hostUrl;\r\n        this.apiToken = apiToken;\r\n        this.ui = ui;\r\n        this.timeout = env.isDevelopment === true? 500000:50000;\r\n    }\r\n\r\n    private startWait = (waiting: boolean) => {\r\n        if (waiting === true) {\r\n            if (this.ui !== undefined) this.ui.startWait();\r\n        }\r\n    }\r\n\r\n    private endWait = (url?:string, reject?:(reason?:any)=>void) => {\r\n        if (this.ui !== undefined) this.ui.endWait();\r\n        if (reject !== undefined) reject('webapi ' + url);\r\n    }\r\n\r\n    private showError = async (error:FetchError) => {\r\n        if (this.ui !== undefined) await this.ui.showError(error);\r\n    }\r\n\r\n    used() {\r\n        this.post('', {});\r\n    }\r\n\r\n    async xcall(urlPrefix:string, caller:Caller<any>): Promise<void> {\r\n        let options = this.buildOptions();\r\n        let {headers, path, method} = caller;\r\n        if (headers !== undefined) {\r\n            let h = options.headers;\r\n            for (let i in headers) {\r\n\t\t\t\t//h.append(i, encodeURI(headers[i]));\r\n\t\t\t\th[i] = encodeURI(headers[i]);\r\n            }\r\n        }\r\n        options.method = method;\r\n        let p = caller.buildParams();\r\n        if (methodsWithBody.indexOf(method) >= 0 && p !== undefined) {\r\n            options.body = JSON.stringify(p)\r\n        }\r\n        return await this.innerFetch(urlPrefix + path, options, caller.waiting);\r\n    }\r\n\r\n    private async innerFetchResult(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let ret = await this.innerFetch(url, options, waiting);\r\n        return ret.res;\r\n    }\r\n\r\n    async get(url: string, params: any = undefined, waiting?: boolean): Promise<any> {\r\n        if (params) {\r\n            let keys = Object.keys(params);\r\n            if (keys.length > 0) {\r\n                let c = '?';\r\n                for (let k of keys) {\r\n                    let v = params[k];\r\n                    if (v === undefined) continue;\r\n                    url += c + k + '=' + params[k];\r\n                    c = '&';\r\n                }\r\n            }\r\n        }\r\n        let options = this.buildOptions();\r\n        options.method = 'GET';\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async post(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'POST';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async put(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'PUT';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async delete(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'DELETE';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n    async fetch(url: string, options: any, waiting: boolean, resolve:(value?:any)=>any, reject:(reason?:any)=>void):Promise<void> {\r\n        let that = this;\r\n        this.startWait(waiting);\r\n        let path = url;\r\n        function buildError(err: any, ex?: string) {\r\n            switch (typeof err) {\r\n                case 'string':\r\n                    if (ex !== undefined) err += ' ' + ex;\r\n                    break;\r\n                case 'object':\r\n                    let keys = Object.keys(err);\r\n                    let retErr:any = {\r\n                        ex: ex,\r\n                    };\r\n                    for (let key of keys) {\r\n                        retErr[key] = err[key];\r\n                    }\r\n                    err = retErr;\r\n                    break;\r\n            }\r\n            return {\r\n                channel: that,\r\n                url: path,\r\n                options: options,\r\n                resolve: resolve,\r\n                reject: reject,\r\n                error: err,\r\n            }\r\n        }\r\n        try {\r\n            console.log('%s-%s %s', options.method, path, options.body || '');\r\n            let now = Date.now();\r\n            let timeOutHandler = env.setTimeout(\r\n                undefined, //'httpChannel.fetch',\r\n                () => {\r\n                    that.endWait(url + ' timeout endWait: ' + (Date.now() - now) + 'ms', reject);\r\n                },\r\n                this.timeout);\r\n            let res = await fetch(encodeURI(path), options);\r\n            if (res.ok === false) {\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('ok false endWait');       \r\n                that.endWait();\r\n                console.log('call error %s', res.statusText);\r\n                throw res.statusText;\r\n            }\r\n            let ct = res.headers.get('content-type');\r\n            if (ct && ct.indexOf('json')>=0) {\r\n                return res.json().then(async retJson => {\r\n                    env.clearTimeout(timeOutHandler);\r\n                    that.endWait();\r\n                    if (retJson.ok === true) {\r\n                        if (typeof retJson !== 'object') {\r\n                            debugger;\r\n                        }\r\n                        else if (Array.isArray(retJson) === true) {\r\n                            debugger;\r\n                        }\r\n                        return resolve(retJson);\r\n                    }\r\n                    let retError = retJson.error;\r\n                    if (retError === undefined) {\r\n                        await that.showError(buildError('not valid tonva json'));\r\n                    }\r\n                    else {\r\n                        await that.showError(buildError(retError, 'retJson.error'));\r\n                        reject(retError);\r\n                    }\r\n                }).catch(async error => {\r\n                    await that.showError(buildError(error, 'catch res.json()'));\r\n                });\r\n            }\r\n            else {\r\n                let text = await res.text();\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('text endWait');\r\n                that.endWait();\r\n                resolve(text);\r\n            }\r\n        }\r\n        catch(error) {\r\n            this.endWait(url, reject);\r\n            if (typeof error === 'string') {\r\n                let err = error.toLowerCase();\r\n                if (err.startsWith('unauthorized') === true) {\r\n                    nav.logout();\r\n                    return;\r\n                }\r\n            }\r\n            console.error('fecth error (no nav.showError): ' + url);\r\n            // await this.showError(buildError(error, 'catch outmost'));\r\n        };\r\n    }\r\n\r\n    protected abstract innerFetch(url: string, options: any, waiting: boolean): Promise<any>;\r\n\r\n    async callFetch(url:string, method:string, body:any):Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = method;\r\n        options.body = body;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(url, options, true, resolve, reject);\r\n        });\r\n    }\r\n\r\n    //private buildOptions(): {method:string; headers:Headers; body:any} {\r\n\t\tprivate buildOptions(): {method:string; headers:{[name:string]: string}; body:any} {\r\n        let headers = this.buildHeaders();\r\n        let options = {\r\n            headers: headers,\r\n            method: undefined as any,\r\n            body: undefined as any,\r\n            // cache: 'no-cache',\r\n        };\r\n        return options;\r\n    }\r\n\r\n\t/*\r\n    protected buildHeaders():Headers {\r\n        let {language, culture} = nav;\r\n        let headers = new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        headers.append('Accept-Language', lang);\r\n        if (this.apiToken) { \r\n            headers.append('Authorization', this.apiToken); \r\n        }\r\n        return headers;\r\n\t}\r\n\t*/\r\n\tprotected buildHeaders():{[name:string]: string} { \r\n        let {language, culture} = nav;\r\n        let headers:{[name:string]: string} = {}; //new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n\t\t//headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n\t\theaders['Content-Type'] = 'application/json;charset=UTF-8';\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n\t\t//headers.append('Accept-Language', lang);\r\n\t\theaders['Accept-Language'] = lang;\r\n        if (this.apiToken) { \r\n\t\t\t//headers.append('Authorization', this.apiToken); \r\n\t\t\theaders['Authorization'] = this.apiToken;\r\n        }\r\n        return headers;\r\n\t}\r\n}\r\n\r\nexport class CenterHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        if (this.apiToken === undefined && isBridged())\r\n            return await bridgeCenterApi(u, options.method, options.body);\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n\r\nexport class UqHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n","import {nav} from '../components/nav';\r\nimport {FetchError} from './fetchError';\r\n\r\nexport interface HttpChannelUI {\r\n    startWait():void;\r\n    endWait():void;\r\n    showError(error:FetchError):Promise<void>;\r\n    showUpgradeUq(uq:string, version:number):Promise<void>;\r\n}\r\n\r\nexport class HttpChannelNavUI implements HttpChannelUI {\r\n    startWait() {\r\n        nav.startWait();\r\n    }\r\n    endWait() {\r\n        nav.endWait();\r\n    }\r\n    async showError(error:FetchError):Promise<void> {\r\n        nav.endWait();\r\n        /*\r\n        if (error.name === 'SyntaxError') {\r\n            error = {\r\n                name: error.name,\r\n                message: error.message,\r\n            }\r\n        }*/\r\n        await nav.onError(error);\r\n    }\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await nav.showUpgradeUq(uq, version);\r\n    }\r\n}\r\n\r\n","import _ from 'lodash';\r\nimport {HttpChannel, CenterHttpChannel, UqHttpChannel} from './httpChannel';\r\nimport {HttpChannelNavUI} from './httpChannelUI';\r\nimport {appUq, logoutUqTokens, buildAppUq} from './appBridge';\r\nimport {ApiBase} from './apiBase';\r\nimport { host } from './host';\r\nimport { LocalMap, env } from '../tool';\r\nimport {decodeUserToken} from '../tool/user';\r\n\r\ninterface PromiseValue<T> {\r\n\tresolve: (value?: T | PromiseLike<T>) => void;\r\n\treject: (reason?: any) => void;\r\n}\r\nlet channelUIs:{[name:string]: HttpChannel|(PromiseValue<any>[])} = {};\r\nlet channelNoUIs:{[name:string]: HttpChannel|(PromiseValue<any>[])} = {};\r\n\r\nexport function logoutApis() {\r\n    channelUIs = {};\r\n    channelNoUIs = {};\r\n    logoutUnitxApis();\r\n    logoutUqTokens();\r\n}\r\n\r\ninterface UqLocal {\r\n    user: number;\r\n    unit: number;\r\n    value: any;\r\n    tick?: number;\r\n    isNet?: boolean;\r\n}\r\n/*\r\ninterface UqLocals {\r\n    user: number;\r\n    unit: number;\r\n    uqs: {[uq:string]: UqLocal};\r\n}\r\n*/\r\n/*\r\nconst uqLocalEntities = 'uqLocalEntities';\r\nclass CacheUqLocals {\r\n    private local:UqLocals;\r\n\r\n    async loadAccess(uqApi: UqApi):Promise<any> {\r\n        try {\r\n            let {uqOwner, uqName} = uqApi;\r\n            if (this.local === undefined) {\r\n                let ls = null; // localStorage.getItem(uqLocalEntities);\r\n                if (ls !== null) {\r\n                    this.local = JSON.parse(ls);\r\n                }\r\n            }\r\n            if (this.local !== undefined) {\r\n                let {user, uqs} = this.local;\r\n                if (user !== loginedUserId || uqs === undefined) {\r\n                    this.local = undefined;\r\n                }\r\n                else {\r\n                    for (let i in uqs) {\r\n                        let ul = uqs[i];\r\n                        ul.isNet = undefined;\r\n                    }\r\n                }\r\n            }\r\n            if (this.local === undefined) {\r\n                this.local = {\r\n                    user: loginedUserId,\r\n                    unit: undefined,\r\n                    uqs: {}\r\n                };\r\n            }\r\n\r\n            let ret: any;\r\n            let un = uqOwner+'/'+uqName;\r\n            let uq = this.local.uqs[un];\r\n            if (uq !== undefined) {\r\n                let {value} = uq;\r\n                ret = value;\r\n            }\r\n            if (ret === undefined) {\r\n                ret = await uqApi.__loadAccess();\r\n                //this.saveLocal(un, ret);\r\n            }\r\n            return _.cloneDeep(ret);\r\n        }\r\n        catch (err) {\r\n            this.local = undefined;\r\n            localStorage.removeItem(uqLocalEntities);\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    private saveLocal(uqName:string, accessValue: any) {\r\n        this.local.uqs[uqName] = {\r\n            value: accessValue,\r\n            isNet: true,\r\n        }\r\n        let str = JSON.stringify(this.local);\r\n        localStorage.setItem(uqLocalEntities, str);\r\n    }\r\n\r\n    async checkAccess(uqApi: UqApi):Promise<boolean> {\r\n        if (this.local === undefined) return false;\r\n        let {uqOwner, uqName} = uqApi;\r\n        let un = uqOwner+'/'+uqName;\r\n        let uq = this.local.uqs[un];\r\n        if (uq === undefined) return false;\r\n        let {isNet, value} = uq;\r\n        if (isNet === true) return true;\r\n        let ret = await uqApi.__loadAccess();\r\n        let isMatch = _.isMatch(value, ret);\r\n        if (isMatch === false) {\r\n            this.saveLocal(un, ret);\r\n            return false;\r\n        }\r\n        uq.isNet = true;\r\n        return true;\r\n    }\r\n}\r\n\r\nconst localUqs = new CacheUqLocals;\r\n*/\r\nexport class UqApi extends ApiBase {\r\n    private access:string[];\r\n    appOwner:string;\r\n    appName:string;\r\n    uqOwner: string;\r\n    uqName: string;\r\n    uq: string;\r\n\r\n    constructor(basePath:string, appOwner:string, appName:string, uqOwner:string, uqName:string, access:string[], showWaiting?: boolean) {\r\n        super(basePath, showWaiting);\r\n        this.appOwner = appOwner;\r\n        this.appName = appName;\r\n        if (uqName) {\r\n            this.uqOwner = uqOwner;\r\n            this.uqName = uqName;\r\n            this.uq = uqOwner + '/' + uqName;\r\n        }\r\n        this.access = access;\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    //setUqVersion(uqVersion:number) {this.uqVersion = undefined}\r\n\r\n    async init() {\r\n        await buildAppUq(this.uq, this.uqOwner, this.uqName, this.appOwner, this.appName);\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channels: {[name:string]: HttpChannel|(PromiseValue<any>[])};\r\n        let channelUI: HttpChannelNavUI;\r\n        if (this.showWaiting === true || this.showWaiting === undefined) {\r\n            channels = channelUIs;\r\n            channelUI = new HttpChannelNavUI();\r\n        }\r\n        else {\r\n            channels = channelNoUIs;\r\n        }\r\n        let channel = channels[this.uq];\r\n\t\tif (channel !== undefined) {\r\n\t\t\tif (Array.isArray(channel) === false) return channel as HttpChannel;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tchannel = channels[this.uq] = [];\r\n\t\t}\r\n\t\tlet arr = channel as PromiseValue<any>[];\r\n\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\tarr.push({resolve, reject});\r\n\t\t\tif (arr.length !== 1) return;\r\n\t\t\tlet uqToken = appUq(this.uq); //, this.uqOwner, this.uqName);\r\n\t\t\tif (!uqToken) {\r\n\t\t\t\t//debugger;\r\n\t\t\t\tawait this.init();\r\n\t\t\t\tuqToken = appUq(this.uq);\r\n\t\t\t}\r\n\t\t\tlet {url, token} = uqToken;\r\n\t\t\tthis.token = token;\r\n\t\t\tchannel = new UqHttpChannel(url, token, channelUI);\r\n\t\t\tchannels[this.uq] = channel;\r\n\t\t\tfor (let pv of arr) {\r\n\t\t\t\tpv.resolve(channel);\r\n\t\t\t}\r\n\r\n\t\t});\r\n    }\r\n\r\n    /*async update():Promise<string> {\r\n        return await this.get('update');\r\n    }*/\r\n\r\n    /*\r\n    async __loadAccess():Promise<any> {\r\n        let acc = this.access === undefined?\r\n            '' :\r\n            this.access.join('|');\r\n        let ret = await this.get('access', {acc:acc});\r\n        return ret;\r\n    }\r\n    */\r\n    async loadAccess():Promise<any> {\r\n        //return await localUqs.loadAccess(this);\r\n        let acc = this.access === undefined?\r\n            '' :\r\n            this.access.join('|');\r\n        let ret = await this.get('access', {acc:acc});\r\n        return ret;\r\n    }\r\n\r\n    /*async loadEntities():Promise<any> {\r\n        return await this.get('entities');\r\n    }*/\r\n\r\n    /*\r\n    async checkAccess():Promise<boolean> {\r\n        return await localUqs.checkAccess(this);\r\n    }\r\n    */\r\n\r\n\tasync allSchemas(): Promise<any> {\r\n\t\treturn await this.get('all-schemas');\r\n\t}\r\n\r\n    async schema(name:string):Promise<any> {\r\n        return await this.get('schema/' + name);\r\n    }\r\n\r\n    async queueModify(start:number, page:number, entities:string) {\r\n        return await this.post('queue-modify', {start:start, page:page, entities:entities});\r\n    }\r\n\r\n    /*async schemas(names:string[]):Promise<any[]> {\r\n        return await this.post('schema', names);\r\n    }*/\r\n\r\n    /*\r\n    async tuidGet(name:string, id:number):Promise<any> {\r\n        return await this.get('tuid/' + name + '/' + id);\r\n    }\r\n\r\n    async tuidGetAll(name:string):Promise<any[]> {\r\n        return await this.get('tuid-all/' + name + '/');\r\n    }\r\n\r\n    async tuidSave(name:string, params:any):Promise<any> {\r\n        return await this.post('tuid/' + name, params);\r\n    }\r\n\r\n    async tuidSearch(name:string, arr:string, owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        let ret = await this.post('tuids/' + name, {\r\n            arr: arr,\r\n            owner: owner,\r\n            key: key,\r\n            pageStart: pageStart,\r\n            pageSize: pageSize\r\n        });\r\n        return ret;\r\n    }\r\n    async tuidArrGet(name:string, arr:string, owner:number, id:number):Promise<any> {\r\n        return await this.get('tuid-arr/' + name + '/' + owner + '/' + arr + '/' + id);\r\n    }\r\n    async tuidArrGetAll(name:string, arr:string, owner:number):Promise<any[]> {\r\n        return await this.get('tuid-arr-all/' + name + '/' + owner + '/' + arr + '/');\r\n    }\r\n    async tuidArrSave(name:string, arr:string, owner:number, params:any):Promise<any> {\r\n        return await this.post('tuid-arr/' + name + '/' + owner + '/' + arr + '/', params);\r\n    }\r\n    async tuidArrPos(name:string, arr:string, owner:number, id:number, order:number):Promise<any> {\r\n        return await this.post('tuid-arr-pos/' + name + '/' + owner + '/' + arr + '/', {\r\n            id: id,\r\n            $order: order\r\n        });\r\n    }\r\n\r\n    async tuidIds(name:string, arr:string, ids:number[]):Promise<any[]> {\r\n        try {\r\n            let url = 'tuidids/' + name + '/';\r\n            if (arr !== undefined) url += arr;\r\n            else url += '$';\r\n            let ret = await this.post(url, ids);\r\n            return ret;\r\n        }\r\n        catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n    */\r\n    /*async sheetSave(name:string, data:object):Promise<any> {\r\n        return await this.post('sheet/' + name, data);\r\n    }*/\r\n\r\n    /*async sheetAction(name:string, data:object) {\r\n        return await this.put('sheet/' + name, data);\r\n    }*/\r\n\r\n    /*async stateSheets(name:string, data:object) {\r\n        return await this.post('sheet/' + name + '/states', data);\r\n    }*/\r\n\r\n    /*async stateSheetCount(name:string):Promise<any> {\r\n        return await this.get('sheet/' + name + '/statecount');\r\n    }*/\r\n\r\n    /*async mySheets(name:string, data:object) {\r\n        return await this.post('sheet/' + name + '/my-sheets', data);\r\n    }*/\r\n\r\n    /*async getSheet(name:string, id:number):Promise<any> {\r\n        return await this.get('sheet/' + name + '/get/' + id);\r\n    }*/\r\n\r\n    /*async sheetArchives(name:string, data:object):Promise<any> {\r\n        return await this.post('sheet/' + name + '/archives', data);\r\n    }\r\n\r\n    async sheetArchive(name:string, id:number):Promise<any> {\r\n        return await this.get('sheet/' + name + '/archive/' + id);\r\n    }*/\r\n\r\n    /*async action(name:string, data:object):Promise<any> {\r\n        return await this.post('action/' + name, data);\r\n    }\r\n\r\n    async actionReturns(name:string, data:object):Promise<any[][]> {\r\n        return await this.post('action/' + name + '/returns', data);\r\n    }\r\n\r\n    async page(name:string, pageStart:any, pageSize:number, params:any):Promise<string> {\r\n        let p:any;\r\n        switch (typeof params) {\r\n            case 'undefined': p = {key: ''}; break;\r\n            default: p = _.clone(params); break;\r\n        }\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        return await this.post('query-page/' + name, p);\r\n    }\r\n\r\n    async query(name:string, params:any):Promise<any> {\r\n        let ret = await this.post('query/' + name, params);\r\n        return ret;\r\n    }\r\n    */\r\n/*\r\n    async history(name:string, pageStart:any, pageSize:number, params:any):Promise<string> {\r\n        let p = _.clone(params);\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        let ret = await this.post('history/' + name, p);\r\n        return ret;\r\n    }\r\n\r\n    async book(name:string, pageStart:any, pageSize:number, params:any):Promise<string> {\r\n        let p = _.clone(params);\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        let ret = await this.post('history/' + name, p);\r\n        return ret;\r\n    }\r\n*/\r\n    /*async user():Promise<any> {\r\n        return await this.get('user');\r\n    }*/\r\n}\r\n\r\nlet channels:{[unitId:number]: HttpChannel} = {};\r\n\r\nexport function logoutUnitxApis() {\r\n    channels = {};\r\n}\r\n\r\nexport class UnitxApi extends UqApi {\r\n    private unitId:number;\r\n    constructor(unitId:number) {\r\n        super('tv/', undefined, undefined, undefined, undefined, undefined, true);\r\n        this.unitId = unitId;\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channel = channels[this.unitId];\r\n        if (channel !== undefined) return channel;\r\n        return channels[this.unitId] = await this.buildChannel();\r\n    }\r\n\r\n    private async buildChannel():Promise<HttpChannel> {\r\n        let channelUI = new HttpChannelNavUI();\r\n        let centerAppApi = new CenterAppApi('tv/', undefined);\r\n        let ret = await centerAppApi.unitxUq(this.unitId);\r\n        let {token, db, url, urlTest} = ret;\r\n        let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n        this.token = token;\r\n        return new UqHttpChannel(realUrl, token, channelUI);\r\n    }\r\n}\r\n\r\nlet centerHost:string;\r\n\r\nexport function setCenterUrl(url:string) {\r\n    console.log('setCenterUrl %s', url);\r\n    centerHost = url;\r\n    //centerToken = undefined;\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nexport let centerToken:string|undefined = undefined;\r\n\r\nlet loginedUserId:number = 0;\r\nexport function setCenterToken(userId:number, t?:string) {\r\n    loginedUserId = userId;\r\n    centerToken = t;\r\n    console.log('setCenterToken %s', t);\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nlet centerChannelUI:HttpChannel;\r\nlet centerChannel:HttpChannel;\r\nfunction getCenterChannelUI():HttpChannel {\r\n    if (centerChannelUI !== undefined) return centerChannelUI;\r\n    return centerChannelUI = new CenterHttpChannel(centerHost, centerToken, new HttpChannelNavUI());\r\n}\r\nfunction getCenterChannel():HttpChannel {\r\n    if (centerChannel !== undefined) return centerChannel;\r\n    return centerChannel = new CenterHttpChannel(centerHost, centerToken);\r\n}\r\n\r\nexport abstract class CenterApiBase extends ApiBase {\r\n    /*\r\n    constructor(path: string, showWaiting?: boolean) {\r\n        super(path, showWaiting);\r\n    }*/\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        return (this.showWaiting === true || this.showWaiting === undefined)?\r\n            getCenterChannelUI():\r\n            getCenterChannel();\r\n    }\r\n}\r\n\r\nconst uqTokensName = 'uqTokens';\r\nexport class UqTokenApi extends CenterApiBase {\r\n    private localMap: LocalMap = env.localDb.map(uqTokensName);\r\n\r\n    async uq(params: {unit:number, uqOwner:string, uqName:string, appOwner:string, appName:string}):Promise<any> {\r\n        let {uqOwner, uqName} = params;\r\n        let un = uqOwner+'/'+uqName;\r\n        let localCache = this.localMap.child(un);\r\n        try {\r\n            let uqToken:UqLocal = localCache.get();\r\n            if (uqToken !== undefined) {\r\n                let {unit, user} = uqToken;\r\n                if (unit !== params.unit || user !== loginedUserId) {\r\n                    localCache.remove();\r\n                    uqToken = undefined;\r\n                }\r\n            }\r\n            let nowTick = Math.floor(Date.now() / 1000);\r\n            if (uqToken !== undefined) {\r\n                let {tick, value} = uqToken;\r\n                if (value !== undefined && (nowTick - tick) < 24*3600) {\r\n                    return _.clone(value);\r\n                }\r\n            }\r\n            let appUqParams:any = _.clone(params);\r\n            appUqParams.testing = host.testing;\r\n            let ret = await this.get('app-uq', appUqParams);\r\n            if (ret === undefined) {\r\n                let {unit, uqOwner, uqName} = params;\r\n                let err = `center get app-uq(unit=${unit}, '${uqOwner}/${uqName}') - not exists or no unit-service`;\r\n                throw err;\r\n            }\r\n\r\n            uqToken = {\r\n                unit: params.unit,\r\n                user: loginedUserId,\r\n                tick: nowTick,\r\n                value: ret,\r\n            }\r\n            localCache.set(uqToken);\r\n            return _.clone(ret);\r\n        }\r\n        catch (err) {\r\n            localCache.remove();\r\n            throw err;\r\n        }\r\n    }\r\n}\r\n\r\nexport const uqTokenApi = new UqTokenApi('tv/tie/', undefined);\r\n\r\nexport class CallCenterApi extends CenterApiBase {\r\n    directCall(url:string, method:string, body:any):Promise<any> {\r\n        return this.call(url, method, body);\r\n    }\r\n}\r\nexport const callCenterapi = new CallCenterApi('', undefined);\r\n\r\nexport interface UqAppData {\r\n    appName: string;\r\n    appOwner: string;\r\n    id: number;\r\n    version: string;        // AppUI version\r\n    uqs: UqData[];\r\n}\r\n\r\nexport interface UqData {\r\n    id: number;\r\n    uqOwner: string;\r\n    uqName: string;\r\n    access: string;\r\n    newVersion: boolean;\r\n}\r\n\r\nexport interface UqServiceData {\r\n    id: number;\r\n    db: string;\r\n    url: string;\r\n    urlTest: string;\r\n    token: string;\r\n}\r\n\r\n//const appUqsName = 'appUqs';\r\n\r\nexport class CenterAppApi extends CenterApiBase {\r\n    //private local: LocalCache = env.localDb.item(appUqsName);\r\n    //private cachedUqs: UqAppData;\r\n    async uqs(appOwner:string, appName:string):Promise<UqAppData> {\r\n        let ret:UqAppData = await this.get('tie/app-uqs', {appOwner:appOwner, appName:appName});\r\n        return ret;\r\n        /*\r\n        let ret:UqAppData;\r\n        let appUqs = this.local.get();\r\n        if (appUqs) {\r\n            let {appOwner:rAppOwner, appName:rAppName} = appUqs;\r\n            if (appOwner === rAppOwner && appName === rAppName) ret = appUqs;\r\n        }\r\n        if (ret === undefined) {\r\n            ret = await this.uqsPure(appOwner, appName);\r\n            ret.appName = appName;\r\n            ret.appOwner = appOwner;\r\n            //localStorage.setItem(JSON.stringify(obj));\r\n            this.local.set(ret);\r\n        }\r\n        //return this.cachedUqs = _.cloneDeep(ret);\r\n        return ret;\r\n        */\r\n    }\r\n    private async uqsPure(appOwner:string, appName:string):Promise<UqAppData> {\r\n        return await this.get('tie/app-uqs', {appOwner:appOwner, appName:appName});\r\n    }\r\n    /*\r\n    private async isOkCheckUqs(appOwner:string, appName:string):Promise<boolean> {\r\n        let ret = await this.uqsPure(appOwner, appName);\r\n        let {id:cachedId, uqs:cachedUqs} = this.local.get(); //.cachedUqs;\r\n        let {id:retId, uqs:retUqs} = ret;\r\n        if (cachedId !== retId) return false;\r\n        if (cachedUqs.length !== retUqs.length) return false;\r\n        let len = cachedUqs.length;\r\n        for (let i=0; i<len; i++) {\r\n            if (_.isMatch(cachedUqs[i], retUqs[i]) === false) return false;\r\n        }\r\n        return true;\r\n    }\r\n    async checkUqs(appOwner:string, appName:string):Promise<boolean> {\r\n        let ret = await this.isOkCheckUqs(appOwner, appName);\r\n        if (ret === false) {\r\n            this.local.remove();\r\n            nav.start();\r\n        }\r\n        return ret;\r\n    }\r\n    */\r\n    async unitxUq(unit:number):Promise<UqServiceData> {\r\n        return await this.get('tie/unitx-uq', {unit:unit});\r\n    }\r\n    async changePassword(param: {orgPassword:string, newPassword:string}) {\r\n        return await this.post('tie/change-password', param);\r\n    }\r\n}\r\n\r\nexport async function loadAppUqs(appOwner:string, appName:string): Promise<UqAppData> {\r\n    let centerAppApi = new CenterAppApi('tv/', undefined);\r\n    //let unit = meInFrame.unit;\r\n    let ret = await centerAppApi.uqs(appOwner, appName);\r\n    //await centerAppApi.checkUqs(appOwner, appName);\r\n    /*\r\n    .then(v => {\r\n        if (v === false) {\r\n            localStorage.removeItem(appUqs);\r\n            nav.start();\r\n        }\r\n    });\r\n    */\r\n    return ret;\r\n}\r\n\r\n//import { nav } from '../ui';\r\n\r\nexport interface RegisterParameter {\r\n    nick:string, \r\n    user:string, \r\n    pwd:string,\r\n    country:number, \r\n    mobile:number, \r\n    mobileCountry:number,\r\n    email:string,\r\n    verify:string,\r\n};\r\n\r\nexport class UserApi extends CenterApiBase {\r\n    async login(params: {user: string, pwd: string, guest: number}): Promise<any> {\r\n        //(params as any).device = nav.local.device.get();\r\n        let ret = await this.get('user/login', params);\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeUserToken(ret);\r\n            case 'object':\r\n                let token = ret.token;\r\n                let user = decodeUserToken(token);\r\n                let {nick, icon} = ret;\r\n                if (nick) user.nick = nick;\r\n                if (icon) user.icon = icon;\r\n                return user;\r\n        }\r\n        // !== undefined) return decodeToken(token);\r\n    }\r\n    async register(params: RegisterParameter): Promise<any>\r\n    {\r\n        return await this.post('user/register', params);\r\n    }\r\n\r\n    async sendVerify(account:string, type:'mobile'|'email', oem:string) {\r\n        return await this.post('user/set-verify', {account:account, type:type, oem:oem});\r\n    }\r\n\r\n    async checkVerify(account:string, verify:string) {\r\n        return await this.post('user/check-verify', {account:account, verify:verify});\r\n    }\r\n\r\n    async isExists(account:string) {\r\n        return await this.get('user/is-exists', {account:account});\r\n    }\r\n\r\n    async resetPassword(account:string, password:string, verify:string, type:'mobile'|'email'):Promise<any[]> {\r\n        return await this.post('user/reset-password', {account:account, password, verify, type});\r\n    }\r\n    \r\n    async userSetProp(prop:string, value:any) {\r\n        await this.post('tie/user-set-prop', {prop:prop, value:value});\r\n    }\r\n\r\n    async me():Promise<any> {\r\n        return await this.get('tie/me');\r\n    }\r\n\r\n    async user(id:number): Promise<any> {\r\n        return await this.get('tie/user', {id:id});\r\n\t}\r\n\t\r\n\tasync fromKey(key:string): Promise<{id:number, name:string, nick:string, icon:string}> {\r\n\t\treturn await this.get('tie/user-from-key', {key});\r\n\t}\r\n}\r\n\r\nexport const userApi = new UserApi('tv/', undefined);\r\n","export * from './uqMan';\r\nexport * from './entity';\r\nexport * from './action';\r\nexport * from './query';\r\nexport * from './sheet';\r\nexport * from './tuid';\r\nexport * from './book';\r\nexport * from './map';\r\nexport * from './history';\r\nexport * from './pending';\r\nexport * from './uqsMan';\r\nexport * from './tag/tag';\r\nexport * from './enum';\r\nexport * from './buildUqApp';\r\n","import _ from 'lodash';\r\n\r\nexport interface KeyValueRes {\r\n    [key:string]: any;\r\n}\r\n\r\nexport interface Res<T extends KeyValueRes> {\r\n    [lang:string]: T | {[district:string]: T};\r\n}\r\n\r\nexport const resOptions:{\r\n\tlang: string;\r\n\t$lang: string;\r\n\tdistrict: string;\r\n\t$district: string;\r\n} = {\r\n\tlang: undefined,\r\n\t$lang: undefined,\r\n\tdistrict: undefined,\r\n\t$district: undefined,\r\n}\r\n\r\nexport function setResOptions(lang:string, district:string) {\r\n\tresOptions.lang = lang;\r\n\tresOptions.$lang = '$' + lang;\r\n    resOptions.district = district;\r\n    resOptions.$district = '$' + district;\r\n}\r\n\r\n(function() {\r\n    let lang: string, district: string;\r\n    let language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\r\n        || navigator.language; // ||   // All browsers\r\n    //navigator.userLanguage; // IE <= 10\r\n    if (!language) {\r\n        lang = 'zh';\r\n        district = 'CN';\r\n    }\r\n    else {\r\n        let parts = language.split('-');\r\n        lang = parts[0];\r\n        if (parts.length > 1) district = parts[1].toUpperCase();\r\n    }\r\n    setResOptions(lang, district);\r\n}());\r\n\r\nexport function resLang<T extends KeyValueRes>(res:Res<T>):T {\r\n    let {lang, district} = resOptions;\r\n    let ret:T = {} as T;\r\n    if (res === undefined) return ret;\r\n    _.merge(ret, res._);\r\n    let l = res[lang];\r\n    if (l === undefined) return ret;\r\n    _.merge(ret, l._);\r\n    let d = l[district];\r\n    if (d === undefined) return ret;\r\n    _.merge(ret, d);\r\n    let {entity} = ret;\r\n    if (entity !== undefined) {\r\n        for (let i in entity) {\r\n            entity[i.toLowerCase()] = entity[i];\r\n        }\r\n    }\r\n    return ret;\r\n}\r\n\r\nconst resGlobal:any = {};\r\nexport function setRes(target: any, res: any):(str:string)=>any {\r\n\tif (res === undefined) return;\r\n\tlet {$lang, $district} = resOptions;\r\n\t_.merge(target, res);\r\n\tif ($lang !== undefined) {\r\n\t\tlet l = res[$lang];\r\n\t\tif (l !== undefined) {\r\n\t\t\t_.merge(target, l);\r\n\t\t\tlet d = l[$district];\r\n\t\t\tif (d !== undefined) {\r\n\t\t\t\t_.merge(target, d);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn function(str:string) {\r\n\t\treturn target[str] || str;\r\n\t}\r\n}\r\nexport function setGlobalRes(res: any) {\r\n\tsetRes(resGlobal, res);\r\n}\r\nexport function t(str:string):any {\r\n\treturn resGlobal[str] || str;\r\n}\r\n","const ALPHABET = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\nconst ID_LENGTH = 8;\r\n\r\nexport function uid():string {\r\n    let len = ALPHABET.length;\r\n    let rtn = '';\r\n    for (let i = 0; i < ID_LENGTH; i++) {\r\n        rtn += ALPHABET.charAt(Math.floor(Math.random() * len));\r\n    }\r\n    return rtn;\r\n}\r\n","import _ from 'lodash';\r\nimport {observable, IObservableArray} from 'mobx';\r\nimport { PageItems } from '../tool';\r\nimport {Field, ArrFields} from './uqMan';\r\nimport {Entity} from './entity';\r\nimport { QueryQueryCaller, QueryPageCaller } from './caller';\r\n\r\nexport type QueryPageApi = (name:string, pageStart:any, pageSize:number, params:any) => Promise<string>;\r\n\r\nexport class QueryPager<T extends any> extends PageItems<T> {\r\n\tprivate query: Query;\r\n\tprivate $page: any;\r\n\tprotected idFieldName: any;\r\n    constructor(query: Query, pageSize?: number, firstSize?: number, itemObservable?:boolean) {\r\n        super(itemObservable);\r\n        this.query = query;\r\n        if (pageSize !== undefined) this.pageSize = pageSize;\r\n\t\tif (firstSize !== undefined) this.firstSize = firstSize;\r\n\t}\r\n\r\n\tsetReverse() {\r\n\t\tthis.appendPosition = 'head';\r\n\t}\r\n\r\n    protected async onLoad() {\r\n\t\tif (this.$page) return;\r\n        let {schema} = this.query;\r\n        if (schema === undefined) {\r\n\t\t\tawait this.query.loadSchema();\r\n\t\t\tschema = this.query.schema;\r\n\t\t}\r\n\t\tif (schema === undefined) return;\r\n\t\tlet $page = this.$page = (schema.returns as any[]).find(v => v.name === '$page');\r\n\t\tif ($page === undefined) return;\r\n\t\tthis.sortOrder = $page.order;\r\n\t\tlet fields = $page.fields;\r\n\t\tif (fields !== undefined) {\r\n\t\t\tlet field = fields[0];\r\n\t\t\tif (field) this.idFieldName = field.name;\r\n\t\t}\r\n    }\r\n\r\n    protected async loadResults(param:any, pageStart:number, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.query.page(param, pageStart, pageSize);\r\n\t\treturn ret;\r\n\t}\r\n\tprotected getPageId(item:T) {\r\n\t\tif (item === undefined) return;\r\n\t\tif (typeof item === 'number') return item;\r\n\t\tlet start = (item as any)[this.idFieldName];\r\n\t\tif (start === null) return;\r\n\t\tif (start === undefined) return;\r\n\t\tif (typeof start === 'object') {\r\n\t\t\tlet id = start.id;\r\n\t\t\tif (id !== undefined) return id;\r\n\t\t}\r\n\t\treturn start;\r\n\t}\r\n\tasync refreshItems(item:T) {\r\n\t\tlet index = this._items.indexOf(item);\r\n\t\tif (index < 0) return;\r\n\t\tlet startIndex:number;\r\n\t\tif (this.appendPosition === 'tail') {\r\n\t\t\tstartIndex = index - 1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstartIndex = index + 1;\r\n\t\t}\r\n\t\tlet pageStart = this.getPageId(this._items[startIndex]);\r\n\t\tlet pageSize = 1;\r\n        let ret = await this.load(\r\n\t\t\tthis.param, \r\n\t\t\tpageStart,\r\n\t\t\tpageSize);\r\n\t\tlet len = ret.length;\r\n\t\tif (len === 0) {\r\n\t\t\tthis._items.splice(index, 1);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet newItem = ret[i];\r\n\t\t\tif (!newItem) continue;\r\n\t\t\tlet newId = newItem[this.idFieldName];\r\n\t\t\tif (newId === undefined || newId === null) continue;\r\n\t\t\tif (typeof newId === 'object') newId = newId.id;\r\n\t\t\tlet oldItem = this._items.find(v => {\r\n\t\t\t\tlet oldId = (v as any)[this.idFieldName];\r\n\t\t\t\tif (oldId === undefined || oldId === null) return false;\r\n\t\t\t\tif (typeof oldId === 'object') oldId = oldId.id;\r\n\t\t\t\treturn oldId = newId;\r\n\t\t\t});\r\n\t\t\tif (oldItem) {\r\n\t\t\t\t_.merge(oldItem, newItem);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class UqQuery<P, R> extends Entity {\r\n    get typeName(): string { return 'query';}\r\n    private pageStart: any;\r\n    private pageSize:number;\r\n    private params:any;\r\n    private more: boolean;\r\n    private startField: Field;\r\n    @observable list:IObservableArray; // = observable.array([], {deep: false});\r\n    returns: ArrFields[];\r\n    isPaged: boolean;\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {returns} = schema;\r\n        //this.returns = returns;\r\n        this.isPaged = returns && (returns as any[]).find(v => v.name === '$page') !== undefined;\r\n    }\r\n\r\n    resetPage(size:number, params:any) {\r\n        this.pageStart = undefined;\r\n        this.pageSize = size;\r\n        this.params = params;\r\n        this.more = false;\r\n        this.list = undefined;\r\n    }\r\n    get hasMore() {return this.more;}\r\n    async loadPage():Promise<void> {\r\n        if (this.pageSize === undefined) {\r\n            throw new Error('call resetPage(size:number, params:any) first');\r\n        }\r\n        let pageStart:any;\r\n        if (this.pageStart !== undefined) {\r\n            switch (this.startField.type) {\r\n                default: pageStart = this.pageStart; break;\r\n                case 'date':\r\n                case 'time':\r\n                case 'datetime': pageStart = (this.pageStart as Date).getTime(); break;\r\n            }\r\n        }\r\n\t\tlet ret = await this.page(this.params, pageStart, this.pageSize+1);\r\n\t\tlet page = (ret as any).$page;\r\n        /*\r\n        await this.loadSchema();\r\n        let res = await this.tvApi.page(this.name, pageStart, this.pageSize+1, this.params);\r\n        let data = await this.unpackReturns(res);\r\n        let page = data['$page'] as any[];\r\n        */\r\n        this.list = observable.array([], {deep: false});\r\n        if (page !== undefined) {\r\n            if (page.length > this.pageSize) {\r\n                this.more = true;\r\n                page.pop();\r\n                let ret = this.returns.find(r => r.name === '$page');\r\n                this.startField = ret.fields[0];\r\n                this.pageStart = page[page.length-1][this.startField.name];\r\n            }\r\n            else {\r\n                this.more = false;\r\n            }\r\n            this.list.push(...page);\r\n        }\r\n        //this.loaded = true;\r\n    }\r\n\r\n    protected pageCaller(params: any, showWaiting: boolean = true): QueryPageCaller {\r\n        return new QueryPageCaller(this, params, showWaiting);\r\n    }\r\n\r\n    async page(params:P, pageStart:any, pageSize:number, showWaiting: boolean = true):Promise<R> {\r\n        let p = {pageStart, pageSize, params};\r\n        let res = await this.pageCaller(p, showWaiting).request();\r\n        return res;\r\n    }\r\n    protected queryCaller(params: P, showWaiting: boolean = true): QueryQueryCaller {\r\n        return new QueryQueryCaller(this, params, showWaiting);\r\n    }\r\n    async query(params:P, showWaiting:boolean = true):Promise<R> {\r\n        let res = await this.queryCaller(params, showWaiting).request();\r\n        return res;\r\n    }\r\n    async table(params:P, showWaiting:boolean = true): Promise<any[]> {\r\n        let ret = await this.query(params, showWaiting);\r\n        for (let i in ret) {\r\n            return (ret as any)[i];\r\n        }\r\n    }\r\n    async obj(params:P, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.table(params, showWaiting);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:P, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.obj(params, showWaiting);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nexport class Query extends UqQuery<any, any> {\r\n}\r\n","import { messageHub } from \"./messageHub\";\r\n\r\nlet subAppWindow:Window;\r\nfunction postWsToSubApp(msg:any) {\r\n    if (subAppWindow === undefined) return;\r\n    subAppWindow.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport function setSubAppWindow(win:Window) {\r\n    subAppWindow = win;\r\n}\r\n\r\nexport function postWsToTop(msg:any) {\r\n    window.top.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport abstract class WsBase {\r\n\tprivate messageHub = messageHub;\r\n\t/*\r\n    wsBaseId:string;\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n\tprivate msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n\t*/\r\n\t/*\r\n    onWsReceiveAny(handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.anyHandlers[seed] = handler;\r\n        return seed;\r\n    }\r\n    onWsReceive(type:string, handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.msgHandlers[seed] = {type:type, handler: handler};\r\n        return seed;\r\n    }\r\n    endWsReceive(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n\t}\r\n\t*/\r\n    async receive(msg:any) {\r\n\t\tthis.messageHub.dispatch(msg);\r\n\t\t/*\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n\t\t}\r\n\t\t*/\r\n    }\r\n}\r\n\r\nlet wsBaseSeed = 1;\r\nexport class WsBridge extends WsBase {\r\n    wsBaseId:string = 'WsBridge seed ' + wsBaseSeed++;\r\n}\r\n\r\nexport const wsBridge = new WsBridge();\r\n\r\nexport class WSChannel extends WsBase {\r\n    wsBaseId:string = 'WSChannel seed ' + wsBaseSeed++;\r\n    static centerToken:string;\r\n    private wsHost: string;\r\n    private token: string;\r\n    private ws: WebSocket;\r\n\r\n    constructor(wsHost: string, token: string) {\r\n        super();\r\n        this.wsHost = wsHost;\r\n        this.token = token;\r\n    }\r\n\r\n    static setCenterToken(token?: string) {\r\n        WSChannel.centerToken = token;\r\n    }\r\n    \r\n    connect():Promise<void> {\r\n        //this.wsHost = wsHost;\r\n        //this.token = token || WSChannel.centerToken;\r\n        if (this.ws !== undefined) return;\r\n        let that = this;\r\n        return new Promise((resolve, reject) => {\r\n            let ws = new WebSocket(this.wsHost, this.token || WSChannel.centerToken);\r\n            console.log('connect webSocket %s', this.wsHost);\r\n            ws.onopen = (ev) => {\r\n                console.log('webSocket connected %s', this.wsHost);\r\n                that.ws = ws;\r\n                resolve();\r\n            };\r\n            ws.onerror = (ev) => {\r\n                reject('webSocket can\\'t open!');\r\n            };\r\n            ws.onmessage = async (msg) => await that.wsMessage(msg);\r\n            ws.onclose = (ev) => {\r\n                that.ws = undefined;\r\n                console.log('webSocket closed!');\r\n            }\r\n        });\r\n    }\r\n    close() {\r\n        if (this.ws !== undefined) {\r\n            this.ws.close();\r\n            this.ws = undefined;\r\n        }\r\n    }\r\n    private async wsMessage(event:any):Promise<void> {\r\n        try {\r\n            console.log('websocket message: %s', event.data);\r\n            let msg = JSON.parse(event.data);\r\n            postWsToSubApp(msg);\r\n            await this.receive(msg);\r\n        }\r\n        catch (err) {\r\n            console.log('ws msg error: ', err);\r\n        }\r\n    }\r\n    sendWs(msg:any) {\r\n        let netThis = this;\r\n        this.connect().then(() => {\r\n            netThis.ws.send(msg);\r\n        });\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { nav } from './nav';\r\n\r\nexport interface ImageProps {\r\n    src: string;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    altImage?: string;\r\n}\r\n\r\n// src = .src, fontawesome Icon\r\nexport function Image(props: ImageProps) {\r\n\tlet {className, style, src, altImage} = props;\r\n\tlet icon:string;\r\n    if (src) {\r\n\t\tif (src.indexOf('.') !== 0) {\r\n\t\t\tif (src.startsWith(':') === true) {\r\n\t\t\t\tsrc = nav.resUrl + src.substr(1);\r\n\t\t\t}\r\n\t\t\treturn <img src={src} className={className} alt=\"img\"\r\n\t\t\t\tstyle={style}\r\n\t\t\t\tonError={evt=>{\r\n\t\t\t\t\tif (altImage) evt.currentTarget.src=altImage;\r\n\t\t\t\t\telse evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n\t\t\t\t}} />;\r\n\t\t}\r\n\t\ticon = src.substr(1);\r\n\t}\r\n\telse {\r\n\t\ticon = 'file-o'\r\n\t}\r\n\treturn <span className={classNames(className, 'image-none')} style={style}>\r\n\t\t<i className={'fa fa-' + icon} />\r\n\t</span>;\r\n}\r\n","import jwtDecode from 'jwt-decode';\r\n\r\nexport interface Unit {\r\n    id: number;\r\n    name: string;\r\n}\r\n\r\nexport interface Guest {\r\n    id: number;             // id = 0\r\n    guest: number;\r\n    token: string;\r\n}\r\n\r\nexport interface User extends Guest {\r\n    id: number;\r\n    name: string;\r\n    nick?: string;\r\n    icon?: string;\r\n}\r\n\r\nexport function decodeUserToken(token: string): User {\r\n    let ret:any = jwtDecode(token);\r\n    let user: User = {\r\n        id: ret.id,\r\n        name: ret.name,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return user;\r\n}\r\n\r\nexport function decodeGuestToken(token: string): Guest {\r\n    let ret:any = jwtDecode(token);\r\n    let guest: Guest = {\r\n        id: 0,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return guest;\r\n}\r\n","import { env } from '../tool';\r\n\r\nconst centerHost = process.env['REACT_APP_CENTER_HOST'];\r\nconst centerDebugHost = 'localhost:3000'; //'192.168.86.64';\r\nconst resHost = process.env['REACT_APP_RES_HOST'] || centerHost;\r\nconst resDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugBuilderHost = 'localhost:3009';\r\ninterface HostValue {\r\n    value: string;\r\n\tlocal: boolean;\r\n}\r\nconst hosts:{[name:string]:HostValue} = {\r\n    centerhost: {\r\n        value: process.env['REACT_APP_CENTER_DEBUG_HOST'] || centerDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    reshost: {\r\n        value: process.env['REACT_APP_RES_DEBUG_HOST'] || resDebugHost,\r\n\t\tlocal: false,\r\n    },\r\n    uqhost: {\r\n        value: process.env['REACT_APP_UQ_DEBUG_HOST'] || uqDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    unitxhost: {\r\n        value: process.env['REACT_APP_UQ_DEBUG_HOST'] || uqDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    \"uq-build\": {\r\n        value: process.env['REACT_APP_UQ_DEBUG_BUILDER_HOST'] || uqDebugBuilderHost, \r\n\t\tlocal: false,\r\n    }\r\n}\r\n\r\nconst httpArr = ['https://', 'http://'];\r\nfunction isAbsoluteUrl(url:string):boolean {\r\n    for (let str of httpArr) {\r\n        if (url.startsWith(str) === true) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction urlFromHost(host:string):string {\r\n    if (isAbsoluteUrl(host) === true) {\r\n        if (host.endsWith('/')) return host;\r\n        return host + '/';\r\n    }\r\n    return `http://${host}/`;\r\n}\r\n\r\nfunction centerUrlFromHost(host:string):string {\r\n    return urlFromHost(host);\r\n}\r\nfunction centerWsFromHost(host:string) {\r\n    let https = 'https://';\r\n    if (host.startsWith(https) === true) {\r\n        host = host.substr(https.length);\r\n        if (host.endsWith('/') === true) host = host.substr(0, host.length-1);\r\n        return 'wss://' + host + '/tv/';\r\n    }\r\n    return `ws://${host}/tv/`\r\n}\r\nexport function resUrlFromHost(host:string) {\r\n\tif (!host) return;\r\n    let url = urlFromHost(host);\r\n    return url + 'res/';\r\n}\r\n\r\nconst fetchOptions = {\r\n    method: \"GET\",\r\n    mode: \"no-cors\", // no-cors, cors, *same-origin\r\n    headers: {\r\n        \"Content-Type\": \"text/plain\"\r\n    },\r\n};\r\n\r\nclass Host {\r\n    testing: boolean;\r\n    url: string;\r\n    ws: string;\r\n    resHost: string;\r\n\r\n    async start(testing:boolean) {\r\n\t\tif (!centerHost) debugger;\r\n        this.testing = testing;\r\n        if (env.isDevelopment === true) {\r\n            await this.tryLocal();\r\n        }\r\n        let host = this.getCenterHost();\r\n        this.url = centerUrlFromHost(host);\r\n        this.ws = centerWsFromHost(host);\r\n\t\tthis.resHost = this.getResHost();\r\n    }\r\n\r\n    private debugHostUrl(host:string) {return `http://${host}/hello`}\r\n    private async tryLocal() {\r\n        let promises:PromiseLike<any>[] = [];\r\n        let hostArr:string[] = [];\r\n        for (let i in hosts) {\r\n            let hostValue = hosts[i];\r\n            let {value} = hostValue;\r\n            if (hostArr.findIndex(v => v === value) < 0) hostArr.push(value);\r\n        }\r\n\r\n        for (let host of hostArr) {\r\n            let fetchUrl = this.debugHostUrl(host);\r\n            promises.push(localCheck(fetchUrl));\r\n        }\r\n        let results = await Promise.all(promises);\r\n        let len = hostArr.length;\r\n        for (let i=0; i<len; i++) {\r\n            let local = results[i];\r\n            let host = hostArr[i];\r\n            for (let j in hosts) {\r\n                let hostValue = hosts[j];\r\n                if (hostValue.value === host) {\r\n                    hostValue.local = local;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private getCenterHost():string {\r\n        let {value, local} = hosts.centerhost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return centerHost;\r\n    }\r\n\r\n    private getResHost():string {\r\n        let {value, local} = hosts.reshost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return resHost;\r\n    }\r\n\r\n    getUrlOrDebug(url:string, debugHost:string = 'uqhost'):string {\r\n        if (env.isDevelopment === false) return url;\r\n        let host = hosts[debugHost];\r\n        if (host === undefined) return url;\r\n        let {value, local} = host;\r\n        if (local === false) return url;\r\n        return `http://${value}/`;\r\n    }\r\n    getUrlOrTest(db:string, url:string, urlTest:string):string {\r\n\t\tlet path:string;\r\n\t\tif (!urlTest) {\r\n\t\t\turlTest = url;\r\n\t\t\tif (!urlTest) {\r\n\t\t\t\tconsole.error('no server set for ' + db);\r\n\t\t\t\tdebugger;\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (!url) {\r\n\t\t\turl = urlTest;\r\n\t\t\tthis.testing = true\r\n\t\t}\r\n        if (this.testing === true) {\r\n            if (urlTest !== '-') url = urlTest;\r\n            path = 'uq/test/' + db + '/';\r\n        }\r\n        else {\r\n            path = 'uq/prod/' + db + '/';\r\n        }\r\n\t\turl = this.getUrlOrDebug(url);\r\n\t\tif (url.endsWith('/') === false) {\r\n\t\t\turl += '/';\r\n\t\t}\r\n        return url + path;\r\n    }\r\n\r\n    async localCheck(urlDebug: string):Promise<boolean> {\r\n        return await localCheck(urlDebug);\r\n    }\r\n}\r\n\r\nexport const host:Host = new Host();\r\n\r\n// \r\n// fetch timeout\r\n// timeoutfetchcancel\r\n\r\n// web\r\n//const timeout = 2000;\r\nconst timeout = 2000;\r\n\r\nfunction fetchLocalCheck(url:string):Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n      fetch(url, fetchOptions as any)\r\n      .then(v => {\r\n          v.text().then(resolve).catch(reject);\r\n      })\r\n      .catch(reject);\r\n      const e = new Error(\"Connection timed out\");\r\n      env.setTimeout('fetchLocalCheck', reject, timeout, e);\r\n    });\r\n}\r\n\r\nasync function localCheck(url:string):Promise<boolean> {\r\n    try {\r\n\t\tawait fetchLocalCheck(url);\r\n        return true;\r\n    }\r\n    catch (err) {\r\n        return false;\r\n    }\r\n}\r\n\r\n/*\r\nexport interface IUqForChannel {\r\n    uq: string;\r\n    uqVersion: number;\r\n}\r\n*/","export * from './form';\r\nexport * from './multiStep';","import React from 'react';\r\nimport { PageHeaderProps } from './pageHeader';\r\n\r\nconst scrollAfter = 20; // 20msscroll\r\nexport class Scroller {\r\n    private el: HTMLBaseElement;\r\n    constructor(el: HTMLBaseElement) {\r\n        this.el = el;\r\n    }\r\n\r\n    scrollToTop():void {\r\n        setTimeout(() => this.el.scrollTo(0, 0), scrollAfter);\r\n    }\r\n    scrollToBottom():void {\r\n        setTimeout(() => this.el.scrollTo(0, this.el.scrollTop + this.el.offsetHeight), scrollAfter);\r\n    }\r\n}\r\n\r\nexport interface ScrollProps {\r\n    onScroll?: (e:any) => void;\r\n    onScrollTop?: (scroller: Scroller) => Promise<boolean>;\r\n\tonScrollBottom?: (scroller: Scroller) => Promise<void>;\r\n\tclassName?: string;\r\n}\r\ninterface ScrollViewProps extends ScrollProps {\r\n\tclassName?: string;\r\n\tstyle?: React.CSSProperties;\r\n}\r\nconst scrollTimeGap = 100;\r\nabstract class ScrollViewBase<T extends ScrollViewProps> extends React.Component<T, null> {\r\n    private bottomTime:number = 0;\r\n\tprivate topTime:number = 0;\r\n\tprivate div: HTMLDivElement;\r\n\r\n\tprotected refDiv = (div:HTMLDivElement) => {\r\n\t\tif (!div) {\r\n\t\t\tif (this.div) {\r\n\t\t\t\tthis.div.removeEventListener('resize', this.onResize)\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.div = div;\r\n\t\tthis.div.addEventListener('resize', this.onResize);\r\n\t}\r\n\r\n\tprivate onResize = (ev:UIEvent) => {\r\n\t\tconsole.error('div resize');\r\n\t};\r\n\r\n    protected onScroll = async (e:any) => {\r\n        let {onScroll, onScrollTop, onScrollBottom} = this.props;\r\n        if (onScroll) onScroll(e);\r\n        let el = e.target as HTMLBaseElement;\r\n        let scroller = new Scroller(el);\r\n        if (el.scrollTop < 30) {\r\n            if (onScrollTop !== undefined) {\r\n                let topTime = new Date().getTime();\r\n                if (topTime-this.topTime > scrollTimeGap) {\r\n                    this.topTime = topTime;\r\n\t\t\t\t\tonScrollTop(scroller).then(ret => {\r\n\t\t\t\t\t\t // has more\r\n\t\t\t\t\t\tif (ret === true) {\r\n\t\t\t\t\t\t\tlet sh = el.scrollHeight;\r\n\t\t\t\t\t\t\tlet top = 200;\r\n\t\t\t\t\t\t\tif (top > sh) top = sh;\r\n\t\t\t\t\t\t\tel.scrollTop = top;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n                }\r\n            }\r\n        }\r\n        if (el.scrollTop + el.offsetHeight > el.scrollHeight - 30) {\r\n            //this.eachChild(this, 'bottom');\r\n            if (onScrollBottom !== undefined) {\r\n                let bottomTime = new Date().getTime();\r\n                if (bottomTime - this.bottomTime > scrollTimeGap) {\r\n                    this.bottomTime = bottomTime;\r\n                    onScrollBottom(scroller);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    private eachChild(c:any, direct:'top'|'bottom') {\r\n        let { props } = c;\r\n        if (props === undefined)\r\n            return;\r\n        let { children } = props;\r\n        if (children === undefined)\r\n            return;\r\n        React.Children.forEach(children, (child, index) => {\r\n            let {_$scroll} = child as any;\r\n            if (_$scroll) _$scroll(direct);\r\n            console.log(child.toString());\r\n            this.eachChild(child, direct);\r\n        });\r\n\t}\r\n}\r\n\r\nexport class ScrollView extends ScrollViewBase<ScrollViewProps> {\r\n    render() {\r\n\t\tlet {className, style} = this.props;\r\n\t\treturn <div ref={this.refDiv} className=\"tv-page\"\r\n\t\t\tonScroll={this.onScroll} style={style}>\r\n\t\t\t<article className={className}>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</article>\r\n\t\t</div>;\r\n    }\r\n}\r\n\r\nexport interface PageWebNav {\r\n\tnavHeader?: JSX.Element; \r\n\tnavRawHeader?: JSX.Element; \r\n\tnavFooter?: JSX.Element; \r\n\tnavRawFooter?: JSX.Element; \r\n\trenderPageHeader?: (props:PageHeaderProps)=>JSX.Element;\r\n}\r\ninterface WebNavScrollViewProps extends ScrollViewProps {\r\n\twebNav: PageWebNav;\r\n}\r\n\r\nexport class WebNavScrollView extends ScrollViewBase<WebNavScrollViewProps> {\r\n    render() {\r\n\t\tlet {className, style, webNav} = this.props;\r\n\t\tlet {navHeader, navRawHeader, navFooter, navRawFooter} = webNav;\r\n\t\tlet vHeader:any, vFooter:any;\r\n\t\tif (navRawHeader) vHeader = navRawHeader;\r\n\t\telse if (navHeader) vHeader = <header><main>{navHeader}</main></header>\r\n\t\tif (navRawFooter) vFooter = navRawFooter;\r\n\t\telse if (navFooter) vFooter = <footer><main>{navFooter}</main></footer>\r\n\r\n\t\treturn <div ref={this.refDiv} className=\"tv-page-webnav\"\r\n\t\t\tonScroll={this.onScroll} style={style}>\r\n\t\t\t{vHeader}\r\n\t\t\t<article className={className}>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</article>\r\n\t\t\t{vFooter}\r\n\t\t</div>;\r\n    }\r\n}\r\n","import { Entity } from './entity';\r\nimport { ActionCaller } from './caller';\r\n\r\nexport class UqAction<P, R> extends Entity {\r\n    get typeName(): string { return 'action';}\r\n    async submit(data:P, waiting: boolean = true) {\r\n\t\tlet caller = new ActionSubmitCaller(this, data)\r\n\t\tlet ret = await caller.request();\r\n\t\treturn ret;\r\n    }\r\n    async submitReturns(data:P):Promise<R> {\r\n       return await new SubmitReturnsCaller(this, data).request();\r\n    }\r\n    async submitConvert(data:P) {\r\n        return await new SubmitConvertCaller(this, data).request();\r\n    }\r\n}\r\n\r\nexport class Action extends UqAction<any, any> {\r\n}\r\n\r\nexport class ActionSubmitCaller extends ActionCaller {\r\n    get path():string {return 'action/' + this.entity.name;}\r\n    buildParams():any {\r\n\t\treturn {data: this.entity.pack(this.params)}\r\n\t}\r\n}\r\n\r\nclass SubmitReturnsCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action/' + this.entity.name + '/returns';}\r\n    xresult(res:any):any {\r\n        let {returns} = this.entity;\r\n        let len = returns.length;\r\n        let ret:{[r:string]:any[]} = {};\r\n        for (let i=0; i<len; i++) {\r\n            let retSchema = returns[i];\r\n            ret[retSchema.name] = res[i];\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass SubmitConvertCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action-convert/' + this.entity.name;}\r\n    buildParams():any {\r\n        return {\r\n            data: this.params\r\n        };\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-badge.css';\r\n\r\nexport interface BadgeProps {\r\n    className?: string;\r\n    badge?: string|number;\r\n    size?: 'xs' | 'sm' | 'lg';\r\n    color?: 'secondary'|'success'|'danger'|'primary'|'info'|'warning';\r\n    badgeAlign?: 'left'|'center'|'right';\r\n    badgeVertical?: 'top'|'middle'|'bottom';\r\n}\r\n\r\n@observer\r\nexport class Badge extends React.Component<BadgeProps> {\r\n    render() {\r\n        let {className, badge, size, color, badgeAlign, badgeVertical, children} = this.props;\r\n        let cn = classNames(\r\n            className,\r\n            'va-badge',\r\n            size && 'va-badge-'+size,\r\n            'va-badge-' + (color||'secondary'),\r\n            badgeAlign && 'va-badg-'+badgeAlign,\r\n            badgeVertical && 'va-badg-'+badgeVertical,\r\n        );\r\n        let b;\r\n        if (badge) b = <b>{badge}</b>;\r\n        return <div className={cn}>\r\n            {children}\r\n            {b}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-lmr.css';\r\n\r\nexport interface LMRProps {\r\n    className?: string | string[];\r\n    left?: string|JSX.Element;\r\n    right?: string|JSX.Element;\r\n    onClick?: ()=>void;\r\n}\r\n\r\n@observer\r\nexport class LMR extends React.Component<LMRProps> {\r\n    render() {\r\n        let {className, left, children, right, onClick} = this.props;\r\n        let l, r;\r\n        if (left !== undefined) l = <header>{left}</header>;\r\n        if (right !== undefined) r = <footer>{right}</footer>;\r\n        let cursor;\r\n        if (onClick !== undefined) cursor = 'cursor-pointer';\r\n        return <div className={classNames('va-lmr', className, cursor)} onClick={onClick}>\r\n            {l}\r\n            <div>{children}</div>\r\n            {r}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface FAProps {\r\n    name: string;\r\n    className?: string;\r\n    size?: 'lg'|'2x'|'3x'|'4x'|'5x';\r\n    spin?: boolean;\r\n    fixWidth?: boolean;\r\n    border?: boolean;\r\n    pull?: 'left'|'right';\r\n    pulse?: boolean;\r\n    rotate?: 90|180|270;\r\n    flip?: 'horizontal'|'vertical';\r\n    inverse?: boolean;\r\n}\r\n\r\nexport class FA extends React.Component<FAProps> {\r\n    render() {\r\n        let {name, className, size, spin, fixWidth, border, pull, pulse, rotate, flip, inverse} = this.props;\r\n        let cn = classNames(className, 'fa',\r\n            name && ('fa-' + name),\r\n            size && 'fa-'+size,\r\n            fixWidth && 'fa-fw',\r\n            border && 'fa-border',\r\n            pull && 'fa-pull-' + pull,\r\n            spin && 'fa-spin',\r\n            pulse && 'fa-pulse',\r\n            rotate && 'fa-rotate-' + rotate,\r\n            flip && 'fa-flip-' + flip,\r\n            inverse && 'fa-inverse',\r\n        );\r\n        return <i className={cn} />\r\n    }\r\n}\r\n\r\nexport interface StackedFAProps {\r\n    className?: string;\r\n    size?: 'lg',\r\n}\r\nexport class StackedFA extends React.Component<StackedFAProps> {\r\n    render() {\r\n        let {className, size, children} = this.props;\r\n        let cn = classNames(\r\n            'fa-stack',\r\n            className,\r\n            size && 'fa-' + size);\r\n        return <span className={cn}>\r\n            {children}\r\n        </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport const Muted = (props:any) => \r\n<small className={classNames('text-muted', props.className)} style={props.style}>\r\n    {props.children}\r\n</small>;\r\n","import * as React from 'react';\r\nimport {FA} from './FA';\r\n\r\nexport interface IconTextProps {\r\n    icon: string;\r\n    iconClass?: string;\r\n    text: string;\r\n    textClass?: string;\r\n}\r\n\r\nexport class IconText extends React.Component<IconTextProps> {\r\n    render() {\r\n        let {icon, iconClass, text, textClass} = this.props;\r\n        return <div className=\"py-2\">\r\n            <FA className={iconClass} name={icon} fixWidth={true} />\r\n            <span className={textClass}>{text}</span>\r\n        </div>;\r\n    }\r\n}\r\n","import _ from 'lodash';\r\n\r\nclass _LocalStorage {\r\n    getItem(key:string) {\r\n        return localStorage.getItem(key)\r\n    }\r\n    setItem(key:string, value:string) {\r\n        localStorage.setItem(key, value);\r\n    }\r\n    removeItem(key:string) {\r\n        localStorage.removeItem(key);\r\n    }\r\n}\r\n\r\nconst __ls = new _LocalStorage(); // new Ls;\r\n\r\nexport class LocalCache {\r\n    private readonly local: Local;\r\n    //private value: T;\r\n    readonly key: string|number;\r\n\r\n    constructor(local:Local, key:string|number) {\r\n        this.local = local;\r\n        this.key = key;\r\n    }\r\n    get():any {\r\n        try {\r\n            // circular\r\n            //if (this.value !== undefined) return this.value;\r\n            let text = this.local.getItem(this.key);\r\n            if (text === null) return;\r\n            if (text === undefined) return undefined;\r\n            //return this.value = \r\n            return JSON.parse(text);\r\n        }\r\n        catch (err) {\r\n            this.local.removeItem(this.key);\r\n            return;\r\n        }\r\n    }\r\n    set(value:any) {\r\n\t\tlet t = JSON.stringify(value, (key, value) => {\r\n\t\t\tif (key !== '_tuid') return value;\r\n\t\t});\r\n\t\tthis.local.setItem(this.key, t);\r\n    }\r\n    remove(local?:Local) {\r\n        if (local === undefined) {\r\n            this.local.removeItem(this.key);\r\n        }\r\n        else {\r\n            this.local.removeLocal(local);\r\n        }\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        return this.local.child(key);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        return this.local.arr(key);\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        return this.local.map(key);\r\n    }\r\n}\r\n\r\nabstract class Local {\r\n    private readonly caches: {[key:string]:LocalCache};\r\n    private readonly locals: {[key:string]:Local};\r\n    protected readonly name: string;\r\n    constructor(name: string) {\r\n        this.name = name;\r\n        this.caches = {};\r\n        this.locals = {};\r\n    }\r\n\r\n    protected abstract keyForGet(key:string|number):string;\r\n    protected abstract keyForSet(key:string|number):string;\r\n    protected abstract keyForRemove(key:string|number):string;\r\n    abstract removeAll():void;\r\n    getItem(key:string|number):string {\r\n        let k = this.keyForGet(key);\r\n        if (k === undefined) return;\r\n        return __ls.getItem(k);\r\n    }\r\n    setItem(key:string|number, value: string):void {\r\n        let k = this.keyForSet(key);\r\n        __ls.setItem(k, value);\r\n    }\r\n    removeItem(key:string|number):void {\r\n        let k = this.keyForSet(key);\r\n        if (k === undefined) return;\r\n        localStorage.removeItem(k);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        let sk = String(key);\r\n        let arr = this.locals[sk] as LocalArr;\r\n        if (arr === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = arr = new LocalArr(k);\r\n        }\r\n        return arr;\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        let sk = String(key);\r\n        let map = this.locals[sk] as LocalMap;\r\n        if (map === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = map = new LocalMap(k);\r\n        }\r\n        return map;\r\n    }\r\n    removeLocal(local:Local) {\r\n        let sk = local.name;\r\n        let k = this.keyForRemove(sk);\r\n        if (k === undefined) return;\r\n        let arr = this.locals[sk];\r\n        if (arr === undefined) arr = new LocalArr(k);\r\n        else this.locals[sk] = undefined;\r\n        arr.removeAll();\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        let ks = String(key);\r\n        let ret = this.caches[ks];\r\n        if (ret !== undefined) return ret;\r\n        return this.caches[ks] =ret = new LocalCache(this, key);\r\n    }\r\n}\r\n\r\nconst maxArrSize = 500;\r\nexport class LocalArr extends Local {\r\n    private readonly index: number[];\r\n    constructor(name: string) {\r\n        super(name);\r\n        let index = __ls.getItem(this.name);\r\n        this.index = index === null? [] : index.split('\\n').map(v => Number(v));\r\n    }\r\n    private saveIndex() {\r\n        __ls.setItem(this.name, this.index.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i < 0) return undefined;\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i<0) {\r\n            this.index.unshift(key);\r\n            if (this.index.length > maxArrSize) this.index.pop();\r\n        }\r\n        else {\r\n            this.index.splice(i, 1);\r\n            this.index.unshift(key)\r\n        }\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForRemove(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i<0) return;\r\n        this.index.splice(i, 1);\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i of this.index) {\r\n            __ls.removeItem(`${this.name}.${i}`);\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.index.splice(0);\r\n    }\r\n    item(index:number):LocalCache {\r\n        return this.child(index);\r\n    }\r\n}\r\n\r\nexport class LocalMap extends Local {\r\n    private readonly index: {[key:string]:number};\r\n    private max: number;\r\n    constructor(name: string) {\r\n        super(name);\r\n        this.max = 0;\r\n        this.index = {};\r\n        let index = __ls.getItem(this.name);\r\n        if (index !== null) {\r\n            let ls = index.split('\\n');\r\n            ls.forEach(l => {\r\n                let p = l.indexOf('\\t');\r\n                if (p<0) return;\r\n                let key = l.substr(0, p);\r\n                let i = Number(l.substr(p+1));\r\n                if (isNaN(i) === true) return;\r\n                this.index[key] = i;\r\n                if (i>this.max) this.max = i;\r\n            });\r\n        }\r\n    }\r\n    private saveIndex() {\r\n        let ls:string[] = [];\r\n        for (let k in this.index) {\r\n            let v = this.index[k];\r\n            if (v === undefined) continue;\r\n            ls.push(`${k}\\t${v}`);\r\n        }\r\n        __ls.setItem(this.name, ls.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) return undefined;\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) {\r\n            ++this.max;\r\n            i = this.max;\r\n            this.index[key] = i;\r\n            this.saveIndex();\r\n        }\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForRemove(key:string|number):string {\r\n        let i = this.index[key];\r\n        if (i===undefined) return;\r\n        this.index[key] = undefined;\r\n        this.saveIndex();\r\n        return `${this.name}.${i}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i in this.index) {\r\n            __ls.removeItem(`${this.name}.${this.index[i]}`);\r\n            this.index[i] = undefined;\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.max = 0;\r\n    }\r\n    item(key:string):LocalCache {\r\n        return this.child(key);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { BoxId } from './boxId';\r\nimport { Tuid } from './tuid';\r\nimport { observer } from 'mobx-react';\r\n\r\nconst TuidContent = (tuidName:string, values:any, x?:any) => {\r\n    return <>{tuidName}: {uqStringify(values)}</>;\r\n};\r\n\r\nexport function uqStringify(values: any): string {\r\n    let s = '{';\r\n    if (values === undefined) return 'undefined';\r\n    for (let i in values) {\r\n        let v = values[i];\r\n        s += i + ': ';\r\n        if (v === undefined) {\r\n            s += 'undefined';\r\n        }\r\n        else if (v === null) {\r\n            s += 'null';\r\n        }\r\n        else {\r\n            switch (typeof v) {\r\n                default:\r\n                    s += v;\r\n                    break;\r\n                case 'function':\r\n                    s += 'function';\r\n                    break;\r\n                case 'object':\r\n                    s += '{obj}';\r\n                    break;\r\n            }\r\n        }\r\n        s += ', ';\r\n    }\r\n    return s + '}';\r\n}\r\n\r\nexport class ReactBoxId implements BoxId {\r\n    readonly id: number;\r\n    protected tuid: Tuid;\r\n    protected ui: (values:any) => JSX.Element;\r\n    readonly isUndefined:boolean;\r\n    constructor(id: number, tuid: Tuid, ui: (values:any) => JSX.Element) {\r\n        this.id = Number(id);\r\n        this.tuid = tuid;\r\n        this.ui = ui;\r\n        this.isUndefined = (this.tuid === undefined);\r\n    }\r\n\r\n    get obj():any {\r\n        return this.tuid.valueFromId(this.id);\r\n    }\r\n\r\n    equ(id:BoxId|number): boolean {\r\n        if (id === undefined || id === null) return false;\r\n        if (typeof id === 'object') return this.id === id.id;\r\n        return this.id === id;\r\n    }\r\n\r\n    render(ui:TvTemplet, x:any):JSX.Element {\r\n        if (this.id === undefined || this.id === null || isNaN(this.id) === true) return;\r\n        let boxName = this.boxName; // this.tuid.name;\r\n        let val = this.obj; // this.tuid.valueFromId(this.id);\r\n        if (this.isUndefined === true) {\r\n            if (ui !== undefined) return ui(val, x);\r\n            return TuidContent(boxName, val, x);\r\n        }\r\n        switch (typeof val) {\r\n            case 'undefined':\r\n                return <span className=\"text-black-50\">{boxName} undefined</span>;\r\n            case 'number':\r\n                return <span className=\"text-light\">{boxName} {this.id}</span>;\r\n        }\r\n        if (ui === undefined) {\r\n            ui = this.ui;\r\n        }\r\n        if (ui !== undefined) {\r\n            if (typeof ui !== 'function') {\r\n                ui = (ui as any).content;\r\n            }\r\n            if (ui !== undefined) {\r\n                let ret = ui(val/*, this.tuidUR.res*/);\r\n                if (ret !== undefined) return ret;\r\n                return <span className=\"text-danger\">{boxName} {this.id}</span>;\r\n            }\r\n        }\r\n\r\n        return TuidContent(boxName, val);\r\n    }\r\n\r\n    get boxName():string {return this.tuid.name}\r\n    // ui(): TvTemplet {return this.tuid.ui}\r\n    // res(): any {return this.tuid.res}\r\n\r\n    async assure(): Promise<BoxId> {\r\n        await this.tuid.assureBox(this.id);\r\n        return this;\r\n    }\r\n}\r\n\r\nfunction boxIdContent(bi: number|BoxId, ui:TvTemplet, x:any) {\r\n    let logContent:any;\r\n    let boxId:ReactBoxId = bi as ReactBoxId;\r\n    switch(typeof bi) {\r\n        case 'undefined': logContent = <>boxId undefined</>; break;\r\n        case 'number': logContent = <>id:{bi}</>; break;\r\n        default:\r\n            if (typeof boxId.render !== 'function') {\r\n                if (ui === undefined) {\r\n                    logContent = TuidContent(boxId.boxName, bi, x);\r\n                }\r\n                else {\r\n                    return ui(bi, x);\r\n                }\r\n            }\r\n            break;\r\n    }\r\n    if (logContent !== undefined) {\r\n        return <del className=\"text-danger\">{logContent}</del>;\r\n    }\r\n    return boxId.render(ui, x);\r\n}\r\n\r\nexport type TvTemplet = (values?:any, x?:any) => JSX.Element;\r\n\r\ninterface Props {\r\n    tuidValue: number|BoxId, \r\n    ui?: TvTemplet,\r\n    x?: any,\r\n    nullUI?: ()=>JSX.Element\r\n}\r\n\r\nconst Tv = observer(({tuidValue, ui, x, nullUI}:Props) => {\r\n    if (tuidValue === undefined) {\r\n        if (nullUI === undefined) return <small className=\"text-muted\">[]</small>;\r\n        return nullUI();\r\n    }\r\n    if (tuidValue === null) {\r\n        if (nullUI === undefined) return <>[null]</>;\r\n        return nullUI();\r\n    }\r\n    let ttv = typeof tuidValue;\r\n    switch (ttv) {\r\n        default:\r\n            if (ui === undefined)\r\n                return <>{ttv}-{tuidValue}</>;\r\n            else {\r\n                let ret = ui(tuidValue, x);\r\n                if (ret !== undefined) return ret;\r\n                return <>{tuidValue}</>;\r\n            }\r\n        case 'object':\r\n            let divObj = boxIdContent(tuidValue, ui, x);\r\n            if (divObj !== undefined) return divObj;\r\n            return nullUI === undefined? <>id null</>: nullUI();\r\n        case 'number':\r\n            return <>id...{tuidValue}</>;\r\n    }\r\n});\r\n\r\nexport const tv = (tuidValue:number|BoxId, ui?:TvTemplet, x?:any, nullUI?:()=>JSX.Element):JSX.Element => {\r\n    return <Tv tuidValue={tuidValue} ui={ui} x={x} nullUI={nullUI} />;\r\n};\r\n","import * as React from 'react';\r\n\r\nexport function Loading() {\r\n    return <div className=\"d-flex h-100 align-items-center justify-content-center\">\r\n        <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />\r\n    </div>;\r\n}\r\n","import * as React from 'react';\r\nimport {observable, computed} from 'mobx';\r\nimport {FormView} from '../formView';\r\nimport {Field} from '../field';\r\nimport {Face} from '../face';\r\nimport {Rule} from '../rule';\r\n\r\nexport abstract class ControlBase {\r\n    protected formView: FormView;\r\n    constructor(formView:FormView) {\r\n        this.formView = formView;\r\n    }\r\n    render():JSX.Element {\r\n        return <div className=\"col-sm-10\">\r\n            {this.renderControl()}\r\n        </div>;\r\n    }\r\n    protected abstract renderControl():JSX.Element;\r\n    @computed get hasError():boolean {return false;}\r\n    @computed get filled():boolean {return false;}\r\n    clear() {}\r\n    clearErrors() {}\r\n    readValues(values:any):any {}\r\n    setError(fieldName:string, error:string) {}\r\n    setInitValues(values: any) {}\r\n    isOk():boolean {this.validate(); return !this.hasError;}\r\n    protected validate() {}\r\n}\r\n\r\nexport abstract class Control extends ControlBase {\r\n    protected _field: Field;\r\n    protected _face: Face;\r\n    protected props: any;\r\n    protected rules: Rule[];\r\n\r\n    protected element: HTMLElement;\r\n    @observable protected isOK?: boolean;\r\n    @observable protected error: string;\r\n    @observable protected value: any;\r\n\r\n    constructor(formView:FormView, field:Field, face:Face) {\r\n        super(formView);\r\n        if (field === undefined) debugger;\r\n        this._field = field;\r\n        this._face = face;\r\n        this.init();\r\n        this.setProps();\r\n    }\r\n    protected ref(element: HTMLElement) {\r\n        this.element = element;\r\n    }\r\n    protected init() {\r\n        this.rules = [];\r\n        let r = this._field.rules;\r\n        if (r !== undefined) {\r\n            if (Array.isArray(r) === true) this.rules.push(...(r as Rule[]));\r\n            else this.rules.push(r as Rule);\r\n        }\r\n    };\r\n    protected setProps():any {\r\n        return this.props = {\r\n            ref: this.ref.bind(this),\r\n            name: this._field.name,\r\n        }\r\n    };\r\n    @computed get hasError():boolean {return this.error !== undefined;}\r\n    @computed get filled():boolean {\r\n        let ret = this.value !== undefined && this.value !== this._field.defaultValue;\r\n        return ret;\r\n    }\r\n    clearValue() { this.value = undefined; }\r\n    clear() { this.clearErrors(); this.clearValue(); }\r\n    clearErrors() { this.isOK = undefined; this.error = undefined; }\r\n    readValues(values:any):any {\r\n        values[this._field.name] = this.value;\r\n    }\r\n    setError(fieldName:string, error:string) {}\r\n    setInitValues(values: any) {}\r\n    protected getValueFromElement():any {return this.value;}\r\n    protected validate() {\r\n        try {\r\n            let v = this.getValueFromElement();\r\n            if (this.rules.length > 0) {\r\n                let isOk:boolean;\r\n                for (let rule of this.rules) {\r\n                    console.log('validate: %s', v);\r\n                    let err = rule(v);\r\n                    console.log('validate: %s err: %s', v, err);\r\n                    if (err === true) {\r\n                        this.error = undefined;\r\n                        isOk = true;\r\n                    }\r\n                    else if (err !== undefined) {\r\n                        //console.log('field %s onBlur v=%s rule=%s err=%s', \r\n                        //    this.field.name, JSON.stringify(v), rule, err);\r\n                        this.error = err;\r\n                        this.isOK = false;\r\n                        return;\r\n                    }\r\n                }\r\n                this.isOK = isOk;\r\n            }\r\n            this.value = v;\r\n        }\r\n        catch (e) {\r\n            this.error = e.message;\r\n        }\r\n    }\r\n    render():JSX.Element {\r\n        let n;\r\n        if (this._face !== undefined) {\r\n            let {notes} = this._face;\r\n            if (notes !== undefined) n = <small className=\"text-muted\">{notes}</small>;\r\n        }\r\n        return <div className=\"col-sm-10\">\r\n            {this.renderControl()}\r\n            {n}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport {BoolField} from '../field';\r\nimport {CheckBoxFace} from '../face';\r\nimport {Control} from './control';\r\n\r\nexport class CheckControl extends Control {    \r\n    protected element: HTMLInputElement;\r\n    private trueValue: any;\r\n    private falseValue: any;\r\n\r\n    protected get field(): BoolField {return this._field as BoolField}\r\n    protected get face(): CheckBoxFace {return this._face as CheckBoxFace}\r\n\r\n    protected init() {\r\n        super.init();\r\n        let {trueValue, falseValue} = this.field;\r\n        if (trueValue === undefined) this.trueValue = 1;\r\n        if (falseValue === undefined) this.falseValue = 0;\r\n    }\r\n\r\n    setProps() {\r\n        super.setProps();\r\n        _.assign(this.props, {\r\n            onChange: this.onChange.bind(this),\r\n        });\r\n    }\r\n\r\n    clearValue() {\r\n        this.element.checked = this._field.defaultValue === this.trueValue;\r\n        this.value = this.getValueFromElement();\r\n    }\r\n\r\n    setInitValues(values: any) {\r\n        let v = values[this._field.name];\r\n        if (v === undefined) {\r\n            v = this._field.defaultValue;\r\n        }\r\n        if (v !== undefined) {\r\n            //this.element.checked = v === this.trueValue;\r\n            //this.value = this.getValueFromElement();\r\n        }\r\n    }\r\n\r\n    protected getValueFromElement():any { return this.element.checked? this.trueValue:this.falseValue; }\r\n\r\n    private onChange() {\r\n        this.value = this.getValueFromElement();\r\n    }\r\n\r\n    renderControl():JSX.Element {\r\n        return <div className=\"form-control-static\">\r\n            <label className=\"form-control\">\r\n                <label className=\"custom-control custom-checkbox mb-0\">\r\n                    <input type='checkbox'\r\n                        name={this._field.name}\r\n                        ref={this.props.ref}\r\n                        onChange={this.props.onChange}\r\n                        className=\"custom-control-input\" />\r\n                    <span className=\"custom-control-indicator\" />\r\n                    <span className=\"custom-control-description\">{this.face.label}</span>\r\n                </label>\r\n            </label>\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {RadioFace} from '../face';\r\nimport {Control} from './control';\r\n\r\nexport class RadioControl extends Control {\r\n    protected get face(): RadioFace {return this._face as RadioFace}\r\n    renderControl():JSX.Element {\r\n        return <div className=\"form-control-static\">\r\n            <div className=\"form-control\">\r\n            {\r\n                this.face.list.map((item, index) => {\r\n                    let t:any; //, v:any;\r\n                    if (typeof item !== 'object') t = item;\r\n                    else {\r\n                        t = item.text;\r\n                        //v = item.value;\r\n                    }\r\n                    return <label key={index} className=\"custom-control custom-radio w-25\">\r\n                        <input type='radio'\r\n                            name={this._field.name} \r\n                            className=\"custom-control-input\" />\r\n                        <span className=\"custom-control-indicator\"></span>\r\n                        <span className=\"custom-control-description\">{t}</span>\r\n                    </label>;\r\n                })\r\n            }\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport _ from 'lodash';\r\nimport {Placeholder} from '../face';\r\nimport {Control} from './control';\r\n\r\nconst TxtRequired = '';\r\n\r\nexport abstract class CharsControl extends Control {\r\n    protected init() {\r\n        super.init();\r\n        if (this._field.required === true) {\r\n            this.rules.push((v) => {\r\n                if (v===null || v===undefined || (v as string).trim().length === 0) return TxtRequired;\r\n                return true;\r\n            });\r\n        }\r\n    }\r\n\r\n    protected element: HTMLInputElement;\r\n    protected getValueFromElement():any {return this.parseValue(this.element.value)}\r\n\r\n    protected setProps() {\r\n        super.setProps();\r\n        _.assign(this.props, {\r\n            onBlur: this.onBlur.bind(this),\r\n            onFocus: this.onFocus.bind(this),\r\n            onChange: this.onChange.bind(this),\r\n        });\r\n        let face = this._face as Placeholder;\r\n        if (face !== undefined) {\r\n            _.assign(this.props, {\r\n                placeholder: face.placeholder,\r\n            });\r\n        }\r\n        return this.props;\r\n    };\r\n    protected parseValue(value?:string):any {return value;}\r\n    private onBlur() {\r\n        //console.log('field %s onBlure', this.field.name);\r\n        this.validate();\r\n    }\r\n    private onChange() {\r\n        console.log('onChange');\r\n        this.validate();\r\n    }\r\n    private onFocus() {\r\n        this.clearErrors();\r\n        //this.error = undefined;\r\n        //this.formView.clearErrors();\r\n    }\r\n    protected className() {\r\n        return classNames({\r\n            \"form-control\": true,\r\n            \"has-success\": this.isOK === true,\r\n            \"is-invalid\": this.error !== undefined,\r\n            \"is-valid\": this.error === undefined && this.isOK === true,\r\n        });\r\n    }\r\n    protected renderInput():JSX.Element {\r\n        return <input className={this.className()} {...this.props} />;\r\n    }\r\n    protected ref(element: HTMLInputElement) {\r\n        super.ref(element);\r\n        if (element) {\r\n            element.value = this.value === undefined? '':this.value;\r\n        }\r\n    }\r\n    protected renderError():JSX.Element {\r\n        //if (this.field.name === 'name') console.log('charsControl renderControl');\r\n        if (this.error === undefined) return null;\r\n        return <div className=\"invalid-feedback\">{this.error}</div>\r\n    }\r\n    clearValue() { super.clearValue(); this.element.value = ''; }\r\n    setError(fieldName:string, error:string) {\r\n        if (this._field.name === fieldName) this.error = error;\r\n    }\r\n    setInitValues(values: any) {\r\n        let v = values[this._field.name];\r\n        if (v === undefined) return;\r\n        //this.element.value = v;\r\n        this.value = v;\r\n    }\r\n    renderControl():JSX.Element {\r\n        return <React.Fragment>\r\n            {this.renderInput()}\r\n            {this.renderError()}\r\n        </React.Fragment>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport * as _ from 'lodash';\r\nimport {CharsControl} from './charsControl';\r\nimport {StringField} from '../field';\r\nimport {TextAreaFace} from '../face';\r\n\r\nexport class TextAreaControl extends CharsControl {\r\n    protected get face(): TextAreaFace {return this._face as TextAreaFace}\r\n    private el: HTMLTextAreaElement;\r\n\r\n    protected get field(): StringField {return this._field as StringField}\r\n\r\n    protected setProps() {\r\n        let p = super.setProps();\r\n        let {maxLength} = this.field;\r\n        let {rows} = this.face;\r\n        _.assign(p, {\r\n            maxLength: maxLength,\r\n            rows: rows,\r\n        });\r\n        return p;\r\n    };\r\n    protected renderInput():JSX.Element {\r\n        return <textarea ref={t=>{this.el = t;if (t!==undefined) t.value=''}} className={this.className()} {...this.props} />;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {FormView} from '../formView';\r\nimport {Field} from '../field';\r\nimport {Face, SelectFace} from '../face';\r\nimport {Control} from './control';\r\n\r\nexport class SelectControl extends Control {\r\n    constructor (formView:FormView, field:Field, face:Face) {\r\n        super(formView, field, face);\r\n        this.ref = this.ref.bind(this);\r\n    }\r\n    protected get face(): SelectFace {return this._face as SelectFace}\r\n    protected element: HTMLSelectElement;\r\n    protected getValueFromElement():any {\r\n        let {selectedOptions} = this.element;\r\n        let v:any = selectedOptions[0].value;\r\n        switch (this._field.type) {\r\n            case 'number': v = Number(v); break;\r\n            case 'date': v = new Date(v); break;\r\n            case 'bool': \r\n                if (typeof v === 'string') {\r\n                    v = ((v as string).toLowerCase() === 'true');\r\n                }\r\n                break;\r\n        }\r\n        return v;\r\n    }\r\n    renderControl():JSX.Element {\r\n        let {list} = this.face;\r\n        let def = this.face.default;\r\n        let options: any[] = [];\r\n        if (def === undefined)\r\n            options.push(<option key={-1} value={undefined}></option>);\r\n        options.push(...list.map((item, index) => {\r\n            let t, v;\r\n            if (typeof item !== 'object') t = v = item;\r\n            else {\r\n                t = item.text;\r\n                v = item.value;\r\n            }\r\n            return <option key={index} value={v}>{t}</option>;\r\n        }));\r\n        return <div className=\"form-control-static\">\r\n            <select name={this._field.name} className=\"form-control\" ref={this.ref}>\r\n                {options}\r\n            </select>\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {Control, ControlBase} from './control';\r\nimport {FormView} from '../formView';\r\n\r\nexport class UnknownControl extends Control {\r\n    renderControl():JSX.Element {\r\n        return <div className=\"form-control-plaintext\">\r\n            <div className=\"alert alert-primary\" role=\"alert\">\r\n            don't know how to create control<br/>\r\n            field: {JSON.stringify(this._field)} must be object <br/>\r\n            face: {JSON.stringify(this._face)} must be object <br/>\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class EmptyControl extends ControlBase {\r\n    private element:JSX.Element;\r\n    constructor(formView:FormView, element:JSX.Element) {\r\n        super(formView);\r\n        this.element = element;\r\n    }\r\n    renderControl():JSX.Element {\r\n        return <div className=\"form-control-plaintext\">\r\n            {this.element}\r\n        </div>;\r\n    }\r\n}\r\n","import _ from 'lodash';\r\nimport {CharsControl} from './charsControl';\r\nimport {StringField} from '../field';\r\n\r\nexport class StringControl extends CharsControl {\r\n    protected get field(): StringField {return this._field as StringField}\r\n\r\n    protected setProps() {\r\n        let p = super.setProps();\r\n        _.assign(p, {\r\n            type: 'text',\r\n            maxLength: this.field.maxLength,\r\n        });\r\n        return p;\r\n    };\r\n    protected parseValue(value?:string):any {\r\n        if (value === undefined) return undefined;\r\n        if (value.trim().length === 0) return undefined;\r\n        return value;\r\n    }\r\n}\r\n\r\nexport class PasswordControl extends StringControl {\r\n    protected setProps() {\r\n        let p = super.setProps();\r\n        _.assign(p, {\r\n            type: 'password',\r\n            maxLength: this.field.maxLength,\r\n        });\r\n        return p;\r\n    };\r\n}","import _ from 'lodash';\r\nimport {IntField, DecField, NumberField} from '../field';\r\nimport {CharsControl} from './charsControl';\r\n\r\nconst ErrInvalidNumber = '';\r\nconst ErrMin = '';\r\nconst ErrMax = '';\r\n\r\nconst KeyCode_Neg = 45;\r\nconst KeyCode_Dot = 46;\r\n\r\nexport class NumberControl extends CharsControl {\r\n    protected value: number;\r\n    protected extraChars: number[];\r\n\r\n    protected get field(): IntField | DecField | NumberField {return this._field as IntField | DecField | NumberField}\r\n    \r\n    protected init() {\r\n        super.init();\r\n        this.extraChars = [];\r\n        let {min, max} = this.field;\r\n        if (min !== undefined) {\r\n            this.rules.push((v:number) => {if (v === undefined) return; if (v<min) return ErrMin + min; return true;});\r\n            if (min < 0) this.extraChars.push(KeyCode_Neg);\r\n        }\r\n        else {\r\n            this.extraChars.push(KeyCode_Neg);\r\n        }\r\n\r\n        if (max !== undefined) {\r\n            this.rules.push((v:number) => {if (v === undefined) return; if (v>max) return ErrMax + max; return true});\r\n        }\r\n        switch (this._field.type) {\r\n            case 'dec':\r\n            case 'number': this.extraChars.push(KeyCode_Dot); break;\r\n        }\r\n    }\r\n\r\n    protected parseValue(value?:string):any {\r\n        if (value === undefined) return undefined;\r\n        if (value.trim().length === 0) return undefined;\r\n        let n = Number.parseFloat(value);\r\n        if (isNaN(n)) throw new Error(ErrInvalidNumber);\r\n        return n;\r\n    }\r\n\r\n    protected setProps() {\r\n        super.setProps();\r\n        _.assign(this.props, {\r\n            type: 'number',\r\n            step: (this._field as DecField).step,\r\n            onKeyPress: this.onKeyPress.bind(this),\r\n        });\r\n    }\r\n\r\n    onKeyPress(event:KeyboardEvent) {\r\n        let ch = event.charCode;\r\n        if (ch === 8 || ch === 0 || ch === 13 || (ch >= 48 && ch <= 57)) return;\r\n        if (this.extraChars !== undefined) {\r\n            if (this.extraChars.indexOf(ch) >= 0) {\r\n                switch (ch) {\r\n                    case KeyCode_Dot: this.onKeyDot(); break;\r\n                    case KeyCode_Neg: this.onKeyNeg(); event.preventDefault(); break;\r\n                }\r\n                return;\r\n            }\r\n        }\r\n        event.preventDefault();\r\n    }\r\n\r\n    private onKeyDot() {\r\n        let v = this.element.value;\r\n        let p = v.indexOf('.');\r\n        if (p >= 0) this.element.value = v.replace('.', '');\r\n    }\r\n    private onKeyNeg() {\r\n        let v = this.element.value;\r\n        let p = v.indexOf('-');\r\n        if (p >= 0) v = v.replace('-', '');\r\n        else v = '-'+v;\r\n        this.element.value = v;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observable} from 'mobx';\r\nimport {IdPickFace} from '../face';\r\nimport {Control} from './control';\r\n\r\nexport class PickIdControl extends Control {\r\n    protected get face(): IdPickFace {return this._face as IdPickFace}\r\n    @observable private caption: string|JSX.Element;\r\n\r\n    private onClick = async () => {\r\n        let {pick, fromPicked} = this.face;\r\n        let item = await pick(this.face, this.formView.props, this.formView.readValues());\r\n        if (item === undefined) {\r\n            this.value = undefined;\r\n            return;\r\n        }\r\n        if (fromPicked === undefined) {\r\n            this.value = item.id;\r\n            return;\r\n        }\r\n        let {id, caption} = fromPicked(item);\r\n        this.value = id;\r\n        this.caption = caption;\r\n    }\r\n    onPicked = (value: any) => {\r\n        this.value = value.id;\r\n    }\r\n    setInitValues(values: any) {\r\n        let v = values[this._field.name];\r\n        this.value = v;\r\n    }\r\n    private controlContent():string|JSX.Element {\r\n        let {itemFromId, fromPicked, initCaption} = this.face;\r\n        if (this.value === undefined) {\r\n            return initCaption || 'Id';\r\n        }\r\n        if (this.caption !== undefined) {\r\n            return this.caption;\r\n        }\r\n        if (itemFromId !== undefined) {\r\n            if (fromPicked !== undefined) {\r\n                let item = itemFromId(this.value);\r\n                if (item) {\r\n                    let ret = fromPicked(item);\r\n                    if (ret !== undefined) return ret.caption;\r\n                }\r\n            }\r\n        }\r\n        return String(this.value);\r\n    }\r\n    /*\r\n    private buildContent():string|JSX.Element {\r\n        let {tuid, input} = this.face;\r\n        if (input === undefined) {\r\n            //return <div>no input on idpick</div>;\r\n            return <div onClick={this.onClick}>{this.controlContent()}</div>;\r\n        }\r\n        return <input.component id={this.value} \r\n            tuid={tuid}\r\n            input={input}\r\n            entitiesUI={this.formView.props.context} \r\n            params={this.formView.readValues()}\r\n            onPicked={this.onPicked} />;\r\n    }*/\r\n    renderControl():JSX.Element {\r\n        let {tuid, input} = this.face;\r\n        if (input === undefined) {\r\n            //return <div>no input on idpick</div>;\r\n            return <div className=\"form-control-plaintext px-2 border text-primary rounded cursor-pointer\"\r\n                onClick={this.onClick}>\r\n                {this.controlContent()}\r\n            </div>;\r\n        }\r\n        return <div className=\"form-control-static \">\r\n            <input.component id={this.value} \r\n                ui={tuid}\r\n                //input={input}\r\n                //entitiesUI={this.formView.props.context} \r\n                //params={this.formView.readValues()}\r\n                //onPicked={this.onPicked}\r\n                />\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observable} from 'mobx';\r\nimport {FormView} from '../formView';\r\nimport {Field} from '../field';\r\nimport {Face, TuidPickFace} from '../face';\r\nimport {Control} from './control';\r\n\r\nexport class PickTuidControl extends Control {\r\n    protected get face(): TuidPickFace {return this._face as TuidPickFace}\r\n    // protected value: number;\r\n    @observable private caption: string|JSX.Element;\r\n    constructor(formView:FormView, field:Field, face:Face) {\r\n        super(formView, field, face);\r\n        this.onIdChanged = this.onIdChanged.bind(this);\r\n        //this.onClick = this.onClick.bind(this);\r\n    }\r\n    /*\r\n    private async onClick() {\r\n        let {pick, fromPicked} = this.face;\r\n        let item = await pick(this.face, this.formView.props, this.formView.readValues());\r\n        if (item === undefined) {\r\n            this.value = undefined;\r\n            return;\r\n        }\r\n        if (fromPicked === undefined) {\r\n            this.value = item.id;\r\n            return;\r\n        }\r\n        let {id, caption} = fromPicked(item);\r\n        this.value = id;\r\n        this.caption = caption;\r\n    }*/\r\n    onIdChanged(id: any) {\r\n        this.value = id.id;\r\n    }\r\n    setInitValues(values: any) {\r\n        let v = values[this._field.name];\r\n        this.value = v;\r\n    }\r\n    private buildContent():JSX.Element {\r\n\t\t/*\r\n        return <this.face.input.component \r\n            {...this.face}\r\n            id={this.value}\r\n            onFormValues={()=>this.formView.readValues()}\r\n\t\t\tonIdChanged={this.onIdChanged} />;\r\n\t\t*/\r\n\t\treturn React.createElement(this.face.input.component, {\r\n\t\t\tid: this.value,\r\n            onFormValues: ()=>this.formView.readValues(),\r\n\t\t\tonIdChanged: this.onIdChanged,\r\n\t\t\t...this.face\r\n\t\t})\r\n    }\r\n    renderControl():JSX.Element {\r\n        return <div className=\"form-control-static \">\r\n            {this.buildContent()}\r\n        </div>;\r\n    }\r\n}\r\n/*\r\n<button className=\"form-control btn btn-outline-info\"\r\ntype=\"button\"\r\nstyle={{textAlign:'left', paddingLeft:'0.75rem'}}\r\nonClick={this.onClick}>\r\n{this.buildContent()}\r\n</button>\r\n*/","import * as React from 'react';\r\nimport {observable} from 'mobx';\r\nimport {PickFace} from '../face';\r\nimport {Control} from './control';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class PickControl extends Control {\r\n    protected get face(): PickFace {return this._face as PickFace}\r\n\r\n    @observable private caption: string|JSX.Element;\r\n\r\n    private onClick = async () => {\r\n        let {pick, fromPicked} = this.face;\r\n        let item = await pick(this.face, this.formView.props, this.formView.readValues());\r\n        if (item === undefined) {\r\n            this.value = undefined;\r\n            return;\r\n        }\r\n        let {id, caption} = fromPicked(item);\r\n        this.value = id;\r\n        this.caption = caption;\r\n    }\r\n    setInitValues(values: any) {\r\n        let v = values[this._field.name];\r\n        this.value = v;\r\n    }\r\n    /*\r\n    private controlContent():string|JSX.Element {\r\n        let {content: Content} = this.face;\r\n        if (this.value === undefined) {\r\n            return '';\r\n        }\r\n        \r\n        if (this.caption !== undefined) {\r\n            return this.caption;\r\n        }\r\n        return <Content id={this.value} />;\r\n    }*/\r\n    /*\r\n    private buildContent():string|JSX.Element {\r\n        let {tuid, input} = this.face;\r\n        if (input === undefined) {\r\n            //return <div>no input on idpick</div>;\r\n            return <div onClick={this.onClick}>{this.controlContent()}</div>;\r\n        }\r\n        return <input.component id={this.value} \r\n            tuid={tuid}\r\n            input={input}\r\n            entitiesUI={this.formView.props.context} \r\n            params={this.formView.readValues()}\r\n            onPicked={this.onPicked} />;\r\n    }*/\r\n    renderControl():JSX.Element {\r\n        return React.createElement(this.view);\r\n        /*\r\n        let {content:Content} = this.face;\r\n        //if (this.value === undefined) {\r\n            //return <div>no input on idpick</div>;\r\n        //}\r\n        //return <div className=\"form-control-static \">\r\n        //    <Content />\r\n        //</div>;\r\n        */\r\n    }\r\n\r\n    private view = observer(() => {\r\n        let content:any;\r\n        let {content: Content} = this.face;\r\n        if (this.value === undefined || this.value === null) {\r\n            content = '';\r\n        }\r\n        /*\r\n        else if (this.caption !== undefined) {\r\n            content = this.caption;\r\n        }*/\r\n        else {\r\n            content = <Content id={this.value} />;\r\n        } \r\n        return <div\r\n            className=\"form-control-plaintext px-2 border text-primary rounded cursor-pointer bg-light\"\r\n            onClick={this.onClick}>\r\n            {content}\r\n        </div>\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport {ControlBase} from './control';\r\n\r\nexport class ButtonsControl extends ControlBase {\r\n    constructor(props) {\r\n        super(props);\r\n        this.otherClick = this.otherClick.bind(this);\r\n    }\r\n    private otherClick() {\r\n        let onOther = this.formView.props.onOther;\r\n        if (onOther === undefined) return;\r\n        let values = this.formView.readValues();\r\n        onOther(values);\r\n    }\r\n    renderControl():JSX.Element {\r\n        console.log('buttons.renderControl');\r\n        let nothing = this.formView.nothing;\r\n        let hasError = this.formView.hasError;\r\n        let props = this.formView.props;\r\n        console.log('buttons.renderControl nothing:%s hasError:%s', nothing, hasError);\r\n        let {submitButton, otherButton} = props;\r\n        let btnOther:any;\r\n        if (otherButton !== undefined) {\r\n            btnOther = <button className=\"btn btn-outline-info ml-auto\" onClick={this.otherClick}>\r\n                {otherButton}\r\n            </button>\r\n        }\r\n        return <div className=\"d-flex justify-content-start\">\r\n            <button\r\n                className=\"btn btn-primary\"\r\n                type=\"submit\" \r\n                disabled={nothing || hasError}>\r\n                {submitButton || ''}\r\n            </button>\r\n            {btnOther}\r\n        </div>;\r\n    }\r\n}\r\n","import {Field} from '../field';\r\nimport {Face} from '../face';\r\nimport {Control, ControlBase} from './control';\r\nimport {CheckControl} from './checkControl';\r\nimport {RadioControl} from './radioControl';\r\nimport {TextAreaControl} from './textAreaControl';\r\nimport {SelectControl} from './selectControl';\r\nimport {UnknownControl, EmptyControl} from './unknownControl';\r\nimport {StringControl, PasswordControl} from './stringControl';\r\nimport {NumberControl} from './numberControl';\r\n\r\nimport {FormView, FormRow, GroupRow, FieldRow, LabelFormRow} from '../formView';\r\nimport { PickIdControl } from './pickIdControl';\r\nimport { PickTuidControl } from './pickTuidControl';\r\nimport { PickControl } from './pickControl';\r\n\r\nexport * from './control';\r\nexport * from './buttonsControl';\r\nexport * from './stringControl';\r\nexport * from './numberControl';\r\n\r\nexport type CreateControl = (form:FormView, row: FormRow) => ControlBase\r\n\r\nexport const createControl:CreateControl = ((form:FormView, row: LabelFormRow):ControlBase => {\r\n    let control:ControlBase;\r\n    let label = row.label;\r\n    if ((row as GroupRow).group !== undefined) {\r\n        control = createGroupControl(form, label, row as GroupRow);\r\n    }\r\n    else if ((row as FieldRow).field !== undefined) {\r\n        control = createFieldControl(form, label, row as FieldRow);\r\n    }\r\n    else {\r\n        control = new EmptyControl(form, row.help);\r\n    }\r\n    return control;\r\n}) as CreateControl;\r\n\r\nconst controlTypes:{[type:string]: new (formView:FormView, field:Field, face:Face) => Control} = {\r\n    \"string\": StringControl,\r\n    \"password\": PasswordControl,\r\n    \"number\": NumberControl,\r\n    \"checkbox\": CheckControl,\r\n    \"radiobox\": RadioControl,\r\n    \"select\": SelectControl,\r\n    \"pick-id\": PickIdControl,\r\n    \"pick-tuid\": PickTuidControl,\r\n    \"textarea\": TextAreaControl,\r\n    \"pick\": PickControl,\r\n};\r\nconst defaultFaces:{[type:string]: Face} = {\r\n    \"string\": {type:'string'},\r\n    \"number\": {type:'number'},\r\n    \"int\": {type:'number'},\r\n    \"dec\": {type:'number'},\r\n    \"bool\": {type:'checkbox'},\r\n}\r\nfunction createFieldControl(form:FormView, label:string, fieldRow: FieldRow):Control {\r\n    let {field, face} = fieldRow;\r\n    switch (typeof field) {\r\n        case 'string':\r\n            field = {\r\n                name: (field as any) as string,\r\n                type: 'string',\r\n            }\r\n            break;\r\n        case 'object':\r\n            break;\r\n        default:\r\n            return new UnknownControl(form, field, face);\r\n    }\r\n    let fieldType = field.type || 'string';\r\n    if (face === undefined) {\r\n        face = defaultFaces[fieldType];\r\n        if (face === undefined) return new UnknownControl(form, field, face);\r\n    }\r\n    else if (face.type === undefined) {\r\n        let f = defaultFaces[fieldType];\r\n        face.type = f===undefined? 'string' : f.type;\r\n    }\r\n    let controlType = controlTypes[face.type || fieldType] || UnknownControl;\r\n    let c = new controlType(form, field, face);\r\n    return c;\r\n}\r\n\r\nfunction createGroupControl(form:FormView, label:string, groupRow: GroupRow):Control {\r\n    return new UnknownControl(form, groupRow as any, undefined);\r\n}\r\n","import { LocalMap } from './localDb';\r\n\r\n// testtest\r\nfunction isTesting():boolean {\r\n\tlet ret = /(\\btest\\b)/i.test(document.location.href);\r\n\treturn ret;\r\n}\r\n\r\nexport const env = (function () {\r\n    let testing = isTesting();\r\n    let localDb = new LocalMap(testing===true? '$$':'$');\r\n    return {\r\n        testing: testing,\r\n        isDevelopment: process.env.NODE_ENV === 'development',\r\n        localDb: localDb,\r\n        setTimeout: (tag:string, callback: (...args: any[]) => void, ms: number, ...args: any[]):NodeJS.Timer => {\r\n            //if (tag !== undefined) console.log('setTimeout ' + tag);\r\n            return global.setTimeout(callback, ms, ...args);\r\n        },\r\n        clearTimeout: (handle:NodeJS.Timer):void => {\r\n            global.clearTimeout(handle);\r\n        },\r\n        setInterval: (callback: (...args: any[]) => void, ms: number, ...args: any[]): NodeJS.Timer => {\r\n            return global.setInterval(callback, ms, ...args);\r\n        },\r\n        clearInterval: (handle:NodeJS.Timer):void => {\r\n            global.clearInterval(handle);\r\n        }\r\n    }\r\n}());\r\n","\r\nexport * from './boxId';\r\nexport * from './tuid';\r\nexport { TuidsCache } from './tuidsCache';\r\nexport { tv, ReactBoxId, uqStringify } from './reactBoxId';","import * as React from 'react';\r\nimport {FormView, FormRow, FieldRow, GroupRow, LabelFormRow} from '../formView';\r\nimport {ControlBase, createControl, CreateControl} from '../control';\r\n\r\nexport type CreateRow = (form:FormView, row: FormRow)=>RowContainer;\r\n\r\nexport abstract class RowContainer {\r\n    protected form:FormView;\r\n    protected row: FormRow;\r\n    protected control: ControlBase;\r\n    constructor(form:FormView, row: FormRow) {\r\n        this.form = form;\r\n        this.row = row;\r\n        if ((row as JSX.Element).type === undefined) {\r\n            let cc:CreateControl = (row as LabelFormRow).createControl;\r\n            if (cc === undefined) cc = form.createControl;\r\n            if (cc === undefined) cc = createControl;\r\n            this.control = cc(form, row);\r\n        }\r\n    }\r\n    abstract render(key:string):JSX.Element;\r\n    \r\n    isOk():boolean {\r\n        if (this.control === undefined) return true;\r\n        return this.control.isOk();\r\n    }\r\n\r\n    contains(fieldName:string):boolean {\r\n        let field = (this.row as FieldRow).field;\r\n        if (field !== undefined) return fieldName === field.name;\r\n        let group = (this.row as GroupRow).group;\r\n        if (group !== undefined) return group.find(g => g.field.name === fieldName)!==undefined;\r\n        return false;\r\n    }\r\n    get hasError():boolean {return this.control.hasError;}\r\n    get filled():boolean {return this.control.filled;}\r\n    clear() {\r\n        if (this.control !== undefined) this.control.clear();\r\n    }\r\n    clearErrors() {\r\n        if (this.control !== undefined) this.control.clearErrors();\r\n    }\r\n    readValues(values:any):any {\r\n        if (this.control !== undefined) this.control.readValues(values);\r\n    }\r\n    setError(fieldName:string, error:string) {\r\n        if (this.control !== undefined) this.control.setError(fieldName, error);\r\n    }\r\n    setInitValues(values:any) {\r\n        if (this.control !== undefined) this.control.setInitValues(values);\r\n    }\r\n}\r\n\r\nclass ElementRowContainer extends RowContainer {\r\n    render(key:string):JSX.Element {\r\n        return <div key={key} className=\"form-group\">{this.row as JSX.Element}</div>;\r\n    }\r\n    get hasError():boolean {return false;}\r\n    get filled():boolean {return false;}\r\n}\r\n\r\nclass BootStrapRowContainer extends RowContainer {\r\n    render(key:string):JSX.Element {\r\n        return <div key={key} className='form-group row'>\r\n            <label className='col-sm-2 col-form-label'>\r\n                {(this.row as LabelFormRow).label}\r\n            </label>\r\n            {this.control.render()}\r\n        </div>;\r\n\r\n        //has-success is-valid\r\n    }\r\n}\r\n\r\nexport function bootstrapCreateRow(form:FormView, row: FormRow):RowContainer {\r\n    return new BootStrapRowContainer(form, row);\r\n}\r\n\r\nexport function elementCreateRow(form:FormView, row: FormRow):RowContainer {\r\n    return new ElementRowContainer(form, row);\r\n}\r\n","export * from './id';\r\nexport * from './dev';\r\nexport * from './unitApp';","import {HttpChannel} from './httpChannel';\r\nimport { Caller } from './caller';\r\n\r\nexport async function refetchApi(channel:HttpChannel, url:string, options:any, \r\n    resolve:(values:any)=>any, reject:(reason:any)=>void)\r\n{\r\n    await channel.fetch(url, options, false, resolve, reject);\r\n}\r\n\r\nexport abstract class ApiBase {\r\n    protected token: string;\r\n    protected path: string;\r\n    protected showWaiting: boolean;\r\n\r\n    constructor(path: string, showWaiting: boolean) {\r\n        this.path = path || '';\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    protected abstract getHttpChannel(): Promise<HttpChannel>;\r\n\r\n    async xcall(caller:Caller<any>):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.xcall(this.path, caller);\r\n    }\r\n\r\n    public async call(url:string, method:string, body:any):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.callFetch(url, method, body);\r\n    }\r\n\r\n    public async get(path:string, params:any=undefined): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.get(this.path + path, params);\r\n    }\r\n\r\n    public async post(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.post(this.path + path, params);\r\n    }\r\n\r\n    public async put(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.put(this.path + path, params);\r\n    }\r\n\r\n    public async delete(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.delete(this.path + path, params);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { UiImageItem } from '../schema';\r\nimport { ImageUploader } from '../resUploader';\r\nimport { nav } from '../nav';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class ImageItemEdit extends ItemEdit {\r\n    get uiItem(): UiImageItem {return this._uiItem as UiImageItem}\r\n    @observable private resId: string;\r\n\r\n    protected async internalStart():Promise<any> {\r\n        this.resId = this.value;\r\n        return new Promise<any>((resolve, reject) => {\r\n            nav.push(React.createElement(this.page, {resolve:resolve, reject:reject}), ()=>reject());\r\n        });\r\n    }\r\n\r\n    /*\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let ret = await this.resUploader.upload();\r\n        if (ret === null) {\r\n            this.overSize = true;\r\n            env.setTimeout('imageItemEdit upload', () => this.overSize = false, 3000);\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.value);\r\n    }\r\n    */\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let size:any = this.uiItem && this.uiItem.size;\r\n\r\n        /*\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>resolve(this.resId)}></button>;\r\n        let overSize:any;\r\n        if (this.overSize === true) {\r\n            overSize = <div className=\"text-danger\">\r\n                <i className=\"fa fa-times-circle\" /> 2M\r\n            </div>;\r\n        }\r\n        */\r\n        return <ImageUploader \r\n            label={'' + this.label}\r\n            id={this.resId}\r\n            size={size}\r\n            onSaved={(resId):Promise<void>=>{resolve(resId); return;}} />;\r\n        /*\r\n        return <Page header={'' + this.label} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div></div>\r\n                    <div className=\"my-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} multiple={false} maxSize={2048} />\r\n                    </div>\r\n                    <div>\r\n                        <button className=\"btn btn-primary\" onClick={this.upload}></button>\r\n                    </div>\r\n                </div>\r\n                {overSize}\r\n                <div className=\"small muted my-4\">JPGGIFPNG2M</div>\r\n                <div className=\"d-flex\">\r\n                    <div className=\"w-12c h-12c mr-4\"\r\n                        style={{border: '1px dotted gray', padding: '8px'}}>\r\n                        <Image className=\"w-100 h-100\" src={this.resId} />\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"small\"></div>\r\n                        <Image className=\"w-4c h-4c mt-3\" src={this.resId} />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n        */\r\n    })\r\n}\r\n","import _ from 'lodash';\r\nimport {observable, IObservableArray, computed} from 'mobx';\r\n\r\nexport abstract class PageItems<T> {\r\n    constructor(itemObservable:boolean = false) {\r\n\t\tif (itemObservable === undefined) itemObservable = false;\r\n        this._items = observable.array<T>([], {deep:itemObservable});\r\n    }\r\n\tprivate isFirst: boolean = true;\r\n\tprivate pageItemAction: (item:T, results:{[name:string]:any[]}) => void;\r\n\tprivate itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T;\r\n    @observable loading: boolean = false;\r\n    @observable private beforeLoad: boolean = true;\r\n    @observable protected loaded: boolean = false;\r\n    protected _items:IObservableArray<T>;\r\n    @observable allLoaded: boolean = false;\r\n    @computed get items():IObservableArray<T> {\r\n        if (this.beforeLoad === true) return null;\r\n        if (this.loaded === false) return undefined;\r\n        return this._items;\r\n\t}\r\n\t\r\n\tsetEachPageItem(pageItemAction: (item:T, results:{[name:string]:any[]}) => void) {\r\n\t\tthis.pageItemAction = pageItemAction;\r\n\t}\r\n\r\n\tsetItemConverter(itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T) {\r\n\t\tthis.itemConverter = itemConverter;\r\n\t}\r\n\r\n    @observable topDiv:string = '$$top';\r\n    @observable bottomDiv:string = '$$bottom';\r\n    scrollToTop = () => {\r\n\t\tthis.scrollIntoView(this.topDiv);\r\n\t\t//let id = '$$top'+uid();\r\n\t\t//this.topDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.topDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n    }\r\n    scrollToBottom = () => {\r\n\t\tthis.scrollIntoView(this.bottomDiv);\r\n\t\t//let id = '$$bottom'+uid();\r\n\t\t//this.bottomDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.bottomDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n\t}\r\n\tprivate scrollIntoView(divId:string) {\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(divId);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t}\r\n\r\n    protected param: any;\r\n    protected firstSize = 100;\r\n    protected pageStart:any = undefined;\r\n    protected pageSize = 30;\r\n    protected appendPosition:'head'|'tail' = 'tail';\r\n\r\n\tprotected sortOrder:'asc'|'desc';\r\n\tprotected abstract loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}>;\r\n\tprotected getPageId(item:T):any {return;}\r\n\tprotected setPageStart(item:T) {\r\n\t\tthis.pageStart = this.getPageId(item);\r\n\t}\r\n\t\r\n\tprotected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n\t\tlet results = await this.loadResults(param, pageStart, pageSize);\r\n\t\tlet pageList = results.$page;\r\n\t\tif (this.itemConverter) {\r\n\t\t\tlet ret:T[] = [];\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = this.itemConverter(pageList[i], results);\r\n\t\t\t\tret.push(item);\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\tif (this.pageItemAction !== undefined) {\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tthis.pageItemAction(pageList[i], results);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn pageList;\r\n\t}\r\n\r\n    reset() {\r\n        this.isFirst = true;\r\n        this.beforeLoad = true;\r\n        this.loaded = false;\r\n        this.param = undefined;\r\n\t\tthis.allLoaded = false;\r\n\t\tthis.pageStart = undefined;\r\n        this._items.clear();\r\n        //this.setPageStart(undefined);\r\n    }\r\n\r\n    append(item:T) {\r\n        if (this.appendPosition === 'tail')\r\n            this._items.unshift(item);\r\n        else\r\n            this._items.push(item);\r\n    }\r\n\r\n    async first(param:any):Promise<void> {\r\n        this.reset();\r\n        this.beforeLoad = false;\r\n        this.param = param;\r\n        await this.more();\r\n\t}\r\n\r\n\tprivate changing = false;\r\n\tasync attach(): Promise<void> {\r\n\t\tif (this.sortOrder === undefined) {\r\n\t\t\tconsole.error('attach');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet items = this._items;\r\n\t\tlet isAsc = this.sortOrder === 'asc';\r\n\t\t//let isTail:boolean, \r\n\t\tlet endItem:T;\r\n\t\tlet scrollToEnd:() => void;\r\n\t\tlet pushItem:(item:T) => void;\r\n\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t//isTail = true;\r\n\t\t\tendItem = items[0];\r\n\t\t\tscrollToEnd = this.scrollToTop;\r\n\t\t\tpushItem = (item:T) => items.unshift(item);\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//isTail = false;\r\n\t\t\tlet endIndex = items.length;\r\n\t\t\tendItem = items[endIndex-1];\r\n\t\t\tscrollToEnd = this.scrollToBottom;\r\n\t\t\tpushItem = (item:T) => items.splice(endIndex, 0, item);\r\n\t\t}\r\n\t\tlet startId = this.getPageId(endItem);\r\n\t\tlet pid = undefined;\r\n\t\tlet sum = 0, max = 50;\r\n\t\tfor (;sum < max;) {\r\n\t\t\tlet ret = await this.load(this.param, pid, 3);\r\n\t\t\tlet len = ret.length;\r\n\t\t\tif (len === 0) break;\r\n\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = ret[i];\r\n\t\t\t\tpid = this.getPageId(item);\r\n\t\t\t\tif (isAsc === true) {\r\n\t\t\t\t\tif (pid >= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pid <= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpushItem(item);\r\n\t\t\t\t/*\r\n\t\t\t\tif (isTail === true) {\r\n\t\t\t\t\tthis._items.unshift(item);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._items.push(item);\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\t++sum;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.changing = false;\r\n\t\tif (sum > 0) {\r\n\t\t\tscrollToEnd();\r\n\t\t\t/*\r\n\t\t\tif (isTail === true) this.scrollToTop();\r\n\t\t\telse this.scrollToBottom();\r\n\t\t\t*/\r\n\t\t}\r\n\t}\r\n\r\n\tasync refresh(): Promise<void> {\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet ret = await this.load(this.param, undefined, this.firstSize>this.pageSize? this.firstSize:this.pageSize);\r\n\t\tthis._items.clear();\r\n\t\tthis.setLoaded(ret);\r\n\t\t/*\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet item = ret[i];\r\n\t\t\tlet pid = this.getRefreshPageId(item);\r\n\t\t\tlet index = this._items.findIndex(v => this.getRefreshPageId(v) === pid);\r\n\t\t\t//let index = _.sortedIndexBy(this._items, item, v=>this.getRefreshPageId(v));\r\n\t\t\t//let oldItem = this._items[index];\r\n\t\t\t//let oid = this.getRefreshPageId(oldItem);\r\n\t\t\tif (index >= 0) {\r\n\t\t\t\t_.merge(this._items[index], item);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.splice(0, 0, item);\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t\tthis.changing = false;\r\n\t}\r\n\r\n\tprotected getRefreshPageId(item:T) {\r\n\t\treturn this.getPageId(item);\r\n\t}\r\n\r\n    protected async onLoad(): Promise<void> {}\r\n    protected async onLoaded(): Promise<void> {}\r\n\r\n    async more():Promise<boolean> {\r\n        if (this.allLoaded === true) return false;\r\n\t\tif (this.loading === true) return true;\r\n\t\tif (this.changing === true) return true;\r\n\t\tthis.loading = true;\r\n\t\tthis.changing = true;\r\n        await this.onLoad();\r\n        if (this.pageStart === undefined) this.setPageStart(undefined);\r\n        let pageSize = this.pageSize + 1;\r\n        if (this.isFirst === true) {\r\n            if (this.firstSize > this.pageSize) pageSize = this.firstSize+1;\r\n        }\r\n        let ret = await this.load(\r\n                this.param, \r\n                this.pageStart,\r\n\t\t\t\tpageSize);\r\n        this.loaded = true;\r\n\t\tlet len = ret.length;\r\n        if ((this.isFirst===true && len>this.firstSize) ||\r\n            (this.isFirst===false && len>this.pageSize))\r\n        {\r\n            this.allLoaded = false;\r\n            --len;\r\n            ret.splice(len, 1);\r\n        }\r\n        else {\r\n            this.allLoaded = true;\r\n\t\t}\r\n\t\t/*\r\n        if (len === 0) {\r\n\t\t\tthis.setPageStart(undefined);\r\n            this._items.clear();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setPageStart(ret[len-1]);\r\n\t\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t\tthis._items.push(...ret);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.unshift(...ret.reverse());\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t\tthis.setLoaded(ret);\r\n\t\tthis.isFirst = false;\r\n\t\tthis.onLoaded();\r\n\t\tthis.changing = false;\r\n\t\tthis.loading = false;\r\n\t\treturn !this.allLoaded;\r\n\t}\r\n\t\r\n\tprivate setLoaded(data:any[]) {\r\n\t\tlet len = data.length;\r\n        if (len === 0) {\r\n\t\t\tthis.setPageStart(undefined);\r\n            this._items.clear();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setPageStart(data[len-1]);\r\n\t\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t\tthis._items.push(...data);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.unshift(...data.reverse());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfindItem(item:any):T {\r\n\t\tlet pid = this.getPageId(item);\r\n\t\tlet index = _.findIndex(this._items, v => this.getPageId(v) === pid);\r\n\t\tif (index < 0) return;\r\n\t\treturn this._items[index];\r\n\t\t//let oldItem = this._items[index];\r\n\t\t//let oid = this.getPageId(oldItem);\r\n\t\t//if (pid === oid) return oldItem;\r\n\t}\r\n}\r\n","class MessageHub {\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n    private msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n\tregisterReceiveHandler(handler:(msg:any)=>Promise<void>):number;\r\n\tregisterReceiveHandler(type:string, handler:(msg:any)=>Promise<void>):number;\t\r\n    registerReceiveHandler(...args:any[]):number {\r\n\t\tlet seed = this.handlerSeed++;\r\n\t\tlet args0 = args[0];\r\n\t\tlet handler:(msg:any)=>Promise<void>;\r\n\t\tswitch (typeof args0) {\r\n\t\t\tcase 'string':\r\n\t\t\t\thandler = args[1];\r\n\t\t\t\tthis.msgHandlers[seed] = {type:args0, handler};\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis.anyHandlers[seed] = args0;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn seed;\r\n    }\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n    }\r\n    async dispatch(msg:any) {\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n        }\r\n    }\r\n}\r\n\r\nexport const messageHub = new MessageHub();\r\n","// typescript version of krasimir/navigo\r\n\r\nexport type RouteFunc = (params?:string|{[name:string]:string}, query?:string) => void;\r\n\r\nexport interface NamedRoute {\r\n\tas: string;\r\n\tuses: RouteFunc;\r\n\thooks?: Hooks;\r\n}\r\nexport interface Hooks {\r\n\tbefore: (done:()=>void, params:object) => void;\r\n\tafter: (params:object) => void;\r\n\tleave: (params:object) => void;\r\n\talready: (params:object) => void;\r\n}\r\ninterface Handler {\r\n\thandler: RouteFunc;\r\n\thooks: Hooks;\r\n}\r\ninterface LastResolved {\r\n\turl: string;\r\n\tquery: string;\r\n\thooks: Hooks;\r\n\tparams?: {[name:string]:string};\r\n\tname?: string;\r\n}\r\ninterface Route {\r\n\troute: string|RegExp;\r\n\thandler: RouteFunc,\r\n\tname: string,\r\n\thooks: Hooks\r\n}\r\n\r\nexport class Navigo {\r\n\tprivate static PARAMETER_REGEXP = /([:*])(\\w+)/g;\r\n\tprivate static WILDCARD_REGEXP = /\\*/g;\r\n\tprivate static REPLACE_VARIABLE_REGEXP = '([^\\\\/]+)';   \t// \\ ([^\\/]+)\r\n\tprivate static REPLACE_WILDCARD = `(?:.*)`;\r\n\tprivate static FOLLOWED_BY_SLASH_REGEXP = '(?:\\\\/$|$)';\t\t// \\ (?:\\/$|$)\r\n\tprivate static MATCH_REGEXP_FLAGS = '';\r\n\r\n\tprivate static isPushStateAvailable() {\r\n\t\treturn !!(\r\n\t\t  typeof window !== 'undefined' &&\r\n\t\t  window.history &&\r\n\t\t  window.history.pushState\r\n\t\t);\r\n\t}\r\n\t\r\n\tprivate static clean(s:string|RegExp) {\r\n\t\tif (s instanceof RegExp) return s;\r\n\t\treturn Navigo.cleanUrl(s);\r\n\t}\r\n\tprivate static cleanUrl(s:string) {\r\n\t\treturn s.replace(/\\/+$/, '').replace(/^\\/+/, '^/');\r\n\t}\r\n\r\n\tprivate static regExpResultToParams(match:any[], names:string[]) {\r\n\t\tif (names.length === 0) return null;\r\n\t\tif (!match) return null;\r\n\t\treturn match\r\n\t\t  .slice(1, match.length)\r\n\t\t  .reduce((params, value, index) => {\r\n\t\t\t\tif (params === null) params = {};\r\n\t\t\t\tparams[names[index]] = decodeURIComponent(value);\r\n\t\t\t\treturn params;\r\n\t\t  }, null);\r\n\t}\r\n\t  \r\n\tprivate static replaceDynamicURLParts(route:string|RegExp) {\r\n\t\tlet paramNames:string[] = [], regexp:RegExp;\r\n\t  \r\n\t\tif (route instanceof RegExp) {\r\n\t\t\tregexp = route;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tregexp = new RegExp(\r\n\t\t\t\troute.replace(Navigo.PARAMETER_REGEXP, function (full, dots, name) {\r\n\t\t\t\t\t\tparamNames.push(name);\r\n\t\t\t\t\t\treturn Navigo.REPLACE_VARIABLE_REGEXP;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.replace(Navigo.WILDCARD_REGEXP, Navigo.REPLACE_WILDCARD) + Navigo.FOLLOWED_BY_SLASH_REGEXP\r\n\t\t\t\t, Navigo.MATCH_REGEXP_FLAGS);\r\n\t\t}\r\n\t\treturn { regexp, paramNames };\r\n\t}\r\n\t  \r\n\tprivate static getUrlDepth(url:string):number {\r\n\t\treturn url.replace(/\\/$/, '').split('/').length;\r\n\t}\r\n\t  \r\n\tprivate static compareUrlDepth(urlA:string, urlB:string) {\r\n\t\treturn Navigo.getUrlDepth(urlB) - Navigo.getUrlDepth(urlA);\r\n\t}\r\n\t  \r\n\tprivate static findMatchedRoutes(url:string, routes:Route[] = []) {\r\n\t\treturn routes.map(route => {\r\n\t\t\tlet { regexp, paramNames } = Navigo.replaceDynamicURLParts(Navigo.clean(route.route));\r\n\t\t\tlet match = url.replace(/^\\/+/, '/').match(regexp);\r\n\t\t\tlet params = Navigo.regExpResultToParams(match, paramNames);\r\n\t\t\treturn match ? { match, route, params } : false;\r\n\t\t}).filter(m => m);\r\n\t}\r\n\t  \r\n\tprivate static match(url:string, routes:Route[]) {\r\n\t\treturn Navigo.findMatchedRoutes(url, routes)[0] || false;\r\n\t}\r\n\t  \r\n\tprivate static root(url:string, routes:Route[]) {\r\n\t\tconst colonExp = RegExp('\\\\/:\\\\D(\\\\w*)', 'g');\r\n\t\tconst exp = ''; // '($|\\\\/)';  // \\ ($|\\/)\r\n\t\tlet matched = routes.map(\r\n\t\t\troute => {\r\n\t\t\t\tlet r = route.route;\r\n\t\t\t\tif (r === '' || r === '*') return url;\r\n\t\t\t\tif (typeof r === 'string') {\r\n\t\t\t\t\tr = r.replace(colonExp, '\\\\/(\\\\w|%|[\\u4E00-\\u9FCC])+');\r\n\t\t\t\t}\r\n\t\t\t\tlet routeExp = r + exp;\r\n\t\t\t\tlet ret = url.split(new RegExp(routeExp))[0];\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t);\r\n\t\tlet fallbackURL = Navigo.cleanUrl(url);\r\n\t\tlet len = matched.length;\r\n\t\tif (len === 0) return fallbackURL;\r\n\t\tlet matched0 = matched[0];\r\n\t\tif (len === 1) return matched0;\r\n\t\treturn matched.reduce((result, url) => {\r\n\t\t\tif (result.length > url.length) result = url;\r\n\t\t\treturn result;\r\n\t\t}, matched0);\r\n\t}\r\n\t  \r\n\tprivate static isHashChangeAPIAvailable() {\r\n\t\treturn typeof window !== 'undefined' && 'onhashchange' in window;\r\n\t}\r\n\t  \r\n\tprivate static extractGETParameters(url:string):string {\r\n\t\treturn url.split(/\\?(.*)?$/).slice(1).join('');\r\n\t}\r\n\t  \r\n\tprivate static getOnlyURL(url:string, useHash:boolean, hash:string) {\r\n\t\tlet onlyURL = url, split:string[];\r\n\t\tvar cleanGETParam = (str:string) => str.split(/\\?(.*)?$/)[0];\r\n\t  \r\n\t\tif (typeof hash === 'undefined') {\r\n\t\t\t// To preserve BC\r\n\t\t\thash = '#';\r\n\t\t}\r\n\t  \r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t  \tonlyURL = cleanGETParam(url).split(hash)[0];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsplit = url.split(hash);\r\n\t\t\tonlyURL = split.length > 1 ? cleanGETParam(split[1]) : cleanGETParam(split[0]);\r\n\t\t}\r\n\t\treturn onlyURL;\r\n\t}\r\n\t  \r\n\tprivate static manageHooks(handler:RouteFunc, hooks:Hooks, params?:any, exHooks?:Hooks) {\r\n\t\tif (hooks && typeof hooks === 'object') {\r\n\t\t\tif (hooks.before) {\r\n\t\t\t\thooks.before((shouldRoute = true) => {\r\n\t\t\t\tif (!shouldRoute) return;\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\t}, params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if (hooks.after) {\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\thandler();\r\n\t}\r\n\t  \r\n\tprivate static isHashedRoot(url:string, useHash:boolean, hash:string) {\r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t  return false;\r\n\t\t}\r\n\t  \r\n\t\tif (!url.match(hash)) {\r\n\t\t  return false;\r\n\t\t}\r\n\t  \r\n\t\tlet split = url.split(hash);\r\n\t  \r\n\t\treturn split.length < 2 || split[1] === '';\r\n\t}\r\n\t\r\n\tprivate root:string;\r\n\tprivate _routes:Route[] = [];\r\n\tprivate _useHash:boolean;\r\n\tprivate _hash:string;\r\n\tprivate _paused:boolean;\r\n\tprivate _destroyed:boolean;\r\n\tprivate _lastRouteResolved:LastResolved;\r\n\tprivate _notFoundHandler:Handler;\r\n\tprivate _defaultHandler:Handler;\r\n\tprivate _usePushState:boolean;\r\n\tprivate _genericHooks:Hooks;\r\n\tprivate _historyUpdateMethod: 'pushState' | 'replaceState'; // HistoryUpdateMethod;\r\n\tprivate timout: any; //NodeJS.Timeout;\r\n\r\n\tconstructor(r:string = null, useHash:boolean = false, hash:string = '#') {\r\n\t\tthis.root = null;\r\n\t\tthis._useHash = useHash;\r\n\t\tthis._hash = (!hash)? '#' : hash;\r\n\t\tthis._paused = false;\r\n\t\tthis._destroyed = false;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._notFoundHandler = null;\r\n\t\tthis._defaultHandler = null;\r\n\t\tthis._usePushState = !useHash && Navigo.isPushStateAvailable();\r\n\t\t//this._onLocationChange = this._onLocationChange.bind(this);\r\n\t\tthis._genericHooks = null;\r\n\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\r\n\t\tif (r) {\r\n\t\t\tthis.root = useHash ? r.replace(/\\/$/, '/' + this._hash) : r.replace(/\\/$/, '');\r\n\t\t} else if (useHash) {\r\n\t\t\tthis.root = this._cLoc().split(this._hash)[0].replace(/\\/$/, '/' + this._hash);\r\n\t\t}\r\n\t\r\n\t\tthis._listen();\r\n\t\tthis.updatePageLinks();\r\n\t}\r\n  \r\n\tnavigate(path:string, absolute:boolean = false):Navigo {\r\n\t\tlet to:string;\r\n\t\tpath = path || '';\r\n\t\tif (this._usePushState) {\r\n\t\t\tto = (!absolute ? this._getRoot() + '/' : '') + path.replace(/^\\/+/, '/');\r\n\t\t\tto = to.replace(/([^:])(\\/{2,})/g, '$1/');\r\n\t\t\tto = to.replace('/#test/', '/');\r\n\t\t\tthis._historyUpdate({}, '', to);\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t\telse if (typeof window !== 'undefined') {\r\n\t\t\tpath = path.replace(new RegExp('^' + this._hash), '');\r\n\t\t\tlet {location} = window;\r\n\t\t\tlocation.href = location.href\r\n\t\t\t\t.replace(/#$/, '')\r\n\t\t\t\t.replace(new RegExp(this._hash + '.*$'), '') + this._hash + path;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\ton(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\ton(...args:any[]):Navigo {\r\n\t\tlet arg0 = args[0];\r\n\t\tlet arg1 = args[1];\r\n\t\tswitch (typeof arg0) {\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis._defaultHandler = { handler: arg0, hooks: arg1 };\r\n\t\t\t\tif (!this._notFoundHandler) {\r\n\t\t\t\t\tthis._notFoundHandler = this._defaultHandler;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'object':\r\n\t\t\t\tlet orderedRoutes = Object.keys(arg0).sort(Navigo.compareUrlDepth);\r\n\t\t\t\torderedRoutes.forEach(route => this.on(route, arg0[route]));\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tif (args.length < 2) break;\r\n\t\t\t\tif (arg0 === '/') {\r\n\t\t\t\t\tthis._defaultHandler = { \r\n\t\t\t\t\t\thandler: typeof arg1 === 'object'? arg1.uses : arg1, \r\n\t\t\t\t\t\thooks: args[2],\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tthis._add(arg0, arg1, args[2]);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\toff(handler:RouteFunc):Navigo {\r\n\t\tif (this._defaultHandler !== null && handler === this._defaultHandler.handler) {\r\n\t\t\tthis._defaultHandler = null;\r\n\t\t}\r\n\t\telse if (this._notFoundHandler !== null && handler === this._notFoundHandler.handler) {\r\n\t\t\tthis._notFoundHandler = null;\r\n\t\t}\r\n\t\tthis._routes = this._routes.reduce((result, r) => {\r\n\t\t\tif (r.handler !== handler) result.push(r);\r\n\t\t\treturn result;\r\n\t\t}, []);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tnotFound(handler:RouteFunc, hooks:Hooks):Navigo {\r\n\t\tthis._notFoundHandler = { handler, hooks };\r\n\t\treturn this;\r\n\t}\r\n\r\n\tresolve(current?:string) {\r\n\t\tlet c = current || this._cLoc();\r\n\t\tlet root = this._getRoot();\r\n\t\tlet url = c.replace(root, '');\r\n\t\r\n\t\tif (this._useHash) {\r\n\t\t\tconst exp = '^\\\\/';  // \\ ^\\/\r\n\t\t\turl = url.replace(new RegExp(exp + this._hash), '/');\r\n\t\t}\r\n\t\r\n\t\tlet GETParameters = Navigo.extractGETParameters(current || this._cLoc());\r\n\t\tlet onlyURL = Navigo.getOnlyURL(url, this._useHash, this._hash);\r\n\t\tif (onlyURL.startsWith('/') === false) {\r\n\t\t\tonlyURL = '/' + onlyURL;\r\n\t\t}\r\n\t\r\n\t\tif (this._paused) return false;\r\n\t\r\n\t\tif (\r\n\t\t\tthis._lastRouteResolved &&\r\n\t\t\tonlyURL === this._lastRouteResolved.url &&\r\n\t\t\tGETParameters === this._lastRouteResolved.query\r\n\t\t) {\r\n\t\t\tif (this._lastRouteResolved.hooks && this._lastRouteResolved.hooks.already) {\r\n\t\t\t\tthis._lastRouteResolved.hooks.already(this._lastRouteResolved.params);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\r\n\t\tlet matched = Navigo.match(onlyURL, this._routes);\r\n\t\r\n\t\tlet manageHooks = (handler:Handler) => {\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\thooks: handler.hooks\r\n\t\t\t\t\t};\r\n\t\t\t\t\thandler.handler(GETParameters);\r\n\t\t\t\t}, handler.hooks);\r\n\t\t\t}, this._genericHooks);\r\n\t\t}\r\n\r\n\t\tif (matched === false) {\r\n\t\t\tif (this._defaultHandler && (\r\n\t\t\t\tonlyURL === '' ||\r\n\t\t\t\tonlyURL === '/' ||\r\n\t\t\t\tonlyURL === this._hash ||\r\n\t\t\t\tNavigo.isHashedRoot(onlyURL, this._useHash, this._hash)\r\n\t\t\t)) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\t\thooks: this._defaultHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._defaultHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._defaultHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._defaultHandler);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse if (this._notFoundHandler) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters,\r\n\t\t\t\t\t\t\thooks: this._notFoundHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._notFoundHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._notFoundHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._notFoundHandler);\r\n\t\t\t}\r\n\t\t\treturn false;\t\r\n\t\t}\r\n\t\tlet m = matched;\r\n\t\tif (m) {\r\n\t\t\tthis._callLeave();\r\n\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\turl: onlyURL,\r\n\t\t\t\tquery: GETParameters,\r\n\t\t\t\thooks: m.route.hooks,\r\n\t\t\t\tparams: m.params,\r\n\t\t\t\tname: m.route.name\r\n\t\t\t};\r\n\t\t\tlet handler = m.route.handler;\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tm.route.route instanceof RegExp ?\r\n\t\t\t\t\thandler(...(m.match.slice(1, m.match.length))) :\r\n\t\t\t\t\thandler(m.params, GETParameters);\r\n\t\t\t\t}, m.route.hooks, m.params, this._genericHooks);\r\n\t\t\t}, this._genericHooks, m.params);\r\n\t\t\treturn m;\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis._routes = [];\r\n\t\tthis._destroyed = true;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._genericHooks = null;\r\n\t\tclearTimeout(this.timout);\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\twindow.removeEventListener('popstate', this._onLocationChange);\r\n\t\t\twindow.removeEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t}\r\n\r\n\tupdatePageLinks() {\r\n\t\t//var self = this;\r\n\t\tif (typeof document === 'undefined') return;\r\n\t\t\tthis._findLinks().forEach(link => {\r\n\t\t\tif (!link.hasListenerAttached) {\r\n\t\t\t\tlink.addEventListener('click', (e: React.MouseEvent<HTMLElement>) => {\r\n\t\t\t\t\tif((e.ctrlKey || e.metaKey) && e.currentTarget.tagName.toLowerCase() === 'a'){ return false; }\r\n\t\t\t\t\tvar location = this.getLinkPath(link);\r\n\t\t\r\n\t\t\t\t\tif (!this._destroyed) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tthis.navigate(location.replace(/\\/+$/, '').replace(/^\\/+/, '/'));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tlink.hasListenerAttached = true;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgenerate(name:string, data:any = {}) {\r\n\t\tlet result = this._routes.reduce((result, route) => {\r\n\t\t\tif (route.name === name) {\r\n\t\t\t\tresult = route.route.toString();\r\n\t\t\t\tfor (let key in data) {\r\n\t\t\t\t\tresult = result.replace(':' + key, data[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}, '');\r\n\t\r\n\t\treturn this._useHash ? this._hash + result : result;\r\n\t}\r\n\r\n\tlink(path:string) {\r\n\t\treturn this._getRoot() + path;\r\n\t}\r\n\r\n\tpause(status:boolean = true) {\r\n\t\tthis._paused = status;\r\n\t\tif (status) {\r\n\t\t\tthis._historyUpdateMethod = 'replaceState';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\t}\r\n\t}\r\n\r\n\tresume() {\r\n\t\tthis.pause(false);\r\n\t}\r\n\r\n\thistoryAPIUpdateMethod(value:'pushState' | 'replaceState') {\r\n\t\tif (typeof value === 'undefined') return this._historyUpdateMethod;\r\n\t\tthis._historyUpdateMethod = value;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tdisableIfAPINotAvailable() {\r\n\t\tif (!Navigo.isPushStateAvailable()) {\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tlastRouteResolved() {\r\n\t\treturn this._lastRouteResolved;\r\n\t}\r\n\r\n\tgetLinkPath(link:any) {\r\n\t\treturn link.getAttribute('href');\r\n\t}\r\n\r\n\thooks(hooks:Hooks) {\r\n\t\tthis._genericHooks = hooks;\r\n\t}\r\n\r\n\tprivate _add(route:string|RegExp, handler:RouteFunc|NamedRoute, hooks:Hooks) {\r\n\t\tif (typeof route === 'string') {\r\n\t\t\troute = encodeURI(route);\r\n\t\t}\r\n\t\tthis._routes.push(\r\n\t\t\ttypeof handler === 'object' ?\r\n\t\t\t{\r\n\t\t\t\troute,\r\n\t\t\t\thandler: handler.uses,\r\n\t\t\t\tname: handler.as,\r\n\t\t\t\thooks: hooks || handler.hooks\r\n\t\t\t} \r\n\t\t\t:\r\n\t\t\t{\r\n\t\t\t\troute,\r\n\t\t\t\thandler, \r\n\t\t\t\tname: undefined,\r\n\t\t\t\thooks,\r\n\t\t\t}\r\n\t\t);\r\n\t\treturn this._add;\r\n\t}\r\n\r\n\tprivate _historyUpdate(data:any, title:string, url?:string) {\r\n\t\tswitch (this._historyUpdateMethod) {\r\n\t\t\tdefault: throw Error('unknow history method ' + this._historyUpdateMethod);\r\n\t\t\tcase 'pushState': window.history.pushState(data, title, url); return;\r\n\t\t\tcase 'replaceState': window.history.replaceState(data, title, url); return;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _getRoot() {\r\n\t\tif (this.root === null) {\r\n\t\t\tlet cLoc = this._cLoc();\r\n\t\t\tlet cLocRoot = cLoc.split('?')[0];\r\n\t\t\tthis.root = Navigo.root(cLocRoot, this._routes);\r\n\t\t}\r\n\t\tlet root = this.root.replace('#test', '');\r\n\t\treturn root;\r\n\t}\r\n\r\n\tprivate _listen() {\r\n\t\tif (this._usePushState) {\r\n\t\t\twindow.addEventListener('popstate', this._onLocationChange);\r\n\t\t}\r\n\t\telse if (Navigo.isHashChangeAPIAvailable()) {\r\n\t\t\twindow.addEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet cached = this._cLoc();\r\n\t\r\n\t\t\tlet check = () => {\r\n\t\t\t\tlet current = this._cLoc();\r\n\t\t\t\tif (cached !== current) {\r\n\t\t\t\t\tcached = current;\r\n\t\t\t\t\tthis.resolve();\r\n\t\t\t\t}\r\n\t\t\t\tif (this.timout) clearTimeout(this.timout);\r\n\t\t\t\tthis.timout = setTimeout(check, 200);\r\n\t\t\t};\r\n\t\t\tcheck();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _cLoc() {\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\t//if (typeof window.__NAVIGO_WINDOW_LOCATION_MOCK__ !== 'undefined') {\r\n\t\t\t//\treturn window.__NAVIGO_WINDOW_LOCATION_MOCK__;\r\n\t\t\t//}\r\n\t\t\tlet {href} = window.location;\r\n\t\t\treturn Navigo.cleanUrl(href);\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate _findLinks() {\r\n\t\treturn [].slice.call(document.querySelectorAll('[data-navigo]'));\r\n\t}\r\n\r\n\tprivate _onLocationChange = () => {\r\n\t\tconsole.log('_onLocationChange');\r\n\t\tthis.resolve();\r\n\t}\r\n\r\n\tprivate _callLeave() {\r\n\t\tconst lastRouteResolved = this._lastRouteResolved;\t\r\n\t\tif (lastRouteResolved) {\r\n\t\t\tlet {params, hooks} = lastRouteResolved;\r\n\t\t\tif (hooks) {\r\n\t\t\t\tif (hooks.leave) {\r\n\t\t\t\t\thooks.leave(params);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//export default Navigo;\r\nexport const navigo = new Navigo();\r\n","import * as React from 'react';\r\nimport {nav} from '../nav';\r\n\r\nexport interface PageHeaderProps {\r\n    back?: 'back' | 'close' | 'none';\r\n    center: string | JSX.Element;\r\n    right?: JSX.Element;\r\n    logout?: boolean | (()=>Promise<void>);\r\n    className?: string;\r\n\tafterBack?: () => void;\r\n\tex?: JSX.Element;\r\n}\r\n\r\nexport function renderPageHeader(props: PageHeaderProps, inWebNav?: boolean) {\r\n    let onBack = async () => {\r\n        await nav.back(); // confirm boxdataForm\r\n\t\tlet {afterBack} = props;\r\n\t\tif (afterBack) afterBack();\r\n    }\r\n    let onLogoutClick = () => {\r\n\t\tlet logout = async () => {\r\n\t\t\tlet {logout} = props;\r\n\t\t\tif (typeof logout === 'function') {\r\n\t\t\t\tawait logout(); \r\n\t\t\t}\r\n\t\t\tawait nav.logout(undefined);\r\n\t\t}\r\n\t\tnav.showLogout(logout);\r\n    }\r\n\r\n\tlet b = nav.level > 1 || window.self !== window.top;\r\n\tlet {back, right, center, logout, className, ex} = props;\r\n\tif (inWebNav === true &&  !back && !right && !center) return;\r\n\tlet vBack:any, debugLogout:any;\r\n\tif (logout !== undefined && window.self === window.top) {\r\n\t\tif ((typeof logout === 'boolean' && logout === true)\r\n\t\t\t|| typeof logout === 'function')\r\n\t\t{\r\n\t\t\tlet {user} = nav;\r\n\t\t\tif (user !== undefined) {\r\n\t\t\t\tlet {nick, name} = user;\r\n\t\t\t\tdebugLogout = <div className=\"d-flex align-items-center\">\r\n\t\t\t\t\t<small className=\"text-light\">{nick || name}</small>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\t\t<div className=\"ml-2 py-2 px-3 cursor-pointer\"\r\n\t\t\t\t\t\t\trole=\"button\"\r\n\t\t\t\t\t\t\tonClick={onLogoutClick}>\r\n\t\t\t\t\t\t\t<i className=\"fa fa-sign-out fa-lg\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (b) {\r\n\t\tswitch (props.back) {\r\n\t\t\tcase 'none':\r\n\t\t\t\tvBack = undefined;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\tcase 'back':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{nav.backIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'close':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{nav.backIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (window.self !== window.top) {\r\n\t\tconsole.log(document.location.href);\r\n\t\t// pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n\t}\r\n\tif (vBack === undefined && typeof center === 'string') {\r\n\t\tcenter = <div className=\"px-3\">{center}</div>;\r\n\t}\r\n\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\tlet header = <header className={className}>\r\n\t\t<nav>\r\n\t\t\t{vBack}\r\n\t\t\t{/*pop window */}\r\n\t\t\t<div>{center}</div>\r\n\t\t\t{rightView}\r\n\t\t</nav>\r\n\t\t{ex}\r\n\t</header>;\r\n\tif (inWebNav === true) return header;\r\n\treturn <>\r\n\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t{header}\r\n\t</>;\r\n}\r\n\r\nexport class PageHeader extends React.Component<PageHeaderProps> {\r\n\trender() {return renderPageHeader(this.props)}\r\n\t/*\r\n    private back = async () => {\r\n        await nav.back(); // confirm boxdataForm\r\n\t\tlet {afterBack} = this.props;\r\n\t\tif (afterBack) afterBack();\r\n    }\r\n    openWindow() {\r\n        window.open(document.location.href);\r\n    }\r\n    private logoutClick = () => {\r\n        nav.showLogout(this.logout);\r\n    }\r\n    private logout = async () => {\r\n        let {logout} = this.props;\r\n        if (typeof logout === 'function') {\r\n            await logout(); \r\n        }\r\n        await nav.logout(undefined);\r\n    }\r\n    render() {\r\n        let b = nav.level > 1 || window.self !== window.top;\r\n        let {right, center, logout, className, ex} = this.props;\r\n        let back:any, debugLogout:any;\r\n        if (logout !== undefined && window.self === window.top) {\r\n            if ((typeof logout === 'boolean' && logout === true)\r\n                || typeof logout === 'function')\r\n            {\r\n                let {user} = nav;\r\n                if (user !== undefined) {\r\n                    let {nick, name} = user;\r\n                    debugLogout = <div className=\"d-flex align-items-center\">\r\n                        <small className=\"text-light\">{nick || name}</small>\r\n                        {\r\n                            // eslint-disable-next-line\r\n                            <div className=\"ml-2 py-2 px-3 cursor-pointer\"\r\n                                role=\"button\"\r\n                                onClick={this.logoutClick}>\r\n                                <i className=\"fa fa-sign-out fa-lg\" />\r\n                            </div>\r\n                        }\r\n                    </div>;\r\n                }\r\n            }\r\n        }\r\n        if (b) {\r\n            switch (this.props.back) {\r\n                case 'none':\r\n                    back = undefined;\r\n                    break;\r\n                default:\r\n                case 'back':\r\n                    back = <nav onClick={this.back}><i className=\"fa fa-angle-left\" /></nav>;\r\n                    break;\r\n                case 'close':\r\n                    back = <nav onClick={this.back}><i className=\"fa fa-close\" /></nav>;\r\n                    break;\r\n            }\r\n        }\r\n        if (window.self !== window.top) {\r\n            console.log(document.location.href);\r\n            // pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n        }\r\n        if (back === undefined && typeof center === 'string') {\r\n            center = <div className=\"px-3\">{center}</div>;\r\n        }\r\n\t\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\t\tlet header = <header className={className}>\r\n\t\t\t<nav>\r\n\t\t\t\t{back}\r\n\t\t\t\t<div>{center}</div>\r\n\t\t\t\t{rightView}\r\n\t\t\t</nav>\r\n\t\t\t{ex}\r\n\t\t</header>;\r\n        return <>\r\n\t\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t\t{header}\r\n\t\t</>;\r\n\t}\r\n\t*/\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport { IVPage } from './page';\r\nimport { IObservableValue } from 'mobx';\r\nimport '../../css/va-tab.css';\r\nimport { ScrollView } from './scrollView';\r\n\r\nexport type TabCaption = (selected:boolean) => JSX.Element;\r\n\r\nexport interface TabProp {\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontent?: () => JSX.Element;\r\n\tpage?: IVPage;\r\n    notify?: IObservableValue<number>;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tisSelected?: boolean;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n}\r\n\r\nexport interface TabsProps {\r\n    tabs: TabProp[];\r\n    tabPosition?: 'top' | 'bottom';\r\n    size?: 'sm' | 'lg' | 'md';\r\n    tabBg?: string;\r\n    contentBg?: string;\r\n    sep?: string;\r\n    selected?: string;\r\n    borderColor?: string;\r\n    borderWidth?: string;\r\n}\r\n\r\nclass Tab {\r\n\t@observable private loaded: boolean = false;\r\n    name: string;\r\n    @observable selected: boolean;\r\n    caption: TabCaption;\r\n\tcontentBuilder: ()=>JSX.Element;\r\n\tpage: IVPage;\r\n    notify: IObservableValue<number>;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n\r\n    private _content: JSX.Element;\r\n    \r\n    get content(): JSX.Element {\r\n\t\tif (this.load && this.loaded === false) return null;\r\n\t\tif (this.selected === false) return this._content;\r\n\t\tif (!this._content) {\r\n\t\t\tif (this.contentBuilder !== undefined) {\r\n\t\t\t\tthis._content = this.contentBuilder();\r\n\t\t\t}\r\n\t\t\telse if (this.page !== undefined) {\r\n\t\t\t\tthis._content = this.page.content();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._content = <div className=\"p-5\">tab contentpage</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._content;\r\n    }\r\n\r\n    async shown() {\r\n        if (this.onShown !== undefined) {\r\n            await this.onShown();\r\n        }\r\n        if (this.load !== undefined) {\r\n\t\t\tif (this.loaded === false) {\r\n\t\t\t\tawait this.load();\r\n\t\t\t\tthis.loaded = true;\r\n\t\t\t}\r\n        }\r\n    }\r\n}\r\n\r\nexport const TabCaptionComponent = (label:string, icon:string, color:string) => <div \r\n    className={'d-flex justify-content-center align-items-center flex-column cursor-pointer ' + color}>\r\n    <div><i className={'fa fa-lg fa-' + icon} /></div>\r\n    <small>{label}</small>\r\n</div>;\r\n\r\n//export const TabCaption = TabCaptionComponent;\r\n\r\nexport class TabsView {\r\n\tprivate props: TabsProps;\r\n    private size: string;\r\n    private tabBg: string;\r\n    //private contentBg: string;\r\n    private sep: string;\r\n    @observable private selectedTab: Tab;\r\n    @observable private tabArr: Tab[];\r\n\r\n    constructor(props: TabsProps) {\r\n\t\tthis.props = props;\r\n\t\tlet {size, tabs, tabBg: tabBack, sep, selected} = props;\r\n\t\tthis.size = size || 'md';\r\n        this.tabArr = tabs.map(v => {\r\n            let tab = new Tab();\r\n            let {name, caption, content, page, notify, load, onShown, isSelected, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\ttab.name = name;\r\n\t\t\tif (isSelected === true || name === selected) {\r\n\t\t\t\tthis.selectedTab = tab;\r\n\t\t\t}\r\n\t\t\ttab.selected = false;\r\n\t\t\ttab.caption = caption;\r\n\t\t\tif (content !== undefined) {\r\n\t\t\t\ttab.contentBuilder = content;\r\n\t\t\t}\r\n\t\t\telse if (page !== undefined) {\r\n\t\t\t\ttab.page = page;\r\n\t\t\t\t//contentBuilder = () => {return page.content()};\r\n\t\t\t}\r\n            tab.notify = notify;\r\n            tab.load = load;\r\n\t\t\ttab.onShown = onShown;\r\n\t\t\ttab.onScroll = onScroll;\r\n\t\t\ttab.onScrollTop = onScrollTop;\r\n\t\t\ttab.onScrollBottom = onScrollBottom;\r\n\t\t\ttab.className = className;\r\n            return tab;\r\n        });\r\n        this.tabBg = tabBack;\r\n        //this.contentBg = contentBack;\r\n        this.sep = sep;\r\n        if (this.selectedTab === undefined) {\r\n\t\t\tthis.selectedTab = this.tabArr[0];\r\n\t\t}\r\n        this.selectedTab.selected = true;\r\n    }\r\n\r\n    tabClick = async (tab:Tab) => {\r\n\t\tif (!tab) {\r\n\t\t\ttab = this.selectedTab;\r\n\t\t\tif (tab === undefined) {\r\n\t\t\t\tif (this.tabArr === undefined) return;\r\n\t\t\t\tif (this.tabArr.length === 0) return;\r\n\t\t\t\ttab = this.tabArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\r\n        this.selectedTab.selected = false;\r\n        tab.selected = true;\r\n\t\tthis.selectedTab = tab;\r\n\t\t\r\n\t\tawait tab.shown();\r\n    }\r\n\r\n\t/*\r\n    showTab(tabName: string) {\r\n        let tab = this.tabs.find(v => v.name === tabName);\r\n        if (tab === undefined) return;\r\n        if (this.selectedTab !== undefined) this.selectedTab.selected = false;\r\n        tab.selected = true;\r\n        this.selectedTab = tab;\r\n\t}\r\n\t*/\r\n\r\n\tprivate tabs = observer(() => {\r\n        let {tabPosition, borderColor} = this.props;\r\n        let bsCur:React.CSSProperties, bsTab:React.CSSProperties\r\n        if (borderColor) {\r\n            bsCur = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderLeftWidth: 1,\r\n                borderRightWidth: 1,\r\n                borderBottomWidth: 1,\r\n            }\r\n            bsTab = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderBottomWidth: 1,\r\n                borderLeftWidth: 0,\r\n                borderRightWidth: 0,\r\n            }\r\n            if (tabPosition === 'top') {\r\n                bsCur.borderBottomWidth = 0;\r\n                bsCur.borderTopLeftRadius = 10;\r\n                bsCur.borderTopRightRadius = 10;\r\n                bsTab.borderTopWidth = 0;\r\n            }\r\n            else {\r\n                bsCur.borderTopWidth = 0;\r\n                bsCur.borderBottomLeftRadius = 10;\r\n                bsCur.borderBottomRightRadius = 10;\r\n                bsTab.borderBottomWidth = 0;\r\n            }\r\n        }\r\n\t\tlet cn = classNames('tv-tabs', this.tabBg, this.sep, 'tv-tabs-' + this.size);\r\n\t\tlet tabs = <div className={cn}>\r\n            {this.tabArr.map((v,index) => {\r\n                let {selected, caption, notify} = v;\r\n                let notifyCircle:any;\r\n                if (notify !== undefined) {\r\n                    let num = notify.get();\r\n                    if (num !== undefined) {\r\n                        if (num > 0) notifyCircle = <u>{num>99?'99+':num}</u>;\r\n                        else if (num < 0) notifyCircle = <u className=\"dot\" />;\r\n                    }\r\n                }\r\n                return <div key={index} onClick={()=>this.tabClick(v)} style={selected===true? bsCur:bsTab}>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t{notifyCircle}\r\n\t\t\t\t\t{caption(selected)}\r\n\t\t\t\t\t</div>\r\n                </div>\r\n            })}\r\n\t\t</div>;\r\n\t\treturn tabs;\r\n\t});\r\n\r\n\tcontent = observer(() => {\r\n\t\tlet displayNone:React.CSSProperties = {visibility: 'hidden'};\r\n\t\treturn <>\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet {tabPosition} = this.props;\r\n\t\t\t\tlet {content, page, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\t\tlet tabs = React.createElement(this.tabs);\r\n\t\t\t\tlet pageHeader:any, pageFooter:any;\r\n\t\t\t\tif (page !== undefined) {\r\n\t\t\t\t\tpageHeader = page.header();\r\n\t\t\t\t\tpageFooter = page.footer();\r\n\t\t\t\t}\r\n\t\t\t\tlet header:any, footer:any;\r\n\t\t\t\tlet visibility:React.CSSProperties = {visibility:'hidden'};\r\n\t\t\t\tif (tabPosition === 'top') {\r\n\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t<section className=\"tv-page-header\">\r\n\t\t\t\t\t\t\t<header>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<header style={visibility}>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t\tif (pageFooter !== undefined) {\r\n\t\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t\t<footer style={visibility}>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t<section className=\"tv-page-footer\">\r\n\t\t\t\t\t\t\t\t<footer>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pageHeader !== undefined) {\r\n\t\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t\t<section className='tv-page-header'>\r\n\t\t\t\t\t\t\t\t<header>{pageHeader}</header>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t\t<header style={visibility}>{pageHeader}</header>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t<footer style={visibility}>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t<section className='tv-page-footer'>\r\n\t\t\t\t\t\t\t<footer>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = displayNone;\r\n\t\t\t\treturn <ScrollView key={index} className={className}\r\n\t\t\t\t\tstyle={style}\r\n\t\t\t\t\tonScroll={onScroll} onScrollTop={onScrollTop} onScrollBottom={onScrollBottom}>\r\n\t\t\t\t\t{header}\r\n\t\t\t\t\t{content}\r\n\t\t\t\t\t{footer}\r\n\t\t\t\t</ScrollView>;\r\n\t\t\t})}\r\n\t\t</>;\r\n\t});\r\n\r\n    render() {\r\n\t\tlet {tabPosition} = this.props;\r\n\t\tlet tabs = React.createElement(this.tabs);\r\n\t\tlet header:any, footer:any;\r\n\t\tlet visibility:React.CSSProperties = {display:'none'};\r\n\t\tif (tabPosition === 'top') {\r\n\t\t\theader = <header>{tabs}</header>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfooter = <footer>{tabs}</footer>;\r\n\t\t}\r\n\t\treturn <>\r\n\t\t\t{header}\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = visibility;\r\n\t\t\t\treturn <div key={index} className={classNames(v.className)} style={style}>\r\n\t\t\t\t\t{v.content}\r\n\t\t\t\t</div>;\r\n\t\t\t})}\r\n\t\t\t{footer}\r\n\t\t</>;\r\n    }\r\n};\r\n\r\n@observer export class Tabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n    }\r\n\r\n    render() {\r\n\t\treturn this.tabsView.render();\r\n    }\r\n};\r\n\r\n@observer export class RootTabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n    }\r\n\r\n    render() {\r\n\t\treturn React.createElement(this.tabsView.content);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport { nav } from './nav';\r\nimport { Loading } from './loading';\r\nimport { Image as ImageControl } from './image';\r\nimport { Page } from './page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { LMR } from './simple';\r\n\r\nexport interface ResUploaderProps {\r\n    className?: string;\r\n    label?: string;\r\n    multiple?: boolean;\r\n    maxSize?: number;\r\n    onFilesChange?: (evt: React.ChangeEvent<HTMLInputElement>) => void;\r\n}\r\n\r\n@observer\r\nexport class ResUploader extends React.Component<ResUploaderProps> {\r\n    private fileInput: HTMLInputElement;\r\n    @observable private fileName: string;\r\n\r\n    buildFormData():FormData {\r\n        let {maxSize} = this.props;\r\n        if (maxSize === undefined || maxSize <= 0) \r\n            maxSize = 100000000000;\r\n        else\r\n            maxSize = maxSize * 1024;\r\n        var files:FileList = this.fileInput.files;\r\n        var data = new FormData();\r\n        let len = files.length;\r\n        for (let i=0; i<len; i++) {\r\n            let file = files[i];\r\n            if (file.size > maxSize) return null;\r\n            data.append('files[]', file, file.name);\r\n        }\r\n    }\r\n\r\n    getFile0(): File {\r\n        return this.fileInput.files[0];\r\n    }\r\n\r\n    upload = async (formData?: FormData):Promise<string|{error:any}> => {\r\n        let resUrl = nav.resUrl + 'upload';\r\n        if (!formData) formData = this.buildFormData();\r\n        try {\r\n            nav.startWait();\r\n            let headers = new Headers();\r\n            headers.append('Access-Control-Allow-Origin', '*');\r\n            //2019-12-18 vivooppo \r\n            //let abortController = new AbortController();\r\n            let res = await fetch(resUrl, {\r\n                method: \"POST\",\r\n                body: formData,\r\n                headers: headers,\r\n                //signal: abortController.signal,\r\n            });\r\n            let json = await res.json();\r\n            return ':' + json.res.id;\r\n        }\r\n        catch (err) {\r\n            console.error('%s %s', resUrl, err);\r\n            return {error:err};\r\n        }\r\n        finally {\r\n            nav.endWait();\r\n        }\r\n    }\r\n\r\n    private onFilesChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let {onFilesChange} = this.props;\r\n        if (onFilesChange) onFilesChange(evt);\r\n        let files = evt.target.files;\r\n        let len = files.length;\r\n        let names:string[] = [];\r\n        for (let i=0; i<len; i++) {\r\n            names.push(files.item(i).name);\r\n        }\r\n        this.fileName = names.join(', ');\r\n    }\r\n\r\n    render() {\r\n        let {className, multiple, label} = this.props;\r\n        return <div>\r\n                <label className=\"btn btn-outline-success\">\r\n                    {label || ''} \r\n                    <input \r\n                        className={className}\r\n                        ref={t=>this.fileInput=t} \r\n                        onChange={this.onFilesChange}\r\n                        type='file' name='file' \r\n                        multiple={multiple} style={{display:'none'}} />\r\n                </label>\r\n                &nbsp;\r\n                {this.fileName}\r\n            </div>\r\n    }\r\n}\r\n\r\nfunction formatSize(size:number, pointLength:number=2, units?:string[]) {\r\n    var unit;\r\n    units = units || [ 'B', 'K', 'M', 'G', 'TB' ];\r\n    while ( (unit = units.shift()) && size > 1024 ) {\r\n        size = size / 1024;\r\n    }\r\n    return (unit === 'B' ? size : size.toFixed( pointLength === undefined ? 2 : pointLength)) + unit;\r\n}\r\n\r\ninterface ImageUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw';\r\n\tonSaved?: (imageId:string) => Promise<void>;\r\n\timageTypes?: string[];\r\n}\r\n\r\nconst xlargeSize = 1600;\r\nconst largeSize = 800;\r\nconst mediumSize = 400;\r\nconst smallSize = 180;\r\n\r\n@observer\r\nexport class ImageUploader extends React.Component<ImageUploaderProps> {\r\n\tprivate static imageTypes = ['gif', 'jpg', 'jpeg', 'png', 'svg', 'apng', 'bmp', 'ico', 'cur', 'tiff', 'tif', 'webp'];\r\n\tprivate imgBaseSize: number;\r\n\tprivate imageTypes: string[];\r\n    private suffix: string;\r\n    private resUploader: ResUploader;\r\n    @observable private file: File;    \r\n    @observable private desImgWidth: number;\r\n    @observable private desImgHeight: number;\r\n    @observable private desImgSize: number;\r\n    @observable private srcImgWidth: number;\r\n    @observable private srcImgHeight: number;\r\n    @observable private isChanged: boolean = false;\r\n    @observable private resId: string;\r\n    @observable private enableUploadButton: boolean = false;\r\n    @observable private srcImage: string;\r\n    @observable private desImage: string;\r\n    @observable private fileError: string;\r\n    @observable private uploaded: boolean = false;\r\n\r\n    constructor(props: ImageUploaderProps) {\r\n        super(props);\r\n\t\tthis.resId = props.id;\r\n\t\tthis.imageTypes = props.imageTypes || ImageUploader.imageTypes;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos+1).toLowerCase();\r\n            if(this.imageTypes.indexOf(this.suffix) < 0){\r\n                this.fileError = ` ${this.imageTypes.join(', ')} `;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n\t\t\t\tthis.srcImage = reader.result as string;\r\n\t\t\t\tswitch (this.suffix ) {\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tawait this.setSize(this.props.size);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'svg':\r\n\t\t\t\t\t\tthis.imgBaseSize = mediumSize;\r\n\t\t\t\t\t\tthis.desImgSize = this.srcImage.length;\r\n\t\t\t\t\t\tthis.desImage = this.srcImage;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n            };\r\n        }\r\n    }\r\n\r\n    private async setSize(size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw') {\r\n        switch (size) {\r\n            default:\r\n            case 'sm':\r\n                this.imgBaseSize = smallSize; break;\r\n            case 'md':\r\n                this.imgBaseSize = mediumSize; break;\r\n            case 'lg':\r\n\t\t\t\tthis.imgBaseSize = largeSize; break;\r\n\t\t\tcase 'xl':\r\n\t\t\t\tthis.imgBaseSize = xlargeSize; break;\r\n\t\t\tcase 'raw':\r\n\t\t\t\tthis.imgBaseSize = -1; break;\r\n\t\t}\r\n\t\tthis.desImage = await this.compress();\r\n    }\r\n\r\n    private compress = ():Promise<string> => {\r\n        return new Promise<string>((resolve, reject) => {\r\n            var img = new Image();\r\n            img.src = this.srcImage;\r\n            img.onload = () => {\r\n                //var that = this;\r\n                // \r\n                let {width, height} = img;\r\n                this.srcImgWidth = width;\r\n                this.srcImgHeight = height;\r\n                let scale = width / height;\r\n\t\t\t\tlet w:number, h:number;\r\n\t\t\t\tif (this.imgBaseSize < 0) {\r\n\t\t\t\t\tw = width;\r\n\t\t\t\t\th = height;\r\n\t\t\t\t}\r\n                else if (width <= this.imgBaseSize && height <= this.imgBaseSize) {\r\n                    w = width;\r\n                    h = height;\r\n                }\r\n                else if (scale < 0) {\r\n                    w = this.imgBaseSize;\r\n                    h = w / scale;\r\n                }\r\n                else {\r\n                    h = this.imgBaseSize;\r\n                    w = h * scale;\r\n                }\r\n                this.desImgWidth = Math.round(w);\r\n                this.desImgHeight = Math.round(h);\r\n                var quality = 0.7;  // 0.7\r\n                //canvas\r\n                var canvas = document.createElement('canvas');\r\n                var ctx = canvas.getContext('2d');\r\n                // \r\n                var anw = document.createAttribute(\"width\");\r\n                anw.nodeValue = String(w);\r\n                var anh = document.createAttribute(\"height\");\r\n                anh.nodeValue = String(h);\r\n                canvas.setAttributeNode(anw);\r\n                canvas.setAttributeNode(anh);\r\n                ctx.drawImage(img, 0, 0, w, h);\r\n                let base64 = canvas.toDataURL('image/' + this.suffix , quality);\r\n                let blob = this.convertBase64UrlToBlob(base64);\r\n                this.desImgSize = blob.size;\r\n                if (this.desImgSize > 3*1024*1024) {\r\n                    this.fileError = \"3M\";\r\n                    this.enableUploadButton = false;\r\n                }\r\n                resolve(base64);\r\n            }\r\n        });\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string):Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while(n--){\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], {type:mime});\r\n    }\r\n\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.desImage);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let {error} = ret;\r\n            let type = typeof error;\r\n            let err:string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let {onSaved} = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    private showOrgImage = () => {\r\n        nav.push(<Page header=\"\">\r\n            <div className=\"p-3 text-center\">\r\n                <ImageControl className=\"h-min-4c\" style={{maxWidth:'100%'}} src={this.srcImage} />\r\n            </div>\r\n        </Page>);\r\n    }\r\n\r\n    private levelDiv() {\r\n        if (this.props.size) return;\r\n        let arr = [{caption:'', size:'sm'}];\r\n        if (this.srcImgHeight > mediumSize || this.srcImgWidth > mediumSize) {\r\n            arr.push({caption:'', size:'md'});\r\n        }\r\n        if (this.srcImgHeight > largeSize || this.srcImgWidth > largeSize) {\r\n            arr.push({caption:'', size:'lg'});\r\n        }\r\n        if (this.srcImgHeight > xlargeSize || this.srcImgWidth > xlargeSize) {\r\n\t\t\tarr.push({caption:'', size:'xl'});\r\n\t\t\tarr.push({caption:'', size:'raw'});\r\n        }\r\n        if (arr.length < 2) return;\r\n        return <div>{arr.map((v, index) => {\r\n            let {caption, size} = v;\r\n            return <label key={index} className=\"mr-3\"><input type=\"radio\" name=\"size\" \r\n                onChange={()=>this.setSize(size as any)}\r\n                defaultChecked={index===0} /> {caption}</label>;\r\n        })}</div>\r\n    }\r\n\r\n    render() {\r\n        let {label} = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}></button>;\r\n        return <Page header={label || ''} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} \r\n                            multiple={false} maxSize={2048} \r\n                            label=\"\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\"> {this.imageTypes.join(', ')} </div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                    <LMR left=\r\n                    {\r\n                        this.uploaded === true? \r\n                            <div className=\"text-success p-2\"></div>\r\n                            :\r\n                            this.file && this.desImgSize > 0 && <div className=\"mb-3 d-flex align-items-end\">\r\n                                <div className=\"mr-5\">\r\n                                    {this.levelDiv()}\r\n                                    <div>{this.desImgWidth} x {this.desImgHeight}\r\n                                    &nbsp; &nbsp;\r\n                                    {formatSize(this.desImgSize)}\r\n                                    </div>\r\n                                </div>\r\n                                <button className=\"btn btn-primary\" \r\n                                    disabled={!this.enableUploadButton}\r\n                                    onClick={this.upload}></button>\r\n                            </div>\r\n                    }\r\n                    right={this.desImage && \r\n                        <button className=\"btn btn-link btn-sm text-right mb-3\" onClick={this.showOrgImage}>\r\n                            : {formatSize(this.file.size)}<br/>\r\n                            {this.srcImgWidth} x {this.srcImgHeight}\r\n                        </button>\r\n                    }\r\n                    ></LMR>\r\n                </div>\r\n                <div className=\"text-center\" \r\n                    style={{\r\n                        border: (this.uploaded===true? '2px solid green' : '1px dotted gray'),\r\n                        padding: '8px'\r\n                    }}>\r\n                    <ImageControl className=\"h-min-4c\" style={{maxWidth:'100%'}} src={this.desImage} />\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface AudioUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    onSaved?: (imageId:string) => Promise<void>;\r\n}\r\n\r\n@observer\r\nexport class AudioUploader extends React.Component<AudioUploaderProps> {\r\n\tprivate static audioTypes = ['mp3', 'wav'];\r\n\r\n    private suffix: string;\r\n\tprivate resUploader: ResUploader;\r\n\t@observable private content: string;\r\n\t@observable private file: File;    \r\n\t@observable private fileSize: number;\r\n\r\n    @observable private isChanged: boolean = false;\r\n    @observable private resId: string;\r\n    @observable private enableUploadButton: boolean = false;\r\n    @observable private fileError: string;\r\n\t@observable private uploaded: boolean = false;\r\n\t@observable private uploading: boolean = false;\r\n\r\n    constructor(props: AudioUploaderProps) {\r\n        super(props);\r\n        this.resId = props.id;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos+1).toLowerCase();\r\n            if(AudioUploader.audioTypes.indexOf(this.suffix) < 0){\r\n                this.fileError = ` ${AudioUploader.audioTypes.join(', ')} `;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n\t\t\t\tthis.content = reader.result as string;\r\n\t\t\t\tthis.fileSize = this.content.length;\r\n            };\r\n        }\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string):Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while(n--){\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], {type:mime});\r\n    }\r\n\r\n    private upload = async () => {\r\n\t\tif (!this.resUploader) return;\r\n\t\tthis.uploading = true;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.content);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let {error} = ret;\r\n            let type = typeof error;\r\n            let err:string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let {onSaved} = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    render() {\r\n        let {label} = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}></button>;\r\n        return <Page header={label || ''} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} \r\n                            multiple={false} maxSize={2048} \r\n                            label=\"\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\"> {AudioUploader.audioTypes.join(', ')} </div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\t\t\t<LMR left=\r\n                    {\r\n                        this.uploaded === true? \r\n                            <div className=\"text-success p-2\"></div>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\tthis.uploading === true?\r\n\t\t\t\t\t\t\t\t<div className=\"m-3\"><Loading /></div>\r\n\t\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t\tthis.file && this.content && <div className=\"m-3\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"mb-3\">\r\n\t\t\t\t\t\t\t\t\t\t{formatSize(this.fileSize)}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn btn-primary\" \r\n\t\t\t\t\t\t\t\t\t\tdisabled={!this.enableUploadButton}\r\n\t\t\t\t\t\t\t\t\t\tonClick={this.upload}></button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t/>\r\n        </Page>;\r\n    }\r\n}\r\n","import _ from 'lodash';\r\nimport { UqApi, UqData, UnitxApi, appInFrame } from '../net';\r\nimport { Tuid, TuidDiv, TuidImport, TuidInner, TuidBox, TuidsCache } from './tuid';\r\nimport { Action } from './action';\r\nimport { Sheet } from './sheet';\r\nimport { Query } from './query';\r\nimport { Book } from './book';\r\nimport { History } from './history';\r\nimport { Map } from './map';\r\nimport { Pending } from './pending';\r\nimport { CreateBoxId, BoxId } from './tuid';\r\nimport { LocalMap, LocalCache } from '../tool';\r\nimport { UQsMan } from './uqsMan';\r\nimport { ReactBoxId } from './tuid/reactBoxId';\r\nimport { Tag } from './tag/tag';\r\nimport { UqEnum } from './enum';\r\nimport { Entity } from './entity';\r\n\r\nexport type FieldType = 'id' | 'tinyint' | 'smallint' | 'int' | 'bigint' | 'dec' | 'char' | 'text'\r\n    | 'datetime' | 'date' | 'time' | 'timestamp';\r\n\r\nexport function fieldDefaultValue(type:FieldType) {\r\n    switch (type) {\r\n        case 'tinyint':\r\n        case 'smallint':\r\n        case 'int':\r\n        case 'bigint':\r\n        case 'dec':\r\n            return 0;\r\n        case 'char':\r\n        case 'text':\r\n            return '';\r\n        case 'datetime':\r\n        case 'date':\r\n            return '2000-1-1';\r\n        case 'time':\r\n            return '0:00';\r\n    }\r\n}\r\n\r\nexport interface Field {\r\n    name: string;\r\n    type: FieldType;\r\n    tuid?: string;\r\n    arr?: string;\r\n    null?: boolean;\r\n    size?: number;\r\n    owner?: string;\r\n    _tuid: TuidBox;\r\n}\r\nexport interface ArrFields {\r\n    name: string;\r\n    fields: Field[];\r\n    id?: string;\r\n    order?: string;\r\n}\r\nexport interface FieldMap {\r\n    [name:string]: Field;\r\n}\r\nexport interface SchemaFrom {\r\n    owner:string;\r\n    uq:string;\r\n}\r\nexport interface TuidModify {\r\n    max: number;\r\n    seconds: number;\r\n}\r\n\r\nexport class UqMan {\r\n\tprivate readonly enums: {[name:string]: UqEnum} = {};\r\n    private readonly actions: {[name:string]: Action} = {};\r\n    private readonly sheets: {[name:string]: Sheet} = {};\r\n    private readonly queries: {[name:string]: Query} = {};\r\n    private readonly books: {[name:string]: Book} = {};\r\n    private readonly maps: {[name:string]: Map} = {};\r\n    private readonly histories: {[name:string]: History} = {};\r\n\tprivate readonly pendings: {[name:string]: Pending} = {};\r\n\tprivate readonly tags: {[name:string]: Tag} = {};\r\n    private readonly tuidsCache: TuidsCache;\r\n    private readonly localAccess: LocalCache;\r\n    private readonly tvs:{[entity:string]:(values:any)=>JSX.Element};\r\n    readonly localMap: LocalMap;\r\n    readonly localModifyMax: LocalCache;\r\n    readonly tuids: {[name:string]: Tuid} = {};\r\n    readonly createBoxId: CreateBoxId;\r\n    readonly newVersion: boolean;\r\n    readonly uqOwner: string;\r\n    readonly uqName: string;\r\n    readonly name: string;\r\n    readonly uqApi: UqApi;\r\n    readonly id: number;\r\n\r\n    uqVersion: number;\r\n\r\n    constructor(uqs:UQsMan, uqData: UqData, createBoxId:CreateBoxId, tvs:{[entity:string]:(values:any)=>JSX.Element}) {\r\n        this.createBoxId = createBoxId;\r\n        if (createBoxId === undefined) {\r\n            this.createBoxId = this.createBoxIdFromTVs;\r\n            this.tvs = tvs || {};\r\n        }\r\n        let {id, uqOwner, uqName, access, newVersion} = uqData;\r\n        this.newVersion = newVersion;\r\n        this.uqOwner = uqOwner;\r\n        this.uqName = uqName;\r\n        this.id = id;\r\n        this.name = uqOwner + '/' + uqName;\r\n        this.uqVersion = 0;\r\n        this.localMap = uqs.localMap.map(this.name);\r\n        this.localModifyMax = this.localMap.child('$modifyMax');\r\n        this.localAccess = this.localMap.child('$access');\r\n        //let hash = document.location.hash;\r\n        let baseUrl = 'tv/';\r\n\r\n        let acc: string[];\r\n        if (access === null || access === undefined || access === '*') {\r\n            acc = [];\r\n        }\r\n        else {\r\n            acc = access.split(';').map(v => v.trim()).filter(v => v.length > 0);\r\n        }\r\n        if (this.name === '$$$/$unitx') {\r\n            // home linkunit\r\n            //  UnitxApi unitx service\r\n            this.uqApi = new UnitxApi(appInFrame.unit);\r\n        }\r\n        else {\r\n            let {appOwner, appName} = uqs;\r\n            this.uqApi = new UqApi(baseUrl, appOwner, appName, uqOwner, uqName, acc, true);\r\n        }\r\n        this.tuidsCache = new TuidsCache(this);\r\n    }\r\n\r\n    get entities() {\r\n        return _.merge({}, \r\n            this.actions, this.sheets, this.queries, this.books,\r\n\t\t\tthis.maps, this.histories, this.pendings, this.tuids,\r\n\t\t\tthis.tags,\r\n        );\r\n    }\r\n\r\n    private createBoxIdFromTVs:CreateBoxId = (tuid:Tuid, id:number):BoxId =>{\r\n        let {name} = tuid;\r\n        /*\r\n        let tuidUR = this.tuidURs[name];\r\n        if (tuidUR === undefined) {\r\n            let {ui, res} = this.getUI(tuid);\r\n            this.tuidURs[name] = tuidUR = new TuidWithUIRes(tuid, ui, res);\r\n        }\r\n        */\r\n        return new ReactBoxId(id, tuid, this.tvs[name]);\r\n    }\r\n\r\n    tuid(name:string):Tuid {return this.tuids[name.toLowerCase()]}\r\n    tuidDiv(name:string, div:string):TuidDiv {\r\n        let tuid = this.tuids[name.toLowerCase()]\r\n        return tuid && tuid.div(div.toLowerCase());\r\n    }\r\n    action(name:string):Action {return this.actions[name.toLowerCase()]}\r\n    sheet(name:string):Sheet {return this.sheets[name.toLowerCase()]}\r\n    query(name:string):Query {return this.queries[name.toLowerCase()]}\r\n    book(name:string):Book {return this.books[name.toLowerCase()]}\r\n    map(name:string):Map {return this.maps[name.toLowerCase()]}\r\n    history(name:string):History {return this.histories[name.toLowerCase()]}\r\n    pending(name:string):Pending {return this.pendings[name.toLowerCase()]}\r\n\r\n    sheetFromTypeId(typeId:number):Sheet {\r\n        for (let i in this.sheets) {\r\n            let sheet = this.sheets[i];\r\n            if (sheet.typeId === typeId) return sheet;\r\n        }\r\n    }\r\n\r\n    readonly tuidArr: Tuid[] = [];\r\n    readonly actionArr: Action[] = [];\r\n    readonly enumArr: UqEnum[] = [];\r\n    readonly sheetArr: Sheet[] = [];\r\n    readonly queryArr: Query[] = [];\r\n    readonly bookArr: Book[] = [];\r\n    readonly mapArr: Map[] = [];\r\n    readonly historyArr: History[] = [];\r\n    readonly pendingArr: Pending[] = [];\r\n    readonly tagArr: Tag[] = [];\r\n\r\n    async init() {\r\n        await this.uqApi.init();\r\n    }\r\n\r\n    async loadEntities(): Promise<string> {\r\n        try {\r\n            let accesses = this.localAccess.get();\r\n            if (!accesses) {\r\n                accesses = await this.uqApi.loadAccess();\r\n            }\r\n            if (!accesses) return;\r\n            this.buildEntities(accesses);\r\n        }\r\n        catch (err) {\r\n            return err;\r\n        }\r\n    }\r\n\r\n\tbuildEntities(entities:any) {\r\n        if (entities === undefined) {\r\n            debugger;\r\n        }\r\n        this.localAccess.set(entities);\r\n        let {access, tuids, version} = entities;\r\n        this.uqVersion = version;\r\n        this.buildTuids(tuids);\r\n        this.buildAccess(access);\r\n\t}\r\n\t\r\n    private buildTuids(tuids:any) {\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let {typeId, from} = schema;\r\n            let tuid = this.newTuid(i, typeId, from);\r\n            tuid.sys = true;\r\n        }\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let tuid = this.getTuid(i);\r\n            tuid.setSchema(schema);\r\n        }\r\n        for (let i in this.tuids) {\r\n            let tuid = this.tuids[i];\r\n            tuid.buildFieldsTuid();\r\n        }\r\n\t}\r\n\r\n    async loadEntitySchema(entityName: string): Promise<any> {\r\n        return await this.uqApi.schema(entityName);\r\n    }\r\n\r\n\tasync loadAllSchemas():Promise<void> {\r\n\t\tlet ret = await this.uqApi.allSchemas();\r\n\t\tlet entities: Entity[][] = [\r\n\t\t\tthis.actionArr, \r\n\t\t\tthis.enumArr,\r\n\t\t\tthis.sheetArr,\r\n\t\t\tthis.queryArr,\r\n\t\t\tthis.bookArr,\r\n\t\t\tthis.mapArr,\r\n\t\t\tthis.historyArr,\r\n\t\t\tthis.pendingArr,\r\n\t\t\tthis.tagArr,\r\n\t\t];\r\n\t\tentities.forEach(arr => {\r\n\t\t\tarr.forEach(v => {\r\n\t\t\t\tlet entity = ret[v.name.toLowerCase()];\r\n\t\t\t\tif (!entity) return;\r\n\t\t\t\tlet schema = entity.call;\r\n\t\t\t\tif (!schema) return;\r\n\t\t\t\tv.buildSchema(schema);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n    getTuid(name:string): Tuid {\r\n        return this.tuids[name];\r\n    }\r\n\r\n    private buildAccess(access:any) {\r\n        for (let a in access) {\r\n            let v = access[a];\r\n            switch (typeof v) {\r\n                case 'string': this.fromType(a, v); break;\r\n                case 'object': this.fromObj(a, v); break;\r\n            }\r\n        }\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.tuidsCache.cacheTuids(defer);\r\n    }\r\n\r\n    newEnum(name:string, id:number):UqEnum {\r\n        let enm = this.enums[name];\r\n        if (enm !== undefined) return enm;\r\n        enm = this.enums[name] = new UqEnum(this, name, id)\r\n        this.enumArr.push(enm);\r\n        return enm;\r\n    }\r\n\tnewAction(name:string, id:number):Action {\r\n        let action = this.actions[name];\r\n        if (action !== undefined) return action;\r\n        action = this.actions[name] = new Action(this, name, id)\r\n        this.actionArr.push(action);\r\n        return action;\r\n    }\r\n    private newTuid(name:string, id:number, from:SchemaFrom):Tuid {\r\n        let tuid = this.tuids[name];\r\n        if (tuid !== undefined) return tuid;\r\n        if (from !== undefined)\r\n            tuid = new TuidImport(this, name, id, from);\r\n        else\r\n            tuid = new TuidInner(this, name, id);\r\n        this.tuids[name] = tuid;\r\n        this.tuidArr.push(tuid);\r\n        return tuid;\r\n    }\r\n    newQuery(name:string, id:number):Query {\r\n        let query = this.queries[name];\r\n        if (query !== undefined) return query;\r\n        query = this.queries[name] = new Query(this, name, id)\r\n        this.queryArr.push(query);\r\n        return query;\r\n    }\r\n    private newBook(name:string, id:number):Book {\r\n        let book = this.books[name];\r\n        if (book !== undefined) return book;\r\n        book = this.books[name] = new Book(this, name, id);\r\n        this.bookArr.push(book);\r\n        return book;\r\n    }\r\n    private newMap(name:string, id:number):Map {\r\n        let map = this.maps[name];\r\n        if (map !== undefined) return map;\r\n        map = this.maps[name] = new Map(this, name, id)\r\n        this.mapArr.push(map);\r\n        return map;\r\n    }\r\n    private newTag(name:string, id:number):Tag {\r\n        let tag = this.tags[name];\r\n        if (tag !== undefined) return tag;\r\n        tag = this.tags[name] = new Tag(this, name, id)\r\n        this.tagArr.push(tag);\r\n        return tag;\r\n    }\r\n    private newHistory(name:string, id:number):History {\r\n        let history = this.histories[name];\r\n        if (history !== undefined) return;\r\n        history = this.histories[name] = new History(this, name, id)\r\n        this.historyArr.push(history);\r\n        return history;\r\n    }\r\n    private newPending(name:string, id:number):Pending {\r\n        let pending = this.pendings[name];\r\n        if (pending !== undefined) return;\r\n        pending = this.pendings[name] = new Pending(this, name, id)\r\n        this.pendingArr.push(pending);\r\n        return pending;\r\n    }\r\n    newSheet(name:string, id:number):Sheet {\r\n        let sheet = this.sheets[name];\r\n        if (sheet !== undefined) return sheet;\r\n        sheet = this.sheets[name] = new Sheet(this, name, id);\r\n        this.sheetArr.push(sheet);\r\n        return sheet;\r\n    }\r\n    private fromType(name:string, type:string) {\r\n        let parts = type.split('|');\r\n        type = parts[0];\r\n        let id = Number(parts[1]);\r\n        switch (type) {\r\n            //case 'uq': this.id = id; break;\r\n            case 'tuid':\r\n                // Tuid should not be created here!;\r\n                //let tuid = this.newTuid(name, id);\r\n                //tuid.sys = false;\r\n                break;\r\n            case 'action': this.newAction(name, id); break;\r\n            case 'query': this.newQuery(name, id); break;\r\n            case 'book': this.newBook(name, id); break;\r\n            case 'map': this.newMap(name, id); break;\r\n            case 'history': this.newHistory(name, id); break;\r\n            case 'sheet':this.newSheet(name, id); break;\r\n\t\t\tcase 'pending': this.newPending(name, id); break;\r\n\t\t\tcase 'tag': this.newTag(name, id); break;\r\n\t\t\tcase 'enum': this.newEnum(name, id); break;\r\n        }\r\n    }\r\n    private fromObj(name:string, obj:any) {\r\n        switch (obj['$']) {\r\n            case 'sheet': this.buildSheet(name, obj); break;\r\n        }\r\n    }\r\n    private buildSheet(name:string, obj:any) {\r\n        let sheet = this.sheets[name];\r\n        if (sheet === undefined) sheet = this.newSheet(name, obj.id);\r\n        sheet.build(obj);\r\n    }\r\n    buildFieldTuid(fields:Field[], mainFields?:Field[]) {\r\n        if (fields === undefined) return;\r\n        for (let f of fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            f._tuid = t.buildTuidBox();\r\n        }\r\n        for (let f of fields) {\r\n            let {owner} = f;\r\n            if (owner === undefined) continue;\r\n            let ownerField = fields.find(v => v.name === owner);\r\n            if (ownerField === undefined) {\r\n                if (mainFields !== undefined) {\r\n                    ownerField = mainFields.find(v => v.name === owner);\r\n                }\r\n                if (ownerField === undefined) {\r\n                    debugger;\r\n                    throw new Error(`owner field ${owner} is undefined`);\r\n                }\r\n            }\r\n            let {arr, tuid} = f;\r\n            let t = this.getTuid(ownerField._tuid.tuid.name);\r\n            if (t === undefined) continue;\r\n            let div = t.div(arr || tuid);\r\n            f._tuid = div && div.buildTuidDivBox(ownerField);\r\n            if (f._tuid === undefined) {\r\n                debugger;\r\n                throw new Error(`owner field ${owner} is not tuid`);\r\n            }\r\n        }\r\n    }\r\n    buildArrFieldsTuid(arrFields:ArrFields[], mainFields:Field[]) {\r\n        if (arrFields === undefined) return;\r\n        for (let af of arrFields) {\r\n            let {fields} = af;\r\n            if (fields === undefined) continue;\r\n            this.buildFieldTuid(fields, mainFields);\r\n        }\r\n    }\r\n\r\n    pullModify(modifyMax:number) {\r\n        this.tuidsCache.pullModify(modifyMax);\r\n    }\r\n}\r\n","import { Entity } from './entity';\r\nimport { PageItems } from '../tool/pageItems';\r\nimport { EntityCaller } from './caller';\r\nimport { ArrFields, Field } from './uqMan';\r\n\r\nexport interface SheetState {\r\n    name: string;\r\n    actions: SheetAction[];\r\n}\r\n\r\nexport interface SheetAction {\r\n    name: string;\r\n}\r\n\r\nexport interface StateCount {\r\n    state: string;\r\n    count: number;\r\n}\r\n\r\nexport interface SheetSaveReturnV<V> {\r\n\tid: number;\r\n\tflow: number;\r\n\tstate: string;\r\n\tverify: V[];\r\n}\r\n\r\nexport interface SheetSaveReturn extends SheetSaveReturnV<any> {\r\n}\r\n\r\ninterface GetSheetReturn<M> {\r\n\tbrief: any;\r\n\tdata: M;\r\n\tflows: any[];\r\n}\r\n\r\nexport class UqSheet<M, V> extends Entity {\r\n    get typeName(): string { return 'sheet';}\r\n\tstates: SheetState[];\r\n\tverify: {returns: ArrFields[]};\r\n\r\n    /*\r\n    setStates(states: SheetState[]) {\r\n        for (let state of states) {\r\n            this.setStateAccess(this.states.find(s=>s.name==state.name), state);\r\n        }\r\n    }*/\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n\t\tthis.states = schema.states;\r\n\t\tthis.verify = schema.verify;\r\n    }\r\n    build(obj:any) {\r\n        this.states = [];\r\n        for (let op of obj.ops) {\r\n            this.states.push({name: op, actions:undefined});\r\n        }\r\n        /*\r\n        for (let p in obj) {\r\n            switch(p) {\r\n                case '#':\r\n                case '$': continue;\r\n                default: this.states.push(this.createSheetState(p, obj[p])); break;\r\n            }\r\n        }*/\r\n    }\r\n    private createSheetState(name:string, obj:object):SheetState {\r\n        let ret:SheetState = {name:name, actions:[]};\r\n        let actions = ret.actions;\r\n        for (let p in obj) {\r\n            let action:SheetAction = {name: p};\r\n            actions.push(action);\r\n        }\r\n        return ret;\r\n    }\r\n    async save(discription:string, data:M):Promise<SheetSaveReturn> {\r\n        let {id} = this.uq;\r\n        let params = {app: id, discription: discription, data:data};\r\n        return await new SaveCaller(this, params).request();\r\n    }\r\n    async saveDebugDirect(discription:string, data:M):Promise<SheetSaveReturn> {\r\n        let {id} = this.uq;\r\n        let params = {app: id, discription: discription, data:data};\r\n        return await new SaveDirectCaller(this, params).request();\r\n    }\r\n    async action(id:number, flow:number, state:string, action:string) {\r\n        return await new ActionCaller(this, {id:id, flow:flow, state:state, action:action}).request();\r\n    }\r\n    async actionDebugDirect(id:number, flow:number, state:string, action:string) {\r\n        return await new ActionDirectCaller(this, {id:id, flow:flow, state:state, action:action}).request();\r\n    }\r\n    private unpack(data:any):GetSheetReturn<M> {\r\n        //if (this.schema === undefined) await this.loadSchema();\r\n        let ret = data[0];\r\n        let brief = ret[0];\r\n        let sheetData = this.unpackSheet(brief.data);\r\n        let flows = data[1];\r\n        return {\r\n            brief: brief,\r\n            data: sheetData,\r\n            flows: flows,\r\n        }\r\n    }\r\n    async getSheet(id:number):Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.getSheet(this.name, id);\r\n        */\r\n        let ret = await new GetSheetCaller(this, id).request();\r\n        if (ret[0].length === 0) return await this.getArchive(id);\r\n        return this.unpack(ret);\r\n    }\r\n    async getArchive(id:number):Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchive(this.name, id)\r\n        return this.unpack(ret);\r\n        */\r\n        let ret = await new SheetArchiveCaller(this, id).request();\r\n        return this.unpack(ret);\r\n    }\r\n\r\n    async getArchives(pageStart:number, pageSize:number) {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchives(this.name, {pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {pageStart:pageStart, pageSize:pageSize};\r\n        return await new SheetArchivesCaller(this, params).request();\r\n    }\r\n\r\n    async getStateSheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.stateSheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new StateSheetsCaller(this, params).request();\r\n    }\r\n    createPageStateItems<T>(): PageStateItems<T> {return new PageStateItems<T>(this);}\r\n\r\n    async stateSheetCount():Promise<StateCount[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret:StateCount[] = await this.uqApi.stateSheetCount(this.name);\r\n        return this.states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = ret.find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n        */\r\n        return await new StateSheetCountCaller(this, undefined).request();\r\n    }\r\n\r\n    async userSheets(state:string, user:number, pageStart:number, pageSize:number):Promise<any[]> {\r\n        let params = {state:state, user:user, pageStart:pageStart, pageSize:pageSize};\r\n        return await new UserSheetsCaller(this, params).request();\r\n    }\r\n\r\n    async mySheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.mySheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new MySheetsCaller(this, params).request();\r\n    }\r\n}\r\n\r\nexport class Sheet extends UqSheet<any, any> {\r\n}\r\n\r\nabstract class SheetCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Sheet {return this._entity as Sheet;}\r\n    protected readonly suffix:string;\r\n    get path():string {return `sheet/${this.entity.name}/${this.suffix}`;}\r\n}\r\n\r\nclass SaveCaller extends SheetCaller<{app:number; discription:string; data:any}> {\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n    buildParams() {\r\n        let {app, discription, data} = this.params;\r\n        return {\r\n            app: app,\r\n            discription: discription,\r\n            data: this.entity.pack(data)\r\n        };\r\n    }\r\n    xresult(res:any):any {\r\n\t\tlet {verify} = this.entity;\r\n\t\tif (verify === undefined) return res;\r\n\t\tlet resVerify = res.verify;\r\n\t\tif (resVerify === undefined || resVerify.length === 0) {\r\n\t\t\tres.verify = undefined;\r\n\t\t\treturn res;\r\n\t\t}\r\n\t\tlet {returns} = verify;\r\n\t\tres.verify = this.entity.unpackReturns(resVerify, returns);\r\n        return res;\r\n    }\r\n}\r\n\r\nclass SaveDirectCaller extends SaveCaller {\r\n    get path():string {return `sheet/${this.entity.name}/direct`;}\r\n}\r\n\r\nclass ActionCaller extends SheetCaller<{id:number, flow:number, state:string, action:string}> {\r\n    method = 'PUT';\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n}\r\n\r\nclass ActionDirectCaller extends ActionCaller {\r\n    get path():string {return `sheet/${this.entity.name}/direct`;}\r\n}\r\n\r\nclass GetSheetCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //private id:number;\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/get/${this.params}`;}\r\n}\r\n\r\nclass SheetArchiveCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/archive/${this.params}`;}\r\n}\r\n\r\nclass SheetArchivesCaller extends SheetCaller<{pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'archives';\r\n}\r\n\r\nclass StateSheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'states';\r\n}\r\n\r\nclass StateSheetCountCaller extends SheetCaller<undefined> {\r\n    method = 'GET';\r\n    protected readonly suffix = 'statecount';\r\n    xresult(res:any):any {\r\n        let {states} = this.entity;\r\n        return states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = (res as any[]).find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n    }\r\n}\r\n\r\nclass UserSheetsCaller extends SheetCaller<{state:string, user:number, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'user-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n\r\nclass MySheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'my-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n\r\nexport class PageStateItems<T> extends PageItems<T> {\r\n    private sheet: Sheet;\r\n    constructor(sheet: Sheet) {\r\n        super(true);\r\n        this.sheet = sheet;\r\n        this.pageSize = 10;\r\n\t}\r\n\tprotected async loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n\t\treturn {$page: ret};\r\n\t}\r\n\t/*\r\n    protected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n        let ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n        return ret;\r\n\t}\r\n\t*/\r\n\tprotected getPageId(item:T) {\r\n\t\treturn item === undefined? 0 : (item as any).id;\r\n\t}\r\n\t/*\r\n    protected setPageStart(item:any) {\r\n        this.pageStart = item === undefined? 0 : item.id;\r\n\t}\r\n\t*/\r\n}\r\n","import {Query} from './query';\r\nimport { QueryQueryCaller } from './caller';\r\n\r\nexport class Book extends Query {\r\n    get typeName(): string { return 'book';}\r\n    protected queryApiName = 'book';\r\n\r\n    protected queryCaller(params: any): QueryQueryCaller {\r\n        return new BookQueryCaller(this, params);\r\n    }\r\n}\r\n\r\nexport class BookQueryCaller extends QueryQueryCaller {\r\n    get path():string {return `book/${this.entity.name}`;}\r\n}\r\n","import {Query} from './query';\r\n\r\nexport class History extends Query {\r\n    get typeName(): string { return 'history';}\r\n    protected queryApiName = 'history';\r\n}\r\n","import { Entity } from './entity';\r\nimport { Action, ActionSubmitCaller } from './action';\r\nimport { Query } from './query';\r\nimport { Field } from './uqMan';\r\nimport { EntityCaller, QueryPageCaller, QueryQueryCaller } from './caller';\r\n\r\ninterface MapActions {\r\n    add: Action;\r\n    del: Action;\r\n}\r\ninterface MapQueries {\r\n    all: Query;\r\n    page: Query;\r\n    query: Query;\r\n}\r\n\r\nexport class Map extends Entity {\r\n    get typeName(): string { return 'map';}\r\n    keys: Field[];\r\n    actions: MapActions = {} as any;\r\n    queries: MapQueries = {} as any;\r\n    schemaFrom: {owner:string; uq:string};\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.schemaFrom = this.schema.from;\r\n        let {actions, queries, keys} = schema;\r\n        this.uq.buildFieldTuid(this.keys = keys);\r\n        for (let i in actions) {\r\n            let actionSchema = actions[i];\r\n            let {name} = actionSchema;\r\n            let action = this.uq.newAction(name, undefined);\r\n            action.setSchema(actionSchema);\r\n            action.buildFieldsTuid();\r\n            (this.actions as any)[i] = action;\r\n        }\r\n        for (let i in queries) {\r\n            let querySchema = queries[i];\r\n            let {name} = querySchema;\r\n            let query = this.uq.newQuery(name, undefined);\r\n            query.setSchema(querySchema);\r\n            query.buildFieldsTuid();\r\n            (this.queries as any)[i] = query;\r\n        }\r\n    }\r\n\r\n    async add(param:any) {\r\n        let ret = await new AddCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async del(param:any) {\r\n        let ret = await new DelCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async all() {\r\n        let ret = await new AllCaller(this, undefined).request();\r\n        return ret;\r\n    }\r\n\r\n    async page(param:any, pageStart:any, pageSize: number) {\r\n        let ret = await new PageCaller(this, {pageStart:pageStart, pageSize:pageSize, param:param}).request();\r\n        return ret;\r\n    }\r\n\r\n    async query(param:any) {\r\n       let qc = new QueryCaller(this, param);\r\n       let ret = await qc.request();\r\n       return ret;\r\n   }\r\n    async table(params:any): Promise<any[]> {\r\n        let ret = await this.query(params);\r\n        for (let i in ret) {\r\n            return ret[i];\r\n        }\r\n    }\r\n    async obj(params:any):Promise<any> {\r\n        let ret = await this.table(params);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:any):Promise<any> {\r\n        let ret = await this.obj(params);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nabstract class MapCaller extends EntityCaller<any> {\r\n    protected get entity(): Map {return this._entity as Map;}\r\n    get path():string {return undefined;}\r\n\r\n    protected abstract getCaller(param: any):EntityCaller<any>;\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        let caller = this.getCaller(this.params);\r\n        let res = await this.entity.uqApi.xcall(caller);\r\n        let ret = caller.xresult(res.res);\r\n        return {res: ret};\r\n    }\r\n\r\n    buildParams() {\r\n        let p = super.buildParams();\r\n        return p;\r\n    }\r\n}\r\n\r\nclass AddCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAddCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass DelCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapDelCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass AllCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAllCaller(this.entity, this.entity.queries.all, param);\r\n    }\r\n}\r\n\r\nclass PageCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapPageCaller(this.entity, this.entity.queries.page, param);\r\n    }\r\n}\r\n\r\nclass QueryCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapQueryCaller(this.entity, this.entity.queries.query, param);\r\n    }\r\n}\r\n\r\nclass MapAddCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/add`}\r\n    get headers(): {[header:string]: string} {return undefined;}\r\n}\r\n\r\nclass MapDelCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/del`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapAllCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/all`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapPageCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/page`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapQueryCaller extends QueryQueryCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/query`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n","import {Query} from './query';\r\n\r\nexport class Pending extends Query {\r\n    get typeName(): string { return 'pending';}\r\n    protected queryApiName = 'pending';\r\n}\r\n","import { Entity } from \"./entity\";\r\n\r\nexport class UqEnum extends Entity {\r\n    get typeName(): string { return 'enum';}\r\n}","export * from './rule';\r\nexport * from './field';\r\nexport * from './face';\r\nexport * from './rowContainer';\r\nexport * from './formView';\r\nexport * from './TonvaForm';\r\nexport {ControlBase} from './control';\r\n","import * as React from 'react';\r\nimport {FormEvent} from 'react';\r\nimport {computed} from 'mobx';\r\nimport {uid} from 'tonva';\r\nimport {Rule} from './rule';\r\nimport {Field} from './field';\r\nimport {Face} from './face';\r\nimport {CreateControl, ButtonsControl} from './control';\r\nimport {RowContainer, CreateRow, bootstrapCreateRow, elementCreateRow} from './rowContainer';\r\n\r\nexport interface FieldView {\r\n    field: Field;\r\n    face?: Face;\r\n}\r\n\r\nexport interface LabeledRow {\r\n    label?: string;\r\n    createRow?: CreateRow;\r\n    createControl?: CreateControl;\r\n    help?: JSX.Element;\r\n}\r\n\r\nexport interface FieldRow extends LabeledRow, FieldView {\r\n}\r\n\r\nexport interface GroupRow extends LabeledRow {\r\n    group: FieldView[];\r\n}\r\n\r\nexport type LabelFormRow = FieldRow|GroupRow|LabeledRow;\r\nexport type FormRow = LabelFormRow|JSX.Element;\r\n\r\nexport interface SubmitResult {\r\n    success: boolean;\r\n    message?: string\r\n    result?: any;\r\n}\r\n\r\nexport interface FormProps {\r\n    formRows: FormRow[];\r\n    //context?: any;              // form contextEntitiesUI\r\n    rules?: Rule | Rule[];\r\n    onSubmit: (values:any) => Promise<SubmitResult|undefined>;\r\n    submitButton?: string|JSX.Element;\r\n    otherButton?: string|JSX.Element;\r\n    onOther?: (values:any) => void;\r\n    createRow?: CreateRow;\r\n    createControl?: CreateControl;\r\n    readOnly?: boolean;\r\n}\r\n\r\nexport class FormView {\r\n    uid:string;\r\n    private rows: RowContainer[] = [];\r\n    private buttonsRow: RowContainer;\r\n    props: FormProps;\r\n    createControl?: CreateControl;\r\n    constructor(props:FormProps) {\r\n        this.uid = uid();\r\n        this.props = props;\r\n        this.buildRows(props);\r\n        this.createControl = props.createControl;\r\n        this.onSubmit = this.onSubmit.bind(this);\r\n    }\r\n\r\n    @computed get hasError():boolean {\r\n        let ret = this.rows.map((v, index) => index + ': ' + v.hasError + '\\n');\r\n        console.log(ret);\r\n        return this.rows.some(row => row.hasError);\r\n    }\r\n    @computed get nothing():boolean {\r\n        let ret = this.rows.every(row => !row.filled);\r\n        return ret;\r\n    }\r\n\r\n    readValues():any {\r\n        let values = {} as any;\r\n        for (let row of this.rows) {\r\n            row.readValues(values);\r\n        }\r\n        return values;\r\n    }\r\n\r\n    clear() {\r\n        for (let row of this.rows) {\r\n            row.clear();\r\n        }\r\n    }\r\n\r\n    clearErrors() {\r\n        for (let row of this.rows) {\r\n            row.clearErrors();\r\n        }\r\n    }\r\n\r\n    setError(fieldName:string, error:string) {\r\n        for (let row of this.rows) {\r\n            row.setError(fieldName, error);\r\n        }\r\n    }\r\n\r\n    setInitValues(initValues:any) {\r\n        if (initValues === undefined) return;\r\n        for (let row of this.rows) {\r\n            row.setInitValues(initValues);\r\n        }\r\n    }\r\n\r\n    private buildRows(props:FormProps) {\r\n        let {formRows, createRow} = props;\r\n        if (formRows !== undefined) {\r\n            for (let row of formRows) {\r\n                this.rows.push(this.buildRow(row, createRow));\r\n            }\r\n            if (this.props.readOnly !== true) {\r\n                this.buttonsRow = this.buildRow({createControl:this.createButtons.bind(this)}, undefined);\r\n            }\r\n        }\r\n        else {\r\n            this.rows.push(elementCreateRow(this, <div className=\"text-warning\">TonvaForm need formRows defined</div>));\r\n        }\r\n    }\r\n\r\n    private buildRow(formRow: FormRow, formRowCreator: CreateRow):RowContainer {\r\n        let createRow:CreateRow;\r\n        let type = (formRow as JSX.Element).type;\r\n        if (type !== undefined) {\r\n            createRow = elementCreateRow;\r\n        }\r\n        else {\r\n            createRow = (formRow as (FieldRow | GroupRow | LabeledRow)).createRow;\r\n            if (createRow === undefined) {\r\n                createRow = formRowCreator;\r\n                if (createRow === undefined) createRow = bootstrapCreateRow;\r\n            }\r\n        }\r\n        let row = createRow(this, formRow);\r\n        return row;\r\n    }\r\n\r\n    private createButtons(form:FormView, row: FormRow) {\r\n        return new ButtonsControl(form);\r\n    }\r\n\r\n    private isOk():boolean {\r\n        let isOk = true;\r\n        for (let row of this.rows) {\r\n            if (!row.isOk()) isOk = false;\r\n        }\r\n        return isOk;\r\n    }\r\n\r\n    render():JSX.Element {\r\n        return <form onSubmit={this.onSubmit}>\r\n            {this.rows.map((row,index) => row.render(this.uid + index))}\r\n            {this.buttons()}\r\n        </form>;\r\n    }\r\n\r\n    buttons():JSX.Element {\r\n        if (this.buttonsRow === undefined) return;\r\n        return this.buttonsRow.render(this.uid + this.rows.length);\r\n    }\r\n    \r\n    async onSubmit(event:FormEvent<HTMLFormElement>) {\r\n        event.preventDefault();\r\n        if (!this.isOk()) return;\r\n        let values = this.readValues();\r\n        await this.props.onSubmit(values);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { Page, ItemSchema, UiSchema, StringSchema, UiTextItem, Edit, ImageSchema, nav, UiImageItem } from '../components';\r\nimport { userApi } from '../net';\r\n\r\nexport class EditMeInfo extends React.Component {\r\n    private schema:ItemSchema[] = [\r\n        {name:'nick', type:'string'} as StringSchema,\r\n        {name:'icon', type:'image'} as ImageSchema\r\n    ];\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            nick: {widget:'text', label:'', placeholder:''} as UiTextItem,\r\n            icon: {widget:'image', label:''} as UiImageItem,\r\n        }\r\n    }\r\n    @observable private data:any;\r\n\r\n    constructor(props:any) {\r\n        super(props);\r\n        let {nick, icon} = nav.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        }\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema:ItemSchema, newValue:any, preValue:any) => {\r\n        let {name} = itemSchema;        \r\n        await userApi.userSetProp(name, newValue);\r\n        this.data[name] = newValue;\r\n        let user:any = nav.user;\r\n        user[name] = newValue;\r\n        nav.saveLocalUser();\r\n    }\r\n\r\n    render() {\r\n        return <Page header=\"\">\r\n            <Edit schema={this.schema} uiSchema={this.uiSchema}\r\n                data={this.data}\r\n                onItemChanged={this.onItemChanged} />\r\n        </Page>;\r\n    }\r\n}\r\n","import { Login } from '../components';\r\n\r\nexport async function createLogin():Promise<Login> {\r\n\tlet importCLogin = await import('./CLogin');\r\n\treturn new importCLogin.CLogin(undefined);\r\n}\r\n","import * as React from 'react';\r\nimport { IValuesView, IValuesViewRenderOptions } from '../../components';\r\nimport { Tag, TagValue } from './tag';\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class TagView implements IValuesView {\r\n\tprivate tag: Tag;\r\n\tconstructor(tag: Tag) {\r\n\t\tthis.tag = tag;\r\n\t}\r\n\trender(values: number|string):JSX.Element {\r\n\t\tlet names:string[];\r\n\t\tif (typeof values === 'number') {\r\n\t\t\tnames = [this.tag.nameFromId(values)];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tnames = this.tag.namesFromIds(values);\r\n\t\t}\r\n\t\treturn <div className=\"d-flex flex-wrap \">{names.map((name, index)=>{\r\n\t\t\treturn <div key={index} className=\"mx-2 border border-muted rounded px-3 bg-light\">{name}</div>\r\n\t\t})}</div>;\r\n\t}\r\n\trenderRadios(value: number, options: IValuesViewRenderOptions): JSX.Element {\r\n        let content = this.tag.values.map((item,index) => {\r\n\t\t\treturn <div className=\"col\" key={index}>{this.renderRadio(item, value, options)}</div>;\r\n        });\r\n\t\treturn this.renderView(options, content);\r\n\t}\r\n\trenderChecks(values: string, options: IValuesViewRenderOptions): JSX.Element {\r\n\t\tlet arr = values===undefined? undefined : values.split('|').map(v => Number(v));\r\n\t\tlet content = this.tag.values.map((item,index) => {\r\n\t\t\tlet checked: boolean = arr===undefined? undefined : arr.indexOf(item.id)>=0;\r\n\t\t\treturn <div className=\"col\" key={index}>{this.renderCheck(item, checked, options)}</div>\r\n\t\t});\r\n\t\treturn this.renderView(options, content);\r\n\t}\r\n\tprivate renderView(options: IValuesViewRenderOptions, content:any) {\r\n\t\tlet {className, wrapClassName} = options;\r\n\t\twrapClassName = wrapClassName?\r\n\t\t\t'row ' + wrapClassName\r\n\t\t\t:\r\n\t\t\t'row row-cols-2 row-cols-sm-3 row-cols-md-4';\r\n\t\treturn <div className={className} style={radioStyle}>\r\n\t\t\t<div className={wrapClassName}>\r\n                {content}\r\n\t\t\t</div>\r\n        </div>;\r\n\t}\r\n\tprivate renderRadio(item:TagValue, value: number, options: IValuesViewRenderOptions):JSX.Element {\r\n\t\tlet {id, name} = item;\r\n\t\tlet {inputs, inputName, onInputChange} = options;\r\n\t\tlet ref = inputs && ((input:HTMLInputElement)=>inputs[id]=input);\r\n\t\treturn <label className=\"form-radio-inline\">\r\n\t\t\t<input ref={ref} type=\"radio\" name={inputName}\r\n\t\t\t\tvalue={id} defaultChecked={value===id}\r\n\t\t\t\tonChange={onInputChange} />\r\n\t\t\t{name}\r\n\t\t</label>;\r\n\t}\r\n\r\n\tprivate renderCheck(item:TagValue, checked: boolean, options: IValuesViewRenderOptions):JSX.Element {\r\n\t\tlet {id, name} = item;\r\n\t\tlet {inputs, onInputChange} = options;\r\n\t\tlet ref = inputs && ((input:HTMLInputElement)=>inputs[id]=input);\r\n\t\treturn <label className=\"form-radio-inline\">\r\n\t\t\t<input ref={ref} type=\"checkbox\"\r\n\t\t\t\tvalue={id} defaultChecked={checked}\r\n\t\t\t\tonChange={onInputChange} />\r\n\t\t\t{name}\r\n\t\t</label>;\r\n\t}\r\n}\r\n","import { Entity } from \"../entity\";\r\nimport { TagView } from \"./tagView\";\r\n\r\nexport interface TagValue {\r\n\tid: number;\r\n\tname: string;\r\n\text: string;\r\n}\r\n\r\nexport class Tag extends Entity {\r\n    get typeName(): string { return 'tag';}\r\n\tvalues: TagValue[];\r\n\tprivate coll: {[id:number]: TagValue} = {};\r\n\r\n\tprivate _view: TagView;\r\n\tget view(): TagView { \r\n\t\tif (this._view !== undefined) return this._view; \r\n\t\treturn this._view = new TagView(this);\r\n\t}\r\n\r\n\tnameFromId(id:number) {\r\n\t\tlet c = this.coll[id]; \r\n\t\treturn c===undefined? undefined : c.name;\r\n\t}\r\n\r\n\tnamesFromIds(ids:string):string[] {\r\n\t\tlet ret:string[] = [];\r\n\t\tfor (let id of ids.split('|')) {\r\n\t\t\tlet c = this.coll[Number(id)];\r\n\t\t\tlet name = c===undefined? undefined : c.name;\r\n\t\t\tif (name !== undefined) ret.push(name);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync loadValues():Promise<TagValue[]> {\r\n\t\tif (this.values !== undefined) return this.values;\r\n\t\tthis.values = [];\r\n\t\tlet ret = await this.uqApi.get('tag/values/' + this.name);\r\n\t\tif (ret === undefined) return;\r\n\t\tlet lines = (ret as string).split('\\n');\r\n\t\tfor (let line of lines) {\r\n\t\t\tif (line.length === 0) continue;\r\n\t\t\tlet parts = line.split('\\t');\r\n\t\t\tlet id = Number(parts[0]);\r\n\t\t\tlet val = {\r\n\t\t\t\tid: id,\r\n\t\t\t\tname: parts[1],\r\n\t\t\t\text: parts[2],\r\n\t\t\t};\r\n\t\t\tthis.values.push(val);\r\n\t\t\tthis.coll[id] = val;\r\n\t\t}\r\n\t\treturn this.values;\r\n\t}\r\n}\r\n","//import _ from 'lodash';\r\nimport { KeyValueRes, Res } from './res';\r\n\r\nexport interface FormRes extends KeyValueRes {\r\n    required: string;\r\n    number: string;\r\n    integer: string;\r\n    min: string;\r\n    max: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const formRes:Res<FormRes> = {\r\n    _: {\r\n        required: 'required',\r\n        number: 'not valid number',\r\n        integer: 'not valid integer',\r\n        min: 'min value is ${min}',\r\n        max: 'max value is ${max}',\r\n    },\r\n    zh: {\r\n        _: {\r\n            required: '',\r\n            number: '',\r\n            integer: '',\r\n            min: '${min}',\r\n            max: '${max}',\r\n        }\r\n    },\r\n}\r\n","import { KeyValueRes, Res } from './res';\r\n\r\nexport interface ListRes extends KeyValueRes {\r\n    none: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const listRes:Res<ListRes> = {\r\n    _: {\r\n        none: '[none]',\r\n    },\r\n    zh: {\r\n        _: {\r\n            none: '[]',\r\n        }\r\n    },\r\n}\r\n","export * from './page';\r\nexport * from './tabs';\r\nexport * from './scrollView';\r\nexport * from './pageHeader';","export * from './schema';\r\nexport * from './uiSchema';\r\nexport * from './toUiSelectItems';\r\nexport * from './IValuesView';","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface DropdownAction {\r\n    icon?: string;\r\n    caption?: string;\r\n\taction?: () => void;\r\n\ticonClass?: string;\r\n\tcaptionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsProps {\r\n    icon?: string;\r\n    actions: DropdownAction[];\r\n    isRight?: boolean;\r\n\tclassName?: string;\r\n\titemIconClass?: string;\r\n\titemCaptionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsState {\r\n    dropdownOpen: boolean;\r\n}\r\n\r\nexport class DropdownActions extends React.Component<DropdownActionsProps, DropdownActionsState> {\r\n    private menu: HTMLDivElement;\r\n    private button: HTMLElement;\r\n    constructor(props:DropdownActionsProps) {\r\n        super(props);\r\n        this.state = {\r\n            dropdownOpen: false\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        document.addEventListener('click', this.handleDocumentClick);\r\n        document.addEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.removeEventListener('click', this.handleDocumentClick);\r\n        document.removeEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\r\n    private handleDocumentClick = (evt:any) => {\r\n        if (this.state.dropdownOpen === false) return;\r\n        if (this.button && this.button.contains(evt.target)) return;\r\n        if (!this.menu) return;\r\n        //if (!this.menu.contains(evt.target)) \r\n        this.toggle();\r\n    }\r\n\r\n    private toggle = () => {\r\n        this.setState({\r\n            dropdownOpen: !this.state.dropdownOpen\r\n        });\r\n    }\r\n\r\n    render() {\r\n        let {icon, actions, isRight, className, itemIconClass, itemCaptionClass} = this.props;\r\n        if (isRight === undefined) isRight = true;\r\n        let hasIcon = actions.some(v => v.icon!==undefined);\r\n        let {dropdownOpen} = this.state;\r\n\t\t//isOpen={this.state.dropdownOpen} toggle={this.toggle}\r\n\t\tlet cn = className || 'cursor-pointer dropdown-toggle btn btn-sm';\r\n\t\t//if (className) cn += className;\r\n        return <div className={'dropdown'}>\r\n\t\t\t<button ref={v=>this.button=v} \r\n\t\t\t\tclassName={cn}\r\n                data-toggle=\"dropdown\"\r\n                aria-expanded={dropdownOpen}\r\n                onClick={this.toggle}>\r\n                <i className={classNames('fa fa-fw ', 'fa-'+(icon||'ellipsis-v'))} />\r\n            </button>\r\n            <div ref={v => this.menu=v} className={classNames({\"dropdown-menu\":true, \"dropdown-menu-right\":isRight, \"show\":dropdownOpen})}>\r\n                {\r\n                    actions.map((v,index) => {\r\n\t\t\t\t\t\tif (!v) {\r\n                            return <div className=\"dropdown-divider\" key={index}/>;\r\n\t\t\t\t\t\t}\r\n                        let {icon, caption, action, iconClass, captionClass} = v;\r\n                        if (icon === undefined && caption === undefined) \r\n                            return <div className=\"dropdown-divider\" />;\r\n                        let i:any;\r\n                        if (hasIcon === true) {\r\n                            if (icon !== undefined) icon = 'fa-' + icon;\r\n\t\t\t\t\t\t\ti = <i className={classNames('mr-2', 'fa', icon, 'fa-fw', iconClass || itemIconClass)}\r\n\t\t\t\t\t\t\t\taria-hidden={true}></i>;\r\n                        }\r\n                        if (action === undefined) \r\n                            return <h6 className=\"dropdown-header\">{i} {caption}</h6>;\r\n                        let onMenuItemClick = (evt:React.MouseEvent<HTMLAnchorElement>)=>{\r\n                            evt.preventDefault();\r\n                            action();\r\n                        }\r\n                        let onTouchStart = (evt: React.TouchEvent<HTMLAnchorElement>) => {\r\n                            action();\r\n                        }\r\n                            // eslint-disable-next-line\r\n                        return <a className=\"dropdown-item\" key={index} href=\"#/\" \r\n                            onClick={onMenuItemClick} onTouchStart={onTouchStart}\r\n                            >{i} <span className={captionClass || itemCaptionClass}>{caption}</span></a>\r\n                    })\r\n                }\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { setRes } from '../../components';\r\n\r\nexport interface EasyDateProps {\r\n    date: Date | number;\r\n}\r\n\r\n//type YMD = (year:number, month:number, date:number) => string;\r\n//type MD = (month:number, date:number) => string;\r\n\r\nconst timeRes:{[prop:string]:any} = {\r\n\tmd: (month:number, date:number) => `${month}-${date}`,\r\n\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\r\n\tyesterday: 'Yday',\r\n\ttoday: 'Today',\r\n\ttomorrow: 'Tmw',\r\n\t$zh: {\r\n\t\tmd: (month:number, date:number) => `${month}${date}`,\r\n\t\tymd: (year:number, month:number, date:number) => `${year}${month}${date}`,\r\n\t\tyesterday: '',\r\n\t\ttoday: '',\r\n\t\ttomorrow: '',\r\n\t},\r\n\t$en: {\r\n\t\tmd: (month:number, date:number) => `${month}-${date}`,\r\n\t\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\r\n\t\tyesterday: 'Yday',\r\n\t\ttoday: 'Today',\r\n\t\ttomorrow: 'Tmw',\r\n\t}\r\n}\r\n\r\nsetRes(timeRes, timeRes);\r\n\r\nfunction tt(str:string):any {\r\n\treturn timeRes[str];\r\n}\r\n\r\nfunction renderDate(vDate:Date|number, withTime:boolean, always:boolean = false) {\r\n    if (!vDate) return null;\r\n    let date: Date;\r\n    switch (typeof vDate) {\r\n        default: date = vDate as Date; break;\r\n        case 'string': date = new Date(vDate); break;\r\n        case 'number': date = new Date((vDate as number)*1000); break;\r\n    }\r\n\r\n    let now = new Date();\r\n    let tick:number, nDate:number, _date:number, month:number, year:number, nowYear:number;\r\n    let d = date;\r\n    tick = now.getTime() - d.getTime();\r\n    let hour=d.getHours(), minute=d.getMinutes();\r\n    nDate=now.getDate();\r\n    _date=d.getDate();\r\n    month=d.getMonth()+1;\r\n    year=d.getFullYear();\r\n\tnowYear = now.getFullYear();\r\n\r\n\tlet appendTime:boolean = false;\r\n\tlet dPart:string = (function() {\r\n\t\tif (tick < -24*3600*1000) {\r\n\t\t\tif (year === nowYear) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('md')(month, _date);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('ymd')(year, month, _date);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tick < 24*3600*1000) {\r\n\t\t\tif (_date!==nDate) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt(tick < 0? 'tomorrow' : 'yesterday');\r\n\t\t\t}\r\n\t\t\tif (withTime===true) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\treturn tt('today');\r\n\t\t}\r\n\t\tif (year === nowYear) {\r\n\t\t\treturn tt('md')(month, _date);\r\n\t\t}\r\n\t\treturn tt('ymd')(year, month, _date);\r\n\t})();\r\n\r\n\tlet hm = hour + ((minute<10?':0':':') + minute);\r\n\r\n\t/*\r\n    if (tick < -24*3600*1000) {\r\n        if (year === nowYear)\r\n            return tt('md')(month, _date) + ' ' + hm;\r\n        else\r\n            return tt('ymd')(year, month, _date) + ' ' + hm;\r\n    }\r\n    if (always === true || tick < 24*3600*1000) {\r\n        return _date!==nDate? \r\n            tt(tick < 0? 'tomorrow' : 'yesterday') + ' ' + hm \r\n            : withTime===true? hm : tt('today');\r\n    }\r\n    if (year === nowYear) {\r\n        return tt('md')(month, _date);\r\n    }\r\n\treturn tt('ymd')(year, month, _date);\r\n\t*/\r\n\tif (appendTime === true || always === true) {\r\n\t\treturn dPart + ' ' + hm;\r\n\t}\r\n\treturn dPart;\r\n}\r\n\r\n\r\nexport class EasyDate extends React.Component<EasyDateProps> {\r\n    render() {\r\n        return renderDate(this.props.date, false);\r\n    }\r\n}\r\n\r\ninterface EasyTimeProps extends EasyDateProps {\r\n\talways?: boolean;\r\n}\r\nexport class EasyTime extends React.Component<EasyTimeProps> {\r\n    render() {\r\n\t\tlet {date, always} = this.props;\r\n        return renderDate(date, true, always);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Image } from '.';\r\n\r\nexport interface MediaProps {\r\n    icon: string;\r\n    main: string|JSX.Element;\r\n    discription?: string | JSX.Element;\r\n    px?: number;\r\n    py?: number;\r\n}\r\n\r\nexport class Media extends React.Component<MediaProps> {\r\n    render() {\r\n        let {icon, main, discription, px, py} = this.props;\r\n        let disp:any;\r\n        if (typeof discription === 'string')\r\n            disp = <div>{discription}</div>;\r\n        else\r\n            disp = discription;\r\n        let cn = classNames(\r\n            'media', \r\n            px===undefined? 'px-0':'px-'+px, \r\n            py===undefined? 'py-2':'py-'+py);\r\n        return <div className={cn}>\r\n            <Image className=\"mr-3 w-4c h-4c\" src={icon} />\r\n            <div className=\"media-body\">\r\n                <h5 className=\"mt-0\">{main}</h5>\r\n                {disp}\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observable } from 'mobx';\r\n\r\nexport interface SearchBoxProps {\r\n    className?: string;\r\n    label?: string;\r\n    initKey?: string;\r\n    placeholder?: string;\r\n    buttonText?: string;\r\n    maxLength?: number;\r\n    size?: 'sm' | 'md' | 'lg';\r\n    inputClassName?: string;\r\n    onSearch: (key:string)=>Promise<void>;\r\n    onFocus?: ()=>void;\r\n    allowEmptySearch?: boolean;\r\n}\r\n\r\n/*\r\nexport interface SearchBoxState {\r\n    disabled: boolean;\r\n}*/\r\n\r\nexport class SearchBox extends React.Component<SearchBoxProps> { //}, SearchBoxState> {\r\n    private input: HTMLInputElement;\r\n    private key: string = null;\r\n    @observable private disabled: boolean;\r\n\r\n    private onChange = (evt: React.ChangeEvent<any>) => {\r\n        this.key = evt.target.value;\r\n        if (this.key !== undefined) {\r\n            this.key = this.key.trim();\r\n            if (this.key === '') this.key = undefined;\r\n        }\r\n        if (this.props.allowEmptySearch !== true) {\r\n            this.disabled = !this.key;\r\n        }\r\n    }\r\n    private onSubmit = async (evt: React.FormEvent<any>) => {\r\n        evt.preventDefault();\r\n        if (this.key === null) this.key = this.props.initKey || '';\r\n        if (this.props.allowEmptySearch !== true) {\r\n            if (!this.key) return;\r\n            if (this.input) this.input.disabled = true;\r\n        }\r\n        await this.props.onSearch(this.key);\r\n        if (this.input) this.input.disabled = false;\r\n    }\r\n    clear() {\r\n        if (this.input) this.input.value = '';\r\n    }\r\n    render() {\r\n        let {className, inputClassName, onFocus,\r\n            label, placeholder, buttonText, maxLength, size} = this.props;\r\n        let inputSize:string;\r\n        switch (size) {\r\n            default:\r\n            case 'sm': inputSize = 'input-group-sm'; break;\r\n            case 'md': inputSize = 'input-group-md'; break;\r\n            case 'lg': inputSize = 'input-group-lg'; break;\r\n        }\r\n        return <form className={className} onSubmit={this.onSubmit} >\r\n            <div className={classNames(\"input-group\", inputSize)}>\r\n                {label && <div className=\"input-group-addon align-self-center mr-2\">{label}</div>}\r\n                <input ref={v=>this.input=v} onChange={this.onChange}\r\n                    type=\"text\"\r\n                    name=\"key\"\r\n                    onFocus={onFocus}\r\n                    className={classNames('form-control', inputClassName || 'border-primary')}\r\n                    placeholder={placeholder}\r\n                    defaultValue={this.props.initKey}\r\n                    maxLength={maxLength} />\r\n                <div className=\"input-group-append\">\r\n                    <button className=\"btn btn-primary\"\r\n                        type=\"submit\"\r\n                        disabled={this.disabled}>\r\n                        <i className='fa fa-search' />\r\n                        <i className=\"fa\"/>\r\n                        {buttonText}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </form>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { nav } from './nav';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { userApi } from '../net';\r\nimport { User } from '../tool';\r\n\r\nexport type UserLoader = (userId:number)=>Promise<any>;\r\n\r\nexport class UserCache<T> {\r\n\tprivate loader: UserLoader;\r\n\tprivate onLoaded: (user:User) => void;\r\n\tprivate map = observable(new Map<number, T|number>());\r\n\r\n\tconstructor(loader: UserLoader) {\r\n\t\tif (loader === undefined) loader = (userId:number)=>userApi.user(userId);\r\n\t\tthis.loader = loader;\r\n\t}\r\n\r\n\tuse(id:number|any, onLoaded?:(user:User)=>void) {\t\t\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tif (!id) return;\r\n\t\tthis.onLoaded = onLoaded;\r\n\t\tid = Number(id);\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (ret === undefined) {\r\n\t\t\tthis.map.set(id, id);\r\n\t\t}\r\n\t}\r\n\r\n\tgetValue(id:number|any):any {\r\n\t\tif (!id) return;\r\n\t\tswitch (typeof(id)) {\r\n\t\t\tcase 'object': \r\n\t\t\t\tid = id.id; \r\n\t\t\t\tif (!id) return;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (!ret) return;\r\n\t\tswitch (typeof(ret)) {\r\n\t\tdefault:\r\n\t\t\treturn ret;\r\n\t\tcase 'number':\r\n\t\t\tif (ret < 0) return id;\r\n\t\t\tthis.map.set(id, -id);\r\n\t\t\tthis.loader(id).then(v => {\r\n\t\t\t\tif (!v) v = null;\r\n\t\t\t\tthis.map.set(id, v);\r\n\t\t\t\tif (this.onLoaded) this.onLoaded(v);\r\n\t\t\t}).catch(reason => {\r\n\t\t\t\tconsole.error(reason);\r\n\t\t\t});\r\n\t\t\treturn id;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst userCache = new UserCache(undefined);\r\n\r\nexport interface UserIconProps {\r\n    id: number;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    altImage?: string;\r\n    noneImage?: any;\r\n}\r\n\r\nexport const UserIcon = observer((props: UserIconProps):JSX.Element => {\r\n    let {className, style, id, altImage, noneImage} = props;\r\n    let user = userCache.getValue(id);\r\n    switch (typeof user) {\r\n\tcase 'undefined':\r\n\tcase 'number':\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            {noneImage || <i className=\"fa fa-file-o\" />}\r\n        </div>;\r\n    }\r\n    let {icon} = user;\r\n    if (!icon) {\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            <i className=\"fa fa-file-o\" />\r\n        </div>;\r\n    }\r\n    if (icon.startsWith(':') === true) {\r\n        icon = nav.resUrl + icon.substr(1);\r\n    }\r\n    return <img src={icon} className={className} alt=\"img\"\r\n        style={style}\r\n        onError={evt=>{\r\n            if (altImage) evt.currentTarget.src=altImage;\r\n            else evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n        }} />;\r\n});\r\n\r\nexport interface UserViewProps {\r\n\tid?: number;\r\n\tuser?: number|User;\r\n\trender: (user:User) => JSX.Element;\r\n\tonLoaded?: (user:User) => void\r\n}\r\n\r\nexport const UserView = observer((props: UserViewProps):JSX.Element => {\r\n\tlet {id:idProp, user, render, onLoaded} = props;\r\n\tif (user === null) return <>null</>;\r\n\tswitch (typeof user) {\r\n\t\tcase 'undefined': \r\n\t\t\tuser = userCache.getValue(idProp);\r\n\t\t\tbreak;\r\n\t\tcase 'object': \r\n\t\t\tlet {/*obj, */id} = user as any;\r\n\t\t\t//if (typeof obj !== 'object') {\r\n\t\t\t\tuseUser(id, onLoaded);\r\n\t\t\t\tuser = userCache.getValue(id);\r\n\t\t\t//}\r\n\t\t\tbreak;\r\n\t\tcase 'number':\r\n\t\t\tuseUser(user as number, onLoaded);\r\n\t\t\tuser = userCache.getValue(user as number);\r\n\t\t\tbreak;\r\n\t\tcase 'string':\r\n\t\t\tuseUser(Number(user), onLoaded);\r\n\t\t\tuser = userCache.getValue(Number(user));\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tuser = undefined;\r\n\t\t\tbreak;\r\n\t}\r\n    switch (typeof user) {\r\n\t\tcase 'undefined':\r\n\t\tcase 'number':\r\n        \treturn <>{user}</>;\r\n    }\r\n    return render(user);\r\n});\r\n\r\nexport function useUser(id: number|object, onLoaded?: (user:User)=>void) {\r\n\tif (!id) return;\r\n\tif (typeof(id) === 'object') {\r\n\t\tid = (id as any).id;\r\n\t}\r\n\tuserCache.use(id, onLoaded);\r\n}\r\n","import React from \"react\";\r\nimport classNames from 'classnames';\r\nimport { nav } from \"../nav\";\r\n\r\nexport interface AxProps extends React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement> {\r\n\t//children: React.ReactNode;\r\n\t//href: string;\r\n\t//onClick?: (event:React.MouseEvent) => void;\r\n\t//className?: string;\r\n\taClassName?: string;\r\n\tnaClassName?: string;\r\n\t//target?: string;\r\n\t//props?: any;\r\n}\r\n\r\n// webwebNavroute\r\n// appclick\r\nexport const Ax = (axProps: AxProps) => {\r\n\tlet {href, children, className, onClick} = axProps;\r\n\tif (nav.isWebNav === true) {\r\n\t\tlet {aClassName } = axProps;\r\n\t\tif (!href) return <span className=\"text-danger\">Error: href not defined in Ax</span>;\r\n\t\tlet onAxClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\t\tevt.preventDefault();\r\n\t\t\tlet ret:boolean;\r\n\t\t\tif (onClick) {\r\n\t\t\t\tret = onClick(evt) as unknown as boolean;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tnav.navigate(href);\r\n\t\t\t\tret = false;\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\treturn <a {...axProps} className={classNames(className, aClassName)} onClick={onAxClick}>{children}</a>;\r\n\t}\r\n\telse {\r\n\t\tlet {naClassName} = axProps;\r\n\t\tif (!onClick) {\r\n\t\t\tonClick = () => {\r\n\t\t\t\tnav.openSysPage(href); //.navigate(href);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <span className={classNames(className, 'cursor-pointer', naClassName)} onClick={onClick}>{children}</span>;\r\n\t}\r\n}\r\n\r\n// a tag\r\n// href\r\nexport const A = (props: React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement>) => {\r\n\tlet {children} = props;\r\n\tif (nav.isWebNav === false) {\r\n\t\treturn <a {...props}>{children}</a>;\r\n\t}\r\n\tlet {href} = props;\r\n\t//if (nav.testing === true) href += '#test';\r\n\tlet onClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\tevt.preventDefault();\r\n\t\tnav.navigate(href);\r\n\t\treturn false;\r\n\t}\r\n\treturn <a {...props} href={href} onClick={onClick}>{children}</a>;\r\n}\r\n","import { UqMan, TuidModify } from '../uqMan';\r\nimport { Tuid } from \"./tuid\";\r\nimport { env } from '../../tool';\r\n\r\ninterface Modify {\r\n    id: number;\r\n    entity: string;\r\n    key: string;\r\n}\r\n\r\nexport class TuidsCache {\r\n    private readonly uq: UqMan;\r\n    private modifyMax: TuidModify;\r\n    private cacheTimer: any;\r\n    constructor(uq: UqMan) {\r\n        this.uq = uq;\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.clearCacheTimer();\r\n        this.cacheTimer = env.setTimeout('TuidsCache.cacheTuids', this.loadIds, defer);\r\n    }\r\n    private clearCacheTimer() {\r\n        if (this.cacheTimer === undefined) return;\r\n        env.clearTimeout(this.cacheTimer);\r\n        this.cacheTimer = undefined;\r\n    }\r\n    private loadIds = () => {\r\n        this.clearCacheTimer();\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            let tuid = tuids[i];\r\n            tuid.cacheIds();\r\n        }\r\n    }\r\n    \r\n    pullModify(modifyMax:number) {\r\n        if (modifyMax === undefined) return;\r\n        let now = Math.floor(Date.now() / 1000);\r\n        if (this.modifyMax === undefined) {\r\n            this.modifyMax = this.uq.localModifyMax.get();\r\n            if (this.modifyMax === undefined) {\r\n                this.modifyMax = {\r\n                    max: modifyMax,\r\n                    seconds: now,\r\n                };\r\n                this.uq.localModifyMax.set(this.modifyMax);\r\n            }\r\n        }\r\n        let {max, seconds} = this.modifyMax;\r\n        let lockGap = 3600;\r\n        if (now - seconds < lockGap) return;\r\n        if (modifyMax <= max) return;\r\n        let tuidCached:string[] = [];\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            //if (tuids[i].cached === true) \r\n            tuidCached.push(i);\r\n        }\r\n        if (tuidCached.length === 0) return;\r\n        this.modifyMax.seconds = now;\r\n        this.innerPullModify(tuidCached.join('\\t'));\r\n    }\r\n\r\n    private async innerPullModify(tuidLists:string):Promise<void> {\r\n        let {uqApi, tuids} = this.uq;\r\n        let {max} = this.modifyMax;\r\n        let ret:{queue:Modify[], queueMax:number} = await uqApi.queueModify(max, 30, tuidLists);\r\n        let group:{[entity:string]: {tuid:Tuid; ids: string[]}} = {};\r\n        let modifyMax:number = 0;\r\n        for (let modify of ret.queue) {\r\n\t\t\tlet {id, entity, key} = modify;\r\n\t\t\tif (!key) continue;\r\n            let tuid = tuids[entity];\r\n            if (tuid === undefined) continue;\r\n            let item = group[entity];\r\n            if (item === undefined) {\r\n                item = group[entity] = {tuid: tuid, ids:[]};\r\n            }\r\n            item.ids.push(key);\r\n            if (id > modifyMax) modifyMax = id;\r\n        }\r\n        for (let i in group) {\r\n            let {tuid, ids} = group[i];\r\n            await tuid.modifyIds(ids);\r\n        }\r\n        let now = Math.floor(Date.now() / 1000);\r\n        this.modifyMax = {\r\n            max: modifyMax,\r\n            seconds: now,\r\n        }\r\n        this.uq.localModifyMax.set(this.modifyMax);\r\n    }\r\n}\r\n","import { LocalMap, LocalCache, env } from '../tool';\r\nimport { UqData, UqAppData, loadAppUqs } from '../net';\r\nimport { UqMan } from './uqMan';\r\nimport { TuidImport, TuidInner } from './tuid';\r\nimport { nav } from '../components';\r\n\r\nexport interface TVs {\r\n    [uqName:string]: {\r\n        [tuidName: string]: (values: any) => JSX.Element;\r\n    }\r\n}\r\n\r\nexport class UQsMan {\r\n\tstatic _uqs: any;\r\n\tstatic value: UQsMan;\r\n\tstatic errors: string[];\r\n\r\n\tstatic async load(tonvaAppName:string, version:string, tvs:TVs) {\r\n\t\tlet uqsMan = UQsMan.value = new UQsMan(tonvaAppName, tvs);\r\n        let {appOwner, appName} = uqsMan;\r\n        let {localData} = uqsMan;\r\n        let uqAppData:UqAppData = localData.get();\r\n        if (!uqAppData || uqAppData.version !== version) {\r\n\t\t\tuqAppData = await loadAppUqs(appOwner, appName);\r\n\t\t\tif (!uqAppData.id) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t`${appOwner}/${appName}app`\r\n\t\t\t\t];\r\n\t\t\t}\r\n            uqAppData.version = version;\r\n            localData.set(uqAppData);\r\n            // \r\n            for (let uq of uqAppData.uqs) uq.newVersion = true;\r\n        }\r\n        let {id, uqs} = uqAppData;\r\n        uqsMan.id = id;\r\n        await uqsMan.init(uqs);\r\n        let retErrors = await uqsMan.load();\r\n        if (retErrors.length === 0) {\r\n            retErrors.push(...uqsMan.setTuidImportsLocal());\r\n            if (retErrors.length === 0) {\r\n                UQsMan._uqs = uqsMan.buildUQs();\r\n                return;\r\n            }\r\n        }\r\n        UQsMan.errors = retErrors;\r\n\t}\r\n\r\n    private collection: {[uqName: string]: UqMan};\r\n    private readonly tvs: TVs;\r\n\r\n    readonly appOwner: string;\r\n    readonly appName: string;\r\n    readonly localMap: LocalMap;\r\n    readonly localData: LocalCache;\r\n    id: number;\r\n\r\n    private constructor(tonvaAppName:string, tvs:TVs) {\r\n        this.tvs = tvs || {};\r\n        this.buildTVs();\r\n        this.collection = {};\r\n        let parts = tonvaAppName.split('/');\r\n        if (parts.length !== 2) {\r\n            throw new Error('tonvaApp name must be / separated, owner/app');\r\n        }\r\n        this.appOwner = parts[0];\r\n        this.appName = parts[1];\r\n        this.localMap = env.localDb.map(tonvaAppName);\r\n        this.localData = this.localMap.child('uqData');\r\n    }\r\n\r\n    // to be removed in the future\r\n    addUq(uq: UqMan) {\r\n        this.collection[uq.name] = uq;\r\n    }\r\n\r\n    private buildTVs() {\r\n        for (let i in this.tvs) {\r\n            let uqTVs = this.tvs[i];\r\n            if (uqTVs === undefined) continue;\r\n            let l = i.toLowerCase();\r\n            if (l === i) continue;\r\n            this.tvs[l] = uqTVs;\r\n            for (let j in uqTVs) {\r\n                let en = uqTVs[j];\r\n                if (en === undefined) continue;\r\n                let lj = j.toLowerCase();\r\n                if (lj === j) continue;\r\n                uqTVs[lj] = en;\r\n            }\r\n        }\r\n    }\r\n\r\n    async init(uqsData:UqData[]):Promise<void> {\r\n        let promiseInits: PromiseLike<void>[] = uqsData.map(uqData => {\r\n\t\t\tlet {uqOwner, uqName} = uqData;\r\n\t\t\tlet uqFullName = uqOwner + '/' + uqName;\r\n\t\t\t//let uqUI = this.ui.uqs[uqFullName] as UqUI || {};\r\n\t\t\t//let cUq = this.newCUq(uqData, uqUI);\r\n\t\t\t//this.cUqCollection[uqFullName] = cUq;\r\n\t\t\t//this.uqs.addUq(cUq.uq);\r\n\t\t\tlet uq = new UqMan(this, uqData, undefined, this.tvs[uqFullName] || this.tvs[uqName]);\r\n\t\t\tthis.collection[uqFullName] = uq;\r\n\t\t\tlet lower = uqFullName.toLowerCase();\r\n\t\t\tif (lower !== uqFullName) {\r\n\t\t\t\tthis.collection[lower] = uq;\r\n\t\t\t}\r\n\t\t\treturn uq.init();\r\n\t\t});\r\n        await Promise.all(promiseInits);\r\n    }\r\n\r\n    async load(): Promise<string[]> {\r\n        let retErrors:string[] = [];\r\n        let promises: PromiseLike<string>[] = [];\r\n        for (let i in this.collection) {\r\n            let uq = this.collection[i];\r\n            promises.push(uq.loadEntities());\r\n\t\t}\r\n        let results = await Promise.all(promises);\r\n        for (let result of results)\r\n        {\r\n            let retError = result; // await cUq.loadSchema();\r\n            if (retError !== undefined) {\r\n                retErrors.push(retError);\r\n                continue;\r\n            }\r\n\t\t}\r\n        return retErrors;\r\n    }\r\n\r\n    buildUQs(): any {\r\n        let that = this;\r\n        let uqs:any = {};\r\n        for (let i in this.collection) {\r\n            let uqMan = this.collection[i];\r\n            //let n = uqMan.name;\r\n            let uqName = uqMan.uqName;\r\n            let l = uqName.toLowerCase();\r\n\t\t\tlet uqKey:string = uqName.split(/[-._]/).join('').toLowerCase();\r\n            let entities = uqMan.entities;\r\n            let keys = Object.keys(entities);\r\n            for (let key of keys) {\r\n                let entity = entities[key];\r\n\t\t\t\tlet {name} = entity;\r\n\t\t\t\tentities[name.toLowerCase()] = entity;\r\n            }\r\n            let proxy = uqs[l] = new Proxy(entities, {\r\n                get: function(target, key, receiver) {\r\n                    let lk = (key as string).toLowerCase();\r\n                    let ret = target[lk];\r\n                    if (ret !== undefined) return ret;\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t\tlet err = `entity ${uqName}.${String(key)} not defined`;\r\n                    console.error(err);\r\n                    that.showReload('UQ' + err);\r\n                    return undefined;\r\n                }\r\n\t\t\t})\r\n\t\t\tif (uqKey !== l) uqs[uqKey] = proxy;\r\n        }\r\n        //let uqs = this.collection;\r\n        return new Proxy(uqs, {\r\n            get: function (target, key, receiver) {\r\n                let lk = (key as string).toLowerCase();\r\n                let ret = target[lk];\r\n                if (ret !== undefined) return ret;\r\n                /*\r\n                for (let i in uqs) {\r\n                    if (i.toLowerCase() === lk) {\r\n                        return uqs[i];\r\n                    }\r\n                }*/\r\n                debugger;\r\n                console.error('error in uqs');\r\n                that.showReload(` uq ${String(key)}`);\r\n                return undefined;\r\n            },\r\n        });\r\n\t}\r\n\t\r\n\tgetUqCollection() {\r\n\t\treturn this.collection;\r\n\t}\r\n\r\n    private showReload(msg: string) {\r\n        this.localMap.removeAll();\r\n        nav.showReloadPage(msg);\r\n    }\r\n\r\n    setTuidImportsLocal():string[] {\r\n        let ret:string[] = [];\r\n        for (let i in this.collection) {\r\n            let uq = this.collection[i];\r\n            for (let tuid of uq.tuidArr) {\r\n                if (tuid.isImport === true) {\r\n                    let error = this.setInner(tuid as TuidImport);\r\n                    if (error) ret.push(error);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private setInner(tuidImport: TuidImport):string {\r\n        let {from} = tuidImport;\r\n        let fromName = from.owner + '/' + from.uq;\r\n        let uq = this.collection[fromName];\r\n        if (uq === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} is not loaded`;\r\n        }\r\n        let iName = tuidImport.name\r\n        let tuid = uq.tuid(iName);\r\n        if (tuid === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} has no Tuid ${iName}`;\r\n        }\r\n        if (tuid.isImport === true) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} Tuid ${iName} is import`;\r\n        }\r\n        tuidImport.setFrom(tuid as TuidInner);\r\n    }\r\n}\r\n","import fs from 'fs';\r\nimport { Action, Book, Query, Sheet, Tuid, UqEnum, UqMan, UQsMan, Map, History, Tag, Pending, Entity, ArrFields, Field } from './index';\r\nimport { nav } from '../components';\r\nimport { AppConfig } from '../app';\r\n//import { env } from 'tonva/tool';\r\n\r\n//const uqAppPath = 'src/UqApp';\r\nconst red = '\\x1b[41m%s\\x1b[0m';\r\nlet lastBuildTime:number = 0;\r\nlet gUqOwnerMap:{[key:string]:string};\r\n\r\nexport interface UqAppOptions extends Partial<AppConfig> {\r\n\tuqAppName: string;\r\n\tuqAppVersion: string;\r\n\tuqAppUnitId: number;\r\n\tuqAppSrcPath?: string;\r\n\tuqOwnerMap?: {[key:string]: string};\r\n}\r\n\r\nexport async function uqAppStart(options: UqAppOptions) {\r\n\tlet {uqAppName, uqAppVersion: appVersion, uqAppUnitId: appUnitId} = options;\r\n\tprocess.env.REACT_APP_UNIT = String(appUnitId);\r\n\tnav.forceDevelopment = true;\r\n\tawait nav.init();\r\n\tawait UQsMan.load(uqAppName, appVersion, undefined);\r\n}\r\nexport async function buildUqApp(options: UqAppOptions) {\r\n\tlet {uqAppSrcPath, uqOwnerMap} = options;\r\n\tif (!uqAppSrcPath) uqAppSrcPath = 'src/UqApp';\r\n\tgUqOwnerMap = uqOwnerMap || {};\r\n\tfor (let i in gUqOwnerMap) {\r\n\t\tgUqOwnerMap[i.toLowerCase()] = gUqOwnerMap[i];\r\n\t}\r\n\tif (lastBuildTime > 0) {\r\n\t//if (Date.now() - lastBuildTime < 30*1000) {\r\n\t\tconsole.log(red, 'quit !');\r\n\t\treturn;\r\n\t}\r\n\tif (!fs.existsSync(uqAppSrcPath)) {\r\n\t\tfs.mkdirSync(uqAppSrcPath);\r\n\t}\r\n\tlet tsAppName = buildTsAppName(options);\r\n\tsaveTsFile(uqAppSrcPath, 'appName', tsAppName);\r\n\tlet tsAppConfig = buildTsAppConfig(options);\r\n\tsaveTsFileIfNotExists(uqAppSrcPath, 'appConfig', tsAppConfig);\r\n\tlet tsIndex = buildTsIndex();\r\n\tsaveTsFile(uqAppSrcPath, 'index', tsIndex);\r\n\tlet tsCApp = buildTsCApp();\r\n\tsaveTsFileIfNotExists(uqAppSrcPath, 'CApp', tsCApp);\r\n\tlet tsCBase = buildTsCBase();\r\n\tsaveTsFile(uqAppSrcPath, 'CBase', tsCBase);\r\n\tlet tsVMain = buildTsVMain();\r\n\tsaveTsFileIfNotExists(uqAppSrcPath, 'VMain', tsVMain, 'tsx');\r\n\r\n\tsaveTsFile(uqAppSrcPath, 'uqs', '');\r\n\tfs.unlinkSync(uqAppSrcPath + '/uqs.ts');\r\n\tawait buildUqsFolder(uqAppSrcPath + '/uqs', options);\r\n};\r\n\r\nfunction saveTsFileIfNotExists(uqAppSrcPath:string, fileName:string, content:string, suffix:string = 'ts') {\r\n\tlet tsFile = `${uqAppSrcPath}/${fileName}.${suffix}`;\r\n\tif (fs.existsSync(tsFile) === true) return;\r\n\tsaveTsFile(uqAppSrcPath, fileName, content, suffix);\r\n}\r\nfunction saveTsFile(uqAppSrcPath:string, fileName:string, content:string, suffix:string = 'ts') {\r\n\tlet srcFile = `${uqAppSrcPath}/${fileName}.${suffix}.txt`;\r\n\tlet tsFile = `${uqAppSrcPath}/${fileName}.${suffix}`;\r\n\tif (!fs.existsSync(srcFile)) {\r\n\t\tif (fs.existsSync(tsFile)) {\r\n\t\t\tfs.renameSync(tsFile, srcFile);\r\n\t\t}\r\n\t}\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\nfunction overrideTsFile(uqAppSrcPath:string, fileName:string, content:string, suffix:string = 'ts') {\r\n\tlet tsFile = `${uqAppSrcPath}/${fileName}.${suffix}`;\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\nfunction buildTsHeader() {\r\n\treturn `//=== UqApp builder created on ${new Date()} ===//`;\r\n}\r\nfunction buildTsAppName(options: UqAppOptions):string {\r\n\tlet {uqAppName, appName} = options;\r\n\treturn `${buildTsHeader()}\r\nexport const appName = '${uqAppName || appName}';\r\n`;\r\n}\r\nfunction buildTsAppConfig(options: UqAppOptions):string {\r\n\tlet {version, noUnit, tvs, oem, htmlTitle} = options;\r\n\tfunction toString(s:string) {\r\n\t\tif (s === undefined) return;\r\n\t\tif (s === null) return null;\r\n\t\treturn `'${s}'`;\r\n\t}\r\n\treturn `${buildTsHeader()}\r\nimport { AppConfig } from \"tonva\";\r\nimport { appName } from \"./appName\";\r\n\r\nexport const appConfig: AppConfig = {\r\n    appName: appName,\r\n\tversion: ${toString(version)},\r\n\tnoUnit: ${noUnit},\r\n    tvs: ${JSON.stringify(tvs)},\r\n\toem: ${toString(oem)},\r\n\thtmlTitle: ${toString(htmlTitle)},\r\n};\r\n`;\r\n}\r\nfunction buildTsIndex():string {\r\n\treturn `${buildTsHeader()}\r\nexport { appConfig } from './appConfig';\r\nexport { CUqApp, CUqBase, CUqSub } from './CBase';\r\nexport { CApp } from './CApp';\r\nexport * from './uqs';\r\n`;\r\n}\r\nfunction buildTsCApp():string {\r\n\treturn `${buildTsHeader()}\r\nimport { CUqApp } from \"./CBase\";\r\nimport { VMain } from \"./VMain\";\r\n\r\nexport class CApp extends CUqApp {\r\n\tprotected async internalStart(isUserLogin: boolean) {\r\n\t\tthis.openVPage(VMain, undefined, this.dispose);\r\n\t}\r\n}\r\n`;\t\r\n}\r\nfunction buildTsCBase():string {\r\n\treturn `${buildTsHeader()}\r\nimport { CSub, CBase, CAppBase, IConstructor } from 'tonva';\r\nimport { UQs } from './uqs';\r\nimport { CApp } from './CApp';\r\n\r\nexport abstract class CUqBase extends CBase {\r\n\tget cApp(): CApp { return this._cApp; }\r\n\tprotected get uqs(): UQs { return this._uqs as UQs };\r\n}\r\n\r\nexport abstract class CUqSub<T extends CUqBase> extends CSub<T> {\r\n\tget cApp(): CApp { return this._cApp; }\r\n\tprotected get uqs(): UQs { return this._uqs as UQs };\r\n\tget owner(): T { return this._owner as T }\r\n}\r\n\r\nexport abstract class CUqApp extends CAppBase {\r\n\tget uqs(): UQs { return this._uqs };\r\n\r\n\tprotected newC<T extends CUqBase>(type: IConstructor<T>): T {\r\n\t\tlet c = new type(this);\r\n\t\tc.init();\r\n\t\treturn c;\r\n\t}\r\n}\r\n`;\r\n}\r\nfunction buildTsVMain() {\r\n\treturn `${buildTsHeader()}\r\nimport { VPage, Page } from 'tonva';\r\nimport { CApp } from './CApp';\r\n\r\nexport class VMain extends VPage<CApp> {\r\n\tasync open(param?: any, onClosePage?: (ret:any)=>void) {\r\n\t\tthis.openPage(this.render, param, onClosePage);\r\n\t}\r\n\r\n\trender = (param?: any): JSX.Element => {\r\n\t\treturn <Page header=\"TEST\">\r\n\t\t\t<div className=\"m-3\">\r\n\t\t\t\t<div>{this.renderMe()}</div>\r\n\t\t\t\t<div className=\"mb-5\"></div>\r\n\t\t\t</div>\r\n\t\t</Page>;\r\n\t}\r\n}\r\n`;\r\n}\r\n\r\nasync function buildUqsFolder(uqsFolder:string, options: UqAppOptions) {\r\n\tawait uqAppStart(options);\r\n\r\n\tlet uqsMan = UQsMan.value;\r\n\tlet coll = uqsMan.getUqCollection();\r\n\t\r\n\tlet promiseArr:Promise<void>[] = [];\r\n\tlet uqs:UqMan[] = [];\r\n\tfor (let i in coll) {\r\n\t\tlet lowerI = i.toLowerCase();\r\n\t\tif (lowerI !== i) continue;\r\n\t\tuqs.push(coll[i]);\r\n\t}\r\n\t\r\n\tif (!uqsMan.id) {\r\n\t\tlet error = options.uqAppName + ' not defined!';\r\n\t\tthrow new Error(error);\r\n\t}\r\n\r\n\tfor (let uq of uqs) {\r\n\t\tpromiseArr.push(loadUqEntities(uq));\r\n\t}\r\n\tawait Promise.all(promiseArr);\r\n\r\n\tif (!fs.existsSync(uqsFolder)) {\r\n\t\tfs.mkdirSync(uqsFolder);\r\n\t}\r\n\tlet tsUqsIndexHeader = buildTsHeader();\r\n\tlet tsUqsIndexContent = `\\n\\nexport interface UQs {`;\r\n\tlet tsUqsExports = '\\n\\n';\r\n\tfor (let uq of uqs) {\r\n\t\tlet {uqOwner, uqName} = uq;\r\n\t\tlet o1 = getUqOwnerName(uqOwner);\r\n\t\tlet n1 = getUqName(uqName);\r\n\t\tlet tsUq = buildTsUq(uq);\r\n\t\toverrideTsFile(uqsFolder, o1+n1, tsUq);\r\n\t\t// as ${o1}${n1}\r\n\t\ttsUqsIndexHeader += `\\nimport { ${o1}${n1} } from './${o1}${n1}';`;\r\n\t\ttsUqsIndexContent += `\\n\\t${o1}${n1}: ${o1}${n1}.Uq${o1}${n1};`;\r\n\r\n\t\ttsUqsExports += `\\nexport {`; \r\n\t\tfor (let enm of uq.enumArr) {\r\n\t\t\tlet enmName = `${capitalCaseString(enm.sName)}`;\r\n\t\t\ttsUqsExports += `\\n\\t${enmName} as ${o1}${n1}${enmName},`;\r\n\t\t}\r\n\t\ttsUqsExports += `\\n} from './${o1}${n1}';`;\r\n\t}\r\n\r\n\toverrideTsFile(uqsFolder, 'index', \r\n\t\ttsUqsIndexHeader + tsUqsIndexContent + '\\n}' + tsUqsExports + '\\n');\r\n}\r\n\r\nfunction buildTsUq(uq: UqMan) {\r\n\tlet ret = buildTsHeader();\r\n\tret += '\\nimport { UqTuid, UqQuery, UqAction, UqSheet/*, Map, Tag*/ } from \"tonva\";';\r\n\r\n\t//for (let uq of uqs) {\r\n\t\tret += '\\n';\r\n\t\tret += '\\n//===============================';\r\n\t\tret += `\\n//======= UQ ${uq.name} ========`;\r\n\t\tret += '\\n//===============================';\r\n\t\tret += '\\n';\r\n\t\tret += buildUQ(uq);\r\n\t\tret += '\\n';\r\n\t\tret += '\\n';\r\n\t//}\r\n\t/*\r\n\tret += '\\n//===============================';\r\n\tret += `\\n//============= UQs =============`;\r\n\tret += '\\n//===============================';\r\n\tret += '\\nexport interface UQs {';\r\n\tfor (let uq of uqs) {\r\n\t\tlet {uqOwner, uqName} = uq;\r\n\t\tlet o1 = getUqOwnerName(uqOwner);\r\n\t\tlet n1 = getUqName(uqName);\r\n\t\tret += `\\n\\t${o1}${n1}: ${o1}${n1}.Uq;`;\r\n\t}\r\n\tret += '\\n}\\n';\r\n\t*/\r\n\treturn ret;\r\n}\r\n\r\nfunction capitalCaseString(s:string):string {\r\n\tlet parts = s.split(/[-._]/);\r\n\treturn parts.map(v => firstCharUppercase(v)).join('');\r\n}\r\n\r\nfunction camelCaseString(s:string):string {\r\n\tlet parts = s.split(/[-._]/);\r\n\tlet len = parts.length;\r\n\tparts[0] = firstCharLowercase(parts[0]);\r\n\tfor (let i=1; i<len; i++) {\r\n\t\tparts[1] = firstCharUppercase(parts[1]);\r\n\t}\r\n\treturn parts.join('');\r\n}\r\nfunction entityName(s:string):string {\r\n\treturn capitalCaseString(s);\r\n}\r\n\r\nfunction getUqOwnerName(uqOwner:string) {\r\n\tlet uo = gUqOwnerMap[uqOwner.toLowerCase()];\r\n\tif (uo === undefined) return '';\r\n\tif (uo.length === 0) return '';\r\n\treturn capitalCaseString(uo);\r\n}\r\n\r\nfunction getUqName(uqName:string) {\r\n\treturn capitalCaseString(uqName);\r\n}\r\n\r\nfunction uqBlock<T extends Entity>(entity: T, build: (entity: T)=>string) {\r\n\tlet {name} = entity;\r\n\tif (name.indexOf('$') > 0) return '';\r\n\tlet entityCode = build(entity);\r\n\tif (!entityCode) return '';\r\n\treturn '\\n' + entityCode;\r\n}\r\n\r\nfunction uqEntityInterface<T extends Entity>(entity: T, buildInterface: (entity: T)=>string) {\r\n\tlet {name} = entity;\r\n\tif (name.indexOf('$') > 0) return '';\r\n\tlet entityCode = buildInterface(entity);\r\n\tif (!entityCode) return '';\r\n\t//return uqFirstLine(entity) + \r\n\treturn '\\n' + entityCode + '\\n';\r\n}\r\n\r\nconst aCode = 'a'.charCodeAt(0);\r\nconst zCode = 'z'.charCodeAt(0);\r\nfunction firstCharUppercase(s:string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= aCode && c <= zCode) {\r\n\t\treturn String.fromCharCode(c - 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\nconst ACode = 'A'.charCodeAt(0);\r\nconst ZCode = 'Z'.charCodeAt(0);\r\nfunction firstCharLowercase(s:string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= ACode && c <= ZCode) {\r\n\t\treturn String.fromCharCode(c + 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\n\r\nasync function loadUqEntities(uq:UqMan):Promise<void> {\r\n\tawait uq.loadAllSchemas();\r\n\t/*\r\n\tlet arr: Promise<any>[] = [];\r\n    uq.actionArr.forEach(v => arr.push(v.loadSchema()));\r\n    uq.enumArr.forEach(v => arr.push(v.loadSchema()));\r\n    uq.sheetArr.forEach(v => arr.push(v.loadSchema()));\r\n    uq.queryArr.forEach(v => arr.push(v.loadSchema()));\r\n    uq.bookArr.forEach(v => arr.push(v.loadSchema()));\r\n    uq.mapArr.forEach(v => arr.push(v.loadSchema()));\r\n    uq.historyArr.forEach(v => arr.push(v.loadSchema()));\r\n    uq.pendingArr.forEach(v => arr.push(v.loadSchema()));\r\n\tuq.tagArr.forEach(v => arr.push(v.loadSchema()));\r\n\tawait Promise.all(arr);\r\n\t*/\r\n}\r\n\r\nfunction buildUQ(uq:UqMan) {\r\n\tlet {uqOwner, uqName} = uq;\r\n\tlet ts:string = ``;\r\n\tuq.enumArr.forEach(v => ts += uqEntityInterface<UqEnum>(v, buildEnumInterface));\r\n\t\r\n\tts += `\\nexport declare namespace ${getUqOwnerName(uqOwner)}${getUqName(uqName)} {`;\r\n\tuq.tuidArr.forEach(v => ts += uqEntityInterface<Tuid>(v, buildTuidInterface));\r\n    uq.actionArr.forEach(v => ts += uqEntityInterface<Action>(v, buildActionInterface));\r\n    uq.sheetArr.forEach(v => ts += uqEntityInterface<Sheet>(v, buildSheetInterface));\r\n    uq.queryArr.forEach(v => ts += uqEntityInterface<Query>(v, buildQueryInterface));\r\n    uq.bookArr.forEach(v => ts += uqEntityInterface<Book>(v, buildBookInterface));\r\n    uq.mapArr.forEach(v => ts += uqEntityInterface<Map>(v, buildMapInterface));\r\n    uq.historyArr.forEach(v => ts += uqEntityInterface<History>(v, buildHistoryInterface));\r\n    uq.pendingArr.forEach(v => ts += uqEntityInterface<Pending>(v, buildPendingInterface));\r\n\tuq.tagArr.forEach(v => ts += uqEntityInterface<Tag>(v, buildTagInterface));\r\n\r\n\tts += `\\n\\nexport interface Uq${getUqOwnerName(uqOwner)}${getUqName(uqName)} {`;\r\n\tuq.tuidArr.forEach(v => ts += uqBlock<Tuid>(v, buildTuid));\r\n    uq.actionArr.forEach(v => ts += uqBlock<Action>(v, buildAction));\r\n    //uq.enumArr.forEach(v => ts += uqBlock<UqEnum>(v, buildEnum));\r\n    uq.sheetArr.forEach(v => ts += uqBlock<Sheet>(v, buildSheet));\r\n    uq.queryArr.forEach(v => ts += uqBlock<Query>(v, buildQuery));\r\n    uq.bookArr.forEach(v => ts += uqBlock<Book>(v, buildBook));\r\n    uq.mapArr.forEach(v => ts += uqBlock<Map>(v, buildMap));\r\n    uq.historyArr.forEach(v => ts += uqBlock<History>(v, buildHistory));\r\n    uq.pendingArr.forEach(v => ts += uqBlock<Pending>(v, buildPending));\r\n\tuq.tagArr.forEach(v => ts += uqBlock<Tag>(v, buildTag));\r\n\tts += '\\n}\\n}\\n';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildFields(fields: Field[], indent:number = 1) {\r\n\tif (!fields) return;\r\n\tlet ts = '';\r\n\tfor (let f of fields) {\r\n\t\tts += buildField(f, indent);\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\nconst fieldTypeMap:{[type:string]:string} = {\r\n\t\"char\": \"string\",\r\n\t\"text\": \"string\",\r\n\t\"id\": \"number\",\r\n\t\"int\": \"number\",\r\n\t\"bigint\": \"number\",\r\n\t\"smallint\": \"number\",\r\n\t\"tinyint\": \"number\",\r\n};\r\nfunction buildField(field: Field, indent:number = 1) {\r\n\tlet {type} = field;\r\n\tlet s = fieldTypeMap[type];\r\n\tif (!s) s = 'any';\r\n\treturn `\\n${'\\t'.repeat(indent)}${field.name}: ${s};`;\r\n}\r\n\r\nfunction buildArrs(arrFields: ArrFields[]):string {\r\n\tif (!arrFields) return '';\r\n\tlet ts = '\\n';\r\n\tfor (let af of arrFields) {\r\n\t\tts += `\\t${camelCaseString(af.name)}: {`;\r\n\t\tts += buildFields(af.fields, 2);\r\n\t\tts += '\\n\\t}[];\\n';\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\nconst typeMap:{[type:string]:string} = {\r\n\taction: 'Action',\r\n\tquery: 'Query',\r\n}\r\nfunction buildReturns(entity:Entity, returns:ArrFields[]):string {\r\n\tif (!returns) return;\r\n\t//let {typeName} = entity;\r\n\t//let type = typeMap[typeName] || typeName;\r\n\tlet {sName} = entity;\r\n\tsName = capitalCaseString(sName);\r\n\tlet ts = '';\r\n\tfor (let ret of returns) {\r\n\t\tlet retName = capitalCaseString(ret.name);\r\n\t\tts += `interface Return${sName}${retName} {`;\r\n\t\tts += buildFields(ret.fields);\r\n\t\tts += '\\n}\\n';\r\n\t}\r\n\r\n\tts += `interface Result${sName} {\\n`;\r\n\tfor (let ret of returns) {\r\n\t\tlet retName = capitalCaseString(ret.name);\r\n\t\tts += `\\t${ret.name}: Return${sName}${retName}[];\\n`;\r\n\t}\r\n\tts += '}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildTuid(tuid: Tuid) {\r\n\tlet ts = `\\t${entityName(tuid.sName)}: UqTuid<Tuid${capitalCaseString(tuid.sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildTuidInterface(tuid: Tuid) {\r\n\tlet ts = `export interface Tuid${capitalCaseString(tuid.sName)} {`;\r\n\tts += buildFields(tuid.fields);\r\n\tts += '\\n}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildAction(action: Action) {\r\n\tlet ts = `\\t${entityName(action.sName)}: UqAction<Param${capitalCaseString(action.sName)}, Result${capitalCaseString(action.sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildActionInterface(action: Action) {\r\n\tlet ts = `export interface Param${capitalCaseString(action.sName)} {`;\r\n\tts += buildFields(action.fields);\r\n\tts += buildArrs(action.arrFields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(action, action.returns);\r\n\treturn ts;\r\n}\r\n\r\nfunction buildEnumInterface(enm: UqEnum) {\r\n\tlet {schema} = enm;\r\n\tif (!schema) return;\r\n\tlet {values} = schema;\r\n\tlet ts = `export enum ${capitalCaseString(enm.sName)} {`;\r\n\tlet first:boolean = true;\r\n\tfor (let i in values) {\r\n\t\tif (first === false) {\r\n\t\t\tts += ',';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\t\tlet v = values[i];\r\n\t\tts += '\\n\\t' + i + ' = ';\r\n\t\tif (typeof v === 'string') {\r\n\t\t\tts += '\"' + v + '\"';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tts += v;\r\n\t\t}\r\n\t}\r\n\treturn ts += '\\n};'\r\n}\r\n\r\nfunction buildQuery(query: Query) {\r\n\tlet {sName} = query;\r\n\tlet ts = `\\t${entityName(sName)}: UqQuery<Param${capitalCaseString(sName)}, Result${capitalCaseString(sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildQueryInterface(query: Query) {\r\n\tlet ts = `export interface Param${capitalCaseString(query.sName)} {`;\r\n\tts += buildFields(query.fields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(query, query.returns);\r\n\treturn ts;\r\n}\r\n\r\nfunction buildSheet(sheet: Sheet) {\r\n\tlet {sName, verify} = sheet;\r\n\tlet cName = capitalCaseString(sName);\r\n\tlet v = verify? `Verify${cName}` : 'any';\r\n\tlet ts = `\\t${entityName(sName)}: UqSheet<Sheet${cName}, ${v}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildSheetInterface(sheet: Sheet) {\r\n\tlet {sName, fields, arrFields, verify} = sheet;\r\n\tlet ts = `export interface Sheet${capitalCaseString(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += buildArrs(arrFields);\r\n\tts += '}';\r\n\r\n\tif (verify) {\r\n\t\tlet {returns} = verify;\r\n\t\tts += `\\nexport interface Verify${capitalCaseString(sName)} {`;\r\n\t\tfor (let item of returns) {\r\n\t\t\tlet {name:arrName, fields} = item;\r\n\t\t\tts += '\\n\\t' + arrName + ': {';\r\n\t\t\tts += buildFields(fields, 2);\r\n\t\t\tts += '\\n\\t}[];';\r\n\t\t}\r\n\t\tts += '\\n}';\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\nfunction buildBook(book: Book):string {\r\n\treturn;\r\n}\r\n\r\nfunction buildBookInterface(book: Book):string {\r\n\treturn;\r\n}\r\n\r\nfunction buildMap(map: Map):string {\r\n\treturn;\r\n}\r\n\r\nfunction buildMapInterface(map: Map):string {\r\n\treturn;\r\n}\r\n\r\nfunction buildHistory(history: History):string {\r\n\treturn;\r\n}\r\n\r\nfunction buildHistoryInterface(history: History):string {\r\n\treturn;\r\n}\r\n\r\nfunction buildPending(pending: Pending):string {\r\n\treturn;\r\n}\r\n\r\nfunction buildPendingInterface(pending: Pending):string {\r\n\treturn;\r\n}\r\n\r\nfunction buildTag(tag: Tag):string {\r\n\treturn;\r\n}\r\n\r\nfunction buildTagInterface(tag: Tag):string {\r\n\treturn;\r\n}\r\n","export interface Id {\r\n    id: number;\r\n}\r\n\r\nexport interface Api {\r\n    name: string;\r\n    url: string;\r\n    token: string;\r\n}\r\n\r\nexport interface App extends Id {\r\n    name: string;\r\n    discription: string;\r\n    icon: string;\r\n    owner: number;\r\n    ownerName: string;\r\n    ownerDiscription: string;\r\n    url: string;\r\n    apis?: {[name:string]: Api};\r\n}\r\n\r\nexport interface Unit extends Id {\r\n    type: number;\r\n    name: string;\r\n    nick: string;\r\n    discription: string;\r\n    icon: string;\r\n    readMe: string;\r\n    isRoot: number;\r\n    isOwner: number;\r\n    isAdmin: number;\r\n    isDev: number;\r\n    owner?: number;\r\n    ownerName?: string;\r\n    ownerNick?: string;\r\n    ownerIcon?: string;\r\n}\r\n\r\nconst unitCaptions = {\r\n    1: '',\r\n    2: '',\r\n    3: ''\r\n}\r\nexport function unitCaption(unit:Unit):String {\r\n    return unitCaptions[unit.type] as string\r\n}\r\n\r\nexport interface UnitApps extends Unit {\r\n    apps: App[];\r\n}\r\n\r\nexport interface UnitAdmin extends Id {\r\n    name: string;\r\n    nick: string;\r\n    icon: string;\r\n    type: number;\r\n    country: string;\r\n    mobile: string;\r\n    email: string;\r\n    isRoot: number;\r\n    isOwner: number;\r\n    isAdmin: number;\r\n    isDev: number;\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {FormView, FormProps} from './formView';\r\n\r\n/*\r\nexport function tonvaDebug() {\r\n    let a = 0;\r\n}\r\n*/\r\nexport interface TonvaFormProps extends FormProps {\r\n    className?: string;\r\n    initValues?: any;\r\n}\r\n\r\n@observer \r\nexport class TonvaForm extends React.Component<TonvaFormProps, {}> {\r\n    formView: FormView;\r\n    constructor(props:TonvaFormProps) {\r\n        super(props);\r\n        this.formView = new FormView(this.props);\r\n        this.formView.setInitValues(this.props.initValues);\r\n    }\r\n    debug() {\r\n        //let s = null;\r\n    }\r\n    render() {\r\n        let {className, children} = this.props;\r\n        return <div className={className}>\r\n            {\r\n                children === undefined? \r\n                    this.formView.render() : \r\n                    <form onSubmit={this.formView.onSubmit}>{children}</form>\r\n            }\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport className from 'classnames';\r\nimport {FormProps, FormRow, SubmitResult, TonvaForm} from '../form';\r\n\r\nexport interface Step {\r\n    formRows: FormRow[];\r\n    next: undefined | string | ((values:any) => string);    // step\r\n    ex?: any;                                   // \r\n}\r\n\r\nexport interface MultiStepProps {\r\n    className?: string;\r\n    header?: (step:Step, num:number) => JSX.Element; //name: step name, num: 1\r\n    footer?: (step:Step, num:number) => JSX.Element; //name: step name, num: 1\r\n    steps: {[name:string]: Step};\r\n    first: string;         // \r\n    onSubmit: (values:any) => Promise<SubmitResult|undefined>;\r\n    submitButton?: string|JSX.Element;\r\n}\r\n\r\nexport interface StepView {\r\n    stepName: string;\r\n    step: Step;\r\n    props: FormProps;\r\n    //view: JSX.Element;\r\n}\r\nexport interface MultiStepState {\r\n    //num: number;\r\n    //step: Step;\r\n    //formView: FormView;\r\n    topView: StepView;\r\n    stepViews: StepView[];\r\n}\r\n\r\nexport class MultiStep extends React.Component<MultiStepProps, MultiStepState> {\r\n    private values: any = {};\r\n    private stepViews: StepView[] = [];\r\n    private topView: StepView;\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            topView: undefined,\r\n            stepViews: [],\r\n        }\r\n        //this.onPrev = this.onPrev.bind(this);\r\n        //this.onNext = this.onNext.bind(this);\r\n        this.setStep(this.props.first);\r\n    }\r\n    \r\n    private setStep(stepName: string) {\r\n        let step = this.props.steps[stepName];\r\n        if (step === undefined) return; //throw new Error('Unknown step name: ' + stepName);\r\n        if (this.topView !== undefined) this.stepViews.push(this.topView);\r\n        let otherButton, onOther;\r\n        if (this.stepViews.length > 0) {\r\n            otherButton = <ButtonConten prefix=\"undo\" text=\"\" />;\r\n            onOther = this.onPrev;\r\n        }\r\n        //let {header, footer} = this.props;\r\n        let btnContent = step.next === undefined?\r\n            {prefix: 'cloud-upload', text: this.props.submitButton || ''} :\r\n            {suffix: 'arrow-right', text: ''}\r\n        let formProps = {\r\n            formRows: step.formRows,\r\n            submitButton: <ButtonConten {...btnContent} />,\r\n            onSubmit: this.onNext,\r\n            otherButton: otherButton,\r\n            onOther: onOther,\r\n        };\r\n        //let num = this.stepViews.length + 1;\r\n        this.topView = {\r\n            stepName: stepName,\r\n            step: step,\r\n            props: formProps,\r\n        };\r\n        this.setState({\r\n            topView: this.topView,\r\n            stepViews: this.stepViews\r\n        });\r\n    }\r\n    private onPrev = (values:any) => {\r\n        _.assign(this.values, values);\r\n        this.topView = this.stepViews.pop();\r\n        this.setState({\r\n            topView: this.topView,\r\n            stepViews: this.stepViews\r\n        });\r\n    }\r\n    private onNext = (values:any): Promise<SubmitResult|undefined> => {\r\n        _.assign(this.values, values);\r\n        //let {num, step} = this.state;\r\n        let {next} = this.topView.step;\r\n        if (next === undefined) {\r\n            return this.props.onSubmit(this.values)\r\n        }\r\n        let nextStepName:string;\r\n        if (typeof next === 'string') {\r\n            nextStepName = next;\r\n        }\r\n        else {\r\n            nextStepName = next(this.values);\r\n        }\r\n        this.setStep(nextStepName);\r\n    }\r\n    render() {\r\n        let {className, header, footer} = this.props;\r\n        let {topView, stepViews} = this.state;\r\n        let {stepName, step} = topView;\r\n        //let hidden = {visibility: 'hidden'};\r\n        let num = stepViews.length + 1;\r\n        return <div className={className}>\r\n            <div>\r\n                {header && header(step, num)}\r\n                <TonvaForm key={stepName} initValues={this.values} {...topView.props} />\r\n                {footer && footer(step, num)}\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nconst ButtonConten = (props:{prefix?:string, text?:string|JSX.Element, suffix?:string}) => {\r\n    let {prefix, suffix} = props;\r\n    let pIcon:any, sIcon:any;\r\n    if (prefix !== undefined) pIcon = <i className={className('fa', 'fa-' + prefix)} />;\r\n    if (suffix !== undefined) sIcon = <i className={className('fa', 'fa-' + suffix)} />;\r\n    return <React.Fragment>{pIcon} {props.text} {sIcon}</React.Fragment>;\r\n}\r\n    \r\n","import _ from 'lodash';\r\nimport { Context } from '../context';\r\nimport { FormRes } from '../../../res/formRes';\r\n\r\nexport abstract class Rule {\r\n    abstract check(defy:string[], value:any):void;\r\n}\r\n\r\nexport type ContextRule = (context:Context)=>{[target:string]:string[]|string} | string[] | string;\r\nexport type FieldRule = (value:any) => string[] | string;\r\n\r\nexport class RuleCustom extends Rule {\r\n    private func: FieldRule;\r\n    constructor(func: FieldRule) {\r\n        super();\r\n        this.func = func;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        let ret = this.func(value);\r\n        if (ret === undefined) return;\r\n        switch (typeof ret) {\r\n            case 'undefined': return;\r\n            case 'string': defy.push(ret as string); return;\r\n            default: defy.push(...ret); return;\r\n        }        \r\n    }\r\n}\r\n\r\nexport abstract class RulePredefined extends Rule {\r\n    protected res: FormRes;\r\n    constructor(res: FormRes) {\r\n        super();\r\n        this.res = res;\r\n    }\r\n}\r\n\r\nexport class RuleRequired extends RulePredefined {\r\n    check(defy:string[], value:any) {\r\n        switch (typeof value) {\r\n            default:\r\n            case 'boolean': return;\r\n            case 'object':\r\n                if (value !== null) return;\r\n                break;\r\n            case 'string':\r\n                if ((value as string).trim().length > 0) return;\r\n                break;\r\n            case 'number':\r\n                if (isNaN(value as number) === false) return;\r\n                break;\r\n            case 'undefined':\r\n                break;\r\n        }\r\n        defy.push(this.res.required);\r\n    }\r\n}\r\n\r\nexport class RuleNum extends RulePredefined {\r\n    private minMsg: _.TemplateExecutor;\r\n    private maxMsg: _.TemplateExecutor;\r\n    protected min: number;\r\n    protected max: number\r\n    constructor(res: FormRes, min?: number, max?: number) {\r\n        super(res);\r\n        this.minMsg = _.template(res.min);\r\n        this.maxMsg = _.template(res.max);\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        if (value === undefined || value === null) return;\r\n        let n = Number(value);\r\n        if (isNaN(n) === true) {\r\n            defy.push(this.res.number);\r\n        }\r\n        else {\r\n            this.checkMore(defy, n);\r\n        }\r\n    }\r\n\r\n    protected checkMore(defy:string[], value: number) {\r\n        if (this.min !== undefined && Number(value) < this.min) {\r\n            defy.push(this.minMsg({min:this.min}));\r\n        }\r\n        if (this.max !== undefined && Number(value) > this.max) {\r\n            defy.push(this.maxMsg({max:this.max}));\r\n        }\r\n    }\r\n}\r\n\r\nexport class RuleInt extends RuleNum {\r\n    protected checkMore(defy:string[], n: number) {\r\n        super.checkMore(defy, n);\r\n        if (Number.isInteger(n) === false) {\r\n            defy.push(this.res.integer);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiItem, ChangingHandler, ChangedHandler } from '../../schema';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { ItemSchema } from '../../schema';\r\nimport { Rule, RuleRequired, RuleCustom, FieldRule } from '../rules';\r\nimport { computed, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Widget {\r\n    name: string;\r\n    protected context: Context;\r\n    protected fieldProps:FieldProps;\r\n    protected children: React.ReactNode;\r\n    protected _itemSchema: ItemSchema;\r\n    protected _ui: UiItem;\r\n\tprotected defaultValue: any;\r\n\tprotected value: any;\r\n    protected rules: Rule[];\r\n    @observable errors: string[] = [];\r\n    @observable protected contextErrors: string[] = [];\r\n    @computed protected get hasError():boolean {return (this.errors.length + this.contextErrors.length)>0}\r\n    protected readOnly:boolean;\r\n    protected disabled:boolean;\r\n    @observable visible:boolean;\r\n\r\n    constructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n        this.context = context;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this._itemSchema = itemSchema;\r\n        this.fieldProps = fieldProps;\r\n        this.children = children;\r\n        this._ui = context.getUiItem(name);\r\n        if (this.ui === undefined) {\r\n            this.readOnly = false;\r\n            this.disabled = false;\r\n            this.visible = true;\r\n        }\r\n        else {\r\n            let {readOnly, disabled, visible} = this.ui;\r\n            this.readOnly = (readOnly === true);\r\n            this.disabled = (disabled === true);\r\n            this.visible = !(visible === false);            \r\n        }\r\n        this.value = this.defaultValue =  context.getValue(name); //defaultValue;\r\n        // this.init();\r\n    }\r\n\r\n    protected get itemSchema(): ItemSchema {return this._itemSchema};\r\n    protected get ui(): UiItem {return this._ui};\r\n\r\n    init() {\r\n        this.rules = [];\r\n        if (this.itemSchema.required === true) {\r\n            this.rules.push(new RuleRequired(this.context.form.res));\r\n        }\r\n        this.buildRules();\r\n        if (this.ui === undefined) return;\r\n        let {rules} = this.ui;\r\n        if (rules === undefined) return;\r\n        if (Array.isArray(rules) === false) {\r\n            this.rules.push(new RuleCustom(rules as FieldRule));\r\n            return;\r\n        }\r\n        for (let rule of rules as FieldRule[]) {\r\n            this.rules.push(new RuleCustom(rule));\r\n        }\r\n    }\r\n\r\n    protected buildRules() {\r\n    }\r\n\r\n    checkRules() {\r\n        let defy:string[] = [];\r\n        for (let r of this.rules) r.check(defy, this.value);\r\n        if (defy.length === 0) {\r\n            this.context.removeErrorWidget(this);\r\n        }\r\n        else {\r\n            this.context.addErrorWidget(this);\r\n            this.errors.push(...defy);\r\n        }\r\n    }\r\n\r\n    @computed get isOk() {\r\n        return this.errors.length ===0;\r\n    }\r\n\r\n    setError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.errors.push(err);\r\n        else this.errors.push(...err);\r\n    }\r\n\r\n    setContextError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.contextErrors.push(err);\r\n        else this.contextErrors.push(...err);\r\n    }\r\n\r\n    clearError() {\r\n        this.errors.splice(0);\r\n    }\r\n\r\n    clearContextError() {\r\n        this.contextErrors.splice(0);\r\n    }\r\n\r\n    protected parse(value:any):any {return value}\r\n\r\n    protected setElementValue(value:any) {}\r\n    protected setDataValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        this.context.initData[this.name] = this.value = this.parse(value);\r\n    }\r\n\r\n    setValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        //this.setDataValue(value);\r\n        //this.setElementValue(value);\r\n        this.changeValue(value, false);\r\n    }\r\n\r\n    getValue() {\r\n        return this.context.getValue(this.name);\r\n    }\r\n\r\n    getReadOnly():boolean {return this.readOnly}\r\n    getDisabled():boolean {return this.disabled}\r\n    getVisible():boolean {return this.visible}\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {this.disabled = value}\r\n    setVisible(value:boolean) {this.visible = value}\r\n\r\n    private isChanging: boolean;\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n\r\n    protected changeValue(newValue: any, fromElement: boolean) {\r\n        let prev = this.value;\r\n        let onChanging: ChangingHandler;\r\n        let onChanged: ChangedHandler;\r\n        if (this.ui !== undefined) {\r\n            onChanging = this.ui.onChanging;\r\n            onChanged = this.ui.onChanged;\r\n        }\r\n        let allowChange = true;\r\n        if (onChanging !== undefined) {\r\n            this.isChanging = true;\r\n            allowChange = onChanging(this.context, this.value, prev);\r\n            this.isChanging = false;\r\n        }\r\n        if (allowChange === true) {\r\n            this.setDataValue(newValue);\r\n            if (fromElement !== true) this.setElementValue(newValue);\r\n            if (onChanged !== undefined) {\r\n                this.isChanging = true;\r\n                onChanged(this.context, this.value, prev);\r\n                this.isChanging = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected get className():string {\r\n        let fieldClass:string;\r\n        if (this.context.inNode === false) fieldClass = 'form-control';\r\n        return classNames(fieldClass, this.context.form.FieldClass, this.ui && this.ui.className);\r\n    }\r\n\r\n    protected abstract render():JSX.Element;\r\n\r\n    protected renderBody():JSX.Element {\r\n        let elDiscription;\r\n        if (this.hasError === false && this.ui) {\r\n            let {discription, discriptionClassName} = this.ui;\r\n            if (discriptionClassName === undefined) discriptionClassName = 'small text-muted';\r\n            elDiscription = <span className={discriptionClassName}>\r\n                {discription}\r\n            </span>;\r\n        }\r\n        return <>\r\n            {this.render()}\r\n            {elDiscription}\r\n        </>;\r\n    }\r\n\r\n    container = observer(():JSX.Element => {\r\n        if (this.visible === false) return null;\r\n        let {form, inNode} = this.context;\r\n        if (inNode === true) return this.render();\r\n        let label:any = this.label;\r\n        if (this.itemSchema.required === true && form.props.requiredFlag !== false) {\r\n            if (label !== null) label = <>{label}&nbsp;<span className=\"text-danger\">*</span></>;\r\n        }\r\n        return form.FieldContainer(label, this.renderBody());\r\n    })\r\n\r\n    protected get label():string {\r\n        let label:any;\r\n        if (this.ui === undefined) {\r\n            label = this.name;\r\n        }\r\n        else {\r\n            let uiLabel = this.ui.label;\r\n            if (uiLabel === null) label = null;\r\n            else label = uiLabel || this.name;\r\n        }\r\n        return label;\r\n    }\r\n\r\n    protected renderTemplet():JSX.Element | undefined {\r\n        if (this.children !== undefined) {\r\n            return <>{this.children}</>;\r\n        }\r\n        if (this.ui === undefined) return undefined;\r\n        let {Templet} = this.ui;\r\n        if (typeof Templet === 'function') return Templet(this.value);\r\n        return Templet;\r\n    }\r\n\r\n    protected renderErrors() {\r\n        let errorList:string[] = [...this.errors, ...this.contextErrors];\r\n        if (errorList.length === 0) return null;\r\n        let {inNode} = this.context;\r\n        let tag = inNode === true? 'span' : 'div';\r\n        return errorList.map(err => React.createElement(tag, \r\n            {\r\n                key: err, \r\n                className: 'text-danger d-inline-block my-2 ml-3'\r\n            },\r\n            <><i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}</>\r\n        ));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTextItem, StringSchema } from '../../schema';\r\nimport { observable } from 'mobx';\r\n\r\nexport class TextWidget extends Widget {\r\n    protected inputType = 'text';\r\n    protected get ui(): UiTextItem {return this._ui as UiTextItem};\r\n    protected input: HTMLInputElement;\r\n    @observable protected hasFocus: boolean;\r\n\r\n    protected setElementValue(value:any) {\r\n        if (this.input === null) return;\r\n        this.input.value = value;\r\n    }\r\n    protected get placeholder() {return (this.ui && this.ui.placeholder) || this.name}\r\n    protected onKeyDown = async (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n        this.internalOnKeyDown(evt);\r\n        if (evt.keyCode !== 13) return;\r\n        let {onEnter} = this.context.form.props;\r\n        if (onEnter === undefined) return;\r\n\r\n        this.changeValue(evt.currentTarget.value, true);\r\n\r\n        //this.checkRules();\r\n        //this.context.checkContextRules();\r\n        this.input.blur();\r\n\r\n        let ret = await onEnter(this.name, this.context);\r\n        if (ret !== undefined) {\r\n            this.context.setError(this.name, ret);\r\n        }\r\n    }\r\n\r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n    }\r\n\r\n    protected onBlur = (evt: React.FocusEvent<any>) => {\r\n        this.onInputChange(evt);\r\n        this.checkRules();\r\n\t\tthis.context.checkContextRules();\r\n\t\tthis.hasFocus = false;\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n        this.clearError();\r\n        this.context.removeErrorWidget(this);\r\n        this.context.clearErrors();\r\n\t\tthis.hasFocus = true;\r\n    }\r\n    protected onChange(evt: React.ChangeEvent<any>) {\r\n    }\r\n\r\n    setReadOnly(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.readOnly = this.readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.disabled = this.disabled = value;\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {\r\n            //'form-control': true,\r\n        };\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, cn)}\r\n            type={this.inputType}\r\n            defaultValue={this.value}\r\n            onChange={(evt: React.ChangeEvent<any>) => this.onChange(evt)}\r\n            placeholder={this.placeholder}\r\n            readOnly={this.readOnly}\r\n            disabled={this.disabled}\r\n            onKeyDown = {this.onKeyDown}\r\n            onFocus = {this.onFocus}\r\n            onBlur={this.onBlur}\r\n            maxLength={(this.itemSchema as StringSchema).maxLength} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTextAreaItem } from '../../schema';\r\nimport { StringSchema } from '../../schema';\r\n\r\nexport class TextAreaWidget extends Widget {\r\n    protected get itemSchema(): StringSchema {return this._itemSchema as StringSchema};\r\n    protected input: HTMLTextAreaElement;\r\n    protected get ui(): UiTextAreaItem {return this._ui as UiTextAreaItem};\r\n\r\n    protected setElementValue(value:any) {this.input.value = value}\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.setValue(evt.currentTarget.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n\tprotected onBlur = (evt: React.FocusEvent<any>) => {\r\n        this.onInputChange(evt);\r\n        this.checkRules();\r\n        this.context.checkContextRules();\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n        this.clearError();\r\n        this.context.removeErrorWidget(this);\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {};\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <>\r\n\t\t\t<textarea ref={(input) => this.input=input}\r\n\t\t\t\tonBlur={this.onBlur} \r\n\t\t\t\tonFocus={this.onFocus}\r\n                className={classNames(this.className, cn)}\r\n                rows={this.ui && this.ui.rows}\r\n                maxLength={this.itemSchema.maxLength}\r\n                defaultValue={this.defaultValue} onChange={this.onInputChange} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class PasswordWidget extends TextWidget {\r\n    protected inputType = 'password';\r\n}\r\n\r\nexport class UrlWidget extends TextWidget {\r\n    protected inputType = 'url';\r\n}\r\n\r\nexport class EmailWidget extends TextWidget {\r\n    protected inputType = 'email';\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\nimport { RuleNum, RuleInt } from '../rules';\r\nimport { NumBaseSchema } from '../../schema';\r\n\r\nexport class NumberWidget extends TextWidget {\r\n    protected inputType = 'number';\r\n    protected get itemSchema(): NumBaseSchema {return this._itemSchema as NumBaseSchema};\r\n\r\n    protected buildRules() {\r\n        super.buildRules();\r\n        let res = this.context.form.res;\r\n        let {min, max} = this.itemSchema;\r\n        this.rules.push(\r\n            this.itemSchema.type === 'integer'?\r\n                new RuleNum(res, min, max) :\r\n                new RuleInt(res, min, max)\r\n        );\r\n        /*\r\n        if (this.itemSchema.type === 'integer') {\r\n            this.rules.push(new RuleInt);\r\n        }\r\n        let {min, max} = this.itemSchema;\r\n        if (min !== undefined) this.rules.push(new RuleMin(min));\r\n        if (max !== undefined) this.rules.push(new RuleMax(max));\r\n        */\r\n    }\r\n\r\n    protected parse(value:any):any {\r\n        if (value === undefined || value === null) return;\r\n        return Number(value);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { NumberWidget } from './numberWidget';\r\n\r\nexport class UpdownWidget extends NumberWidget {\r\n    protected inputType = 'number';\r\n\r\n    protected isValidKey(key:number):boolean {\r\n        return key===46 || key===8 || key===37 || key===39\r\n            || (key>=48 && key<=57)\r\n            || (key>=96 && key<=105)\r\n            || key===109 || key===189;\r\n    }\r\n    \r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n        let key = evt.keyCode;\r\n        window.event.returnValue = this.isValidKey(key);\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class DateWidget extends TextWidget {\r\n    protected inputType = 'date';\r\n}\r\n\r\nexport class DateTimeWidget extends TextWidget {\r\n    protected inputType = 'datetime';\r\n}\r\n\r\nexport class TimeWidget extends TextWidget {\r\n    protected inputType = 'time';\r\n}\r\n\r\nexport class MonthWidget extends TextWidget {\r\n    protected inputType = 'month';\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiCheckItem } from '../../schema';\r\n\r\nexport class CheckBoxWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiCheckItem {return this._ui as UiCheckItem};\r\n    protected trueValue: any;\r\n    protected falseValue: any;\r\n\r\n    init() {\r\n        super.init();\r\n        if (this.ui !== undefined) {\r\n            let {trueValue, falseValue} = this.ui;\r\n            if (trueValue === undefined) this.trueValue = true;\r\n            else this.trueValue = trueValue;\r\n            if (falseValue === undefined) this.falseValue = false;\r\n            else this.falseValue = falseValue;\r\n        }\r\n        else {\r\n            this.trueValue = true;\r\n            this.falseValue = false;\r\n        }\r\n    }\r\n    protected setElementValue(value:any) {\r\n        this.input.checked = value === this.trueValue;\r\n    }\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let v = evt.target.checked === true? this.trueValue : this.falseValue;\r\n        this.setDataValue(v);\r\n    }\r\n\r\n    protected onClick = () => {\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let cn = classNames(this.className, 'form-check-inline p-0');\r\n        let input = <input\r\n            ref={(input)=>this.input = input}\r\n            className={'align-self-center'}\r\n            type=\"checkbox\"\r\n            defaultChecked={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            onClick={this.onClick} />;\r\n        if (this.context.inNode === true) {\r\n            return <label className={cn}>\r\n                {input} {(this.ui&&this.ui.label) || this.name}\r\n            </label>\r\n        }\r\n        else {\r\n            return <div className={cn}>\r\n                <label className=\"w-100 h-100 mb-0 d-flex justify-content-center\">{input}</label>\r\n            </div>;\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observable } from 'mobx';\r\nimport { Widget } from './widget';\r\nimport { UiSelect } from '../../schema';\r\n\r\nexport class SelectWidget extends Widget {\r\n    protected select: HTMLSelectElement;\r\n    protected get ui(): UiSelect {return this._ui as UiSelect};\r\n    @observable protected readOnly: boolean;\r\n\r\n    protected setElementValue(value:any) {this.select.value = value}\r\n    protected onInputChange = (evt:React.ChangeEvent<HTMLSelectElement>) => {\r\n        this.setDataValue(evt.target.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.select.disabled = this.readOnly = !value}\r\n    setDisabled(value:boolean) {this.select.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        if (this.readOnly === true) {\r\n            let option = this.ui.list.find(v => v.value === this.value);\r\n            let title = (option === undefined)? '(???)' : option.title;\r\n            return <span className=\"form-control w-min-6c\">{title}</span>;\r\n        }\r\n        return <select\r\n            ref={(select)=>this.select = select}\r\n            className={classNames(this.className, 'form-control')}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}>\r\n            {this.ui.list.map((v,index) => {\r\n                let {title, value} = v;\r\n                let cn:string;\r\n                //if (value === undefined || value === null) cn = 'text-light small';\r\n                //else cn = 'text-danger';\r\n                return <option className={cn} key={index} value={value}>{title || value}</option>\r\n            })}\r\n        </select>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n//import { TextWidget } from './textWidget';\r\nimport { Widget } from './widget';\r\nimport { UiRadio } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class RadioWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiRadio {return this._ui as UiRadio};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n    }\r\n\r\n    /*\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n    */\r\n\r\n    render() {\r\n        let {defaultValue, list} = this.ui;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n        return <span className={cn} style={radioStyle}>\r\n                {list.map((v,index) => {\r\n                    let {value, title} = v;\r\n                    let name = this.name;\r\n                    if (rowKey !== undefined) name += '-' + rowKey;\r\n                    return <label key={index} className=\"form-radio-inline\">\r\n                        <input ref={input=>this.inputs[index]=input} type=\"radio\" name={name}\r\n                            value={value} defaultChecked={(this.defaultValue || defaultValue)===value}\r\n                            onChange={this.onInputChange} />\r\n                        {title || value}\r\n                    </label>;\r\n                    //</span>\r\n                })}\r\n            </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiRange } from '../../schema';\r\nimport { Widget } from './widget';\r\n\r\nexport class RangeWidget extends Widget {\r\n    protected inputType = 'range';\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiRange {return this._ui as UiRange};\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        let {min, max, step} = this.ui;\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, 'form-control', 'w-min-6c')}\r\n            type={this.inputType}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            max={max}\r\n            min={min}\r\n            step={step}\r\n            />\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiIdItem, TempletType } from '../../schema';\r\nimport { observable } from 'mobx';\r\n\r\nconst none = <small className=\"text-muted\">[]</small>;\r\n\r\nexport class IdWidget extends Widget {\r\n    protected get ui(): UiIdItem {return this._ui as UiIdItem};\r\n    @observable protected value:number;\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {this.disabled = value}    \r\n\r\n    protected onClick = async () => {\r\n        let pickId = this.ui && this.ui.pickId;\r\n        if (pickId === undefined) {\r\n            alert('no pickId defined!');\r\n            return;\r\n        }\r\n        let id = await pickId(this.context, this.name, this.value);        \r\n        this.setDataValue(id);\r\n        this.clearError();\r\n        this.clearContextError();\r\n        this.checkRules();\r\n    }\r\n\r\n    render() {\r\n        let placeholder:string|JSX.Element, Templet: TempletType;\r\n        if (this.ui !== undefined) {\r\n            placeholder = this.ui.placeholder;\r\n            Templet = this.ui.Templet;\r\n        }\r\n        let cn:any = {\r\n            'form-control': true,\r\n            'required-item': this.itemSchema.required === true,\r\n            'cursor-pointer': true,\r\n            'is-invalid': this.hasError,\r\n        };\r\n        let content;\r\n        if (this.value === undefined || this.value === null) {\r\n            content = placeholder || none;\r\n            cn['text-muted'] = true;\r\n        }\r\n        else if (Templet === undefined) {\r\n            let c: any;\r\n            if (this.value === null) {\r\n                c = 'null';\r\n            }\r\n            else {\r\n                switch (typeof this.value) {\r\n                    case 'undefined': c = none; break;\r\n                    case 'object': c = (this.value as any).id; break;\r\n                    default: c = this.value; break;\r\n                }\r\n            }\r\n            content = <>{c}</>;\r\n        }\r\n        else if (typeof Templet === 'function') {\r\n            content = Templet(this.value);\r\n        }\r\n        else {\r\n            content = Templet;\r\n        }\r\n        return <>\r\n            <div className={classNames(cn)} onClick={this.onClick}>{content}</div>\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { DataType } from '../../schema';\r\nimport { UiType } from '../../schema';\r\n\r\nexport const Unknown = (dataType:DataType, uiType:UiType, dataTypes:DataType[]) => {\r\n    return <span className=\"text-danger\">!!data type {dataType} only support {(dataTypes || []).join(', ')}, can't use ui {uiType}!!</span>;\r\n};\r\n","import * as React from 'react';\r\nimport { UiButton, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { Widget } from './widget';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class ButtonWidget extends Widget {\r\n    protected get ui(): UiButton {return this._ui as UiButton};\r\n\r\n    protected onClick = async () => {\r\n        this.clearError();\r\n        this.clearContextError();\r\n        let {name, type} = this.itemSchema;\r\n        if (type === 'submit') {\r\n            await this.context.submit(name);\r\n        }\r\n        /*\r\n        let {onButtonClick} = this.context.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${name} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(name, this.context);\r\n        if (ret === undefined) return;\r\n        this.context.setError(name, ret);\r\n        */\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let {name, type} = this.itemSchema;\r\n        let Templet:TempletType, cn:string, caption:string;\r\n        if (this.ui !== undefined) {\r\n            let {widget:widgetType} = this.ui;\r\n            if (widgetType !== 'button') return Unknown(type, widgetType, ['button']);\r\n            Templet = this.ui.Templet;\r\n            cn = this.ui.className;\r\n            caption = this.ui.label;\r\n        }\r\n        let {form, hasError} = this.context;\r\n        let context = this.context;\r\n        let disabled = type==='submit' && hasError;\r\n        let content:any;\r\n        if (this.children !== undefined) content = this.children;\r\n        else if (typeof Templet === 'function') content = Templet();\r\n        else if (Templet !== undefined) content = Templet;\r\n        else content = caption; \r\n        let button = <button \r\n            className={cn} \r\n            type=\"button\"\r\n            disabled={disabled}\r\n            onClick={this.onClick}>\r\n            {content || name}\r\n        </button>;\r\n        if (context.inNode === true) return <>{button}{this.renderErrors()}</>;\r\n        return <div className={form.ButtonClass}>\r\n            <div>{this.renderErrors()}</div>\r\n            {button}\r\n        </div>;\r\n    });\r\n    \r\n    protected get label():string {return null}\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Form } from './form';\r\nimport { UiSchema, UiArr, UiItem } from '../schema';\r\nimport { ArrSchema, ItemSchema } from '../schema';\r\nimport { Widget } from './widgets/widget';\r\n//import { ArrRow } from './arrRow';\r\nimport { observable, computed } from 'mobx';\r\nimport { ContextRule } from './rules';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Context {\r\n    private subContexts:{[name:string]:{[rowKey:string]:Context}};\r\n    readonly form: Form;\r\n    readonly uiSchema: UiSchema;\r\n    readonly initData: any;\r\n    readonly inNode: boolean;           // true: </> Field\r\n    readonly widgets: {[name:string]: Widget} = {};\r\n    readonly rules: ContextRule[];\r\n    readonly isRow: boolean;\r\n    @observable errors: string[] = [];\r\n    @observable errorWidgets:Widget[] = [];\r\n\r\n    constructor(form: Form, uiSchema: UiSchema, data: any, inNode: boolean, isRow: boolean) {\r\n        this.form = form;\r\n        this.uiSchema = uiSchema;\r\n        this.initData = data;\r\n        this.inNode = inNode;\r\n        this.isRow = isRow;\r\n        if (uiSchema !== undefined) {\r\n            let {rules} = uiSchema;\r\n            if (rules !== undefined) {\r\n                this.rules = [];\r\n                if (Array.isArray(rules) === false)\r\n                    this.rules.push(rules as ContextRule);\r\n                else\r\n                    this.rules.push(...rules as ContextRule[]);\r\n            }\r\n        }\r\n    }\r\n\r\n    getArrRowContexts(arrName: string) {\r\n        if (this.subContexts === undefined) this.subContexts = {};\r\n        let arrRowContexts = this.subContexts[arrName];\r\n        if (arrRowContexts === undefined) this.subContexts[arrName] = arrRowContexts = {};\r\n        return arrRowContexts;\r\n    }\r\n\r\n    abstract get data():any;\r\n    abstract getItemSchema(itemName:string):ItemSchema;\r\n    abstract getUiItem(itemName:string):UiItem;\r\n    get arrName():string {return undefined}\r\n    getValue(itemName:string):any {return this.initData[itemName]}\r\n    setValue(itemName:string, value:any) {\r\n        this.initData[itemName] = value;\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setValue(value);\r\n    }\r\n    getDisabled(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) return widget.getDisabled();\r\n        return undefined;\r\n    }\r\n    setDisabled(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setDisabled(value);\r\n    }\r\n    getReadOnly(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getReadOnly();\r\n        return undefined;\r\n    }\r\n    setReadOnly(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setReadOnly(value);\r\n    }\r\n    getVisible(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getVisible();\r\n        return undefined;\r\n    }\r\n    setVisible(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setVisible(value);\r\n    }\r\n\r\n    async submit(buttonName: string) {\r\n        this.checkRules()\r\n        if (this.hasError === true) {\r\n            let err = '';\r\n            for (let ew of this.errorWidgets) {\r\n                err += ew.name + ':\\n' + ew.errors.join('\\n');\r\n            }\r\n            console.error(err);\r\n            return;\r\n        }\r\n        let {onButtonClick} = this.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${buttonName} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this);\r\n        if (ret === undefined) return;\r\n        this.setError(buttonName, ret);\r\n\r\n    }\r\n\r\n    checkFieldRules() {\r\n        for (let i in this.widgets) {\r\n            this.widgets[i].checkRules();\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                arrRowContexts[j].checkFieldRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    checkContextRules() {\r\n        this.clearErrors();\r\n        if (this.rules === undefined) return;\r\n        for (let rule of this.rules) {\r\n            let ret = rule(this);\r\n            if (ret === undefined) continue;\r\n            if (Array.isArray(ret) === true) {\r\n                this.errors.push(...ret as string[]);\r\n            }\r\n            else if (typeof ret === 'string') {\r\n                this.errors.push(ret as string);\r\n            }\r\n            else {\r\n                for (let i in ret as object) this.setError(i, (ret as any)[i]);\r\n            }\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                let rowContext = arrRowContexts[j];\r\n                rowContext.clearErrors();\r\n                rowContext.checkContextRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    setError(itemName:string, error:string) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget === undefined) return;\r\n        widget.setContextError(error);\r\n        this.addErrorWidget(widget);\r\n    }\r\n\r\n    clearContextErrors() {\r\n        for (let i in this.widgets) {\r\n            let widget = this.widgets[i];\r\n            if (widget === undefined) continue;\r\n            widget.clearContextError();\r\n        }\r\n    }\r\n\r\n    clearWidgetsErrors() {\r\n        for (let i in this.widgets) {\r\n            let widget = this.widgets[i];\r\n            if (widget === undefined) continue;\r\n            widget.clearError();\r\n        }\r\n    }\r\n\r\n    checkRules() {\r\n        this.clearErrors();\r\n        this.clearWidgetsErrors();\r\n        this.checkFieldRules();\r\n        if (this.hasError === true) return;\r\n        this.checkContextRules();\r\n    }\r\n\r\n    addErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos < 0) this.errorWidgets.push(widget);\r\n    }\r\n    removeErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos >= 0) this.errorWidgets.splice(pos, 1);\r\n    }\r\n\r\n    protected checkHasError():boolean {\r\n        let ret = (this.errorWidgets.length + this.errors.length) > 0;\r\n        if (ret === true) return true;\r\n        if (this.subContexts === undefined) return false;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                if (arrRowContexts[j].hasError === true) return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    @computed get hasError():boolean {\r\n        return this.checkHasError();\r\n    };\r\n\r\n    clearErrors() {\r\n        this.errors.splice(0);\r\n        this.errorWidgets.splice(0);\r\n        this.clearContextErrors();\r\n    }\r\n\r\n    renderErrors = observer((): JSX.Element => {\r\n        let {errors} = this;\r\n        if (errors.length === 0) return null;\r\n        return <>\r\n            {errors.map(err => <span key={err} className=\"text-danger inline-block my-1 ml-3\">\r\n                <i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}\r\n            </span>)}\r\n        </>\r\n    });\r\n}\r\n\r\nlet rowKeySeed:number = 1;\r\nexport class RowContext extends Context {\r\n    readonly parentContext: Context;\r\n    readonly arrSchema: ArrSchema;\r\n    readonly rowKey: number;\r\n\treadonly data: any;\r\n    //readonly uiSchema: UiArr;\r\n\t\r\n    constructor(parentContext:Context, arrSchema: ArrSchema, data: any, inNode: boolean) {\r\n        let uiArr:UiArr;\r\n        let {uiSchema} = parentContext;\r\n        if (uiSchema !== undefined) {\r\n            let {items} = uiSchema;\r\n            if (items !== undefined) uiArr = items[arrSchema.name] as UiArr;\r\n        }\r\n        super(parentContext.form, uiArr, data, inNode, true);\r\n        this.parentContext = parentContext;\r\n        this.arrSchema = arrSchema;\r\n        this.rowKey = rowKeySeed++;\r\n        this.data = data;\r\n    }\r\n    getItemSchema(itemName:string):ItemSchema {return this.arrSchema.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        if (this.uiSchema === undefined) return undefined;\r\n        let {items} = this.uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName]\r\n    }\r\n    get arrName():string {return this.arrSchema.name}\r\n    clearErrors() {\r\n        super.clearErrors();\r\n        this.parentContext.clearErrors();\r\n    }\r\n\r\n    get parentData():any {return this.parentContext.data;}\r\n}\r\n\r\nexport class FormContext extends Context {\r\n    constructor(form:Form, inNode:boolean) {\r\n        super(form, form.uiSchema, form.data, inNode, false);\r\n    }\r\n    get data():any {return this.form.data}\r\n    getItemSchema(itemName:string):ItemSchema {return this.form.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        let {uiSchema} = this.form;\r\n        if (uiSchema === undefined) return undefined;\r\n        let {items} = uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName];\r\n    }\r\n}\r\n\r\nexport const ContextContainer = React.createContext<Context>({} as any);\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\n//import { ArrRow } from '../arrRow';\r\nimport { Context, RowContext, ContextContainer } from '../context';\r\nimport { ArrSchema } from '../../schema';\r\nimport { UiArr, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { factory } from './factory';\r\n\r\nexport const ArrComponent = observer((\r\n    {parentContext, arrSchema, children}:{parentContext: Context, arrSchema: ArrSchema, children: React.ReactNode}) => \r\n{\r\n    let {name, arr} = arrSchema;\r\n    let data = parentContext.initData[name] as any[];\r\n    let {form} = parentContext;\r\n    let arrRowContexts = parentContext.getArrRowContexts(name);\r\n\tlet ui = parentContext.getUiItem(name) as UiArr;\r\n\tlet {onDeleted, onRestored} = ui;\r\n    let arrLabel = name;\r\n    let Templet:TempletType;\r\n    let selectable:boolean, deletable:boolean, restorable:boolean;\r\n    let {ArrContainer, RowContainer, RowSeperator, uiSchema} = form;\r\n    if (uiSchema !== undefined) {\r\n        let {selectable:formSelectable, deletable:formDeletable, restorable:formRestorable} = uiSchema;\r\n        if (selectable !== true) selectable = formSelectable;\r\n        if (deletable !== true) deletable = formDeletable;\r\n        if (restorable !== true) restorable = formRestorable;\r\n    }\r\n    if (ui !== undefined) {\r\n        let {widget:widgetType, label, \r\n            selectable:arrSelectable, deletable:arrDeletable, restorable:arrRestorable,\r\n            ArrContainer:ac, RowContainer:rc, RowSeperator:rs\r\n        } = ui;\r\n        if (arrSelectable !== undefined) selectable = arrSelectable;\r\n        if (arrDeletable !== undefined) deletable = arrDeletable;\r\n        if (arrRestorable !== undefined) restorable = arrRestorable;\r\n        if (ac !== undefined) ArrContainer = ac;\r\n        if (rc !== undefined) RowContainer = rc;\r\n        if (rs !== undefined) RowSeperator = rs;\r\n        Templet = ui.Templet;\r\n        if (widgetType !== 'arr') return Unknown(arrSchema.type, widgetType, ['arr']);\r\n        arrLabel = label || arrLabel;\r\n    }\r\n    let first = true;\r\n    return ArrContainer(arrLabel, <>\r\n        {data.map((row:any, index) => {\r\n            let rowContext: RowContext;\r\n            let rowContent: JSX.Element;\r\n            let sep = undefined;\r\n            if (first === false) sep = RowSeperator;\r\n            else first = false;\r\n            if (children !== undefined) {\r\n                rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                rowContent = <>{children}</>;\r\n            }\r\n            else {\r\n                let typeofTemplet = typeof Templet;\r\n                if (typeofTemplet === 'function') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = React.createElement(observer(Templet as React.StatelessComponent), row);\r\n                }\r\n                else if (typeofTemplet === 'object') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = Templet as JSX.Element;\r\n                }\r\n                else {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, false);\r\n                    rowContent = <>{\r\n                        arr.map((v, index) => {\r\n                            return <React.Fragment key={v.name}>\r\n                                {factory(rowContext, v, undefined)}\r\n                            </React.Fragment>\r\n                        })}\r\n                    </>;\r\n                }\r\n            }\r\n            let {rowKey} = rowContext;\r\n            arrRowContexts[rowKey] = rowContext;\r\n\r\n            let selectCheck:JSX.Element, deleteIcon:JSX.Element;\r\n            if (selectable === true) {\r\n                let onClick = (evt: React.MouseEvent<HTMLInputElement>)=>{\r\n                    let {checked} = (evt.target as HTMLInputElement);\r\n                    row.$isSelected = checked;\r\n                    let {$source} = row;\r\n                    if ($source !== undefined) $source.$isSelected = checked;\r\n                    rowContext.clearErrors();\r\n                }\r\n                selectCheck = <div className=\"form-row-checkbox\">\r\n                    <input type=\"checkbox\" onClick={onClick} defaultChecked={row.$isSelected} />\r\n                </div>;\r\n            }\r\n            let isDeleted = !(row.$isDeleted===undefined || row.$isDeleted===false);\r\n            if (deletable === true) {\r\n                let icon = isDeleted? 'fa-undo' : 'fa-trash';\r\n                let onDelClick = () => {\r\n                    if (restorable === true) {\r\n                        row.$isDeleted = !isDeleted;\r\n                        let {$source} = row;\r\n\t\t\t\t\t\tif ($source !== undefined) $source.$isDeleted = !isDeleted;\r\n\t\t\t\t\t\tif (onRestored) onRestored(row);\r\n                    }\r\n                    else {\r\n                        let p = data.indexOf(row);\r\n\t\t\t\t\t\tif (p>=0) data.splice(p, 1);\r\n\t\t\t\t\t\tif (onDeleted) onDeleted(row);\r\n                    }\r\n                    rowContext.clearErrors();\r\n                }\r\n                deleteIcon = <div className=\"form-row-edit text-info\" onClick={onDelClick}>\r\n                    <i className={classNames('fa', icon, 'fa-fw')} />\r\n                </div>;\r\n            }\r\n            let editContainer = selectable===true || deletable===true?\r\n                (content:any) => <fieldset disabled={isDeleted}><div className={classNames('d-flex', {'deleted':isDeleted, 'row-selected':row.$isSelected})}>\r\n                    {selectCheck}\r\n                    <div className={selectable===true && deletable===true? \"form-row-content\":\"form-row-content-1\"}>{content}</div>\r\n                    {deleteIcon}\r\n                </div></fieldset>\r\n                :\r\n                (content:any) => content;\r\n\r\n            return <ContextContainer.Provider key={rowKey} value={rowContext}>\r\n                {sep}\r\n                {RowContainer(editContainer(<><rowContext.renderErrors />{rowContent}</>))}\r\n            </ContextContainer.Provider>;\r\n        })}\r\n    </>);\r\n});\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiImageItem } from '../../schema';\r\nimport { Image } from '../../image';\r\nimport { ImageItemEdit } from '../../edit/imageItemEdit';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\n\r\nexport class ImageWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiImageItem {return this._ui as UiImageItem};\r\n    @observable private imageSrc: string;\r\n\r\n    init() {\r\n        super.init();\r\n        this.imageSrc = this.value;\r\n    }\r\n\r\n    protected onClick = async () => {\r\n        let edit = new ImageItemEdit(undefined, this.itemSchema, this.ui, this.ui.label, this.value);\r\n        let ret = await edit.start();\r\n        if (ret !== null) {\r\n            this.setValue(ret);\r\n            this.imageSrc = ret;\r\n        }\r\n        await edit.end();\r\n    }\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let cn = [\r\n            'bg-white p-1 d-flex justify-content-center',\r\n        ];\r\n        let onClick: any;\r\n        if (!this.readOnly && !this.disabled) {\r\n            cn.push('cursor-pointer');\r\n            onClick = this.onClick;\r\n        }\r\n        return <div className={classNames(cn)} onClick={onClick}>\r\n            <Image src={this.imageSrc} className=\"w-4c h-4c\"/>\r\n        </div>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTag, IValuesViewRenderOptions } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\nabstract class TagWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiTag {return this._ui as UiTag};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n\t}\r\n\t\r\n\tabstract render():JSX.Element;\r\n}\r\n\r\nexport class TagSingleWidget extends TagWidget {\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet name = this.name;\r\n\t\tif (rowKey !== undefined) name += '-' + rowKey;\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputName: name,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderRadios(this.defaultValue, options);\r\n    }\r\n}\r\n\r\nexport class TagMultiWidget extends TagWidget {\r\n\tprivate defaultArr:number[];\r\n\tinit() {\r\n\t\tsuper.init();\r\n\t\tlet def = this.defaultValue;\r\n\t\tswitch (typeof def) {\r\n\t\t\tdefault:\r\n\t\t\t\tthis.defaultArr = [];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'string':\r\n\t\t\t\tthis.defaultArr = def.split('|').map(v => Number(v));\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.changeValue(values.join('|'), true);\r\n\t}\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputs: this.inputs,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderChecks(this.defaultValue, options);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { ArrSchema, DataType, ItemSchema } from '../../schema';\r\nimport { TypeWidget, UiCustom } from '../../schema';\r\nimport { TextWidget } from './textWidget';\r\nimport { TextAreaWidget } from './textareaWidget';\r\nimport { PasswordWidget, UrlWidget, EmailWidget } from './passwordWidget';\r\nimport { UpdownWidget } from './updownWidget';\r\nimport { NumberWidget } from './numberWidget';\r\nimport { DateWidget, DateTimeWidget, TimeWidget, MonthWidget } from './dateWidget';\r\nimport { CheckBoxWidget } from './checkBoxWidget';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { SelectWidget } from './selectWidget';\r\nimport { RadioWidget } from './radioWidget';\r\nimport { RangeWidget } from './rangeWidget';\r\nimport { IdWidget } from './idWidget';\r\nimport { ButtonWidget } from './buttonWidget';\r\nimport { ArrComponent } from './arrComponent';\r\nimport { ImageWidget } from './imageWidget';\r\nimport { TagSingleWidget, TagMultiWidget } from './tagWidget';\r\n\r\nconst widgetsFactory: {[type: string]: {widget?: TypeWidget, dataTypes?: DataType[]}} = {\r\n    id: {\r\n        dataTypes: ['id'],\r\n        widget: IdWidget,\r\n    },\r\n    text: {\r\n        dataTypes: ['integer', 'number', 'string'],\r\n        widget: TextWidget\r\n    },\r\n    textarea: {\r\n        dataTypes: ['string'],\r\n        widget: TextAreaWidget\r\n    },\r\n    password: {\r\n        dataTypes: ['string'],\r\n        widget: PasswordWidget\r\n    },\r\n    date: {\r\n        dataTypes: ['date'],\r\n        widget: DateWidget\r\n    },\r\n    datetime: {\r\n        dataTypes: ['date'],\r\n        widget: DateTimeWidget\r\n    },\r\n    time: {\r\n        dataTypes: ['date'],\r\n        widget: TimeWidget\r\n    },\r\n    month: {\r\n        dataTypes: ['date'],\r\n        widget: MonthWidget\r\n    },\r\n    select: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: SelectWidget\r\n    },\r\n    url: {\r\n        dataTypes: ['string'],\r\n        widget: UrlWidget\r\n    },\r\n    email: {\r\n        dataTypes: ['string'],\r\n        widget: EmailWidget\r\n    },\r\n    number: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: NumberWidget\r\n    },\r\n    updown: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: UpdownWidget\r\n    },\r\n    color: {\r\n\r\n    },\r\n    checkbox: {\r\n        dataTypes: ['boolean', 'integer', 'number'],\r\n        widget: CheckBoxWidget\r\n    },\r\n    image: {\r\n        dataTypes: ['string'],\r\n        widget: ImageWidget,\r\n    },\r\n    checkboxes: {\r\n\r\n    },\r\n    radio: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: RadioWidget\r\n\t},\r\n\ttagSingle: {\r\n\t\tdataTypes: ['integer'],\r\n\t\twidget: TagSingleWidget\r\n\t},\r\n\ttagMulti: {\r\n\t\tdataTypes: ['string'],\r\n\t\twidget: TagMultiWidget\r\n\t},\r\n    range: {\r\n        dataTypes: ['integer'],\r\n        widget: RangeWidget,\r\n    },\r\n    button: {\r\n        dataTypes: ['button', 'submit'],\r\n        widget: ButtonWidget,\r\n    }\r\n}\r\n\r\nexport function factory(context: Context, itemSchema: ItemSchema, children:React.ReactNode, fieldProps?: FieldProps):JSX.Element {\r\n    if (context === undefined) {\r\n        debugger;\r\n        return null;\r\n    }\r\n    if (itemSchema === undefined) return undefined;\r\n    let {name, type} = itemSchema;\r\n    switch (type) {\r\n    case 'arr':\r\n        let arrSchema = context.getItemSchema(name) as ArrSchema;\r\n        return <ArrComponent parentContext={context} arrSchema={arrSchema} children={children} />;\r\n    default:\r\n        break;\r\n    }\r\n\r\n    let typeWidget: TypeWidget;\r\n    let ui = context.getUiItem(name);\r\n    function getTypeWidget(t:DataType): TypeWidget {\r\n        switch(t) {\r\n        default: return TextWidget; \r\n        case 'id': return IdWidget;\r\n        case 'integer': return UpdownWidget;\r\n        case 'number': return NumberWidget; \r\n        case 'string': return TextWidget; \r\n        case 'date': return DateWidget; \r\n        case 'boolean': return CheckBoxWidget; \r\n        case 'button':\r\n        case 'submit': return ButtonWidget;\r\n        }\r\n    }\r\n    if (ui === undefined) { \r\n        typeWidget = getTypeWidget(type);\r\n    }\r\n    else {\r\n        let {widget:widgetType} = ui;\r\n        switch (widgetType) {\r\n        default:\r\n            if (widgetType !== undefined) {\r\n                let widgetFactory = widgetsFactory[widgetType];\r\n                typeWidget = widgetFactory.widget;\r\n            }\r\n            if (typeWidget === undefined) typeWidget = getTypeWidget(type);\r\n            break;\r\n        case 'custom':\r\n            typeWidget = (ui as UiCustom).WidgetClass;\r\n            break;\r\n        case 'group':\r\n            return <span>impletment group</span>;\r\n        }\r\n        //label = uiLabel || name;\r\n    }\r\n    \r\n\tlet {widgets} = context;\r\n\tlet widget = widgets[name];\r\n\tif (!widget) {\r\n\t\twidget = new typeWidget(context, itemSchema, fieldProps, children);\r\n\t\twidget.init();\r\n\t\twidgets[name] = widget;\r\n\t}\r\n\r\n    return <widget.container />;\r\n    /*\r\n    if (isRow === false) {\r\n        let WidgetElement = observer(() => widget.container());\r\n        return <WidgetElement />;\r\n    }\r\n    else {\r\n        let widgetElement = widget.container();\r\n        return widgetElement;\r\n    }\r\n    */\r\n}\r\n\r\n","import * as React from 'react';\r\nimport {observable, IReactionDisposer, autorun} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { Schema, ItemSchema, ArrSchema } from '../schema';\r\nimport { UiSchema, TempletType } from '../schema';\r\nimport { factory } from './widgets';\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport { ContextContainer, FormContext, Context } from './context';\r\nimport { FormRes, formRes } from '../../res';\r\nimport { resLang } from '../../res/res';\r\n\r\nexport type FormButtonClick = (name:string, context: Context) => Promise<any>;\r\nexport type InputEnter = (name:string, context: Context) => Promise<any>;\r\n\r\nexport interface FormProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    uiSchema?: UiSchema;\r\n    formData?: any;\r\n    onButtonClick?: FormButtonClick;\r\n    onEnter?: InputEnter;\r\n    fieldLabelSize?: number;            // col-sm-2 for label\r\n    requiredFlag?: boolean;             // default=true\r\n    beforeShow?: (formContext:FormContext) => void;\r\n    res?: FormRes;\r\n\r\n    Container?: (content:JSX.Element) => JSX.Element;\r\n    FieldContainer?: (label:string|JSX.Element, content:JSX.Element) => JSX.Element;\r\n    FieldClass?: string;\r\n    ButtonClass?: string;\r\n}\r\n\r\nexport class Form extends React.Component<FormProps> {\r\n    readonly schema: Schema;\r\n    readonly itemSchemas: {[name:string]: ItemSchema};\r\n    readonly uiSchema: UiSchema;\r\n    readonly res?: FormRes;\r\n    protected formContext: FormContext;\r\n    private disposer: IReactionDisposer;\r\n    readonly data:any;\r\n\r\n    readonly Container: (content:JSX.Element) => JSX.Element;\r\n    readonly FieldContainer: (label:any, content:JSX.Element) => JSX.Element;\r\n    readonly FieldClass: string;\r\n    readonly ButtonClass: string;\r\n    \r\n    constructor(props:FormProps) {\r\n        super(props);\r\n        let {schema, uiSchema, \r\n            Container, FieldContainer, FieldClass, \r\n            ButtonClass, res,\r\n        } = props;\r\n        this.Container = Container || this.DefaultContainer;\r\n        this.FieldContainer = FieldContainer || this.DefaultFieldContainer;\r\n        this.FieldClass = FieldClass!==undefined && FieldClass!==''&&FieldClass!==null? FieldClass : this.DefaultFieldClass;\r\n        this.res = res || this.DefaultRes;\r\n        this.ButtonClass = ButtonClass || this.DefaultButtonClass;\r\n\r\n        this.schema = schema;\r\n        this.itemSchemas = {};\r\n        for (let itemSchema of this.schema) {\r\n            this.itemSchemas[itemSchema.name] = itemSchema;\r\n        }\r\n        this.uiSchema = uiSchema;\r\n\r\n        this.disposer = autorun(this.watch);\r\n        this.data = {};\r\n    }\r\n\r\n    private renderContent():any {\r\n        this.initData(this.props.formData);\r\n        let {children} = this.props;\r\n        if (children !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return <>{children}</>;\r\n        }\r\n\r\n        let Templet: TempletType;\r\n        if (this.uiSchema !== undefined) {\r\n            Templet = this.uiSchema.Templet;\r\n        }\r\n        if (Templet !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return typeof(Templet) === 'function'? Templet(this.data) : Templet;\r\n        }\r\n\r\n\t\tif (!this.formContext) {\r\n\t\t\tthis.formContext = new FormContext(this, false);\r\n\t\t}\r\n        return <>{this.schema.map((v, index) => {\r\n            return <React.Fragment key={index}>{factory(this.formContext, v, children)}</React.Fragment>\r\n        })}</>;\r\n    }\r\n\r\n    private initData(formData: any) {\r\n        if (formData === undefined) formData = {};\r\n        if (this.uiSchema !== undefined) {\r\n            let {items} = this.uiSchema;\r\n            if (items !== undefined) {\r\n                for (let i in items) {\r\n                    let ui = items[i];\r\n                    let dv = ui.defaultValue;\r\n                    if (dv !== undefined) {\r\n                        if (formData[i] === undefined) {\r\n                            formData[i] = dv;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (let itemSchema of this.schema) {\r\n            this.initDataItem(itemSchema, this.data, formData);\r\n        }\r\n    }\r\n\r\n    private initDataItem(itemSchema: ItemSchema, data:any, formData: any):any {\r\n        let {name, type} = itemSchema;\r\n        if (type === 'button') return;\r\n        if (type !== 'arr') {\r\n            data[name] = formData[name];\r\n            return;\r\n        }\r\n\r\n        let arrItem:ArrSchema = itemSchema as ArrSchema;\r\n        let {arr:arrItems} = arrItem;\r\n        if (arrItems === undefined) return;\r\n        let arrDict:any = arrItem.itemSchemas = {};\r\n        for (let item of arrItems) {\r\n            arrDict[item.name] = item;\r\n        }\r\n        let val:any[] = formData[name];\r\n        if (val === undefined) val = [];\r\n        else if (Array.isArray(val) === false) val = [val];\r\n        let arr:any[] = [];\r\n        for (let row of val) {\r\n            let {$isSelected, $isDeleted} = row;\r\n            let r = {\r\n                $source: row,\r\n                $isSelected: $isSelected,\r\n                $isDeleted: $isDeleted,\r\n            };\r\n            for (let item of arrItems) {\r\n                this.initDataItem(item, r, row);\r\n            }\r\n            arr.push(r);\r\n        }\r\n        // observable\r\n        // observable\r\n        data[name] = observable(arr);\r\n        //data[name] = arr;\r\n        return;\r\n    }\r\n\r\n    private watch = () => {\r\n        let {formData} = this.props;\r\n        if (formData === undefined) return;\r\n        //this.initData(formData);\r\n        this.calcSelectOrDelete();\r\n    }\r\n    private calcSelectOrDelete() {\r\n        for (let itemSchema of this.schema) {\r\n            this.arrItemOperated(itemSchema);\r\n        }\r\n    }\r\n\r\n    private arrItemOperated(itemSchema: ItemSchema) {\r\n        let {name, type} = itemSchema;\r\n        if (type !== 'arr') return;\r\n        if (this.data === undefined) return;\r\n        let formArrVal = this.data[name];\r\n        if (formArrVal === undefined) return;\r\n        let {arr: arrItems} = itemSchema as ArrSchema;\r\n        for (let row of formArrVal) {\r\n            let {$source} = row;\r\n            if ($source === undefined) continue;\r\n            let {$isSelected, $isDeleted} = $source;\r\n            row.$isSelected = $isSelected;\r\n            row.$isDeleted = $isDeleted;\r\n            //console.log($isSelected, $isDeleted);\r\n            for (let item of arrItems) {\r\n                this.arrItemOperated(item);\r\n            }\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        let {beforeShow} = this.props;\r\n        if (beforeShow !== undefined) beforeShow(this.formContext);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        if (this.disposer !== undefined) this.disposer();\r\n    }\r\n\r\n    render() {\r\n        let content = this.renderContent();\r\n        return <ContextContainer.Provider value={this.formContext}>\r\n            {React.createElement(this.formContext.renderErrors)}\r\n            {this.Container(content)}\r\n        </ContextContainer.Provider>;\r\n    }\r\n\r\n    async buttonClick(buttonName:string) {\r\n        this.formContext.checkRules()\r\n        if (this.formContext.hasError === true) return;\r\n\r\n        let {onButtonClick} = this.formContext.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this.formContext);\r\n        if (ret === undefined) return;\r\n        this.formContext.setError(buttonName, ret);\r\n    }\r\n\r\n    protected DefaultContainer = (content:JSX.Element): JSX.Element => {\r\n        return <form className={classNames(this.props.className)} onSubmit={e=>e.preventDefault()}>\r\n            {content}\r\n        </form>;\r\n    }\r\n    protected DefaultFieldContainer = (label:string|JSX.Element, content:JSX.Element): JSX.Element => {\r\n        let {fieldLabelSize} = this.props;\r\n\r\n        if (fieldLabelSize > 0) {\r\n            let labelView:any;\r\n            if (label === null) {\r\n                fieldLabelSize = 0;\r\n            }\r\n            else {\r\n                labelView = <label className={classNames('col-sm-' + fieldLabelSize, 'col-form-label')}>{label}</label>\r\n            }\r\n            let fieldCol = 'col-sm-' + (12 - fieldLabelSize);\r\n            return <div className=\"form-group row\">\r\n                {labelView}\r\n                <div className={fieldCol}>{content}</div>\r\n            </div>;\r\n        }\r\n        return <div className=\"form-group\">\r\n            {label===null? null:<label className=\"col-form-label\">{label}</label>}\r\n            {content}\r\n        </div>;\r\n    }\r\n    protected DefaultFieldClass:string = undefined;\r\n    protected DefaultButtonClass = 'text-center py-2';\r\n    protected DefaultRes:FormRes = resLang<FormRes>(formRes);\r\n\r\n    ArrContainer = (label:any, content:JSX.Element): JSX.Element => {\r\n        return <div>\r\n            <div className={classNames('small text-muted text-center bg-light py-1 px-3 mt-4 mb-1')}>{label}</div>\r\n            {content}\r\n        </div>;\r\n    }\r\n    RowContainer = (content:JSX.Element): JSX.Element => {\r\n        let cn = classNames({\r\n            'py-3': true\r\n        });\r\n        return <div className={cn}>{content}</div>\r\n    }\r\n    RowSeperator = <div className=\"border border-gray border-top\" />;\r\n}\r\n","import * as React from 'react';\r\nimport { factory } from './widgets';\r\nimport { ContextContainer, Context } from './context';\r\n\r\nexport interface FieldProps {\r\n    name: string;\r\n}\r\n\r\nexport class FormField extends React.Component<FieldProps> {\r\n    static contextType = ContextContainer;\r\n    render() {\r\n        let {name, children } = this.props;\r\n        let context:Context = this.context;\r\n        if (context === undefined) return <span className=\"text-danger\">!only in Form!</span>;\r\n        let itemSchema = context.getItemSchema(name);\r\n        let content = factory(context, itemSchema, children, this.props);\r\n        if (content === undefined) {\r\n            return <span className=\"text-danger\">!!{name} is not defined!!</span>;\r\n        }\r\n        return content;\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { nav } from '../components';\r\nimport { VPage } from '../vm';\r\nimport { CLogin } from './CLogin';\r\n\r\nexport class VLogout extends VPage<CLogin> {\r\n\tprivate onLogout: ()=>void;\r\n\r\n\tinit(param: any) {\r\n\t\tthis.onLogout = param;\r\n\t}\r\n\theader() {return this.isWebNav === true? false : '';}\r\n\tfooter() {\r\n\t\treturn <div className=\"mt-5 text-center justify-content-center\">\r\n\t\t\t<button className=\"btn btn-outline-warning\" onClick={nav.resetAll}></button>\r\n\t\t</div>;\r\n\t}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\r\n\tcontent() {\r\n\t\treturn <div className=\"m-5 border border-info bg-white rounded-3 p-5 text-center\">\r\n\t\t\t<div></div>\r\n\t\t\t<div className=\"mt-5 text-center\">\r\n\t\t\t\t<button className=\"btn btn-danger\" onClick={this.onLogout}></button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","export default __webpack_public_path__ + \"static/media/logo.2d27ead7.svg\";","import * as React from 'react';\r\nimport { nav } from '../components';\r\nimport { mobileRegex, emailRegex } from '../tool';\r\nimport logo from '../img/logo.svg';\r\n\r\nexport function tonvaTop() {\r\n    return nav.loginTop(<div className=\"d-flex align-items-center position-relative\">\r\n        <img className=\"App-logo h-3c position-absolute\" src={logo} alt=\"img\" />\r\n        <div className=\"h3 flex-fill text-center\"><span className=\"text-primary mr-3\"></span>\r\n            <span className=\"text-danger\"></span>\r\n        </div>\r\n    </div>);\r\n}\r\n\r\ninterface Sender {\r\n    type: string;\r\n    caption: string;\r\n    regex: RegExp;\r\n}\r\n\r\nconst senders:Sender[] = [\r\n    {type:'mobile', caption:'', regex: mobileRegex},\r\n    {type:'email', caption:'', regex: emailRegex}\r\n];\r\n\r\nexport function getSender(un: string):Sender {\r\n    let sender = senders.find(v => v.regex.test(un) === true);\r\n    return sender;\r\n}","import * as React from 'react';\r\nimport {nav, Form, Schema, UiSchema, UiTextItem, UiPasswordItem, Context, UiButton, StringSchema, Ax} from '../components';\r\nimport { tonvaTop, getSender } from './tools';\r\nimport { User } from '../tool';\r\nimport { CLogin } from './CLogin';\r\nimport { VPage } from '../vm';\r\n\r\nconst schema: Schema = [\r\n    {name: 'username', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n    {name: 'password', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n    {name: 'login', type: 'submit'},\r\n];\r\n\r\nexport class VLogin extends VPage<CLogin> {\r\n    private onLogin: (un:string, pwd:string) => Promise<boolean>;\r\n    private withBack: boolean;\r\n\r\n\tinit({onLogin, withBack}:{onLogin: (un:string, pwd:string) => Promise<boolean>; withBack: boolean;}) {\r\n\t\tthis.onLogin = onLogin;\r\n\t\tthis.withBack = withBack;\r\n\t}\r\n\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            username: {placeholder: '//', label: ''} as UiTextItem,\r\n            password: {widget: 'password', placeholder: '', label: ''} as UiPasswordItem,\r\n            login: {widget: 'button', className: 'btn btn-primary btn-block mt-3', label: ''} as UiButton,\r\n        }\r\n    }\r\n\r\n    private onSubmit = async (name:string, context:Context):Promise<string> => {\r\n        let values = context.form.data;\r\n        let un = values['username'];\r\n        let pwd = values['password'];\r\n        if (pwd === undefined) {\r\n            return 'something wrong, pwd is undefined';\r\n\t\t}\r\n\t\tlet ret = await this.onLogin(un, pwd);\r\n\t\tif (ret === true) return;\r\n\r\n\t\tlet sender = getSender(un);\r\n\t\tlet type:string = sender !== undefined? sender.caption : '';\r\n\t\treturn type + '';\r\n    }\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'password') {\r\n            return await this.onSubmit('login', context);\r\n        }\r\n\t}\r\n\r\n\theader() {\r\n        if (this.withBack === true) {\r\n            return '';\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfooter() {\r\n        return <div className=\"d-block\">\r\n            <div className='text-center'>\r\n                <Ax href=\"/register\" className=\"btn btn-link\" style={{margin:'0px auto'}}>\r\n                    \r\n                </Ax>\r\n            </div>\r\n            {nav.privacyEntry()}\r\n        </div>;\r\n\t}\r\n\r\n\tcontent() {\r\n        return <div className=\"d-flex p-5 flex-column justify-content-center align-items-center\">\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t\t<div className=\"w-20c\">\r\n\t\t\t\t{tonvaTop()}\r\n\t\t\t\t<div className=\"h-2c\" />\r\n\t\t\t\t<Form schema={schema} uiSchema={this.uiSchema} \r\n\t\t\t\t\tonButtonClick={this.onSubmit} \r\n\t\t\t\t\tonEnter={this.onEnter}\r\n\t\t\t\t\trequiredFlag={false} />\r\n\t\t\t\t{/*onClick={() => this.clickForget()}*/}\r\n\t\t\t\t<Ax className=\"btn btn-link btn-block\" href=\"/forget\">\r\n\t\t\t\t\t\r\n\t\t\t\t</Ax>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t</div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage } from '../vm';\r\nimport { Page, Form, ItemSchema, UiSchema, StringSchema, UiPasswordItem, Context, ButtonSchema, UiButton, nav } from '../components';\r\n//import { CenterAppApi } from '../net';\r\nimport { CLogin } from './CLogin';\r\n\r\nexport class VChangePassword extends VPage<CLogin> {\r\n    private schema: ItemSchema[] = [\r\n        {name:'orgPassword', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'newPassword', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'newPassword1', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'submit', type: 'submit'} as ButtonSchema\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            orgPassword: {\r\n                widget: 'password',\r\n                label: '',\r\n                placeholder: ''\r\n            } as UiPasswordItem,\r\n            newPassword: {\r\n                widget: 'password',\r\n                label: '',\r\n                placeholder: ''\r\n            } as UiPasswordItem,\r\n            newPassword1: {\r\n                widget: 'password',\r\n                label: '', \r\n                placeholder: ''\r\n            } as UiPasswordItem,\r\n            submit: {\r\n                widget: 'button',\r\n                label: '',\r\n                className: 'btn btn-primary'\r\n            } as UiButton,\r\n        }\r\n\t};\r\n\t\r\n\tprivate onChange: (orgPassword:string, newPassword:string) => Promise<boolean>\r\n\tinit(onChange: (orgPassword:string, newPassword:string) => Promise<boolean>) {\r\n\t\tthis.onChange = onChange;\r\n\t}\r\n\r\n    private onSubmit = async (name:string, context: Context):Promise<any> => {\r\n        let {orgPassword, newPassword, newPassword1} = context.data;\r\n        if (newPassword !== newPassword1) {\r\n            context.setError('newPassword1', '');\r\n            return;\r\n        }\r\n        //let centerAppApi = new CenterAppApi('tv/', undefined);\r\n\t\t//let ret = await centerAppApi.changePassword({orgPassword, newPassword});\r\n\t\tlet ret = await this.onChange(orgPassword, newPassword);\r\n        if (ret === false) {\r\n            context.setError('orgPassword', '');\r\n            return;\r\n        }\r\n        nav.replace(<Page header=\"\" back=\"close\">\r\n            <div className=\"m-3  text-success\">\r\n                \r\n            </div>\r\n        </Page>);\r\n        return;\r\n    }\r\n\r\n\theader() {return ''}\r\n\r\n    content() {\r\n        return <Form\r\n\t\t\tclassName=\"m-3\" \r\n\t\t\tschema={this.schema}\r\n\t\t\tuiSchema={this.uiSchema}\r\n\t\t\tonButtonClick={this.onSubmit}\r\n\t\t\tfieldLabelSize={2} />\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { VPage } from \"../../vm\";\r\nimport { tonvaTop, getSender } from '../tools';\r\nimport {nav, Page, Schema, UiSchema, UiTextItem, UiButton, Form, Context, StringSchema, Ax} from '../../components';\r\nimport { CForget, CRegBase, CRegister } from './CRegister';\r\n\r\nexport abstract class VStart<T extends CRegBase> extends VPage<T> {\r\n    private schema: Schema = [\r\n        {name: 'user', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n        {name: 'verify', type: 'submit'},\r\n    ]\r\n\tprivate uiSchema: UiSchema;\r\n\t\r\n\tabstract get accountLable():string;\r\n\tabstract get pageCaption():string;\r\n\r\n\tinit() {\r\n        this.uiSchema = {\r\n            items: {\r\n                user: {\r\n                    widget: 'text',\r\n                    label: this.accountLable,\r\n                    placeholder: '',\r\n                } as UiTextItem, \r\n                verify: {widget: 'button', className: 'btn btn-primary btn-block mt-3', label: ''} as UiButton,\r\n            }\r\n        }\r\n\t}\r\n\r\n\theader() {return this.pageCaption;}\r\n\tfooter() {\r\n\t\treturn <div className=\"text-center\">\r\n\t\t\t<Ax href=\"/login\" className=\"text-primary\"></Ax>\r\n\t\t</div>;\r\n\t}\r\n\r\n    content():JSX.Element {\r\n        return <div className=\"w-max-20c my-5 py-5\"\r\n                style={{marginLeft:'auto', marginRight:'auto'}}>\r\n\t\t\t{tonvaTop()}\r\n\t\t\t<div className=\"h-3c\" />\r\n\t\t\t<Form schema={this.schema} uiSchema={this.uiSchema} \r\n\t\t\t\tonButtonClick={this.onSubmit}\r\n\t\t\t\tonEnter={this.onEnter} \r\n\t\t\t\trequiredFlag={false} />\r\n\t\t\t{nav.privacyEntry()}\r\n\t\t</div>;\r\n    }\r\n\r\n    private onSubmit = async (name:string, context:Context):Promise<string> => {\r\n        context.clearContextErrors();\r\n        let user = 'user';\r\n        let value = context.getValue(user);\r\n        let sender = getSender(value);\r\n        if (sender === undefined) {\r\n            context.setError(user, '');\r\n            return;\r\n        }\r\n        let type:'mobile'|'email' = sender.type as 'mobile'|'email';\r\n        if (type === 'mobile') {\r\n            if (value.length !== 11 || value[0] !== '1') {\r\n                context.setError(user, '');\r\n                return;\r\n            }\r\n        }\r\n        this.controller.account = value;\r\n        this.controller.type = type;\r\n        let ret = await this.controller.checkAccount();\r\n        if (ret !== undefined) context.setError(user, ret);\r\n    }\r\n\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'user') {\r\n            return await this.onSubmit('verify', context);\r\n        }\r\n    }\r\n}\r\n\r\nexport class VRegisterStart extends VStart<CRegister> {\r\n\tget accountLable():string {return ''}\r\n\tget pageCaption():string {return ''}\r\n}\r\n\r\nexport class VForgetStart extends VStart<CForget> {\r\n\tfooter():JSX.Element {return null;}\r\n\tget accountLable():string {return ''}\r\n\tget pageCaption():string {return ''}\r\n}\r\n","import React from 'react';\r\nimport { VPage } from \"../../vm\";\r\nimport { CRegBase } from \"./CRegister\";\r\nimport {Schema, UiSchema, UiTextItem, UiButton, Form, Context, NumSchema} from '../../components';\r\n\r\nexport class VVerify extends VPage<CRegBase> {\r\n    private schema: Schema = [\r\n        {name: 'verify', type: 'number', required: true, maxLength: 6} as NumSchema,\r\n        {name: 'submit', type: 'submit'},\r\n    ]\r\n\r\n    private onVerifyChanged = (context:Context, value:any, prev:any) => {\r\n        context.setDisabled('submit', !value || (value.length !== 6));\r\n    }\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            verify: {\r\n                widget: 'text',\r\n                label: '',\r\n                placeholder: '',\r\n                onChanged: this.onVerifyChanged,\r\n            } as UiTextItem, \r\n            submit: {\r\n                widget: 'button', \r\n                className: 'btn btn-primary btn-block mt-3', \r\n                label: ' >',\r\n                disabled: true\r\n            } as UiButton,\r\n        }\r\n\t}\r\n\t\r\n\tprivate onVerify: (verify:string) => Promise<number>;\r\n\tinit(onVerify: (verify:string) => Promise<number>) {\r\n\t\tthis.onVerify = onVerify;\r\n\t}\r\n\r\n\tprivate onSubmit = async (name:string, context:Context):Promise<string> => {\r\n        let verify = context.getValue('verify');\r\n        let ret = await this.onVerify(verify);\r\n        if (ret === 0) {\r\n            context.setError('verify', '');\r\n            return;\r\n        }\r\n    }\r\n\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'verify') {\r\n            return await this.onSubmit('submit', context);\r\n        }\r\n    }\r\n\r\n\theader() {return ''}\r\n\r\n\tcontent() {\r\n        let typeText:string, extra:any;\r\n        switch (this.controller.type) {\r\n            case 'mobile': typeText = ''; break;\r\n            case 'email': \r\n                typeText = ''; \r\n                extra = <><span className=\"text-danger\"></span>: <br/></>;\r\n                break;\r\n        }\r\n        return <div className=\"w-max-20c my-5 py-5\"\r\n\t\t\tstyle={{marginLeft:'auto', marginRight:'auto'}}>\r\n\t\t\t{typeText}<br/>\r\n\t\t\t<div className=\"py-2 px-3 my-2 text-primary bg-light\"><b>{this.controller.account}</b></div>\r\n\t\t\t{extra}\r\n\t\t\t<div className=\"h-1c\" />\r\n\t\t\t<Form schema={this.schema} uiSchema={this.uiSchema} \r\n\t\t\t\tonButtonClick={this.onSubmit} \r\n\t\t\t\tonEnter={this.onEnter}\r\n\t\t\t\trequiredFlag={false} />\r\n\t\t</div>;\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { VPage } from \"../../vm\";\r\nimport {nav, Page, Schema, UiSchema, UiPasswordItem, UiButton, Form, Context, StringSchema} from '../../components';\r\nimport { CForget, CRegBase, CRegister } from './CRegister';\r\n\r\nexport abstract class VPassword<T extends CRegBase> extends VPage<T> {\r\n\tprotected abstract get pageCaption():string;\r\n\tprotected abstract get submitCaption():string;\r\n\r\n\tget account():string {return this.controller.account}\r\n\r\n    private schema: Schema = [\r\n        {name: 'pwd', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n        {name: 'rePwd', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n        {name: 'submit', type: 'submit'},\r\n    ]\r\n\r\n\tprivate onButtonSubmit = async (name:string, context:Context):Promise<string> => {\r\n        let values = context.form.data;\r\n        let {pwd, rePwd} = values;\r\n        let error:string;\r\n        if (!pwd || pwd !== rePwd) {\r\n            context.setValue('pwd', '');\r\n            context.setValue('rePwd', '');\r\n            error = '';\r\n            context.setError('pwd', error);\r\n        }\r\n        else {\r\n\t\t\terror = await this.controller.onPasswordSubmit(pwd);\r\n            if (error !== undefined) {\r\n                nav.push(<Page header=\"\"><div className=\"p-5 text-danger\">{error}</div></Page>);\r\n            }\r\n        }\r\n        return error;\r\n    }\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'rePwd') {\r\n            return await this.onButtonSubmit('submit', context);\r\n        }\r\n    }\r\n\t\r\n\theader() {\r\n\t\treturn this.pageCaption;\r\n\t}\r\n\r\n\tcontent() {\r\n\t\tlet uiSchema: UiSchema = {\r\n\t\t\titems: {\r\n\t\t\t\tpwd: {widget: 'password', placeholder: '', label: ''} as UiPasswordItem,\r\n\t\t\t\trePwd: {widget: 'password', placeholder: '', label: ''} as UiPasswordItem,\r\n\t\t\t\tsubmit: {widget: 'button', className: 'btn btn-primary btn-block mt-3', label: this.submitCaption} as UiButton,\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <div className=\"w-max-20c my-5 py-5\"\r\n\t\t\tstyle={{marginLeft:'auto', marginRight:'auto'}}>\r\n\t\t\t<br/>\r\n\t\t\t<div className=\"py-2 px-3 my-2 text-primary bg-light\"><b>{this.account}</b></div>\r\n\t\t\t<div className=\"h-1c\" />\r\n\t\t\t<Form schema={this.schema} uiSchema={uiSchema}\r\n\t\t\t\tonButtonClick={this.onButtonSubmit}\r\n\t\t\t\tonEnter={this.onEnter}\r\n\t\t\t\trequiredFlag={false} />\r\n\t\t</div>;\r\n    }\r\n}\r\n\r\nexport class VRegisterPassword extends VPassword<CRegister> {\r\n\tget pageCaption():string {return ''}\r\n\tget submitCaption():string {return ''}\r\n}\r\n\r\nexport class VForgetPassword extends VPassword<CForget> {\r\n\tget pageCaption():string {return ''}\r\n\tget submitCaption():string {return ''}\r\n}\r\n","import React from 'react';\r\nimport { VPage } from \"../../vm\";\r\nimport { CRegBase } from './CRegister';\r\n\r\nexport abstract class VSuccess extends VPage<CRegBase> {\r\n\theader() {return false;}\r\n}\r\n\r\nexport class VRegisterSuccess extends VSuccess {\r\n\tcontent() {\r\n    \tconst {account, login} = this.controller;\r\n\t\treturn <div className=\"container w-max-30c\">\r\n\t\t\t<div className=\"my-5\">\r\n\t\t\t\t<div className=\"py-5 text-center\">\r\n\t\t\t\t\t <strong className=\"text-primary\">{account} </strong> \r\n\t\t\t\t</div>\r\n\t\t\t\t<button className=\"btn btn-success btn-block\" type=\"button\" onClick={()=>login(undefined)}>\r\n\t\t\t\t\t\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nexport class VForgetSuccess extends VSuccess {\r\n\tcontent() {\r\n    \tconst {login} = this.controller;\r\n\t\treturn <div className=\"container w-max-30c\">\r\n\t\t\t<div className=\"my-5\">\r\n\t\t\t\t<div className=\"py-5 text-center text-success\"></div>\r\n\t\t\t\t<button className=\"btn btn-primary btn-block\" onClick={()=>login()}>\r\n\t\t\t\t\t\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t}\t\r\n}\r\n","import { Controller, VPage } from \"../../vm\";\r\nimport { nav } from '../../components';\r\nimport { VRegisterStart, VForgetStart } from './VStart';\r\nimport { userApi, RegisterParameter } from '../../net';\r\nimport { VVerify } from './VVerify';\r\nimport { VRegisterPassword, VForgetPassword } from './VPassword';\r\nimport { VForgetSuccess, VRegisterSuccess } from \"./VSuccess\";\r\n\r\nexport abstract class CRegBase extends Controller {\r\n    account: string;\r\n    type:'mobile'|'email';\r\n    password: string;\r\n    verify: string;\r\n\r\n\tprotected abstract get VStart(): new(c:Controller) => VPage<any>;\r\n    protected async internalStart() {\r\n        this.openVPage(this.VStart);\r\n    }\r\n\r\n\tprotected get VVerify(): new(c:Controller) => VPage<any> {return VVerify as any};\r\n    toVerify() {\r\n        //this.account = account;\r\n        this.openVPage(this.VVerify, async (verify: string) => {\r\n\t\t\tthis.verify = verify;\r\n\t\t\tlet ret = await userApi.checkVerify(this.account, verify);\r\n\t\t\tif (ret === 0) return ret;\r\n\t\t\tthis.toPassword();\r\n\t\t});\r\n    }\r\n\r\n\tprotected abstract get VPassword(): new(c:Controller) => VPage<any>;\r\n    toPassword() {\r\n        this.openVPage(this.VPassword);\r\n    }\r\n\r\n\tprotected abstract get VSuccess(): new(c:Controller) => VPage<any>;\r\n    toSuccess() {\r\n        this.openVPage(this.VSuccess);\r\n\t}\r\n\r\n    login = async (account?:string) => {\r\n        let retUser = await userApi.login({user: account || this.account, pwd: this.password, guest: nav.guest});\r\n        if (retUser === undefined) {\r\n            alert('something wrong!');\r\n            return;\r\n        }\r\n\t\tawait nav.userLogined(retUser);\r\n\t\t//await nav.start();\r\n\t\tif (this.isWebNav) nav.navigate('/');\r\n    }\r\n\r\n    async checkAccount():Promise<string> {\r\n        let ret = await userApi.isExists(this.account);\r\n        let error = this.accountError(ret);\r\n        if (error !== undefined) return error;\r\n        ret = await userApi.sendVerify(this.account, this.type, nav.oem);\r\n        this.toVerify();\r\n        return;\r\n    }\r\n\r\n    protected abstract accountError(isExists: number):string;\r\n\tabstract onPasswordSubmit(pwd:string):Promise<string>;\r\n}\r\n\r\nexport class CRegister extends CRegBase {\r\n\tprotected get VStart(): new(c:Controller) => VPage<any> {return VRegisterStart as any};\r\n\tprotected get VPassword(): new(c:Controller) => VPage<any> {return VRegisterPassword as any};\r\n\tprotected get VSuccess(): new(c:Controller) => VPage<any> {return VRegisterSuccess as any}\r\n    protected accountError(isExists: number) {\r\n        if (isExists > 0) return '';\r\n    }\r\n\r\n    async onPasswordSubmit(pwd:string):Promise<string> {\r\n\t\tthis.password = pwd;\r\n        let params: RegisterParameter = {\r\n            nick: undefined,\r\n            user: this.account, \r\n            pwd,\r\n            country: undefined,\r\n            mobile: undefined,\r\n            mobileCountry: undefined,\r\n            email: undefined,\r\n            verify: this.verify\r\n        }\r\n        switch (this.type) {\r\n            case 'mobile':\r\n                params.mobile = Number(this.account);\r\n                params.mobileCountry=86;\r\n                break;\r\n            case 'email':\r\n                params.email = this.account;\r\n                break;\r\n        }\r\n        let ret = await userApi.register(params);\r\n        if (ret === 0) {\r\n            nav.clear();\r\n            this.toSuccess();\r\n            return;\r\n        }\r\n        let error = this.regReturn(ret)\r\n        return error;\r\n\t}\r\n\t\r\n    private regReturn(registerReturn:number):string {\r\n        let msg:any;\r\n        switch (registerReturn) {\r\n            default: return '';\r\n            case 4: return '';\r\n            case 0: return;\r\n            case 1: msg = ' ' + this.account; break;\r\n            case 2: msg = ' +' + this.account; break;\r\n            case 3: msg = ' ' + this.account; break;\r\n        }\r\n        return msg + ' ';\r\n    }\r\n}\r\n\r\nexport class CForget extends CRegBase {\r\n\tprotected get VStart(): new(c:Controller) => VPage<any> {return VForgetStart as any};\r\n\tprotected get VPassword(): new(c:Controller) => VPage<any> {return VForgetPassword as any};\r\n\tprotected get VSuccess(): new(c:Controller) => VPage<any> {return VForgetSuccess as any}\r\n\tprotected accountError(isExists: number) {\r\n        if (isExists === 0) return '';\r\n    }\r\n    async onPasswordSubmit(pwd:string):Promise<string> {\r\n\t\tthis.password = pwd;\r\n\t\tlet ret = await userApi.resetPassword(this.account, this.password, this.verify, this.type);\r\n\t\tif (ret.length === 0) {\r\n\t\t\tlet err = 'something wrong in reseting password';\r\n\t\t\tconsole.log(err);\r\n\t\t\tthrow err;\r\n\t\t}\r\n        nav.clear();\r\n        this.toSuccess();\r\n        return;\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { User } from '../tool';\r\nimport { nav, Login } from '../components';\r\nimport { Controller, VPage } from \"../vm\";\r\nimport { VLogout } from './VLogout';\r\n//import { Login as LoginPage } from './login';\r\nimport { VLogin } from './VLogin';\r\nimport { CenterAppApi, userApi } from '../net';\r\nimport { VChangePassword } from './VChangePassword';\r\nimport { CRegister } from './register';\r\nimport { CForget } from './register';\r\n\r\nexport class CLogin extends Controller implements Login {\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\tasync showLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean):Promise<void> {\r\n\t\tlet onLogin = async (un:string, pwd:string):Promise<boolean> => {\r\n\t\t\tlet user = await userApi.login({\r\n\t\t\t\tuser: un,\r\n\t\t\t\tpwd: pwd,\r\n\t\t\t\tguest: nav.guest,\r\n\t\t\t});\r\n\t\r\n\t\t\tif (user === undefined) return false;\r\n\t\t\tconsole.log(\"onLoginSubmit: user=%s pwd:%s\", user.name, user.token);\r\n\t\t\tawait nav.userLogined(user, callback);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tthis.openVPage(VLogin, {onLogin, withBack});\r\n    }\r\n\r\n    async showLogout(callback?: ()=>Promise<void>) {\r\n\t\tthis.openVPage(VLogout, () => {\r\n\t\t\tnav.logout(callback);\r\n\t\t});\r\n\t}\r\n\r\n\tasync showRegister() {\r\n\t\tlet cRegister = new CRegister(this.res);\r\n\t\tawait cRegister.start();\r\n\t}\r\n\r\n\tasync showForget() {\r\n\t\tlet cForget = new CForget(this.res);\r\n\t\tawait cForget.start();\r\n\t}\r\n\r\n\tprotected getVChangePassword():new (cLogin:CLogin) => VPage<CLogin> {\r\n\t\treturn VChangePassword;\r\n\t}\r\n\tasync showChangePassword() {\r\n\t\tlet vPage = this.getVChangePassword();\r\n\t\tthis.openVPage(vPage, async (orgPassword:string, newPassword:string):Promise<boolean> => {\r\n\t\t\tlet centerAppApi = new CenterAppApi('tv/', undefined);\r\n\t\t\tlet ret = await centerAppApi.changePassword({orgPassword, newPassword});\r\n\t\t\treturn ret;\r\n\t\t});\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport interface InputOptions {\r\n\ttype: string;\r\n\tmin?: number;\r\n\tmax?: number;\r\n\tstep?: number;\r\n}\r\n\r\nexport class StringItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem {return this._uiItem as UiTextItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve, reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n\t}\r\n\t\r\n\tprotected inputOptions():InputOptions {\r\n\t\treturn {\r\n\t\t\ttype: 'text',\r\n\t\t}\r\n\t}\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n\t\tlet {resolve} = props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tlet val = this.newValue;\r\n\t\t\t\tresolve(val);\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}></button>;\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\t\tif (evt.keyCode === 13) onSave();\r\n\t\t}\r\n\t\tlet {type, max, min, step} = this.inputOptions();\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n\t\t\t\t<input type={type}\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\" \r\n                    defaultValue={this.value} min={min} max={max} step={step} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiRadio } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class RadioItemEdit extends ItemEdit {\r\n    get uiItem(): UiRadio {return this._uiItem as UiRadio}\r\n\r\n\tinit() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\r\n        }\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value: any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let {name} = this.itemSchema;\r\n        let {list} = this.uiItem;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (this.error === undefined) resolve(this.newValue);\r\n            }}></button>;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input name={name} type=\"radio\" value={value} \r\n                        onClick={()=>this.onChange(value)} \r\n                        defaultChecked={value === this.value} /> {title || value} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'' + this.label} right={right}>\r\n            <div className=\"m-3\">\r\n\t\t\t\t<div className=\"row row-cols-2 row-cols-sm-3 row-cols-md-4\">{content}</div>\r\n\t\t\t</div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiSelect } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class SelectItemEdit extends ItemEdit {\r\n    get uiItem(): UiSelect {return this._uiItem as UiSelect}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiIdItem } from '../schema';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class IdItemEdit extends ItemEdit {\r\n    get uiItem(): UiIdItem {return this._uiItem as UiIdItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            //let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            //nav.push(element,reject);\r\n\r\n            let {pickId} = this.uiItem;\r\n            if (pickId === undefined) {\r\n                alert('IdItemEdit.pickId = undefined');\r\n                return;\r\n            }\r\n            let boxId = await pickId(undefined, undefined, this.value);\r\n            //if (typeof id === 'object') {\r\n            //    id = (id as any).id;\r\n            //}\r\n            this.onChange(boxId.id);\r\n            resolve(boxId);\r\n            //this.newValue = id;\r\n        });\r\n    }\r\n\r\n    protected async internalEnd():Promise<void> {}\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        /*\r\n        let {resolve, reject} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n        */\r\n        return <Page header={'' + this.label}>\r\n            ddd\r\n        </Page>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiTag } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nabstract class TagItemEdit extends ItemEdit {\r\n\tprotected inputs: {[index:number]: HTMLInputElement} = {};\r\n\tprotected inputType: 'checkbox' | 'radio';\r\n    get uiItem(): UiTag {return this._uiItem as UiTag};\r\n\r\n\tinit() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\r\n        }\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n\t}\r\n\t\r\n\trenderContent() {\r\n\t\tlet valuesView = this.uiItem.valuesView;\r\n\t\tif (valuesView === undefined) return super.renderContent();\r\n\t\treturn valuesView.render(this.value);\r\n\t}\r\n\r\n\tprotected abstract renderInputs():JSX.Element;\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (this.error === undefined) resolve(this.newValue);\r\n\t\t\t}}></button>;\r\n\t\t/*\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {name:itemName, id} = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input ref={input=>this.inputs[id] = input} name={name} type={this.inputType} value={id} \r\n\t\t\t\t\t\tonClick={(e)=>this.onChange(e.currentTarget.checked, id)}\r\n                        defaultChecked={this.defaultChecked(id)} /> {itemName} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n\t\t\t<>no list defined</>;\r\n\t\t*/\r\n        return <Page header={'' + this.label} right={right}>\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t\t{this.renderInputs()}\r\n\t\t\t</div>\r\n        </Page>;\r\n    })\r\n}\r\n\r\nexport class TagSingleItemEdit extends TagItemEdit {\r\n\tprotected inputType:'radio'|'checkbox' = 'radio';\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet {currentTarget} = evt;\r\n\t\tif (currentTarget.checked === false) return;\r\n        this.newValue = Number(currentTarget.value);\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\t\r\n\tprotected renderInputs():JSX.Element {\r\n\t\tlet {valuesView} = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange,\r\n\t\t};\r\n\t\treturn valuesView.renderRadios(this.value, options);\r\n\t}\r\n}\r\n\r\nexport class TagMultiItemEdit extends TagItemEdit {\r\n\t//private arr:number[];\r\n\tprotected inputType:'radio'|'checkbox' = 'checkbox';\r\n\r\n\tprivate onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.newValue = values.join('|');\r\n        //this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\tprotected renderInputs():JSX.Element {\r\n\t\tlet {valuesView} = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t};\r\n\t\treturn valuesView.renderChecks(this.value, options);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class TextAreaItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem {return this._uiItem as UiTextItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve, reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n\t\tlet {resolve} = props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tlet val = this.newValue;\r\n\t\t\t\tresolve(val);\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}></button>;\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLTextAreaElement>) => {\r\n\t\t\t// if (evt.keyCode === 13) onSave();\r\n\t\t}\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <textarea\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\" \r\n\t\t\t\t\tdefaultValue={this.value}\r\n\t\t\t\t\trows={6} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import React from 'react';\r\nimport { UiCheckItem } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class CheckBoxItemEdit extends ItemEdit {\r\n\tprivate input: HTMLInputElement;\r\n    get uiItem(): UiCheckItem {return this._uiItem as UiCheckItem}\r\n\tget editInRow(): boolean {return true;}\r\n    protected async internalStart():Promise<any> {\r\n\t\tif (!this.input) return;\r\n\t\tlet uiItem = this.uiItem;\r\n\t\tif (uiItem === undefined) return this.input.checked;\r\n\t\tlet {checked} = this.input;\r\n\t\treturn this.getValue(checked);\r\n    }\r\n\tasync end():Promise<any> {}\r\n\trenderContent() {\r\n\t\tlet {readOnly} = this.uiItem;\r\n\t\tlet disabled = readOnly === true;\r\n\t\tlet onChange:any;\r\n\t\tif (readOnly !== true) onChange = this.onChange;\r\n\t\treturn <input ref={r => this.input=r} type=\"checkbox\" \r\n\t\t\tdefaultChecked={this.value} disabled={disabled}\r\n\t\t\tonChange={onChange} />\r\n\t}\r\n\r\n\tprivate getValue(checked: boolean) {\r\n\t\tlet {trueValue, falseValue} = this.uiItem;\r\n        return checked === true? (trueValue??true) : (falseValue??false);\r\n\t}\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = this.getValue(evt.target.checked);\r\n        let preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t\tthis.edit.onItemChanged(this, this.newValue);\r\n    }\r\n}\r\n","import { UiRange } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class RangeItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiRange).min\r\n\t\t\tmax = (this._uiItem as UiRange).max\r\n\t\t\tstep = (this._uiItem as UiRange).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'range',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import { UiNumberItem } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class NumberItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiNumberItem).min\r\n\t\t\tmax = (this._uiItem as UiNumberItem).max\r\n\t\t\tstep = (this._uiItem as UiNumberItem).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'number',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import * as React from 'react';\r\n//import _ from 'lodash';\r\nimport { observer } from 'mobx-react';\r\nimport { Schema, UiSchema, ItemSchema, UiItem, UiRadio, UiTagSingle, UiTagMulti } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { StringItemEdit } from './stringItemEdit';\r\nimport { ImageItemEdit } from './imageItemEdit';\r\nimport { RadioItemEdit } from './radioItemEdit';\r\nimport { SelectItemEdit } from './selectItemEdit';\r\nimport { IdItemEdit } from './idItemEdit';\r\nimport { TagSingleItemEdit, TagMultiItemEdit } from './tagItemEdit';\r\nimport { TextAreaItemEdit } from './textAreaItemEdit';\r\nimport { CheckBoxItemEdit } from './checkBoxItemEdit';\r\nimport { RangeItemEdit } from './rangeItemEdit';\r\nimport { NumberItemEdit } from './numberItemEdit';\r\n\r\nexport interface EditProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    data: any;\r\n    onItemClick?: (itemSchema: ItemSchema, uiItem: UiItem, value: any) => Promise<void>;\r\n    onItemChanged?: (itemSchema: ItemSchema, newValue:any, preValue:any) => Promise<void>;\r\n    stopEdit?: boolean;\r\n    uiSchema?: UiSchema;\r\n    sepClassName?: string;\r\n    topBorderClassName?: string;\r\n    bottomBorderClassName?: string;\r\n    rowContainerClassName?: string;\r\n}\r\n\r\n@observer\r\nexport class Edit extends React.Component<EditProps> {\r\n    private defaultSepClassName = 'border-top edit-sep-light-gray';\r\n    private defaultRowContainerClassName = 'd-flex px-3 py-2 bg-white align-items-center';\r\n    private topBorder:JSX.Element;\r\n    private bottomBorder:JSX.Element;\r\n    private rowContainerClassName?: string;\r\n    private sep:JSX.Element;\r\n\tprivate uiSchema: {[name:string]: UiItem};\r\n\r\n    constructor(props: EditProps) {\r\n        super(props);\r\n        let {topBorderClassName, bottomBorderClassName, sepClassName, rowContainerClassName, uiSchema} = props;\r\n        this.topBorder = <div className={topBorderClassName || this.defaultSepClassName} />;\r\n        this.bottomBorder = <div className={bottomBorderClassName || this.defaultSepClassName} />;\r\n        this.rowContainerClassName = rowContainerClassName || this.defaultRowContainerClassName;\r\n        //if (stopEdit !== true) this.rowContainerClassName += ' cursor-pointer';\r\n        this.sep = <div className={sepClassName || this.defaultSepClassName} />;\r\n\t\tthis.uiSchema = (uiSchema && uiSchema.items) || {};\r\n    }\r\n\r\n    render() {\r\n        let {schema} = this.props;\r\n\t\tlet sep:any;\r\n        return <div>\r\n\t\t\t{this.topBorder}\r\n            {schema.map((itemSchema, index) => {\r\n\t\t\t\tlet {stopEdit} = this.props;\r\n\t\t\t\tlet {name} = itemSchema;\r\n\t\t\t\tlet uiItem = this.uiSchema===undefined? undefined : this.uiSchema[name];\r\n\t\t\t\tlet label:string, labelHide:any;\r\n\t\t\t\tif (uiItem !== undefined) {\r\n\t\t\t\t\tlabel = uiItem.label || name;\r\n\t\t\t\t\tlabelHide = uiItem.labelHide;\r\n\t\t\t\t};\r\n\t\t\t\tlet value = this.props.data[name];\r\n\t\t\t\tlet itemEdit = createItemEdit(this, itemSchema, uiItem, label, value);\r\n\t\t\t\tlet rowContainerClassName = this.rowContainerClassName;\r\n\t\t\t\tlet {editInRow} = itemEdit;\r\n\t\t\t\tif (editInRow === false) {\r\n\t\t\t\t\tif (stopEdit !== true) editInRow = false;\r\n\t\t\t\t}\r\n\t\t\t\tif (editInRow === false) rowContainerClassName += ' cursor-pointer';\r\n\r\n\t\t\t\tlet {required} = itemSchema;\r\n\t\t\t\tlet requireFlag = required===true && <span className=\"text-danger\">*</span>;\r\n\t\t\t\tlet divLabel:any, cn:string = 'flex-fill d-flex ';\r\n\t\t\t\tif (labelHide === true) {\r\n\t\t\t\t\tdivLabel = undefined;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tdivLabel = <div>{label} {requireFlag}</div>;\r\n\t\t\t\t\tcn += 'justify-content-end';\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = <React.Fragment key={index}>\r\n\t\t\t\t\t{sep}\r\n\t\t\t\t\t<div className={'d-flex align-items-center' + rowContainerClassName} \r\n\t\t\t\t\t\tonClick={async ()=>await this.rowClick(itemEdit)}>\r\n\t\t\t\t\t\t{divLabel}\r\n\t\t\t\t\t\t<div className={cn}>{\r\n\t\t\t\t\t\t\titemEdit===undefined? undefined: itemEdit.renderContent()\r\n\t\t\t\t\t\t}</div>\r\n\t\t\t\t\t\t{editInRow === false && <div className=\"w-2c text-right\"><i className=\"fa fa-angle-right\" /></div>}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</React.Fragment>;\r\n\t\t\t\tsep = this.sep;\r\n\t\t\t\treturn ret;\r\n\t\t\t})}\r\n\t\t\t{this.bottomBorder}\r\n\t\t</div>;\r\n    }\r\n\r\n\tasync onItemChanged(itemEdit:ItemEdit, newValue:any) {\r\n\t\tlet {itemSchema, uiItem, value} = itemEdit;\r\n\t\tthis.props.data[itemSchema.name] = newValue;\r\n        let {onItemChanged, stopEdit} = this.props;\r\n\t\tif (stopEdit === true) return;\r\n\t\tif (uiItem?.readOnly === true) return;\r\n\t\tif (onItemChanged === undefined) {\r\n\t\t\talert(`${itemSchema.name} value changed, new: ${newValue}, pre: ${value}`);\r\n\t\t\t// 2020-04-15\r\n\t\t\t//this.props.data[itemSchema.name] = changeValue;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tawait onItemChanged(itemSchema, newValue, value);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate rowClick = async (itemEdit:ItemEdit) => {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\talert('item has no edit');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet {itemSchema, uiItem, value, editInRow} = itemEdit;\r\n\t\tif (editInRow === true) return;\r\n        let {onItemChanged, onItemClick, stopEdit} = this.props;\r\n\t\tif (stopEdit === true) return;\r\n\t\tif (uiItem?.readOnly === true) return;\r\n        let changeValue:any;\r\n        if (onItemClick !== undefined) {\r\n            await onItemClick(itemSchema, uiItem, value);\r\n            return;\r\n        }\r\n        //let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);\r\n        if (itemEdit === undefined) {\r\n            alert('undefined: let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);');\r\n            return;\r\n        }\r\n        try {\r\n            changeValue = await itemEdit.start();\r\n            if (changeValue !== value) {\r\n\t\t\t\t// 2020-04-15\r\n\t\t\t\tthis.props.data[itemSchema.name] = changeValue;\r\n                if (onItemChanged === undefined) {\r\n                    alert(`${itemSchema.name} value changed, new: ${changeValue}, pre: ${value}`);\r\n\t\t\t\t\t// 2020-04-15\r\n                    //this.props.data[itemSchema.name] = changeValue;\r\n                }\r\n                else {\r\n                    await onItemChanged(itemSchema, changeValue, value);\r\n                }\r\n            }\r\n            await itemEdit.end();\r\n        }\r\n        catch (err) {\r\n            // backreject\r\n\t\t\tconsole.log('no value changed');\r\n\t\t\tconsole.error(err);\r\n        }\r\n    }\r\n}\r\n\r\ntype NewItemEdit = new (edit: Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string, value: any) => ItemEdit;\r\n\r\nfunction createItemEdit(edit: Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string, value: any):ItemEdit {\r\n\tlet ie: ItemEdit;\r\n    let itemEdit: NewItemEdit;\r\n    if (uiItem !== undefined) {\r\n        switch (uiItem.widget) {\r\n            default: break;\r\n            case 'id': itemEdit = IdItemEdit; break;\r\n\t\t\tcase 'text': itemEdit = StringItemEdit; break;\r\n\t\t\tcase 'textarea': itemEdit = TextAreaItemEdit; break;\r\n            case 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\tcase 'select': itemEdit = SelectItemEdit; break;\r\n\t\t\tcase 'range': itemEdit = RangeItemEdit; break;\r\n\t\t\tcase 'number':\r\n\t\t\tcase 'updown': itemEdit = NumberItemEdit; break;\r\n\t\t\tcase 'checkbox': itemEdit = CheckBoxItemEdit; break;\r\n            case 'radio': \r\n\t\t\t\tie = new RadioItemEdit(edit, itemSchema, uiItem as UiRadio, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagSingle':\r\n\t\t\t\tie = new TagSingleItemEdit(edit, itemSchema, uiItem as UiTagSingle, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagMulti':\r\n\t\t\t\tie = new TagMultiItemEdit(edit, itemSchema, uiItem as UiTagMulti, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t}\r\n\tif (ie === undefined) {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\tswitch (itemSchema.type) {\r\n\t\t\t\tcase 'string': itemEdit = StringItemEdit; break;\r\n\t\t\t\tcase 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\t\tcase 'boolean': itemEdit = CheckBoxItemEdit; break;\r\n\t\t\t\tcase 'number':\r\n\t\t\t\tcase 'integer': itemEdit = RangeItemEdit; break;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (itemEdit === undefined) return;\r\n\t\tie = new itemEdit(edit, itemSchema, uiItem, label, value);\r\n\t}\r\n\tie.init();\r\n\treturn ie;\r\n}\r\n","import {CenterApiBase} from '../net';\r\n\r\nexport class CenterApi extends CenterApiBase {\r\n    async userAppUnits(app:number):Promise<any[]> {\r\n        return await this.get('tie/user-app-units', {app:app});\r\n    }\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await this.get('user/user-name-nick-icon-from-id', {userId:userId});\r\n\t}\r\n\tasync userFromKey(userName:string):Promise<any> {\r\n\t\treturn await this.get('tie/user-from-key', {key:userName});\r\n\t}\r\n}\r\n\r\nexport const centerApi = new CenterApi('tv/', undefined);\r\n","import * as React from 'react';\r\nimport { Page, FA, nav, LMR, List } from \"../components\";\r\nimport { VPage } from '../vm';\r\nimport { appInFrame } from '../net';\r\nimport { CAppBase } from \"./CAppBase\";\r\nimport { UQsMan } from '../uq';\r\n\r\n/*\r\nexport class VAppMain extends VPage<CMainBase> {\r\n    async open(param?:any) {\r\n        this.openPage(this.appPage);\r\n    }\r\n\r\n    render(param?:any) {\r\n        return this.appContent();\r\n    }\r\n\r\n    protected appPage = () => {\r\n        let {caption} = this.controller;\r\n        return <Page header={caption} logout={async()=>{appInFrame.unit = undefined}}>\r\n            {this.appContent()}\r\n        </Page>;\r\n    }\r\n\r\n    protected appContent = () => {\r\n        let {cUqArr} = this.controller;\r\n        let content:any;\r\n        if (cUqArr.length === 0) {\r\n            content = <div className=\"text-danger\">\r\n                <FA name=\"\" /> APPUQ\r\n            </div>;\r\n        }\r\n        else {\r\n            content = cUqArr.map((v,i) => <div key={i}>{v.render()}</div>);\r\n        }\r\n        return <>{content}</>;\r\n    };\r\n}\r\n*/\r\nexport class VUnsupportedUnit extends VPage<CAppBase> {\r\n    async open(predefinedUnit: number) {\r\n        this.openPage(this.page, {predefinedUnit:predefinedUnit});\r\n    }\r\n\r\n    private page = ({predefinedUnit}:{predefinedUnit: number}) => {\r\n        let {user} = nav;\r\n        let userName:string = user? user.name : '[]';\r\n        let {appOwner, appName} = UQsMan.value;\r\n        return <Page header=\"APP\" logout={true}>\r\n            <div className=\"m-3 text-danger container\">\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\"></div>\r\n                    <div className=\"col-sm text-body\">{userName}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">App</div>\r\n                    <div className=\"col-sm text-body\">{`${appOwner}/${appName}`}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\"></div>\r\n                    <div className=\"col-sm text-body\">{predefinedUnit || <small className=\"\">[]</small>}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">\r\n                        <FA name=\"exclamation-triangle\" />\r\n                    </div>\r\n                    <div className=\"col-sm text-body\">\r\n                        <ul className=\"p-0\">\r\n                            <li> {appName}</li>\r\n                            <li> <b>{userName}</b> {appName}</li>\r\n                            {\r\n                                predefinedUnit && \r\n                                <li> <b>{predefinedUnit}</b> App {appName}</li>\r\n                            }\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">{predefinedUnit}</div>\r\n                    <div className=\"col-sm text-body\">\r\n                         public/unit.json \r\n                        url\r\n                        applocalStorage<br/>\r\n                        Unitlogoutlogin\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class VUnitSelect extends VPage<CAppBase> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderRow = (item: any, index: number):JSX.Element => {\r\n        let {id, nick, name} = item;\r\n        return <LMR className=\"px-3 py-2\" right={'id: ' + id}>\r\n            <div>{nick || name}</div>\r\n        </LMR>;\r\n    }\r\n    private onRowClick = async (appUnit: any) => {\r\n\t\tappInFrame.unit = appUnit.id; // 25;\r\n\t\tthis.controller.setAppUnit(appUnit);\r\n        await this.controller.start();\r\n    }\r\n\r\n    private page = () => {\r\n        return <Page header=\"\" logout={true}>\r\n            <List items={this.controller.appUnits} item={{render: this.renderRow, onClick: this.onRowClick}}/>\r\n        </Page>\r\n    }\r\n}\r\n\r\nexport class VErrorsPage extends VPage<CAppBase> {\r\n    async open(errors:string[]) {\r\n        this.openPage(this.page, {errors:errors});\r\n    }\r\n\r\n    private page = (errors:{errors:string[]}) => {\r\n        return <Page header=\"ERROR\">\r\n            <div className=\"m-3\">\r\n\t\t\t\t<div className=\"p-3 d-flex justify-content-center align-items-center\">\r\n\t\t\t\t\t<button className=\"btn btn-danger\" onClick={nav.resetAll}></button>\r\n\t\t\t\t</div>\r\n\r\n                <div>Load Uqs </div>\r\n                {errors.errors.map((r, i) => <div key={i}>{r}</div>)}\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class VStartError extends VPage<CAppBase> {\r\n    async open(error:any) {\r\n        this.openPage(this.page, {error:error});\r\n    }\r\n\r\n    private page = ({error}:{error:any}) => {\r\n        return <Page header=\"App start error!\">\r\n            <pre>\r\n                {typeof error === 'string'? error : error.message}\r\n            </pre>\r\n        </Page>;\r\n    }\r\n}","import { nav, t, setGlobalRes, RouteFunc, Hooks, Navigo, NamedRoute } from \"../components\";\r\nimport { Controller } from '../vm';\r\nimport { UQsMan, TVs } from \"../uq\";\r\nimport { appInFrame } from \"../net\";\r\nimport { centerApi } from \"./centerApi\";\r\nimport { VUnitSelect, VErrorsPage, VStartError, VUnsupportedUnit } from \"./vMain\";\r\n\r\nexport interface IConstructor<T> {\r\n    new (...args: any[]): T;\r\n}\r\n\r\nexport interface AppConfig {\r\n    appName: string;        // : owner/appName\r\n    version: string;        // uqs\r\n    tvs: TVs;\r\n    uqNameMap?: {[uqName:string]: string};      // uqName='owner/uq' uq, \r\n    loginTop?: JSX.Element;\r\n    oem?: string;               // oem\r\n\tprivacy?: string;\r\n\tnoUnit?: boolean;\t\t\t// appunit\r\n\thtmlTitle?: string;\r\n}\r\n\r\nexport interface Elements {\r\n\t[id:string]: (element: HTMLElement)=>void,\r\n}\r\n\r\nexport abstract class CAppBase extends Controller {\r\n\tprivate appConfig: AppConfig;\r\n    protected _uqs: any;\r\n\r\n    protected readonly name: string;\r\n\tprotected readonly noUnit: boolean;\r\n\r\n    appUnits:any[];\r\n\r\n    constructor(config?: AppConfig) {\r\n\t\tsuper(undefined);\r\n\t\tthis.appConfig = config || (nav.navSettings as AppConfig);\r\n\t\tif (this.appConfig) {\r\n\t\t\tlet {appName, noUnit} = this.appConfig;\r\n\t\t\tthis.name = appName;\r\n\t\t\tif (appName === undefined) {\r\n\t\t\t\tthrow new Error('appName like \"owner/app\" must be defined in MainConfig');\r\n\t\t\t}\r\n\t\t\tthis.noUnit = noUnit;\r\n\t\t}\r\n    }\r\n\r\n    get uqs(): any {return this._uqs;}\r\n\r\n\tinternalT(str:string):any {\r\n\t\treturn t(str);\r\n\t}\r\n\t\r\n\tprotected setRes(res:any) {\r\n\t\tsetGlobalRes(res);\r\n\t}\r\n\r\n\tprivate appUnit:any;\r\n\tprivate roleDefines: string[];\r\n\thasRole(role: string|number):boolean {\r\n\t\tlet nRole:number;\r\n\t\tif (typeof role === 'string') {\r\n\t\t\tif (role.length === 0) return false;\r\n\t\t\tlet index = this.roleDefines.findIndex(v => v === role);\r\n\t\t\tif (index < 0) return false;\r\n\t\t\tnRole = 1<<index;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tnRole = role;\r\n\t\t}\r\n\t\treturn (this.appUnit.roles & nRole) !== 0;\r\n\t}\r\n\r\n\tsetAppUnit(appUnit:any) {\r\n\t\tthis.appUnit = appUnit;\r\n\t\tlet {roleDefs} = appUnit;\r\n\t\tif (roleDefs) {\r\n\t\t\tthis.roleDefines = roleDefs.split('\\t');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.roleDefines = [];\r\n\t\t}\r\n}\r\n\t\r\n    protected async beforeStart():Promise<boolean> {\r\n        try {\r\n\t\t\tthis.onNavRoutes();\r\n\t\t\tif (!this.appConfig) return true;\r\n\t\t\tlet {appName, version, tvs} = this.appConfig;\r\n\t\t\tawait UQsMan.load(appName, version, tvs);\r\n\t\t\tthis._uqs = UQsMan._uqs;\t\t\t\r\n            //let retErrors = await this.load();\r\n            //let app = await loadAppUqs(this.appOwner, this.appName);\r\n            // if (isDevelopment === true) {\r\n\t\t\t// production\r\n\t\t\tlet retErrors = UQsMan.errors;\r\n            let {predefinedUnit} = appInFrame;\r\n            let {user} = nav;\r\n            if (user !== undefined && user.id > 0) {\r\n\t\t\t\tlet result = await centerApi.userAppUnits(UQsMan.value.id);\r\n\t\t\t\tthis.appUnits = result;\r\n\t\t\t\t/*\r\n\t\t\t\t// \r\n\t\t\t\tif (result.length === 0) {\r\n\t\t\t\t\tthis.appUnits = result;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (Array.isArray(result[0]) === true) {\r\n\t\t\t\t\t\tthis.appUnits = result[0];\r\n\t\t\t\t\t\tlet result1 = result[1];\r\n\t\t\t\t\t\tif (Array.isArray(result1) === true) {\r\n\t\t\t\t\t\t\tthis.roleDefines = result1[0]?.roles?.split('\\t');\r\n\t\t\t\t\t\t\tif (this.roleDefines === undefined) this.roleDefines = [];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.appUnits = result;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\tif (this.noUnit === true) return true;\r\n                switch (this.appUnits.length) {\r\n                    case 0:\r\n                        this.showUnsupport(predefinedUnit);\r\n\t\t\t\t\t\treturn false;\r\n                    case 1:\r\n\t\t\t\t\t\tlet appUnit = this.appUnits[0];\r\n\t\t\t\t\t\tthis.setAppUnit(appUnit);\r\n\t\t\t\t\t\tlet {id} = appUnit;\r\n                        let appUnitId = id;\r\n                        if (appUnitId === undefined || appUnitId < 0 || \r\n                            (predefinedUnit !== undefined && appUnitId !== predefinedUnit))\r\n                        {\r\n                            this.showUnsupport(predefinedUnit);\r\n                            return false;\r\n                        }\r\n                        appInFrame.unit = appUnitId;\r\n                        break;\r\n                    default:\r\n                        if (predefinedUnit>0 && this.appUnits.find(v => v.id===predefinedUnit) !== undefined) {\r\n                            appInFrame.unit = predefinedUnit;\r\n                            break;\r\n                        }\r\n                        this.openVPage(VUnitSelect);\r\n                        return false;\r\n                }\r\n            }\r\n            if (retErrors !== undefined) {\r\n                this.openVPage(VErrorsPage, retErrors);\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n        catch (err) {\r\n            this.openVPage(VStartError, err);\r\n            return false;\r\n        }\r\n    }\r\n\tprotected async afterStart():Promise<void> {\r\n\t\tnav.resolveRoute();\r\n\t}\r\n\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await centerApi.userFromId(userId);\r\n    }\r\n\r\n\tprotected on(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\tprotected on(...args:any[]):Navigo {\r\n\t\treturn nav.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tprotected onNavRoutes() {return;}\r\n\r\n    private showUnsupport(predefinedUnit: number) {\r\n        nav.clear();\r\n        this.openVPage(VUnsupportedUnit, predefinedUnit);\r\n    }\r\n}\r\n","import { AppConfig, CAppBase } from './CAppBase';\r\n\r\nexport async function start(CApp: new (config: AppConfig) => CAppBase, appConfig: AppConfig, isUserLogin?:boolean) {\r\n\tif (appConfig) {\r\n\t\tlet {htmlTitle} = appConfig;\r\n\t\tif (htmlTitle) {\r\n\t\t\tdocument.title = htmlTitle;\r\n\t\t}\r\n\t\tlet html = document.getElementsByTagName('html');\r\n\t\tlet html0 = html[0];\r\n\t\tif (html0) {\r\n\t\t\tlet version = html0?.getAttribute('data-version');\r\n\t\t\tif (version) appConfig.version = version;\r\n\t\t}\r\n\t}\r\n\r\n\tlet cApp = new CApp(appConfig);\r\n    await cApp.start(isUserLogin);\r\n}\r\n","import _ from 'lodash';\r\nimport { Controller, WebNav } from \"../vm\";\r\nimport { IConstructor } from \"./CAppBase\";\r\n\r\nexport abstract class CBase extends Controller {\r\n    protected readonly _uqs: any;\r\n    protected readonly _cApp: any;\r\n\r\n    constructor(cApp: any) {\r\n        super(cApp.res);\r\n        this._cApp = cApp;\r\n        this._uqs = cApp && cApp.uqs;\r\n\t}\r\n\r\n    protected get uqs(): any {return this._uqs}\r\n\tget cApp(): any {return this._cApp}\r\n\thasRole(role:string|number):boolean {\r\n\t\treturn this._cApp?.hasRole(role);\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._cApp.internalT(str);\r\n\t}\r\n\r\n    protected newC<T extends CBase>(type: IConstructor<T>, param?:any):T {\r\n\t\tlet c = new type(this.cApp);\r\n\t\tc.init(param);\r\n\t\treturn c;\r\n    }\r\n\r\n    protected newSub<O extends CBase, T extends CSub<O>>(type: IConstructor<T>, param?:any):T {\r\n\t\tlet s = new type(this);\r\n\t\ts.init(param);\r\n\t\treturn s;\r\n\t}\r\n\t\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this._cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ret = _.clone(wn);\r\n\t\t_.merge(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nexport abstract class CSub<T extends CBase> extends CBase {\r\n    protected _owner: T;\r\n\r\n    constructor(owner: T) {\r\n        super(owner.cApp);\r\n        this._owner = owner;\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._owner.internalT(str);\r\n\t}\r\n\r\n    protected get owner(): CBase {return this._owner}\r\n\t\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this._cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ownerWNs:WebNav<any>[] = [];\r\n\t\tfor (let p = this.owner; p!==undefined; p = (p as any)?.owner) {\r\n\t\t\townerWNs.push(p.webNav);\r\n\t\t}\r\n\t\tlet ret = _.clone(wn);\r\n\t\tfor (;;) {\r\n\t\t\tlet own = ownerWNs.pop();\r\n\t\t\tif (own === undefined) break;\r\n\t\t\t_.merge(ret, own);\r\n\t\t}\r\n\t\t_.merge(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { IObservableArray, computed } from 'mobx';\r\nimport { PageItems } from '../../tool/pageItems';\r\nimport {List} from './index';\r\n\r\nexport abstract class ListBase {\r\n    protected list: List;\r\n    constructor(list: List) {\r\n        this.list = list;\r\n    }\r\n    get isPaged():boolean {\r\n        let items = this.list.props.items;\r\n        return (items !== null && items !== undefined && Array.isArray(items) === false);\r\n    }\r\n    get items():any[]|IObservableArray<any> {\r\n        let items = this.list.props.items;\r\n        if (items === null) return null;\r\n        if (items === undefined) return undefined;\r\n        if (Array.isArray(items) === true)\r\n            return items as IObservableArray<any>;\r\n        else\r\n            return (items as PageItems<any>).items;\r\n    }\r\n    @computed get loading():boolean {\r\n        let items = this.list.props.items;\r\n        if (items === null) return false;\r\n        if (items === undefined) return true;\r\n        let pageItems = items as PageItems<any>;\r\n        if (pageItems.items === undefined) return false;\r\n        return pageItems.loading;\r\n    }\r\n    get selectedItems():any[] { return undefined; }\r\n    //updateProps(nextProps:any) {}\r\n    dispose() {};\r\n    abstract render: (item:any, index:number) => JSX.Element;\r\n    protected renderContent(item:any, index:number) {\r\n        let {render} = this.list.props.item;\r\n        if (render === undefined) return <div className=\"px-3 py-2\">{JSON.stringify(item)}</div>;\r\n        return render(item, index);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\n\r\nexport class Clickable extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key, onClick} = this.list.props.item;\r\n        return <li key={key===undefined?index:key(item)} className={classNames('va-row-clickable', className)} onClick={()=>onClick && onClick(item)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { ListBase } from './base';\r\nimport { uid } from '../../tool/uid';\r\n\r\nexport class Static extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key} = this.list.props.item;\r\n        if (typeof item === 'string') {\r\n            let cn = classNames('va-list-gap', 'px-3', 'pt-1');\r\n            return <li key={uid()} className={cn}>{item}</li>;\r\n        }\r\n        return <li key={key===undefined?index:key(item)} className={classNames(className)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observable, IObservableArray, isObservableArray, observe} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\nimport {uid} from '../../tool/uid';\r\nimport { PageItems } from '../../tool/pageItems';\r\nimport { List } from './index';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport interface SelectableItem {\r\n    selected: boolean;\r\n    item: any;\r\n    labelId: string;\r\n}\r\n\r\nexport class Selectable extends ListBase {\r\n    @observable private _items: SelectableItem[];\r\n    private inputItems:{[uid:string]: HTMLInputElement} = {};\r\n\r\n    constructor(list: List) {\r\n        super(list);\r\n        this.buildItems();\r\n        this.listenArraySplice();\r\n    }    \r\n\r\n    private listenArraySplice() {\r\n        let {items} = this.list.props;\r\n        if (items === undefined) return;\r\n        if (items === null) return;\r\n        let itemsArray:any;\r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as PageItems<any>).items;\r\n        }\r\n        if (isObservableArray(items) === true) {\r\n            observe(itemsArray as IObservableArray<any>, (change) => {                \r\n                if (change.type === 'splice') {\r\n                    let {index, removedCount, added} = change;\r\n                    let _added = added && added.map(v => {\r\n                        return {\r\n                            selected: false, \r\n                            item: v, \r\n                            labelId:uid()\r\n                        }\r\n                    });\r\n                    this._items.splice(index, removedCount, ..._added);\r\n                    this.buildItems();\r\n                }\r\n            }, true);\r\n        }\r\n    }\r\n\r\n    private buildItems = () => {\r\n        let {items, isItemSelected, selectedItems, compare} = this.list.props;\r\n        let itemsArray:any[] | IObservableArray<any>;\r\n        if (items === undefined) {\r\n            this._items = undefined;\r\n            return;\r\n        }\r\n        if (items === null) {\r\n            this._items = null;\r\n            return;\r\n        }\r\n        \r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as PageItems<any>).items;\r\n        }\r\n\r\n\t\tif (isItemSelected) {\r\n\t\t\tlet retItems = itemsArray.map(v => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tselected: isItemSelected(v),\r\n\t\t\t\t\titem: v, \r\n\t\t\t\t\tlabelId:uid()\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tthis._items = retItems;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet comp: ((item:any, selectItem:any)=>boolean);\r\n\t\t\tif (compare === undefined) {\r\n\t\t\t\tcomp = (item:any, selectItem:any) => item === selectItem;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcomp = compare;\r\n\t\t\t}\r\n\t\t\tlet retItems = itemsArray.map(v => {\r\n\t\t\t\t//let isObserved = isObservable(v);\r\n\t\t\t\t//let obj = isObserved === true? toJS(v) : v;\r\n\t\t\t\t//let obj = v;\r\n\t\t\t\tlet selected = selectedItems === undefined?\r\n\t\t\t\t\tfalse\r\n\t\t\t\t\t: selectedItems.find(si => comp(v, si)) !== undefined;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tselected: selected, \r\n\t\t\t\t\titem: v, \r\n\t\t\t\t\tlabelId:uid()\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tthis._items = retItems;\r\n\t\t}\r\n    }\r\n\r\n    get items() {\r\n        //if (this._items === undefined) \r\n        //this.buildItems();\r\n        return this._items;\r\n    }\r\n    private checkAll(on: boolean) {\r\n        for (let i in this.inputItems) this.inputItems[i].checked = on;\r\n        for (let item of this._items) item.selected = on;\r\n    }\r\n    selectAll() {\r\n        //if (this._items) this._items.forEach(v => v.selected = true);\r\n        this.checkAll(true);\r\n        this.list.props.item.onSelect(undefined, true, this.anySelected);\r\n    }\r\n    unselectAll() {\r\n        // if (this._items) this._items.forEach(v => v.selected = false);\r\n        this.checkAll(false);\r\n        this.list.props.item.onSelect(undefined, false, this.anySelected);\r\n    }\r\n    /*\r\n    updateProps(nextProps:any) {\r\n        if (nextProps.selectedItems === this._selectedItems) return;\r\n        this.buildItems();\r\n    }\r\n    */\r\n    private get anySelected():boolean {return this._items.some(v => v.selected)}\r\n    private onSelect(item:SelectableItem, selected:boolean) {\r\n        item.selected = selected;\r\n        this.list.props.item.onSelect(item.item, selected, this.anySelected);\r\n    }\r\n    \r\n    get selectedItems():any[] {\r\n        return this._items.filter(v => v.selected === true).map(v => v.item);\r\n    }\r\n    /*\r\n    set selectedItems(value: any[]) {\r\n        if (value === undefined) return;\r\n        if (this._items === undefined) return;\r\n        let sLen = this._items.length;\r\n        let list = value.slice();\r\n        for (let n=0; n<sLen; n++) {\r\n            let sItem = this._items[n];\r\n            let len = list.length;\r\n            if (len === 0) break;\r\n            let item = sItem.item;\r\n            for (let i=0; i<len; i++) {\r\n                let v = list[i];\r\n                if (item === v) {\r\n                    sItem.selected = true;\r\n                    value.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        };\r\n    }\r\n    */\r\n    //w-100 mb-0 pl-3\r\n    //m-0 w-100\r\n    render = (item:SelectableItem, index:number):JSX.Element => {\r\n        let {key} = this.list.props.item;\r\n\t\treturn React.createElement(this.row, {item, index, key:key===undefined?index:key(item)});\r\n    }\r\n\r\n    private row = observer((props: {item:SelectableItem, index:number}):JSX.Element => {\r\n        let {item, index} = props;\r\n        let {className} = this.list.props.item;\r\n        let {labelId, selected, item:obItem} = item;\r\n        return <li className={classNames(className)}>\r\n            <div className=\"d-flex align-items-center px-3\">\r\n                <input ref={input=>{if (input) this.inputItems[labelId] = input;}}\r\n                    className=\"\" type=\"checkbox\" value=\"\" id={labelId}\r\n                    defaultChecked={selected}\r\n                    onChange={(e)=>{\r\n                        this.onSelect(item, e.target.checked)} \r\n                    }/>\r\n                <label className=\"\" style={{flex:1, marginBottom:0}} htmlFor={labelId}>\r\n                    {this.renderContent(obItem, index)}\r\n                </label>\r\n            </div>\r\n        </li>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport _ from 'lodash';\r\nimport {PageItems} from '../../tool/pageItems';\r\nimport {ListBase} from './base';\r\nimport {Clickable} from './clickable';\r\nimport {Static} from './static';\r\nimport {Selectable} from './selectable';\r\nimport '../../css/va-list.css';\r\nimport { IObservableArray } from 'mobx';\r\nimport { resLang } from '../../res/res';\r\nimport { ListRes, listRes } from '../../res';\r\n\r\ntype StaticRow = string|JSX.Element|(()=>string|JSX.Element);\r\ninterface ItemProps {\r\n\tclassName?: string|string[];\r\n\trender?: (item:any, index:number) => JSX.Element;\r\n\tonSelect?: (item:any, isSelected:boolean, anySelected:boolean)=>void;\r\n\tonClick?: (item:any)=>void;\r\n\tkey?: (item:any)=>string|number;\r\n}\r\n\r\nexport interface ListProps {\r\n    className?: string|string[];\r\n    items: any[] | IObservableArray<any> | PageItems<any>;\r\n    item: ItemProps;\r\n\tisItemSelected?: (item:any) => boolean;\r\n    compare?: (item:any, selectItem:any) => boolean;\r\n\tselectedItems?:any[];\r\n    header?: StaticRow;\r\n    footer?: StaticRow;\r\n    before?: StaticRow;\r\n    loading?: StaticRow;\r\n\tnone?: StaticRow;\r\n\tonFocus?: (evt: React.FocusEvent<HTMLUListElement>)=>void;\r\n}\r\n\r\n@observer\r\nexport class List extends React.Component<ListProps> {\r\n\tprivate static res:ListRes = resLang<ListRes>(listRes);\r\n\r\n\tprivate listBase: ListBase;\r\n\tprivate selectable: Selectable;\r\n    constructor(props:ListProps) {\r\n\t\tsuper(props);\r\n        this.buildBase();\r\n    }\r\n    _$scroll = (direct: 'top'|'bottom') => {\r\n        console.log('############### items scroll to ' + direct);\r\n    }\r\n    private buildBase() {\r\n        let {item} = this.props;\r\n        let {onClick, onSelect} = item;\r\n        if (onSelect !== undefined)\r\n            this.selectable = this.listBase = new Selectable(this);\r\n        else if (onClick !== undefined)\r\n            this.listBase = new Clickable(this);\r\n        else\r\n            this.listBase = new Static(this);\r\n\t}\r\n\tcomponentDidUpdate(prevProps: Readonly<ListProps>, prevState: Readonly<any>) {\r\n\t\tif (_.isEqual(this.props.item, prevProps.item) === false) {\r\n\t\t\tthis.buildBase();\r\n\t\t\tthis.forceUpdate();\r\n\t\t}\r\n\t}\r\n    componentWillUnmount() {\r\n        this.listBase.dispose();\r\n    }\r\n    selectAll() {\r\n        if (this.selectable) this.selectable.selectAll();\r\n    }\r\n    unselectAll() {\r\n        if (this.selectable) this.selectable.unselectAll();\r\n    }\r\n    get selectedItems():any[] {\r\n        return this.listBase.selectedItems;\r\n    }\r\n    render() {\r\n        let {className, header, footer, before, loading, none, onFocus} = this.props;\r\n        if (before === undefined) before = '-';\r\n        if (loading === undefined) loading = () => <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />;\r\n        if (none === undefined) none = List.res.none;\r\n        //this.listBase.selectedItems = selectedItems;\r\n        let {items, loading:isLoading} = this.listBase;\r\n        function staticRow(row:StaticRow, type:string) {\r\n            if (!row) return;\r\n            switch (typeof row) {\r\n                default:\r\n                case 'string': return <li className={\"va-list-\"+type}>{row}</li>;\r\n                case 'function': return <li className={\"va-list-\"+type}>{(row as ()=>string|JSX.Element)()}</li>;\r\n                case 'object': return <li>{row}</li>\r\n            } \r\n        }\r\n        let content:any, waitingMore:any;\r\n        if (items === null)\r\n            content = staticRow(before, 'before');\r\n        else if (items === undefined)\r\n            content = staticRow(loading, 'loading');\r\n        else if (items.length === 0)\r\n            content = staticRow(none, 'none');\r\n        else {\r\n            content = items.map((item, index) => {\r\n                return this.listBase.render(item, index);\r\n            });\r\n        }\r\n        if (isLoading === true && items) {\r\n            waitingMore = staticRow(loading, 'loading');\r\n\t\t}\r\n\t\tlet tabIndex:number;\r\n\t\tif (onFocus !== undefined) tabIndex = -1;\r\n        return <ul className={classNames('va-list', className)} onFocus={onFocus} tabIndex={tabIndex}>\r\n            {staticRow(header, 'header')}\r\n            {content}\r\n            {waitingMore}\r\n            {staticRow(footer, 'footer')}\r\n        </ul>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport className from 'classnames';\r\nimport {PropGridProps} from './PropGrid';\r\nimport {LabeledProp, StringProp, NumberProp, ListProp, ComponentProp} from './propView';\r\n\r\nexport abstract class PropRow {\r\n    setValues(values: any) {}\r\n    abstract render(key:string): any;\r\n}\r\n\r\nexport class PropBorder extends PropRow {\r\n    render(key:string): JSX.Element {\r\n        return <div key={'_b_' + key} className=\"\">\r\n            <div className=\"w-100\">\r\n                <div style={{borderTop: '1px solid #f0f0f0'}} />\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class PropGap extends PropRow {\r\n    private param: string;\r\n    constructor(param?: string) {\r\n        super();\r\n        this.param = param;\r\n    }\r\n    render(key:string): JSX.Element {\r\n        let w: string;\r\n        switch (this.param) {\r\n            default: w = 'py-2'; break;\r\n            case '=': w = 'py-1'; break;\r\n            case '-': w = 'pb-1'; break;\r\n        }\r\n        let cn = className(w);\r\n        return <div key={'_g_' + key} className={cn} />;\r\n    }\r\n}\r\n\r\nconst valueAlignStart = 'justify-content-start';\r\nconst valueAlignCenter = 'justify-content-center';\r\nconst valueAlignEnd = 'justify-content-end';\r\nexport abstract class LabeledPropRow extends PropRow {\r\n    protected gridProps: PropGridProps;\r\n    protected _prop: LabeledProp;\r\n    protected get prop():LabeledProp {return this._prop}\r\n    protected content: any;\r\n    protected col: string;\r\n    //protected values: any;\r\n    constructor(gridProps:PropGridProps, prop: LabeledProp) {\r\n        super();\r\n        this.gridProps = gridProps;\r\n        this._prop = prop;\r\n        this.col = gridProps.labelFixLeft === true? 'col' : 'col-sm';\r\n        //this.values = values;\r\n    }\r\n    render(key:string):any {\r\n        let {onClick, bk} = this.prop;\r\n        let cn = className({\r\n            \"cursor-pointer\": onClick !== undefined,\r\n            \"bg-white\": bk === undefined, \r\n            \"row\": true\r\n        });\r\n        return <div key={key} className={cn} onClick={onClick}>\r\n            {this.renderLabel()}\r\n            {this.renderProp()}\r\n        </div>;\r\n    }\r\n    protected renderLabel():any {\r\n        let {label} = this.prop;\r\n        if (label === undefined) return null;\r\n        return <label className={this.col + '-3 col-form-label'}>\r\n            {label}\r\n        </label>;\r\n    }\r\n    protected renderProp():any {\r\n        let {label} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string = this.col + (label===undefined? '-12':'-9');\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n    protected renderPropBody():any {\r\n        return <div className=\"form-control-plaintext\">\r\n            {this.renderPropContent()}\r\n        </div>;\r\n    }\r\n    protected renderPropContent():any {\r\n        return this.content;\r\n    }\r\n}\r\n\r\nexport class StringPropRow extends LabeledPropRow {\r\n    protected get prop(): StringProp {return this._prop as StringProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class NumberPropRow extends LabeledPropRow {\r\n    protected get prop(): NumberProp {return this._prop as NumberProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class ListPropRow extends LabeledPropRow {\r\n    protected get prop(): ListProp {return this._prop as ListProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else {\r\n            let list = this.prop.list;\r\n            if (typeof list === 'string') this.content = values[list];\r\n            else this.content = undefined;\r\n        }\r\n    }\r\n    protected renderPropBody() {\r\n        let {list, row} = this.prop;\r\n        let items:any[] = typeof list === 'string'? this.content : list;\r\n        if (items === undefined) return <div/>;\r\n        // new row(item)\r\n        return <div className=\"w-100\">\r\n            {\r\n                items.map((item, index) => <React.Fragment key={index}>\r\n                    {index===0? null: <div style={{width:'100%', borderBottom:'1px solid #f0f0f0'}} />}\r\n                    {React.createElement(row, item)}\r\n                </React.Fragment>)\r\n            }\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class ComponentPropRow extends LabeledPropRow {\r\n    protected get prop(): ComponentProp {return this._prop as ComponentProp;}\r\n    protected renderPropBody() {\r\n        let {component} = this.prop;\r\n        return component;\r\n    }\r\n    protected renderProp():any {\r\n        let {label, full} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string;\r\n        if (full !== true)\r\n            col = this.col + (label===undefined? '-12':'-9');\r\n        else\r\n            col = 'w-100';\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n}\r\n","import { PropGridProps } from './PropGrid';\r\nimport {\r\n    PropRow, PropBorder, PropGap, \r\n    StringPropRow, NumberPropRow, ListPropRow, ComponentPropRow\r\n} from './row';\r\n\r\nexport interface Format {\r\n\r\n}\r\n\r\nexport interface PropBase {\r\n    onClick?: () => void;\r\n}\r\n\r\nexport interface LabeledProp extends PropBase {\r\n    label?: string;\r\n    bk?: string;\r\n    vAlign?: 'top' | 'bottom' | 'center' | 'stretch';\r\n}\r\n\r\nexport interface StringProp extends LabeledProp {\r\n    type: 'string';\r\n    name: string;\r\n}\r\n\r\nexport interface NumberProp extends LabeledProp {\r\n    type: 'number';\r\n    name: string;\r\n}\r\n\r\nexport interface FormatProp extends LabeledProp {\r\n    type: 'format';\r\n    format: Format;\r\n}\r\n\r\nexport interface ListProp extends LabeledProp {\r\n    type: 'list';\r\n    list: string | any[];  // string \r\n    row: new (props: any) => React.Component;\r\n}\r\n\r\nexport interface ComponentProp extends LabeledProp {\r\n    type: 'component';\r\n    full?: boolean;\r\n    component: any; //JSX.Element;\r\n}\r\n\r\nexport type Prop = StringProp | NumberProp | FormatProp | ListProp | ComponentProp | string;\r\n\r\nexport class PropView {\r\n    private gridProps: PropGridProps\r\n    private props: Prop[];\r\n    //private values:any;\r\n    private rows: PropRow[];\r\n\r\n    constructor(gridProps: PropGridProps, props: Prop[]) {\r\n        this.gridProps = gridProps;\r\n        this.props = props;\r\n        //this.values = values;\r\n        this.buildRows();\r\n    }\r\n\r\n    private buildRows() {\r\n        this.rows = [];\r\n        let isGap: boolean = true;\r\n        for (let prop of this.props) {\r\n            if (typeof prop === 'string') {\r\n                this.rows.push(new PropGap(prop));\r\n                isGap = true;\r\n            }\r\n            else {\r\n                if (!isGap) this.rows.push(new PropBorder());\r\n                let row;\r\n                switch (prop.type) {\r\n                    default: continue;\r\n                    case 'string': row = new StringPropRow(this.gridProps, prop); break;\r\n                    case 'number': row = new NumberPropRow(this.gridProps, prop); break;\r\n                    case 'list': row = new ListPropRow(this.gridProps, prop); break;\r\n                    case 'component': row = new ComponentPropRow(this.gridProps, prop); break;\r\n                }\r\n                this.rows.push(row);\r\n                isGap = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    setValues(values: any) {\r\n        for (let r of this.rows) r.setValues(values);\r\n    }\r\n\r\n    render() {\r\n        return this.rows.map((row, index) => row.render(String(index)));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, PropView} from './propView';\r\n\r\nexport interface PropGridProps {\r\n    className?: string;\r\n    rows: Prop[];\r\n    values: any;\r\n    alignValue?: 'left'|'center'|'right';\r\n    labelFixLeft?: boolean;\r\n}\r\n\r\n@observer\r\nexport class PropGrid extends React.Component<PropGridProps> {\r\n    render() {\r\n        let {className, rows, values} = this.props;\r\n        let propView = new PropView(this.props, rows);\r\n        propView.setValues(values);\r\n        let cn = classNames('container-fluid', className);\r\n        return <div className={cn}>\r\n            {propView.render()}\r\n        </div>;\r\n    }\r\n}\r\n","import { observable } from 'mobx';\r\nimport { isNumber } from 'util';\r\nimport _ from 'lodash';\r\nimport { LocalArr } from '../../tool';\r\nimport { BoxId } from './boxId';\r\nimport { TuidInner, TuidDiv } from './tuid';\r\n\r\nconst maxCacheSize = 1000;\r\n\r\nexport class IdCache {\r\n    private queue: number[] = [];               // \r\n\tprivate cache = observable.map({}, {deep: false});    // \r\n\tprivate loading:boolean = false;\r\n\r\n    protected localArr:LocalArr;\r\n    protected waitingIds: number[] = [];          // loading\r\n    protected tuidInner: TuidInner;\r\n\r\n    constructor(tuidLocal: TuidInner) {\r\n        this.tuidInner = tuidLocal;\r\n        this.initLocalArr();\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    useId(id:number, defer?:boolean) {\r\n        if (!id) return;\r\n        if (isNumber(id) === false) return;\r\n        if (this.cache.has(id) === true) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n        this.tuidInner.cacheTuids(defer===true?70:20);\r\n        this.cache.set(id, id);\r\n        if (this.waitingIds.findIndex(v => v === id) >= 0) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n\r\n        if (this.queue.length >= maxCacheSize) {\r\n            // \r\n            let r = this.queue.shift();\r\n            if (r === id) {\r\n                // \r\n                this.queue.push(r);\r\n                return;\r\n            }\r\n\r\n            //let rKey = String(r);\r\n            if (this.cache.has(r) === true) {\r\n                // r\r\n                this.cache.delete(r);\r\n            }\r\n            else {\r\n                // r\r\n                let index = this.waitingIds.findIndex(v => v === r);\r\n                this.waitingIds.splice(index, 1);\r\n            }\r\n        }\r\n        this.waitingIds.push(id);\r\n        this.queue.push(id);\r\n        return;\r\n    }\r\n\r\n    private moveToHead(id:number) {\r\n        let index = this.queue.findIndex(v => v === id);\r\n        this.queue.splice(index, 1);\r\n        this.queue.push(id);\r\n    }\r\n\r\n    getValue(id:number) {\r\n        return this.cache.get(id);\r\n    }\r\n\r\n    remove(id:number) {\r\n        this.cache.delete(id);\r\n        let index = this.queue.findIndex(v => v === id);\r\n\t\tthis.queue.splice(index, 1);\r\n\t\tthis.localArr.removeItem(id);\r\n    }\r\n\r\n    valueFromId(id:number|BoxId):any {\r\n        let _id:number;\r\n        switch (typeof id) {\r\n            case 'object': _id = (id as BoxId).id; break;\r\n            case 'number': _id = id as number; break;\r\n            default: return;\r\n        }\r\n        return this.getValue(_id);\r\n    }\r\n\r\n    resetCache(id:number) {\r\n        this.remove(id);\r\n        this.useId(id);\r\n    }\r\n\r\n    cacheValue(val:any):boolean {\r\n        if (val === undefined) return false;\r\n        let id = this.getIdFromObj(val);\r\n        if (id === undefined) return false;\r\n        let index = this.waitingIds.findIndex(v => v === id);\r\n        if (index>=0) this.waitingIds.splice(index, 1);\r\n        this.cache.set(id, val);\r\n        return true;\r\n    }\r\n    protected getIdFromObj(val:any) {return this.tuidInner.getIdFromObj(val)}\r\n\r\n    async cacheIds():Promise<void> {\r\n        if (this.waitingIds.length === 0) return;\r\n\t\tlet tuidValues = await this.loadIds();\r\n\t\tif (tuidValues === undefined || tuidValues.length === 0) {\r\n\t\t\tthis.waitingIds.splice(0, this.waitingIds.length);\r\n\t\t\treturn;\r\n\t\t}\r\n        this.cacheIdValues(tuidValues);\r\n    }\r\n\r\n    private cacheIdValues(tuidValues: any[]) {\r\n        if (tuidValues === undefined) return;\r\n        let tuids = this.unpackTuidIds(tuidValues);\r\n        for (let tuidValue of tuids) {\r\n            if (this.cacheValue(tuidValue) === false) continue;\r\n            this.cacheTuidFieldValues(tuidValue);\r\n        }\r\n    }\r\n    async modifyIds(ids:any[]):Promise<void> {\r\n        let tuidValues:string[] = await this.loadTuidIdsOrLocal(ids);\r\n        let localedValues = tuidValues.filter(v => {\r\n            let p = v.indexOf('\\t');\r\n            if (p<0) p = v.length;\r\n            let id = Number(v.substr(0, p));\r\n            let val = this.localArr.getItem(id);\r\n            return (val !== undefined);\r\n        });\r\n        if (localedValues.length === 0) return;\r\n        this.cacheIdValues(localedValues);\r\n    }\r\n    protected divName:string = undefined;\r\n    protected async loadIds(): Promise<any[]> {\r\n\t\tif (this.loading === true) return;\r\n\t\tthis.loading = true;\r\n\t\tlet ret = await this.loadTuidIdsOrLocal(this.waitingIds);\r\n\t\tthis.loading = false;\r\n        return ret;\r\n    }\r\n    protected unpackTuidIds(values:string[]):any[] {\r\n        return this.tuidInner.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.tuidInner.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\r\n    async assureObj(id:number):Promise<void> {\r\n        let val = this.cache.get(id);\r\n        switch (typeof val) {\r\n            case 'object': return val;\r\n            case 'number': this.cache.set(id, id); break;\r\n        }\r\n        let ret = await this.loadTuidIdsOrLocal([id]);\r\n        this.cacheIdValues(ret);\r\n    }\r\n\r\n    private async loadTuidIdsOrLocal(ids:number[]):Promise<string[]> {\r\n        let ret:string[] = [];        \r\n        let netIds:number[] = [];\r\n        for (let id of ids) {\r\n            let value = this.localArr.getItem(id);\r\n            //if (value === undefined)\r\n            // \r\n            if (!value)\r\n                netIds.push(id);\r\n            else\r\n                ret.push(value);\r\n        }\r\n        let len = netIds.length;\r\n        if (len > 0) {\r\n            let netRet = await this.tuidInner.loadTuidIds(this.divName, netIds);\r\n            for (let i=0; i<len; i++) {\r\n                //id\r\n                //let id = netIds[i]; \r\n                let row:string = netRet[i];\r\n                if (!row) continue;\r\n                let p = row.indexOf('\\t');\r\n                if (p < 0) p = row.length;\r\n                let id = Number(row.substr(0, p));\r\n\t\t\t\t_.remove(netIds, v => v === id);\r\n                ret.push(row);\r\n                this.localArr.setItem(id, row);\r\n            }\r\n            len = netIds.length;\r\n            for (let i=0; i<len; i++) {\r\n                this.localArr.setItem(netIds[i], '');\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nexport class IdDivCache extends IdCache {\r\n    private div: TuidDiv;\r\n    protected divName:string;\r\n\r\n    constructor(tuidLocal:TuidInner, div: TuidDiv) {\r\n        super(tuidLocal);\r\n        this.div = div;\r\n        this.divName = div.name;\r\n        this.localArr = tuidLocal.cache.arr(tuidLocal.name + '.ids.' + this.divName);\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        // \r\n        // this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    protected getIdFromObj(val:any) {return this.div.getIdFromObj(val)}\r\n    protected unpackTuidIds(values:string[]):any[] {\r\n        return this.div.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.div.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\r\n    /*\r\n    async cacheIds():Promise<void> {\r\n        if (this.waitingIds.length === 0) return;\r\n        let tuidValues = await this.loadIds();\r\n        if (tuidValues !== undefined) {\r\n            let tuids = this.tuidLocal.unpackTuidIds(tuidValues);\r\n            for (let tuidValue of tuids) {\r\n                if (this.cacheValue(tuidValue) === false) continue;\r\n                this.tuidLocal.cacheTuidFieldValues(tuidValue);\r\n                this.afterCacheValue(tuidValue);\r\n            }\r\n        }\r\n    }\r\n    */\r\n}\r\n","import _ from 'lodash';\r\nimport { LocalArr } from '../../tool';\r\nimport { Entity } from '../entity';\r\nimport { UqMan, ArrFields, Field, SchemaFrom } from '../uqMan';\r\nimport { EntityCaller } from '../caller';\r\nimport { BoxId } from './boxId';\r\nimport { IdCache, IdDivCache } from './idCache';\r\n\r\nexport interface TuidSaveResult {\r\n    id: number;\r\n    inId: number;\r\n}\r\n\r\nexport interface TuidNOResult {\r\n\tdate: string;\r\n\tno: number;\r\n}\r\n\r\nexport abstract class UqTuid<M> extends Entity {\r\n    protected noCache: boolean;\r\n    readonly typeName:string = 'tuid';\r\n    protected idName: string;\r\n    cached: boolean;\r\n    unique: string[];\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {id} = schema;\r\n        this.idName = id;\r\n    }\r\n\r\n    buildTuidBox(): TuidBox {\r\n        return new TuidBox(this);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    stopCache():void {this.noCache = true}\r\n    abstract useId(id:number):void;\r\n    abstract boxId(id:number):BoxId;\r\n    abstract valueFromId(id:number):any;\r\n\tabstract resetCache(id:number|BoxId):void;\r\n\tabstract assureBox<T> (id:number|BoxId): Promise<T>;\r\n\tstatic idValue(id: {id:number}|number):number {\r\n\t\tswitch (typeof id) {\r\n\t\t\tdefault: debugger; throw new Error('unknown id');\r\n\t\t\tcase 'object': return id.id;\r\n\t\t\tcase 'number': return id;\r\n\t\t}\r\n\t}\r\n    static equ(id1:{id:number}|number, id2:{id:number}|number): boolean {\r\n        if (id1 === undefined || id1 === null) return false;\r\n\t\tif (id2 === undefined || id2 === null) return false;\r\n\t\treturn Tuid.idValue(id1) === Tuid.idValue(id2);\r\n\t\t/*\r\n        if (typeof id1 === 'object') {\r\n\t\t\tlet id1Id = id1.id;\r\n            return typeof id2 === 'object'? id1Id === id2.id : id1Id === id2;\r\n        }\r\n        if (typeof id2 === 'object') {\r\n\t\t\tlet id2Id = id2.id;\r\n            return typeof id1 === 'object'? id2Id === id1.id : id2Id === id1;\r\n        }\r\n\t\treturn id1 === id2;\r\n\t\t*/\r\n    }\r\n    cacheIds() {}\r\n    async modifyIds(ids:any[]) {}\r\n    isImport = false;\r\n    abstract get hasDiv():boolean;// {return this.divs!==undefined}\r\n    abstract div(name:string):TuidDiv;\r\n    abstract loadMain(id:number|BoxId):Promise<M>;\r\n\tabstract load(id:number|BoxId):Promise<M>;\r\n    abstract all():Promise<M[]>;\r\n\tabstract save(id:number, props:M):Promise<TuidSaveResult>;\r\n\tabstract saveProp(id:number, prop:string, value:any):Promise<void>;\r\n    abstract search(key:string, pageStart:string|number, pageSize:number):Promise<M[]>;\r\n    abstract searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any>;\r\n    abstract loadArr(arr:string, owner:number, id:number):Promise<any>;\r\n    abstract saveArr(arr:string, owner:number, id:number, props:any):Promise<void>;\r\n\tabstract posArr(arr:string, owner:number, id:number, order:number):Promise<void>;\r\n\tabstract no():Promise<TuidNOResult>;\r\n}\r\n\r\nexport abstract class Tuid extends UqTuid<any> {\r\n}\r\n\r\nexport class TuidInner extends Tuid {\r\n    private divs: {[div:string]: TuidDiv};\r\n    protected cacheFields: Field[];\r\n    protected idCache: IdCache;\r\n    protected localArr:LocalArr;\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        super(uq, name, typeId);\r\n        this.idCache = new IdCache(this);\r\n        this.localArr = this.cache.arr(this.name + '.whole');\r\n        if (uq.newVersion === true) this.localArr.removeAll();\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {arrs} = schema;\r\n        if (arrs !== undefined) {\r\n            this.divs = {};\r\n            for (let arr of arrs) {\r\n                let {name} = arr;\r\n                let tuidDiv = new TuidDiv(this.uq, this, name);\r\n                this.divs[name] = tuidDiv;\r\n                tuidDiv.setSchema(arr);\r\n                tuidDiv.buildFieldsTuid();\r\n            }\r\n        }\r\n    }\r\n    \r\n    useId(id:number, defer?:boolean) {\r\n        if (this.noCache === true) return;\r\n        if (!id) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n    boxId(id:number):BoxId {\r\n        if (!id) return;\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        let {createBoxId} = this.uq;\r\n        if (!createBoxId) return {id: id} as BoxId;\r\n        return createBoxId(this, id);\r\n    }\r\n    valueFromId(id:number) {return this.idCache.getValue(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tthis.idCache.resetCache(id);\r\n\t}\r\n    async assureBox<T> (id:number|BoxId):Promise<T> {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    cacheIds() {\r\n        this.idCache.cacheIds();\r\n        if (this.divs === undefined) return;\r\n        for (let i in this.divs) this.divs[i].cacheIds();\r\n    }\r\n    async modifyIds(ids:any[]) {\r\n        await this.idCache.modifyIds(ids);\r\n    }\r\n    cacheTuids(defer:number) {this.uq.cacheTuids(defer)}\r\n    get hasDiv():boolean {return this.divs!==undefined}\r\n    div(name:string):TuidDiv {\r\n        return this.divs && this.divs[name];\r\n    }\r\n    async loadTuidIds(divName:string, ids:number[]):Promise<any[]> {\r\n        let ret:any[] = await new IdsCaller(this, {divName:divName, ids:ids}, false).request();\r\n        if (ret.length > 0) this.cached = true;\r\n        return ret;\r\n    }\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        if (typeof id === 'object') id = id.id;\r\n        await this.idCache.assureObj(id);\r\n        return this.idCache.valueFromId(id);\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let cacheValue = this.idCache.valueFromId(id); \r\n        //if (typeof cacheValue === 'object') return cacheValue;\r\n        if (typeof id === 'object') id = id.id;\r\n        let valuesText = undefined; //this.localArr.getItem(id);\r\n        let values: any;\r\n        if (valuesText) {\r\n            values = JSON.parse(valuesText);\r\n        }\r\n        else {\r\n            values = await new GetCaller(this, id).request();\r\n            if (values !== undefined) {\r\n                // this.localArr.setItem(id, JSON.stringify(values));\r\n            }\r\n        }\r\n        if (values === undefined) return;\r\n        for (let f of this.schema.fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.uq.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            let n = f.name;\r\n            values[n] = t.boxId(values[n]);\r\n        }\r\n        this.idCache.cacheValue(values);\r\n        this.cacheTuidFieldValues(values);\r\n        return values;\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let {fields, arrs} = this.schema;\r\n        this.cacheFieldsInValue(values, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs as ArrFields[]) {\r\n                let {name, fields} = arr;\r\n                let arrValues = values[name];\r\n                if (arrValues === undefined) continue;\r\n                let tuidDiv = this.div(name);\r\n                for (let row of arrValues) {\r\n                    //row._$tuid = tuidDiv;\r\n                    //row.$owner = this.boxId(row.owner);\r\n                    tuidDiv.cacheValue(row);\r\n                    this.cacheFieldsInValue(row, fields);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields, $create, $update, stampOnMain} = this.schema;\r\n\t\tif (mainFields === undefined) debugger;\r\n\t\tthis.cacheFields = mainFields || this.fields;\r\n\t\tif (stampOnMain === true) {\r\n\t\t\tif ($create === true) this.cacheFields.push({name: '$create', type: 'timestamp', _tuid: undefined});\r\n\t\t\tif ($update === true) this.cacheFields.push({name: '$update', type: 'timestamp', _tuid: undefined});\r\n\t\t}\r\n        this.uq.buildFieldTuid(this.cacheFields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        let ret = await new SaveCaller(this, {id:id, props:props}).request();\r\n        if (id !== undefined) {\r\n            this.idCache.remove(id);\r\n            this.localArr.removeItem(id);\r\n        }\r\n        return ret;\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait new SavePropCaller(this, {id, prop, value}).request();\r\n\t\tthis.idCache.remove(id);\r\n\t\tawait this.idCache.assureObj(id);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        let ret: any[] = await new AllCaller(this, {}).request();\r\n        return ret;\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any[]> {\r\n        let ret:any[] = await this.searchArr(undefined, key, pageStart, pageSize);\r\n        return ret;\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        //let api = this.uqApi;\r\n        //let ret = await api.tuidSearch(this.name, undefined, owner, key, pageStart, pageSize);\r\n        let params:any = {arr:undefined, owner:owner, key:key, pageStart:pageStart, pageSize:pageSize};\r\n        let ret = await new SearchCaller(this, params).request();\r\n        let {fields} = this.schema;\r\n        for (let row of ret) {\r\n            this.cacheFieldsInValue(row, fields);\r\n        }\r\n        return ret;\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let api = this.uqApi;\r\n        //return await api.tuidArrGet(this.name, arr, owner, id);\r\n        return await new LoadArrCaller(this, {arr:arr, owner:owner, id:id}).request();\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any) {\r\n        //let params = _.clone(props);\r\n        //params[\"$id\"] = id;\r\n        //return await this.uqApi.tuidArrSave(this.name, arr, owner, params);\r\n        return await new SaveArrCaller(this, {arr:arr, owner:owner, id:id, props:props}).request();\r\n    }\r\n\r\n    async posArr(arr:string, owner:number, id:number, order:number) {\r\n        //return await this.uqApi.tuidArrPos(this.name, arr, owner, id, order);\r\n        return await new ArrPosCaller(this, {arr:arr, owner:owner, id:id, order:order}).request();\r\n\t}\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await new TuidNoCaller(this, undefined).request();\r\n\t}\r\n}\r\n\r\nabstract class TuidCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Tuid {return this._entity as Tuid};\r\n}\r\n\r\n// mainload id\r\n// \r\nclass GetCaller extends TuidCaller<number> {\r\n    method = 'GET';\r\n    get path():string {return `tuid/${this.entity.name}/${this.params}`}\r\n}\r\n\r\nclass IdsCaller extends TuidCaller<{divName:string, ids:number[]}> {\r\n    get path():string {\r\n        let {divName} = this.params;\r\n        return `tuidids/${this.entity.name}/${divName !== undefined?divName:'$'}`;\r\n    }\r\n    buildParams():any {return this.params.ids}\r\n    xresult(res:any):any {\r\n        return (res as string).split('\\n');\r\n    }\r\n}\r\n\r\n\r\nclass SaveCaller extends TuidCaller<{id:number, props:any}> {\r\n    get path():string {return `tuid/${this.entity.name}`}\r\n    buildParams():any {\r\n        let {fields, arrs} = this.entity.schema;\r\n        let {id, props} = this.params;\r\n        let params:any = {$id: id};\r\n        this.transParams(params, props, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let arrName = arr.name;\r\n                let arrParams = [];\r\n                let arrFields = arr.fields;\r\n                let arrValues = props[arrName];\r\n                if (arrValues !== undefined) {\r\n                    for (let arrValue of arrValues) {\r\n                        let row = {};\r\n                        this.transParams(row, arrValue, arrFields);\r\n                        arrParams.push(row);\r\n                    }\r\n                }\r\n                params[arrName] = arrParams;\r\n            }\r\n        }\r\n        return params;\r\n    }\r\n    private transParams(values:any, params:any, fields:Field[]) {\r\n        if (params === undefined) return;\r\n        for (let field of fields) {\r\n            let {name, tuid, type} = field;\r\n            let val = params[name];\r\n            if (tuid !== undefined) {\r\n                if (typeof val === 'object') {\r\n                    if (val !== null) val = val.id;\r\n                }\r\n            }\r\n            else {\r\n                switch (type) {\r\n                    case 'date':\r\n                        val = this.entity.buildDateParam(val); \r\n                        //val = (val as string).replace('T', ' ');\r\n                        //val = (val as string).replace('Z', '');\r\n                        break;\r\n                    case 'datetime':\r\n                        val = this.entity.buildDateTimeParam(val);\r\n                        //val = new Date(val).toISOString();\r\n                        //val = (val as string).replace('T', ' ');\r\n                        //val = (val as string).replace('Z', '');\r\n                        break;\r\n                }\r\n            }\r\n            values[name] = val;\r\n        }\r\n    }\r\n}\r\n\r\nclass SearchCaller extends TuidCaller<{arr:string, owner:number, key:string, pageStart:string|number, pageSize:number}> {\r\n    get path():string {return `tuids/${this.entity.name}`}\r\n}\r\n\r\nclass AllCaller extends TuidCaller<{}> {\r\n    method = 'GET';\r\n    get path():string {return `tuid-all/${this.entity.name}`}\r\n}\r\n\r\nclass LoadArrCaller extends TuidCaller<{arr:string, owner:number, id:number}> {\r\n    method = 'GET';\r\n    get path():string {\r\n        let {arr, owner, id} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/${id}`;\r\n    }\r\n}\r\nclass SavePropCaller extends TuidCaller<{id:number, prop:string, value:any}> {\r\n    get path():string {return `tuid-prop/${this.entity.name}/`;}\r\n}\r\nclass SaveArrCaller extends TuidCaller<{arr:string, owner:number, id:number, props:any}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, props} = this.params;\r\n        let params = _.clone(props);\r\n        params['$id'] = id;\r\n        return params;\r\n    }\r\n}\r\nclass ArrPosCaller extends TuidCaller<{arr:string, owner:number, id:number, order:number}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr-pos/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, order} = this.params;\r\n        return { bid: id, $order: order}\r\n    }\r\n}\r\nclass TuidNoCaller extends TuidCaller<{}> {\r\n    get path():string {\r\n        return `tuid-no/${this.entity.name}/`;\r\n    }\r\n    buildParams():any {\r\n\t\tlet d = new Date();\r\n\t\tlet year = d.getFullYear();\r\n\t\tlet month = d.getMonth() + 1;\r\n\t\tlet date = d.getDate();\r\n        return {year, month, date};\r\n    }\r\n}\r\n\r\nexport class TuidImport extends Tuid {\r\n    private tuidLocal: TuidInner;\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number, from: SchemaFrom) {\r\n        super(uq, name, typeId);\r\n        this.from = from;\r\n    }\r\n\r\n    setFrom(tuidLocal: TuidInner) {this.tuidLocal = tuidLocal}\r\n    \r\n    readonly from: SchemaFrom;\r\n    isImport = true;\r\n\r\n    useId(id:number) {this.tuidLocal.useId(id);}\r\n    boxId(id:number):BoxId {return this.tuidLocal.boxId(id);}\r\n    valueFromId(id:number) {return this.tuidLocal.valueFromId(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tthis.tuidLocal.resetCache(id);\r\n\t}\r\n    async assureBox<T>(id:number):Promise<T> {\r\n        await this.tuidLocal.assureBox(id);\r\n\t\treturn this.tuidLocal.valueFromId(id);\r\n    }\r\n    get hasDiv():boolean {return this.tuidLocal.hasDiv}\r\n    div(name:string):TuidDiv {return this.tuidLocal.div(name)}\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        let ret = await this.tuidLocal.loadMain(id);\r\n        return ret;\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        return await this.tuidLocal.load(id);\r\n    }\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        return await this.tuidLocal.save(id, props);\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait this.tuidLocal.saveProp(id, prop, value);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        return await this.tuidLocal.all();\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.search(key, pageStart, pageSize);\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.searchArr(owner, key, pageStart, pageSize);\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        return await this.tuidLocal.loadArr(arr, owner, id);\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any):Promise<void> {\r\n        await this.tuidLocal.saveArr(arr, owner, id, props);\r\n    }\r\n    async posArr(arr:string, owner:number, id:number, order:number):Promise<void> {\r\n        await this.tuidLocal.posArr(arr, owner, id, order);\r\n    }\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await this.tuidLocal.no();\r\n\t}\r\n}\r\n\r\n// field._tuid \r\n// Tuid, TuidDiv \r\nexport class TuidBox {\r\n    tuid: Tuid;\r\n    ownerField:Field = undefined;\r\n    constructor(tuid: Tuid) {\r\n        this.tuid = tuid;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.tuid.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.tuid.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.tuid.useId(id);\r\n    }\r\n    async showInfo() {\r\n        alert('showInfo not implemented');\r\n    }\r\n}\r\n\r\n\r\nexport class TuidDiv extends TuidInner /* Entity*/ {\r\n    readonly typeName:string = 'div';\r\n    protected cacheFields: Field[];\r\n    protected tuid: TuidInner;\r\n    protected idName: string;\r\n    protected idCache: IdDivCache;\r\n\r\n    //ui: React.StatelessComponent<any>;\r\n    //res: any;\r\n\r\n    constructor(uq: UqMan, tuid: TuidInner, name: string) {\r\n        super(uq, name, 0);\r\n        this.tuid = tuid;\r\n        this.idName = 'id';\r\n        this.idCache = new IdDivCache(tuid, this);\r\n    }\r\n\r\n    get owner() {return this.tuid}\r\n\r\n    /*\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.buildFieldsTuid();\r\n    }*/\r\n\r\n    /*\r\n    setUIRes(ui:any, res:any) {\r\n        this.ui = ui && ui.content;\r\n        this.res = res;\r\n    }\r\n    */\r\n\r\n    buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields} = this.schema;\r\n        if (mainFields === undefined) debugger;\r\n        this.uq.buildFieldTuid(this.cacheFields = mainFields);\r\n    }\r\n\r\n    buildTuidDivBox(ownerField: Field): TuidBoxDiv {\r\n        return new TuidBoxDiv(this.tuid, this, ownerField);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    cacheValue(value:any):void {\r\n        this.idCache.cacheValue(value);\r\n    }\r\n\r\n    useId(id:number, defer?:boolean):void {\r\n        if (this.noCache === true) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n\r\n    /*\r\n    boxId(id:number):BoxId {\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        //return new BoxDivId(this.tuid, this, id);\r\n        return this.tuid.boxDivId(this, id);\r\n    }\r\n    */\r\n    valueFromId(id:number):any {\r\n        return this.idCache.getValue(id)\r\n    }\r\n\r\n    async assureBox<T>(id:number):Promise<T> {\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    async cacheIds() {\r\n        await this.idCache.cacheIds();\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let fields = this.schema.fields;\r\n        this.cacheFieldsInValue(values, fields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n}\r\n\r\nexport class TuidBoxDiv extends TuidBox {\r\n    ownerField: Field;\r\n    private div: TuidDiv;\r\n    constructor(tuid: Tuid, div: TuidDiv, ownerField: Field) {\r\n        super(tuid);\r\n        this.div = div;\r\n        this.ownerField = ownerField;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.div.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.div.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.div.useId(id);\r\n    }\r\n}\r\n","import {appInFrame, CenterApiBase} from 'tonva';\r\n\r\nclass MainApi extends CenterApiBase {\r\n    async userAppUnits(app:number):Promise<any[]> {\r\n        return await this.get('tie/user-app-units', {app:app});\r\n    }\r\n    async stickies():Promise<any[]> {\r\n        return await this.get('sticky/list', {start:0, pageSize:30});\r\n    }\r\n\r\n    async ties():Promise<any[]> {\r\n        return await this.get('tie/list', {start:0, pageSize:30});\r\n    }\r\n\r\n    async apps(unit:number):Promise<any> {\r\n        return await this.get('tie/apps', {unit:unit});\r\n    }\r\n\r\n    async appApi(unit:number, app:number, apiName:string) {\r\n        return await this.get('tie/app-api', {unit:unit, app:app, apiName:apiName});\r\n    }\r\n\r\n    async userId(name:string):Promise<number> {\r\n        return await this.get('tie/user-id', {name:name});\r\n    }\r\n\r\n    async user(id:number):Promise<any> {\r\n        return await this.get('tie/user', {id:id});\r\n    }\r\n\r\n    async userUnitAdmins():Promise<any[]> {\r\n        return await this.get('tie/user-admin-units', {});\r\n    }\r\n\r\n    async sendMessage(toUser:number, type:string, content:any) {\r\n        let {unit} = appInFrame;\r\n        let adminApp = 0;\r\n        return await this.post('tie/send-message', {\r\n            type: type, \r\n            fromUnit: unit, \r\n            fromApp: adminApp,\r\n            toUser: toUser, \r\n            content: content, \r\n        });\r\n    }\r\n\r\n    async unit(unit:number):Promise<any> {\r\n        return await this.get('unit/', {unit:unit});\r\n    }\r\n\r\n    async unitMemberCount(unit:number):Promise<number> {\r\n        return await this.get('unit/member-count', {unit:unit});\r\n    }\r\n\r\n    async unitAdmins(unit:number):Promise<any[]> {\r\n        return await this.get('unit/admins', {unit:unit});\r\n    }\r\n\r\n    async unitAppAdmins(unit:number, app:number):Promise<any[]> {\r\n        return await this.get('unit/app-admins', {unit:unit, app:app});\r\n    }\r\n\r\n    async unitSetAdmin(fellow:number, unit:number, isOwner:number, isAdmin:number, isDev:number):Promise<any> {\r\n        return await this.post('unit/set-admin', {fellow:fellow, unit:unit, isOwner:isOwner, isAdmin:isAdmin, isDev:isDev});\r\n    }\r\n\r\n    async unitAddAdmin(user:string, unit:number, isOwner:number, isAdmin:number, isDev:number):Promise<any> {\r\n        return await this.post('unit/add-admin', {user:user, unit:unit, isOwner:isOwner, isAdmin:isAdmin, isDev});\r\n    }\r\n\r\n    async unitDelAdmin(unit:number, user:number):Promise<any> {\r\n        return await this.post('unit/del-admin', {user:user, unit:unit});\r\n    }\r\n\r\n    async adminDevs(unit:number):Promise<any[][]> {\r\n        return await this.get('unit/admin-devs', {unit:unit});\r\n    }\r\n\r\n    async addDev(unit:number, dev:string):Promise<any> {\r\n        return await this.post('unit/add-dev', {unit:unit, dev:dev})\r\n    }\r\n\r\n    async delDev(unit:number, dev:number):Promise<string> {\r\n        return await this.post('unit/del-dev', {unit:unit, dev:dev})\r\n    }\r\n\r\n    async unitApps(unit:number):Promise<any[]> {\r\n        return await this.get('unit/apps', {unit:unit});\r\n    }\r\n\r\n    async unitAddApp(unit:number, app:number):Promise<number> {\r\n        let ret = await this.post('unit/add-app', {unit:unit, app:app});\r\n        return ret;\r\n    }\r\n\r\n    async unitDeleteApp(unit:number, app:number, deleted:number):Promise<void> {\r\n        await this.post('unit/delete-app', {unit:unit, app:app, deleted:deleted});\r\n    }\r\n\r\n    async unitChangeProp(unit:number, prop:string, value:any):Promise<void> {\r\n        await this.post('unit/change-prop', {unit:unit, prop:prop, value:value});\r\n    }\r\n\r\n    async searchApp(unit:number, key:string, pageStart:any, pageSize:number):Promise<any[]> {\r\n        return await this.get('unit/search-app', {unit:unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n\r\n    async unitRoles(unit:number):Promise<any[]> {\r\n        return await this.get('unit/roles', {unit:unit});\r\n    }\r\n\r\n    async unitAddRole(unit:number, name:string, discription:string):Promise<number> {\r\n        return await this.post('unit/add-role', {unit:unit, name:name, discription:discription});\r\n    }\r\n\r\n    async unitRoleChangeProp(unit:number, role:number, prop:string, value:any):Promise<void> {\r\n        await this.post('unit/change-role-prop', {unit:unit, role:role, prop:prop, value:value});\r\n    }\r\n\r\n    async unitRoleApps(unit:number, role:number):Promise<any[]> {\r\n        return await this.get('unit/role-apps', {unit:unit, role:role});\r\n    }\r\n\r\n    async unitRoleSetApps(unit:number, role:number, apps:number[]):Promise<void> {\r\n        await this.post('unit/role-set-apps', {unit:unit, role:role, apps:apps});\r\n    }\r\n\r\n    async unitMembers(unit:number, role:number, key:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        return await this.get('unit/members', {unit:unit, role:role, key, pageStart, pageSize});\r\n    }\r\n\r\n    async unitAssignMember(unit:number, member:number, assigned:string):Promise<void> {\r\n        await this.post('unit/assign-member', {unit:unit, member:member, assigned:assigned});\r\n    }\r\n\r\n    async unitMemberRoles(unit:number, member:number):Promise<any[]> {\r\n        return await this.get('unit/member-roles', {unit:unit, member:member});\r\n    }\r\n\r\n    async unitSetMemberRoles(unit:number, member:number, roles:number[]):Promise<void> {\r\n        await this.post('unit/member-set-roles', {unit:unit, member:member, roles:roles});\r\n    }\r\n\r\n    async unitUsers(unit:number, key:string, pageStart:number, pageSize:number):Promise<any> {\r\n        return await this.get('unit/users', {unit: unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async unitAppUsers(unit:number, key:string, pageStart:number, pageSize:number):Promise<any> {\r\n        return await this.get('unit/app-users', {unit: unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async unitOneAppUsers(unit:number, app:number, pageStart:number, pageSize:number):Promise<any[]> {\r\n        return await this.get('unit/one-app-users', {unit: unit, app:app, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async unitOneUserApps(unit:number, user:number, pageStart:number, pageSize:number):Promise<any[]> {\r\n        return await this.get('unit/one-user-apps', {unit: unit, user:user, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async unitAppEditUsers(unit:number, app:number, key:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        return await this.get('unit/app-edit-users', {unit: unit, app:app, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async unitUserEditApps(unit:number, user:number, key:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        return await this.get('unit/user-edit-apps', {unit: unit, user:user, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async bindAppUser(unit:number, app:number, user:number, bind:number):Promise<void> {\r\n        await this.post('unit/bind-app-user', {unit: unit, app:app, user:user, bind:bind});\r\n    }\r\n\r\n    async userFromKey(key:string):Promise<any> {\r\n        return await this.get('tie/user-from-key', {key:key});\r\n    }\r\n    async unitAddUser(unit:number, user:number) {\r\n        await this.post('unit/add-user', {unit:unit, user:user});\r\n    }\r\n\r\n    async setAppAdmin(unit:number, app:number, user:number, name:string, isAdmin:number):Promise<any> {\r\n        return await this.post('unit/set-app-admin', {unit:unit, app:app, user:user, name:name, isAdmin:isAdmin});\r\n    }\r\n\r\n    async setAppRoles(unit:number, app:number, user:number, name:string, roles:number):Promise<any> {\r\n        return await this.post('unit/set-app-roles', {unit:unit, app:app, user:user, name:name, roles:roles});\r\n    }\r\n}\r\n\r\nexport const mainApi = new MainApi('tv/', true);\r\n","import {CenterApiBase} from 'tonva';\r\n\r\nclass DevApi extends CenterApiBase {\r\n    async userAppUnits(app:number):Promise<any[]> {\r\n        return await this.get('tie/user-app-units', {app:app});\r\n    }\r\n    async uqBuilderUrl():Promise<any> {\r\n        let ret = await this.get('uq-builder-url', undefined);\r\n        return ret;\r\n    }    \r\n    async counts(unit:number):Promise<any> {\r\n        return await this.get('counts', {unit:unit});\r\n    }\r\n    async app(id:number):Promise<any> {\r\n        return await this.get('app', {id:id});\r\n    }\r\n    async bus(id:number):Promise<any> {\r\n        return await this.get('bus', {id:id});\r\n    }\r\n    async uq(id:number):Promise<any> {\r\n        return await this.get('uq', {id:id});\r\n    }\r\n    async server(id:number):Promise<any> {\r\n        return await this.get('server', {id:id});\r\n    }\r\n    async apps(unit:number, pageSize:number=30):Promise<any[]> {\r\n        return await this.get('apps', {unit:unit, pageSize: pageSize});\r\n    }\r\n    async uqs(unit:number, pageSize:number=30):Promise<any[]> {\r\n        return await this.get('uqs', {unit:unit, pageSize: pageSize});\r\n    }\r\n    async buses(unit:number, pageSize:number=30):Promise<any[]> {\r\n        return await this.get('buses', {unit:unit, pageSize: pageSize});\r\n    }\r\n    async servers(unit:number, pageSize:number=30):Promise<any[]> {\r\n        return await this.get('servers', {unit:unit, pageSize: pageSize});\r\n    }\r\n    async services(unit:number, pageSize:number=30):Promise<any[]> {\r\n        return await this.get('services', {unit:unit, pageSize: pageSize});\r\n    }\r\n    async saveApp(values:any):Promise<number> {\r\n        return await this.post('app-save', values);\r\n    }\r\n    async saveUq(values:any):Promise<number> {\r\n        return await this.post('uq-save', values);\r\n    }\r\n    async saveBus(values:any):Promise<number> {\r\n        return await this.post('bus-save', values);\r\n    }\r\n    async saveServer(values:any):Promise<number> {\r\n        return await this.post('server-save', values);\r\n    }\r\n    async saveService(values:any):Promise<number> {\r\n        return await this.post('service-save', values);\r\n    }\r\n    async delApp(unit:number,id:number):Promise<void> {\r\n        return await this.post('app-del', {unit:unit, id:id});\r\n    }\r\n    async delUq(unit:number,id:number):Promise<void> {\r\n        return await this.post('uq-del', {unit:unit, id:id});\r\n    }\r\n    async delBus(unit:number,id:number):Promise<void> {\r\n        return await this.post('bus-del', {unit:unit, id:id});\r\n    }\r\n    async delServer(unit:number,id:number):Promise<void> {\r\n        return await this.post('server-del', {unit:unit, id:id});\r\n    }\r\n    async delUqdb(unit:number,id:number):Promise<void> {\r\n        return await this.post('uqdb-del', {unit:unit, id:id});\r\n    }\r\n    async delService(unit:number,id:number):Promise<void> {\r\n        return await this.post('service-del', {unit:unit, id:id});\r\n    }\r\n    async loadAppUqs(app:number):Promise<any[]> {\r\n        return await this.get('app-uqs', {app: app});\r\n    }\r\n    async appBindUq(unit:number,app:number,uqs:number[]):Promise<void> {\r\n        let uqsText = uqs.join(';');\r\n        await this.post('app-bind-uq', {unit:unit, app:app, uqs:uqsText});\r\n    }\r\n    async appSetUqMain(unit:number, app:number, uq:number): Promise<void> {\r\n        await this.post('app-set-uq-main', {unit:unit, app:app, uq:uq});\r\n    }\r\n    async searchUq(unit:number,key:string,pageStart:number,pageSize:number):Promise<any[]> {\r\n        return await this.get('uq-search', {unit:unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async getMyUqs(unit:number):Promise<any[]> {\r\n        return await this.get('my-uqs', {unit:unit});\r\n    }\r\n    async searchApp(unit:number,key:string,pageStart:number,pageSize:number):Promise<any[]> {\r\n        return await this.get('app-search', {unit:unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async searchServer(unit:number,key:string,pageStart:number,pageSize:number):Promise<any[]> {\r\n        return await this.get('server-search', {unit:unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async searchUqdb(unit:number,key:string,pageStart:number,pageSize:number):Promise<any[]> {\r\n        return await this.get('uqdb-search', {unit:unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async loadUqServices(unit:number, uq:number):Promise<any[]> {\r\n        return await this.get('uq-services', {unit:unit, uq:uq});\r\n    }\r\n    async changeServiceProp(unit:number, service:number, prop:string, value:any):Promise<number> {\r\n        return await this.post('service-change-prop', {unit:unit, service:service, prop:prop, value:value});\r\n    }\r\n    async uqGetEntities(unit:number, uq:number):Promise<any[][]> {\r\n        return await this.get('uq-get-entities', {unit:unit, uq:uq});\r\n    }\r\n    async adminDevAdd(param: {unit:number, type:string, dev:number, devUser:number}):Promise<void> {\r\n        await this.post('admin-dev-add', param);\r\n    }\r\n    async adminDevDel(param: {unit:number, type:string, dev:number, devUser:number}):Promise<void> {\r\n        await this.post('admin-dev-del', param);\r\n    }\r\n}\r\n\r\nexport const devApi = new DevApi('tv/dev/', true);\r\n","import {CacheIds, User} from 'tonva';\r\nimport {Unit, DevUQ, DevApp, DevBus, DevServer} from '../model';\r\nimport {mainApi, devApi} from '../api';\r\n\r\nclass CacheUnits extends CacheIds<Unit> {\r\n    protected async _loadIds(ids:number[]):Promise<Unit[]> {\r\n        return;\r\n    }\r\n    protected async _loadId(id:number):Promise<Unit> {\r\n        return await mainApi.unit(id);\r\n    }\r\n}\r\n\r\nclass CacheUqs extends CacheIds<DevUQ> {\r\n    protected async _loadIds(ids:number[]):Promise<DevUQ[]> {\r\n        return;\r\n    }\r\n    protected async _loadId(id:number):Promise<DevUQ> {\r\n        return await devApi.uq(id);\r\n    }\r\n}\r\n\r\nclass CacheApps extends CacheIds<DevApp> {\r\n    protected async _loadIds(ids:number[]):Promise<DevApp[]> {\r\n        return;\r\n    }\r\n    protected async _loadId(id:number):Promise<DevApp> {\r\n        return await devApi.app(id);\r\n    }\r\n}\r\n\r\nclass CacheBuses extends CacheIds<DevBus> {\r\n    protected async _loadIds(ids:number[]):Promise<DevBus[]> {\r\n        return;\r\n    }\r\n    protected async _loadId(id:number):Promise<DevBus> {\r\n        let ret = await devApi.bus(id);\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass CacheUsers extends CacheIds<User> {\r\n    protected async _loadIds(ids:number[]):Promise<User[]> {\r\n        return;\r\n    }\r\n    protected async _loadId(id:number):Promise<User> {\r\n        let ret = await mainApi.user(id);\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass CacheServers extends CacheIds<DevServer> {\r\n    protected async _loadIds(ids:number[]):Promise<DevServer[]> {\r\n        return;\r\n    }\r\n    protected async _loadId(id:number):Promise<DevServer> {\r\n        return await devApi.server(id);\r\n    }\r\n}\r\n\r\nclass Caches {\r\n    units: CacheUnits;\r\n    uqs: CacheUqs;\r\n    apps: CacheApps;\r\n    buses: CacheBuses;\r\n    servers: CacheServers;\r\n    users: CacheUsers;\r\n\r\n    constructor() {\r\n        this.reset();\r\n    }\r\n\r\n    reset() {\r\n        this.units = new CacheUnits();\r\n        this.uqs = new CacheUqs();\r\n        this.apps = new CacheApps();\r\n        this.buses = new CacheBuses();\r\n        this.servers = new CacheServers();\r\n        this.users = new CacheUsers();\r\n    }\r\n};\r\n\r\nexport const caches:Caches = new Caches();\r\n","import {observable} from 'mobx';\r\nimport _ from 'lodash';\r\nimport {devApi} from '../api';\r\nimport {Store} from './store';\r\nimport { DevObjBase, DevApp, DevUQ, DevBus, DevServer, DevService } from 'model';\r\n\r\ninterface Counts {\r\n    uq: number;\r\n    app: number;\r\n    bus: number;\r\n    server: number;\r\n    service: number;\r\n    //uqdb: number;\r\n}\r\n\r\nexport abstract class ObjItems<T extends DevObjBase> {\r\n    protected store:Store;\r\n    protected dev:Dev;\r\n    constructor(store:Store, dev:Dev) {\r\n        this.store = store;\r\n        this.dev = dev;\r\n    }\r\n\r\n    @observable items: T[] = undefined;\r\n    @observable cur: T = undefined;\r\n\r\n    async load():Promise<void> {\r\n         let ret = await this._load();\r\n         this.items = ret;\r\n    }\r\n    protected abstract _load():Promise<T[]>;\r\n    async saveCur(item:T):Promise<boolean> {\r\n        let values:any = {};\r\n        if (this.cur !== undefined) {\r\n            _.assign(values, this.cur, item);\r\n        }\r\n        else {\r\n            _.assign(values, item);\r\n        }\r\n\r\n        values.unit = item.unit = this.store.unit.id;\r\n        let id = await this._save(values);\r\n        if (this.cur === undefined) {\r\n            if (id === 0) return false;\r\n            values.id = id;\r\n            if (this.items !== undefined) this.items.unshift(values);\r\n            this._inc();\r\n            this.cur = observable(values);\r\n        }\r\n        else {\r\n            _.assign(this.cur, values);\r\n        }\r\n        return true;\r\n    }\r\n    async check(item:T):Promise<boolean> {\r\n        return true;\r\n    }\r\n    async save(item:T):Promise<T> {\r\n        let values:any = {};\r\n        _.assign(values, item);\r\n\r\n        values.unit = item.unit = this.store.unit.id;\r\n        let id = await this._save(values);\r\n        if (id === 0) return;\r\n        values.id = id;\r\n        return values;\r\n    }\r\n    protected abstract _save(item:T):Promise<number>;\r\n    async del():Promise<void> {\r\n        let c = this.cur;\r\n        if (c === undefined) return;\r\n        let id = c.id;\r\n        await this._del(c);\r\n        if (this.items === undefined) return;\r\n        let index = this.items.findIndex(v => v.id === id);\r\n        if (index>=0) {\r\n            this.items.splice(index, 1);\r\n            this._dec();\r\n        }\r\n    }\r\n    protected abstract _del(item:T):Promise<void>;\r\n    protected abstract _inc();\r\n    protected abstract _dec();\r\n}\r\n\r\nclass Apps extends ObjItems<DevApp> {\r\n    @observable uqs: DevUQ[] = undefined;\r\n    @observable searchedUqs: DevUQ[] = undefined;\r\n    //@observable service: Service = null;\r\n    protected async _load() {\r\n        return await devApi.apps(this.store.unit.id);\r\n    }\r\n    protected async _save(item:DevApp):Promise<number> {\r\n        return await devApi.saveApp(item);\r\n    }\r\n    protected async _del(item:DevApp):Promise<void> {\r\n        await devApi.delApp(this.store.unit.id, item.id);\r\n    }\r\n    protected _inc() { this.dev.counts.app++; }\r\n    protected _dec() { this.dev.counts.app--; }\r\n\r\n    public async loadCurUqs() {\r\n        let ret = await devApi.loadAppUqs(this.cur.id);\r\n        this.uqs = ret;\r\n    }\r\n    public async searchUq(key:string) {\r\n        this.searchedUqs = await devApi.searchUq(this.store.unit.id, key, 0, searchPageSize);\r\n    }\r\n    /*\r\n    public async appBindUq(uqIds:number[]) {\r\n        let allUqs:{id:number}[] = this.uqs.map(v => {return {id: v.id};});\r\n        for (let id of uqIds) {\r\n            let index = allUqs.findIndex(v => v.id === id);\r\n            if (index < 0) allUqs.unshift({id: id});\r\n        }\r\n        await devApi.appBindUq(this.store.unit.id, this.cur.id, allUqs);\r\n        for (let id of uqIds) {\r\n            let index = this.uqs.findIndex(a => a.id === id);\r\n            if (index>=0) this.uqs.splice(index, 1);\r\n            if (this.searchedUqs !== undefined) {\r\n                let find = this.searchedUqs.find(a => a.id === id);\r\n                if (find !== undefined) this.uqs.unshift(find);\r\n            }\r\n        }\r\n    }\r\n    async appRemoveUq(removeUqIds:number[]):Promise<void> {\r\n        let uqs:{id:number}[] = [];\r\n        for (let uq of this.uqs) {\r\n            if (removeUqIds.findIndex(v => v === uq.id)>=0) continue;\r\n            uqs.push({id: uq.id});\r\n        }\r\n        await devApi.appBindUq(this.store.unit.id, this.cur.id, uqs);\r\n        for (let removeUqId of removeUqIds) {\r\n            let index = this.uqs.findIndex((v:UQ) => v.id === removeUqId);\r\n            if (index < 0) continue;\r\n            this.uqs.splice(index, 1);\r\n        };\r\n    }\r\n    */\r\n}\r\n\r\nclass Uqs extends ObjItems<DevUQ> {\r\n    protected async _load() {\r\n        let ret = await devApi.uqs(this.store.unit.id);\r\n        return ret;\r\n    }\r\n    protected async _save(item:DevUQ):Promise<number> {\r\n        //let {access} = item;\r\n        //if (!access) access = \"*';\r\n        //let parts = access.split(',').map(v => v.trim()).filter(v => v!=='');\r\n        //item.access = parts.join(',');\r\n        return await devApi.saveUq(item);\r\n    }\r\n    protected async _del(item:DevUQ):Promise<void> {\r\n        await devApi.delUq(this.store.unit.id, item.id);\r\n    }\r\n    protected _inc() { this.dev.counts.uq++; }\r\n    protected _dec() { this.dev.counts.uq--; }\r\n}\r\n\r\nclass Buses extends ObjItems<DevBus> {\r\n    protected async _load() {\r\n        let ret = await devApi.buses(this.store.unit.id);\r\n        return ret;\r\n    }\r\n    protected async _save(item:DevBus):Promise<number> {\r\n        return await devApi.saveBus(item);\r\n    }\r\n    protected async _del(item:DevBus):Promise<void> {\r\n        await devApi.delBus(this.store.unit.id, item.id);\r\n    }\r\n    protected _inc() { this.dev.counts.bus++; }\r\n    protected _dec() { this.dev.counts.bus--; }\r\n    async check(item:DevBus):Promise<boolean> {\r\n        let {schema} = item;\r\n        try {\r\n            let bus = JSON.parse(schema);\r\n            for (let i in bus) {\r\n                let face = bus[i];\r\n                if (face === null || face === undefined) {\r\n                    alert(`face ${i} is null`);\r\n                    return false;\r\n                }\r\n                switch (typeof face) {\r\n                    case 'function':\r\n                        alert(`face ${i} is functionfunction`);\r\n                        return false;\r\n                    //case 'bigint':\r\n                    case 'boolean':\r\n                    case 'number':\r\n                    case 'string':\r\n                        alert(`face ${i} `);\r\n                        return false;\r\n                }\r\n                if (Array.isArray(face) === true) {\r\n                    if (checkBusFace(face, bus) === false) return false;\r\n                }\r\n                else {\r\n                    if (checkBusQuery(face, bus) === false) return false;\r\n                }\r\n            }\r\n            return true;\r\n        }\r\n        catch (err) {\r\n            alert(err.message);\r\n            return false;\r\n        }\r\n    }\r\n}\r\n\r\nconst paramTypes = ['id', 'number', 'string'];\r\nconst busTypes = [...paramTypes, 'array'];\r\nfunction refNameOk(faceName:string, bus:any):boolean {\r\n    let face = bus[faceName];\r\n    if (face === undefined) {\r\n        alert(`face ${faceName} not defined`);\r\n        return false;\r\n    }\r\n    if (Array.isArray(face) === false) {\r\n        alert(`face ${faceName} is referenced, bus is not array`);\r\n        return false;\r\n    }\r\n    return refArrayOk(face as any[], bus);\r\n}\r\n\r\nfunction refArrayOk(items:any[], bus:any):boolean {\r\n    for (let item of items) {\r\n        let {type} = item;\r\n        if (['id', 'string', 'number', 'array'].indexOf(type) < 0) {\r\n            alert(`type ${type} out of ['id', 'string', 'number', 'array']`);\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction checkBusFace(face: any[], bus:any):boolean {\r\n    if (!face || typeof face !== 'object') {\r\n        alert('only object');\r\n        return false;\r\n    }\r\n    for (let field of face) {\r\n        let {type} = field;\r\n        if (type === undefined) {\r\n            alert('type not defined');\r\n            return false;\r\n        }\r\n        else if (type === 'array') {\r\n            let {fields} = field;\r\n            if (refNameOk(fields, bus) === false) {\r\n                return false;\r\n            }\r\n        }\r\n        if (busTypes.indexOf(type) < 0) {\r\n            if (type === 'date') {\r\n                alert('datenumber unixtime')\r\n            }\r\n            else {\r\n                alert(` ${type}`);\r\n            }\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction checkBusQuery(face: any, bus:any):boolean {\r\n    for (let i in face) {\r\n        let item = face[i];\r\n        switch (i) {\r\n            default:\r\n                alert(i + ': not allowed in bus query.');\r\n                return false;\r\n            case 'param':\r\n                if (checkBusQueryParam(item, bus) === false) return false;\r\n                break;\r\n            case 'returns':\r\n                let returns = item;\r\n                if (typeof item === 'string') {\r\n                    returns = bus[item];\r\n                    if (returns === undefined) {\r\n                        alert(item + ' is not defined');\r\n                        return false;\r\n                    }\r\n                }\r\n                if (checkBusFace(returns, bus) === false) return false;\r\n                break;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction checkBusQueryParam(param: any, bus:any):boolean {\r\n    if (param === null || param === undefined) return;\r\n    switch (typeof param) {\r\n        case 'string':\r\n            return refNameOk(param, bus);\r\n        default:\r\n            if (Array.isArray(param)) {\r\n                return refArrayOk(param, bus);\r\n            }\r\n            break;\r\n    }\r\n    alert('param of a query can only be string or array');\r\n    return false;\r\n}\r\n\r\nclass Servers extends ObjItems<DevServer> {\r\n    protected async _load() {\r\n        return await devApi.servers(this.store.unit.id);\r\n    }\r\n    protected async _save(item:DevServer):Promise<number> {\r\n        return await devApi.saveServer(item);\r\n    }\r\n    protected async _del(item:DevServer):Promise<void> {\r\n        await devApi.delServer(this.store.unit.id, item.id);\r\n    }\r\n    protected _inc() { this.dev.counts.server++; }\r\n    protected _dec() { this.dev.counts.server--; }\r\n}\r\nclass Services extends ObjItems<DevService> {\r\n    protected async _load() {\r\n        return await devApi.services(this.store.unit.id);\r\n    }\r\n    protected async _save(item:DevService):Promise<number> {\r\n        return await devApi.saveService(item);\r\n    }\r\n    protected async _del(item:DevService):Promise<void> {\r\n        await devApi.delService(this.store.unit.id, item.id);\r\n    }\r\n    protected _inc() { this.dev.counts.service++; }\r\n    protected _dec() { this.dev.counts.service--; }\r\n    async changeProp(prop:string, value:any):Promise<number> {\r\n        let ret = await devApi.changeServiceProp(this.store.unit.id, this.cur.id, prop, value);\r\n        switch (prop) {\r\n            case 'url': this.cur.url = value; break;\r\n            case 'urlTest': this.cur.urlTest = value; break;\r\n            case 'server': this.cur.server = value; break;\r\n            case 'db': this.cur.db = value; break;\r\n            //case 'db_type': this.cur.db_type = value; break;\r\n            //case 'connection': this.cur.connection = value; break;\r\n        }\r\n        return ret;\r\n    }\r\n    async loadUqServices(uq:number):Promise<void> {\r\n        let ret = await devApi.loadUqServices(this.store.unit.id, uq);\r\n        this.items = ret[0];\r\n    }\r\n}\r\n\r\nconst searchPageSize = 50;\r\ntype Search = (unit:number,key:string,pageStart:number,pageSize:number)=>Promise<any[]>;\r\nclass SearchItems<T extends DevObjBase> {\r\n    private store:Store;\r\n    private dev:Dev;\r\n    private search:(unit:number,key:string,pageStart:number,pageSize:number)=>Promise<any[]>;\r\n\r\n    constructor(store:Store, dev:Dev, search:Search) {\r\n        this.store = store;\r\n        this.dev = dev;\r\n        this.search = search;\r\n    }\r\n\r\n    @observable items: T[] = undefined;\r\n    allLoaded: boolean = false;\r\n    private key: string;\r\n    private pageStart = 0;\r\n\r\n    async first(key:string) {\r\n        this.key = key;\r\n        this.items = undefined;\r\n        this.allLoaded = false;\r\n        this.pageStart = 0;\r\n        await this.more();\r\n    }\r\n\r\n    async more():Promise<void> {\r\n        if (this.allLoaded === true) return;\r\n        let ret = await this.search(this.store.unit.id, this.key, this.pageStart, searchPageSize);\r\n        let len = ret.length;\r\n        if (len > searchPageSize) {\r\n            this.allLoaded = false;\r\n            --len;\r\n            ret.splice(len, 1);\r\n        }\r\n        else {\r\n            this.allLoaded = true;\r\n        }\r\n        if (len > 0) {\r\n            this.pageStart = ret[len-1].id;\r\n            if (this.items === undefined)\r\n                this.items = ret;\r\n            else\r\n                this.items.push(...ret);\r\n        }\r\n        else {\r\n            this.items = [];\r\n        }\r\n    }\r\n}\r\n\r\nexport class Dev {\r\n    private store:Store;\r\n    constructor(store:Store) {\r\n        this.store = store;\r\n        this.apps = new Apps(store, this);\r\n        this.uqs = new Uqs(store, this);\r\n        this.buses = new Buses(store, this);\r\n        this.servers = new Servers(store, this);\r\n        //this.uqdbs = new Uqdbs(store, this);\r\n        this.services = new Services(store, this);\r\n        this.searchApp = new SearchItems<DevApp>(store, this, devApi.searchApp.bind(devApi));\r\n        this.searchUq = new SearchItems<DevUQ>(store, this, devApi.searchUq.bind(devApi));\r\n        this.searchServer = new SearchItems<DevServer>(store, this, devApi.searchServer.bind(devApi));\r\n    }\r\n\r\n    @observable counts:Counts = undefined;\r\n    apps:Apps = undefined;\r\n    uqs:Uqs = undefined;\r\n    buses:Buses = undefined;\r\n    servers:Servers = undefined;\r\n    //uqdbs:Uqdbs = undefined;\r\n    services:Services = undefined;\r\n\r\n    searchApp:SearchItems<DevApp> = undefined;\r\n    searchUq:SearchItems<DevUQ> = undefined;\r\n    searchServer:SearchItems<DevServer> = undefined;\r\n    //searchUqdb:SearchItems<Uqdb> = undefined;\r\n    \r\n    async loadCounts(): Promise<void> {\r\n        let {unit} = this.store;\r\n        this.counts = await devApi.counts(unit.id);\r\n    }\r\n}\r\n","import {observable} from 'mobx';\r\nimport _ from 'lodash';\r\nimport {appInFrame, host} from 'tonva';\r\nimport {mainApi, devApi} from '../api';\r\nimport {Unit, UnitApp, Role, RoleMember} from '../model';\r\nimport {Dev} from './dev';\r\n\r\nexport class Store {\r\n    private get unitId():number {return appInFrame.unit;};\r\n    dev:Dev;\r\n    uqServer: string;\r\n\r\n    @observable unit: Unit;\r\n    @observable memberCount: number;\r\n    @observable apps: UnitApp[];\r\n    @observable role:Role;\r\n    @observable roles: Role[];\r\n    @observable roleApps: UnitApp[];\r\n    @observable roleMember: RoleMember;\r\n    @observable roleMembers: RoleMember[];\r\n    @observable memberRoles: Role[];\r\n\r\n    init() {\r\n        this.unit = undefined;\r\n        this.apps = undefined;\r\n        //this.admins = new Admins(this);\r\n        this.dev = new Dev(this);\r\n    }\r\n\r\n    logout() {\r\n        //meInFrame.app = undefined;\r\n        appInFrame.hash = undefined;\r\n        //let unitId = process.env.REACT_APP_DEBUG_UNITID;\r\n        //if (unitId !== undefined)\r\n        //    meInFrame.unit = Number(unitId);\r\n        appInFrame.unit = undefined;\r\n        this.init();\r\n        this.memberCount = undefined;\r\n        this.apps = undefined;\r\n        this.role = undefined;\r\n        this.roles = undefined;\r\n        this.roleApps = undefined;\r\n        this.roleMember = undefined;\r\n        this.roleMembers = undefined;\r\n        this.memberRoles = undefined;\r\n    }\r\n\r\n    setRole(role:Role) {\r\n        if (this.role === role) return;\r\n        this.role = role;\r\n        this.roleApps = undefined;\r\n        this.roleMember = undefined;\r\n        this.roleMembers = undefined;\r\n        this.memberRoles = undefined;\r\n    }\r\n\r\n    setRoleUser(user:RoleMember) {\r\n        if (this.roleMember === user) return;\r\n        this.roleMember = user;\r\n        this.memberRoles = undefined;\r\n    }\r\n\r\n    async unitChangeProp(prop:string, value:any):Promise<void> {\r\n        await mainApi.unitChangeProp(this.unit.id, prop, value);\r\n        this.unit[prop] = value;\r\n    }\r\n\r\n    async loadApps(): Promise<void> {\r\n        if (this.apps !== undefined) return;\r\n        this.apps = await mainApi.unitApps(this.unitId);\r\n    }\r\n\r\n    async loadUnit(): Promise<void> {\r\n        if (this.unitId === undefined) return;\r\n        let ret = await mainApi.unit(this.unitId);\r\n        this.unit = ret;\r\n        this.memberCount = await mainApi.unitMemberCount(this.unitId);\r\n        let uqServer = await devApi.uqBuilderUrl();\r\n        let {url} = uqServer;\r\n        this.uqServer = host.getUrlOrDebug(url, 'uq-build');\r\n    }\r\n\r\n    async stopUnitApp(appId:number): Promise<void> {\r\n        await mainApi.unitDeleteApp(this.unit.id, appId, 1);\r\n        let app = this.apps.find(v => v.id === appId);\r\n        app.inUnit = 0;\r\n    }\r\n\r\n    async restoreUnitApp(appId:number): Promise<number> {\r\n        let ret = await mainApi.unitAddApp(this.unit.id, appId);\r\n        if (ret <= 0) return ret;\r\n        let app = this.apps.find(v => v.id === appId);\r\n        app.inUnit = 1;\r\n        return 1;\r\n    }\r\n\r\n    async addUnitApp(app:UnitApp): Promise<number> {\r\n        let ret = await mainApi.unitAddApp(this.unit.id, app.id);\r\n        if (ret <= 0) return ret;\r\n        this.apps.push(app);\r\n        return 1;\r\n    }\r\n\r\n    async loadRoles(): Promise<void> {\r\n        if (this.roles !== undefined) return;\r\n        let ret = await mainApi.unitRoles(this.unit.id);\r\n        ret.forEach(v => {\r\n            switch (v.id) {\r\n                case 1: \r\n                    v.name= '';\r\n                    v.discription = '';\r\n                    break;\r\n                case 2: \r\n                    v.name= '';\r\n                    v.discription = '';\r\n                    break;\r\n            }\r\n        });\r\n        this.roles = ret;\r\n    }\r\n\r\n    async unitAddRole(name:string, discription:string): Promise<number> {\r\n        let id = await mainApi.unitAddRole(this.unit.id, name, discription);\r\n        if (id > 0) {\r\n            this.roles.push({\r\n                id: id,\r\n                name: name,\r\n                discription: discription,\r\n                count: undefined,\r\n            });\r\n        }\r\n        return id;\r\n    }\r\n\r\n    async roleChangeProp(prop:string, value:any):Promise<void> {\r\n        await mainApi.unitRoleChangeProp(this.unit.id, this.role.id, prop, value);\r\n        this.role[prop] = value;\r\n    }\r\n\r\n    async loadRoleApps():Promise<void> {\r\n        let ret = await mainApi.unitRoleApps(this.unit.id, this.role.id);\r\n        this.roleApps = ret.map(v => {\r\n            return this.apps.find(app=>app.id === v.id);\r\n        });\r\n    }\r\n\r\n    async setRoleApps(apps:UnitApp[]) {\r\n        await mainApi.unitRoleSetApps(this.unit.id, this.role.id, apps.map(v=>v.id));\r\n        this.roleApps = apps;\r\n    }\r\n\r\n    async loadMembers():Promise<void> {\r\n        let ret = await mainApi.unitMembers(this.unit.id, this.role === undefined? 0:this.role.id, undefined, 0, 100);\r\n        this.roleMembers = ret;\r\n    }\r\n\r\n    async unitAssignMember(assigned:string):Promise<void> {\r\n        await mainApi.unitAssignMember(this.unit.id, this.roleMember.id, assigned);\r\n        this.roleMember.assigned = assigned;\r\n    }\r\n\r\n    async loadMemberRoles():Promise<void> {\r\n        let ret = await mainApi.unitMemberRoles(this.unit.id, this.roleMember.id);\r\n        let roles:Role[] = ret.map(v => {\r\n            let rId = v.id;\r\n            let role = this.roles.find(r => r.id === rId);\r\n            return _.clone(role);\r\n        });\r\n        this.memberRoles = roles;\r\n    }\r\n\r\n    async setMemberRoles(memberRoles:Role[]) {\r\n        await mainApi.unitSetMemberRoles(this.unit.id, this.roleMember.id, memberRoles.map(v=>v.id));\r\n        this.roles.forEach(role => {\r\n            let rId = role.id;\r\n            let org = this.memberRoles.find(v => v.id === rId);\r\n            let cur = memberRoles.find(v => v.id === rId);\r\n            if (org !== undefined) {\r\n                if (cur !== undefined) return;\r\n                role.count--;\r\n                return;\r\n            }\r\n            if (cur === undefined) return;\r\n            role.count++;\r\n        });\r\n        this.memberRoles = memberRoles;\r\n    }\r\n};\r\n\r\nexport const store = new Store();\r\n","import { CSub, CBase } from 'tonva';\r\n//import { UQs } from './uqs';\r\nimport { CApp } from './CApp';\r\n\r\nexport abstract class CUqBase extends CBase {\r\n    get cApp(): CApp { return this._cApp; }\r\n    //protected get uqs(): UQs { return this._uqs as UQs };\r\n}\r\n\r\nexport abstract class CUqSub<T extends CUqBase> extends CSub<T> {\r\n    get cApp(): CApp { return this.cApp; }\r\n    //protected get uqs(): UQs { return this._uqs as UQs };\r\n    protected get owner(): CUqBase { return this._owner as CUqBase }\r\n}\r\n\r\nexport abstract class CRenderBase extends CUqBase {\r\n    protected async internalStart(param:any, ...params:any[]):Promise<void> {\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {EasyDate, EasyTime} from 'tonva';\r\n\r\nexport interface IdDatesProps {\r\n    date_init: Date;\r\n    date_update: Date;\r\n}\r\n\r\nexport class IdDates extends React.Component<IdDatesProps> {\r\n    render() {\r\n        let {date_init, date_update} = this.props;\r\n        return <small className=\"text-muted\">\r\n            : <EasyTime date={date_update}/>\r\n            <i className=\"fa fa-fw\" />\r\n            : <EasyDate date={date_init}/>\r\n        </small>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport function span(\r\n    isLink:boolean,\r\n    className:string, \r\n    onClick:(evt:React.MouseEventHandler<HTMLElement>)=>void,\r\n    content:any): JSX.Element\r\n{\r\n    let tag:string;\r\n    let props:any;\r\n    if (isLink === true) {\r\n        tag = 'a';\r\n        props = {\r\n            className: classNames(className, 'cursor-pointer'),\r\n            onClick: onClick,\r\n            href: '#',\r\n        }\r\n    }\r\n    else {\r\n        tag = 'span';\r\n        props = {\r\n            className: className,\r\n        }\r\n    }\r\n    return React.createElement(tag, props, content);\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, Media, PropGrid} from 'tonva';\r\nimport {nav, Page}  from 'tonva';\r\nimport {caches} from '../store';\r\nimport {span} from './span';\r\n\r\nexport interface UnitLinkProps {\r\n    className?: string;\r\n    id: number;\r\n    isLink?: boolean;\r\n}\r\n\r\n@observer\r\nexport class UnitSpan extends React.Component<UnitLinkProps> {\r\n    onClick = (evt) => {\r\n        evt.preventDefault();\r\n        nav.push(<UnitInfo id={this.props.id} />);\r\n        return false;\r\n    }\r\n    render() {\r\n        let {id, isLink, className} = this.props;\r\n        if (id === undefined) return null;\r\n        let unit = caches.units.get(id);\r\n        let content:any;\r\n        let {name, nick, discription} = unit;\r\n        let disc = discription && '- ' + discription;\r\n        if (nick) {\r\n            content = <>{nick} &nbsp; <small className=\"text-muted\">{name} {disc}</small></>;\r\n        }\r\n        else if (name) {\r\n            content = <>{name} &nbsp; <small className=\"text-muted\">{disc}</small></>;\r\n        }\r\n        else {\r\n            content = id;\r\n        }\r\n        return span(isLink, className, this.onClick, content);\r\n    }\r\n}\r\n\r\n@observer\r\nexport class UnitName extends React.Component<UnitLinkProps> {\r\n    render() {\r\n        let {id} = this.props;\r\n        if (id === undefined) return null;\r\n        let unit = caches.units.get(id);\r\n        let {name} = unit;\r\n        return <>{name}</>;\r\n    }\r\n}\r\n\r\nclass UnitInfo extends React.Component<UnitLinkProps> {\r\n    private rows:Prop[];\r\n    render() {\r\n        let unit = caches.units.get(this.props.id);\r\n        let {name, icon, discription} = unit;\r\n        this.rows = [\r\n            '',\r\n            {type: 'component', component: <Media icon={icon} main={name} discription={discription} />},\r\n            '',\r\n        ];\r\n        return <Page header={' - '}>\r\n            <PropGrid rows={this.rows} values={this.props} />\r\n        </Page>;\r\n    }\r\n}\r\n","export const appIcon = process.env.REACT_APP_ICON;\r\nexport const appItemIcon = process.env.REACT_APP_ITEM_ICON;\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, Media, PropGrid} from 'tonva';\r\nimport {nav, Page}  from 'tonva';\r\nimport {appIcon} from 'consts';\r\nimport {caches} from 'store';\r\nimport {IdDates} from './idDates';\r\nimport {span} from './span';\r\nimport {UnitSpan} from './unitSpan';\r\n\r\nexport interface UqLinkProps {\r\n    className?: string;\r\n    id: number;\r\n    isLink?: boolean;\r\n}\r\n\r\n@observer\r\nexport class UqSpan extends React.Component<UqLinkProps> {\r\n    onClick = (evt) => {\r\n        evt.preventDefault();\r\n        nav.push(<UqInfo id={this.props.id} />);\r\n        return false;\r\n    }\r\n    render() {\r\n        let {id, className, isLink} = this.props;\r\n        let api = caches.uqs.get(id);\r\n        let content;\r\n        if (api === null) {\r\n            content = id;\r\n        }\r\n        else {\r\n            let {name, discription} = api;\r\n            let disc = discription && '- ' + discription;\r\n            if (name !== undefined) {\r\n                content = <>{name}&nbsp;<small className=\"text-muted\">{disc}</small></>;\r\n            }\r\n            else {\r\n                content = id;\r\n            }\r\n        }\r\n        return span(isLink, className, this.onClick, content);\r\n    }\r\n}\r\n\r\n@observer\r\nclass UqInfo extends React.Component<UqLinkProps> {\r\n    private rows:Prop[];\r\n    render() {\r\n        let uq = caches.uqs.get(this.props.id);\r\n        let {name, discription, unit, date_init, date_update} = uq;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        this.rows = [\r\n            '',\r\n            {type: 'component', component: <Media icon={appIcon} main={name} discription={disp} />},\r\n            '',\r\n            {type: 'component', label: '', component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> },\r\n        ];\r\n        return <Page header={'UQ - '}>\r\n            <PropGrid rows={this.rows} values={this.props} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observable} from 'mobx';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, ListProp, Media, PropGrid} from 'tonva';\r\nimport {nav, Page}  from 'tonva';\r\nimport {caches} from '../store';\r\nimport {devApi} from '../api';\r\nimport {span} from './span';\r\nimport {IdDates} from './idDates';\r\nimport {UnitSpan} from './unitSpan';\r\n\r\nexport interface AppSpanProps {\r\n    className?: string;\r\n    id: number;\r\n    isLink?: boolean;\r\n}\r\n\r\n@observer\r\nexport class AppSpan extends React.Component<AppSpanProps> {\r\n    onClick = (evt) => {\r\n        evt.preventDefault();\r\n        nav.push(<AppInfo id={this.props.id} />)\r\n        return false;\r\n    }\r\n    render() {\r\n        let {id, isLink, className} = this.props;\r\n        let app = caches.apps.get(id);\r\n        let content;\r\n        if (app === null) {\r\n            content = id;\r\n        }\r\n        else {\r\n            let {name, discription} = app;\r\n            //let isPublic = app.public;\r\n            let disc = discription && '- ' + discription;\r\n            if (name !== undefined) {\r\n                content = <React.Fragment>{name} &nbsp; <small className=\"text-muted\">{disc}</small></React.Fragment>;\r\n            }\r\n            else {\r\n                content = id;\r\n            }\r\n        }\r\n        return span(isLink, className, this.onClick, content);\r\n    }\r\n}\r\n\r\n\r\n@observer\r\nclass AppInfo extends React.Component<AppSpanProps> {\r\n    private rows:Prop[];\r\n    @observable private apis:ListProp = {\r\n        label: 'API', type: 'list', list: undefined, row: AppRow\r\n    };\r\n    /*\r\n    constructor(props:any) {\r\n        super(props);\r\n    }*/\r\n    async componentDidMount() {\r\n        this.apis.list = await devApi.loadAppUqs(this.props.id);\r\n    }\r\n    render() {\r\n        let app = caches.apps.get(this.props.id);\r\n        let {unit, name, discription, icon, date_init, date_update} = app;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        this.rows = [\r\n            '',\r\n            {type: 'component', component: <Media icon={icon} main={name} discription={disp} />},\r\n            '',\r\n            {type: 'component', label: '', component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> },\r\n            this.apis,\r\n        ];\r\n        return <Page header={'APP - '}>\r\n            <PropGrid rows={this.rows} values={this.props} />\r\n        </Page>;\r\n    }\r\n}\r\n\r\nclass AppRow extends React.Component<any> {\r\n    render() {\r\n        let {name, discription} = this.props;\r\n        let disp;\r\n        if (discription) disp = <div className=\"small text-muted\">{discription}</div>;\r\n        return <div className='form-control-plaintext'>\r\n            <div>{name}</div>\r\n            {disp}\r\n        </div>\r\n    }\r\n}\r\n\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, Media, PropGrid} from 'tonva';\r\nimport {nav, Page}  from 'tonva';\r\nimport {appIcon} from 'consts';\r\nimport {caches} from 'store';\r\nimport {IdDates} from './idDates';\r\nimport {span} from './span';\r\nimport {UnitSpan} from './unitSpan';\r\n\r\nexport interface BusLinkProps {\r\n    className?: string;\r\n    id: number;\r\n    isLink?: boolean;\r\n}\r\n\r\n@observer\r\nexport class BusSpan extends React.Component<BusLinkProps> {\r\n    onClick = (evt) => {\r\n        evt.preventDefault();\r\n        nav.push(<BusInfo id={this.props.id} />);\r\n        return false;\r\n    }\r\n    render() {\r\n        let {id, className, isLink} = this.props;\r\n        let api = caches.buses.get(id);\r\n        let content:any;\r\n        if (api === null) {\r\n            content = id;\r\n        }\r\n        else {\r\n            let {name, owner} = api;\r\n            if (name !== undefined) {\r\n                content = <>{name} / {owner}</>;\r\n            }\r\n            else {\r\n                content = id;\r\n            }\r\n        }\r\n        return span(isLink, className, this.onClick, content);\r\n    }\r\n}\r\n\r\n@observer\r\nclass BusInfo extends React.Component<BusLinkProps> {\r\n    private rows:Prop[];\r\n    render() {\r\n        let uq = caches.buses.get(this.props.id);\r\n        let {name, discription, unit, date_init, date_update} = uq;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        this.rows = [\r\n            '',\r\n            {type: 'component', component: <Media icon={appIcon} main={name} discription={disp} />},\r\n            '',\r\n            {type: 'component', label: '', component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> },\r\n        ];\r\n        return <Page header={'UQ - '}>\r\n            <PropGrid rows={this.rows} values={this.props} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, Media, PropGrid} from 'tonva';\r\nimport {nav, Page}  from 'tonva';\r\nimport {appIcon} from '../consts';\r\nimport {caches} from '../store';\r\nimport {span} from './span';\r\nimport {UnitSpan} from './unitSpan';\r\n\r\nexport interface ServerSpanProps {\r\n    className?: string;\r\n    id: number;\r\n    isLink?: boolean;\r\n}\r\n\r\n@observer\r\nexport class ServerSpan extends React.Component<ServerSpanProps> {\r\n    onClick = (evt) => {\r\n        evt.preventDefault();\r\n        nav.push(<ServerInfo id={this.props.id} />)\r\n        return false;\r\n    }\r\n    render() {\r\n        let {id, isLink, className} = this.props;\r\n        let server = caches.servers.get(id);\r\n        let content:any;\r\n        if (server === null) {\r\n            content = id;\r\n        }\r\n        else {\r\n            let {ip, name, url} = server;\r\n            if (name !== undefined) {\r\n                content = <>\r\n                    {name}&nbsp; <small className=\"text-muted\">{url || ip}</small>\r\n                </>;\r\n            }\r\n            else {\r\n                content = id;\r\n            }\r\n        }\r\n        if (!content) content = <small className=\"text-muted\">[]</small>;\r\n        return span(isLink, className, this.onClick, content);\r\n    }\r\n}\r\n\r\nclass ServerInfo extends React.Component<ServerSpanProps> {\r\n    private rows:Prop[];\r\n    render() {\r\n        let server = caches.servers.get(this.props.id);\r\n        let {discription, ip, unit} = server;\r\n        /*\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        */\r\n        this.rows = [\r\n            '',\r\n            {type: 'component', component: <Media icon={appIcon} main={discription} discription={ip} />},\r\n            '',\r\n            {type: 'component', label: '', component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> },\r\n            {type: 'string', label: '', name: 'cloud'},\r\n        ];\r\n        return <Page header={' - '}>\r\n            <PropGrid rows={this.rows} values={this.props} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {nav, Page} from 'tonva';\r\n\r\ninterface StringValueEditProps {\r\n    title: string;\r\n    onChanged:(value:any, orgValue:any)=>Promise<string|void>;\r\n    value?: any;\r\n    buttonText?: string;\r\n    info?: string;\r\n}\r\ninterface StringValueEditState {\r\n    disabled: boolean;\r\n    error?: string;\r\n}\r\n\r\nexport class StringValueEdit extends React.Component<StringValueEditProps, StringValueEditState> {\r\n    //private input:HTMLInputElement;\r\n    protected value: string;\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            disabled: true,\r\n        };\r\n    }\r\n    /*\r\n    private ref = (input:HTMLInputElement) => {\r\n        if (!input) return;\r\n        input.value = this.props.value || '';\r\n        this.input = input;\r\n    }*/\r\n    private onChange = (evt:React.FormEvent<HTMLInputElement>) => {\r\n        let val = this.props.value;\r\n        let org = val && val.trim();\r\n        this.value = evt.currentTarget.value.trim();\r\n        this.setState({\r\n            disabled: org === this.value\r\n        });\r\n        \r\n    }\r\n    protected onSubmit = async () => {\r\n        let val = this.props.value;\r\n        let org = val && val.trim();\r\n        let v = this.value; // this.input.value.trim();\r\n        let onChanged = this.props.onChanged;\r\n        if (onChanged !== undefined) {\r\n            let ret = await onChanged(v, org);\r\n            if (typeof ret === 'string') {\r\n                this.setState({error: ret});\r\n                return;\r\n            }\r\n            nav.pop();\r\n        }\r\n    }\r\n    protected renderControl() {\r\n        return <input className=\"form-control w-100\" type=\"text\"\r\n            // ref={this.ref}\r\n            defaultValue={this.props.value}\r\n            onChange={this.onChange} />\r\n    }\r\n    render() {\r\n        let {title, buttonText, info} = this.props;\r\n        let {disabled, error} = this.state;\r\n        let right = <button\r\n            className=\"btn btn-success btn-sm\"\r\n            disabled={disabled}\r\n            onClick={this.onSubmit}\r\n        >\r\n            {buttonText||''}\r\n        </button>;\r\n        let errorDiv;\r\n        if (error !== undefined) errorDiv = <div className='text-danger'>{error}</div>;\r\n        return <Page header={title} right={right}>\r\n            <div className=\"my-4 mx-3\">\r\n                {this.renderControl()}\r\n                {errorDiv}\r\n                <small className=\"d-block mt-2 text-muted\">{info}</small>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class TextValueEdit extends StringValueEdit {\r\n    /*\r\n    private textArea:HTMLTextAreaElement;\r\n    private refTextArea = (textArea:HTMLTextAreaElement) => {\r\n        if (!textArea) return;\r\n        textArea.value = this.props.value || '';\r\n        this.textArea = textArea;\r\n    }\r\n    */\r\n    private onTextAreaChange = (evt:React.FormEvent<HTMLTextAreaElement>) => {\r\n        let val = this.props.value;\r\n        let org = val && val.trim();\r\n        this.value = evt.currentTarget.value.trim();\r\n        this.setState({\r\n            disabled: org === this.value\r\n        })\r\n    }\r\n    protected renderControl() {\r\n        return <textarea className=\"form-control w-100\" rows={8}\r\n            // ref={this.refTextArea}\r\n            defaultValue={this.props.value}\r\n            onChange={this.onTextAreaChange} />\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { nav, Page } from 'tonva';\r\nimport { SearchBox, List } from 'tonva';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport interface IdPickPageProps {\r\n    caption: string;\r\n    searchPlaceHolder?: string;\r\n    candidateItems: ((params:any, key:string) => Promise<any[]>) | any[];\r\n    moreCandidates: () => Promise<void>;\r\n    row: (item:any, index:number) => JSX.Element;\r\n    idFromItem: (item:any) => number;\r\n    resolve: (item?: any) => void;\r\n    params: any;\r\n}\r\n\r\n@observer\r\nexport class IdPickPage extends React.Component<IdPickPageProps> {\r\n    @observable private items:any[];\r\n\r\n    async componentDidMount() {\r\n        let {candidateItems, params} = this.props;\r\n        this.items = Array.isArray(candidateItems)? \r\n            candidateItems \r\n            : await candidateItems(params, '');\r\n    }\r\n    private itemClick = (item:any):Promise<void> => {\r\n        let {resolve, idFromItem} = this.props;\r\n        resolve(idFromItem(item));\r\n        nav.pop();\r\n        return;\r\n    }\r\n    private onSearch = async (key: string):Promise<void> => {\r\n        let {candidateItems, params} = this.props;\r\n        if (typeof candidateItems === 'function') {\r\n            let ret = await candidateItems(params, key);\r\n            this.items = ret;\r\n        }\r\n        return;\r\n    }\r\n    render() {\r\n        let {caption, row, searchPlaceHolder} = this.props;\r\n        return <Page header={caption} back=\"close\">\r\n            <div className=\"container\">\r\n                <SearchBox className=\"my-2\" \r\n                    onSearch={this.onSearch} \r\n                    placeholder={searchPlaceHolder}\r\n                    maxLength={100} />\r\n            </div>\r\n            <List items={this.items} item={{onClick:this.itemClick, render:row}} />\r\n        </Page>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {nav, Page} from 'tonva';\r\nimport {IdPick, IdPickFace} from 'tonva-form';\r\nimport {List, SearchBox} from 'tonva';\r\n\r\nexport interface IdPickProps {\r\n    caption: string;\r\n    searchPlaceHolder?: string;\r\n    candidateItems: ((params:any, key:string) => Promise<any[]>) | any[];\r\n    moreCandidates: () => Promise<void>;\r\n    row: (item:any, index:number) => JSX.Element;\r\n}\r\n\r\nexport function createIdPick(props: IdPickProps):IdPick {\r\n    return function(face: IdPickFace, params: any):Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            nav.push(<IdPickPage resolve={resolve} face={face} params={params} {...props} />);\r\n        });\r\n    }\r\n}\r\n\r\ninterface IdPickPageProps extends IdPickProps {\r\n    face: IdPickFace;\r\n    resolve: (item?: any) => void;\r\n    params: any;\r\n}\r\ninterface IdPickPageState {\r\n    items?: any[];\r\n}\r\n\r\nclass IdPickPage extends React.Component<IdPickPageProps, IdPickPageState> {\r\n    private items:any[];\r\n    constructor(props:IdPickPageProps) {\r\n        super(props);\r\n        this.state = {\r\n            items: null,\r\n        }\r\n        this.itemClick = this.itemClick.bind(this);\r\n        this.onSearch = this.onSearch.bind(this);\r\n    }\r\n    async componentDidMount() {\r\n        let {candidateItems, params} = this.props;\r\n        this.setState({\r\n            items: Array.isArray(candidateItems)? candidateItems : await candidateItems(params, ''),\r\n        });\r\n    }\r\n    itemClick(item:any) {\r\n        let {resolve} = this.props;\r\n        resolve(item);\r\n        nav.pop();\r\n    }\r\n    async onSearch(key: string) {\r\n        //alert('search ' + key);\r\n        //await store.dev.searchServer.first(key)\r\n        let {candidateItems, params} = this.props;\r\n        if (typeof candidateItems === 'function') {\r\n            let ret = await candidateItems(params, key);\r\n            this.setState({items: ret});\r\n        }\r\n    }\r\n    render() {\r\n        let {caption, row, searchPlaceHolder} = this.props;\r\n        return <Page header={caption} back=\"close\">\r\n            <div className=\"container\">\r\n                <SearchBox className=\"my-2\" \r\n                    onSearch={this.onSearch} \r\n                    placeholder={searchPlaceHolder}\r\n                    maxLength={100} />\r\n            </div>\r\n            <List items={this.state.items} item={{onClick:this.itemClick, render:row}} />\r\n        </Page>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport {Media, List, LMR, Prop, PropGrid, FA} from 'tonva';\r\nimport {nav} from 'tonva';\r\nimport {IdDates, UnitSpan} from '../tools';\r\nimport {UnitApp} from '../model';\r\nimport {store} from '../store';\r\nimport { devApi } from 'api';\r\n\r\n@observer\r\nexport class Info extends React.Component<{app:UnitApp, appActed?:(appId:number, inUnit:number)=>void}> {\r\n    @observable private uqAccesses: any[];\r\n    async componentDidMount() {\r\n        this.uqAccesses = await devApi.loadAppUqs(this.props.app.id);\r\n    }\r\n\r\n    private renderUqRow = (uqAccess:any, index:number):JSX.Element => {\r\n        let {name, owner, discription} = uqAccess;\r\n        return <LMR className=\"py-2\" right={<small className=\"text-muted\">{discription}</small>}>\r\n            {owner} / {name}\r\n        </LMR>;\r\n    }\r\n\r\n    private act = async () => {\r\n        let {app, appActed} = this.props;\r\n        let {id, inUnit} = app;\r\n        let newInUnit:number = 1;\r\n        if (inUnit === 0) {\r\n            let ret = await store.restoreUnitApp(id);\r\n            if (ret <= 0) alert('app  uq  service');\r\n        }\r\n        else if (inUnit === 1) {\r\n            await store.stopUnitApp(id);\r\n            newInUnit = 0;\r\n        }\r\n        else {\r\n            let newApp:UnitApp = _.clone(app);\r\n            newApp.id = id;\r\n            newApp.inUnit = 1;\r\n            let ret = await store.addUnitApp(newApp);\r\n            if (ret <= 0) alert('app  uq  service');\r\n        }\r\n        if (appActed !== undefined) {\r\n            appActed(id, newInUnit);\r\n        }\r\n        nav.pop();\r\n    }\r\n    render() {\r\n        let {unit, name, discription, icon, inUnit, date_init, date_update} = this.props.app;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        let faName:string, text:string, color:string;\r\n        if (inUnit === 1) {\r\n            faName = 'ban';\r\n            text = 'APP';\r\n            color = 'btn-danger';\r\n        }\r\n        else if (inUnit === 0) {\r\n            faName = 'refresh';\r\n            text = 'APP';\r\n            color = 'btn-success';\r\n        }\r\n        else {\r\n            faName = 'plus';\r\n            text = 'APP';\r\n            color = 'btn-primary';\r\n        }\r\n        let rows:Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component', \r\n                component: <Media icon={icon} main={name} discription={disp} />\r\n            },\r\n            '',\r\n            {\r\n                type: 'component', \r\n                label: '', \r\n                component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div>\r\n            },\r\n            {\r\n                type: 'component', \r\n                label: 'UQ', \r\n                component: <List className=\"w-100\" items={this.uqAccesses} item={{render: this.renderUqRow}} />\r\n            },\r\n            '',\r\n            '',\r\n            {\r\n                type: 'component', \r\n                bk: '', \r\n                component: <button className={classNames('btn', 'w-100', color)} onClick={this.act}>\r\n                    <FA name={faName} size=\"lg\" /> {text}\r\n                </button>\r\n            },\r\n        ];\r\n        return <div>\r\n            <PropGrid rows={rows} values={this.props} />\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {IObservableArray} from 'mobx';\r\nimport {observer} from 'mobx-react';\r\nimport {SearchBox, List, LMR, Badge} from 'tonva';\r\nimport {nav, Page, PageItems, Image} from 'tonva';\r\nimport {mainApi} from '../api';\r\nimport {store} from '../store';\r\nimport {UnitApp} from '../model';\r\nimport {Info} from './info';\r\n\r\nclass PageApps extends PageItems<UnitApp> {\r\n    private unitId:number;\r\n    constructor(unitId:number) {\r\n        super();\r\n        this.unitId = unitId;\r\n\t}\r\n\t/*\r\n    protected async load():Promise<UnitApp[]> {\r\n        return await mainApi.searchApp(this.unitId, this.param, this.pageStart, this.pageSize);\r\n\t}\r\n\t*/\r\n    protected async loadResults(param: any, pageStart: any, pageSize: number): Promise<{\r\n        [name: string]: any[];\r\n    }> {\r\n\t\tlet ret = await mainApi.searchApp(this.unitId, this.param, this.pageStart, this.pageSize);\r\n\t\treturn {$page: ret};\r\n\t}\r\n    protected setPageStart(item:UnitApp) {\r\n        if (item === undefined)\r\n            this.pageStart = 0;\r\n        else\r\n            this.pageStart = item.id;\r\n    }\r\n}\r\n\r\n@observer\r\nexport class NewApp extends React.Component {\r\n    private apps: PageApps;\r\n    constructor(props:any) {\r\n        super(props);\r\n        this.apps = new PageApps(store.unit.id);\r\n    }\r\n    private onSearch = async (key:string) => {\r\n        await this.apps.first(key);\r\n    }\r\n    private appClick = (app:UnitApp) => {\r\n        nav.push(<Page header=\"App\">\r\n            <Info app={app} appActed={this.appActed}/>\r\n        </Page>);\r\n    }\r\n    private appActed = (appId:number, inUnit:number) => {\r\n        let apps = this.apps.items as IObservableArray<UnitApp>; //.replace .find(v => v.id === appId);\r\n        let app = apps.find(v => v.id === appId);\r\n        app.inUnit = inUnit;\r\n        apps.replace([app]);\r\n    }\r\n    private renderApp(app:UnitApp):JSX.Element {\r\n        let {name, discription, icon, inUnit} = app;\r\n        let right;\r\n        if (inUnit === 1)\r\n            right = <small></small>;\r\n        else if (inUnit === 0)\r\n            right = <small></small>;\r\n        return <LMR className=\"px-3 py-2\"\r\n            left={<Badge><Image src={icon} /></Badge>}\r\n            right={right}>\r\n            <div className=\"px-3\">\r\n                <div>{name}</div>\r\n                <small className=\"text-muted\">{discription}</small>\r\n            </div>\r\n        </LMR>;\r\n    }\r\n    render() {\r\n        let items = this.apps.items;\r\n        let center = <SearchBox onSearch={this.onSearch} \r\n            className=\"w-100 mx-1\" \r\n            placeholder=\"App\" \r\n            maxLength={100} />;\r\n        return <Page header={center}>\r\n            <List\r\n                items={items}\r\n                item={{onClick:this.appClick, render:this.renderApp}}\r\n                before=\"App\" />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {List, FA, LMR, Badge} from 'tonva';\r\nimport {nav, Page, Image} from 'tonva';\r\nimport {store} from '../store';\r\nimport {NewApp} from './new';\r\nimport {UnitApp} from '../model';\r\nimport {Info} from './info';\r\n\r\n@observer\r\nexport default class AppsPage extends React.Component {\r\n    async componentDidMount() {\r\n        await store.loadApps();\r\n    }\r\n    private itemRender(app:UnitApp, index:number) {\r\n        let {name, discription, icon, inUnit} = app;\r\n        let ban;\r\n        if (inUnit === 0)\r\n            ban = <FA className=\"text-danger\" name='ban' />;\r\n        return <LMR className=\"px-3 py-1\"\r\n            left={<Badge><Image src={icon} /></Badge>}\r\n            right={ban}>\r\n            <div className=\"px-3\">\r\n                <div>{name}</div>\r\n                <small className=\"text-muted\">{discription}</small>\r\n            </div>\r\n        </LMR>;\r\n    }\r\n    private appClick(app:UnitApp) {\r\n        nav.push(<Page header=\"App\">\r\n            <Info app={app} />\r\n        </Page>);\r\n    }\r\n    private newItem() {\r\n        nav.push(<NewApp {...this.props} />);\r\n    }\r\n    render() {\r\n        let right = <button \r\n            className='btn btn-success btn-sm mr-1 align-self-center' \r\n            onClick={()=>this.newItem()}><FA name=\"plus\" /></button>;\r\n        return <Page header=\"App\" right={right}>\r\n            <List items={store.apps} item={{render: this.itemRender, onClick: this.appClick}} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, Image, EasyDate } from 'tonva';\r\nimport { AppController } from '.';\r\nimport { List, LMR, Badge, FA } from 'tonva';\r\nimport { DevApp } from 'model';\r\n\r\nexport class AppsPage extends VPage<AppController> {\r\n    async open(param:any) {\r\n        this.openPage(this.page);\r\n    }\r\n    private page = ():JSX.Element => {\r\n        let {appList, listRowClick, showNewApp} = this.controller;\r\n        let right = <button className='btn btn-success btn-sm mr-2' onClick={showNewApp}>\r\n\t\t\t<FA name=\"plus\" /></button>;\r\n        return <Page header=\"App\" right={right}>\r\n            <List items={appList} item={{render: this.appRow, onClick: listRowClick}} />\r\n        </Page>\r\n    }\r\n    private appRow = (item:DevApp):JSX.Element => {\r\n        let {name, caption, icon, date_init} = item;\r\n        let left = <Badge size=\"sm\"><Image src={icon} /></Badge>;\r\n        /*let urlDiv = <div className=\"text-muted small\">\r\n            {url || '-'} {urlDebug}\r\n        </div>;*/\r\n        let spanCaption = caption?\r\n            <><div className=\"small text-muted\">{name}</div><div><b>{caption}</b></div></> :\r\n            <div><b>{name}</b></div>;\r\n        //let disDiv = <div><Muted>{discription}</Muted></div>\r\n        let right = <small className=\"text-muted\"><EasyDate date={date_init} /></small>;\r\n        return <LMR className=\"py-2 px-3 align-items-stretch\" left={left} right={right}>\r\n            <div className=\"px-3\">\r\n                {spanCaption}\r\n            </div>\r\n        </LMR>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport { AppController } from '.';\r\nimport { VPage, nav, Page, ItemSchema, UiSchema, StringSchema, BoolSchema, \r\n    UiTextItem, UiTextAreaItem, UiCheckItem, Form, \r\n    ButtonSchema, Context, ImageSchema, UiImageItem, IdSchema, UiIdItem } from 'tonva';\r\n//import { IdPickProps } from 'createIdPick';\r\nimport { store } from 'store';\r\nimport { IdPickPage, ServerSpan } from '../../tools';\r\nimport { observer } from 'mobx-react';\r\nimport { DevServer, DevApp } from 'model';\r\n\r\nconst ServerCaption = (item:DevServer) => {\r\n    let {discription, cloud, ip} = item;\r\n    return <>{discription} {cloud} {ip}</>;\r\n}\r\n/*\r\nconst idPickServerProps: IdPickProps = {\r\n    caption: '',\r\n    searchPlaceHolder: '',\r\n    candidateItems: async (params:any, key:string) => {\r\n        await store.dev.searchServer.first(key);\r\n        return store.dev.searchServer.items;\r\n    },\r\n    moreCandidates: async () => {\r\n        await store.dev.searchServer.more();\r\n    },\r\n    row: (item:Server, index:number) => {\r\n        return <div className=\"px-3 py-2\"><ServerCaption {...item} /></div>;\r\n    },\r\n};\r\n*/\r\nconst schema:ItemSchema[] = [\r\n    {name: 'name', type: 'string', maxLength: 100, required: true} as StringSchema,\r\n    {name: 'caption', type: 'string', maxLength: 100} as StringSchema,\r\n    {name: 'discription', type: 'string', maxLength: 250} as StringSchema,\r\n    {name: 'url', type: 'string', maxLength: 200} as StringSchema,\r\n    {name: 'public', type: 'boolean'} as BoolSchema,\r\n    {name: 'server', type: 'id'} as IdSchema,\r\n    {name: 'icon', type: 'image'} as ImageSchema,\r\n    {name: 'submit', type: 'submit'} as ButtonSchema,\r\n];\r\n\r\nexport abstract class EditBasePage extends VPage<AppController> {\r\n    private candidateItems = async (params:any, key:string):Promise<any[]> => {\r\n        await store.dev.searchServer.first(key);\r\n        return store.dev.searchServer.items;\r\n    }\r\n\r\n    private moreCandidates = async ():Promise<void> => {\r\n        await store.dev.searchServer.more();\r\n    }\r\n\r\n    private renderRow = (item:DevServer, index:number): JSX.Element => {\r\n        return <div className=\"px-3 py-2\"><ServerCaption {...item} /></div>;\r\n    }\r\n\r\n    private pickServerId = (context:Context, name:string, value:number): Promise<number> => {\r\n        return new Promise<number>((resolve, reject) => {\r\n            nav.push(<IdPickPage \r\n                caption=\"\" \r\n                searchPlaceHolder=\"\"\r\n                candidateItems={this.candidateItems}\r\n                moreCandidates={this.moreCandidates}\r\n                row={this.renderRow}\r\n                idFromItem={(item:DevServer) => item.id}\r\n                resolve={resolve} params={undefined} />, \r\n                ()=> {\r\n                    reject();\r\n                });\r\n        });\r\n    }\r\n\r\n    private renderServerInput = (itemId:number): JSX.Element => {\r\n        return <ServerSpan id={itemId} />;\r\n    };\r\n\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            name: {widget: 'text', label: ''} as UiTextItem,\r\n            caption: {widget: 'text', label: ''} as UiTextItem,\r\n            discription: {widget: 'textarea', label: '', rows: 5} as UiTextAreaItem,\r\n            url: {widget: 'text', label: 'URL', placeholder: 'http(s)://APP'} as UiTextItem,\r\n            'public': {widget: 'checkbox', label: '', } as UiCheckItem,\r\n            server: {widget: 'id', label: '', pickId: this.pickServerId, Templet: this.renderServerInput} as UiIdItem,\r\n            icon: {widget: 'image', label: ''} as UiImageItem,\r\n            submit: {widget: 'button', label: '', className: 'btn btn-primary'}\r\n        }\r\n    }\r\n    \r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n    private onButtonClick = async (name:string, context: Context) => {\r\n        let {data} = context;\r\n        let app:DevApp = _.clone(this.controller.app) || {} as any;\r\n        _.merge(app, data);\r\n        await this.controller.saveApp(app);\r\n        nav.pop();\r\n    }\r\n    protected page: ()=>JSX.Element;\r\n    protected form = observer(() => {\r\n        return <Form fieldLabelSize={2}\r\n            className=\"m-3\" \r\n            schema={schema} \r\n            uiSchema={this.uiSchema}\r\n            formData={this.initValues}\r\n            onButtonClick={this.onButtonClick} />\r\n    });\r\n    abstract get initValues():any;\r\n}\r\n\r\nexport class EditPage extends EditBasePage {\r\n    get initValues():any {return this.controller.app}\r\n    protected page = () => {\r\n        let {app} = this.controller;\r\n        let {name} = app;\r\n        return <Page header={'APP - ' + name} back=\"close\">\r\n            {React.createElement(this.form)}\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class NewPage extends EditBasePage {\r\n    get initValues():any {return {}}\r\n    protected page = () => {\r\n        return <Page header={'APP'} back=\"close\">\r\n            {React.createElement(this.form)}\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { List, LMR, SearchBox } from 'tonva';\r\nimport { Page, VPage } from 'tonva';\r\nimport { AppController } from '.';\r\nimport { DevUQ } from 'model';\r\n\r\nexport class SearchUqPage extends VPage<AppController> {\r\n    @observable private uqs: DevUQ[];\r\n\r\n    async open() {\r\n        //this.uqs = await this.controller.getMyUqs();\r\n        let pageStart = 0, pageSize = 200;\r\n        this.uqs = await this.controller.searchUq('', pageStart, pageSize);\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onSearch = async (key:string) => {\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        this.uqs = await this.controller.searchUq(key, pageStart, pageSize);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {onUq} = this.controller;\r\n        let header = <SearchBox className=\"w-100 mx-1\" \r\n            label=\"UQ \"\r\n            onSearch={this.onSearch}\r\n            placeholder=\"UQ\" \r\n            maxLength={100} />;\r\n        return <Page back=\"close\" header={header}>\r\n            <List items={this.uqs} item={{render: this.row, onClick: onUq}} />\r\n        </Page>;\r\n    });\r\n\r\n    private row = (uq: DevUQ) => {\r\n        let {owner, name, discription} = uq;\r\n        return <LMR className=\"py-2 px-3\" right={discription}>\r\n            <div>{owner} / {name}</div>\r\n        </LMR>;\r\n    };\r\n}\r\n/*\r\n@observer\r\nexport class AppUqs extends React.Component {\r\n    @observable anySelected: boolean = false;\r\n    private list:List;\r\n    private onSelect = (item: UQ, isSelected:boolean, anySelected:boolean) => {\r\n        this.anySelected = anySelected;\r\n    }\r\n    private row = (item: UQ) => {\r\n        let {name, unit, discription} = item;\r\n        return <LMR className=\"px-3 py-2\" right={<small className=\"text-muted\">{discription}</small>}>\r\n            <UnitSpan id={unit} />/{name}\r\n        </LMR>;\r\n    }\r\n    private removeBind = () => {\r\n        if (this.list === null) return;\r\n        let {selectedItems} = this.list;\r\n        if (selectedItems === undefined) return;\r\n        if (selectedItems.length === 0) return;\r\n        store.dev.apps.appRemoveUq(selectedItems.map(v => v.id));\r\n    }\r\n    render() {\r\n        let btnProps = this.anySelected?\r\n            {color:'danger', onClick:this.removeBind, icon:'trash', text:''}:\r\n            {color:'primary', onClick:()=>nav.push(<Uqs/>), icon:'plus', text:''};\r\n        let btn = (p)=><button \r\n            className={classNames('btn', 'btn-outline-'+p.color, 'btn-sm')} \r\n            onClick={p.onClick}>\r\n            <i className={\"fa fa-\" + p.icon} /> {p.text}\r\n        </button>;\r\n        let listHeader = <div className=\"va-row py-1 justify-content-center\">{btn(btnProps)}</div>;\r\n        return <Page header=\"UQ\">\r\n            <List ref={list=>this.list=list} header={listHeader}\r\n                items={store.dev.apps.uqs}\r\n                item={{render: this.row, onSelect: this.onSelect}} />\r\n        </Page>;\r\n    }\r\n}\r\n\r\n@observer\r\nclass Uqs extends React.Component {\r\n    onSearch = async (key:string) => {\r\n        await store.dev.apps.searchUq(key);\r\n    }\r\n    onBind(uq: UQ, bind: boolean) {\r\n        store.dev.apps.appBindUq([uq.id]);\r\n    }\r\n    row = (uq: UQ) => {\r\n        let isConnected = store.dev.apps.uqs.find(a => a.id === uq.id) !== undefined;\r\n        let cn = ['btn', 'btn-sm'];\r\n        let btnContent:any, onClick:any;\r\n        if (isConnected) {\r\n            cn.push('btn-success');\r\n            //onClick = ()=>this.onBind(uq, false);\r\n            btnContent = <div></div>;\r\n        }\r\n        else {\r\n            cn.push('btn-primary');\r\n            onClick = ()=>this.onBind(uq, true);\r\n            btnContent = <button className={classNames(cn)} onClick={onClick}><span><i className=\"fa fa-check\"/> </span></button>;\r\n        }\r\n        return <div className=\"d-flex justify-content-start py-1 px-3\">\r\n            <div className=\"align-self-center\">{uq.name + ' - ' + uq.discription}</div>\r\n            <footer className=\"ml-auto\">{btnContent}</footer>\r\n        </div>\r\n    }\r\n    render() {\r\n        let header = <SearchBox className=\"w-100 mx-1\" \r\n            onSearch={this.onSearch} \r\n            placeholder=\"UQ\" \r\n            maxLength={100} />;\r\n        return <Page back=\"close\" header={header}>\r\n            <List items={store.dev.apps.searchedUqs} item={{render: this.row}} loading={null} />\r\n        </Page>;\r\n    }\r\n}\r\n*/","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page, nav, Prop, Media, PropGrid, DropdownActions, List, LMR, FA } from 'tonva';\r\nimport { AppController/*, UqAccess*/ } from '.';\r\nimport { IdDates, UnitSpan, ServerSpan, UnitName } from 'tools';\r\nimport { EditPage } from './editPage';\r\nimport { SearchUqPage } from './appUqs';\r\nimport { DevUQ } from 'model';\r\n//import { DevModel } from 'model';\r\n\r\nexport class AppPage extends VPage<AppController> {\r\n    async open() {\r\n        //this.uqs.list = this.controller.uqs;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private editItem = async () => {\r\n        await this.openVPage(EditPage);\r\n        //nav.push(<EditAppPage {...this.props} />);\r\n    }\r\n\r\n    private deleteItem = async () => {\r\n        if (window.confirm('') === true) {\r\n            await this.controller.deleteApp();\r\n            nav.pop();\r\n        }\r\n    }\r\n\r\n    private page = observer(():JSX.Element => {\r\n        let {app, uqs} = this.controller;\r\n        //let mainId = mainUq === undefined? 0: mainUq.id;\r\n        let {unit, name, caption, discription, icon, server, date_init, date_update} = app;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        let menuItems = [\r\n            // {icon: 'cogs', caption:'UQ', action: ()=>nav.push(<AppUqs />)},\r\n            {caption:'App', action:this.editItem, icon:'edit' },\r\n            {caption:'', action:this.deleteItem, icon:'trash-o' }\r\n        ];\r\n\r\n        let right = <DropdownActions actions={menuItems} className=\"btn-primary mr-2\" />;\r\n        let spanCaption = caption?\r\n            <>{name}: <b>{caption}</b></> :\r\n            <b>{name}</b>;\r\n        let rows:Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component', \r\n                component: <Media icon={icon} main={spanCaption} discription={disp} />\r\n            },\r\n            '',\r\n            {\r\n                type: 'component', \r\n                label: '', \r\n                component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> \r\n            },\r\n            /*\r\n            {\r\n                type: 'component', \r\n                label: 'Service',\r\n                vAlign: 'stretch',\r\n                component: <ServiceRow />,\r\n            },*/\r\n            {\r\n                label: 'URL',\r\n                name: 'url',\r\n                type: 'string',                \r\n            },\r\n            {\r\n                type: 'component',\r\n                label: '',\r\n                component: <ServerSpan id={server} />\r\n            },\r\n            '',\r\n            //this.uqs,\r\n        ];\r\n        let btnAddUq = <button\r\n            className=\"btn btn-outline-primary btn-sm\" \r\n            onClick={()=>this.openVPage(SearchUqPage)}>UQ</button>;\r\n        //let slaveUqs = uqs.filter(v => v.id !== mainId);\r\n        return <Page header={'App - ' + name} right={right}>\r\n            <PropGrid rows={rows} values={app} />\r\n            <LMR className=\"mx-3 mt-3 mb-1\" right={btnAddUq}>UQ</LMR>\r\n            <List \r\n                items={uqs} \r\n                item={{render:this.renderUqRow, onClick:this.uqClick}} />\r\n        </Page>\r\n    })\r\n\r\n    private uqClick = (uq:DevUQ) => {\r\n        this.controller.onUq(uq);\r\n    }\r\n\r\n    private renderUqRow = (uq:DevUQ, index:number):JSX.Element => {\r\n        if (uq === undefined) return null;\r\n        let {name, discription, unit} = uq;\r\n        let right = discription && <div className=\"small text-muted\"> &nbsp; {discription}</div>;\r\n        let isMain = this.controller.isMain(uq);\r\n        let cn = classNames(\"px-3 py-2 align-items-center bg-white\", isMain===true && \"font-weight-bold my-2\");\r\n        return <LMR className={cn} right={right}>\r\n            {isMain===true &&  <FA className=\"text-warning mr-3\" name=\"star-o\" />}\r\n             <UnitName id={unit} /> / {name}\r\n        </LMR>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, nav, FA } from 'tonva';\r\nimport { AppController } from '.';\r\nimport { LMR } from 'tonva';\r\nimport { DevUQ } from 'model';\r\n\r\nexport class UqBindPage extends VPage<AppController> {\r\n    private uq: DevUQ;\r\n    //private accesses: string[];\r\n    //private accessChecked:{[name:string]:boolean};\r\n    async open(uq: DevUQ) {\r\n        this.uq = uq;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private saveUqBind = async () => {\r\n        await this.controller.saveUqBind(this.uq/*, acc*/);\r\n        this.closePage(2);\r\n    }\r\n\r\n    private removeUqBind = async () => {\r\n        await this.controller.removeUqBind(this.uq);\r\n        nav.pop();\r\n    }\r\n\r\n    private setMainUQ = async () => {\r\n        this.controller.saveSetUqMain(this.uq);\r\n        this.closePage();\r\n    }\r\n\r\n    private page = ():JSX.Element => {\r\n        //let {uq/*, bind_access*/} = this.uqAccess;\r\n        let {owner, name, discription} = this.uq;\r\n        let btnLeft:any, btnRight:any;\r\n        if (this.controller.isBinded(this.uq) === true) {\r\n            if (this.controller.isMain(this.uq) === false) {\r\n                btnLeft = <button className=\"btn btn-primary btn-sm\" onClick={this.setMainUQ}>UQ</button>;\r\n            }\r\n            else {\r\n                btnLeft = <div><FA className=\"text-warning\" name=\"star-o\" /> UQ</div>;\r\n            }\r\n            btnRight = <button className=\"btn btn-outline-danger btn-sm\" onClick={this.removeUqBind}></button>;\r\n        }\r\n        else {\r\n            btnLeft = <button className=\"btn btn-primary btn-sm\" onClick={this.saveUqBind}></button>;\r\n        }\r\n        //let btnDelete = <button className=\"btn btn-outline-danger btn-sm\" onClick={this.removeUqBind}></button>;\r\n        /*\r\n        if (bind_access !== null && bind_access !== undefined) {\r\n            btnDelete = <button className=\"btn btn-outline-danger btn-sm\" onClick={this.removeUqBind}></button>;\r\n        }\r\n        */\r\n        /*\r\n        let checkAccessList:any;\r\n        if (this.accesses) {\r\n            checkAccessList = <div className=\"mt-3\">\r\n            {\r\n                this.accesses.map(v => {\r\n                    let checked = this.accessChecked[v];\r\n                    return <label key={v} className=\"d-inline-block mr-4\">\r\n                        <input onChange={this.onCheckChanged}\r\n                            style={{width:'1.1rem', height:'1.1rem'}} \r\n                            name={v} type=\"checkbox\" defaultChecked={checked} />&nbsp;{v}\r\n                    </label>;\r\n                })\r\n            }\r\n            </div>;\r\n        }\r\n        */\r\n        return <Page header=\"UQ\">\r\n            <div className=\"m-3 py-3 px-3 bg-white border\">\r\n                <div>{owner} / {name}</div>\r\n                <div className=\"text-muted\">{discription}</div>\r\n                {/*checkAccessList*/}\r\n                <LMR className=\"pt-3\" right={btnRight}>{btnLeft}</LMR>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}","import _ from 'lodash';\r\nimport { observable } from 'mobx';\r\nimport { Controller } from 'tonva';\r\nimport { devApi } from 'api';\r\nimport { AppsPage } from './appsPage';\r\nimport { AppPage } from './appPage';\r\nimport { UqBindPage } from './uqBindPage';\r\nimport { NewPage } from './editPage';\r\nimport { DevApp, DevUQ } from 'model';\r\n\r\n/*\r\nexport interface UqAccess {\r\n    uq: UQ;\r\n    //bind_access: string[];\r\n}\r\n*/\r\n\r\nexport class AppController extends Controller {\r\n    private unitId: number;\r\n    app: DevApp;\r\n    @observable appList: DevApp[];\r\n    @observable uqs: DevUQ[];\r\n    @observable uqMain: DevUQ;\r\n    protected async internalStart(unitId:any) {\r\n        this.unitId = unitId;\r\n        this.appList = await devApi.apps(this.unitId);\r\n        this.openVPage(AppsPage);\r\n    }\r\n\r\n    listRowClick = async (item:DevApp) => {\r\n        this.app = item;\r\n        let {uqMain:uqMainId} = item;\r\n        let ret = await devApi.loadAppUqs(item.id);\r\n        let mainIdex:number;\r\n        this.uqs = ret.map((v, index) => {\r\n            let {owner, id, name, discription, unit, date_init, date_update} = v;\r\n            let ret = {\r\n                    id: id,\r\n                    name: name,\r\n                    discription: discription,\r\n                    unit: unit,\r\n                    //access: access,\r\n                    owner: owner,\r\n                    date_init: date_init,\r\n                    date_update: date_update, \r\n                    service_count: undefined,\r\n            }\r\n            if (id === uqMainId) {\r\n                this.uqMain = ret;\r\n                mainIdex = index;\r\n            }\r\n            return ret;\r\n        });\r\n        if (mainIdex !== undefined) {\r\n            this.uqs.splice(mainIdex, 1);\r\n            this.uqs.unshift(this.uqMain);\r\n        }\r\n        this.openVPage(AppPage);\r\n    }\r\n\r\n    saveSetUqMain = async (uq:DevUQ) => {\r\n        await devApi.appSetUqMain(this.unitId, this.app.id, uq.id);\r\n        this.setUqMain(uq);\r\n    }\r\n\r\n    private setUqMain(uq:DevUQ) {\r\n        this.uqMain = uq;\r\n        let index = this.uqs.findIndex(v => v.id === uq.id);\r\n        if (index >= 0) {\r\n            this.uqs.splice(index, 1);\r\n        }\r\n        this.uqs.unshift(uq);\r\n    }\r\n\r\n\r\n\r\n    showNewApp = () => {\r\n        this.app = undefined;\r\n        this.openVPage(NewPage);\r\n    }\r\n\r\n    saveApp = async (values: DevApp) => {\r\n        let app: DevApp;\r\n        let now = new Date();\r\n        if (this.app === undefined) {\r\n            app = _.clone(values);\r\n            app.date_init = now;\r\n        }\r\n        else {\r\n            app = _.clone(this.app);\r\n            _.merge(app, values);\r\n        }\r\n        app.unit = this.unitId;\r\n        app.date_update = now;\r\n        let ret = await devApi.saveApp(app);\r\n        app.id = ret;\r\n        let org = this.appList.find(v => v.id === ret);\r\n        if (org !== undefined) {\r\n            _.merge(org, app);\r\n        }\r\n        else {\r\n            this.appList.push(app);\r\n        }\r\n    }\r\n\r\n    isBinded = (uq:DevUQ):boolean => {\r\n        return this.uqs.findIndex(v => v.id === uq.id) >= 0;\r\n    }\r\n\r\n    isMain = (uq:DevUQ):boolean => {\r\n        return this.uqMain !== undefined && this.uqMain.id === uq.id;\r\n    }\r\n\r\n    deleteApp = async () => {\r\n        await devApi.delApp(this.unitId, this.app.id);\r\n        let index = this.appList.findIndex(v => v.id === this.app.id);\r\n        if (index >= 0) this.appList.splice(index, 1);\r\n    }\r\n\r\n    searchUq = async (key:string, pageStart:number, pageSize:number) => {\r\n        return await devApi.searchUq(this.unitId, key, pageStart, pageSize);\r\n    }\r\n\r\n    getMyUqs = async () => {\r\n        return await devApi.getMyUqs(this.unitId);\r\n    }\r\n\r\n    onUq = (uq: DevUQ) => {\r\n        this.openVPage(UqBindPage, uq);\r\n    }\r\n\r\n    saveUqBind = async (uq: DevUQ) => {\r\n        let uqs:number[] = this.uqs.map(v => v.id);\r\n        let index = uqs.findIndex(v => v === uq.id);\r\n        if (index < 0) uqs.push(uq.id);\r\n        await devApi.appBindUq(this.unitId, this.app.id, uqs);\r\n        this.uqs.push(uq);\r\n        if (this.uqs.length === 1) {\r\n            this.setUqMain(uq);\r\n        }\r\n    }\r\n\r\n    removeUqBind = async (uq: DevUQ) => {\r\n        let uqs:number[] = [];\r\n        for (let u of this.uqs) {\r\n            if (u.id !== uq.id) uqs.push(u.id);\r\n        }\r\n        await devApi.appBindUq(this.unitId, this.app.id, uqs);\r\n        let index = this.uqs.findIndex(v => v.id === uq.id);\r\n        if (index>=0) this.uqs.splice(index, 1);\r\n        if (this.uqMain && this.uqMain.id === uq.id) {\r\n            this.uqMain = undefined;\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\nimport ReactDOMServer from 'react-dom/server';\r\nimport { FA } from 'tonva';\r\nimport { observable } from 'mobx';\r\n//import { observer } from 'mobx-react';\r\n\r\nconst groupStart = '///++++++';\r\nconst groupEnd = '------///';\r\n\r\nexport abstract class Section {\r\n    rowId: number;\r\n\trender: () => JSX.Element;\r\n\trenderHtml() {\r\n\t\treturn ReactDOMServer.renderToStaticMarkup(this.render());\r\n\t}\r\n\tafterMount() {}\r\n\tisMe(name:string):boolean {return false;}\r\n}\r\n\r\nclass StringSection extends Section {\r\n    text: string;\r\n    constructor(text:string) {\r\n        super(); \r\n        this.text = text;\r\n    }\r\n    render = (): JSX.Element => {\r\n        if (this.text.trim().length === 0) return null;\r\n        let parts = this.text.split('\\n');\r\n        return <>{parts.map((v, i) => v.length === 0?\r\n            <div key={i}>&nbsp;</div> :\r\n            <div key={i}>{v}</div>\r\n        )}</>;\r\n    }\r\n}\r\n\r\nclass GroupSection extends Section {\r\n\tname: string;\r\n    group: string[];\r\n    @observable collaps: 1|2|3;\r\n    constructor(name:string, group:string[]) {\r\n\t\tsuper();\r\n\t\tthis.name = name;\r\n        this.group = group;\r\n        this.collaps = 1;\r\n\t}\r\n\tget elId() {return 'g' + this.rowId}\r\n\tget cId() {return 'c' + this.rowId}\r\n\tsetCollaps(c:1|2|3) {\r\n\t\tthis.collaps = c;\r\n\t\tlet el = document.getElementById(this.elId);\r\n\t\tlet elIcon = el.firstElementChild;\r\n\t\tif (elIcon) {\r\n\t\t\tlet fa:string;\r\n\t\t\tswitch (c) {\r\n\t\t\t\tcase 1: fa = 'fa fa-spin text-primary'; break;\r\n\t\t\t\tcase 2: fa = 'fa fa-arrow-circle-down text-success'; break;\r\n\t\t\t\tcase 3: fa = 'fa fa-arrow-circle-up text-success'; break;\r\n\t\t\t}\r\n\t\t\telIcon.className = fa;\t\t\t\r\n\t\t}\r\n\t\tif (c === 3) {\r\n             let content = ReactDOMServer.renderToStaticMarkup(<div id={this.cId}>\r\n                {\r\n                    this.group.map((v, i) => {\r\n                        if (v.trim().length === 0) return null;\r\n                        return <pre style={{whiteSpace: 'pre-wrap'}} key={i}>{v}</pre>\r\n                    })\r\n                }\r\n\t\t\t</div>);\r\n\t\t\tconst range = document.createRange();\r\n\t\t\trange.selectNode(el);\r\n\t\t\tconst child = range.createContextualFragment(content);\r\n\t\t\tel.parentNode.insertBefore(child, el.nextSibling);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet c = document.getElementById(this.cId);\r\n\t\t\tif (c) {\r\n\t\t\t\tc.parentNode.removeChild(c);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tisMe(name:string):boolean {\r\n\t\treturn this.name === name;\r\n\t}\r\n\tprivate onClick = () => {\r\n\t\tlet c = this.collaps;\r\n\t\tif (c === 1) return;\r\n\t\tif (c === 2) c = 3;\r\n\t\telse c = 2;\r\n\t\tthis.setCollaps(c);\r\n\t}\r\n\tafterMount() {\r\n\t\tlet el = document.getElementById(this.elId);\r\n\t\tif (el) {\r\n\t\t\tel.addEventListener('click', this.onClick);\r\n\t\t}\r\n\t}\r\n    render = /*observer(*/():JSX.Element => {\r\n        //let groupId = 'text-group-' + index;\r\n        let line = this.group[0];\r\n        let title: string;\r\n        let p0 = 0, p = line.indexOf('\\n');\r\n        if (p < 0) p = undefined;\r\n        else {\r\n            let l = line.indexOf('(');\r\n            if (l < p) p = l;\r\n        }\r\n        title = line.substring(p0, p);\r\n\r\n\t\tlet titleIcon:any, content:any;\r\n\t\tif (this.collaps === 1) {\r\n\t\t\ttitleIcon = <FA name='spinner' className='text-primary fa-spin' />;\r\n\t\t}\r\n        else if (this.collaps===3) {\r\n            titleIcon = <FA name='arrow-circle-up' className='text-success' />;\r\n            content = <div id={this.cId}>\r\n                {\r\n                    this.group.map((v, i) => {\r\n                        if (v.trim().length === 0) return null;\r\n                        return <pre style={{whiteSpace: 'pre-wrap'}} key={i}>{v}</pre>\r\n                    })\r\n                }\r\n            </div>;\r\n        }\r\n        else {\r\n            titleIcon = <FA name='arrow-circle-down' className='text-success' />;\r\n        }\r\n        return <>\r\n            <div id={this.elId} className=\"cursor-pointer text-primary\" onClick={this.onClick}>{titleIcon} <u>{title}</u></div>\r\n            {content}\r\n        </>;\r\n    }//);\r\n}\r\n\r\nclass EndSection extends Section {\r\n\tname: string;\r\n\tconstructor(name:string) {super(); this.name = name}\r\n}\r\n\r\nclass ErrorSection extends Section {\r\n    error: string[];\r\n    constructor(error:string[]) {super(); this.error = error}\r\n    render = ():JSX.Element => {\r\n        return <div className=\"text-danger\">\r\n            <FA name=\"exclamation-circle\" />&nbsp;\r\n            {this.error.join().split('\\n').map((v, index)=><React.Fragment key={index}>{v}<br/></React.Fragment>)}\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class ResultSections {\r\n    private text: string;\r\n    private p: number;\r\n    private group: string[];\r\n    private stop: boolean;\r\n    @observable hasError: boolean = false;\r\n    @observable seconds: number;\r\n    //readonly sections: (string | string[])[] = [];\r\n    private sectionId: number = 1;\r\n\t@observable readonly sections: Section[] = []; //observable.array([], {deep: true});\r\n\tprivate containerElement: HTMLDivElement\r\n\r\n\tconstructor(containerElement: HTMLDivElement) {\r\n\t\tthis.containerElement = containerElement;\r\n\t}\r\n\r\n    add(text:string):void {\r\n        this.stop = false;\r\n        if (this.text === undefined) {\r\n            this.p = 0;\r\n            this.text = text;\r\n        }\r\n        else {\r\n            this.text = this.text + text;\r\n        }\r\n        if (this.text.length < 10) return;\r\n        while (this.stop === false) {\r\n            this.addToGroup();\r\n            this.addText();\r\n        }\r\n\t}\r\n\t\r\n\tprivate addHtml(text:string) {\r\n\t\tconst range = document.createRange();\r\n\t\trange.selectNode(this.containerElement);\r\n\t\tconst child = range.createContextualFragment(text);\r\n\t\tthis.containerElement.appendChild(child);\r\n\t};\r\n\r\n    private addSection(section:Section) {\r\n        section.rowId = this.sectionId;\r\n        this.sectionId++;\r\n\t\tthis.sections.push(section);\r\n\t\t/*\r\n        let len = this.sections.length;\r\n        if (len > 500) {\r\n            this.sections.splice(0, len - 500);\r\n\t\t}\r\n\t\t*/\r\n\t\tlet html = section.renderHtml();\r\n\t\tthis.addHtml(html);\r\n\t\tsection.afterMount();\r\n    }\r\n\r\n    private mayStart(token:string):boolean {\r\n        let len = this.text.length - token.length;\r\n        if (this.p < len) return false;\r\n        for (let i=0; i<len; i++) {\r\n            if (this.text.charCodeAt(this.p + i) !== token.charCodeAt(i)) return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private parse():Section {\r\n        let type: string = '';\r\n\t\tlet len = this.group.length;\r\n        for (let i=0; i<len; i++) {\r\n            let ln = this.group[i];\r\n            let pos = ln.indexOf('\\n');\r\n            if (pos < 0) {\r\n                type += ln;\r\n                continue;\r\n            }\r\n            type += ln.substr(0, pos);\r\n            for (let s=0; s<i+1; s++) this.group.shift();\r\n            this.group.unshift(ln.substr(pos+1));\r\n            switch (type) {\r\n                default:\r\n\t\t\t\tcase '': \r\n                    return new GroupSection(type, this.group);\r\n                case 'error': \r\n                    this.hasError = true;\r\n                    return new ErrorSection(this.group);\r\n            }            \r\n        }\r\n\t\treturn new EndSection(type);\r\n\t}\r\n\r\n    private addToGroup():void {\r\n        if (this.group === undefined) return;\r\n        if (this.text === undefined) return;\r\n        let p = this.text.indexOf(groupEnd, this.p);\r\n        if (p < 0) {\r\n            if (this.mayStart(groupEnd) === true) return;\r\n            this.group.push(this.p === 0? this.text : this.text.substr(this.p));\r\n            this.p = 0;\r\n            this.text = undefined;\r\n            this.stop = true;\r\n            return;\r\n        }\r\n\t\tthis.group.push(this.text.substring(this.p, p));\r\n\t\tlet sec = this.parse();\r\n\t\tif (sec.render !== undefined) {\r\n\t\t\tthis.addSection(sec);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet n = (sec as EndSection).name;\r\n\t\t\tlet len = this.sections.length;\r\n\t\t\tfor (let i=len-1; i>=0; i--) {\r\n\t\t\t\tlet sec = this.sections[i];\r\n\t\t\t\tif (!sec) continue;\r\n\t\t\t\tif (sec.isMe(n) === true) {\r\n\t\t\t\t\t(sec as GroupSection).setCollaps(2);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n        this.group = undefined;\r\n        this.p = p + 9;\r\n    }\r\n\r\n    private addText():void {\r\n        if (this.text === undefined) return;\r\n        let p = this.text.indexOf(groupStart, this.p);\r\n        if (p < 0) {\r\n            if (this.mayStart(groupStart) === true) return;\r\n            this.addSection(new StringSection(this.p === 0? this.text : this.text.substr(this.p)));\r\n            this.p = 0;\r\n            this.text = undefined;\r\n            this.stop = true;\r\n            return;\r\n\t\t}\r\n\t\tlet sec = this.text.substring(this.p, p);\r\n        this.addSection(new StringSection(sec));\r\n        this.p = p + 9;\r\n        this.group = [];\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { UqActionProps } from './uqActionProps';\r\nimport { DevUQ } from 'model';\r\nimport { observer } from 'mobx-react';\r\nimport { ResultSections, Section } from './resultSections';\r\nimport { nav, Page } from 'tonva';\r\n\r\ninterface CompileResultProps extends UqActionProps {\r\n    uq: DevUQ;\r\n\tcaption?: string;\r\n    action: 'upload' | 'test' | 'deploy';\r\n\tactionName: string;\r\n    res: Response;\r\n    abortController: AbortController;\r\n}\r\n\r\n@observer\r\nexport class CompileResultPage extends React.Component<CompileResultProps> {\r\n    private resultSections: ResultSections;\r\n    private timeHandler:any;\r\n    constructor(props:CompileResultProps) {\r\n        super(props);\r\n        this.resultSections = new ResultSections(undefined);\r\n    }\r\n\tprivate autoScrollEnd:boolean = false;\r\n\tprivate autoScroll = true;\r\n    private startAutoScrollToBottom() {\r\n\t\tif (this.autoScrollEnd === true) return;\r\n\t\tthis.autoScroll = true;\r\n\t\tif (this.timeHandler !== undefined) return;\r\n        this.timeHandler = setInterval(() => {\r\n\t\t\tif (this.autoScroll === false) return;\r\n            var pane = document.getElementById('bottomDiv');\r\n            pane && pane.scrollIntoView();\r\n        }, 100);\r\n    }\r\n    private endAutoScrollToBottom() {\r\n        setTimeout(() => {\r\n\t\t\tthis.autoScroll = false;\r\n\t\t\tthis.autoScrollEnd = true;\r\n\t\t\tif (this.timeHandler === undefined) return;\r\n\t\t\tclearInterval(this.timeHandler);\r\n\t\t\tthis.timeHandler = undefined;\r\n\t\t}, 300);\r\n\t}\r\n\tprivate pauseAutoScrollToBottom() {\r\n\t\tthis.autoScroll = false;\r\n\t}\r\n    private getParent(el:HTMLElement):HTMLElement {\r\n        if (!el) return;\r\n        if (el.tagName === 'MAIN') return el;\r\n        return this.getParent(el.parentElement);\r\n    }\r\n    private topIntoView() {\r\n        var pane = document.getElementById('topDiv');\r\n        pane && pane.scrollIntoView();\r\n    }\r\n    private bottomIntoView() {\r\n        var pane = document.getElementById('bottomDiv');\r\n        pane && pane.scrollIntoView();\r\n    }\r\n    private doubleClick = () => {\r\n\t\tif (this.autoScrollEnd === true) return;\r\n        var pane = document.getElementById('scrollDiv');\r\n        let main = this.getParent(pane);\r\n        if (!main) return;\r\n        if (main.scrollTop >= main.scrollHeight / 2) {\r\n            this.topIntoView();\r\n        }\r\n        else {\r\n            this.bottomIntoView();\r\n        }\r\n    }\r\n    private lastScrollTop = 0;\r\n    private onScroll = (e:any) => {\r\n        let el = e.target as HTMLBaseElement;\r\n        let {scrollTop, scrollHeight, offsetHeight} = el;\r\n        if (scrollTop <= this.lastScrollTop) {\r\n            this.pauseAutoScrollToBottom();\r\n        }\r\n        else if (scrollTop + offsetHeight > scrollHeight - 30) {\r\n            this.startAutoScrollToBottom();\r\n        }\r\n\r\n        this.lastScrollTop = scrollTop;\r\n    }\r\n\r\n    private uintToString(uintArray:number[]):string {\r\n        let encodedString = String.fromCharCode(...uintArray);\r\n        try {\r\n            return decodeURIComponent(escape(encodedString));\r\n        }\r\n        catch (err) {\r\n            return encodedString;\r\n        }\r\n    }\r\n\r\n    private startTime: Date;\r\n\tprivate total: number;\r\n    private async pump(reader: ReadableStreamReader, resultSections: ResultSections):Promise<boolean> {\r\n\t\tlet ret = await reader.read();\r\n        let {done, value} = ret;\r\n        if (done) {\r\n            this.resultSections.seconds = (new Date().getTime() - this.startTime.getTime());\r\n            let {action, services} = this.props;\r\n            if (services !== undefined) {\r\n                let now = Date.now() / 1000;\r\n                for (let service of services) {\r\n                    switch (action) {\r\n                        case 'test': service.compile_time = now; break;\r\n                        case 'deploy': service.deploy_time = now; break;\r\n                    }\r\n                }\r\n            }\r\n            return true;\r\n\t\t}\r\n\t\tlet buf:Uint8Array = value;\r\n\t\tfor (let p=0; p<buf.length; p+=0x4000) {\r\n\t\t\tlet sec = buf.slice(p, p+0x4000);\r\n\t\t\tlet text = this.uintToString(sec as any);\r\n\t\t\t//this.resultSections.add(text);\r\n\t\t\tresultSections.add(text);\r\n\t\t\tthis.total += value.byteLength;\r\n\t\t}\r\n        return false;\r\n    }\r\n\r\n    async componentDidMount() {\r\n        nav.regConfirmClose(async ():Promise<boolean>=>{\r\n            if (this.resultSections.seconds>=0) return true;\r\n            return new Promise<boolean>((resolve, reject) => {\r\n                try {\r\n                    if (window.confirm(`${this.props.actionName}`) === true) {\r\n                        try {\r\n                            this.props.abortController.abort();\r\n                        }\r\n                        catch (err) {\r\n                            console.error(err);\r\n                        }\r\n                        resolve(true);\r\n                    }\r\n                    else {\r\n                        resolve(false);\r\n                    }\r\n                }\r\n                catch (err) {\r\n                    reject(err);\r\n                }\r\n            })\r\n        });\r\n        \r\n        this.startAutoScrollToBottom();\r\n        try {\r\n            let reader = this.props.res.body.getReader();\r\n            this.startTime = new Date();\r\n\t\t\tthis.total = 0;\r\n\t\t\tlet containerElement = document.getElementById('scrollDiv') as HTMLDivElement;\r\n\t\t\tlet resultSections = new ResultSections(containerElement);\r\n            while (true) {\r\n\t\t\t\tlet retPump = await this.pump(reader, resultSections);\r\n                if (retPump === true) break;\r\n            }\r\n        }\r\n        catch (err) {\r\n            console.error(err);\r\n        }\r\n        finally {\r\n            this.endAutoScrollToBottom();\r\n        }\r\n    }\r\n    private renderText = (section:Section, index:number):JSX.Element => {\r\n        return <section.render key={section.rowId} />;\r\n    }\r\n    render() {\r\n        let {uq, actionName, caption} = this.props;\r\n        let {seconds, /*sections, */hasError} = this.resultSections;\r\n        let finish = hasError === true? '' : '';\r\n\t\tlet header:string;\r\n\t\tif (caption) header = '[' + caption + '] ';\r\n\t\telse header = '';\r\n        if (uq !== undefined) header += uq.name + ' - ';\r\n\t\theader += actionName + (seconds>=0? finish : \"...\");\r\n        return <Page header={header} back=\"close\" onScroll={this.onScroll}>\r\n            <div id='topDiv' />\r\n            <div id='scrollDiv'\r\n                onDoubleClick={this.doubleClick} \r\n                className='py-2 px-3' \r\n                style={{wordWrap: 'break-word', whiteSpace: 'normal'}}>\r\n                {/*sections.map(this.renderText)*/}\r\n            </div>\r\n            {seconds>=0? <div className='px-3 pb-3' style={{color: 'red', fontWeight: 'bold'}}>\r\n                {actionName}{Math.floor(seconds/1000)}\r\n            </div> : undefined}\r\n            <div id='bottomDiv' />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {nav, Page} from 'tonva';\r\nimport {List, EasyDate, LMR, Muted} from 'tonva';\r\nimport {store} from '../../store';\r\nimport { UqActionProps } from './uqActionProps';\r\nimport { CompileResultPage } from './compileResultPage';\r\n\r\ninterface State {\r\n    files: any[];\r\n    compiled?: string;\r\n    text?: string;\r\n}\r\n\r\n//const fastUpload = '';\r\n//const thoroughlyUpload = '';\r\nexport class UqUpload extends React.Component<UqActionProps, State> {\r\n    private fileInput: HTMLInputElement;\r\n\r\n    constructor(props:UqActionProps) {\r\n        super(props);\r\n        this.state = {\r\n            files: undefined,\r\n        }\r\n    }\r\n\r\n    private onFilesChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let upFiles:any[] = [];\r\n        let {files} = evt.target;\r\n        let len = files.length;\r\n        for (let i=0; i<len; i++) {\r\n            upFiles.push(files[i]);\r\n        }\r\n        this.setState({\r\n            files: upFiles,\r\n        });\r\n    }\r\n    fileRender(file:any, index:number):JSX.Element {\r\n        let {name, size, lastModifiedDate} = file;\r\n        function sz():string {\r\n            let n:number, u:string;\r\n            if (size < 1024) {\r\n                n = size; u = 'b';\r\n            }\r\n            else if (size < 1024*1024) {\r\n                n = Math.trunc((size / 1024) * 100)/100; u = 'k';\r\n            }\r\n            else {\r\n                n = Math.trunc((size / 1024 / 1024) * 100)/100; u = 'm';\r\n            }\r\n            return n + ' ' + u;\r\n        }\r\n        return <LMR className=\"px-2 py-1\" right={<Muted>{sz()}</Muted>}>\r\n            <div>{name}</div>\r\n            <div><Muted>: <EasyDate date={lastModifiedDate} /></Muted></div>\r\n        </LMR>;\r\n    }\r\n    private fileClick = (file:any) => {\r\n        let fr = new FileReader();\r\n        fr.onload = function(f) {\r\n            nav.push(<UqPage name={file.name} content={this.result} />)\r\n        }\r\n        fr.readAsText(file, \"utf8\");\r\n    }\r\n    private onSubmit = (evt:React.FormEvent<any>) => {\r\n        evt.preventDefault();\r\n    }\r\n\r\n    private async upload() {\r\n        var files:FileList = this.fileInput.files;\r\n        var data = new FormData();\r\n        let len = files.length;\r\n        for (let i=0; i<len; i++) {\r\n            let file = files[i];\r\n            data.append('files[]', file, file.name);\r\n        }\r\n  \r\n        let url = store.uqServer + 'uq-compile/' + this.props.uq.id + '/upload';\r\n        try {\r\n            let abortController = new AbortController();\r\n            let res = await fetch(url, {\r\n                method: \"POST\",\r\n                body: data,\r\n                signal: abortController.signal,\r\n            });\r\n\t\t\tnav.push(<CompileResultPage {...this.props} \r\n                actionName=\"\" \r\n                action=\"upload\"\r\n                res={res} abortController={abortController} />);\r\n        }\r\n        catch (e) {\r\n            console.error('%s %s', url, e);\r\n        }\r\n    }\r\n    private onUpload = async () => {\r\n        nav.ceaseTop();\r\n        await this.upload();\r\n    }\r\n    render() {\r\n        let {files} = this.state;\r\n        let fileList:any;\r\n        if (files !== undefined) {\r\n            fileList = <List \r\n                className=\"my-3\" \r\n                items={files} \r\n                item={{render: this.fileRender, onClick: this.fileClick}}/>;\r\n        }\r\n        let button:any;\r\n        if (files !== undefined && files.length > 0) {\r\n            button = <div className=\"my-2 d-flex\">\r\n                <button className=\"btn btn-primary\" type=\"submit\" onClick={this.onUpload}>UQ</button>\r\n            </div>;\r\n        }\r\n        return <Page header={'UQ - ' + this.props.uq.name}>\r\n            <div className=\"py-2 px-3\">\r\n                <form className=\"my-1\" encType=\"multipart/form-data\" onSubmit={this.onSubmit}>\r\n                    <div className=\"my-1\">\r\n\t\t\t\t\t\t<button className=\"btn btn-outline-success\" \r\n\t\t\t\t\t\t\tonClick={()=>this.fileInput.click()}>UQ</button>\r\n\t\t\t\t\t\t<input \r\n\t\t\t\t\t\t\tref={(fileInput) => this.fileInput=fileInput}\r\n\t\t\t\t\t\t\ttype=\"file\" \r\n\t\t\t\t\t\t\tclassName=\"w-100 form-control-file d-none\" \r\n\t\t\t\t\t\t\tname=\"files\" multiple={true} \r\n\t\t\t\t\t\t\tonChange={this.onFilesChange} />\r\n                    </div>\r\n                    {fileList}\r\n                    {button}\r\n                </form>\r\n                <pre>{this.state.compiled}</pre>\r\n                <div>{this.state.text}</div>\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n\r\ninterface Options {\r\n    action: 'test' | 'deploy';\r\n    caption: string;\r\n    fast: string;\r\n    thoroughly: string;\r\n    description: any;\r\n}\r\nconst test:Options = {\r\n    action: 'test',\r\n    caption: '',\r\n    fast: '',\r\n    thoroughly: '',\r\n    description: <>\r\n        <li>UQ</li>\r\n        <li></li>\r\n        <li></li>\r\n    </>\r\n}\r\n\r\nconst deploy:Options = {\r\n    action: 'deploy',\r\n    caption: '',\r\n    fast: '',\r\n    thoroughly: '',\r\n    description: <>\r\n        <li></li>\r\n        <li></li>\r\n        <li></li>\r\n    </>\r\n}\r\n\r\nexport class UqDeploy extends React.Component<UqActionProps> {\r\n    readonly options: Options;\r\n    constructor(props: UqActionProps) {\r\n        super(props);\r\n        switch (props.action) {\r\n            case 'test':\r\n                this.options = test;\r\n                break;\r\n            case 'deploy':\r\n                this.options = deploy;\r\n                break;\r\n        }\r\n    }\r\n\r\n    private onCompile = async () => {\r\n        nav.ceaseTop();\r\n        let thoroughly = false;\r\n        await this.compile(thoroughly);\r\n    }\r\n    private onCompileThoroughly = async () => {\r\n        nav.ceaseTop();\r\n        let thoroughly = true;\r\n        await this.compile(thoroughly);\r\n    }\r\n    private async compile(isThoroughly:boolean) {\r\n        let {caption, action, thoroughly, fast} = this.options;\r\n        let url = store.uqServer + 'uq-compile/' + this.props.uq.id + '/' + action;\r\n        let actionName:string;\r\n        if (isThoroughly === true) {\r\n            actionName = thoroughly;\r\n            url += '-thoroughly';\r\n        }\r\n        else {\r\n            actionName = fast;\r\n        }\r\n        try {\r\n            let abortController = new AbortController();\r\n            let res = await fetch(url, {\r\n                method: \"POST\",\r\n                signal: abortController.signal,\r\n            });\r\n\t\t\tnav.push(<CompileResultPage {...this.props} \r\n\t\t\t\tcaption={caption}\r\n                action={action}\r\n                actionName={actionName}\r\n                res={res} abortController={abortController} />);\r\n        }\r\n        catch (e) {\r\n            console.error('%s %s', url, e);\r\n        }\r\n    }\r\n    render() {\r\n        let {caption, fast, thoroughly, description} = this.options;\r\n        return <Page header={caption + ' - ' + this.props.uq.name}>\r\n            <div className=\"m-3 bg-white p-3\">\r\n                <ul className=\"my-3\">{description}</ul>\r\n                <div className=\"d-flex p-3\">\r\n                    <button className=\"btn btn-success\" type=\"submit\" onClick={this.onCompile}>{fast}</button>\r\n                    <div className=\"py-2 flex-grow-1\" />\r\n                    <button className=\"btn btn-outline-warning\"\r\n                        type=\"submit\" onClick={this.onCompileThoroughly}>{thoroughly}</button>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface UqPgeProps {\r\n    name: string;\r\n    content: string|ArrayBuffer;\r\n}\r\nclass UqPage extends React.Component<UqPgeProps> {\r\n    render() {\r\n        return <Page header={this.props.name}>\r\n            <pre className=\"px-3 py-2\">{this.props.content}</pre>\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { IdPickProps, createIdPick } from '../../tools';\r\nimport { store, caches } from 'store';\r\nimport { Field, FormRow, TonvaForm, SubmitResult } from 'tonva-form';\r\nimport { CUq } from './CUq';\r\nimport { VPage, nav, Page } from 'tonva';\r\nimport { DevServer } from 'model';\r\n\r\nconst ServerCaption = (item:DevServer) => {\r\n    let {discription, cloud, ip} = item;\r\n    return <>{discription} {cloud} {ip}</>;\r\n}\r\n\r\nconst idPickServerProps: IdPickProps = {\r\n    caption: '',\r\n    searchPlaceHolder: '',\r\n    candidateItems: async (params:any, key:string) => {\r\n        await store.dev.searchServer.first(key);\r\n        return store.dev.searchServer.items;\r\n    },\r\n    moreCandidates: async () => {\r\n        await store.dev.searchServer.more();\r\n    },\r\n    row: (item:DevServer, index:number) => {\r\n        return <div className=\"px-3 py-2\"><ServerCaption {...item} /></div>;\r\n    },\r\n};\r\n\r\n//const urlField:Field = {name: 'url', type: 'string', required:true, maxLength:200};\r\n//const urlTestField:Field = {name: 'urlTest', type: 'string', required:false, maxLength:200};\r\nconst serverField:Field = {name: 'server', type: 'id'};\r\nconst testServerField:Field = {name: 'serverTest', type: 'id'};\r\nconst dbField:Field = {name: 'db', type: 'string', maxLength:50, required: true};\r\n\r\n/*\r\nconst urlRow = {\r\n    label: 'URL',\r\n    field: urlField,\r\n};\r\n\r\nconst urlRowTest = {\r\n    label: 'URL-Test',\r\n    field: urlTestField,\r\n    face: {placeholder:'URL'}\r\n};\r\n*/\r\n\r\nconst fromPicked = (item:DevServer)=>{\r\n\treturn {\r\n\t\tid: item.id, \r\n\t\tcaption: <ServerCaption {...item} />,\r\n\t};\r\n}\r\n\r\nconst itemFromId = (id:number)=>caches.servers.get(id);\r\n\r\nconst serverRow = {\r\n    label: '',\r\n    field: serverField,\r\n    face: {\r\n        type: 'pick-id', \r\n        initCaption: '', \r\n        pick: createIdPick(idPickServerProps), //this.idPick,\r\n        fromPicked: fromPicked,\r\n        itemFromId: itemFromId,\r\n    },\r\n};\r\n\r\nconst testServerRow = {\r\n    label: '', \r\n    field: testServerField,\r\n    face: {\r\n        type: 'pick-id', \r\n        initCaption: '', \r\n        pick: createIdPick(idPickServerProps), //this.idPick,\r\n        fromPicked: fromPicked,\r\n        itemFromId: itemFromId,\r\n    },\r\n};\r\n\r\n/*\r\nconst dbTypeRow:FormRow = {\r\n    label: '',\r\n    field: dbTypeField,\r\n    face: {\r\n        type: 'string',\r\n        readonly: true,\r\n    } as StringFace\r\n};\r\n*/\r\n\r\nconst dbRow = {\r\n    label: '',\r\n    field: dbField,\r\n};\r\n\r\n/*\r\nconst connectionRow = {\r\n    label: '',\r\n    field: connectionField,\r\n    face: {\r\n        type: 'textarea',\r\n        maxLength: 250,\r\n        rows: 8,\r\n    } as TextAreaFace,\r\n};\r\n*/\r\nexport class NewServicePage extends VPage<CUq> {\r\n    private tonvaForm:TonvaForm;\r\n    private formRows:FormRow[] = [\r\n        //urlRow,\r\n        //urlRowTest,\r\n\t\tserverRow,\r\n\t\ttestServerRow,\r\n        //dbTypeRow,\r\n        dbRow,\r\n        //connectionRow\r\n    ];\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n    private onSubmit = async (values:any):Promise<SubmitResult | undefined> => {\r\n        /*\r\n        if (values.url.indexOf('/uq/')<0) {\r\n            this.tonvaForm.formView.setError('url', 'service url /uq/');\r\n            return;\r\n        }\r\n        */\r\n        values.type = 2; // uq type, to be removed\r\n        values.uqId = this.controller.uq.id;\r\n        let ret = await this.controller.saveService(values);\r\n        if (ret === 0) {\r\n            /*\r\n            if (this.tonvaForm !== undefined) {\r\n                this.tonvaForm.formView.setError('url', 'Serviceurl');\r\n            }\r\n            */\r\n            return;\r\n        }\r\n        nav.pop();\r\n        return;\r\n    }\r\n    private page = () => {\r\n        return <Page header=\"Service\">\r\n            <TonvaForm ref={t=>this.tonvaForm=t} className=\"m-3\" formRows={this.formRows} onSubmit={this.onSubmit} />\r\n        </Page>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { Page, VPage, nav } from 'tonva';\r\nimport { CUq } from './CUq';\r\nimport { Prop, PropGrid } from 'tonva';\r\nimport { StringValueEdit, ServerSpan } from 'tools';\r\nimport { observer } from 'mobx-react';\r\nimport { DevService } from 'model';\r\n\r\nexport class ServicePage extends VPage<CUq> {\r\n    @observable private service: DevService;\r\n    async open(service: DevService) {\r\n        this.service = service;\r\n        this.openPage(this.page);\r\n    }\r\n    private async changeProp(prop:string, value:any):Promise<any> {\r\n        return await this.controller.changeServiceProp(this.service, prop, value);\r\n\t}\r\n\t/*\r\n    private onUrlChanged = async (value:any, orgValue:any):Promise<string|void> => {\r\n        let ret = await this.changeProp('url', value);\r\n        if (ret === 0) {\r\n            //return 'URL';\r\n            return;\r\n        }\r\n        this.service.url = value;\r\n    }\r\n    private onUrlTestChanged = async (value:any, orgValue:any):Promise<string|void> => {\r\n        let ret = await this.changeProp('urlTest', value);\r\n        if (ret === 0) {\r\n            //return 'URL';\r\n            return;\r\n        }\r\n        this.service.urlTest = value;\r\n\t}\r\n\t*/\r\n    private onDbChanged = async (value:any, orgValue:any):Promise<string|void> => {\r\n        let ret = await this.changeProp('db', value);\r\n        if (ret === 0) {\r\n            return 'Db';\r\n        }\r\n        this.service.db = value;\r\n    }\r\n    private onServerPick = async () => {\r\n        let ret = await this.controller.pickServer();\r\n        this.changeProp('server', ret);\r\n        this.service.server = ret;\r\n    }\r\n    private onServerTestPick = async () => {\r\n        let ret = await this.controller.pickServer();\r\n        this.changeProp('server_test', ret);\r\n        this.service.serverTest = ret;\r\n    }\r\n    private onDeleteClick = async () => {\r\n        if (window.confirm(\"Service\")!==true) return;\r\n        await this.controller.delService(this.service);\r\n        nav.pop();\r\n    }\r\n    private page = observer(() => {\r\n        let {uq} = this.controller;\r\n        let rows:Prop[] = [\r\n            '',\r\n            {\r\n                type: 'string',\r\n                name: 'db',\r\n                label: '',\r\n                onClick: ()=>nav.push(<StringValueEdit \r\n                    title=\"\"\r\n                    value={this.service.db}\r\n                    onChanged={this.onDbChanged} />)\r\n            },\r\n            '',\r\n            {\r\n                type: 'component',\r\n                label: '',\r\n                component: <ServerSpan id={this.service.server} />,\r\n                onClick: this.onServerPick\r\n            },\r\n            {\r\n                type: 'component',\r\n                label: '',\r\n                component: <ServerSpan id={this.service.serverTest} />,\r\n                onClick: this.onServerTestPick\r\n\t\t\t},\r\n\t\t\t/*\r\n            '',\r\n            {\r\n                type: 'string',\r\n                name: 'url',\r\n                label: 'URL',\r\n                onClick: ()=>nav.push(<StringValueEdit \r\n                    title=\"URL\"\r\n                    value={this.service.url}\r\n                    onChanged={this.onUrlChanged} />)\r\n            },\r\n            {\r\n                type: 'string',\r\n                name: 'urlTest',\r\n                label: 'URL-Test',\r\n                onClick: ()=>nav.push(<StringValueEdit \r\n                    title=\"URL-Test\"\r\n                    value={this.service.urlTest}\r\n                    onChanged={this.onUrlTestChanged} />)\r\n\t\t\t},\r\n\t\t\t*/\r\n        ];\r\n        let right = <button onClick={this.onDeleteClick} \r\n            className=\"btn btn-sm btn-success align-self-center\"></button>;\r\n        return <Page header={'UQ - ' + uq.name} right={right}>\r\n            <PropGrid rows={rows} values={this.service} />\r\n        </Page>\r\n    })\r\n}\r\n\r\n","import { CUq } from './CUq';\r\nimport { VPage, nav, Page } from 'tonva';\r\nimport { SubmitResult, TonvaForm } from 'tonva-form';\r\n\r\nconst formRows = [\r\n    {\r\n        label: '', \r\n        field: {name: 'name', type: 'string', maxLength: 100, required: true},\r\n    },\r\n    {\r\n        label: '',\r\n        field: {name: 'discription', type: 'string', maxLength: 250},\r\n        face: {type: 'textarea'}\r\n    },\r\n    //{\r\n    //    label: '',\r\n    //    field: {name: 'access', type: 'string', maxLength: 250},\r\n    //    face: {type: 'textarea', placeholder: ''}\r\n    //},\r\n];\r\n\r\n\r\nexport abstract class EditBasePage extends VPage<CUq> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n    protected onSubmit = async (values:any):Promise<SubmitResult> => {\r\n        await this.controller.saveUq(values);\r\n        nav.pop();\r\n        return;\r\n    }\r\n    protected page: ()=>JSX.Element;\r\n    protected form(initValues:any):JSX.Element {\r\n        return <TonvaForm\r\n            className=\"m-3\"\r\n            formRows={formRows} \r\n            onSubmit={this.onSubmit} initValues={initValues} />\r\n    }\r\n}\r\n\r\nexport class EditPage extends EditBasePage {\r\n    protected page = () => {\r\n        let {uq} = this.controller;\r\n        let {name} = uq;\r\n        return <Page header={'UQ - ' + name} back=\"close\">\r\n            {this.form(uq)}\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class NewPage extends EditBasePage {\r\n    protected page = () => {\r\n        return <Page header={'UQ'} back=\"close\">\r\n            {this.form({})}\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, nav, EasyTime } from 'tonva';\r\nimport { CUq } from './CUq';\r\nimport { IdDates, UnitSpan, ServerSpan } from 'tools';\r\nimport { Prop, LMR, FA, PropGrid, Muted, List, DropdownActions } from 'tonva';\r\nimport { EditPage } from './editPage';\r\nimport { store } from 'store';\r\nimport { observer } from 'mobx-react';\r\nimport { DevService } from 'model';\r\n\r\nexport class UQPage extends VPage<CUq> {\r\n    async open() {\r\n        this.openPageElement(React.createElement(this.page));\r\n    }\r\n\r\n    private editItem = async () => {\r\n        await this.openVPage(EditPage);\r\n        //nav.push(<EditAppPage {...this.props} />);\r\n    }\r\n\r\n    private deleteItem = async () => {\r\n        if (window.confirm('UQ') === true) {\r\n            await this.controller.deleteUq();\r\n            nav.pop();\r\n        }\r\n    }\r\n\r\n    private page = observer(():JSX.Element => {\r\n        let {onUqUpload, onUqTest, onUqDeploy, onUqDevsAdmin, serviceClick, uq, services} = this.controller;\r\n        let {unit} = store;\r\n        let {isOwner} = unit;\r\n        let {name, discription, unit:unitId, date_init, date_update} = uq;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        let menuItems = [\r\n            {caption:'UQ', action:this.editItem, icon:'edit' },\r\n            {caption:'', action:this.deleteItem, icon:'trash-o' }\r\n        ];\r\n        let right = isOwner>0 && <DropdownActions className=\"btn-primary mr-2\" actions={menuItems} />;\r\n        let angle = <FA className=\"align-self-center\" name=\"angle-right\" />;\r\n        let action = (icon:string, cnIcon:string, label:string, onClick:()=>void):Prop => {\r\n            return {\r\n                type: 'component',\r\n                label: undefined, // 'UQ', \r\n                component: <LMR onClick={onClick} className=\"w-100 py-2 cursor-pointer\" \r\n                    left={<span className=\"align-self-center\"><FA className={cnIcon} name={icon} fixWidth={true} /> &nbsp; {label}</span>} right={angle} />\r\n            };\r\n        };\r\n        let rows:Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component', \r\n                component: <LMR className=\"py-2\"\r\n                    left={<FA name=\"database\" className=\"text-primary fa-2x mr-3\" />}>\r\n                    <div><b>{name}</b></div>\r\n                    {disp}\r\n                </LMR>\r\n            },\r\n            {\r\n                type: 'component', \r\n                label: '', \r\n                component: <div className=\"py-2\"><UnitSpan id={unitId} isLink={true} /></div> \r\n            },\r\n            '',\r\n            action('code', 'text-info', 'UQ', onUqUpload),\r\n            /*{\r\n                type: 'component',\r\n                label: undefined, // 'UQ', \r\n                component: <LMR onClick={onUqUpload} className=\"w-100 py-2 cursor-pointer\" \r\n                    left=\"UQ\" right={right} />\r\n            },*/\r\n            action('database', 'text-warning', ' - UQ', onUqTest),\r\n            /*{\r\n                type: 'component', \r\n                label: undefined, // 'UQ', \r\n                component: <LMR onClick={onUqTest} className=\"w-100 py-2 cursor-pointer\" \r\n                    left=\"UQ\" right={angle} />\r\n            },*/\r\n            action('database', 'text-success', ' - UQ', onUqDeploy),\r\n            /*{\r\n                type: 'component', \r\n                label: undefined, // 'UQ', \r\n                component: <LMR onClick={onUqDeploy} className=\"w-100 py-2 cursor-pointer\" \r\n                    left=\"UQ\" right={angle} />\r\n            },*/\r\n        ];\r\n\r\n        let adminDev:any;\r\n        let btnAddService:any;\r\n        if (isOwner > 0) {\r\n            btnAddService = <button\r\n                className=\"btn btn-outline-primary btn-sm\"\r\n                onClick={()=>this.controller.showNewServicePage()}>\r\n                \r\n            </button>;\r\n            let devList = this.controller.uqDevs.filter(v => v.isOwner===0);\r\n            adminDev = <>\r\n                <div className=\"d-flex mx-3 mt-3 mb-1 align-items-end\">\r\n                    <Muted style={{display:'block', flex:1}}></Muted>\r\n                    <button\r\n                        className=\"btn btn-outline-primary btn-sm\"\r\n                        onClick={onUqDevsAdmin}>\r\n                        \r\n                    </button>\r\n                </div>\r\n                <div className=\"px-3 py-2 d-flex flex-wrap bg-white\">\r\n                    {\r\n                        devList.length === 0?\r\n                        <div className=\"small text-muted\">[]</div>\r\n                        :\r\n                        devList.map((v:any) => {\r\n                            return <div key={v.userId} className=\"my-2 mr-3\">{v.nick || v.name}</div>\r\n                        })}\r\n                </div>\r\n            </>;\r\n        }\r\n\r\n        let onServiceClick:any;\r\n        if (isOwner>0) onServiceClick = serviceClick;\r\n\r\n        return <Page header={'UQ - ' + name} right={right}>\r\n            <PropGrid rows={rows} values={uq} />\r\n            {adminDev}\r\n            <div className=\"d-flex mx-3 mt-3 mb-1 align-items-end\">\r\n                <Muted style={{display:'block', flex:1}}>Service</Muted>\r\n                {btnAddService}\r\n            </div>\r\n            <List items={services} item={{\r\n\t\t\t\trender:(service:DevService, index:number)=>\r\n\t\t\t\t\tReact.createElement(this.renderService, {service, index}), \r\n                onClick:onServiceClick\r\n            }} />\r\n        </Page>;\r\n    });\r\n    private renderService = observer((props: {service:DevService; index:number}):JSX.Element => {\r\n        let {service} = props;\r\n        let {db, /*url, urlTest, */server, serverTest, compile_time, deploy_time} = service;\r\n        let compile = !compile_time?\r\n            <Muted></Muted> \r\n            :\r\n            <EasyTime date={compile_time}/>;\r\n        let deploy = !deploy_time?\r\n            <Muted></Muted> \r\n            :\r\n            <EasyTime date={deploy_time}/>;\r\n\r\n        return <div className=\"d-block w-100 cursor-pointer mb-2 py-2 px-3\">\r\n            <div><small></small>{db}</div>\r\n            <LMR className=\"align-items-center\"\r\n                right={<small>{deploy}</small>}>\r\n                <div>\r\n                    <small></small>\r\n                    <ServerSpan id={server} />\r\n                </div>\r\n            </LMR>\r\n            <LMR className=\"align-items-center\"\r\n                right={<small>{compile}</small>}>\r\n                <div>\r\n                    <small></small>\r\n                    <ServerSpan id={serverTest} />\r\n                </div>\r\n            </LMR>\r\n        </div>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, EasyTime, DropdownActions, DropdownAction, nav } from 'tonva';\r\nimport { CUq } from './CUq';\r\nimport { List, LMR, Muted, FA } from 'tonva';\r\nimport { NewPage } from './editPage';\r\nimport { store } from 'store';\r\nimport { DevUQ } from 'model';\r\nimport { CompileResultPage } from './compileResultPage';\r\n\r\nexport class ListPage extends VPage<CUq> {\r\n    async open(param:any) {\r\n        this.openPage(this.page);\r\n    }\r\n    private newItem = () => {\r\n        this.controller.uq = undefined;\r\n        this.openVPage(NewPage);\r\n    }\r\n    private batchCompile = () => {\r\n        this.openPage(this.batchCompilePage);\r\n    }\r\n    private page = ():JSX.Element => {\r\n        let {uqList: list, listRowClick} = this.controller;\r\n        let {isOwner} = store.unit;\r\n        let actions:DropdownAction[] = [\r\n            {icon:'plus', caption:'UQ', action: this.newItem},\r\n            {icon:'plus', caption:'', action: this.batchCompile},\r\n        ];\r\n        let right = isOwner>0 && \r\n            <DropdownActions className=\"btn-primary mr-2 align-self-center\" icon=\"bars\" actions={actions}>\r\n                <button className='btn btn-primary btn-sm' onClick={()=>this.newItem()}><FA name=\"plus\" /></button>\r\n            </DropdownActions>\r\n        return <Page header=\"UQ\" right={right}>\r\n            <List items={list} item={{render: this.listRow, onClick: listRowClick}} />\r\n        </Page>\r\n    }\r\n    private listRow = (item:DevUQ):JSX.Element => {\r\n        let {name, discription, service_count, date_update} = item;\r\n        return <LMR className=\"py-1 px-3 align-items-center\"\r\n            left={<FA name=\"database\" className=\"text-primary fa-lg\" />}\r\n            right={<div className=\"text-right\">\r\n                <div><small className=\"text-muted\">:</small> {service_count}</div>\r\n                <div className=\"small text-muted\"><EasyTime date={date_update} /></div>\r\n            </div>}>\r\n            <div className=\"py-2 px-3\">\r\n                <div><b>{name}</b></div>\r\n                <div><Muted>{discription}</Muted></div>\r\n            </div>\r\n        </LMR>;\r\n    }\r\n\r\n    private onSelect = (item:DevUQ, isSelected:boolean, anySelected:boolean) => {\r\n        //alert('ok');\r\n    }\r\n\r\n    private listCompileRow = (item:DevUQ):JSX.Element => {\r\n        let {name, discription, date_update} = item;\r\n        return <LMR className=\"py-1 px-3 align-items-center\"\r\n            left={<FA name=\"database\" className=\"text-info fa-lg\" />}\r\n            right={<div className=\"text-right\">\r\n                <div className=\"small text-muted\"><EasyTime date={date_update} /></div>\r\n            </div>}>\r\n            <div className=\"py-2 px-3\">\r\n                <div><b>{name}</b></div>\r\n                <div><Muted>{discription}</Muted></div>\r\n            </div>\r\n        </LMR>;\r\n    }\r\n\r\n    private list:List;\r\n    private selectAll = () => {\r\n        this.list.selectAll();\r\n    }\r\n    private unselectAll = () => {\r\n        this.list.unselectAll();\r\n    }\r\n    private test = () => {\r\n        this.compile('test', false);\r\n    }\r\n    private testThoroughly = () => {\r\n        this.compile('test', true);\r\n    }\r\n    private deploy = () => {\r\n        this.compile('deploy', false);\r\n    }\r\n    private deployThoroughly = () => {\r\n        this.compile('deploy', true);\r\n    }\r\n    private async compile(action:'test'|'deploy', thoroughly: boolean) {\r\n        let selectItems = this.list.selectedItems;\r\n        //let {action, thoroughly, fast} = this.options;\r\n        let url = store.uqServer + 'uq-compile/batch';\r\n        let actionName:string;\r\n        switch (action) {\r\n            case 'test': actionName = ''; break;\r\n            case 'deploy': actionName = ''; break;\r\n        }\r\n        try {\r\n            let abortController = new AbortController();\r\n            let body = {\r\n                test: action === 'test',\r\n                thoroughly: thoroughly,\r\n                uqs: selectItems.map(v => v.id)\r\n            };\r\n            //let data = new FormData();\r\n            //data.append( \"json\", JSON.stringify(body) );\r\n            let res = await fetch(url, {\r\n                method: \"POST\",\r\n                signal: abortController.signal,\r\n                headers: {\r\n                    //'Accept': 'application/json',\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify(body)\r\n            });\r\n            nav.push(<CompileResultPage uq={undefined} services={undefined}\r\n                action={action}\r\n                actionName={actionName}\r\n                res={res} abortController={abortController} />);\r\n        }\r\n        catch (e) {\r\n            console.error('%s %s', url, e);\r\n        }\r\n    }\r\n\r\n    private batchCompilePage = ():JSX.Element => {\r\n        let {uqList: list} = this.controller;\r\n        let right = <span>\r\n            <button className=\"btn btn-sm btn-link\" onClick={this.selectAll}></button> \r\n            <button className=\"btn btn-sm btn-link\" onClick={this.unselectAll}></button>\r\n        </span>;\r\n        let cnBtn = 'btn btn-sm btn-outline-primary mr-3';\r\n        let bar = <span className=\"px-3 py-1 d-flex w-100\">\r\n            <span className=\"flex-grow-1\">\r\n                <button className={cnBtn} onClick={this.test}></button>\r\n                <button className={cnBtn} onClick={this.deploy}></button>\r\n                <button className={cnBtn} onClick={this.testThoroughly}></button>\r\n                <button className={cnBtn} onClick={this.deployThoroughly}></button>\r\n            </span>\r\n            {right}\r\n        </span>;\r\n\r\n        return <Page header=\"\" footer={bar}>\r\n            <List ref={list=>this.list = list} items={list} item={{render: this.listCompileRow, onSelect: this.onSelect}} />\r\n        </Page>\r\n    }\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { VPage, Page, LMR, Image, List } from 'tonva';\r\nimport { CUq } from './CUq';\r\nimport { UnitAdmin } from '../../model';\r\n\r\nexport class VUqDevsAdmin extends VPage<CUq> {\r\n    async open() {\r\n        await this.controller.loadAdmins();\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onSelect = async (admin:any, isSelected:boolean) => {\r\n        await this.controller.devChanged(admin, isSelected);\r\n    }\r\n\r\n    private page = ():JSX.Element => {\r\n        let {uqDevs, admins} = this.controller;\r\n        let selectedItems = admins.devs.filter(v => uqDevs.find(d => d.userId === v.id) !== undefined);\r\n        let listHeader = <div className=\"px-3 py-1 small text-muted\"></div>;\r\n        return <Page header=\"\">\r\n            <div className='my-3'>\r\n                {listHeader}\r\n                <List\r\n                    items={admins.devs} \r\n                    none='[]'\r\n                    selectedItems = {selectedItems}\r\n                    item={{onSelect: this.onSelect, render: this.row}}\r\n                />\r\n            </div>\r\n        </Page>;\r\n    }\r\n\r\n    private row = ({icon, name, nick}:UnitAdmin) => {\r\n        let content = nick?\r\n            <><b>{nick}</b> &nbsp; <small className=\"text-muted\">{name}</small></>\r\n            :\r\n            <b>{name}</b>;\r\n        let left = <Image className=\"w-2-5c h-2-5c\" src={icon} />; \r\n        return <LMR className=\"py-2 px-3 align-items-stretch\" left={left}>\r\n            <div className=\"px-3\">{content}</div>\r\n        </LMR>;\r\n    }\r\n\r\n}\r\n","import { CUqBase } from \"UqApp\";\r\nimport { VPage, Page, SearchBox, List, PageItems } from \"tonva\";\r\nimport { observer } from 'mobx-react';\r\nimport { devApi } from 'api';\r\nimport { store } from 'store';\r\nimport { ServerSpan } from 'tools';\r\nimport { DevServer } from 'model';\r\n\r\nexport class CPickServer extends CUqBase {\r\n    pageItems: PageServerItems;\r\n    \r\n    async internalStart() {\r\n        this.pageItems = new PageServerItems();\r\n    }\r\n\r\n    async pick(): Promise<number> {\r\n        this.pageItems = new PageServerItems();\r\n        await this.pageItems.first('');\r\n        return await this.vCall(VPickServer);\r\n    }\r\n\r\n    onSearch = async (key:string):Promise<void> => {\r\n        await this.pageItems.first(key);\r\n    }\r\n}\r\n\r\nclass PageServerItems extends PageItems<DevServer> {\r\n    protected async loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:DevServer[]}> {\r\n        let unitId = store.unit.id;\r\n        let ret = await devApi.searchServer(unitId, param, pageStart, pageSize);\r\n\t\treturn {$page: ret};\r\n    }\r\n    protected setPageStart(item:DevServer):void {\r\n        this.pageStart = item === undefined? 0 : item.id;\r\n    }\r\n}\r\n\r\nclass VPickServer extends VPage<CPickServer> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderServer = (server:DevServer, index:number):JSX.Element => {\r\n        return <div className=\"px-3 py-2\"><ServerSpan id={server.id} /></div>;\r\n    }\r\n\r\n    private clickServer = (server:DevServer) => {\r\n        this.closePage();\r\n        this.returnCall(server.id);\r\n\t}\r\n\t\r\n\tprivate onClickNullServer = () => {\r\n        this.closePage();\r\n        this.returnCall(null);\r\n\t}\r\n\r\n    private page = observer(():JSX.Element => {\r\n        let searchBox = <SearchBox label=\"\" onSearch={this.controller.onSearch} />\r\n        return <Page header={searchBox}>\r\n\t\t\t<div className=\"px-3 py-2 cursor-pointer bg-white border-bottom\" \r\n\t\t\t\tonClick={this.onClickNullServer}>\r\n\t\t\t\t<span className=\"text-danger mr-3\">NULL</span>\r\n\t\t\t\t<small className=\"text-muted\">[]</small>\r\n\t\t\t</div>\r\n            <List items={this.controller.pageItems.items}\r\n                item={{render:this.renderServer, onClick:this.clickServer}} />\r\n        </Page>;\r\n    });\r\n}\r\n","import {observable} from 'mobx';\r\nimport {Unit, UnitAdmin} from '../model';\r\nimport {mainApi} from '../api';\r\n//import {Store} from './store';\r\n\r\nexport class Admins {\r\n    //private store:Store;\r\n    private unit: Unit;\r\n    constructor(unit: Unit/*store:Store*/) {\r\n        //this.store = store;\r\n        this.unit = unit;\r\n    }\r\n\r\n    @observable cur: UnitAdmin = undefined;\r\n    @observable owners: UnitAdmin[] = undefined;\r\n    @observable admins: UnitAdmin[] = undefined;\r\n    @observable devs: UnitAdmin[] = undefined;\r\n    \r\n    async load(): Promise<void> {\r\n        let unit = this.unit;\r\n        if (unit === undefined) return;\r\n        if (unit.id === undefined) return;\r\n        if (this.admins !== undefined) return;\r\n        let all = await mainApi.unitAdmins(unit.id);\r\n        let owners:UnitAdmin[] = [];\r\n        let admins:UnitAdmin[] = [];\r\n        let devs:UnitAdmin[] = [];\r\n        all.forEach(ua => {\r\n            let {isOwner, isAdmin, isDev} = ua;\r\n            if (isDev)\r\n                devs.push(ua);\r\n            else {\r\n                if (isOwner === 1) owners.push(ua);\r\n                if (isAdmin === 1) admins.push(ua);\r\n            }\r\n        });\r\n        this.owners = owners;\r\n        this.admins = admins;\r\n        this.devs = devs;\r\n    }\r\n\r\n    private removeOneUnitAdmin(arr: UnitAdmin[], unitAdmin?: UnitAdmin) {\r\n        let index = arr.findIndex(v => v.id===unitAdmin.id);\r\n        if (index >=0) arr.splice(index, 1);\r\n    }\r\n\r\n    private removeUnitAdmin(unitAdmin?: UnitAdmin) {\r\n        if (unitAdmin === undefined) unitAdmin = this.cur;\r\n        this.removeOneUnitAdmin(this.owners, unitAdmin);\r\n        this.removeOneUnitAdmin(this.admins, unitAdmin);\r\n        this.removeOneUnitAdmin(this.devs, unitAdmin);\r\n    }\r\n\r\n    async unitSetAdmin(isOwner:number, isAdmin:number, isDev:number) {\r\n        let cur = this.cur;\r\n        let fellowId = cur.id, unitId = this.unit.id;\r\n        await mainApi.unitSetAdmin(fellowId, unitId, isOwner, isAdmin, isDev);\r\n        cur.isOwner = isOwner;\r\n        cur.isAdmin = isAdmin;\r\n        this.removeUnitAdmin();\r\n        if (isOwner === 0 && isAdmin === 0)\r\n            this.devs.unshift(cur);\r\n        else {\r\n            if (isOwner === 1) this.owners.unshift(cur);\r\n            if (isAdmin === 1) this.admins.unshift(cur);\r\n        }\r\n    }\r\n\r\n    async unitAddAdmin(user:string, isOwner:number, isAdmin:number, isDev:number):Promise<UnitAdmin|string> {\r\n        let admin = await mainApi.unitAddAdmin(user, this.unit.id, isOwner, isAdmin, isDev);\r\n        if (admin === undefined) return 'unauthorized';\r\n        let {r} = admin;\r\n        if (r !== undefined) return r;\r\n\r\n        let cur = this.cur = admin;\r\n        this.removeUnitAdmin();\r\n        if (isOwner === 0 && isAdmin === 0)\r\n            this.devs.unshift(cur);\r\n        else {\r\n            if (isOwner === 1) this.owners.unshift(cur);\r\n            if (isAdmin === 1) this.admins.unshift(cur);\r\n        }\r\n        return admin;\r\n    }\r\n\r\n    async unitDelAdmin(unitAdmin: UnitAdmin) {\r\n        await mainApi.unitDelAdmin(this.unit.id, unitAdmin.id);\r\n        if (this.cur === unitAdmin) this.cur = undefined;\r\n        this.removeUnitAdmin(unitAdmin);\r\n    }\r\n}\r\n","import _ from 'lodash';\r\nimport { observable } from 'mobx';\r\nimport { nav } from 'tonva';\r\nimport { Unit, DevUQ, DevService } from '../../model';\r\nimport { UqUpload, UqDeploy } from './uqUpload';\r\nimport { devApi } from 'api';\r\nimport { NewServicePage } from './newServicePage';\r\nimport { ServicePage } from './servicePage';\r\nimport { UQPage } from './uqPage';\r\nimport { ListPage } from './listPage';\r\nimport { VUqDevsAdmin } from './VUqDevsAdmin';\r\nimport { CUqBase } from 'UqApp';\r\nimport { CPickServer } from './CPickServer';\r\nimport { Admins } from 'store/admins';\r\n\r\nexport class CUq extends CUqBase {\r\n    private unit: Unit;\r\n    uq: DevUQ;\r\n    access: string;\r\n    entities: string;\r\n    admins: Admins;\r\n    @observable uqDevs: any[];\r\n    @observable uqList: DevUQ[];\r\n    @observable services: DevService[];\r\n    protected async internalStart(unit:Unit) {\r\n        this.unit = unit;\r\n        this.uqList = await devApi.uqs(this.unit.id, 200);\r\n        this.openVPage(ListPage);\r\n    }\r\n\r\n    listRowClick = async (item:DevUQ) => {\r\n        this.uq = item;\r\n        await this.loadUqEntities(item.id);\r\n        this.openVPage(UQPage);\r\n    }\r\n\r\n    private async loadUqEntities(uqId: number) {\r\n        let ret = await devApi.uqGetEntities(this.unit.id, uqId);\r\n        let r0 = ret[0][0];\r\n        this.access = r0.access;\r\n        this.entities = r0.entities;\r\n        this.services = ret[1];\r\n        this.uqDevs = ret[4];\r\n    }\r\n\r\n    async loadAdmins() {\r\n        this.admins = new Admins(this.unit);\r\n        await this.admins.load();\r\n    }\r\n\r\n    async devChanged(admin:any, isSelected:boolean) {\r\n        let param = {\r\n            unit: this.unit.id,\r\n            type: 'uq',\r\n            dev: this.uq.id,\r\n            devUser: admin.id\r\n        };\r\n        if (isSelected === true) {\r\n            await devApi.adminDevAdd(param);\r\n            this.uqDevs.push({\r\n                userId: admin.id,\r\n                icon: admin.icon,\r\n                name: admin.name,\r\n                nick: admin.nick,\r\n                isOwner: 0,\r\n            });\r\n        }\r\n        else {\r\n            await devApi.adminDevDel(param);\r\n            let index = this.uqDevs.findIndex(v => v.userId === admin.id);\r\n            this.uqDevs.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    onUqDevsAdmin = () => {\r\n        this.openVPage(VUqDevsAdmin);\r\n    }\r\n\r\n    serviceClick = (service: DevService) => {\r\n        this.openVPage(ServicePage, service);\r\n    }\r\n\r\n    onUqUpload = async() => {\r\n        let onDispose = () => {}\r\n        nav.push(<UqUpload uq={this.uq} services={this.services} />, onDispose);\r\n    }\r\n\r\n    onUqTest = async() => {\r\n        let onDispose = () => {}\r\n        nav.push(<UqDeploy uq={this.uq} action=\"test\" services={this.services} />, onDispose);\r\n    }\r\n\r\n    onUqDeploy = async() => {\r\n        let onDispose = () => {}\r\n        nav.push(<UqDeploy uq={this.uq} action=\"deploy\" services={this.services} />, onDispose);\r\n    }\r\n\r\n    saveUq = async (values: DevUQ) => {\r\n        let uq: DevUQ;\r\n        if (this.uq === undefined) {\r\n            uq = _.clone(values);\r\n        }\r\n        else {\r\n            uq = _.clone(this.uq);\r\n            _.merge(uq, values);\r\n        }\r\n        uq.unit = this.unit.id;\r\n        let ret = await devApi.saveUq(uq);\r\n        uq.id = ret;\r\n        this.uqList.push(uq);\r\n    }\r\n\r\n    deleteUq = async () => {\r\n        await devApi.delUq(this.unit.id, this.uq.id);\r\n        let index = this.uqList.findIndex(v => v.id === this.uq.id);\r\n        if (index >= 0) this.uqList.splice(index);\r\n    }\r\n\r\n    async changeServiceProp(service: DevService, prop:string, value:any):Promise<any> {\r\n        return await devApi.changeServiceProp(this.unit.id, service.id, prop, value);\r\n    }\r\n\r\n    async saveService(service: DevService):Promise<number> {\r\n        let svc = _.clone(service);\r\n        svc.unit = this.unit.id;\r\n        if (!svc.urlTest) svc.urlTest = '-';\r\n        let ret = await devApi.saveService(svc);\r\n        svc.id = ret;\r\n        this.services.push(svc);\r\n        return ret;\r\n    }\r\n\r\n    async delService(service: DevService) {\r\n        await devApi.delService(this.unit.id, service.id);\r\n        let index = this.services.findIndex(v => v.id === service.id);\r\n        if (index >= 0) this.services.splice(index);\r\n    }\r\n\r\n    showNewServicePage = async () => {\r\n        await this.openVPage(NewServicePage);\r\n    }\r\n\r\n    pickServer = async () => {\r\n        let cPickServer = this.newC(CPickServer);\r\n        return await cPickServer.pick();\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {EasyDate, Prop, PropGrid, LMR, Muted, FA} from 'tonva';\r\nimport {UnitSpan, IdDates} from '../tools';\r\n//import {appIcon} from '../consts';\r\nimport {store} from '../store';\r\nimport { ObjViewProps } from './ObjViewProps';\r\nimport { DevBus } from 'model';\r\n\r\nconst busIcon = 'cogs';\r\n\r\n@observer\r\nclass Info extends React.Component<DevBus> {\r\n    async componentDidMount() {\r\n        //await store.dev.buses.loadCurApis();\r\n    }\r\n    render() {\r\n        let {unit, owner, name, discription, mine, version, date_init, date_update} = this.props;\r\n        let disp = <small>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </small>;\r\n        let caption:any = owner + ' / ' + name;\r\n        if (mine === 1) {\r\n            caption = <b>{caption}</b>;\r\n        }\r\n        let rows:Prop[] = [\r\n            '',\r\n            {type: 'component', component: <LMR className=\"py-2\"\r\n                left={<FA className=\"pt-2 pr-1 text-primary\" name={busIcon} size=\"3x\" />}>\r\n                <div className=\"pl-3\">\r\n                    <div className=\"mb-2\">{caption}</div>\r\n                    {disp}\r\n                </div>\r\n            </LMR>},\r\n            '',\r\n            {type: 'component', label: '', component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> },\r\n            {\r\n                type: 'component', \r\n                label: '', \r\n                component: <LMR className=\"py-2 w-100\" right={<small className=\"text-muted\"><EasyDate date={date_update}/></small>} >{version}</LMR> },\r\n            '',\r\n            {\r\n                type: 'component', \r\n                label: 'Schema',\r\n                vAlign: 'stretch',\r\n                component: <SchemaView />,\r\n            },\r\n        ];\r\n        return <div>\r\n            <PropGrid rows={rows} values={this.props} />\r\n        </div>\r\n    }\r\n}\r\n\r\n@observer\r\nexport class SchemaView extends React.Component {\r\n    render() {\r\n        let bus = store.dev.buses.cur;\r\n        if (bus === null) return '...';\r\n        let content = bus.schema;\r\n        return <div className=\"d-flex py-2 w-100 align-items-center\" style={{flex:1}}>\r\n            <pre>\r\n                {content}\r\n            </pre>\r\n        </div>;\r\n\r\n    }\r\n}\r\n\r\nconst busesProps:ObjViewProps<DevBus> = {\r\n    title: 'BUS',\r\n    formRows: [\r\n        {\r\n            label: '', \r\n            field: {name: 'name', type: 'string', maxLength: 100, required: true},\r\n        },\r\n        {\r\n            label: '',\r\n            field: {name: 'discription', type: 'string', maxLength: 250},\r\n            face: {type: 'textarea'}\r\n        },\r\n        {\r\n            label: 'Schema',\r\n            field: {name: 'schema', type: 'string', maxLength: 2500},\r\n            face: {type: 'textarea', rows: 8}\r\n        },\r\n    ],\r\n    row: (item:DevBus):JSX.Element => {\r\n        let {owner, name, discription, mine} = item;\r\n        //let icon = appIcon;\r\n        let main = owner + ' / ' + name;\r\n        return <LMR className=\"py-2 px-3 align-items-stretch\"\r\n            left={<FA className=\"pt-2 pr-1 text-primary\" name='cogs' size=\"lg\" />}>\r\n            <div className=\"px-3\">\r\n                <div>{mine===1? <b>{main}</b> : main}</div>\r\n                <div><Muted>{discription}</Muted></div>\r\n            </div>\r\n        </LMR>;\r\n    },\r\n    items: ()=>store.dev.buses,\r\n    repeated: {\r\n        name: 'name',\r\n        err: '',\r\n    },\r\n    info: Info,\r\n    canEdit: bus => bus.mine === 1,\r\n};\r\n\r\nexport default busesProps;\r\n","import * as React from 'react';\r\nimport {Prop, PropGrid, LMR, Muted, FA, EasyTime, EasyDate} from 'tonva';\r\nimport {UnitSpan} from '../tools';\r\nimport {store} from '../store';\r\nimport { ObjViewProps } from './ObjViewProps';\r\nimport { DevServer } from 'model';\r\n\r\nclass Info extends React.Component<DevServer> {\r\n    render() {\r\n        let {name, discription, unit, date_init, date_update} = this.props;\r\n        let disp = <div>\r\n            <div><b>{name}</b></div>\r\n            <div>{discription}</div>\r\n        </div>;\r\n        let right = <div className=\"text-right small text-muted align-self-end\">\r\n            :<EasyTime date={date_update}/><br/>\r\n            :<EasyDate date={date_init}/>\r\n        </div>;\r\n        let rows:Prop[] = [\r\n            '',\r\n            {type: 'component', component: <LMR className=\"w-100 py-2\"\r\n                left={<FA name=\"server\" className=\"text-primary fa-2x mr-3\" />}\r\n                right={right}>\r\n                {disp}\r\n            </LMR>},\r\n            '',\r\n            {type: 'component', label: '', component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> },\r\n            {type: 'string', label: 'URL', name: 'url'},\r\n            {type: 'string', label: '', name: 'cloud'},\r\n            {type: 'string', label: 'IP', name: 'ip'},\r\n        ];\r\n        return <div>\r\n            <PropGrid rows={rows} values={this.props} />\r\n        </div>;\r\n    }\r\n}\r\n\r\nconst serversProps:ObjViewProps<DevServer> = {\r\n    title: 'Server',\r\n    info: Info,\r\n    formRows: [\r\n        {\r\n            label: '', \r\n            field: {name: 'name', type: 'string', maxLength: 50, required: true},\r\n        },\r\n        {\r\n            label: 'URL', \r\n            field: {name: 'url', type: 'string', maxLength: 200, required: true},\r\n        },\r\n        {\r\n            label: 'IP', \r\n            field: {name: 'ip', type: 'string', maxLength: 20},\r\n        },\r\n        {\r\n            label: '', \r\n            field: {name: 'discription', type: 'string', maxLength: 50, required: false},\r\n        },\r\n        {\r\n            label: '', \r\n            field: {name: 'cloud', type: 'string', maxLength: 20, required: false},\r\n        },\r\n    ],\r\n    row: (item: DevServer):JSX.Element => {\r\n        let {name, discription, cloud} = item;\r\n        return <LMR className=\"py-2 px-3 align-items-center\"\r\n            left={<FA name=\"server\" className=\"text-primary fa-lg\" />}>\r\n            <div className=\"px-3\">\r\n\t\t\t\t<div><b className=\"mr-3\">{name}</b><Muted>{cloud}</Muted></div>\r\n                <div className=\"small text-muted\">{discription}</div>\r\n            </div>\r\n        </LMR>;\r\n    },\r\n    items: ()=>store.dev.servers,\r\n    repeated: {\r\n        name: 'name',\r\n        err: '',\r\n\t},\r\n\tcanEdit: server => {\r\n\t\tlet {isOwner, isAdmin} = store.unit;\r\n\t\treturn isOwner>0 || isAdmin>0;\r\n\t},\r\n};\r\n\r\nexport default serversProps;\r\n","import * as React from 'react';\r\nimport {observable} from 'mobx';\r\nimport {observer} from 'mobx-react';\r\nimport {nav, Page} from 'tonva';\r\nimport {TonvaForm, MultiStep, SubmitResult} from 'tonva-form';\r\nimport {DropdownActions, List, FA} from 'tonva';\r\nimport { store } from 'store';\r\nimport { ObjViewProps } from './ObjViewProps';\r\nimport { DevObjBase } from 'model';\r\n\r\n@observer\r\nexport class ObjView<T extends DevObjBase> extends React.Component<ObjViewProps<T>> {\r\n    async componentDidMount() {\r\n        await this.props.items().load();\r\n    }\r\n    //converter(item:T):ListItem {\r\n    //    return this.props.converter(item);\r\n    //}\r\n    newItem() {\r\n        this.props.items().cur = undefined;\r\n        nav.push(<New {...this.props} />);\r\n    }\r\n    itemClick = (item:T) => {\r\n        this.props.items().cur = observable(item);\r\n        nav.push(<Info {...this.props} />);\r\n    }\r\n    render() {\r\n        let {title, items} = this.props;\r\n        let {isOwner} = store.unit;\r\n\t\tlet right = isOwner>0 && <button className='btn btn-success btn-sm mr-2'\r\n\t\t\tonClick={()=>this.newItem()}><FA name=\"plus\" /></button>;\r\n        return <Page header={title} right={right}>\r\n            <List items={items().items}\r\n                item={{render: this.props.row, onClick: this.itemClick}}\r\n                />\r\n        </Page>;\r\n    }\r\n}\r\n\r\nclass New<T extends DevObjBase> extends React.Component<ObjViewProps<T>> {\r\n\tprivate tonvaForm:TonvaForm;\r\n    constructor(props:ObjViewProps<T>) {\r\n        super(props);\r\n        this.onSubmit = this.onSubmit.bind(this);\r\n    }\r\n    async onSubmit(values:any):Promise<SubmitResult> {\r\n        if (await this.props.items().check(values) === false) return;\r\n        let ret = await this.props.items().saveCur(values);\r\n        if (ret === true) {\r\n            nav.pop();\r\n        }\r\n        else {\r\n            let repeated = this.props.repeated;\r\n            this.tonvaForm.formView.setError(repeated.name, repeated.err);\r\n        }\r\n        return;\r\n    }\r\n    render() {\r\n        let content:any;\r\n        let {title, steps, stepHeader} = this.props;\r\n        let {formRows, items} = this.props;\r\n        if (steps !== undefined) {\r\n            content = <MultiStep className=\"mt-4\" header={stepHeader} steps={steps} first=\"step1\" onSubmit={this.onSubmit} />;\r\n        }\r\n        else if (formRows !== undefined) {\r\n            content = <TonvaForm ref={f => this.tonvaForm=f}\r\n                className=\"m-3\"\r\n                formRows={formRows} \r\n                onSubmit={this.onSubmit} initValues={items().cur} />;\r\n        }\r\n        else {\r\n            content = 'ObjViewProps: no steps and no formRows';\r\n        }\r\n        return <Page header={''+title}>\r\n            {content}\r\n        </Page>\r\n    }\r\n}\r\n\r\n@observer\r\nclass Info<T extends DevObjBase> extends React.Component<ObjViewProps<T>> {\r\n    private menuItems = [\r\n        {caption:'' + this.props.title, action:this.editItem.bind(this), icon:'edit' },\r\n        {caption:'', action:this.deleteItem.bind(this), icon:'trash-o' }\r\n    ];\r\n    async deleteItem() {\r\n        if (window.confirm('') === true) {\r\n            await this.props.items().del();\r\n            nav.pop();\r\n        }\r\n    }\r\n    editItem() {\r\n        nav.push(<Edit {...this.props} />);\r\n    }\r\n    render() {\r\n        let item = this.props.items().cur;\r\n        let actions = [];\r\n        let ex = this.props.extraMenuActions;\r\n        if (ex !== undefined) actions.push(...ex);\r\n        actions.push(...this.menuItems);\r\n        let canEdit = this.props.canEdit;\r\n        let right:any;\r\n        if (canEdit && canEdit(item) === true) {\r\n            right = <DropdownActions actions={actions} className=\"btn-primary mr-2\" />;\r\n\t\t}\r\n\t\t//<this.props.info {...item} />\r\n        return <Page header={this.props.title + ' - '} right={right}>\r\n            {React.createElement(this.props.info, item)}\r\n        </Page>;\r\n    }\r\n}\r\n\r\nclass Edit<T extends DevObjBase> extends React.Component<ObjViewProps<T>> {\r\n    private actions = [\r\n        {caption:'', action:this.deleteItem.bind(this), icon:'trash-o' }\r\n    ];\r\n    constructor(props: ObjViewProps<T>) {\r\n        super(props);\r\n        this.onSubmit = this.onSubmit.bind(this);\r\n    }\r\n    async onSubmit(values:any):Promise<SubmitResult> {\r\n        if (await this.props.items().check(values) === false) return;\r\n        await this.props.items().saveCur(values);\r\n        nav.pop();\r\n        return;\r\n    }\r\n    async deleteItem() {\r\n        if (window.confirm('') === true) {\r\n            await this.props.items().del();\r\n            nav.pop();\r\n        }\r\n    }\r\n    render() {\r\n        let right = <DropdownActions actions={this.actions} className=\"btn-primary mr-2\" />\r\n        return <Page header={' '+this.props.title} right={right} back=\"close\">\r\n            <TonvaForm \r\n                className=\"m-3\"\r\n                formRows={this.props.formRows} \r\n                onSubmit={this.onSubmit} initValues={this.props.items().cur} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { VPage, Page, LMR, Image, Edit, Controller, List } from \"tonva\";\r\nimport { FA, nav, Badge, ItemSchema, ImageSchema, StringSchema, UiSchema, UiTextItem, UiImageItem } from 'tonva';\r\nimport { CHome } from \"./CHome\";\r\nimport { observer } from 'mobx-react';\r\nimport { store } from 'store';\r\nimport { UnitApp, Unit, unitCaption, DevObjBase } from 'model';\r\n//import { CUsers } from 'Users';\r\nimport { ObjViewProps } from 'Dev/ObjViewProps';\r\nimport AppsPage from 'Apps';\r\nimport { AppController, CUq, busesProps, serversProps, ObjView } from 'Dev';\r\nimport { NewApp } from 'Apps/new';\r\n//import { CAdmins } from 'Admins';\r\n\r\nconst defaultIconClass = 'text-info';\r\nconst devIconClass = 'text-success';\r\n\r\ninterface  ActionBase {\r\n    title: string | JSX.Element;\r\n    icon: string|JSX.Element;\r\n    onClick?: ()=>void;\r\n    className?: string;\r\n    iconClassName?: string;\r\n    page?: new (props:any) => React.Component;\r\n}\r\n\r\ninterface ActionItem extends ActionBase {\r\n    right?: string | JSX.Element;\r\n    controller?: Controller;\r\n}\r\n\r\ninterface DevItem<T extends DevObjBase> extends ActionBase {\r\n    dev: true;\r\n    count: number;\r\n    objProps?: ObjViewProps<T>;\r\n}\r\n\r\ntype Item = ActionItem|DevItem<DevObjBase>|string;\r\n\r\nconst rArrow = <FA name=\"angle-right\" />;\r\n\r\nexport class VUnit extends VPage<CHome> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private appsAction:ActionItem = {\r\n        title: 'App',\r\n        right: rArrow, //'',\r\n        icon: 'play-circle-o',\r\n        page: AppsPage,\r\n    };\r\n    /*\r\n    private usersAction:ActionItem = {\r\n        main: '',\r\n        right: rArrow,\r\n        icon: 'users',\r\n        page: Members,\r\n    };\r\n    */\r\n    private newUsersAction:ActionItem = {\r\n        title: 'App',\r\n        right: <><small className=\"text-muted\">App</small> &nbsp; {rArrow}</>,\r\n        icon: 'user-o',\r\n        controller: this.controller.cUsers, // new UsersController(undefined),\r\n    };\r\n    /*\r\n    private devAction:Item = {\r\n        main: <DevActions />,\r\n        right: '',\r\n        icon: 'laptop',\r\n        //page: Dev,\r\n    };*/\r\n    private adminsAction: ActionItem = {\r\n        title: unitCaption(this.controller.unit) + '',\r\n        right: rArrow,\r\n        icon: 'universal-access',\r\n        //page: AdministorsPage,\r\n        controller: this.controller.cAdmins, // new CAdmins(undefined)\r\n    };\r\n    /*\r\n    private appUserManagerAction: ActionItem = {\r\n        main: 'App',\r\n        right: rArrow,\r\n        icon: 'vcard-o',\r\n        //page: Administors,\r\n        controller: new CAppUserManagers(undefined),\r\n    };\r\n    */\r\n    /*\r\n    private cOrganization = new COrganization;\r\n    private organizeAction:ActionItem = {\r\n        main: this.cOrganization.label,\r\n        right: rArrow,\r\n        icon: this.cOrganization.icon,\r\n        controller: this.cOrganization\r\n    };\r\n    */\r\n\r\n    private noneAction:ActionItem = {\r\n        title: '',\r\n        icon: 'hourglass-start',\r\n    };\r\n\r\n    private buildItems():Item[] {\r\n        let {unit, dev} = store;\r\n        let {isAdmin, isOwner, isDev, type} = unit;\r\n        let items:Item[] = [];\r\n        if (isOwner === 1 || isAdmin === 1) {\r\n            items.push(this.adminsAction);\r\n        }\r\n        if ((type & 2) !== 0) {\r\n            if (isAdmin === 1) {\r\n                items.push(this.newUsersAction);\r\n            }\r\n        }\r\n\r\n        // \r\n        if ((type & 1) !== 0) {\r\n            let {counts} = dev;\r\n\r\n            if (isAdmin ===1 || isDev === 1) {\r\n                items.push('')\r\n            }\r\n\r\n            if (isAdmin === 1) {\r\n                let developersAction:ActionItem = {\r\n                    title: '', \r\n                    right: rArrow,\r\n                    icon: 'user-o', \r\n                    onClick: async () => await this.controller.onShowDevelopers(),\r\n                    className: 'border-bottom',\r\n                    iconClassName: devIconClass,\r\n                };\r\n                items.push(developersAction);\r\n            }\r\n\r\n            if (isDev === 1 ) {\r\n                if (isOwner>0) {\r\n                    let appAction:DevItem<DevObjBase> = {\r\n                        dev: true,\r\n                        title: 'APP', \r\n                        count: counts && counts.app, \r\n                        icon: 'tablet', \r\n                        onClick: () => this.controller.startApp(unit), // new AppController(undefined).start(unit.id),\r\n                    };\r\n                    items.push(appAction);\r\n                }\r\n                let uqAction:DevItem<DevObjBase> = {\r\n                    dev: true,\r\n                    title: 'UQ', \r\n                    count: counts && counts.uq, \r\n                    icon: 'database', \r\n                    onClick: () => this.controller.startUq(unit), //new CUq(undefined).start(unit),\r\n                };\r\n                let busAction:DevItem<DevObjBase> = {\r\n                    dev: true,\r\n                    title: 'BUS', \r\n                    count: counts && counts.bus, \r\n                    icon: 'cogs', \r\n                    objProps: busesProps as any,\r\n                };\r\n                items.push(uqAction, busAction);\r\n                if (isOwner>0) {\r\n                    let serverAction:DevItem<DevObjBase> = {\r\n                        dev: true,\r\n                        title: 'Server', \r\n                        count: counts && counts.server, \r\n                        icon: 'server', \r\n                        objProps: serversProps as any,\r\n                    };\r\n                    items.push(serverAction);\r\n                }\r\n            }\r\n        }\r\n        /*\r\n        // \r\n        if ((type & 2) !== 0) {\r\n            if (isAdmin === 1) {\r\n                items.push(\r\n                    '',\r\n                    this.appsAction, \r\n                    //this.usersAction, \r\n                    this.newUsersAction, \r\n                    //this.organizeAction\r\n                );\r\n            }\r\n        }\r\n        */\r\n        return items;\r\n    }\r\n    private row = (item:Item, index:number):JSX.Element => {\r\n        if (typeof item === 'string') {\r\n            return <div className=\"px-3 pt-3 pb-1 small text-muted cursor-default\" style={{backgroundColor:'#f0f0f0'}}>{item}</div>;\r\n        }\r\n        let {iconClassName, className} = item;\r\n        if (iconClassName === undefined) iconClassName = defaultIconClass;\r\n        let {dev} = item as DevItem<DevObjBase>;\r\n        let left:any, mid:any, r:any;\r\n        if (dev === true) {\r\n            let {icon, title, count} = item as DevItem<DevObjBase>;\r\n            left = typeof icon === 'string'?\r\n                <FA className={iconClassName} name={icon} fixWidth={true} size=\"lg\" />\r\n                :\r\n                icon;\r\n            mid = title;\r\n            r = count>0 && <span>{count}</span>;\r\n        }\r\n        else {\r\n            let {right, title, icon} = item as ActionItem;\r\n            left = typeof icon === 'string'? \r\n                <FA className={iconClassName} name={icon} fixWidth={true} size=\"lg\" /> :\r\n                item.icon;\r\n            mid = title;\r\n            r = <span>{right}</span>;\r\n        }\r\n        return <LMR className={classNames('px-3 py-2 align-items-center', className)} left={left} right={r}>\r\n            <div className=\"px-3\"><b>{mid}</b></div>\r\n        </LMR>;\r\n    }\r\n    private rowClick = async (item:Item) => {\r\n        let {page:P, onClick} = item as ActionBase;\r\n        if (P !== undefined) {\r\n            nav.push(<P />);\r\n            return;\r\n        }\r\n        if (onClick) {\r\n            onClick();\r\n            return;\r\n        }\r\n        let {objProps} = item as DevItem<DevObjBase>;\r\n        if (objProps !== undefined) {\r\n            return nav.push(<ObjView {...objProps} />);\r\n        }\r\n        let {controller} = item as ActionItem;\r\n        if (controller) {\r\n            await controller.start(store.unit);\r\n            return;\r\n        }\r\n    }\r\n\r\n    private appItemRender(app:UnitApp, index:number) {\r\n        let {name, discription, icon, inUnit} = app;\r\n        let ban = (inUnit === 0) &&\r\n            <FA className=\"text-danger\" name='ban' />;\r\n        return <LMR className=\"px-3 py-2\"\r\n            left={<Badge><Image src={icon} /></Badge>}\r\n            right={ban}>\r\n            <div className=\"px-3\">\r\n                <div><b>{name}</b></div>\r\n                <small className=\"text-muted\">{discription}</small>\r\n            </div>\r\n        </LMR>;\r\n    }\r\n    private appClick = async (app:UnitApp) => {\r\n        await this.controller.showAppXAccount(app);\r\n        /*\r\n        nav.push(<Page header=\"App\">\r\n            <Info app={app} />\r\n        </Page>);\r\n        */\r\n    }\r\n    private newItem() {\r\n        nav.push(<NewApp />);\r\n    }\r\n    private appRender() {\r\n        let {apps} = store;\r\n        if (apps === undefined) return;\r\n        if (apps.length === 0) return;\r\n        let {isAdmin, isOwner} = store.unit;\r\n        let right =  (isAdmin===1 || isOwner===1) && <button \r\n            className='btn btn-success btn-sm' \r\n            onClick={()=>this.newItem()}><FA name=\"plus\" /></button>;\r\n        return <>\r\n            <LMR className=\"mt-4 mb-2 px-3 small text-muted align-items-end\" right={right}>\r\n                <div className=\"align-self-end\">App</div>\r\n            </LMR>\r\n            <List items={store.apps} item={{render: this.appItemRender, onClick: this.appClick}} />\r\n        </>\r\n    }\r\n\r\n    private onClickUnitProps = () => {\r\n        this.openPageElement(<UnitProps />);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let unit:Unit = store.unit;\r\n        if (unit === undefined) {\r\n            //console.log(\"admin render without unit\");\r\n            return null;\r\n        }\r\n        //console.log(\"admin render with unit\");\r\n        let items = this.buildItems();\r\n        if (items === undefined) {\r\n            return <Page header=\"\" />;\r\n        }\r\n        let header:any, top:any;\r\n        if (unit !== undefined) {\r\n            let {name, nick, icon, discription} = unit;\r\n            let title:string, vice:any;\r\n            if (nick) {\r\n                title = nick;\r\n                vice = <h6><small className='text-secondary'>{name}</small></h6>;\r\n            }\r\n            else {\r\n                title = name;\r\n            }\r\n            let caption = unitCaption(this.controller.unit);\r\n            if (caption !== undefined) header = caption + ' - ' + title;\r\n            top = <LMR className='px-3 my-4 bg-white py-2 cursor-pointer' onClick={this.onClickUnitProps}\r\n                left={<div><Image className=\"w-3c h-3c\" src={icon} /></div>}>\r\n                <div className=\"px-3\">\r\n                    <LMR right={vice}><h6 className='text-dark font-weight-bold'>{title}</h6></LMR>\r\n                    <div className='text-info overflow-hidden h-max-3c'>{discription}</div>\r\n                </div>\r\n            </LMR>;\r\n        }\r\n        else {\r\n            header = '';\r\n        }\r\n\r\n        return <Page header={header} logout={this.controller.logout}>\r\n            {top}\r\n            {items.length>0 && <List items={items} item={{render:this.row, onClick:this.rowClick}} />}\r\n            {this.appRender()}\r\n        </Page>;\r\n    })\r\n}\r\n\r\n\r\nclass UnitProps extends React.Component {\r\n    private schema:ItemSchema[] =[\r\n        {name: 'icon', type: 'image'} as ImageSchema,\r\n        {name: 'nick', type: 'string'} as StringSchema,\r\n        {name: 'discription', type: 'string'} as StringSchema,\r\n    ];\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            nick: {widget:'text', label:'', placeholder:''} as UiTextItem,\r\n            icon: {widget:'image', label:''} as UiImageItem,\r\n            discription: {widget:'text', label:'', placeholder:''} as UiTextItem,\r\n        }\r\n    }\r\n    /*\r\n    async onNickChanged(value:any, orgValue:any):Promise<void> {\r\n        await store.unitChangeProp('nick', value);\r\n    }\r\n    async onDiscriptionChanged(value:any, orgValue:any):Promise<void> {\r\n        await store.unitChangeProp('discription', value);\r\n    }\r\n    */\r\n    private onItemChanged = async (itemSchema:ItemSchema, newValue:any, preValue:any) => {\r\n        let {name} = itemSchema;\r\n        //await userApi.userSetProp(name, newValue);\r\n        await store.unitChangeProp(name, newValue);\r\n        //this.data[name] = newValue;\r\n        //nav.user[name] = newValue;\r\n        //nav.saveLocalUser();\r\n    }\r\n    //<PropGrid rows={this.rows} values={store.unit} alignValue=\"right\" />\r\n    render() {\r\n        let unit:Unit = store.unit;\r\n        let {isRoot, isOwner, readMe} = unit;\r\n        let caption = unitCaption(unit);\r\n\r\n        let divReadMe = readMe && <div className=\"p-3\" \r\n            dangerouslySetInnerHTML={{__html:readMe}}></div>;\r\n\r\n        return <Page header={caption + ''}>\r\n            <Edit schema={this.schema} uiSchema={this.uiSchema}\r\n                data={store.unit}\r\n                onItemChanged={this.onItemChanged}\r\n                stopEdit={!(isRoot>0 && isOwner>0)} />\r\n            {divReadMe}\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { VPage, Page, List, LMR, FA } from 'tonva';\r\nimport { CHome } from './CHome';\r\nimport { UnitAdmin } from 'model';\r\nimport { store } from 'store';\r\n\r\nexport class VHome extends VPage<CHome> {\r\n    async open() {\r\n        let {isProduction, unitAdmins} = this.controller;\r\n        if (isProduction === false) {\r\n            switch (unitAdmins.length) {\r\n                default: this.openPage(this.selectUnitPage); return;\r\n                case 0: this.openPage(this.noUnitPage); return;\r\n                case 1: await this.controller.onShowUnit(unitAdmins[0]); return;\r\n            }\r\n        }\r\n\r\n        if (store.unit === undefined) {\r\n            this.openPage(this.noUnitPage);\r\n            return;\r\n        }\r\n        await this.controller.onShowUnit(unitAdmins[0]);\r\n    }\r\n\r\n    private onClickUnit = async (unitAdmin: UnitAdmin) => {\r\n        this.closePage();\r\n        await this.controller.onShowUnit(unitAdmin);\r\n    }\r\n\r\n    private selectUnitPage = () => {\r\n        let {accUnits, devUnits, bothUnits, logout} = this.controller;\r\n        let item = {render: this.renderUnitAdmin, onClick: this.onClickUnit};\r\n        let list = (items:UnitAdmin[], label:string) => {\r\n            return items.length>0 &&\r\n            <div className=\"my-3\">\r\n                <div className=\"px-3 py-1 small text-muted\">{label}</div>\r\n                <List items={items} item={item} />\r\n            </div>\r\n        }\r\n        return <Page header=\"\" logout={logout}>\r\n            {list(accUnits, '')}\r\n            {list(devUnits, '')}\r\n            {list(bothUnits, '')}\r\n        </Page>;\r\n        //<List items={this.controller.unitAdmins} \r\n        //    item={{render: this.renderRow, onClick: this.onRowClick}} />\r\n}\r\n\r\n    private noUnitPage = () => {\r\n        let {user, logout} = this.controller;\r\n        let {nick, name} = user;\r\n        return <Page header=\"\" logout={logout}>\r\n            <div className=\"p-3 small text-info\">\r\n                {nick || name}: \r\n            </div>\r\n        </Page>\r\n    }\r\n\r\n    protected get view():any {return undefined}\r\n\r\n    private renderUnitAdmin = (item: UnitAdmin, index: number):JSX.Element => {\r\n        let {name, nick, type} = item;\r\n        let icon:string, color:string;\r\n        if (type & 1) {\r\n            icon = 'code';\r\n            color = 'text-success';\r\n        }\r\n        else if (type & 2) {\r\n            icon = 'flag';\r\n            color = 'text-primary';\r\n        }\r\n        else {\r\n            icon = 'start';\r\n            color = 'text-danger';\r\n        }\r\n        return <LMR className=\"px-3 py-2\" right={<span className=\"small text-muted\">id: {item.id}</span>}>\r\n            <div>\r\n                <FA name={icon} fixWidth={true} className={classNames('mr-3', color)} />\r\n                {nick || name}\r\n            </div>\r\n        </LMR>;\r\n    }\r\n    /*\r\n    private onUnitClick = async (item: UnitAdmin) => {\r\n        appInFrame.unit = item.id; // 25;\r\n        store.init();\r\n        await store.loadUnit();\r\n        this.closePage();\r\n        this.openPageElement(<AdminPage />);\r\n    }*/\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount, Coll } from './CAppXAccount';\r\nimport { VPage, Page, PropGrid, Media, Prop, FA, LMR } from 'tonva';\r\nimport { IdDates } from 'tools';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VApp extends VPage<CAppXAccount> {    \r\n    async open() {\r\n        this.openPage(this.page)\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {appXAccount, showDetail, users, showUserList, calcUserColl} = this.controller;\r\n        let coll = calcUserColl();\r\n        let {name, discription, icon, date_init, date_update} = appXAccount;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n\t\tlet right = <button className=\"btn btn-success btn-sm mr-2 align-self-center\"\r\n\t\t\tonClick={showDetail}><FA name=\"ellipsis-h\" fixWidth={true} /></button>;\r\n        let rows:Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component', \r\n                component: <Media icon={icon} main={name} discription={disp} />\r\n            },\r\n            '',\r\n        ];\r\n        return <Page header={\"App - \" + name} right={right}>\r\n            <PropGrid rows={rows} values={{}} />\r\n            {this.renderAdmins(coll)}\r\n            {this.renderRoles(coll)}\r\n            {this.renderUsers(coll)}\r\n            <div className=\"h-1c\" />\r\n            {this.row('', users.length, showUserList, 'text-info', 'list')}\r\n        </Page>;\r\n    })\r\n    \r\n    private row(content:JSX.Element|string, count:number, onClick:()=>void, color:string, icon?:string):JSX.Element {\r\n        let left = <FA className={\"mr-3 \" + color } fixWidth={true} name={icon || \"user\"} size=\"lg\" />;\r\n        let right = <>{count} &nbsp; &nbsp; <FA className=\"align-self-center\" name=\"angle-right\" /></>;\r\n        return <LMR className=\"my-2 px-3 py-2 bg-white align-items-center\" \r\n            onClick={onClick} left={left} right={right}>{content}</LMR>;\r\n    }\r\n\r\n    private renderAdmins(coll:Coll):JSX.Element {\r\n        let {showAdmins, unit} = this.controller;\r\n        if (unit.isAdmin === 1) {\r\n            return this.row('', coll.admins.length, showAdmins, 'text-danger');\r\n        }\r\n    }\r\n\r\n    private renderRoles(coll:Coll):JSX.Element {\r\n        let {showRoles, roleUserCount} = this.controller;\r\n        let {roleUsers} = coll;\r\n        if (!roleUsers) return;\r\n        return this.row('', roleUserCount, showRoles, 'text-success');\r\n    }\r\n\r\n    private renderUsers(coll:Coll):JSX.Element {\r\n        let {showUsers} = this.controller;\r\n        return this.row('', coll.users.length, showUsers, 'text-info');\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport {Media, List, LMR, Prop, PropGrid, FA, VPage, Page} from 'tonva';\r\nimport { CAppXAccount } from './CAppXAccount';\r\nimport { IdDates, UnitSpan } from 'tools';\r\n\r\nexport class VDetail extends VPage<CAppXAccount> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderUqRow = (uqAccess:any, index:number):JSX.Element => {\r\n        let {name, owner, discription} = uqAccess;\r\n        return <LMR className=\"py-2\" right={<small className=\"text-muted\">{discription}</small>}>\r\n            {owner} / {name}\r\n        </LMR>;\r\n    }\r\n\r\n    private onTurnOnOff = async () => {\r\n        if (await this.controller.appTurnOnOff() === true) {\r\n            this.closePage();\r\n            // after action;\r\n            //let {id, inUnit} = this.props.app;\r\n            //appActed?.(id, inUnit);\r\n        }\r\n    }\r\n\r\n    private status = ():JSX.Element => {\r\n        let {inUnit} = this.controller.appXAccount;\r\n        let text:string, right:any;\r\n        if (inUnit === 1) {\r\n            right = <button className=\"btn btn-danger\" onClick={this.onTurnOnOff}>\r\n                <FA name=\"ban\" /> APP\r\n            </button>;\r\n            text = '';\r\n        }\r\n        else if (inUnit === 0) {\r\n            right = <button className=\"btn btn-success\" onClick={this.onTurnOnOff}>\r\n                <FA name=\"refresh\" size=\"lg\" /> APP\r\n            </button>;\r\n            text = '';\r\n        }\r\n        else {\r\n            right = <button className=\"btn btn-primary\" onClick={this.onTurnOnOff}>\r\n                <FA name=\"plus\" size=\"lg\" /> \r\n            </button>;\r\n            text = 'APP';\r\n        }\r\n        return <LMR className=\"w-100 align-items-center my-1\" right={right}>{text}</LMR>;\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {appXAccount, uqAccesses} = this.controller;\r\n        let {unit, name, discription, icon, date_init, date_update} = appXAccount;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        let rows:Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component', \r\n                component: <Media icon={icon} main={name} discription={disp} />\r\n            },\r\n            '',\r\n            {\r\n                type: 'component', \r\n                label: '', \r\n                component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div>\r\n            },\r\n            {\r\n                type: 'component', \r\n                label: 'UQ', \r\n                component: <List className=\"w-100\" items={uqAccesses}\r\n                    item={{render: this.renderUqRow}} />\r\n            },\r\n            '',\r\n            {\r\n                type: 'component', \r\n                label: '',\r\n                component: this.status()\r\n            },\r\n        ];\r\n        return <Page header={\"App - \" + name}>\r\n            <PropGrid rows={rows} values={{}} labelFixLeft={true} />\r\n        </Page>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount, User } from \"./CAppXAccount\";\r\nimport { View, LMR, Image, FA } from \"tonva\";\r\nimport { caches } from 'store';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VUser extends View<CAppXAccount> {\r\n    render(user: User):JSX.Element {\r\n\t\t//return <this.row user={user} />;\r\n\t\treturn React.createElement(this.row, {user});\r\n    }\r\n\r\n    private row = observer((props: {user: User}) => {\r\n        let {user} = props;\r\n        let u = caches.users.get(user.id);\r\n        if (u === null) return;\r\n        let {name, nick, icon} = u;\r\n        let {assigned, isAdmin, roleBins} = user;\r\n        if (assigned !== undefined) nick = assigned;\r\n        if (name !== undefined) {\r\n            let {uqRoles, showEditUserPage, user:_user} = this.controller;\r\n            let left = <Image className=\"w-3c h-3c mr-3\" src={icon} />;\r\n            let isMe = user.id === _user.id;\r\n            let caption:any = isMe === true?\r\n                <div>\r\n                    {nick? <><b>{nick}</b> {name}</> : <><b>{name}</b></>} \r\n                    &nbsp; <small className=\"text-muted\">[]</small>\r\n                </div>\r\n                :\r\n                <div>{nick? <>{nick} <small>{name}</small></> : <>{name}</>}</div>;\r\n            let divRoles:any[] = [];\r\n            if (uqRoles !== undefined) {\r\n                let len = uqRoles.length;\r\n                for (let i=0; i<len; i++) {\r\n                    if ((roleBins & (1<<i)) === 0) continue;\r\n                    divRoles.push(this.box(uqRoles[i], 'px-2 text-primary border-primary bg-white'));\r\n                }\r\n            }\r\n\r\n            return <LMR className=\"px-3 py-3 cursor-pointer\" left={left} onClick={()=>showEditUserPage(user)}>\r\n                {caption}\r\n                <div className=\"d-flex flex-wrap mt-1\">\r\n                    {isAdmin===true && this.box('', 'px-2 text-success border-success bg-light')}\r\n                    {divRoles}\r\n                </div>\r\n            </LMR>;\r\n        }\r\n    });\r\n\r\n    private box = (text:string, cn:string) => {\r\n        return <div className={'mr-3 py-0 small border rounded ' + cn} key={text}>{text}</div>;\r\n    }\r\n}\r\n\r\nexport class VAddUser extends View<CAppXAccount> {\r\n    render(roleNum:number):JSX.Element {\r\n        return <button \r\n            className=\"btn btn-sm btn-success align-self-center mr-2\" \r\n            onClick={()=>this.controller.showAddUserPage(roleNum)}>\r\n                <FA name=\"plus\" />\r\n        </button>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount } from './CAppXAccount';\r\nimport { VPage, Page, List } from 'tonva';\r\nimport { VAddUser } from './VUser';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VAdmins extends VPage<CAppXAccount> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {appXAccount, renderUser} = this.controller;\r\n        let {name} = appXAccount;\r\n        let coll = this.controller.calcUserColl();\r\n        return <Page header={' - ' + name} right={this.renderVm(VAddUser, -1)}>\r\n            <List items={coll.admins} item={{render: renderUser}} />\r\n        </Page>;\r\n    })\r\n\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount, User } from './CAppXAccount';\r\nimport { VPage, Page, List, LMR } from 'tonva';\r\nimport { VAddUser } from './VUser';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VRoleUsers extends VPage<CAppXAccount> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {appXAccount} = this.controller;\r\n        let {name} = appXAccount;\r\n        let coll = this.controller.calcUserColl();\r\n        let {roleUsers} = coll;\r\n        return <Page header={' - ' + name}>\r\n            <div className=\"py-0\">\r\n                {roleUsers && roleUsers.map((v, index) => {\r\n                    return this.renderRole(v, index);\r\n                })}\r\n            </div>\r\n        </Page>;\r\n    })\r\n\r\n    private renderRole = (users:User[], index:number) => {\r\n        let {uqRoles, renderUser} = this.controller;\r\n        let role = uqRoles[index];\r\n        if (!role) return;\r\n        return <div key={index} className=\"my-3\">\r\n            <LMR className=\"pl-3 pb-1 align-items-end\" right={this.renderVm(VAddUser, index+1)}>{uqRoles[index]}</LMR>\r\n            <List items={users} item={{render: renderUser}} none={()=><small className=\"text-muted\">[]</small>} />\r\n        </div>;\r\n    }\r\n\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount } from './CAppXAccount';\r\nimport { VPage, Page, List } from 'tonva';\r\nimport { VAddUser } from './VUser';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VNoRoleUsers extends VPage<CAppXAccount> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {appXAccount, renderUser} = this.controller;\r\n        let {name} = appXAccount;\r\n        let coll = this.controller.calcUserColl();\r\n        return <Page header={' - ' + name} right={this.renderVm(VAddUser, -2)}>\r\n            <List items={coll.users} item={{render: renderUser}} />\r\n        </Page>;\r\n    })\r\n\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount } from \"./CAppXAccount\";\r\nimport { VPage, Page, Form, Schema, StringSchema, ButtonSchema, UiSchema, UiButton, UiTextItem, Context } from \"tonva\";\r\n\r\nexport class VAddUserPage extends VPage<CAppXAccount> {\r\n    private roleNum:number;\r\n    private schema:Schema = [\r\n        {name: 'user', type: 'string', required: true} as StringSchema,\r\n        {name: 'submit', type: 'submit'} as ButtonSchema,\r\n    ];\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            'user': {widget: 'text', label: '', placeholder: ''} as UiTextItem,\r\n            'submit': {widget: 'button', label: '', className: 'btn btn-primary'} as UiButton,\r\n        }\r\n    }\r\n    async open(roleNum:number) {\r\n        this.roleNum = roleNum;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onSubmit = async (name:string, context:Context) => {\r\n        let ret = await this.controller.addUser(this.roleNum, context.data.user);\r\n        if (ret === undefined) {\r\n            this.closePage();\r\n            return;\r\n        }\r\n        context.setError('user', ret);\r\n    }\r\n\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'user') {\r\n            await this.onSubmit('login', context);\r\n            return;\r\n        }\r\n    }\r\n\r\n    private page = () => {\r\n        let roleCaption = this.controller.getRoleCaption(this.roleNum);\r\n        return <Page header={' - ' + roleCaption} back=\"close\">\r\n            <div className=\"m-5 px-5 py-3 bg-white border rounded\">\r\n                <Form schema={this.schema} uiSchema={this.uiSchema}\r\n                    onEnter={this.onEnter}\r\n                    onButtonClick={this.onSubmit}/>\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount } from './CAppXAccount';\r\nimport { VPage, Page, List } from 'tonva';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VUserList extends VPage<CAppXAccount> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {appXAccount, users, renderUser} = this.controller;\r\n        let {name} = appXAccount;\r\n        return <Page header={' - ' + name}>\r\n            <List items={users} item={{render: renderUser}} />\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, Media, PropGrid} from 'tonva';\r\nimport {nav, Page}  from 'tonva';\r\nimport {caches} from 'store';\r\nimport {span} from './span';\r\n\r\nexport interface UserLinkProps {\r\n    className?: string;\r\n    id: number;\r\n    assigned?: string;\r\n    isLink?: boolean;\r\n}\r\n\r\n@observer\r\nexport class UserSpan extends React.Component<UserLinkProps> {\r\n    onClick = (evt) => {\r\n        evt.preventDefault();\r\n        nav.push(<UserInfo id={this.props.id} />);\r\n        return false;\r\n    }\r\n    render() {\r\n        let {id, className, assigned, isLink} = this.props;\r\n        let api = caches.users.get(id);\r\n        let content:any;\r\n        if (api === null) {\r\n            content = id;\r\n        }\r\n        else {\r\n            let {name, nick} = api;\r\n            if (assigned !== undefined) nick = assigned;\r\n            if (name !== undefined) {\r\n                content = nick? <><b>{nick}</b> {name}</> : <><b>{name}</b></>;\r\n            }\r\n            else {\r\n                content = id;\r\n            }\r\n        }\r\n        return span(isLink, className, this.onClick, content);\r\n    }\r\n}\r\n\r\n@observer\r\nclass UserInfo extends React.Component<UserLinkProps> {\r\n    private rows:Prop[];\r\n    render() {\r\n        let uq = caches.users.get(this.props.id);\r\n        let {name, nick, icon} = uq;\r\n        this.rows = [\r\n            '',\r\n            {type: 'component', component: <Media icon={icon} main={nick} discription={name} />},\r\n            '',\r\n        ];\r\n        return <Page header={' - '}>\r\n            <PropGrid rows={this.rows} values={this.props} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { CAppXAccount, User } from \"./CAppXAccount\";\r\nimport { VPage, Page, FA } from \"tonva\";\r\nimport { UserSpan } from 'tools/userSpan';\r\n\r\nexport class VEditUserPage extends VPage<CAppXAccount> {\r\n    private user:User;\r\n    async open(user:User) {\r\n        this.user = user;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private row = (caption: string, cn: string, \r\n        isChecked: boolean,\r\n        isMeAdmin: boolean,\r\n        onChange:(event:React.ChangeEvent<HTMLInputElement>)=>Promise<void>) => \r\n    {\r\n        if (!caption) return;\r\n        return <label className={classNames(\r\n            \"px-3 py-2 m-0 d-flex bg-white mb-1 w-100 align-items-center\",\r\n            {\"cursor-pointer\":!isMeAdmin})}>\r\n            <input type=\"checkbox\" className=\"mr-4\" defaultChecked={isChecked} \r\n                disabled={isMeAdmin}\r\n                onChange={onChange} />\r\n            <span className={cn}>{caption}</span>\r\n        </label>\r\n    }\r\n\r\n    private onAdminChanged = async (value:boolean) => {\r\n        let ret = await this.controller.setAppAdmin(this.user, value);\r\n        if (ret === undefined) this.closePage();\r\n        else alert(ret);\r\n    }\r\n\r\n    private onRoleChanged = async (value:boolean, roleNum:number) => {\r\n        let ret = await this.controller.setAppRole(this.user, roleNum, value);\r\n        // if (ret === undefined) this.closePage();\r\n        // else alert(ret);\r\n        if (ret !== undefined) alert(ret);\r\n    }\r\n\r\n    private onDelUer = async () => {\r\n        let ret = await this.controller.delUser(this.user);\r\n        if (ret === undefined) this.closePage();\r\n        else alert(ret);\r\n    }\r\n\r\n    private page = () => {\r\n        let {isAdmin, roleBins} = this.user;\r\n        let header = <> -&nbsp;<UserSpan id={this.user.id} /></>;\r\n        let btnDel = this.user.id !== this.controller.user.id\r\n            && <div className=\"text-right m-3\"><button onClick={this.onDelUer}\r\n                    className=\"btn btn-sm btn-outline-primary\"\r\n                ><FA name=\"trash\" /> App</button>\r\n            </div>;\r\n        let isMeAdmin = this.user.id === this.controller.user.id;\r\n        let onAdminChange = async (event:React.ChangeEvent<HTMLInputElement>) => {\r\n            await this.onAdminChanged(event.target.checked);\r\n        }\r\n        return <Page header={header}>\r\n            <div className=\"my-3\">\r\n                {this.row('App', 'text-success font-weight-bold', isAdmin, isMeAdmin, onAdminChange)}\r\n                <div className=\"h-1c\" />\r\n                {this.controller.uqRoles.map((v, index) => {\r\n                    let onRoleChange = async (event:React.ChangeEvent<HTMLInputElement>) => {\r\n                        await this.onRoleChanged(event.target.checked, index);\r\n                    }\r\n                    let isChecked = (roleBins & (1<<index)) !== 0;\r\n                    return this.row(v, 'text-primary', isChecked, false, onRoleChange);\r\n                })}\r\n                {btnDel}\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n","import _ from 'lodash';\r\nimport { CUqBase } from \"UqApp\";\r\nimport { UnitApp, Unit, DevApp } from \"model\";\r\nimport { VApp } from \"./VApp\";\r\nimport { VDetail } from \"./VDetail\";\r\nimport { devApi, mainApi } from \"api\";\r\nimport { store } from \"store\";\r\nimport { observable } from 'mobx';\r\nimport { VAdmins } from './VAdmins';\r\nimport { VRoleUsers } from './VRoleUsers';\r\nimport { VNoRoleUsers } from './VNoRoleUsers';\r\nimport { VAddUserPage } from './VAddUserPage';\r\nimport { VUser } from './VUser';\r\nimport { VUserList } from './VUserList';\r\nimport { VEditUserPage } from './VEditUserPage';\r\n\r\nexport interface User {\r\n    id: number;\r\n    assigned: string;\r\n    isAdmin: boolean;\r\n    roleBins:number;\r\n}\r\n\r\nexport interface Coll {\r\n    admins: User[];\r\n    users: User[];\r\n    roleUsers: User[][];\r\n}\r\n\r\nexport class CAppXAccount extends CUqBase {\r\n    unit: Unit;\r\n    appXAccount:DevApp;\r\n    uqAccesses: any[];\r\n    uqMain: number;\r\n    uqRoles: string[];\r\n    //userColl: {[id:number]: User};\r\n    @observable users: User[];\r\n    @observable unitOnly: boolean;\r\n    @observable roleUserCount: number;\r\n\r\n    async internalStart(unit:Unit, appXAccount:DevApp) {\r\n        this.unit = unit;\r\n        this.appXAccount = appXAccount;\r\n        this.unitOnly = appXAccount.unitOnly === 1;\r\n        await this.loadAppAdmins();\r\n        this.openVPage(VApp);\r\n    }\r\n\r\n    private async loadAppAdmins() {\r\n        let ret:any[][] = await mainApi.unitAppAdmins(this.unit.id, this.appXAccount.id);\r\n        let {uq_main, roles} = ret[0][0];\r\n        this.uqMain = uq_main;\r\n        if (roles) {\r\n            this.uqRoles = (roles as string).split('\\t');\r\n        }\r\n        this.users = [];\r\n        for (let admin of ret[1]) {\r\n            let {user:id} = admin;\r\n            let i = this.insertUser(id);\r\n            if (i>=0) this.users[i].isAdmin = true;\r\n        }\r\n        let roleUserCount = 0;\r\n        for (let userRoles of ret[2]) {\r\n            let {user:id, roles} = userRoles;\r\n            let i = this.insertUser(id);\r\n            if (i>=0) {\r\n                //let rolesArr = this.toRolesArr(roles);\r\n                this.users[i].roleBins = roles; // rolesArr;\r\n                //if (rolesArr !== undefined && rolesArr.length > 0) roleUserCount++;\r\n                if (!roles) roleUserCount++;\r\n            }\r\n        }\r\n        for (let item of ret[3]) {\r\n            let {user:id, assigned} = item;\r\n            let i = this.insertUser(id);\r\n            if (i>=0) this.users[i].assigned = assigned;\r\n        }\r\n        this.roleUserCount = roleUserCount;\r\n    }\r\n\r\n    private insertUser(id:number):number {\r\n        let len = this.users.length;\r\n        let i:number;\r\n        for (i=0; i<len; i++) {\r\n            let u = this.users[i];\r\n            let uid = u.id;\r\n            if (id === uid) return i;\r\n            if (id < uid) break;\r\n        }\r\n        this.users.splice(i, 0, {id:id} as User);\r\n        return i;\r\n    }\r\n\r\n    private toRolesArr(n: number):number[] {\r\n        if (this.uqRoles === undefined) return undefined;\r\n        let ret:number[] = [];\r\n        let len = this.uqRoles.length;\r\n        let mask = 1;\r\n        for (let i=0;i<len; i++, mask<<=1) {\r\n            if ((n & mask) === mask) ret.push(i);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    calcUserColl = (): Coll => {\r\n        let admins:User[] = [];\r\n        let users:User[] = [];\r\n        let roleUsers:User[][];\r\n        let roleUserCount = 0;\r\n        let len = 0;\r\n        if (this.uqRoles) {\r\n            len = this.uqRoles.length;\r\n            roleUsers = [];\r\n            for (let i=0; i<len; i++) roleUsers.push([]);\r\n        }\r\n        for (let user of this.users) {\r\n            let {isAdmin, roleBins} = user;\r\n            let isUser = true, isRole = false;\r\n            if (isAdmin === true) {\r\n                admins.push(user);\r\n                isUser = false;\r\n            }\r\n\r\n            let mask = 1;\r\n            for (let i=0; i<len; i++, mask<<=1) {\r\n                if ((roleBins & mask) !== 0) {\r\n                    let rus = roleUsers[i];\r\n                    if (this.user.id === user.id) \r\n                        rus.unshift(user);\r\n                    else\r\n                        rus.push(user);\r\n                    isUser = false;\r\n                    isRole = true;\r\n                }\r\n            }\r\n            if (isRole === true) {\r\n                ++roleUserCount;\r\n            }\r\n            if (isUser === true) {\r\n                users.push(user);\r\n            }\r\n        }\r\n        this.roleUserCount = roleUserCount;\r\n        return {\r\n            admins: admins,\r\n            users: users,\r\n            roleUsers: roleUsers,\r\n        };\r\n    }\r\n\r\n    showDetail = async () => {\r\n        this.uqAccesses = await devApi.loadAppUqs(this.appXAccount.id);\r\n        this.openVPage(VDetail);\r\n    }\r\n\r\n    appTurnOnOff = async ():Promise<boolean> => {\r\n        let {id, inUnit, name} = this.appXAccount;\r\n        //let newInUnit:number = 1;\r\n        if (inUnit === 0) {\r\n            let ret = await store.restoreUnitApp(id);\r\n            if (ret <= 0) {\r\n                alert('app  uq  service');\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n\r\n        if (inUnit === 1) {\r\n            let ret = await this.confirm({\r\n                caption: ' - ' + name,\r\n                message: 'App',\r\n                ok: '',\r\n            });\r\n            if (ret !== 'ok') return false;\r\n            await store.stopUnitApp(id);\r\n            //newInUnit = 0;\r\n            return true;\r\n        }\r\n\r\n        let newApp:UnitApp = _.clone(this.appXAccount);\r\n        newApp.id = id;\r\n        newApp.inUnit = 1;\r\n        let ret = await store.addUnitApp(newApp);\r\n        if (ret <= 0) {\r\n            alert('app  uq  service');\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    showAdmins = async () => {\r\n        this.openVPage(VAdmins);\r\n    }\r\n\r\n    showRoles = async () => {\r\n        this.openVPage(VRoleUsers);\r\n    }\r\n\r\n    showUsers = async () => {\r\n        this.openVPage(VNoRoleUsers);\r\n    }\r\n\r\n    showUserList = async () => {\r\n        this.openVPage(VUserList);\r\n    }\r\n\r\n    showAddUserPage = (roleNum:number) => {\r\n        this.openVPage(VAddUserPage, roleNum);\r\n    }\r\n\r\n    showEditUserPage = (user: User) => {\r\n        this.openVPage(VEditUserPage, user);\r\n    }\r\n\r\n    getRoleCaption(roleNum:number):string {\r\n        switch(roleNum) {\r\n            case -1: return '[App]';\r\n            case -2: return '[]';\r\n            default: return this.uqRoles[roleNum];\r\n        }\r\n    }\r\n\r\n    async addUser(roleNum:number, userName:string):Promise<string> {\r\n        let roleBit:number = roleNum<=0? roleNum : 1<<(roleNum-1);\r\n        let ret = await mainApi.setAppRoles(this.unit.id, this.appXAccount.id, undefined, userName, roleBit);\r\n        if (ret === undefined) return 'unauthorized';\r\n        let {r, id} = ret;\r\n        if (r !== undefined) return r;\r\n\r\n        let i = this.insertUser(id);\r\n        //let isAdmin:boolean = false; \r\n        let user = this.users[i];\r\n        if (roleNum > 0) {\r\n            user.roleBins |= (1<<roleNum-1);\r\n        }\r\n        else if (roleNum === -1) {\r\n            // \r\n            user.isAdmin = true;\r\n        }\r\n        else if (roleNum === 0) {\r\n            // \r\n        }\r\n        //this.users[i] = {id, isAdmin, roles, assigned:undefined};\r\n    }\r\n\r\n    renderUser = (user:User, index:number) => {\r\n        return this.renderView(VUser, user);\r\n    }\r\n\r\n    async setAppAdmin(user:User, on:boolean):Promise<string> {\r\n        let {id, isAdmin, roleBins, assigned} = user;\r\n        isAdmin = on;\r\n        let ret = await mainApi.setAppAdmin(\r\n            this.unit.id, this.appXAccount.id, \r\n            id, undefined, isAdmin===true? 1:0);\r\n        if (ret === undefined) {\r\n            return 'unauthorized';\r\n        }\r\n        let {r} = ret;\r\n        if (r !== undefined) return r;\r\n\r\n        this.renewUser(user, isAdmin, roleBins, assigned);\r\n    }\r\n\r\n    async setAppRole(user:User, roleNum:number, on:boolean):Promise<string> {\r\n        let {id, isAdmin, assigned} = user;\r\n        if (on === true) {\r\n            user.roleBins |= 1<<roleNum;\r\n        }\r\n        else {\r\n            user.roleBins &= ~(1<<roleNum);\r\n        }\r\n        let roleBins = user.roleBins;\r\n        let ret = await mainApi.setAppRoles(\r\n            this.unit.id, this.appXAccount.id, \r\n            id, undefined, roleBins);\r\n        if (ret === undefined) return 'unauthorized';\r\n        let {r} = ret;\r\n        if (r !== undefined) return r;\r\n        this.renewUser(user, isAdmin, roleBins, assigned);\r\n    }\r\n\r\n    private renewUser(user:User, isAdmin:boolean, roleBins:number, assigned:string) {\r\n        let {id} = user;\r\n        let index = this.users.findIndex(v => v.id === id);\r\n        this.users[index] = {id, isAdmin, roleBins, assigned};\r\n    }\r\n\r\n    delUser = async (user:User):Promise<string> => {\r\n        let ret = await mainApi.setAppRoles(this.unit.id, this.appXAccount.id, user.id, undefined, 0);\r\n        if (ret === undefined) return 'unauthorized';\r\n        let {id, r} = ret;\r\n        if (r !== undefined) return r;\r\n        let index = this.users.findIndex(v => v.id === id);\r\n        this.users.splice(index, 1);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { CDevelopers } from \"./CDevelopers\";\r\nimport { Page, VPage, List, LMR, Image, FA } from \"tonva\";\r\nimport { UserUqsBuses } from 'store/adminDevs';\r\nimport { observer } from 'mobx-react';\r\nimport { caches } from 'store';\r\n\r\nexport class VDevelopers extends VPage<CDevelopers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderUserUqsBuses = (user:number, index: number) => {\r\n        let userUqsBuses: UserUqsBuses = this.controller.adminDevs.getUserUqsBuses(user);\r\n        let {uqs, buses} = userUqsBuses;\r\n        let userObj = caches.users.get(user);\r\n        let content:any;\r\n        if (userObj !== null) {\r\n            let {name, nick, icon} = userObj;\r\n            content = <LMR className=\"w-100\"\r\n                left={<Image className=\"w-3c h-3c mr-4\" src={icon} />}\r\n                right={<div className=\"text-right\">uq: {uqs.length}<br/>bus: {buses.length}</div>}>\r\n                <div>{nick? <><b>{nick}</b><br/><small className=\"text-muted\">{name}</small></> : <><b>{name}</b></>}</div>\r\n            </LMR>\r\n        }\r\n        return <div className=\"px-3 py-2\">{content}</div>;\r\n    }\r\n\r\n    private onClickUserUqsBuses = (user: number) => {\r\n        this.controller.showUserUqsBuses(user);\r\n    }\r\n\r\n    private onAddUser = () => {\r\n        this.controller.showAddDeveloper();\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {adminDevs} = this.controller;\r\n        let {unit, users} = adminDevs;\r\n        let right = <button className=\"btn btn-sm btn-success align-self-center mr-3\" onClick={this.onAddUser}><FA name=\"plus\" /></button>\r\n        return <Page header={\" - \" + unit.name} right={right}>\r\n            <List className=\"my-3\" items={users}\r\n                item={{render: this.renderUserUqsBuses, onClick: this.onClickUserUqsBuses}} />\r\n        </Page>\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport { CDevelopers } from \"./CDevelopers\";\r\nimport { VPage, Page, List, LMR, FA } from 'tonva';\r\nimport { UserSpan } from 'tools/userSpan';\r\nimport { BusSpan, UqSpan } from 'tools';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VUqsBuses extends VPage<CDevelopers> {\r\n    private user: number;\r\n    async open(user: number) {\r\n        this.user = user;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderUq = (uq: number, index: number) => {\r\n        return <div className=\"px-3 py-2 align-items-center\">\r\n            <FA className=\"text-primary\" size=\"lg\" name=\"database\" fixWidth={true} />\r\n            <div className=\"mx-3\"><UqSpan id={uq} /></div>\r\n        </div>;\r\n    }\r\n\r\n    private onChangeUq = () => {\r\n        this.controller.showUserUqs(this.user);\r\n    }\r\n\r\n    private renderBus = (bus: number, index: number) => {\r\n        return <div className=\"px-3 py-2 align-items-center\">\r\n            <FA className=\"text-primary\" size=\"lg\" name=\"cogs\" fixWidth={true} />\r\n            <div className=\"mx-3\"><BusSpan id={bus} /></div>\r\n        </div>;\r\n    }\r\n\r\n    private onChangeBus = () => {\r\n        this.controller.showUserBuses(this.user);\r\n    }\r\n\r\n    private onDelDev = async () => {\r\n        if (await this.controller.confirm({\r\n            message: '',\r\n            ok: ''\r\n        }) === 'ok') {\r\n            await this.controller.delDev(this.user);\r\n            this.closePage();\r\n        }\r\n    }\r\n    \r\n    private page = observer(() => {\r\n        let {user, uqs, buses} = this.controller.adminDevs.getUserUqsBuses(this.user);\r\n        let btnUqAdd = <button className=\"btn btn-success btn-sm\" onClick={this.onChangeUq}><FA name=\"pencil\" /></button>;\r\n        let uqHeader = <LMR className=\"px-3 pb-1 align-items-end\" right={btnUqAdd}>UQ</LMR>;\r\n        let btnBusAdd = <button className=\"btn btn-success btn-sm\" onClick={this.onChangeBus}><FA name=\"pencil\" /></button>;\r\n        let busHeader = <LMR className=\"px-3 pb-1 align-items-end\" right={btnBusAdd}>BUS</LMR>;\r\n        let right = <button className=\"btn btn-outline-info btn-sm align-self-center mr-3\" onClick={this.onDelDev}><FA name=\"minus\" /></button>;\r\n\r\n        return <Page header=\" - UQ BUS\" right={right}>\r\n            <div className=\"px-3 py-2\"><UserSpan id={user} /></div>\r\n            <div className=\"h-1c\" />\r\n            \r\n            {uqHeader}\r\n            <List className=\"mb-3\" items={uqs}\r\n                item={{render: this.renderUq, onClick: undefined/*this.onClickUq*/}} />\r\n            <div className=\"h-1c\" />\r\n            {busHeader}\r\n            <List className=\"mb-3\" items={buses}\r\n                item={{render: this.renderBus, onClick: undefined/*this.onClickBus*/}} />\r\n        </Page>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport { CDevelopers } from \"./CDevelopers\";\r\nimport { VPage, Page, List, FA } from 'tonva';\r\nimport { UserSpan } from 'tools/userSpan';\r\nimport { UqSpan } from 'tools';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VUqs extends VPage<CDevelopers> {\r\n    private user: number;\r\n    async open(user: number) {\r\n        this.user = user;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onCheckChanged = async (evt:React.ChangeEvent<HTMLInputElement>, dev:number) => {\r\n        await this.controller.changeUserDev(evt.target.checked, 'uq', this.user, dev);\r\n    }\r\n\r\n    private renderUqItem = (item:{dev: number, selected:boolean}, index: number) => {\r\n        let {dev, selected} = item;\r\n        return <label className=\"ml-0 px-3 py-2 align-items-center\">\r\n            <input className=\"mr-4\" type=\"checkbox\" defaultChecked={selected} \r\n                onChange={async evt => await this.onCheckChanged(evt, dev)} />\r\n            <FA className=\"text-primary\" size=\"lg\" name=\"database\" fixWidth={true} />\r\n            <div className=\"mx-3\"><UqSpan id={dev} /></div>\r\n        </label>;\r\n    }\r\n\r\n    private onClickUq = (uq: number) => {\r\n    }\r\n    \r\n    private page = observer(() => {\r\n        let {adminDevs} = this.controller;\r\n        let {uqDevs} = adminDevs;\r\n        let {user, uqs} = adminDevs.getUserUqsBuses(this.user);\r\n        let uqItems:{dev:number, selected:boolean}[] = uqDevs.map(uq => {\r\n            return {\r\n                dev: uq,\r\n                selected: uqs.findIndex(v => v===uq) >= 0\r\n            }\r\n        });\r\n        return <Page header=\" - UQ\">\r\n            <div className=\"px-3 py-2\"><UserSpan id={user} /></div>\r\n            <div className=\"h-1c\" />\r\n            \r\n            <List className=\"mb-3\" items={uqItems}\r\n                item={{render: this.renderUqItem, onClick: this.onClickUq}} />\r\n            <div className=\"h-1c\" />\r\n        </Page>;\r\n    });\r\n}","import * as React from 'react';\r\nimport { CDevelopers } from \"./CDevelopers\";\r\nimport { VPage, Page, List, FA } from 'tonva';\r\nimport { UserSpan } from 'tools/userSpan';\r\nimport { BusSpan } from 'tools';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VBuses extends VPage<CDevelopers> {\r\n    private user: number;\r\n    async open(user: number) {\r\n        this.user = user;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onCheckChanged = async (evt:React.ChangeEvent<HTMLInputElement>, dev:number) => {\r\n        await this.controller.changeUserDev(evt.target.checked, 'bus', this.user, dev);\r\n    }\r\n\r\n    private renderBusItem = (item:{dev: number, selected:boolean}, index: number) => {\r\n        let {dev, selected} = item;\r\n        return <label className=\"ml-0 px-3 py-2 align-items-center\">\r\n            <input className=\"mr-4\" type=\"checkbox\" defaultChecked={selected} \r\n                onChange={async evt => await this.onCheckChanged(evt, dev)} />\r\n            <FA className=\"text-primary\" size=\"lg\" name=\"database\" fixWidth={true} />\r\n            <div className=\"mx-3\"><BusSpan id={dev} /></div>\r\n        </label>;\r\n    }\r\n\r\n    private onClickBusItem = (bus: number) => {\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {adminDevs} = this.controller;\r\n        let {buses} = adminDevs;\r\n        let {user, buses:userBuses} = adminDevs.getUserUqsBuses(this.user);\r\n        let items:{dev:number, selected:boolean}[] = buses.map(dev => {\r\n            return {\r\n                dev: dev,\r\n                selected: userBuses.findIndex(v => v===dev) >= 0\r\n            }\r\n        });\r\n        return <Page header=\" - UQ\">\r\n            <div className=\"px-3 py-2\"><UserSpan id={user} /></div>\r\n            <div className=\"h-1c\" />\r\n            \r\n            <List className=\"mb-3\" items={items}\r\n                item={{render: this.renderBusItem, onClick: this.onClickBusItem}} />\r\n            <div className=\"h-1c\" />\r\n        </Page>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport { CDevelopers } from \"./CDevelopers\";\r\nimport { VPage, Page, Form, ItemSchema, StringSchema, UiSchema, \r\n    ButtonSchema, UiTextItem, UiButton, Context } from 'tonva';\r\n\r\nexport class VAddDeveloper extends VPage<CDevelopers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onSubmitClick = async (name:string, context:Context) => {\r\n        let ret = await this.controller.addDev(context.data.user);\r\n        let {r} = ret;\r\n        if (r === 'success') {\r\n            this.closePage();\r\n            return;\r\n        }\r\n        let error: string;\r\n        switch (r) {\r\n            case 'is-root': error = ''; break;\r\n            case 'is-owner': error = ''; break;\r\n            case 'is-admin': error = ''; break;\r\n            case 'is-dev': error = ''; break;\r\n        }\r\n        context.setError('user', error);\r\n    }\r\n\r\n    private page = () => {\r\n        let schema: ItemSchema[] = [\r\n            {name: 'user', type: 'string', maxLength: 50, required: true} as StringSchema,\r\n            {name: 'submit', type: 'submit' } as ButtonSchema,\r\n        ];\r\n        let uiSchema: UiSchema = {\r\n            items: {\r\n                user: {widget: 'text', label: '', placeholder: ''} as UiTextItem,\r\n                submit: {widget: 'button', label: '', className:'btn btn-success'} as UiButton\r\n            }\r\n        };\r\n        return <Page header=\"\">\r\n            <Form className=\"m-5\" schema={schema} uiSchema={uiSchema} \r\n                onEnter={this.onSubmitClick}\r\n                onButtonClick={this.onSubmitClick} />\r\n        </Page>;\r\n    }\r\n}","import { CUqBase } from \"UqApp\";\r\nimport { VDevelopers } from \"./VDevelopers\";\r\nimport { AdminDevs } from \"store/adminDevs\";\r\nimport { VUqsBuses } from \"./VUqsBuses\";\r\nimport { VUqs } from \"./VUqs\";\r\nimport { VBuses } from \"./VBuses\";\r\nimport { devApi, mainApi } from \"api\";\r\nimport { VAddDeveloper } from \"./VAddDeveloper\";\r\n\r\nexport class CDevelopers extends CUqBase {\r\n    adminDevs: AdminDevs;\r\n\r\n    protected async internalStart(adminDevs: AdminDevs) {\r\n        this.adminDevs = adminDevs;\r\n        this.openVPage(VDevelopers);\r\n    }\r\n\r\n    showUserUqsBuses(user: number) {\r\n        this.openVPage(VUqsBuses, user);\r\n    }\r\n\r\n    showUserUqs(user: number) {\r\n        this.openVPage(VUqs, user);\r\n    }\r\n    \r\n    showUserBuses(user: number) {\r\n        this.openVPage(VBuses, user);\r\n    }\r\n\r\n    async changeUserDev(isSelected:boolean, type:'uq'|'bus', user:number, dev:number) {\r\n        if (isSelected === true) {\r\n            await devApi.adminDevAdd({unit: this.adminDevs.unit.id, type: type, dev: dev, devUser: user});\r\n            this.adminDevs.devs.push({\r\n                type: type,\r\n                user: user,\r\n                dev: dev\r\n            });\r\n        }\r\n        else {\r\n            await devApi.adminDevDel({unit: this.adminDevs.unit.id, type: type, dev: dev, devUser: user});\r\n            let index = this.adminDevs.devs.findIndex(v => v.dev===dev && v.type===type && v.user===user);\r\n            if (index >= 0) this.adminDevs.devs.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    showAddDeveloper() {\r\n        this.openVPage(VAddDeveloper);\r\n    }\r\n\r\n    async addDev(dev:string): Promise<any> {\r\n        let {users, unit} = this.adminDevs;\r\n        let ret = await mainApi.addDev(unit.id, dev);\r\n        if (ret === undefined) {\r\n            throw new Error('unauthorized!');\r\n        }\r\n        let {r, id} = ret;\r\n        if (r === 'success') {\r\n            users.push(id);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    async delDev(user: number): Promise<void> {\r\n        let {users, unit} = this.adminDevs;\r\n        await mainApi.delDev(unit.id, user);\r\n        let index = users.findIndex(v => v === user);\r\n        if (index >= 0) users.splice(index, 1);\r\n    }\r\n}\r\n","import { observable } from \"mobx\";\r\nimport { mainApi } from \"api\";\r\nimport { Unit } from \"model\";\r\n\r\nexport interface AdminDev {\r\n    type: string;\r\n    dev: number;\r\n    user: number;\r\n}\r\n\r\nexport interface UserUqsBuses {\r\n    user: number;\r\n    uqs: number[];\r\n    buses: number[];\r\n}\r\n\r\nexport interface UqUsers {\r\n    uq: number;\r\n    users: number[];\r\n}\r\n\r\nexport interface BusUsers {\r\n    bus: number;\r\n    users: number[];\r\n}\r\n\r\nexport class AdminDevs {\r\n    private loaded:boolean = false;\r\n    unit: Unit;\r\n    @observable users: number[];\r\n    @observable uqDevs: number[];\r\n    @observable buses: number[];\r\n    @observable devs: AdminDev[];\r\n\r\n    constructor(unit: Unit) {\r\n        this.unit = unit;\r\n    }\r\n\r\n    async load() {\r\n        if (this.loaded === true) return;\r\n        let ret = await mainApi.adminDevs(this.unit.id);\r\n        this.loaded = true;\r\n        this.users = ret[0].map(v => v.user);\r\n        this.devs = ret[1];\r\n        this.uqDevs = ret[2].map(v => v.id);\r\n        this.buses = ret[3].map(v => v.id);\r\n    }\r\n\r\n    getUserUqsBuses(user: number):UserUqsBuses {\r\n        //let ret:UserUqsBuses[] = [];\r\n        //for (let user of this.users) {\r\n            let uqs: number[] = [];\r\n            let buses: number[] = [];\r\n            let ret = {\r\n                user: user,\r\n                uqs: uqs,\r\n                buses: buses\r\n            };\r\n            for (let dev of this.devs) {\r\n                if (dev.user === user) {\r\n                    switch (dev.type) {\r\n                        case 'uq': uqs.push(dev.dev); break;\r\n                        case 'bus': buses.push(dev.dev); break;\r\n                    }\r\n                }\r\n            }\r\n        //}\r\n        return ret;\r\n    }\r\n\r\n    getUqUsers(): UqUsers[] {\r\n        let ret:UqUsers[] = [];\r\n        for (let uq of this.uqDevs) {\r\n            let users: number[] = [];\r\n            ret.push({\r\n                uq: uq,\r\n                users: users,\r\n            });\r\n            for (let dev of this.devs) {\r\n                if (dev.type === 'uq' && dev.dev === uq) {\r\n                    users.push(dev.user);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    getBusUsers(): BusUsers[] {\r\n        let ret:BusUsers[] = [];\r\n        for (let bus of this.buses) {\r\n            let users: number[] = [];\r\n            ret.push({\r\n                bus: bus,\r\n                users: users,\r\n            });\r\n            for (let dev of this.devs) {\r\n                if (dev.type === 'bus' && dev.dev === bus) {\r\n                    users.push(dev.user);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {Page, ItemSchema, UiCheckItem, UiButton, ButtonSchema, Form, Context, Image, VPage} from 'tonva';\r\nimport { UnitAdmin } from '../model/index';\r\nimport { CAdmins } from './CAdmins';\r\n\r\nexport class VEditAdmin extends VPage<CAdmins> {\r\n    async open() {\r\n        this.openPage(this.page);        \r\n    }\r\n\r\n    private onSubmit = async (name:string, context:Context) => {\r\n        let {isOwner, isAdmin} = context.form.data;\r\n        await this.controller.setAdmin(isOwner, isAdmin);\r\n        this.closePage();\r\n    }\r\n    private page = observer(() =>{\r\n        let {unit, admins} = this.controller;\r\n        let {isRoot, isOwner} = unit;\r\n        let unitAdmin = admins.cur;\r\n        let owner:ItemSchema = {name: 'isOwner', type: 'boolean'};\r\n        let admin:ItemSchema = {name: 'isAdmin', type: 'boolean'};\r\n        let submit:ButtonSchema = {name: 'submit', type: 'submit'};\r\n        let schema:ItemSchema[];\r\n        if (isRoot === 1) schema = [owner, admin, submit];\r\n        else if (isOwner === 1) schema = [admin, submit];\r\n        let data = {\r\n            isOwner: unitAdmin.isOwner,\r\n            isAdmin: unitAdmin.isAdmin,\r\n        };\r\n\r\n        let uiSchema = {\r\n            items: {\r\n                'isOwner': {widget: 'checkbox', label: '', trueValue:1, falseValue:0} as UiCheckItem,\r\n                'isAdmin': {widget: 'checkbox', label: '', trueValue:1, falseValue:0} as UiCheckItem,\r\n                'submit': {widget: 'button', label: '', className: 'btn btn-primary'} as UiButton,\r\n            }\r\n        };\r\n\r\n        return <Page header=''>\r\n            <div className=\"px-3\">\r\n                <Fellow {...admins.cur} />\r\n                <Form schema={schema} uiSchema={uiSchema} formData={data} onButtonClick={this.onSubmit} />\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n\r\nconst Fellow = (props:UnitAdmin) => {\r\n    let {name, nick, icon} = props;\r\n    //<img className='w-75' src={icon || process.env.REACT_APP_DEFAULT_ICON} />\r\n    return <div>\r\n        <div className='d-flex my-4'>\r\n            <Image className=\"w-3c h-3c mr-3\" src={icon} />\r\n            <div className=\"\">\r\n                <h4 className='text-dark'>{name}</h4>\r\n                {nick && <h6><small className='text-secondary'>{nick}</small></h6>}\r\n            </div>\r\n        </div>\r\n        <hr className='mb-4' />\r\n    </div>;\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, Form, Schema, StringSchema, ButtonSchema, UiSchema, UiButton, UiTextItem, Context } from \"tonva\";\r\nimport { CAdmins } from './CAdmins';\r\nimport { unitCaption } from 'model';\r\n\r\nexport class VAddAdmin extends VPage<CAdmins> {\r\n    private roleNum:number;\r\n    private schema:Schema = [\r\n        {name: 'user', type: 'string', required: true} as StringSchema,\r\n        {name: 'submit', type: 'submit'} as ButtonSchema,\r\n    ];\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            'user': {widget: 'text', label: '', placeholder: ''} as UiTextItem,\r\n            'submit': {widget: 'button', label: '', className: 'btn btn-primary'} as UiButton,\r\n        }\r\n    }\r\n    async open(roleNum:number) {\r\n        this.roleNum = roleNum;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onSubmit = async (name:string, context:Context) => {\r\n        let ret = await this.controller.addAdmin(context.data.user);\r\n        if (ret === undefined) {\r\n            this.closePage();\r\n            return;\r\n        }\r\n        let err:string;\r\n        switch (ret) {\r\n            default: err = ''; break;\r\n            case 'no-exist': err = ''; break;\r\n            case 'me': err = ''; break;\r\n            case 'admin': err = ''; break;\r\n        }\r\n        context.setError('user', err);\r\n    }\r\n\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'user') {\r\n            await this.onSubmit('login', context);\r\n            return;\r\n        }\r\n    }\r\n\r\n    private page = () => {\r\n        //let roleCaption = this.controller.getRoleCaption(this.roleNum);\r\n        return <Page header={' - ' + unitCaption(this.controller.unit) + ''} back=\"close\">\r\n            <div className=\"m-5 px-5 py-3 bg-white border rounded\">\r\n                <Form schema={this.schema} uiSchema={this.uiSchema}\r\n                    onEnter={this.onEnter}\r\n                    onButtonClick={this.onSubmit}/>\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { CAdmins } from \"./CAdmins\";\r\nimport { VPage, List, Page, Image, LMR, FA } from \"tonva\";\r\nimport { UnitAdmin } from 'model';\r\nimport { VEditAdmin } from './VEditAdmin';\r\nimport { VAddAdmin } from './VAddAdmin';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\n\r\nexport class VAdmins extends VPage<CAdmins> {\r\n    private list: List;\r\n    @observable allSelectVisible: boolean = true;\r\n    @observable allUnSelectVisible: boolean = false;\r\n    @observable disableDel: boolean = true;\r\n\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onNewFellow = () => {\r\n        //nav.push(<NewFellow />);\r\n    }\r\n    private onItemClick = (ua:UnitAdmin) => {\r\n        //store.admins.cur = ua;\r\n        this.controller.admins.cur = ua;\r\n        this.openVPage(VEditAdmin);\r\n        //nav.push(<EditAdmin />);\r\n    }\r\n    private onItemSelect = (ua:UnitAdmin, isSelected:boolean, anySelected:boolean) => {\r\n        this.disableDel = !anySelected;\r\n    }\r\n\r\n    private onSelectAll = () => {\r\n        this.list.selectAll();\r\n    }\r\n\r\n    private onClearAll = () => {\r\n        this.list.unselectAll();\r\n    }\r\n\r\n    private onDel = async () => {\r\n        await this.controller.delAdmins(this.list.selectedItems);\r\n    }\r\n\r\n    private row = ({icon, name, nick}:UnitAdmin) => {\r\n        let content = nick?\r\n            <><b>{nick}</b> &nbsp; <small className=\"text-muted\">{name}</small></>\r\n            :\r\n            <b>{name}</b>;\r\n        let left = <Image className=\"w-2-5c h-2-5c\" src={icon} />; \r\n        return <LMR className=\"py-2 px-3 align-items-stretch\" left={left}>\r\n            <div className=\"px-3\">{content}</div>\r\n        </LMR>;\r\n    }\r\n\r\n    onAddAdmin = () => {\r\n        this.openVPage(VAddAdmin);\r\n    } \r\n\r\n    private page = observer(() => {\r\n        let {admins} = this.controller;\r\n        let right = <button \r\n            className=\"btn btn-sm btn-success mr-2 align-self-center\"\r\n            onClick={this.onAddAdmin}><FA name=\"plus\" /></button>;\r\n        /*\r\n        let showOwners = false, showAdmins = false;\r\n        let ownersView:any, adminsView:any;\r\n        if (unit.isRoot === 1) {\r\n            showOwners = true;\r\n            showAdmins = true;\r\n        }\r\n        if (unit.isOwner === 1) showAdmins = true;\r\n        if (showOwners === true) {\r\n            let header = <LMR \r\n                className=\"px-3 py-1 small\"\r\n                left=\"\" \r\n                right={<a href='/' onClick={this.onNewOwner}></a>} />;\r\n            ownersView = <List \r\n                className=\"my-4\"\r\n                header={header} items={owners}\r\n                none=\"[]\"\r\n                item={{onClick: this.onItemClick, render: this.row}}\r\n            />;\r\n        }\r\n        if (showAdmins === true) {\r\n            let header = <LMR \r\n                className=\"px-3 py-1 small\"\r\n                left=\"\" \r\n                right={<a href='/' onClick={this.onNewAdmin}></a>} />;\r\n            adminsView = <List \r\n                className='my-4' \r\n                header={header} items={admins} \r\n                none='[]'\r\n                item={{onClick: this.onItemClick, render: this.row}}\r\n            />;\r\n        }\r\n        */\r\n        let adminsView = <List ref={(list) => this.list = list}\r\n            className=\"my-1\" items={admins.admins} \r\n            none='[]'\r\n            item={{render: this.row, onSelect: this.onItemSelect}}\r\n            />;\r\n        let cnBtn = 'btn btn-sm btn-outline-info mr-1';\r\n        let buttons = admins.admins.length > 0 && <div className=\"pl-3\">\r\n            <button className={cnBtn} onClick={this.onSelectAll}></button>\r\n            <button className={cnBtn} onClick={this.onClearAll}></button>\r\n            <button className={cnBtn} disabled={this.disableDel} onClick={this.onDel}></button>\r\n        </div>;\r\n\r\n        return <Page header=\"\" right={right}>\r\n            <div className='my-3'>\r\n                {buttons}\r\n                {adminsView}\r\n                {buttons}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import { CUqBase } from \"UqApp\";\r\nimport { Unit, UnitAdmin } from \"model\";\r\nimport { Admins } from \"store/admins\";\r\nimport { VAdmins } from \"./VAdmins\";\r\n\r\nexport class CAdmins extends CUqBase {\r\n    unit: Unit;\r\n    admins: Admins;\r\n    protected async internalStart(unit: Unit) {\r\n        this.unit = unit;\r\n        this.admins = new Admins(unit);\r\n        await this.admins.load();\r\n\r\n        this.openVPage(VAdmins);\r\n    }\r\n\r\n    setAdmin = async (isOwner:number, isAdmin:number) => {\r\n        await this.admins.unitSetAdmin(isOwner, isAdmin, 0);\r\n    }\r\n\r\n    addAdmin = async (user:string):Promise<string> => {\r\n        let ret = await this.admins.unitAddAdmin(user, 0, 1, 0);\r\n        if (typeof ret === 'object') return;\r\n        return ret;\r\n    }\r\n\r\n    delAdmins = async (unitAdmins: UnitAdmin[]) => {\r\n        if (await this.confirm({\r\n            caption: '',\r\n            message: '' + unitAdmins.map(v => v.name).join(','),\r\n            ok: ''\r\n        }) === 'ok') {\r\n            let promises:Promise<any>[] = unitAdmins.map(v => this.admins.unitDelAdmin(v));\r\n            await Promise.all(promises);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page } from 'tonva';\r\nimport { List, SearchBox, LMR, FA } from 'tonva';\r\nimport { CUsers, AppUsers } from './CUsers';\r\n\r\nexport class VApps extends VPage<CUsers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderRow = (appUsers: AppUsers, index:number):JSX.Element => {\r\n        let {app, more, users} = appUsers;\r\n        let {name, discription} = app;\r\n        let right = <small className=\"text-muted\">{discription}</small>;\r\n        return <div className=\"d-block px-3 py-2\">\r\n            <LMR className=\"mb-2\" right={right}>\r\n                <FA name=\"address-card-o\" className=\"text-primary mr-3\" />\r\n                <b>{name}</b>\r\n            </LMR>\r\n            <div>\r\n                <small className=\"text-muted\">: </small>\r\n                {users.length===0?\r\n                    '[]':\r\n                    users.map(u => u.assigned || u.nick || u.name).join(', ') + (more===true? ' ...' : '')}\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {appUsersList, searchApp, onAppsClick} = this.controller;\r\n        let searchBox = <SearchBox className=\"w-100 pr-1\" \r\n            onSearch={searchApp} \r\n            placeholder=\"App\" \r\n            allowEmptySearch={true} />;\r\n        return <Page header={searchBox}>\r\n            <List items={appUsersList} \r\n                item={{render: this.renderRow, onClick:onAppsClick,  key: (item=>item.app.id)}} />\r\n        </Page>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page, LMR } from 'tonva';\r\nimport { List, SearchBox, FA } from 'tonva';\r\nimport { CUsers, UserApps } from './CUsers';\r\n\r\nexport class VUsers extends VPage<CUsers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderRow = (userApps: UserApps, index:number):JSX.Element => {\r\n        let {user, apps} = userApps;\r\n        let {name, nick, assigned} = user;\r\n        let left = <FA name=\"user-o\" size=\"lg\" className=\"text-info mx-3 mt-2\" fixWidth={true} />;\r\n        return <LMR className=\"py-2\" left={left}>\r\n            <div className=\"mb-2\">                \r\n                <b>{assigned || nick || name}</b>\r\n            </div>\r\n            <div className=\"d-flex flex-wrap mt-1\">\r\n                {   apps.length===0?\r\n                    <small className=\"text-muted\">[]</small>\r\n                    :\r\n                    apps.map(a => this.box(a.name, 'px-2 text-info border-muted bg-white'))\r\n                }\r\n            </div>\r\n        </LMR>;\r\n    }\r\n\r\n    private box = (text:string, cn:string) => {\r\n        return <div className={'mr-3 mb-1 py-1 small border rounded ' + cn} key={text}>{text}</div>;\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {userAppsList, searchUser, onUsersClick} = this.controller;\r\n        let searchBox = <SearchBox className=\"w-100 pr-1\" label=\"App &nbsp; \"\r\n            onSearch={searchUser} \r\n            placeholder=\"\" \r\n            allowEmptySearch={true} />;\r\n        return <Page header={searchBox}>\r\n            <List items={userAppsList} \r\n                item={{render: this.renderRow, onClick:onUsersClick, key: (item=>item.user.id)}} />\r\n        </Page>;\r\n    });\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page } from 'tonva';\r\nimport { List } from 'tonva';\r\nimport { CUsers, User } from './CUsers';\r\n\r\nexport class VApp extends VPage<CUsers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {curApp, curAppUsers, onAppEditUsers} = this.controller;\r\n        let right = <button className=\"btn btn-sm btn-success\" onClick={()=>onAppEditUsers()}></button>;\r\n        return <Page header={'App - ' + (curApp.name)} right={right}>\r\n            <List items={curAppUsers} item={{render:this.renderApp}} />\r\n        </Page>\r\n    })\r\n\r\n    private renderApp = (user: User, index:number):JSX.Element => {\r\n        let {name, nick, assigned} = user;\r\n        let content:any;\r\n        if (assigned)\r\n            content = <span>{assigned} &nbsp; <small className=\"text-muted\">{name}</small></span>;\r\n        else if (nick)\r\n            content = <span>{nick} &nbsp; <small className=\"text-muted\">{name}</small></span>;\r\n        else\r\n            content = <>{name}</>\r\n        return <div className=\"px-3 py-2\">{content}</div>\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page, LMR, FA } from 'tonva';\r\nimport { List } from 'tonva';\r\nimport { CUsers, App } from './CUsers';\r\n\r\nexport class VUser extends VPage<CUsers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {curUser, curUserApps, onUserEditApps} = this.controller;\r\n        let right = <button className=\"btn btn-sm btn-success align-self-center mr-2\" onClick={()=>onUserEditApps()}>App</button>;\r\n        return <Page header={' - ' + (curUser.assigned || curUser.nick || curUser.name)}\r\n            right={right}>\r\n            <List items={curUserApps} item={{render:this.renderApp}} />\r\n        </Page>\r\n    })\r\n\r\n    private renderApp = (app: App, index:number):JSX.Element => {\r\n        let {name, discription} = app;\r\n        let left = <FA name=\"caret-square-o-right\" size=\"lg\" className=\"mr-3 mt-1 text-info\" />;\r\n        let right = <small className=\"text-muted\">{discription}</small>\r\n        return <LMR className=\"px-3 py-2\" left={left} right={right}><b>{name}</b></LMR>\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page } from 'tonva';\r\nimport { List, LMR, Muted } from 'tonva';\r\nimport { CUsers, EditUser } from './CUsers';\r\n\r\nexport class VAppEditUsers extends VPage<CUsers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {curApp, appEditUsers} = this.controller;\r\n        return <Page header={curApp.name + ' - '} >\r\n            <List items={appEditUsers} item={{render:this.renderUserItem}} />\r\n        </Page>\r\n    })\r\n\r\n    private renderUserItem = (editUser: EditUser, index:number):JSX.Element => {\r\n        let {name, nick, assigned, bind} = editUser;\r\n        let content:any;\r\n        if (assigned)\r\n            content = <>{assigned} <Muted>{name}</Muted></>;\r\n        else if (nick)\r\n            content = <>{nick} <Muted>{name}</Muted></>;\r\n        else\r\n            content = <>{name}</>\r\n        let right = <input type=\"checkbox\" defaultChecked={bind===1} \r\n            onChange={(evt)=>this.onUserChanged(editUser, evt.target.checked)} />;\r\n        return <LMR className=\"px-3 py-2 align-items-center\" right={right}>\r\n            {content}\r\n        </LMR>\r\n    }\r\n\r\n    private onUserChanged = async (editUser: EditUser, checked:boolean) => {\r\n        await this.controller.bindAppUser(editUser, checked);\r\n        editUser.bind = checked===true? 1: 0;\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page } from 'tonva';\r\nimport { List, LMR } from 'tonva';\r\nimport { CUsers, EditApp } from './CUsers';\r\n\r\nexport class VUserEditApps extends VPage<CUsers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {curUser, userEditApps} = this.controller;\r\n        return <Page header={'App - ' + (curUser.assigned || curUser.nick || curUser.name)}>\r\n            <List items={userEditApps} item={{render:this.renderApp}} />\r\n        </Page>\r\n    })\r\n\r\n    private renderApp = (editApp: EditApp, index:number):JSX.Element => {\r\n        let {name, discription, bind} = editApp;\r\n        let right = <input type=\"checkbox\" defaultChecked={bind===1} \r\n            onChange={(evt)=>this.onAppChanged(editApp, evt.target.checked)} />;\r\n        return <LMR className=\"px-3 py-2\" right={right}>\r\n            {name} {discription}\r\n        </LMR>\r\n    }\r\n\r\n    private onAppChanged = async (editApp: EditApp, checked:boolean) => {\r\n        await this.controller.bindUserApp(editApp, checked);\r\n        editApp.bind = checked===true? 1: 0;\r\n    }\r\n}","import * as React from 'react';\r\nimport { VPage, Page, Image } from 'tonva';\r\nimport { CUsers, User } from './CUsers';\r\nimport { SearchBox } from 'tonva';\r\nimport { mainApi } from 'api';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VAddUser extends VPage<CUsers> {\r\n    @observable private user: User = null;\r\n    //@observable private addedUser: User;\r\n    private searchBox: SearchBox;\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(():JSX.Element => {\r\n        let searchBox = <SearchBox ref={v=>this.searchBox=v}\r\n            className=\"w-100\"\r\n            onSearch={this.onSearch}\r\n            onFocus={this.onSearchFocus}\r\n            placeholder=\"//\"\r\n             />;\r\n        let content:any;\r\n        if (this.user === null) {\r\n        }\r\n        else if (this.user === undefined) {\r\n            content = <div className=\"text-info p-3\"></div>;\r\n        }\r\n        else {\r\n            let {name, nick, icon} = this.user;\r\n            let divUser:any;\r\n            if (nick) {\r\n                divUser = <><div><b>{nick}</b></div><div>{name}</div></>;\r\n            }\r\n            else {\r\n                divUser = <div><b>{name}</b></div>;\r\n            }\r\n            content = <div>\r\n                <div className=\"m-3 p-3 d-flex bg-white\">\r\n                    <Image src={icon} />\r\n                    <div className=\"ml-3\">{divUser}</div>\r\n                </div>\r\n                <div className=\"d-flex justify-content-center\">\r\n                    <button className=\"btn btn-success text-center\" onClick={this.onAddUser}></button>\r\n                </div>\r\n            </div>;\r\n        }\r\n        /*\r\n        let divUserAdded:any;\r\n        if (this.addedUser) {\r\n            divUserAdded = <div className=\"p-3\">\r\n                <div>\r\n                    : {this.addedUser.name} &nbsp; &nbsp; \r\n                    <button className=\"btn btn-success\" \r\n                        onClick={()=>this.controller.onUserEditApps()}>\r\n                        App\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        }\r\n        */\r\n        return <Page header={searchBox}>\r\n            {content}\r\n        </Page>;\r\n    })\r\n    //{divUserAdded}\r\n\r\n    private onSearch = async (key:string) => {\r\n        this.user = await mainApi.userFromKey(key);\r\n    }\r\n\r\n    private onAddUser = async () => {\r\n        await this.controller.addUser(this.user.id);\r\n        this.controller.curUser = this.user;\r\n        this.user = null;\r\n        this.searchBox.clear();\r\n        this.replacePage(this.addedPage);\r\n    }\r\n\r\n    private onSearchFocus = () => {\r\n        this.user = null;\r\n        //this.addedUser = null;\r\n        if (this.searchBox) this.searchBox.clear();\r\n    }\r\n\r\n    private onAddApps = () => {\r\n        this.closePage();\r\n        this.controller.onUserEditApps();\r\n    }\r\n\r\n    private onContinueAddUser = () => {\r\n        this.closePage();\r\n        this.controller.onAddUser();\r\n    }\r\n\r\n    private addedPage = () => {\r\n        return <Page header=\"\">\r\n            <div className=\"p-3 text-center\">\r\n                <div>\r\n                    : {this.controller.curUser.name}\r\n                </div>\r\n                <div className=\"mt-3\">\r\n                    <button className=\"btn btn-success mr-3\" \r\n                        onClick={this.onAddApps}>\r\n                        App\r\n                    </button>\r\n                    <button className=\"btn btn-outline-primary\"\r\n                        onClick={this.onContinueAddUser}>\r\n                        \r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n","import { observable } from 'mobx';\r\nimport { Controller } from 'tonva';\r\nimport { mainApi } from 'api';\r\nimport { VApps } from './VApps';\r\nimport { VUsers } from './VUsers';\r\nimport { VApp } from './VApp';\r\nimport { VUser } from './VUser';\r\nimport { VAppEditUsers } from './VAppEditUsers';\r\nimport { VUserEditApps } from './VUserEditApps';\r\nimport { VAddUser } from './VAddUser';\r\nimport { Unit } from 'model';\r\n\r\nexport interface User {\r\n    id: number;\r\n    name: string;\r\n    nick: string;\r\n    icon: string;\r\n    assigned: string;\r\n}\r\nexport interface App {\r\n    id: number;\r\n    name: string;\r\n    discription: string;\r\n}\r\nexport interface UserApps {\r\n    user: User;\r\n    apps: App[];\r\n}\r\nexport interface AppUsers {\r\n    app: App;\r\n    users: User[];\r\n    more: boolean;\r\n}\r\nexport interface EditApp extends App {\r\n    bind: number;   // 0: not bind, 1: bind\r\n}\r\nexport interface EditUser extends User {\r\n    bind: number;  // 0: not bind, 1: bind\r\n}\r\n\r\nexport class CUsers extends Controller {\r\n    private unit: Unit;\r\n    @observable userAppsList: UserApps[];\r\n    @observable appUsersList: AppUsers[];\r\n    curUser: User;\r\n    @observable curUserApps: App[];\r\n    @observable userEditApps: EditApp[];\r\n    curApp: App;\r\n    @observable curAppUsers: User[];\r\n    @observable appEditUsers: EditUser[];\r\n\r\n    protected async internalStart(unit:Unit) {\r\n        this.unit = unit;\r\n        //await this.loadAppUsers(undefined);\r\n        await this.loadUserApps(undefined);\r\n        //this.openVPage(VApps);\r\n        this.openVPage(VUsers);\r\n    }\r\n\r\n    private onAppUsers = async () => {\r\n        await this.loadAppUsers(undefined);\r\n        this.openVPage(VApps);\r\n    }\r\n\r\n    private onUserApps = async () => {\r\n        await this.loadUserApps(undefined);\r\n        this.openVPage(VUsers);\r\n    }\r\n\r\n    private async loadAppUsers(key:string) {\r\n        let list:AppUsers[] = [];\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        let ret = await mainApi.unitAppUsers(this.unit.id, key, pageStart, pageSize);\r\n\t\tlet apps = ret[0];\r\n        let users = ret[1];\r\n        let coll: {[id:number]:AppUsers} = {}\r\n        for (let a of apps) {\r\n            let app:App = {\r\n                id: a.id,\r\n                name: a.name,\r\n                discription: a.discription,\r\n            };\r\n            list.push(coll[a.id] = {app:app, more:false, users:[]});\r\n        }\r\n        for (let u of users) {\r\n            let user:User = {\r\n                id: u.user,\r\n                name: u.name,\r\n                nick: u.nick,\r\n                icon: u.icon,\r\n                assigned: u.assigned\r\n            }\r\n            let item = coll[u.app];\r\n            let {users} = item;\r\n            if (users.length >= 5) {\r\n                item.more = true;\r\n            }\r\n            else {\r\n                users.push(user);\r\n            }\r\n        }\r\n        this.appUsersList = list;\r\n    }\r\n\r\n    private async loadUserApps(key:string) {\r\n        let list:UserApps[] = [];\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        let ret = await mainApi.unitUsers(this.unit.id, key, pageStart, pageSize);\r\n        let users = ret[0];\r\n        let apps = ret[1];\r\n        let coll: {[id:number]:UserApps} = {}\r\n        for (let u of users) {\r\n            let user:User = {\r\n                id: u.id,\r\n                name: u.name,\r\n                nick: u.nick,\r\n                icon: u.icon,\r\n                assigned: u.assigned\r\n            };\r\n            list.push(coll[u.id] = {user:user, apps:[]});\r\n        }\r\n        for (let a of apps) {\r\n            let app:App = {\r\n                id: a.app,\r\n                name: a.name,\r\n                discription: a.discription,\r\n            }\r\n            coll[a.user].apps.push(app);\r\n        }\r\n        this.userAppsList = list;\r\n    }\r\n\r\n    searchUser = async(key:string) => {\r\n        await this.loadUserApps(key);\r\n    }\r\n\r\n    searchApp = async(key:string) => {\r\n        await this.loadAppUsers(key);\r\n    }\r\n\r\n    onAppsClick = async (appUsers: AppUsers) => {\r\n        this.curApp = appUsers.app;\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        this.curAppUsers = await mainApi.unitOneAppUsers(this.unit.id, this.curApp.id, pageStart, pageSize);\r\n        this.openVPage(VApp);\r\n    }\r\n\r\n    onUsersClick = async (userApps: UserApps) => {\r\n        this.curUser = userApps.user;\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        this.curUserApps = await mainApi.unitOneUserApps(this.unit.id, this.curUser.id, pageStart, pageSize);\r\n        this.openVPage(VUser);\r\n    }\r\n\r\n    onAppEditUsers = async (key?:string) => {\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        this.appEditUsers = await mainApi.unitAppEditUsers(this.unit.id, this.curApp.id, key, pageStart, pageSize);\r\n        this.openVPage(VAppEditUsers);\r\n    }\r\n\r\n    onAddUser = () => {\r\n        this.openVPage(VAddUser);\r\n    }\r\n\r\n    onUserEditApps = async (key?:string) => {\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        this.userEditApps = await mainApi.unitUserEditApps(this.unit.id, this.curUser.id, key, pageStart, pageSize);\r\n        this.openVPage(VUserEditApps);\r\n    }\r\n\r\n    bindAppUser = async(user:User, checked:boolean) => {\r\n        await mainApi.bindAppUser(this.unit.id, this.curApp.id, user.id, checked===true? 1:0);\r\n        let appUsers = this.appUsersList.find(v => v.app.id === this.curApp.id);\r\n        if (checked === true) {\r\n            this.curAppUsers.push(user);\r\n            if (appUsers) appUsers.users.push(user);\r\n        }\r\n        else {\r\n            let index = this.curAppUsers.findIndex(v => v.id === user.id);\r\n            if (index>=0) this.curAppUsers.splice(index, 1);\r\n            if (appUsers) {\r\n                index = appUsers.users.findIndex(v => v.id === user.id);\r\n                if (index>=0) appUsers.users.splice(index, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    bindUserApp = async(app:App, checked:boolean) => {\r\n        await mainApi.bindAppUser(this.unit.id, app.id, this.curUser.id, checked===true? 1:0);\r\n        if (this.userAppsList === undefined) return;\r\n        let userApps = this.userAppsList.find(v => v.user.id === this.curUser.id);\r\n        if (checked === true) {\r\n            this.curUserApps.push(app);\r\n            if (userApps) userApps.apps.push(app);\r\n        }\r\n        else {\r\n            let index = this.curUserApps.findIndex(v => v.id === app.id);\r\n            if (index>=0) this.curUserApps.splice(index, 1);\r\n            if (userApps) {\r\n                index = userApps.apps.findIndex(v => v.id === app.id);\r\n                if (index>=0) userApps.apps.splice(index, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    addUser = async (userId: number) => {\r\n        await mainApi.unitAddUser(this.unit.id, userId);\r\n    }\r\n}\r\n","import { appInFrame } from 'tonva'; \r\nimport { UnitAdmin, Unit, DevApp } from '../model';\r\nimport { store } from '../store';\r\nimport { mainApi } from 'api';\r\nimport { CUqBase } from 'UqApp';\r\nimport { VUnit } from './VUnit';\r\nimport { VHome } from './VHome';\r\nimport { CAppXAccount } from 'XAccount';\r\nimport { CDevelopers } from 'Dev/developers';\r\nimport { AdminDevs } from 'store/adminDevs';\r\nimport { CAdmins } from 'Admins';\r\nimport { CUsers } from 'Users';\r\nimport { AppController, CUq } from 'Dev';\r\n\r\nexport class CHome extends CUqBase {\r\n    unit: Unit;\r\n    isProduction: boolean;\r\n    unitAdmins: UnitAdmin[]; // Adminsunits\r\n    accUnits: UnitAdmin[];\r\n    devUnits: UnitAdmin[];\r\n    bothUnits: UnitAdmin[];\r\n\tadminDevs: AdminDevs;\r\n\tcAdmins: CAdmins;\r\n\tcUsers: CUsers;\r\n\r\n    private async loadAdminUnits(): Promise<void> {\r\n        let ret = await mainApi.userUnitAdmins();\r\n        let unitAdmins = this.unitAdmins = ret[0];\r\n        if (unitAdmins.length === 1) {\r\n            appInFrame.unit = unitAdmins[0].id;\r\n            await store.loadUnit();\r\n        }\r\n        else {\r\n            this.accUnits = [];\r\n            this.devUnits = [];\r\n            this.bothUnits = [];\r\n            for (let ua of unitAdmins) {\r\n                let {type} = ua;\r\n                if ((type & 3) === 3) {\r\n                    this.bothUnits.push(ua);\r\n                }\r\n                else if ((type & 1) === 1) {\r\n                    this.devUnits.push(ua);\r\n                }\r\n                else if ((type & 2) === 2) {\r\n                    this.accUnits.push(ua);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    protected async internalStart(param?:any):Promise<void> {\r\n\t\tthis.cAdmins = this.newC(CAdmins);\r\n\t\tthis.cUsers = new CUsers(this.res);\r\n        store.init();\r\n        \r\n        this.isProduction = document.location.hash.startsWith('#tv');\r\n        console.log('admins isProduction %s', this.isProduction);\r\n\r\n        if (this.isProduction === false) {\r\n            await this.loadAdminUnits();\r\n        }\r\n        else {\r\n            await store.loadUnit();\r\n        }\r\n        this.openVPage(VHome);\r\n\t}\r\n\t\r\n\tstartUq = (unit: Unit) => {\r\n\t\tlet cUq = this.newC(CUq);\r\n\t\tcUq.start(unit);\r\n\t}\r\n\r\n\tstartApp = (unit: Unit) => {\r\n\t\tlet appController = new AppController(this.res);\r\n\t\tappController.start(unit.id);\r\n\t}\r\n\r\n    onShowUnit = async (item: UnitAdmin) => {\r\n        appInFrame.unit = item.id; // 25;\r\n        store.init();\r\n        await store.loadUnit();\r\n\r\n        let {unit} = store;\r\n        this.adminDevs = new AdminDevs(unit);\r\n\r\n        let {isDev, type} = unit;\r\n        if (isDev === 1) {\r\n            // \r\n            if ((type & 1) !== 0) {\r\n                await store.dev.loadCounts();\r\n            }\r\n\r\n            // \r\n            if ((type & 2) !== 0) {\r\n                await store.loadApps();\r\n            }\r\n        }\r\n        this.unit = unit;\r\n        this.openVPage(VUnit);\r\n    }\r\n\r\n    logout = async () => {\r\n        store.logout();\r\n    }\r\n\r\n    showAppXAccount = async (appXAccount: DevApp) => {\r\n        let cAppXAccount = this.newC(CAppXAccount);\r\n        await cAppXAccount.start(this.unit, appXAccount);\r\n    }\r\n\r\n    async onShowDevelopers() {\r\n        await this.adminDevs.load();\r\n        let c = this.newC(CDevelopers);\r\n        c.start(this.adminDevs);\r\n    }\r\n}\r\n\r\n","import { CAppBase, IConstructor } from \"tonva\";\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\nimport { CUqBase } from \"./CBase\";\r\n//import { VMain } from './tonvaApp/main';\r\n//import { CMe } from \"me/CMe\";\r\nimport { CHome } from \"Home\";\r\n\r\nexport class CApp extends CAppBase {\r\n    //get uqs(): UQs { return this._uqs };\r\n\r\n    cHome: CHome;\r\n    //cMe: CMe;\r\n    /*\r\n    cPosts: CPosts;\r\n    cMedia: CMedia;\r\n    cTemplets: CTemplets;\r\n    */\r\n\r\n    protected newC<T extends CUqBase>(type: IConstructor<T>): T {\r\n        return new type(this);\r\n    }\r\n\r\n    protected async internalStart() {\r\n        this.cHome = this.newC(CHome);\r\n        //this.cMe = this.newC(CMe);\r\n        /*\r\n        this.cPosts = this.newC(CPosts);\r\n        this.cMedia = this.newC(CMedia);\r\n        this.cTemplets = this.newC(CTemplets);\r\n        */\r\n        //this.showMain();\r\n        this.cHome.start();\r\n    }\r\n\r\n    /*\r\n    showMain(initTabName?: string) {\r\n        this.openVPage(VMain, initTabName);\r\n    }\r\n    */\r\n}\r\n","import React from 'react';\nimport logo from './logo.svg';\nimport { nav, NavView, start } from 'tonva';\nimport { CHome } from './Home';\nimport './App.css';\nimport { CApp } from 'UqApp/CApp';\n\n/*\nfunction App() {\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <img src={logo} className=\"App-logo\" alt=\"logo\" />\n        <p>\n          Edit <code>src/App.tsx</code> and save to reload.\n        </p>\n        <a\n          className=\"App-link\"\n          href=\"https://reactjs.org\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          Learn React\n        </a>\n      </header>\n    </div>\n  );\n}\n*/\n\nfunction App() {\n    let onLogined = async () => {\n\t\tnav.clear();\n\t\tawait start(CApp, undefined);\n        //let cAdmin = new CHome({});\n        //await cAdmin.start();\n    }\n\treturn (<NavView onLogined={onLogined} />);\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}