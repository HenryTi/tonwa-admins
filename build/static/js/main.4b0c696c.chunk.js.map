{"version":3,"sources":["tonva/index.ts","tonva/components/index.ts","tonva/net/guestApi.ts","tonva/net/caller.ts","tonva/components/nav.tsx","tonva/net/netToken.ts","tonva/components/fetchErrorView.tsx","tonva/components/reloadPage.tsx","tonva/tool/cacheIds.ts","tonva/tool/local.ts","tonva/tool/getObjPropIgnoreCase.ts","tonva/tool/rules.ts","tonva/vm/controller.tsx","tonva/vm/view.tsx","tonva/vm/vpage.tsx","tonva/vm/components/CStringEdit.tsx","tonva/components/page/page.tsx","tonva/net/appBridge.ts","tonva/uq/entity.ts","tonva/components/edit/itemEdit.tsx","tonva/uq/caller.ts","tonva/net/httpChannel.ts","tonva/net/httpChannelUI.ts","tonva/net/uqApi.ts","tonva/uq/index.ts","tonva/res/res.ts","tonva/tool/uid.ts","tonva/uq/query.ts","tonva/net/wsChannel.ts","tonva/components/image.tsx","tonva/tool/user.ts","tonva/net/host.ts","tonva-form/index.ts","tonva/components/page/scrollView.tsx","tonva/uq/action.ts","tonva/components/simple/Badge.tsx","tonva/components/simple/LMR.tsx","tonva/components/simple/FA.tsx","tonva/components/simple/Muted.tsx","tonva/components/simple/IconText.tsx","tonva/tool/localDb.ts","tonva/uq/tuid/reactBoxId.tsx","tonva/components/loading.tsx","tonva-form/form/control/control.tsx","tonva-form/form/control/checkControl.tsx","tonva-form/form/control/radioControl.tsx","tonva-form/form/control/charsControl.tsx","tonva-form/form/control/textAreaControl.tsx","tonva-form/form/control/selectControl.tsx","tonva-form/form/control/unknownControl.tsx","tonva-form/form/control/stringControl.tsx","tonva-form/form/control/numberControl.tsx","tonva-form/form/control/pickIdControl.tsx","tonva-form/form/control/pickTuidControl.tsx","tonva-form/form/control/pickControl.tsx","tonva-form/form/control/buttonsControl.tsx","tonva-form/form/control/index.ts","tonva/tool/env.ts","tonva/uq/tuid/index.ts","tonva-form/form/rowContainer/index.tsx","model/index.ts","tonva/net/apiBase.ts","tonva/components/edit/imageItemEdit.tsx","tonva/tool/pageItems.ts","tonva/net/messageHub.ts","tonva/components/navigo.ts","tonva/components/page/pageHeader.tsx","tonva/components/page/tabs.tsx","tonva/components/resUploader.tsx","tonva/uq/uqMan.ts","tonva/uq/sheet.ts","tonva/uq/book.ts","tonva/uq/history.ts","tonva/uq/map.ts","tonva/uq/pending.ts","tonva/uq/enum.ts","tonva-form/form/index.ts","tonva-form/form/formView.tsx","tonva/auth/meInfo.tsx","tonva/auth/createLogin.ts","tonva/uq/tag/tagView.tsx","tonva/uq/tag/tag.ts","tonva/res/formRes.ts","tonva/res/listRes.ts","tonva/components/page/index.ts","tonva/components/schema/index.ts","tonva/components/dropDownActions/index.tsx","tonva/components/easyDate/index.tsx","tonva/components/media.tsx","tonva/components/searchBox.tsx","tonva/components/userIcon.tsx","tonva/components/ax/index.tsx","tonva/components/autoHideTips.tsx","tonva/uq/tuid/tuidsCache.ts","tonva/uq/uqsMan.ts","tonva/uq/buildUqApp.ts","model/id.ts","tonva-form/form/TonvaForm.tsx","tonva-form/multiStep/index.tsx","tonva/components/form/rules/index.ts","tonva/components/form/widgets/widget.tsx","tonva/components/form/widgets/textWidget.tsx","tonva/components/form/widgets/textareaWidget.tsx","tonva/components/form/widgets/passwordWidget.tsx","tonva/components/form/widgets/numberWidget.tsx","tonva/components/form/widgets/updownWidget.tsx","tonva/components/form/widgets/dateWidget.tsx","tonva/components/form/widgets/checkBoxWidget.tsx","tonva/components/form/widgets/selectWidget.tsx","tonva/components/form/widgets/radioWidget.tsx","tonva/components/form/widgets/rangeWidget.tsx","tonva/components/form/widgets/idWidget.tsx","tonva/components/form/widgets/unknown.tsx","tonva/components/form/widgets/buttonWidget.tsx","tonva/components/form/context.tsx","tonva/components/form/widgets/arrComponent.tsx","tonva/components/form/widgets/imageWidget.tsx","tonva/components/form/widgets/tagWidget.tsx","tonva/components/form/widgets/factory.tsx","tonva/components/form/form.tsx","tonva/components/form/field.tsx","tonva/auth/VLogout.tsx","tonva/img/logo.svg","tonva/auth/tools.tsx","tonva/auth/VLogin.tsx","tonva/auth/VChangePassword.tsx","tonva/auth/register/VStart.tsx","tonva/auth/register/VVerify.tsx","tonva/auth/register/VPassword.tsx","tonva/auth/register/VSuccess.tsx","tonva/auth/register/CRegister.ts","tonva/auth/CLogin.tsx","tonva/components/edit/stringItemEdit.tsx","tonva/components/edit/radioItemEdit.tsx","tonva/components/edit/selectItemEdit.tsx","tonva/components/edit/idItemEdit.tsx","tonva/components/edit/tagItemEdit.tsx","tonva/components/edit/textAreaItemEdit.tsx","tonva/components/edit/checkBoxItemEdit.tsx","tonva/components/edit/rangeItemEdit.tsx","tonva/components/edit/numberItemEdit.tsx","tonva/components/edit/edit.tsx","tonva/app/centerApi.ts","tonva/app/vMain.tsx","tonva/app/CAppBase.ts","tonva/app/start.ts","tonva/app/CBase.ts","tonva/components/list/base.tsx","tonva/components/list/clickable.tsx","tonva/components/list/static.tsx","tonva/components/list/selectable.tsx","tonva/components/list/index.tsx","tonva/components/propGrid/row.tsx","tonva/components/propGrid/propView.tsx","tonva/components/propGrid/PropGrid.tsx","tonva/uq/tuid/idCache.ts","tonva/uq/tuid/tuid.ts","api/mainApi.ts","api/devApi.ts","store/cacheIds.ts","store/dev.ts","store/store.ts","UqApp/CBase.ts","tools/idDates.tsx","tools/span.tsx","tools/unitSpan.tsx","consts.ts","tools/uqSpan.tsx","tools/appSpan.tsx","tools/busSpan.tsx","tools/serverSpan.tsx","tools/stringValueEdit.tsx","tools/idPickPage.tsx","tools/createIdPick.tsx","Apps/info.tsx","Apps/new.tsx","Apps/index.tsx","Dev/apps/appsPage.tsx","Dev/apps/editPage.tsx","Dev/apps/appUqs.tsx","Dev/apps/appPage.tsx","Dev/apps/uqBindPage.tsx","Dev/apps/index.tsx","Dev/uqs/resultSections.tsx","Dev/uqs/compileResultPage.tsx","components/ButtonAsync.tsx","Dev/uqs/uqUpload.tsx","Dev/uqs/newServicePage.tsx","Dev/uqs/servicePage.tsx","Dev/uqs/editPage.tsx","Dev/uqs/uqPage.tsx","Dev/uqs/listPage.tsx","Dev/uqs/VUqDevsAdmin.tsx","Dev/uqs/CPickServer.tsx","store/admins.ts","Dev/uqs/CPickUnit.tsx","Dev/uqs/CUq.tsx","Dev/buses.tsx","Dev/servers.tsx","Dev/ObjView.tsx","Home/VUnit.tsx","Home/VHome.tsx","XAccount/VApp.tsx","XAccount/VDetail.tsx","XAccount/VUser.tsx","XAccount/VAdmins.tsx","XAccount/VRoleUsers.tsx","XAccount/VNoRoleUsers.tsx","XAccount/VAddUserPage.tsx","XAccount/VUserList.tsx","tools/userSpan.tsx","XAccount/VEditUserPage.tsx","XAccount/CAppXAccount.ts","Dev/developers/VDevelopers.tsx","Dev/developers/VUqsBuses.tsx","Dev/developers/VUqs.tsx","Dev/developers/VBuses.tsx","Dev/developers/VAddDeveloper.tsx","Dev/developers/CDevelopers.ts","store/adminDevs.ts","UqRoles/VUqRoles.tsx","UqRoles/VAddUser.tsx","UqRoles/VRoleAdmin.tsx","UqRoles/CUqRoles.ts","Admins/VEditAdmin.tsx","Admins/VAddAdmin.tsx","Admins/VAdmins.tsx","Admins/CAdmins.ts","Users/VApps.tsx","Users/VUsers.tsx","Users/VApp.tsx","Users/VUser.tsx","Users/VAppEditUsers.tsx","Users/VUserEditApps.tsx","Users/VAddUser.tsx","Users/CUsers.tsx","Home/CHome.tsx","UqApp/CApp.ts","App.tsx","reportWebVitals.ts","index.tsx"],"names":["guestApi","this","get","ret","decodeGuestToken","guest","token","unitName","unit","CenterApiBase","undefined","Caller","params","waiting","_params","method","logMark","netToken","userId","setCenterToken","WSChannel","FetchErrorView","reApi","a","props","clearError","channel","url","options","resolve","reject","refetchApi","close","errContent","error","err","i","push","style","wordWrap","className","type","onClick","React","SystemNotifyPage","message","header","ReloadPage","timerHandler","reload","clearInterval","nav","seconds","state","setInterval","setState","title","msg","ConfirmReloadPage","back","confirm","isMobile","RegExp","test","navigator","userAgent","logs","stackKey","NavView","stack","waitCount","waitTimeHandler","upgradeUq","start","isHistoryBack","navBack","tick","Date","now","console","log","length","len","window","self","top","postMessage","confirmClose","pop","fetchError","wait","set","addEventListener","init","env","setTimeout","clearTimeout","unauthorized","showLogin","uq","version","show","view","disposer","clear","removeCeased","history","pushState","key","ceased","refresh","item","dispose","level","p","backLevel","popAndDispose","find","v","elWait","elError","testing","left","zIndex","name","map","index","visibility","position","navView","wsHost","local","LocalData","navigo","navSettings","language","culture","resUrl","hashParam","centerHost","arrs","windowOnError","event","source","lineno","colno","windowOnUnhandledRejection","ev","reason","windowOnClick","windowOnMouseMove","x","y","windowOnScroll","forceDevelopment","navLogin","user","navLogout","showLogout","navRegister","showRegister","navForget","showForget","navPageRoutes","doneSysRoutes","sysRoutes","isWebNav","backIcon","closeIcon","pageWebNav","userToken","showPrivacyPage","privacy","getPrivacyContent","privacyPage","htmlString","content","__html","dangerouslySetInnerHTML","createLogin","login","Promise","race","serviceWorker","ready","registration","unregister","document","location","plus","webview","webView","resetAll","ok","showReloadPage","localStorage","lang","resOptions","district","messageHub","dispatch","unitJsonPath","fetch","unitRes","json","res","remove","el","getElementById","innerText","loadUnitJson","innerHTML","JSON","parse","envUnit","process","REACT_APP_UNIT","Number","isDevelopment","id","getPredefinedUnitName","unitFromName","unitId","settings","origin","pathname","toLowerCase","endsWith","substr","host","hash","pos","getExHashPos","substring","ws","resHost","resUrlFromHost","setCenterUrl","Error","setGuest","exHash","getExHash","appInFrame","setAppInFrame","parent","loadPredefinedUnit","predefinedUnit","onerror","onunhandledrejection","onselectstart","oncontextmenu","startWait","notLogined","logined","endWait","Navigo","historyAPIUpdateMethod","on","navigate","navPage","alert","queryStr","routeFromNavPage","internalOnNavRoutes","_","merge","navOns","route","absolute","showPage","isUserLogin","onLogined","userApi","me","icon","nick","callback","logoutApis","stringify","saveLocalUser","showAppView","internalLogined","defaultTop","loginTop","withBack","getLogin","logoutClear","showChangePassword","onError","showUpgradeUq","replace","topKey","popTo","ceaseTop","regConfirmClose","confirmBox","apiId","sheetType","sheetId","sheet","includes","uh","appUrl","src","String","open","date","getTime","toTimeString","step","href","indexOf","text","r","parser","DOMParser","htmlDoc","parseFromString","elHtml","getElementsByTagName","newVersion","getAttribute","g","oem","observable","CacheIds","maxCount","arr","ids","dict","loadId","shift","delete","_loadIds","items","_loadId","setItem","e","Map","localDb","child","_user","_guest","_unit","forEach","d","getObjPropIgnoreCase","obj","prop","keys","Object","mobileRegex","emailRegex","Controller","_t","t","label","isDev","receiveHandlerId","unregisterReceiveHandler","onDispose","onMessageReceive","onMessage","_resolve_$","topPageKey","str","internalT","beforeInit","getPageWebNav","afterInit","webNav","$lang","$district","l","vp","param","afterBack","replaceOpen","render","value","onEvent","openPage","registerReceiveHandler","beforeStart","internalStart","afterStart","page","onClosePage","go","caption","yes","no","classNames","closePage","buttons","View","controller","isMe","vm","vCall","returnCall","imageClassName","textClassName","renderUser","replacePage","backPage","ceasePage","popToTopPage","VPage","retOnClosePage","_onClosePage","openPageElement","renderPage","replacePageElement","logout","right","footer","onScroll","onPageScroll","onScrollTop","scroller","onPageScrollTop","onScrollBottom","onPageScrollBottom","headerClassName","tabsProps","onChange","evt","newValue","target","preValue","isChanged","onBlur","verifyValue","onFocus","onEdit","maxLength","placeholder","onValueChange","onSave","createElement","observer","disabled","onKeyDown","keyCode","defaultValue","renderValue","renderPencil","Page","tabsView","TabsView","inWebNav","pageHeaderProps","center","rph","renderPageHeader","elFooter","errorInfo","children","renderHeader","renderFooter","uqTokens","logoutUqTokens","appsInFrame","val","isBridged","subFrameStarted","data","subWin","setSubAppWindow","hidden","hideFrameBack","clone","initSubWin","onReceiveAppApiMessage","apiName","db","parts","split","uqOwner","uqName","appOwner","appName","uqTokenApi","onAppApiReturn","urlTest","action","uqTokenActions","realUrl","getUrlOrTest","appHash","slice","lastIndexOf","u","uid","getUnit","realUnit","onReceive","callCenterApiFromMessage","bridgeCenterApiReturn","startsWith","buildAppUq","uqToken","centerToken","at","opener","appUq","brideCenterApis","bridgeCenterApi","body","callId","from","callCenterapi","directCall","result","bca","ln","chars","codeBackSlash","charCodeAt","codeN","codeT","codeB","codeF","codeV","codeR","codes","codeBN","codeBT","codeBB","codeBF","codeBV","codeBR","Entity","typeId","jName","schema","ver","sys","cache","uqApi","fields","arrFields","returns","face","fieldMaps","localMap","f","loadEntitySchema","buildSchema","loadValues","setSchema","buildFieldsTuid","setJName","buildFieldTuid","buildArrFieldsTuid","fieldName","arrName","entities","fn","getTuid","an","fieldArr","tuid","buildFieldsParams","arrResult","pa","rowResult","field","buildDateTimeParam","getFullYear","getMonth","getDate","_tuid","getIdFromObj","dt","Math","floor","toISOString","packRow","arrData","packArr","join","row","ch","escape","values","boxId","unpackRow","unpackArr","ch0","c","fLen","to","reverseNT","n","isNaN","p0","vals","ItemEdit","edit","itemSchema","uiItem","_itemSchema","_uiItem","internalEnd","divValue","labelHide","templet","Templet","widget","list","rules","nv","Array","isArray","verifyRule","rule","EntityCaller","entity","tries","_entity","loadSchema","innerRequest","xcall","innerCall","jsonResult","$uq","$modify","pullModify","xresult","retry","rebuildSchema","buildEntities","uqVersion","en","ActionCaller","QueryQueryCaller","unpackReturns","buildParams","QueryPageCaller","pageStart","pageSize","methodsWithBody","HttpChannel","hostUrl","apiToken","ui","timeout","showError","post","urlPrefix","caller","buildOptions","headers","path","h","encodeURI","innerFetch","k","innerFetchResult","buildError","ex","retErr","that","timeOutHandler","statusText","ct","then","retJson","retError","catch","buildHeaders","CenterHttpChannel","UqHttpChannel","HttpChannelNavUI","channelUIs","channelNoUIs","channels","UqApi","basePath","access","showWaiting","channelUI","acc","s","trim","theUser","roles","ApiBase","UnitxApi","buildChannel","centerAppApi","CenterAppApi","unitxUq","centerChannel","centerChannelUI","loginedUserId","uqTokensName","un","localCache","nowTick","appUqParams","call","loadAppUqs","uqs","decodeUserToken","account","verify","password","resLang","languages","toUpperCase","setResOptions","resGlobal","setRes","setGlobalRes","ALPHABET","rtn","charAt","random","Query","PageItems","more","startField","isPaged","size","$page","array","deep","pageCaller","request","queryCaller","query","table","subAppWindow","postWsToSubApp","win","WsBase","wsBaseSeed","wsBaseId","WebSocket","onopen","onmessage","wsMessage","onclose","receive","netThis","connect","send","Image","altImage","alt","currentTarget","jwtDecode","uqDebugHost","hosts","centerhost","reshost","uqhost","unitxhost","httpArr","urlFromHost","isAbsoluteUrl","centerUrlFromHost","centerWsFromHost","https","fetchOptions","mode","tryLocal","getCenterHost","getResHost","promises","hostArr","findIndex","fetchUrl","debugHostUrl","localCheck","all","results","j","hostValue","debugHost","getUrlOrDebug","urlDebug","fetchLocalCheck","Scroller","scrollTo","scrollTop","offsetHeight","scrollTimeGap","ScrollViewBase","bottomTime","topTime","div","refDiv","onResize","removeEventListener","sh","scrollHeight","direct","Children","_$scroll","toString","eachChild","Component","ScrollView","ref","WebNavScrollView","vHeader","vFooter","navHeader","navRawHeader","navFooter","navRawFooter","Action","ActionSubmitCaller","SubmitReturnsCaller","SubmitConvertCaller","pack","Badge","b","badge","color","badgeAlign","badgeVertical","cn","LMR","cursor","FA","spin","fixWidth","border","pull","pulse","rotate","flip","inverse","Muted","__ls","getItem","removeItem","LocalCache","removeLocal","Local","caches","locals","keyForGet","keyForSet","sk","LocalArr","LocalMap","keyForRemove","removeAll","ks","unshift","splice","saveIndex","max","ls","TuidContent","tuidName","uqStringify","ReactBoxId","isUndefined","boxName","assureBox","valueFromId","tuidValue","nullUI","ttv","divObj","bi","logContent","boxIdContent","Loading","ControlBase","formView","renderControl","validate","hasError","computed","Control","_field","_face","element","setProps","bind","clearErrors","clearValue","isOK","getValueFromElement","isOk","notes","CheckControl","trueValue","falseValue","assign","checked","RadioControl","CharsControl","required","parseValue","renderInput","renderError","TextAreaControl","rows","SelectControl","selectedOptions","default","UnknownControl","role","EmptyControl","StringControl","PasswordControl","NumberControl","extraChars","min","parseFloat","onKeyPress","charCode","onKeyDot","onKeyNeg","preventDefault","PickIdControl","pick","fromPicked","readValues","onPicked","itemFromId","initCaption","input","controlContent","component","PickTuidControl","onIdChanged","onFormValues","buildContent","PickControl","Content","ButtonsControl","otherClick","onOther","nothing","btnOther","submitButton","otherButton","createControl","form","group","groupRow","createGroupControl","fieldRow","fieldType","defaultFaces","controlTypes","createFieldControl","help","tag","ms","args","global","handle","RowContainer","control","cc","setError","setInitValues","filled","ElementRowContainer","BootStrapRowContainer","bootstrapCreateRow","elementCreateRow","getHttpChannel","callFetch","put","ImageItemEdit","resId","onSaved","itemObservable","isFirst","pageItemAction","itemConverter","_items","scrollToTop","scrollIntoView","topDiv","scrollToBottom","bottomDiv","firstSize","appendPosition","sortOrder","changing","divId","getPageId","loadResults","pageList","beforeLoad","loaded","allLoaded","reset","isAsc","endItem","scrollToEnd","pushItem","endIndex","startId","pid","sum","load","setLoaded","loading","onLoad","setPageStart","onLoaded","reverse","handlerSeed","anyHandlers","msgHandlers","handler","seed","args0","handlerId","$type","useHash","root","_routes","_useHash","_hash","_paused","_destroyed","_lastRouteResolved","_notFoundHandler","_defaultHandler","_usePushState","_genericHooks","_historyUpdateMethod","timout","_onLocationChange","isPushStateAvailable","_cLoc","_listen","updatePageLinks","cleanUrl","match","names","reduce","decodeURIComponent","paramNames","regexp","PARAMETER_REGEXP","full","dots","REPLACE_VARIABLE_REGEXP","WILDCARD_REGEXP","REPLACE_WILDCARD","FOLLOWED_BY_SLASH_REGEXP","MATCH_REGEXP_FLAGS","urlA","urlB","getUrlDepth","routes","replaceDynamicURLParts","clean","regExpResultToParams","filter","m","findMatchedRoutes","colonExp","matched","routeExp","fallbackURL","matched0","cleanGETParam","hooks","exHooks","before","shouldRoute","after","_getRoot","_historyUpdate","arg0","arg1","orderedRoutes","sort","compareUrlDepth","uses","_add","current","GETParameters","extractGETParameters","onlyURL","getOnlyURL","already","manageHooks","_callLeave","isHashedRoot","_findLinks","link","hasListenerAttached","ctrlKey","metaKey","tagName","getLinkPath","status","pause","destroy","as","replaceState","cLocRoot","isHashChangeAPIAvailable","cached","check","querySelectorAll","lastRouteResolved","leave","onBack","vBack","debugLogout","rightView","Tab","contentBuilder","notify","onShown","_content","selected","tabBg","sep","tabClick","tab","selectedTab","tabArr","shown","tabs","bsCur","bsTab","tabPosition","borderColor","borderStyle","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","notifyCircle","num","displayNone","pageHeader","pageFooter","tabBack","isSelected","display","ResUploader","fileInput","upload","formData","buildFormData","Headers","append","onFilesChange","files","fileName","maxSize","FormData","file","multiple","formatSize","pointLength","units","toFixed","xlargeSize","mediumSize","ImageUploader","imgBaseSize","imageTypes","suffix","resUploader","onFileChange","fileError","uploaded","enableUploadButton","reader","FileReader","readAsDataURL","onload","srcImage","setSize","desImgSize","desImage","compress","img","width","height","srcImgWidth","srcImgHeight","w","scale","desImgWidth","round","desImgHeight","canvas","ctx","getContext","anw","createAttribute","nodeValue","anh","setAttributeNode","drawImage","base64","toDataURL","blob","convertBase64UrlToBlob","showOrgImage","maxWidth","urlData","mime","bstr","atob","u8arr","Uint8Array","Blob","defaultChecked","levelDiv","padding","AudioUploader","audioTypes","fileSize","uploading","UqMan","uqData","createBoxId","tvs","enums","actions","sheets","queries","books","maps","histories","pendings","tags","tuidsCache","localAccess","localModifyMax","tuids","createBoxIdFromTVs","tuidArr","actionArr","enumArr","sheetArr","queryArr","bookArr","mapArr","historyArr","pendingArr","tagArr","TuidsCache","accesses","loadAccess","buildTuids","buildAccess","newTuid","entityName","allSchemas","fromType","fromObj","defer","cacheTuids","enm","UqEnum","TuidImport","TuidInner","book","Book","Tag","History","pending","Pending","Sheet","newAction","newQuery","newBook","newMap","newHistory","newSheet","newPending","newTag","newEnum","buildSheet","build","mainFields","buildTuidBox","owner","ownerField","buildTuidDivBox","modifyMax","states","ops","op","discription","app","SaveCaller","SaveDirectCaller","flow","ActionDirectCaller","brief","unpackSheet","flows","GetSheetCaller","getArchive","unpack","SheetArchiveCaller","SheetArchivesCaller","StateSheetsCaller","PageStateItems","StateSheetCountCaller","UserSheetsCaller","MySheetsCaller","SheetCaller","resVerify","count","getStateSheets","queryApiName","BookQueryCaller","schemaFrom","actionSchema","querySchema","AddCaller","DelCaller","AllCaller","PageCaller","qc","QueryCaller","MapCaller","getCaller","MapAddCaller","add","MapDelCaller","MapAllCaller","MapPageCaller","MapQueryCaller","FormView","buttonsRow","buildRows","onSubmit","initValues","formRows","createRow","buildRow","readOnly","createButtons","formRow","formRowCreator","some","every","uiSchema","onItemChanged","userSetProp","importCLogin","CLogin","radioStyle","TagView","nameFromId","namesFromIds","renderRadio","renderView","renderCheck","wrapClassName","inputs","inputName","onInputChange","coll","_view","lines","line","ext","formRes","number","integer","zh","listRes","none","DropdownActions","menu","button","handleDocumentClick","dropdownOpen","contains","toggle","isRight","itemIconClass","itemCaptionClass","hasIcon","data-toggle","aria-expanded","iconClass","captionClass","aria-hidden","onTouchStart","timeRes","md","month","ymd","year","yesterday","today","tomorrow","$zh","$en","tt","renderDate","vDate","withTime","always","nDate","_date","nowYear","hour","getHours","minute","getMinutes","appendTime","dPart","hm","EasyDate","EasyTime","Media","disp","main","px","py","SearchBox","allowEmptySearch","initKey","onSearch","inputSize","inputClassName","buttonText","userCache","loader","UserView","noneImage","getValue","idProp","useUser","use","Ax","axProps","aClassName","naClassName","openSysPage","cacheTimer","loadIds","clearCacheTimer","cacheIds","tuidCached","innerPullModify","tuidLists","queueModify","queue","modify","modifyIds","UQsMan","tonvaAppName","collection","localData","buildTVs","uqsMan","uqAppData","retErrors","setTuidImportsLocal","_uqs","buildUQs","errors","uqTVs","lj","uqsData","promiseInits","uqFullName","lower","loadEntities","uqMan","uqKey","proxy","Proxy","receiver","showReload","isImport","setInner","tuidImport","fromName","iName","setFrom","unitCaptions","1","2","3","unitCaption","TonvaForm","MultiStep","stepViews","topView","onPrev","onNext","nextStepName","next","setStep","first","stepName","steps","ButtonConten","prefix","btnContent","formProps","pIcon","sIcon","Rule","RuleCustom","func","defy","RulePredefined","RuleRequired","RuleNum","minMsg","maxMsg","template","checkMore","RuleInt","isInteger","Widget","context","fieldProps","_ui","isChanging","changeValue","container","visible","inNode","requiredFlag","FieldContainer","renderBody","getUiItem","contextErrors","buildRules","removeErrorWidget","addErrorWidget","initData","fromElement","onChanging","onChanged","prev","allowChange","setDataValue","setElementValue","elDiscription","discriptionClassName","errorList","fieldClass","FieldClass","uiLabel","TextWidget","inputType","internalOnKeyDown","onEnter","blur","checkRules","checkContextRules","hasFocus","renderTemplet","renderErrors","TextAreaWidget","setValue","PasswordWidget","UrlWidget","EmailWidget","NumberWidget","UpdownWidget","returnValue","isValidKey","DateWidget","DateTimeWidget","TimeWidget","MonthWidget","CheckBoxWidget","SelectWidget","select","option","RadioWidget","rowKey","isRow","RangeWidget","IdWidget","pickId","clearContextError","Unknown","dataType","uiType","dataTypes","ButtonWidget","submit","observerRender","widgetType","ButtonClass","Context","subContexts","widgets","arrRowContexts","itemName","getDisabled","setDisabled","getReadOnly","setReadOnly","getVisible","setVisible","buttonName","errorWidgets","ew","onButtonClick","checkFieldRules","rowContext","setContextError","clearWidgetsErrors","clearContextErrors","checkHasError","rowKeySeed","RowContext","parentContext","arrSchema","uiArr","itemSchemas","FormContext","ContextContainer","ArrComponent","selectable","deletable","restorable","getArrRowContexts","onDeleted","onRestored","arrLabel","ArrContainer","RowSeperator","formSelectable","formDeletable","formRestorable","arrSelectable","arrDeletable","arrRestorable","ac","rc","rs","rowContent","typeofTemplet","factory","selectCheck","deleteIcon","$isSelected","$source","isDeleted","$isDeleted","editContainer","Provider","ImageWidget","imageSrc","end","TagWidget","widgetsFactory","textarea","datetime","time","email","updown","checkbox","image","checkboxes","radio","tagSingle","valuesView","renderRadios","tagMulti","defaultArr","def","renderChecks","range","typeWidget","getItemSchema","getTypeWidget","WidgetClass","Form","formContext","Container","watch","calcSelectOrDelete","DefaultContainer","DefaultFieldContainer","fieldLabelSize","labelView","fieldCol","DefaultFieldClass","DefaultButtonClass","DefaultRes","autorun","dv","initDataItem","arrItem","arrItems","arrDict","arrItemOperated","formArrVal","beforeShow","renderContent","contextType","VLogout","onLogout","tonvaTop","logo","senders","regex","getSender","VLogin","onLogin","username","pwd","sender","margin","privacyEntry","VChangePassword","orgPassword","newPassword","newPassword1","VStart","checkAccount","accountLable","pageCaption","marginLeft","marginRight","VRegisterStart","VForgetStart","VVerify","onVerifyChanged","onVerify","typeText","extra","VPassword","onButtonSubmit","rePwd","onPasswordSubmit","submitCaption","VRegisterPassword","VForgetPassword","VSuccess","VRegisterSuccess","VForgetSuccess","CRegBase","retUser","userLogined","openVPage","checkVerify","toPassword","isExists","accountError","sendVerify","toVerify","CRegister","country","mobile","mobileCountry","register","toSuccess","regReturn","registerReturn","CForget","resetPassword","cRegister","cForget","vPage","getVChangePassword","changePassword","StringItemEdit","inputOptions","RadioItemEdit","SelectItemEdit","IdItemEdit","TagItemEdit","renderInputs","TagSingleItemEdit","TagMultiItemEdit","TextAreaItemEdit","CheckBoxItemEdit","RangeItemEdit","NumberItemEdit","Edit","defaultSepClassName","defaultRowContainerClassName","topBorder","bottomBorder","rowContainerClassName","rowClick","itemEdit","editInRow","onItemClick","stopEdit","topBorderClassName","bottomBorderClassName","sepClassName","ie","createItemEdit","divLabel","requireFlag","centerApi","userName","VUnsupportedUnit","VUnitSelect","renderRow","onRowClick","appUnit","setAppUnit","appUnits","VErrorsPage","VStartError","CAppBase","config","appConfig","noUnit","roleDefines","nRole","roleDefs","onNavRoutes","userAppUnits","showUnsupport","appUnitId","resolveRoute","userFromId","CApp","htmlTitle","html","html0","cApp","CBase","_cApp","hasRole","wn","getWebNav","CSub","_owner","ownerWNs","own","ListBase","pageItems","Clickable","Static","Selectable","inputItems","buildItems","itemsArray","isItemSelected","selectedItems","compare","retItems","labelId","comp","selectItem","si","obItem","onSelect","flex","marginBottom","htmlFor","listenArraySplice","isObservableArray","observe","change","removedCount","added","_added","checkAll","anySelected","List","listBase","buildBase","prevProps","prevState","isEqual","forceUpdate","selectAll","unselectAll","waitingMore","tabIndex","isLoading","staticRow","PropRow","PropBorder","borderTop","PropGap","valueAlignStart","valueAlignCenter","valueAlignEnd","LabeledPropRow","gridProps","_prop","col","labelFixLeft","bk","renderLabel","renderProp","align","vAlign","alignValue","renderPropBody","renderPropContent","StringPropRow","NumberPropRow","ListPropRow","borderBottom","ComponentPropRow","PropView","isGap","setValues","PropGrid","propView","IdCache","tuidLocal","localArr","waitingIds","tuidInner","divName","initLocalArr","isNumber","has","moveToHead","_id","useId","tuidValues","cacheIdValues","unpackTuidIds","cacheValue","cacheTuidFieldValues","loadTuidIdsOrLocal","localedValues","netIds","loadTuidIds","netRet","IdDivCache","Tuid","noCache","typeName","idName","unique","TuidBox","id1","id2","idValue","divs","cacheFields","idCache","tuidDiv","TuidDiv","resetCache","assureObj","IdsCaller","GetCaller","cacheFieldsInValue","arrValues","$create","$update","stampOnMain","unpackTuidIdsOfFields","SavePropCaller","searchArr","SearchCaller","LoadArrCaller","SaveArrCaller","order","ArrPosCaller","TuidNoCaller","TuidCaller","$id","transParams","arrParams","arrValue","buildDateParam","bid","$order","loadMain","save","saveProp","search","loadArr","saveArr","posArr","hasDiv","TuidBoxDiv","mainApi","toUser","fromUnit","fromApp","fellow","isOwner","isAdmin","dev","deleted","apps","member","assigned","devApi","uqsText","service","CacheUnits","CacheUqs","CacheApps","CacheBuses","bus","CacheUsers","CacheServers","server","buses","servers","users","ObjItems","store","_load","cur","_save","_inc","_del","_dec","Apps","saveApp","delApp","counts","searchUq","searchPageSize","searchedUqs","Uqs","saveUq","delUq","Buses","saveBus","delBus","busName","checkBusName","checkBusFace","checkBusQuery","faceReplaceStringWithFace","busTypes","refNameOk","faceName","hasFaceReplace","newFace","pushFaceField","faceFromName","parseField","delArr","parsed","checkBusQueryParam","refArrayOk","Servers","saveServer","delServer","Services","services","saveService","delService","changeServiceProp","loadUqServices","SearchItems","Dev","searchApp","searchServer","uqServer","unitAdmins","accUnits","devUnits","bothUnits","memberCount","roleApps","roleMember","roleMembers","memberRoles","userUnitAdmins","loadUnit","ua","unitChangeProp","unitApps","unitMemberCount","uqBuilderUrl","appId","unitDeleteApp","inUnit","unitAddApp","unitRoles","unitAddRole","unitRoleChangeProp","unitRoleApps","unitRoleSetApps","unitMembers","unitAssignMember","unitMemberRoles","rId","unitSetMemberRoles","org","CUqBase","IdDates","date_init","date_update","span","isLink","UnitSpan","disc","UnitName","UnitInfo","appIcon","REACT_APP_ICON","UqSpan","REACT_APP_ITEM_ICON","api","UqInfo","AppRow","AppInfo","apis","BusSpan","BusInfo","ServerSpan","ip","ServerInfo","StringValueEdit","errorDiv","info","IdPickPage","itemClick","idFromItem","candidateItems","searchPlaceHolder","createIdPick","Info","renderUqRow","uqAccess","act","appActed","newInUnit","restoreUnitApp","stopUnitApp","newApp","addUnitApp","uqAccesses","faName","PageApps","NewApp","appClick","renderApp","AppsPage","loadApps","ban","newItem","itemRender","appList","listRowClick","showNewApp","appRow","spanCaption","ServerCaption","cloud","EditBasePage","moreCandidates","pickServerId","renderServerInput","itemId","EditPage","NewPage","SearchUqPage","onUq","AppPage","editItem","deleteItem","deleteApp","menuItems","btnAddUq","uqClick","isMain","UqBindPage","saveUqBind","removeUqBind","setMainUQ","saveSetUqMain","btnLeft","btnRight","isBinded","AppController","uqMainId","uqMain","service_count","mainIdex","appSetUqMain","setUqMain","getMyUqs","appBindUq","groupStart","groupEnd","Section","rowId","ReactDOMServer","renderToStaticMarkup","StringSection","GroupSection","collaps","setCollaps","titleIcon","cId","whiteSpace","elId","elIcon","firstElementChild","fa","createRange","selectNode","createContextualFragment","parentNode","insertBefore","nextSibling","removeChild","EndSection","ErrorSection","Fragment","ResultSections","containerElement","stop","sectionId","addToGroup","addText","appendChild","section","sections","renderHtml","addHtml","afterMount","mayStart","sec","addSection","CompileResultPage","resultSections","timeHandler","autoScrollEnd","autoScroll","doubleClick","pane","getParent","topIntoView","bottomIntoView","lastScrollTop","pauseAutoScrollToBottom","startAutoScrollToBottom","startTime","total","renderText","parentElement","uintArray","encodedString","fromCharCode","read","done","compile_time","deploy_time","buf","uintToString","byteLength","actionName","abortController","abort","getReader","pump","endAutoScrollToBottom","finish","onDoubleClick","fontWeight","ButtonAsync","newOnClick","useState","isWaiting","setIsWaiting","isMounted","useRef","useEffect","background","bottom","UqUpload","upFiles","fileClick","fr","readAsText","onUpload","lastModifiedDate","trunc","sz","AbortController","signal","fileList","fileRender","encType","click","compiled","compile","description","deploy","UqDeploy","onCompile","UqPage","idPickServerProps","serverRow","testServerRow","UnitCaption","uqUniqueUnitRow","dbRow","NewServicePage","uqId","ServicePage","onDbChanged","orgValue","changeProp","onUnitPick","pickUnit","uqUniqueUnit","onServerPick","pickServer","onServerTestPick","serverTest","onDeleteClick","UQPage","deleteUq","adminDev","btnAddService","onServiceClick","onUqUpload","onUqTest","onUqDeploy","onUqDevsAdmin","serviceClick","angle","cnIcon","showNewServicePage","devList","uqDevs","renderService","ListPage","batchCompile","batchCompilePage","uqList","listRow","listCompileRow","cnBtn","bar","thoroughly","selectItems","VUqDevsAdmin","admin","devChanged","admins","devs","listHeader","loadAdmins","CPickServer","PageServerItems","VPickServer","renderServer","clickServer","onClickNullServer","searchBox","Admins","owners","unitAdmin","removeOneUnitAdmin","fellowId","unitSetAdmin","removeUnitAdmin","unitAddAdmin","unitDelAdmin","CPickUnit","unitItems","VPickUnit","renderUnit","clickUnit","CUq","loadUqEntities","cPickServer","newC","cPickUnit","uqGetEntities","r0","devUser","adminDevAdd","adminDevDel","svc","mine","SchemaView","busesProps","repeated","canEdit","serversProps","ObjView","New","tonvaForm","saveCur","stepHeader","del","extraMenuActions","defaultIconClass","rArrow","VUnit","appsAction","newUsersAction","cUsers","adminsAction","cAdmins","uqRolesAction","cUqRoles","noneAction","backgroundColor","mid","iconClassName","P","objProps","showAppXAccount","onClickUnitProps","vice","appRender","developersAction","onShowDevelopers","uqAction","startUq","busAction","serverAction","appItemRender","UnitProps","isRoot","readMe","divReadMe","VHome","onClickUnit","onShowUnit","selectUnitPage","renderUnitAdmin","noUnitPage","isProduction","VApp","appXAccount","showDetail","showUserList","calcUserColl","renderAdmins","renderRoles","renderUsers","showAdmins","showRoles","roleUserCount","roleUsers","showUsers","VDetail","onTurnOnOff","appTurnOnOff","VUser","roleBins","uqRoles","showEditUserPage","divRoles","box","VAddUser","roleNum","showAddUserPage","VAdmins","renderVm","VRoleUsers","renderRole","VNoRoleUsers","VAddUserPage","addUser","roleCaption","getRoleCaption","VUserList","UserSpan","UserInfo","VEditUserPage","isChecked","isMeAdmin","onAdminChanged","setAppAdmin","onRoleChanged","setAppRole","onDelUer","delUser","btnDel","onAdminChange","onRoleChange","CAppXAccount","isUser","isRole","mask","rus","setAppRoles","unitOnly","loadAppAdmins","unitAppAdmins","uq_main","insertUser","userRoles","roleBit","renewUser","VDevelopers","renderUserUqsBuses","userUqsBuses","adminDevs","getUserUqsBuses","userObj","onClickUserUqsBuses","showUserUqsBuses","onAddUser","showAddDeveloper","VUqsBuses","renderUq","onChangeUq","showUserUqs","renderBus","onChangeBus","showUserBuses","onDelDev","delDev","btnUqAdd","uqHeader","btnBusAdd","busHeader","VUqs","onCheckChanged","changeUserDev","renderUqItem","onClickUq","uqItems","VBuses","renderBusItem","onClickBusItem","userBuses","VAddDeveloper","onSubmitClick","addDev","CDevelopers","AdminDevs","VUqRoles","renderDevUQ","devUQs","onDevUQ","newUser","VRoleAdmin","renderItem","userRole","onRightClick","rightIcon","allRoles","vUser","restoreUser","deleteUser","vCap","VItem","VUserRoles","MeItem","meRoles","iRole","setUserRole","CUqRoles","myRolesChanged","getAllRoleUsers","allUserRoles","runInAction","rolesBool","meId","ur","loadUQs","unitUQs","setUserRoles","fireMyRolesChanged","newRoles","roleNames","userFromKey","buildRolesText","deleteUserRoles","VEditAdmin","setAdmin","Fellow","VAddAdmin","addAdmin","onNewFellow","onItemSelect","disableDel","onSelectAll","onClearAll","onDel","delAdmins","onAddAdmin","adminsView","CAdmins","VApps","appUsers","appUsersList","onAppsClick","VUsers","userApps","userAppsList","searchUser","onUsersClick","curApp","curAppUsers","onAppEditUsers","curUser","curUserApps","onUserEditApps","VAppEditUsers","appEditUsers","renderUserItem","editUser","onUserChanged","bindAppUser","VUserEditApps","userEditApps","editApp","onAppChanged","bindUserApp","onSearchFocus","divUser","addedPage","onAddApps","onContinueAddUser","CUsers","onAppUsers","loadAppUsers","onUserApps","loadUserApps","unitOneAppUsers","unitOneUserApps","unitAppEditUsers","unitUserEditApps","unitAddUser","unitAppUsers","unitUsers","CHome","startApp","loadCounts","cAppXAccount","loadAdminUnits","cHome","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode"],"mappings":"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","file":"static/js/main.4b0c696c.chunk.js","sourcesContent":["export * from './tool';\r\nexport * from './net';\r\nexport * from './components';\r\nexport * from './auth';\r\nexport * from './uq';\r\nexport * from './app';\r\nexport * from './vm';\r\n","export * from './navigo';\r\nexport * from './nav';\r\nexport * from './page';\r\nexport * from './schema';\r\nexport * from './form';\r\nexport * from './edit';\r\nexport * from '../res/res';\r\nexport * from './loading';\r\nexport * from './image';\r\nexport * from './resUploader';\r\nexport * from './list';\r\nexport * from './dropDownActions';\r\nexport * from './easyDate';\r\nexport * from './propGrid';\r\nexport * from './simple';\r\nexport * from './media';\r\nexport * from './searchBox';\r\nexport * from './userIcon';\r\nexport * from './ax';\r\nexport * from './autoHideTips';\r\nexport * from './login';","import { decodeGuestToken } from '../tool/user';\r\nimport { CenterApiBase } from './uqApi';\r\n\r\nexport class GuestApi extends CenterApiBase {\r\n    async guest(): Promise<any> {\r\n        //let guest = nav.local.guest.get();\r\n        let ret = await this.get('', {});\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeGuestToken(ret);\r\n            case 'object':\r\n                let guest = decodeGuestToken(ret.token);\r\n                return guest;\r\n        }\r\n    }\r\n\r\n    async unitFromName(unitName:string): Promise<number> {\r\n        let ret = await this.get(unitName);\r\n        return ret && ret.unit;\r\n    }\r\n}\r\n\r\nexport const guestApi = new GuestApi('tv/guest/', undefined);\r\n","export abstract class Caller<T> {\r\n    protected readonly _params: T;\r\n    constructor(params: T, waiting: boolean) {\r\n        this._params = params;\r\n        this.waiting = waiting;\r\n    }\r\n    protected get params():any {return this._params;}\r\n    buildParams():any {return this.params;}\r\n    method: string  = 'POST';\r\n    abstract get path(): string;\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    waiting: boolean;\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport _ from 'lodash';\r\nimport { User, Guest/*, UserInNav*/ } from '../tool/user';\r\nimport { Page } from './page/page';\r\nimport { netToken } from '../net/netToken';\r\nimport FetchErrorView, { SystemNotifyPage } from './fetchErrorView';\r\nimport { FetchError } from '../net/fetchError';\r\nimport { appUrl, setAppInFrame, getExHash, getExHashPos } from '../net/appBridge';\r\nimport { LocalData, env } from '../tool';\r\nimport { guestApi, logoutApis, setCenterUrl, setCenterToken, appInFrame, host, resUrlFromHost, messageHub } from '../net';\r\nimport { resOptions } from '../res/res';\r\nimport { Loading } from './loading';\r\nimport { Navigo, RouteFunc, Hooks, NamedRoute } from './navigo';\r\n\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport '../css/va-form.css';\r\nimport '../css/va.css';\r\nimport '../css/animation.css';\r\nimport { FA } from './simple';\r\nimport { userApi } from '../net';\r\nimport { ReloadPage, ConfirmReloadPage } from './reloadPage';\r\nimport { PageWebNav } from './page';\r\nimport { Login } from './login';\r\nimport { createLogin } from '../auth';\r\n\r\nconst regEx = new RegExp('Android|webOS|iPhone|iPad|' +\r\n    'BlackBerry|Windows Phone|' +\r\n    'Opera Mini|IEMobile|Mobile',\r\n    'i');\r\nconst isMobile = regEx.test(navigator.userAgent);\r\n\r\n/*\r\nexport const mobileHeaderStyle = isMobile? {\r\n    minHeight:  '3em'\r\n} : undefined;\r\n*/\r\n//const logo = require('../img/logo.svg');\r\nlet logMark: number;\r\nconst logs: string[] = [];\r\nexport type NavPage = (params: any) => Promise<void>;\r\n\r\nexport interface Props {\r\n    onLogined: (isUserLogin?: boolean) => Promise<void>;\r\n    notLogined?: () => Promise<void>;\r\n};\r\nlet stackKey = 1;\r\nexport interface StackItem {\r\n    key: number;\r\n    view: JSX.Element;\r\n    ceased: boolean;\r\n    confirmClose?: () => Promise<boolean>;\r\n    disposer?: () => void;\r\n}\r\nexport interface NavViewState {\r\n    stack: StackItem[];\r\n    wait: 0 | 1 | 2;\r\n    fetchError: FetchError\r\n}\r\n\r\nexport class NavView extends React.Component<Props, NavViewState> {\r\n    private stack: StackItem[];\r\n    private waitCount: number = 0;\r\n    private waitTimeHandler?: NodeJS.Timer;\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.stack = [];\r\n        this.state = {\r\n            stack: this.stack,\r\n            wait: 0,\r\n            fetchError: undefined\r\n        };\r\n        nav.set(this);\r\n    }\r\n    async componentDidMount() {\r\n        window.addEventListener('popstate', this.navBack);\r\n        //if (nav.isRouting === false) {\r\n        await nav.init();\r\n        //}\r\n        await nav.start();\r\n    }\r\n\r\n    get level(): number {\r\n        return this.stack.length;\r\n    }\r\n\r\n    startWait() {\r\n        if (this.waitCount === 0) {\r\n            this.setState({ wait: 1 });\r\n            this.waitTimeHandler = env.setTimeout(\r\n                'NavView.startWait',\r\n                () => {\r\n                    this.waitTimeHandler = undefined;\r\n                    this.setState({ wait: 2 });\r\n                },\r\n                1000) as NodeJS.Timer;\r\n        }\r\n        ++this.waitCount;\r\n        this.setState({\r\n            fetchError: undefined,\r\n        });\r\n    }\r\n\r\n    endWait() {\r\n        env.setTimeout(\r\n            undefined, //'NavView.endWait',\r\n            () => {\r\n                /*\r\n                this.setState({\r\n                    fetchError: undefined,\r\n                });*/\r\n                --this.waitCount;\r\n                if (this.waitCount === 0) {\r\n                    if (this.waitTimeHandler !== undefined) {\r\n                        env.clearTimeout(this.waitTimeHandler);\r\n                        this.waitTimeHandler = undefined;\r\n                    }\r\n                    this.setState({ wait: 0 });\r\n                }\r\n            }, 100);\r\n    }\r\n\r\n    async onError(fetchError: FetchError) {\r\n        let err = fetchError.error;\r\n        if (err !== undefined) {\r\n            if (err.unauthorized === true) {\r\n                await nav.showLogin(undefined);\r\n                //nav.navigateToLogin();\r\n                return;\r\n            }\r\n            switch (err.type) {\r\n                case 'unauthorized':\r\n                    await nav.showLogin(undefined);\r\n                    //nav.navigateToLogin();\r\n                    return;\r\n                case 'sheet-processing':\r\n                    nav.push(<SystemNotifyPage message=\"单据正在处理中。请重新操作！\" />);\r\n                    return;\r\n            }\r\n        }\r\n        this.setState({\r\n            fetchError: fetchError,\r\n        });\r\n    }\r\n\r\n    private upgradeUq = () => {\r\n        nav.start();\r\n    }\r\n\r\n    async showUpgradeUq(uq: string, version: number): Promise<void> {\r\n        this.show(<Page header={false}>\r\n            <div>\r\n                UQ升级了，请点击按钮升级 <br />\r\n                <small className=\"text-muted\">{uq} ver-{version}</small>\r\n                <button className=\"btn btn-primary\" onClick={this.upgradeUq}>升级</button>\r\n            </div>\r\n        </Page>)\r\n    }\r\n\r\n    show(view: JSX.Element, disposer?: () => void): number {\r\n        this.clear();\r\n        return this.push(view, disposer);\r\n    }\r\n\r\n    push(view: JSX.Element, disposer?: () => void): number {\r\n        this.removeCeased();\r\n        if (this.stack.length > 0) {\r\n            window.history.pushState('forward', null, null);\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key,\r\n            view: view,\r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        this.refresh();\r\n        //console.log('push: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    replace(view: JSX.Element, disposer?: () => void): number {\r\n        let item: StackItem = undefined;\r\n        let stack = this.stack;\r\n        if (stack.length > 0) {\r\n            item = stack.pop();\r\n            //this.popAndDispose();\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key,\r\n            view: view,\r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        if (item !== undefined) this.dispose(item.disposer);\r\n        this.refresh();\r\n        //console.log('replace: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    ceaseTop(level: number = 1) {\r\n        let p = this.stack.length - 1;\r\n        for (let i = 0; i < level; i++, p--) {\r\n            if (p < 0) break;\r\n            let item = this.stack[p];\r\n            item.ceased = true;\r\n        }\r\n    }\r\n\r\n    pop(level: number = 1) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        //console.log('pop start: %s pages level=%s', len, level);\r\n        if (level <= 0 || len <= 1) return;\r\n        if (len < level) level = len;\r\n        let backLevel = 0;\r\n        for (let i = 0; i < level; i++) {\r\n            if (stack.length === 0) break;\r\n            //stack.pop();\r\n            this.popAndDispose();\r\n            ++backLevel;\r\n        }\r\n        if (backLevel >= len) backLevel--;\r\n        this.refresh();\r\n        if (this.isHistoryBack !== true) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(backLevel);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n        //console.log('pop: %s pages', stack.length);\r\n    }\r\n\r\n    popTo(key: number) {\r\n        if (key === undefined) return;\r\n        if (this.stack.find(v => v.key === key) === undefined) return;\r\n        while (this.stack.length > 0) {\r\n            let len = this.stack.length;\r\n            let top = this.stack[len - 1];\r\n            if (top.key === key) break;\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    topKey(): number {\r\n        let len = this.stack.length;\r\n        if (len === 0) return undefined;\r\n        return this.stack[len - 1].key;\r\n    }\r\n\r\n    removeCeased() {\r\n        for (; ;) {\r\n            let p = this.stack.length - 1;\r\n            if (p < 0) break;\r\n            let top = this.stack[p];\r\n            if (top.ceased === false) break;\r\n            let item = this.stack.pop();\r\n            let { disposer } = item;\r\n            this.dispose(disposer);\r\n        }\r\n        this.refresh();\r\n    }\r\n\r\n    private popAndDispose() {\r\n        this.removeCeased();\r\n        let item = this.stack.pop();\r\n        if (item === undefined) return;\r\n        //if (nav.isRouting) {\r\n        //\twindow.history.back();\r\n        //}\r\n        let { disposer } = item;\r\n        this.dispose(disposer);\r\n        this.removeCeased();\r\n        return item;\r\n    }\r\n\r\n    private dispose(disposer: () => void) {\r\n        if (disposer === undefined) return;\r\n        let item = this.stack.find(v => v.disposer === disposer);\r\n        if (item === undefined) disposer();\r\n    }\r\n\r\n    clear() {\r\n        let len = this.stack.length;\r\n        while (this.stack.length > 0) this.popAndDispose();\r\n        //this.refresh();\r\n        if (len > 1) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(len-1);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n    }\r\n\r\n    regConfirmClose(confirmClose: () => Promise<boolean>) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        let top = stack[len - 1];\r\n        top.confirmClose = confirmClose;\r\n    }\r\n\r\n    private isHistoryBack: boolean = false;\r\n    navBack = () => {\r\n        //nav.log('backbutton pressed - nav level: ' + this.stack.length);\r\n        let tick = Date.now();\r\n        this.isHistoryBack = true;\r\n        this.back(true);\r\n        this.isHistoryBack = false;\r\n        console.log(`///\\\\\\\\ ${Date.now() - tick}ms backbutton pressed - nav level: ${this.stack.length}`);\r\n    }\r\n\r\n    back = async (confirm: boolean = true) => {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        if (len === 1) {\r\n            if (window.self !== window.top) {\r\n                window.top.postMessage({ type: 'pop-app' }, '*');\r\n            }\r\n            return;\r\n        }\r\n        let top = stack[len - 1];\r\n        if (confirm === true && top.confirmClose) {\r\n            if (await top.confirmClose() === true) this.pop();\r\n        }\r\n        else {\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    confirmBox(message?: string): boolean {\r\n        return window.confirm(message);\r\n    }\r\n    clearError = () => {\r\n        this.setState({ fetchError: undefined });\r\n    }\r\n    render() {\r\n        const { wait, fetchError } = this.state;\r\n        let { stack } = this.state;\r\n        let top = stack.length - 1;\r\n        let elWait = null, elError = null;\r\n        switch (wait) {\r\n            case 1:\r\n                elWait = <div className=\"va-wait va-wait1\">\r\n                </div>;\r\n                break;\r\n            case 2:\r\n                elWait = <div className=\"va-wait va-wait2\">\r\n                    <Loading />\r\n                </div>;\r\n                break;\r\n        }\r\n        if (fetchError)\r\n            elError = <FetchErrorView clearError={this.clearError} {...fetchError} />;\r\n        let test = nav.testing === true &&\r\n            <span className=\"cursor-pointer position-fixed\" style={{ top: 0, left: '0.2rem', zIndex: 90001 }}>\r\n                <FA className=\"text-warning\" name=\"info-circle\" />\r\n            </span>;\r\n        return <>\r\n            {stack.map((item, index) => {\r\n                let { key, view } = item;\r\n                return <div key={key} style={index < top ? { visibility: 'hidden', position: 'absolute' } : undefined}>\r\n                    {view}\r\n                </div>\r\n            })}\r\n            {elWait}\r\n            {elError}\r\n            {test}\r\n        </>;\r\n    }\r\n\r\n    private refresh() {\r\n        this.setState({ stack: this.stack });\r\n    }\r\n}\r\n\r\nexport interface NavSettings {\r\n    oem?: string;\r\n    loginTop?: JSX.Element;\r\n    privacy?: string;\r\n}\r\n\r\nexport class Nav {\r\n    private navView: NavView;\r\n    //private ws: WsBase;\r\n    private wsHost: string;\r\n    private local: LocalData = new LocalData();\r\n    private navigo: Navigo;\r\n    //isRouting: boolean = false;\r\n    navSettings: NavSettings;\r\n    @observable user: User/*InNav*/ = undefined;\r\n    testing: boolean;\r\n    language: string;\r\n    culture: string;\r\n    resUrl: string;\r\n\r\n    constructor() {\r\n        let { lang, district } = resOptions;\r\n        this.language = lang;\r\n        this.culture = district;\r\n        this.testing = false;\r\n    }\r\n\r\n    get guest(): number {\r\n        let guest = this.local.guest;\r\n        if (guest === undefined) return 0;\r\n        let g = guest.get();\r\n        if (g === undefined) return 0;\r\n        return g.guest;\r\n    }\r\n\r\n    set(navView: NavView) {\r\n        //this.logo = logo;\r\n        this.navView = navView;\r\n    }\r\n    /*\r\n    registerReceiveHandler(handler: (message:any)=>Promise<void>):number {\r\n        //if (this.ws === undefined) return;\r\n        return messageHub.onReceiveAny(handler);\r\n    }\r\n\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        //if (this.ws === undefined) return;\r\n        if (handlerId === undefined) return;\r\n        messageHub.endReceive(handlerId);\r\n    }\r\n    */\r\n    async onReceive(msg: any) {\r\n        //if (this.ws === undefined) return;\r\n        await messageHub.dispatch(msg);\r\n    }\r\n\r\n    private async loadUnitJson() {\r\n        try {\r\n            let unitJsonPath = this.unitJsonPath();\r\n            let unitRes = await fetch(unitJsonPath, {});\r\n            let res = await unitRes.json();\r\n            return res.unit;\r\n        }\r\n        catch (err1) {\r\n            this.local.unit.remove();\r\n            return;\r\n        }\r\n    }\r\n\r\n    private async getPredefinedUnitName() {\r\n        let el = document.getElementById('unit');\r\n        if (el) {\r\n            return el.innerText;\r\n        }\r\n        el = document.getElementById('unit.json');\r\n        if (!el) {\r\n            return await this.loadUnitJson();\r\n        }\r\n        try {\r\n            let json = el.innerHTML;\r\n            let res = JSON.parse(json);\r\n            return res.unit;\r\n        }\r\n        catch (err) {\r\n            return await this.loadUnitJson();\r\n        }\r\n    }\r\n\r\n    private async loadPredefinedUnit() {\r\n        let envUnit = process.env.REACT_APP_UNIT;\r\n        if (envUnit !== undefined) {\r\n            return Number(envUnit);\r\n        }\r\n        let unitName: string;\r\n        let unit = this.local.unit.get();\r\n        if (unit !== undefined) {\r\n            if (env.isDevelopment !== true) return unit.id;\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n            if (unit.name === unitName) return unit.id;\r\n        }\r\n        else {\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n        }\r\n        let unitId = await guestApi.unitFromName(unitName);\r\n        if (unitId !== undefined) {\r\n            this.local.unit.set({ id: unitId, name: unitName });\r\n        }\r\n        return unitId;\r\n    }\r\n\r\n    setSettings(settings?: NavSettings) {\r\n        this.navSettings = settings;\r\n    }\r\n\r\n    get oem(): string {\r\n        return this.navSettings && this.navSettings.oem;\r\n    }\r\n\r\n    hashParam: string;\r\n    private centerHost: string;\r\n    private arrs = ['/test', '/test/'];\r\n    private unitJsonPath(): string {\r\n        let { origin, pathname } = document.location;\r\n        pathname = pathname.toLowerCase();\r\n        for (let item of this.arrs) {\r\n            if (pathname.endsWith(item) === true) {\r\n                pathname = pathname.substr(0, pathname.length - item.length);\r\n                break;\r\n            }\r\n        }\r\n        if (pathname.endsWith('/') === true || pathname.endsWith('\\\\') === true) {\r\n            pathname = pathname.substr(0, pathname.length - 1);\r\n        }\r\n        return origin + pathname + '/unit.json';\r\n    }\r\n    private windowOnError = (event: Event | string, source?: string, lineno?: number, colno?: number, error?: Error) => {\r\n        debugger;\r\n        console.error('windowOnError');\r\n        console.error(error);\r\n    }\r\n    private windowOnUnhandledRejection = (ev: PromiseRejectionEvent) => {\r\n        debugger;\r\n        console.error('windowOnUnhandledRejection');\r\n        console.error(ev.reason);\r\n    }\r\n    private windowOnClick = (ev: MouseEvent) => {\r\n        console.error('windowOnClick');\r\n    }\r\n    private windowOnMouseMove = (ev: MouseEvent) => {\r\n        console.log('navigator.userAgent: ' + navigator.userAgent);\r\n        console.log('mouse move (%s, %s)', ev.x, ev.y);\r\n    }\r\n    private windowOnScroll = (ev: Event) => {\r\n        console.log('scroll event');\r\n    }\r\n\r\n    forceDevelopment: boolean;\r\n\r\n    async init() {\r\n        this.testing = env.testing;\r\n        if (this.forceDevelopment === true) {\r\n            env.isDevelopment = true;\r\n        }\r\n        await host.start(this.testing);\r\n        let hash = document.location.hash;\r\n        if (hash !== undefined && hash.length > 0) {\r\n            let pos = getExHashPos();\r\n            if (pos < 0) pos = undefined;\r\n            this.hashParam = hash.substring(1, pos);\r\n        }\r\n        let { url, ws, resHost } = host;\r\n        this.centerHost = url;\r\n        this.resUrl = resUrlFromHost(resHost);\r\n        this.wsHost = ws;\r\n        setCenterUrl(url);\r\n\r\n        let guest: Guest = this.local.guest.get();\r\n        if (guest === undefined) {\r\n            guest = await guestApi.guest();\r\n        }\r\n        if (!guest) {\r\n            debugger;\r\n            throw Error('guest can not be undefined');\r\n        }\r\n        nav.setGuest(guest);\r\n\r\n        let exHash = getExHash();\r\n        let appInFrame = setAppInFrame(exHash);\r\n        if (exHash !== undefined && window !== window.parent) {\r\n            // is in frame\r\n            if (appInFrame !== undefined) {\r\n                //this.ws = wsBridge;\r\n                console.log('this.ws = wsBridge in sub frame');\r\n                //nav.user = {id:0} as User;\r\n                if (window.self !== window.parent) {\r\n                    window.parent.postMessage({ type: 'sub-frame-started', hash: appInFrame.hash }, '*');\r\n                }\r\n                // 下面这一句，已经移到 appBridge.ts 里面的 initSubWin，也就是响应从main frame获得user之后开始。\r\n                //await this.showAppView();\r\n                return;\r\n            }\r\n        }\r\n\r\n        let predefinedUnit = await this.loadPredefinedUnit();\r\n        appInFrame.predefinedUnit = predefinedUnit;\r\n    }\r\n\r\n    async start() {\r\n        try {\r\n            window.onerror = this.windowOnError;\r\n            window.onunhandledrejection = this.windowOnUnhandledRejection;\r\n            //window.addEventListener('click', this.windowOnClick);\r\n            //window.addEventListener('mousemove', this.windowOnMouseMove);\r\n            //window.addEventListener('touchmove', this.windowOnMouseMove);\r\n            //window.addEventListener('scroll', this.windowOnScroll);\r\n            if (isMobile === true) {\r\n                document.onselectstart = function () { return false; }\r\n                document.oncontextmenu = function () { return false; }\r\n            }\r\n            //window.setInterval(()=>console.error('tick every 5 seconds'), 5000);\r\n            nav.clear();\r\n            //nav.onSysNavRoutes();\r\n            this.startWait();\r\n\r\n            let user: User = this.local.user.get();\r\n            if (user === undefined) {\r\n                let { notLogined } = this.navView.props;\r\n                if (notLogined !== undefined) {\r\n                    await notLogined();\r\n                }\r\n                else {\r\n                    await nav.showLogin(undefined);\r\n                    //nav.navigateToLogin();\r\n                }\r\n                return;\r\n            }\r\n\r\n            await nav.logined(user);\r\n        }\r\n        catch (err) {\r\n            console.error(err);\r\n            debugger;\r\n        }\r\n        finally {\r\n            this.endWait();\r\n        }\r\n    }\r\n\r\n    resolveRoute() {\r\n        //if (this.isRouting === false) return;\r\n        if (this.navigo === undefined) return;\r\n        this.navigo.resolve();\r\n    }\r\n\r\n    on(routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n    on(url: string, routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n    on(regex: RegExp, routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n    on(options: { [url: string]: RouteFunc | NamedRoute }): Navigo;\r\n    on(...args: any[]): Navigo {\r\n        if (this.navigo === undefined) {\r\n            this.navigo = new Navigo();\r\n            if (this.isWebNav !== true) this.navigo.historyAPIUpdateMethod('replaceState');\r\n        }\r\n        return this.navigo.on(args[0], args[1], args[2]);\r\n    }\r\n\r\n    private navLogin: NavPage = async (params: any) => {\r\n        nav.showLogin(async (user: User) => window.history.back(), false);\r\n    }\r\n\r\n    private navLogout: NavPage = async (params: any) => {\r\n        nav.showLogout(async () => window.history.back());\r\n    }\r\n\r\n    private navRegister: NavPage = async (params: any) => {\r\n        nav.showRegister();\r\n    }\r\n\r\n    private navForget: NavPage = async (params: any) => {\r\n        nav.showForget();\r\n    }\r\n\r\n    navigateToLogin() {\r\n        nav.navigate('/login');\r\n    }\r\n\r\n    openSysPage(url: string) {\r\n        let navPage: NavPage = this.sysRoutes[url];\r\n        if (navPage === undefined) {\r\n            alert(url + ' is not defined in sysRoutes');\r\n            return;\r\n        }\r\n        navPage(undefined);\r\n    }\r\n\r\n    private navPageRoutes: { [url: string]: NavPage };\r\n    private routeFromNavPage(navPage: NavPage) {\r\n        return (params: any, queryStr: any) => {\r\n            if (navPage) {\r\n                if (this.isWebNav) nav.clear();\r\n                navPage(params);\r\n            }\r\n        }\r\n    }\r\n    onNavRoute(navPage: NavPage) {\r\n        this.on(this.routeFromNavPage(navPage));\r\n    }\r\n    private doneSysRoutes: boolean = false;\r\n    private sysRoutes: { [route: string]: NavPage } = {\r\n        '/login': this.navLogin,\r\n        '/logout': this.navLogout,\r\n        '/register': this.navRegister,\r\n        '/forget': this.navForget,\r\n    }\r\n    /*\r\n    onSysNavRoutes() {\r\n        this.onNavRoutes(this.sysRoutes);\r\n    }\r\n    */\r\n    onNavRoutes(navPageRoutes: { [url: string]: NavPage }) {\r\n        if (this.doneSysRoutes === false) {\r\n            this.doneSysRoutes = true;\r\n            this.internalOnNavRoutes(this.sysRoutes);\r\n        }\r\n        this.internalOnNavRoutes(navPageRoutes);\r\n    }\r\n\r\n    private internalOnNavRoutes(navPageRoutes: { [url: string]: NavPage }) {\r\n        if (!navPageRoutes) return;\r\n        this.navPageRoutes = _.merge(this.navPageRoutes, navPageRoutes);\r\n        let navOns: { [route: string]: (params: any, queryStr: any) => void } = {};\r\n        for (let route in navPageRoutes) {\r\n            let navPage = navPageRoutes[route];\r\n            navOns[route] = this.routeFromNavPage(navPage);\r\n        }\r\n        this.on(navOns);\r\n    }\r\n\r\n    /*\r\n    get isWebNav():boolean { \r\n        if (!this.navigo) return false;\r\n        return !isMobile;\r\n    }\r\n    */\r\n    isWebNav: boolean = false;\r\n    backIcon = <i className=\"fa fa-angle-left\" />;\r\n    closeIcon = <i className=\"fa fa-close\" />;\r\n    setIsWebNav() {\r\n        this.isWebNav = true;\r\n        this.backIcon = <i className=\"fa fa-arrow-left\" />;\r\n        this.closeIcon = <i className=\"fa fa-close\" />;\r\n    }\r\n\r\n    pageWebNav: PageWebNav;\r\n\r\n    get isMobile(): boolean { return isMobile; }\r\n\r\n    navigate(url: string, absolute?: boolean) {\r\n        if (!this.navigo) {\r\n            alert('Is not in webnav state, cannot navigate to url \"' + url + '\"');\r\n            return;\r\n        }\r\n        if (this.testing === true) {\r\n            url += '#test';\r\n        }\r\n        return this.navigo.navigate(url, absolute);\r\n    }\r\n\r\n    go(showPage: () => void, url: string, absolute?: boolean) {\r\n        if (this.navigo !== undefined) {\r\n            this.navigate(url, absolute);\r\n        }\r\n        else {\r\n            showPage();\r\n        }\r\n    }\r\n\r\n    async showAppView(isUserLogin?: boolean) {\r\n        let { onLogined } = this.navView.props;\r\n        if (onLogined === undefined) {\r\n            nav.push(<div>NavView has no prop onLogined</div>);\r\n            return;\r\n        }\r\n        nav.clear();\r\n        await onLogined(isUserLogin);\r\n    }\r\n\r\n    setGuest(guest: Guest) {\r\n        this.local.guest.set(guest);\r\n        netToken.set(0, guest.token);\r\n    }\r\n\r\n    saveLocalUser() {\r\n        this.local.user.set(this.user);\r\n    }\r\n\r\n    userToken: string;\r\n\r\n    async loadMe() {\r\n        let me = await userApi.me();\r\n        this.user.icon = me.icon;\r\n        this.user.nick = me.nick;\r\n    }\r\n\r\n    private async internalLogined(user: User, callback: (user: User) => Promise<void>, isUserLogin: boolean) {\r\n        logoutApis();\r\n        console.log(\"logined: %s\", JSON.stringify(user));\r\n        this.user = user;\r\n        this.saveLocalUser();\r\n        this.userToken = user.token;\r\n        netToken.set(user.id, user.token);\r\n        nav.clear();\r\n\r\n        if (callback !== undefined) //this.loginCallbacks.has)\r\n            callback(user);\r\n        //this.loginCallbacks.call(user);\r\n        else if (this.isWebNav === true) {\r\n            this.navigate('/index');\r\n        }\r\n        else {\r\n            await this.showAppView(isUserLogin);\r\n        }\r\n    }\r\n\r\n    // 缓冲登录\r\n    async logined(user: User, callback?: (user: User) => Promise<void>) {\r\n        await this.internalLogined(user, callback, false);\r\n    }\r\n\r\n    // 用户操作之后登录\r\n    async userLogined(user: User, callback?: (user: User) => Promise<void>) {\r\n        await this.internalLogined(user, callback, true);\r\n    }\r\n\r\n    //wsConnect() {\r\n    //let ws:WSChannel = this.ws = new WSChannel(this.wsHost, this.user.token);\r\n    //ws.connect();\r\n    //}\r\n\r\n    loginTop(defaultTop: JSX.Element) {\r\n        return (this.navSettings && this.navSettings.loginTop) || defaultTop;\r\n    }\r\n\r\n    privacyEntry() {\r\n        if (!this.getPrivacyContent()) return;\r\n        return <div className=\"text-center\">\r\n            <button className=\"btn btn-sm btn-link\"\r\n                onClick={this.showPrivacyPage}>\r\n                <small className=\"text-muted\">隐私政策</small>\r\n            </button>\r\n        </div>;\r\n    }\r\n\r\n    private getPrivacyContent(): string {\r\n        if (!this.navSettings) return;\r\n        let { privacy } = this.navSettings;\r\n        return privacy;\r\n    }\r\n\r\n    showPrivacyPage = () => {\r\n        let privacy = this.getPrivacyContent();\r\n        if (privacy) {\r\n            this.privacyPage(privacy);\r\n        }\r\n        else {\r\n            nav.push(<Page header=\"隐私政策\">\r\n                <div className=\"p-3\">AppConfig 中没有定义 privacy。可以定义为字符串，或者url。markdown格式</div>\r\n            </Page>);\r\n        }\r\n    }\r\n\r\n    private privacyPage = async (htmlString: string) => {\r\n        //let html = await this.getPrivacy(privacy);\r\n        //let content = {__html: marked(html)};\r\n        let content = { __html: htmlString };\r\n        nav.push(<Page header=\"隐私政策\">\r\n            <div className=\"p-3\" dangerouslySetInnerHTML={content} />\r\n        </Page>);\r\n    }\r\n\r\n    private createLogin = createLogin;\r\n    setCreateLogin(createLogin: () => Promise<Login>) {\r\n        this.createLogin = createLogin;\r\n    }\r\n\r\n    private login: Login;\r\n    private async getLogin(): Promise<Login> {\r\n        if (this.login) return this.login;\r\n        return this.login = await this.createLogin();\r\n    }\r\n    async showLogin(callback?: (user: User) => Promise<void>, withBack?: boolean) {\r\n        let login = await this.getLogin();\r\n        login.showLogin(callback, withBack);\r\n    }\r\n\r\n    async showLogout(callback?: () => Promise<void>) {\r\n        let login = await this.getLogin();\r\n        login.showLogout(callback);\r\n    }\r\n\r\n    async showRegister() {\r\n        let login = await this.getLogin();\r\n        login.showRegister();\r\n    }\r\n\r\n    async showForget() {\r\n        let login = await this.getLogin();\r\n        login.showForget();\r\n    }\r\n\r\n    async logout(callback?: () => Promise<void>) { //notShowLogin?:boolean) {\r\n        appInFrame.unit = undefined;\r\n        this.local.logoutClear();\r\n        this.user = undefined; //{} as User;\r\n        logoutApis();\r\n        let guest = this.local.guest.get();\r\n        setCenterToken(0, guest && guest.token);\r\n        //this.ws = undefined;\r\n        this.clear();\r\n        if (callback === undefined)\r\n            await nav.start();\r\n        else\r\n            await callback();\r\n    }\r\n\r\n    async changePassword() {\r\n        let login = await this.getLogin();\r\n        login.showChangePassword();\r\n    }\r\n\r\n    get level(): number {\r\n        return this.navView.level;\r\n    }\r\n    startWait() {\r\n        this.navView?.startWait();\r\n    }\r\n    endWait() {\r\n        this.navView?.endWait();\r\n    }\r\n    async onError(error: FetchError) {\r\n        await this.navView.onError(error);\r\n    }\r\n    async showUpgradeUq(uq: string, version: number): Promise<void> {\r\n        await this.navView.showUpgradeUq(uq, version);\r\n    }\r\n\r\n    show(view: JSX.Element, disposer?: () => void): void {\r\n        this.navView.show(view, disposer);\r\n    }\r\n    push(view: JSX.Element, disposer?: () => void): void {\r\n        this.navView.push(view, disposer);\r\n    }\r\n    replace(view: JSX.Element, disposer?: () => void): void {\r\n        this.navView.replace(view, disposer);\r\n    }\r\n    pop(level: number = 1) {\r\n        this.navView.pop(level);\r\n    }\r\n    topKey(): number {\r\n        return this.navView.topKey();\r\n    }\r\n    popTo(key: number) {\r\n        this.navView.popTo(key);\r\n    }\r\n    clear() {\r\n        this.navView?.clear();\r\n    }\r\n    navBack() {\r\n        this.navView.navBack();\r\n    }\r\n    ceaseTop(level?: number) {\r\n        this.navView.ceaseTop(level);\r\n    }\r\n    removeCeased() {\r\n        this.navView.removeCeased();\r\n    }\r\n    async back(confirm: boolean = true) {\r\n        await this.navView.back(confirm);\r\n    }\r\n    regConfirmClose(confirmClose: () => Promise<boolean>) {\r\n        this.navView.regConfirmClose(confirmClose);\r\n    }\r\n    confirmBox(message?: string): boolean {\r\n        return this.navView.confirmBox(message);\r\n    }\r\n    async navToApp(url: string, unitId: number, apiId?: number, sheetType?: number, sheetId?: number): Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            let sheet = this.centerHost.includes('http://localhost:') === true ? 'sheet_debug' : 'sheet'\r\n            let uh = sheetId === undefined ?\r\n                appUrl(url, unitId) :\r\n                appUrl(url, unitId, sheet, [apiId, sheetType, sheetId]);\r\n            console.log('navToApp: %s', JSON.stringify(uh));\r\n            nav.push(<article className='app-container'>\r\n                <span id={uh.hash} onClick={() => this.back()} /*style={mobileHeaderStyle}*/>\r\n                    <i className=\"fa fa-arrow-left\" />\r\n                </span>\r\n                {\r\n                    // eslint-disable-next-line \r\n                    <iframe src={uh.url} title={String(sheetId)} />\r\n                }\r\n            </article>,\r\n                () => {\r\n                    resolve();\r\n                });\r\n        });\r\n    }\r\n\r\n    navToSite(url: string) {\r\n        // show in new window\r\n        window.open(url);\r\n    }\r\n\r\n    get logs() { return logs };\r\n    log(msg: string) {\r\n        logs.push(msg);\r\n    }\r\n    logMark() {\r\n        let date = new Date();\r\n        logMark = date.getTime();\r\n        logs.push('log-mark: ' + date.toTimeString());\r\n    }\r\n    logStep(step: string) {\r\n        logs.push(step + ': ' + (new Date().getTime() - logMark));\r\n    }\r\n\r\n    showReloadPage(msg: string) {\r\n        let seconds = -1;\r\n        this.push(<ReloadPage message={msg} seconds={seconds} />);\r\n        /*\r\n        if (seconds > 0) {\r\n            env.setTimeout(undefined, this.reload, seconds*1000);\r\n        }\r\n        */\r\n    }\r\n\r\n    reload = async () => {\r\n        let waiting: Promise<void> = new Promise<void>((resolve, reject) => {\r\n            setTimeout(resolve, 100);\r\n        });\r\n\r\n        if ('serviceWorker' in navigator) {\r\n            let registration = await Promise.race([waiting, navigator.serviceWorker.ready]);\r\n            if (registration) registration.unregister();\r\n        }\r\n        window.document.location.reload();\r\n        // dcloud hbuilder里面的app自动升级，需要清webview的缓存\r\n        let plus = (window as any).plus;\r\n        if (plus) {\r\n            let webview = plus.webview;\r\n            if (webview) {\r\n                if (webview.reload) webview.reload(true);\r\n            }\r\n            else {\r\n                let webView = plus.webView;\r\n                if (webView) {\r\n                    if (webView.reload) webView.reload(true);\r\n                }\r\n            }\r\n            //plus.webview.reload(true)\r\n        }\r\n    }\r\n\r\n    resetAll = () => {\r\n        this.push(<ConfirmReloadPage confirm={(ok: boolean): Promise<void> => {\r\n            if (ok === true) {\r\n                this.showReloadPage('彻底升级');\r\n                localStorage.clear();\r\n                /*\r\n                this.local.readToMemory();\r\n                env.localDb.removeAll();\r\n                this.local.saveToLocalStorage();\r\n                */\r\n            }\r\n            else {\r\n                this.pop();\r\n            }\r\n            return;\r\n        }} />);\r\n    }\r\n\r\n    async checkVersion(): Promise<string> {\r\n        let { href } = document.location;\r\n        href += (href.indexOf('?') >= 0 ? '&' : '?') + '_t_t_=' + new Date().getTime();\r\n        let ret = await fetch(href);\r\n        let r = await ret.text();\r\n        let parser = new DOMParser();\r\n        let htmlDoc = parser.parseFromString(r, 'text/html');\r\n        let elHtml = htmlDoc.getElementsByTagName('html');\r\n        let newVersion = elHtml[0].getAttribute('data-version');\r\n        return newVersion;\r\n    }\r\n}\r\nexport const nav: Nav = new Nav();\r\n\r\nexport class TonvaView extends NavView {\r\n\r\n}\r\n","\r\nimport {setCenterToken} from './uqApi';\r\nimport {WSChannel} from './wsChannel';\r\n\r\nexport const netToken = {\r\n    set(userId:number, token:string) {\r\n        setCenterToken(userId, token);\r\n        WSChannel.setCenterToken(token);\r\n    },\r\n    clear() {\r\n        setCenterToken(0, undefined);\r\n        WSChannel.setCenterToken(undefined);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport {FetchError} from '../net/fetchError';\r\nimport { refetchApi } from '../net';\r\nimport { Page } from './page/page';\r\n\r\nexport interface FetchErrorProps extends FetchError {\r\n    clearError: ()=>void\r\n}\r\n\r\nexport default class FetchErrorView extends React.Component<FetchErrorProps, null> {\r\n    private reApi = async () => {\r\n        this.props.clearError();\r\n        const {channel, url, options, resolve, reject} = this.props;\r\n        await refetchApi(channel, url, options, resolve, reject);\r\n    }\r\n    private close = async () => {\r\n        this.props.clearError();\r\n    }\r\n    render() {\r\n        let {error, url} = this.props;\r\n        let errContent:any;\r\n        if (typeof error === 'object') {\r\n            let err = [];\r\n            for (let i in error) {\r\n                err.push(<li key={i}><label>{i}</label><div style={{wordWrap:\"break-word\"}}>{error[i]}</div></li>);\r\n            }\r\n            errContent = <ul>{err}</ul>;\r\n        }\r\n        else {\r\n            errContent = <div>{error}</div>;\r\n        }\r\n        return <div>\r\n            <article>\r\n\t\t\t\t<main className=\"va-error\">\r\n\t\t\t\t\t<div>网络出现问题</div>\r\n\t\t\t\t\t<div>点击重新访问</div>\r\n\t\t\t\t\t<div style={{wordWrap:\"break-word\"}}>url: {url}</div>\r\n\t\t\t\t\t{errContent}\r\n\t\t\t\t\t<div className=\"p-3\">\r\n\t\t\t\t\t\t<button type='button' onClick={this.reApi}>重新API</button>\r\n\t\t\t\t\t\t<button type='button' onClick={this.close}>关闭</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</main>\r\n            </article>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport const SystemNotifyPage = ({message}:{message:string}):JSX.Element => {\r\n    return <Page header=\"系统提醒\">\r\n        <div className=\"px-3\">{message}</div>\r\n    </Page>;\r\n}","import * as React from 'react';\r\nimport { nav } from './nav';\r\nimport { Page } from './page/page';\r\n\r\ninterface Props {\r\n    message: string,\r\n    seconds: number\r\n}\r\n\r\ninterface State {\r\n    seconds: number\r\n}\r\n\r\nexport class ReloadPage extends React.Component<Props, State> {\r\n    private timerHandler: any;\r\n    constructor(props: Props) {\r\n        super(props);\r\n        let { seconds } = props;\r\n        if (seconds === undefined) return;\r\n        this.state = { seconds };\r\n        if (seconds <= 0) return;\r\n        this.timerHandler = setInterval(() => {\r\n            let { seconds } = this.state;\r\n            seconds--;\r\n            if (seconds <= 0) {\r\n                this.reload();\r\n            }\r\n            else {\r\n                this.setState({ seconds: seconds });\r\n            }\r\n        }, 1000);\r\n    }\r\n    private reload = () => {\r\n        clearInterval(this.timerHandler);\r\n        nav.reload();\r\n    }\r\n    render() {\r\n        let { seconds } = this.state;\r\n        let title: string, msg: string;\r\n        if (seconds > 0) {\r\n            title = '程序升级中...';\r\n            msg = this.state.seconds + '秒钟之后自动重启动';\r\n        }\r\n        else {\r\n            title = '程序需要升级';\r\n            msg = '请点击下面按钮重启';\r\n        }\r\n        return <Page header={false}>\r\n            <div className=\"text-center p-5\">\r\n                <div className=\"text-info py-5\">\r\n                    <span className=\"text-danger\">{title}</span>\r\n                    <br />\r\n                    {msg}\r\n                    <br />\r\n                    <span className=\"small text-muted\">{this.props.message}</span>\r\n                </div>\r\n                <button className=\"btn btn-danger\" onClick={this.reload}>立刻重启</button>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface ConfirmReloadPageProps {\r\n    confirm: (ok: boolean) => Promise<void>;\r\n}\r\nexport const ConfirmReloadPage = (props: ConfirmReloadPageProps): JSX.Element => {\r\n    return <Page header=\"升级软件\" back=\"close\">\r\n        <div className=\"py-5 px-3 my-5 mx-2 border bg-white rounded\">\r\n            <div className=\"text-center text-info\">\r\n                升级将清除所有本机缓冲区内容，并从服务器重新安装程序！\r\n            </div>\r\n            <div className=\"text-center mt-5\">\r\n                <button className=\"btn btn-danger me-3\" onClick={() => props.confirm(true)}>确认升级</button>\r\n            </div>\r\n        </div>\r\n    </Page>;\r\n    // <button className=\"btn btn-outline-danger\" onClick={()=>props.confirm(false)}>暂不</button>\r\n}\r\n","import {observable} from 'mobx';\r\n\r\nexport interface Id {\r\n    id: number;\r\n}\r\n\r\nexport abstract class CacheIds<T extends Id> {\r\n    constructor(maxCount:number = 100) {\r\n        this.maxCount = maxCount;\r\n    }\r\n    private maxCount:number;\r\n    private arr:T[] = [];\r\n    @observable dict = new Map<number, T>();\r\n\r\n    loadIds(ids:number[]) {\r\n        let arr:number[] = [];\r\n        for (let id of ids) {\r\n            if (id === null) continue;\r\n            let item = this.dict.get(id);\r\n            if (item === undefined) {\r\n                arr.push(id);\r\n                item = {id:id} as T;\r\n                this.dict.set(id, item);\r\n            }\r\n        }                \r\n        this.loadId(arr);\r\n    }\r\n\r\n    get(id:number):T {\r\n        if (id === undefined || id === null) return null;\r\n        let item = this.dict.get(id);\r\n        if (item === undefined) {\r\n            this.dict.set(id, {id:id} as T);\r\n            this.loadId([id]);\r\n            item = this.dict.get(id);\r\n        }\r\n        return item;\r\n    }\r\n    private setItem(id:number, item:T) {\r\n        if (item === undefined) {\r\n            this.dict.set(id, null);\r\n            this.arr.push({id: id} as T);\r\n        }\r\n        else {\r\n            this.dict.set(id, item);\r\n            this.arr.push(item);\r\n        }\r\n        if (this.arr.length > this.maxCount) {\r\n            item = this.arr.shift();\r\n            this.dict.delete(item.id);\r\n        }\r\n    }\r\n    private async loadId(ids:number[]) {\r\n        let items = await this._loadIds(ids);\r\n        if (items === undefined) {\r\n            for (let id of ids) {\r\n                if (id === null) continue;\r\n                let item = await this._loadId(id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n        else {\r\n            for (let id of ids) {\r\n                let item = items.find(v => v.id === id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected abstract _loadIds(ids:number[]):Promise<T[]>;\r\n    protected abstract _loadId(id:number):Promise<T>;\r\n}\r\n","import { env } from './env';\r\n\r\nexport class LocalData {\r\n    user = env.localDb.child('user');\r\n    guest = env.localDb.child('guest');\r\n    unit = env.localDb.child('unit');\r\n\r\n    private _user:string;\r\n    private _guest:string;\r\n    private _unit:string;\r\n    readToMemory() {\r\n        this._user = this.user.get();\r\n        this._guest = this.guest.get();\r\n        this._unit = this.unit.get();\r\n    }\r\n    saveToLocalStorage() {\r\n        this.user.set(this._user);\r\n        this.guest.set(this._guest);\r\n        this.unit.set(this._unit);\r\n    }\r\n\r\n    logoutClear() {\r\n        [\r\n            this.user,\r\n            this.unit,\r\n        ].forEach(d => d.remove());\r\n    }\r\n}\r\n","export function getObjPropIgnoreCase(obj:any, prop:string):any {\r\n\tif (!obj) return;\r\n\tif (!prop) return;\r\n\tlet keys = Object.keys(obj);\r\n\tprop = prop.toLowerCase();\r\n\tfor (let key of keys) {\r\n\t\tif (key.toLowerCase() === prop) return obj[key];\r\n\t}\r\n\treturn;\r\n}\r\n","\r\nexport const mobileRegex = /^[0-9]*$/;\r\nexport const emailRegex = /\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*/;\r\n// /^([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+\\.[a-zA-Z]{2,3}$/\r\n\r\nexport const EmailFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '电子邮件格式错误';\r\n}\r\n\r\nexport const MobileFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '手机格式错误';\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport { nav, Page, resOptions, PageHeaderProps, PageWebNav } from '../components';\r\nimport { User, env } from '../tool';\r\nimport { VPage } from './vpage';\r\nimport { View } from './view';\r\nimport { messageHub } from '../net';\r\n\r\nexport interface ConfirmOptions {\r\n    caption?: string;\r\n    message: string | JSX.Element;\r\n    classNames?: string;\r\n    ok?: string;\r\n    yes?: string;\r\n    no?: string;\r\n}\r\n\r\nexport interface WebNav<C extends Controller> {\r\n    VNavHeader?: new (controller: C) => View<C>;\r\n    VNavRawHeader?: new (controller: C) => View<C>;\r\n    VNavFooter?: new (controller: C) => View<C>;\r\n    VNavRawFooter?: new (controller: C) => View<C>;\r\n    renderPageHeader?: (props: PageHeaderProps) => JSX.Element;\r\n}\r\n\r\nexport abstract class Controller {\r\n    readonly res: any;\r\n    readonly x: any;\r\n    private _t: any = {};\r\n    readonly t: (str: string) => any;\r\n    icon: string | JSX.Element;\r\n    label: string;\r\n    readonly isDev: boolean = env.isDevelopment;\r\n    pageWebNav: PageWebNav;\r\n    get user(): User { return nav.user }\r\n    get isLogined(): boolean {\r\n        let { user } = nav;\r\n        if (user === undefined) return false;\r\n        return user.id > 0;\r\n    }\r\n    constructor(res: any) {\r\n        this.res = res || {};\r\n        this.x = this.res.x || {};\r\n        this.t = (str: string): any => this.internalT(str) || str;\r\n    }\r\n\r\n    protected beforeInit() { }\r\n    protected afterInit() { }\r\n\r\n    init(...param: any[]) {\r\n        this.beforeInit();\r\n        this.pageWebNav = this.getPageWebNav();\r\n        this.afterInit();\r\n    }\r\n\r\n    internalT(str: string): any {\r\n        return this._t[str];\r\n    }\r\n\r\n    get webNav(): WebNav<any> { return undefined; }\r\n\r\n    getWebNav(): WebNav<any> { return this.webNav; }\r\n\r\n    getPageWebNav(): PageWebNav { return undefined; }\r\n\r\n    get isWebNav(): boolean { return nav.isWebNav }\r\n    navigate(url: string) {\r\n        nav.navigate(url);\r\n    }\r\n\r\n    protected setRes(res: any) {\r\n        if (res === undefined) return;\r\n        let { $lang, $district } = resOptions;\r\n        _.merge(this._t, res);\r\n        if ($lang !== undefined) {\r\n            let l = res[$lang];\r\n            if (l !== undefined) {\r\n                _.merge(this._t, l);\r\n                let d = l[$district];\r\n                if (d !== undefined) {\r\n                    _.merge(this._t, d);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private receiveHandlerId: number;\r\n    //private disposer:()=>void;\r\n\r\n    protected dispose = () => {\r\n        // message listener的清理\r\n        //nav.unregisterReceiveHandler(this.receiveHandlerId);\r\n        messageHub.unregisterReceiveHandler(this.receiveHandlerId);\r\n        this.onDispose();\r\n    }\r\n\r\n    protected onDispose() {\r\n    }\r\n\r\n    //get isRouting() {return nav.isRouting;}\r\n\r\n    isMe(id: any): boolean {\r\n        if (id === null) return false;\r\n        let { user } = this;\r\n        let userId = user.id;\r\n        switch (typeof id) {\r\n            default: return false;\r\n            case 'string': return Number(id) === userId;\r\n            case 'number': return id === userId;\r\n            case 'object': return id.id === userId;\r\n        }\r\n    }\r\n\r\n    protected async openVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C) => P, param?: any, afterBack?: (ret: any) => void): Promise<P> {\r\n        let ret = new vp((this as any) as C);\r\n        await ret.open(param, afterBack);\r\n        return ret;\r\n    }\r\n\r\n    protected async replaceVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C) => P, param?: any, afterBack?: (ret: any) => void): Promise<P> {\r\n        let ret = new vp((this as any) as C);\r\n        await ret.replaceOpen(param, afterBack);\r\n        return ret;\r\n    }\r\n\r\n    protected renderView<C extends Controller, V extends View<C>>(view: new (controller: C) => V, param?: any): JSX.Element {\r\n        let v = new view((this as any) as C);\r\n        return v.render(param);\r\n    }\r\n\r\n    async event(type: string, value: any) {\r\n        await this.onEvent(type, value);\r\n    }\r\n\r\n    protected async onEvent(type: string, value: any) {\r\n    }\r\n\r\n    protected msg(text: string) {\r\n        alert(text);\r\n    }\r\n    protected errorPage(header: string, err: any) {\r\n        this.openPage(<Page header=\"App error!\">\r\n            <pre>\r\n                {typeof err === 'string' ? err : err.message}\r\n            </pre>\r\n        </Page>);\r\n    }\r\n\r\n    protected onMessage(message: any): Promise<void> {\r\n        return;\r\n    }\r\n\r\n    private onMessageReceive = async (message: any): Promise<void> => {\r\n        await this.onMessage(message);\r\n    }\r\n\r\n    protected async beforeStart(): Promise<boolean> {\r\n        /*\r\n        console.log('this.receiveHandlerId = nav.registerReceiveHandler(this.onMessageReceive);');\r\n        this.receiveHandlerId = nav.registerReceiveHandler(this.onMessageReceive);\r\n        console.log('return true');\r\n        */\r\n        return true;\r\n    }\r\n    protected async afterStart(): Promise<void> {\r\n    }\r\n    protected registerReceiveHandler() {\r\n        this.receiveHandlerId = messageHub.registerReceiveHandler(this.onMessageReceive);\r\n    }\r\n\r\n    protected abstract internalStart(param?: any, ...params: any[]): Promise<void>;\r\n    async start(param?: any, ...params: any[]): Promise<void> {\r\n        //this.disposer = this.dispose;\r\n        this.registerReceiveHandler();\r\n        let ret = await this.beforeStart();\r\n        if (ret === false) return;\r\n        await this.internalStart(param, ...params);\r\n        await this.afterStart();\r\n    }\r\n\r\n    get isCalling(): boolean { return this._resolve_$ !== undefined }\r\n\r\n    private _resolve_$: ((value: any) => void)[];\r\n    async call<T>(param?: any, ...params: any[]): Promise<T> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<T>(async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await this.start(param, ...params);\r\n        });\r\n    }\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C) => VPage<C>, param?: any): Promise<any> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await (new vp(this as any)).open(param);\r\n        });\r\n    }\r\n\r\n    returnCall(value: any) {\r\n        if (this._resolve_$ === undefined) return;\r\n        let resolve = this._resolve_$.pop();\r\n        if (resolve === undefined) {\r\n            alert('the Controller call already returned, or not called');\r\n            return;\r\n        }\r\n        resolve(value);\r\n    }\r\n\r\n    openPage(page: JSX.Element, onClosePage?: (ret: any) => void) {\r\n        let disposer: () => void;\r\n        if (onClosePage !== undefined) {\r\n            disposer = () => {\r\n                //if (this.disposer) this.disposer();\r\n                onClosePage(undefined);\r\n            }\r\n        }\r\n\r\n        nav.push(page, disposer);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    replacePage(page: JSX.Element, onClosePage?: () => void) {\r\n        nav.replace(page, onClosePage);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    backPage() {\r\n        nav.back();\r\n    }\r\n\r\n    closePage(level?: number) {\r\n        nav.pop(level);\r\n    }\r\n\r\n    ceasePage(level?: number) {\r\n        nav.ceaseTop(level);\r\n    }\r\n\r\n    go(showPage: () => void, url: string, absolute?: boolean) {\r\n        nav.go(showPage, url, absolute);\r\n    }\r\n\r\n    removeCeased() {\r\n        nav.removeCeased();\r\n    }\r\n\r\n    regConfirmClose(confirmClose: () => Promise<boolean>) {\r\n        nav.regConfirmClose(confirmClose);\r\n    }\r\n\r\n    private topPageKey: any;\r\n    protected startAction() {\r\n        this.topPageKey = nav.topKey();\r\n    }\r\n    get TopKey() {\r\n        return this.topPageKey;\r\n    }\r\n    SetTopKey(key: any) {\r\n        this.topPageKey = key;\r\n    }\r\n    public popToTopPage() {\r\n        nav.popTo(this.topPageKey);\r\n    }\r\n\r\n    async confirm(options: ConfirmOptions): Promise<'ok' | 'yes' | 'no' | undefined> {\r\n        return new Promise<'ok' | 'yes' | 'no' | undefined>(async (resolve, reject) => {\r\n            let { caption, message, ok, yes, no, classNames } = options;\r\n            let close = (res: 'ok' | 'yes' | 'no' | undefined) => {\r\n                this.closePage();\r\n                resolve(res);\r\n            }\r\n            let buttons: any[] = [];\r\n            if (ok !== undefined) {\r\n                buttons.push(<button key=\"ok\" className=\"btn btn-primary me-3\" onClick={() => close('ok')}>{ok}</button>);\r\n            }\r\n            if (yes !== undefined) {\r\n                buttons.push(<button key=\"yes\" className=\"btn btn-success me-3\" onClick={() => close('yes')}>{yes}</button>);\r\n            }\r\n            if (no !== undefined) {\r\n                buttons.push(<button key=\"no\" className=\"btn btn-outline-danger me-3\" onClick={() => close('no')}>{no}</button>);\r\n            }\r\n            this.openPage(<Page header={caption || '请确认'} back=\"close\">\r\n                <div className={classNames || \"rounded bg-white m-5 p-3 border\"}>\r\n                    <div className=\"d-flex align-items-center justify-content-center\">\r\n                        {message}\r\n                    </div>\r\n                    <div className=\"mt-3 d-flex align-items-center justify-content-center\">\r\n                        {buttons}\r\n                    </div>\r\n                </div>\r\n            </Page>);\r\n            nav.regConfirmClose(async (): Promise<boolean> => {\r\n                resolve(undefined);\r\n                return true;\r\n            });\r\n        });\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Page, Image, UserView } from '../components';\r\nimport { env, User } from '../tool';\r\nimport { Controller } from './controller';\r\nimport { VPage } from './vpage';\r\n\r\nexport abstract class View<C extends Controller> {\r\n    protected controller: C;\r\n    protected readonly res: any;\r\n    protected readonly x: any;\r\n    protected readonly t: (str: string) => any;\r\n\r\n    constructor(controller: C) {\r\n        this.controller = controller;\r\n        this.res = controller.res;\r\n        this.x = controller.x;\r\n        this.t = controller.t;\r\n    }\r\n\r\n    protected get isDev() { return env.isDevelopment }\r\n    get isWebNav(): boolean { return this.controller.isWebNav }\r\n    navigate(url: string) { this.controller.navigate(url) }\r\n    protected isMe(id: any) { return this.controller.isMe(id) }\r\n    abstract render(param?: any): JSX.Element;\r\n\r\n    protected renderVm(vm: new (controller: C) => View<C>, param?: any) {\r\n        return (new vm(this.controller)).render(param);\r\n    }\r\n\r\n    protected async openVPage(vp: new (controller: C) => VPage<C>, param?: any, afterBack?: () => Promise<void>): Promise<void> {\r\n        await (new vp(this.controller)).open(param, afterBack);\r\n    }\r\n\r\n    protected async event(type: string, value?: any) {\r\n        await this.controller.event(type, value);\r\n    }\r\n\r\n    protected go(showPage: () => void, url: string, absolute?: boolean) {\r\n        this.controller.go(showPage, url, absolute);\r\n    }\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C) => VPage<C>, param?: any): Promise<any> {\r\n        return await this.controller.vCall(vp, param);\r\n    }\r\n\r\n    protected returnCall(value: any) {\r\n        this.controller.returnCall(value);\r\n    }\r\n\r\n    protected renderUser(user: any, imageClassName?: string, textClassName?: string) {\r\n        let renderUser = (user: User) => {\r\n            let { name, nick, icon } = user;\r\n            return <>\r\n                <Image src={icon} className={imageClassName || 'w-1c h-1c me-2'} />\r\n                <span className={textClassName}>{nick || name}</span>\r\n            </>;\r\n        }\r\n        return <UserView user={user} render={renderUser} />\r\n    }\r\n\r\n    protected renderUserText(user: any) {\r\n        let renderUser = (user: User) => {\r\n            let { name, nick } = user;\r\n            return <>{nick || name}</>;\r\n        }\r\n        return <UserView user={user} render={renderUser} />\r\n    }\r\n\r\n    protected renderMe(imageClassName?: string, textClassName?: string) {\r\n        let { user } = this.controller;\r\n        if (!user) return;\r\n        return this.renderUser(user.id, imageClassName, textClassName);\r\n    }\r\n\r\n    protected openPage(view: React.StatelessComponent<any>, param?: any, onClosePage?: (ret: any) => void) {\r\n        let type = typeof param;\r\n        if (type === 'object' || type === 'undefined') {\r\n            this.controller.openPage(React.createElement(view, param), onClosePage);\r\n        }\r\n        else {\r\n            this.controller.openPage(<Page header=\"param type error\">\r\n                View.openPage param must be object, but here is {type}\r\n            </Page>, onClosePage);\r\n        }\r\n    }\r\n\r\n    protected replacePage(view: React.StatelessComponent<any>, param?: any) {\r\n        this.controller.replacePage(React.createElement(view, param));\r\n    }\r\n\r\n    protected openPageElement(page: JSX.Element, onClosePage?: () => void) {\r\n        this.controller.openPage(page, onClosePage);\r\n    }\r\n\r\n    protected replacePageElement(page: JSX.Element, onClosePage?: () => void) {\r\n        this.controller.replacePage(page, onClosePage);\r\n    }\r\n\r\n    protected backPage() {\r\n        this.controller.backPage();\r\n    }\r\n\r\n    protected closePage(level?: number) {\r\n        this.controller.closePage(level);\r\n    }\r\n\r\n    protected ceasePage(level?: number) {\r\n        this.controller.ceasePage(level);\r\n    }\r\n\r\n    protected removeCeased() {\r\n        this.controller.removeCeased();\r\n    }\r\n\r\n    protected regConfirmClose(confirmClose: () => Promise<boolean>) {\r\n        this.controller.regConfirmClose(confirmClose);\r\n    }\r\n\r\n    protected popToTopPage() {\r\n        this.controller.popToTopPage();\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Page, Scroller, TabsProps } from \"../components\";\r\nimport { View } from \"./view\";\r\nimport { Controller } from \"./controller\";\r\n\r\nexport abstract class VPage<C extends Controller> extends View<C> {\r\n\tprotected retOnClosePage: any;\r\n\r\n    open(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.openPageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n    replaceOpen(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.replacePageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n\trender(param?:any):JSX.Element {\r\n\t\tthis.init(param);\r\n\t\treturn this.renderPage();\r\n\t}\r\n\r\n\tinit(param?:any):void {return;}\r\n\r\n\theader():string|boolean|JSX.Element {return null;}\r\n\tright():JSX.Element {return null;}\r\n\tcontent():JSX.Element {return null;}\r\n\tfooter():JSX.Element {return null;}\r\n\tlogout(): boolean | (()=>Promise<void>) {return false;}\r\n\tprotected renderPage():JSX.Element {\r\n\t\tlet header = this.header();\r\n\t\tif (!header) header = false;\r\n\t\tlet logout = this.logout();\r\n\t\treturn <Page\r\n\t\t\theader={header} right={this.right()} footer={this.footer()}\r\n\t\t\tonScroll={(e:any)=>this.onPageScroll(e)}\r\n\t\t\tonScrollTop={(scroller: Scroller) => this.onPageScrollTop(scroller)}\r\n\t\t\tonScrollBottom={(scroller: Scroller) => this.onPageScrollBottom(scroller)}\r\n\t\t\tback={this.back}\r\n\t\t\theaderClassName={this.headerClassName}\r\n\t\t\tclassName={this.className}\r\n\t\t\tafterBack={()=>this.afterBack()}\r\n\t\t\ttabsProps={this.tabsProps}\r\n\t\t\tlogout={logout}\r\n\t\t\twebNav={this.controller.pageWebNav}\r\n\t\t>\r\n\t\t\t{this.content()}\r\n\t\t</Page>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {return;}\r\n\tprotected afterBack():void {}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'back'}\r\n\tprotected get headerClassName(): string {return null;}\r\n\tprotected get className(): string {return null;}\r\n\tprotected get tabsProps(): TabsProps {return null;}\r\n}\r\n","import React from 'react';\r\nimport _ from 'lodash';\r\nimport { FA, Page } from '../../components';\r\nimport { Controller } from \"../controller\";\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport interface CStringEditProps {\r\n\tlabel?: string;\r\n\tplaceholder?: string;\r\n\tmaxLength?: number;\r\n\tonValueChange?: (value: string) => Promise<void>;\r\n}\r\n\r\nexport class CStringEdit extends Controller {\r\n\tprivate props: CStringEditProps = {\r\n\t\tlabel: '编辑'\r\n\t}\r\n\t@observable value: string;\r\n\t@observable private newValue: string;\r\n\t@observable private isChanged: boolean;\r\n\t@observable private error: string;\r\n\r\n\tprotected async internalStart() { }\r\n\trender(value: string, props?: CStringEditProps) {\r\n\t\tthis.value = value;\r\n\t\tif (props) _.merge(this.props, props);\r\n\t\treturn React.createElement(observer(() => <>{this.renderValue()}{this.renderPencil()}</>))\r\n\t}\r\n\r\n\tprotected renderValue() { return <>{this.value}</> }\r\n\tprotected renderPencil() {\r\n\t\treturn <span onClick={this.onEdit} className=\"cursor-pointer\">\r\n\t\t\t&nbsp; <FA className=\"text-info\" name=\"pencil-square-o\" /> &nbsp;\r\n\t\t</span>;\r\n\t}\r\n\r\n\tprivate onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.newValue = evt.target.value;\r\n\t\tlet preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\r\n\tprivate onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.verifyValue();\r\n\t}\r\n\r\n\tprotected verifyValue() { }\r\n\r\n\tprivate onFocus = () => {\r\n\t\tthis.error = undefined;\r\n\t}\r\n\r\n\tprivate onEdit = () => {\r\n\t\tlet { label, maxLength, placeholder, onValueChange } = this.props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tthis.value = this.newValue;\r\n\t\t\t\tthis.closePage();\r\n\t\t\t\tif (onValueChange) onValueChange(this.value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet right = React.createElement(observer(() => <button\r\n\t\t\tclassName=\"btn btn-sm btn-success align-self-center me-2\"\r\n\t\t\tdisabled={!this.isChanged}\r\n\t\t\tonClick={onSave}>保存</button>));\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\t\tif (evt.keyCode === 13) onSave();\r\n\t\t}\r\n\t\tthis.openPage(<Page header={label} right={right}>\r\n\t\t\t<div className=\"m-3\">\r\n\t\t\t\t<input type=\"text\"\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n\t\t\t\t\tonBlur={this.onBlur}\r\n\t\t\t\t\tonFocus={this.onFocus}\r\n\t\t\t\t\tclassName=\"form-control\"\r\n\t\t\t\t\tdefaultValue={this.value}\r\n\t\t\t\t\tmaxLength={maxLength} />\r\n\t\t\t\t{\r\n\t\t\t\t\tReact.createElement(observer(() => placeholder && <div className=\"small muted m-2\">{placeholder}</div>))\r\n\t\t\t\t}\r\n\t\t\t\t{this.error && <div className=\"text-danger\">{this.error}</div>}\r\n\t\t\t</div>\r\n\t\t</Page>);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {PageHeaderProps, renderPageHeader} from './pageHeader';\r\nimport { TabsProps, TabsView } from './tabs';\r\nimport { ScrollProps, ScrollView, PageWebNav, WebNavScrollView } from './scrollView';\r\nimport { nav } from '../nav';\r\n\r\nexport interface IVPage {\r\n\tcontent():JSX.Element;\r\n\theader():JSX.Element|string;\r\n\tfooter():JSX.Element;\r\n}\r\n\r\nexport interface PageProps extends ScrollProps {\r\n    back?: 'close' | 'back' | 'none';\r\n    header?: boolean | string | JSX.Element;\r\n    right?: JSX.Element;\r\n    footer?: JSX.Element;\r\n    logout?: boolean | (()=>Promise<void>);\r\n\theaderClassName?: string;\r\n\tclassName?: string;\r\n\tafterBack?: () => void;\r\n\ttabsProps?: TabsProps;\r\n\twebNav?: PageWebNav;\r\n}\r\n\r\n@observer\r\nexport class Page extends React.Component<PageProps> {\r\n\tprivate tabsView: TabsView;\r\n    constructor(props: PageProps) {\r\n\t\tsuper(props);\r\n\t\tlet {tabsProps} = props;\r\n\t\tif (tabsProps) {\r\n\t\t\tthis.tabsView = new TabsView(tabsProps);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderHeader(webNav?: PageWebNav) {\r\n\t\tconst {back, header, right, headerClassName, afterBack, logout} = this.props;\r\n\t\tif (header === false) return;\r\n\t\t//const {webNav} = this.props;\r\n\t\tlet inWebNav = false;\r\n\t\tlet pageHeaderProps:PageHeaderProps = {\r\n\t\t\tback,\r\n\t\t\tcenter: header as any,\r\n\t\t\tright,\r\n\t\t\tlogout,\r\n\t\t\tclassName: headerClassName,\r\n\t\t\tafterBack,\r\n\t\t};\r\n\t\tif (webNav !== undefined) {\r\n\t\t\tinWebNav = true;\r\n\t\t\tlet {renderPageHeader: rph} = webNav;\r\n\t\t\tif (rph) return rph(pageHeaderProps);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinWebNav = false;\r\n\t\t}\r\n\t\treturn renderPageHeader(pageHeaderProps, inWebNav);\r\n\t\t/*\r\n\t\tlet pageHeader = header !== false && <PageHeader \r\n\t\t\tback={back} \r\n\t\t\tcenter={header as any}\r\n\t\t\tright={right}\r\n\t\t\tlogout={this.props.logout}\r\n\t\t\tclassName={headerClassName}\r\n\t\t\tafterBack={afterBack}\r\n\t\t\t/>;\r\n\t\treturn pageHeader;\r\n\t\t*/\r\n\t}\r\n\r\n\tprivate renderFooter(webNav?: PageWebNav) {\r\n\t\tconst {footer} = this.props;\r\n\t\tif (!footer) return;\r\n\t\tlet elFooter = <footer>{footer}</footer>;\r\n\t\tif (webNav) return elFooter;\r\n\t\treturn <>\r\n\t\t\t<section className=\"tv-page-footer\">{elFooter}</section>\r\n\t\t\t{elFooter}\r\n\t\t</>;\r\n\t}\r\n\r\n\tcomponentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n\t\t// You can also log the error to an error reporting service\r\n\t\t//logErrorToMyService(error, errorInfo);\r\n\t\tdebugger;\r\n\t}\r\n\t\r\n    render() {\r\n\t\tif (this.tabsView) {\r\n\t\t\treturn React.createElement(this.tabsView.content);\r\n\t\t}\r\n\t\tconst {onScroll, onScrollTop, onScrollBottom, children, className, webNav} = this.props;\r\n\t\tlet pageWebNav:PageWebNav;\r\n\t\tif (!webNav) {\r\n\t\t\tpageWebNav = nav.pageWebNav;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tpageWebNav = webNav;\r\n\t\t}\r\n\t\tlet content = <>\r\n\t\t\t{this.renderHeader(pageWebNav)}\r\n\t\t\t<main>{children}</main>\r\n\t\t\t{this.renderFooter(pageWebNav)}\r\n\t\t</>;\r\n\t\tif (pageWebNav) {\r\n\t\t\treturn <WebNavScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t\twebNav={pageWebNav}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</WebNavScrollView>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn <ScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</ScrollView>;\r\n\t\t}\r\n\t}\r\n}\r\n","import _ from 'lodash';\r\nimport {nav} from '../components';\r\nimport {uid} from '../tool/uid';\r\nimport {uqTokenApi, callCenterapi, centerToken, setCenterToken} from './uqApi';\r\nimport {setSubAppWindow} from './wsChannel';\r\nimport { host } from './host';\r\n\r\nexport interface UqToken {\r\n    name: string;\r\n    db: string;\r\n    url: string;\r\n    token: string;\r\n}\r\nconst uqTokens:{[uqName:string]: UqToken}  = {};\r\nexport function logoutUqTokens() {\r\n    for (let i in uqTokens) {\r\n        uqTokens[i] = undefined;\r\n    }\r\n}\r\n\r\nexport interface AppInFrame {\r\n    hash: string;\r\n    unit: number;       // unit id\r\n    page?: string;\r\n    param?: string[];\r\n    predefinedUnit?: number;  // 比如像Cart这样的应用，直接让用户访问的，就需要在unit.json里面定义unitName\r\n}\r\nconst appsInFrame:{[key:string]:AppInFrame} = {};\r\n\r\nclass AppInFrameClass implements AppInFrame {\r\n    hash: string;\r\n    private _unit: number;\r\n    get unit(): number {return this._unit;}       // unit id\r\n    set unit(val:number) { this._unit=val;}\r\n    page?: string;\r\n    param?: string[];\r\n}\r\n\r\nexport let appInFrame:AppInFrame = new AppInFrameClass();\r\n/* {\r\n    hash: undefined,\r\n    get unit():number {return } undefined, //debugUnitId,\r\n    page: undefined;\r\n    param: undefined,\r\n}*/\r\n\r\nexport function isBridged():boolean {\r\n    return window.self !== window.parent;\r\n}\r\n\r\nwindow.addEventListener('message', async function(evt) {\r\n    var message = evt.data;\r\n    switch (message.type) {\r\n        case 'sub-frame-started':\r\n            subFrameStarted(evt);\r\n            break;\r\n        case 'ws':\r\n            //wsBridge.receive(message.msg);\r\n            await nav.onReceive(message.msg);\r\n            break;\r\n        case 'init-sub-win':\r\n            await initSubWin(message);\r\n            break;\r\n        case 'pop-app':\r\n            window.console.log('///\\\\\\\\\\\\ pop-app');\r\n            nav.navBack();\r\n            break;\r\n        case 'center-api':\r\n            await callCenterApiFromMessage(evt.source as Window, message);\r\n            break;\r\n        case 'center-api-return':\r\n            bridgeCenterApiReturn(message);\r\n            break;\r\n        case 'app-api':\r\n            let ret = await onReceiveAppApiMessage(message.hash, message.apiName);\r\n            (evt.source as Window).postMessage({\r\n                type: 'app-api-return', \r\n                apiName: message.apiName,\r\n                db: ret.db,\r\n                url: ret.url,\r\n                token: ret.token} as any, \"*\");\r\n            break;\r\n        case 'app-api-return':\r\n            console.log(\"app-api-return: %s\", JSON.stringify(message));\r\n            console.log('await onAppApiReturn(message);');\r\n            await onAppApiReturn(message);\r\n            break;\r\n        default:\r\n\t\t\tif ((message.source as string)?.startsWith('react-devtools') === true) break;\r\n            window.console.log('message: %s', JSON.stringify(message));\r\n            break;\r\n    }\r\n});\r\n\r\nfunction subFrameStarted(evt:any) {\r\n    var message = evt.data;\r\n    let subWin = evt.source as Window;\r\n    setSubAppWindow(subWin);\r\n    hideFrameBack(message.hash);\r\n    let msg:any = _.clone(nav.user);\r\n    msg.type = 'init-sub-win';\r\n    subWin.postMessage(msg, '*');\r\n}\r\nfunction hideFrameBack(hash:string) {\r\n    let el = document.getElementById(hash);\r\n    if (el !== undefined) el.hidden = true;\r\n}\r\nasync function initSubWin(message:any) {\r\n    console.log('initSubWin: set nav.user', message);\r\n    let user = nav.user = message; // message.user;\r\n    setCenterToken(user.id, user.token);\r\n    await nav.showAppView();\r\n}\r\nasync function onReceiveAppApiMessage(hash: string, apiName: string): Promise<UqToken> {\r\n    let appInFrame = appsInFrame[hash];\r\n    if (appInFrame === undefined) return {name:apiName, db:undefined, url:undefined, token:undefined};\r\n    //let unit = getUnit();\r\n    let {unit, predefinedUnit} = appInFrame;\r\n    unit = unit || predefinedUnit;\r\n    if (!unit) {\r\n        console.error('no unit defined in unit.json or in index.html, or not logined in', unit);\r\n    }\r\n    let parts = apiName.split('/');\r\n    let param = {unit: unit, uqOwner: parts[0], uqName: parts[1], appOwner: parts[2], appName:parts[3]};\r\n    console.log('uqTokenApi.uq onReceiveAppApiMessage', param);\r\n    let ret = await uqTokenApi.uq(param);\r\n    let {db, url, token} = ret;\r\n    return {name: apiName, db:db, url: url, token: token};\r\n}\r\n\r\nasync function onAppApiReturn(message:any) {\r\n    let {apiName, db, url, urlTest, token} = message;\r\n    let action = uqTokenActions[apiName];\r\n    if (action === undefined) {\r\n        throw new Error('error app api return');\r\n        //return;\r\n    }\r\n    let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n    console.log('onAppApiReturn(message:any): url=' + url + ', real=' + realUrl);\r\n    //action.url = realUrl;\r\n    //action.token = token;\r\n    action.resolve({\r\n        name: apiName,\r\n        db: db,\r\n        url: realUrl,\r\n        token: token,\r\n    } as UqToken);\r\n}\r\n\r\nexport function setAppInFrame(appHash: string):AppInFrame {\r\n    if (appHash) {\r\n        let parts = appHash.split('-');\r\n        let len = parts.length;\r\n        if (len > 0) {\r\n            let p = 1;\r\n            appInFrame.hash = parts[p++];\r\n            if (len>0) appInFrame.unit = Number(parts[p++]);\r\n            if (len>1) appInFrame.page = parts[p++];\r\n            if (len>2) appInFrame.param = parts.slice(p++);\r\n        }\r\n    }\r\n    return appInFrame;\r\n}\r\n\r\nexport function getExHashPos():number {\r\n    let hash = document.location.hash;\r\n    if (hash !== undefined && hash.length > 0) {\r\n        let pos = hash.lastIndexOf('#tv-');\r\n        if (pos < 0) pos = hash.lastIndexOf('#tvdebug-');\r\n        return pos;\r\n    }\r\n    return -1;\r\n}\r\n\r\nexport function getExHash():string {\r\n    let pos = getExHashPos();\r\n    if (pos < 0) return undefined;\r\n    return document.location.hash.substring(pos);\r\n}\r\n\r\nexport function appUrl(url: string, unitId: number, page?:string, param?:any[]):{url:string; hash:string} {\r\n    let u:string;\r\n    for (;;) {\r\n        u = uid();\r\n        let a = appsInFrame[u];\r\n        if (a === undefined) {\r\n            appsInFrame[u] = {hash:u, unit:unitId};\r\n            break;\r\n        }\r\n    }\r\n    url += '#tv-' + u + '-' + unitId;\r\n    if (page !== undefined) {\r\n        url += '-' + page;\r\n        if (param !== undefined) {\r\n            for (let i=0; i<param.length; i++) {\r\n                url += '-' + param[i];\r\n            }\r\n        }\r\n    }\r\n    return {url: url, hash: u};\r\n}\r\n\r\nfunction getUnit():number {\r\n\tlet {unit, predefinedUnit} = appInFrame;\r\n    let realUnit = unit || predefinedUnit;\r\n    if (realUnit === undefined) {\r\n        throw new Error('no unit defined in unit.json or not logined in');\r\n\t}\r\n    return realUnit;\r\n}\r\n\r\ninterface UqTokenAction {\r\n    resolve: (value?: UqToken | PromiseLike<UqToken>) => void;\r\n    reject: (reason?: any) => void;\r\n}\r\nconst uqTokenActions:{[uq:string]: UqTokenAction} = {};\r\nexport async function buildAppUq(uq:string, uqOwner:string, uqName:string, appOwner:string, appName:string):Promise<void> {\r\n    if (!isBridged()) {\r\n        let unit = getUnit();\r\n        let uqToken = await uqTokenApi.uq({unit,  uqOwner, uqName, appOwner, appName});\r\n        if (uqToken.token === undefined) uqToken.token = centerToken;\r\n        let {db, url, urlTest} = uqToken;\r\n        let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n        console.log('realUrl: %s', realUrl);\r\n        uqToken.url = realUrl;\r\n        uqTokens[uq] = uqToken;\r\n        return uqToken;\r\n    }\r\n    console.log(\"**** before buildAppUq ****\", appInFrame);\r\n    let bp = uqTokenActions[uq];\r\n    if (bp !== undefined) return;\r\n    return new Promise<void>((resolve, reject) => {\r\n        uqTokenActions[uq] = {\r\n            resolve: async (at:any) => {\r\n                let {db, url, token} = await at;\r\n                uqTokens[uq] = {\r\n                    name: uq,\r\n                    db: db,\r\n                    url: url,\r\n                    token: token,\r\n                };\r\n                uqTokenActions[uq] = undefined;\r\n                console.log(\"**** after buildAppUq ****\", appInFrame);\r\n                resolve();\r\n            },\r\n            reject: reject,\r\n        };\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'app-api',\r\n            apiName: uq,\r\n            hash: appInFrame.hash,\r\n        }, \"*\");\r\n    });\r\n}\r\n\r\nexport function appUq(uq:string):UqToken {\r\n    let uts = uqTokens;\r\n    return uts[uq];\r\n}\r\n\r\ninterface BridgeCenterApi {\r\n    id: string;\r\n    resolve: (value?:any)=>any;\r\n    reject: (reason?:any)=>void;\r\n}\r\nconst brideCenterApis:{[id:string]: BridgeCenterApi} = {};\r\nexport async function bridgeCenterApi(url:string, method:string, body:any):Promise<any> {\r\n    console.log('bridgeCenterApi: url=%s, method=%s', url, method);\r\n    return await new Promise<any>(async (resolve, reject) => {\r\n        let callId:string;\r\n        for (;;) {\r\n            callId = uid();\r\n            let bca = brideCenterApis[callId];\r\n            if (bca === undefined) {\r\n                brideCenterApis[callId] = {\r\n                    id: callId,\r\n                    resolve: resolve,\r\n                    reject: reject,\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'center-api',\r\n            callId: callId,\r\n            url: url,\r\n            method: method,\r\n            body: body\r\n        }, '*');\r\n    });\r\n}\r\n\r\nasync function callCenterApiFromMessage(from:Window, message:any):Promise<void> {\r\n    let {callId, url, method, body} = message;\r\n    let result = await callCenterapi.directCall(url, method, body);\r\n    from.postMessage({\r\n        type: 'center-api-return',\r\n        callId: callId,\r\n        result: result,\r\n    }, '*');\r\n}\r\n\r\nfunction bridgeCenterApiReturn(message:any) {\r\n    let {callId, result} = message;\r\n    let bca = brideCenterApis[callId];\r\n    if (bca === undefined) return;\r\n    brideCenterApis[callId] = undefined;\r\n    bca.resolve(result);\r\n}\r\n","import { UqApi } from '../net';\r\nimport { LocalCache } from '../tool';\r\nimport { UqMan, Field, ArrFields, FieldMap } from './uqMan';\r\nimport { Tuid } from './tuid';\r\nimport { getObjPropIgnoreCase } from '../tool';\r\n\r\nconst tab = '\\t';\r\nconst ln = '\\n';\r\nconst chars = '\\\\ntbfvr';\r\nconst codeBackSlash = chars.charCodeAt(0);\r\nconst codeN = chars.charCodeAt(1);\r\nconst codeT = chars.charCodeAt(2);\r\nconst codeB = chars.charCodeAt(3);\r\nconst codeF = chars.charCodeAt(4);\r\nconst codeV = chars.charCodeAt(5);\r\nconst codeR = chars.charCodeAt(6);\r\n\r\nconst codes = '\\n\\t\\b\\f\\v\\r';\r\nconst codeBN = codes.charCodeAt(0);\r\nconst codeBT = codes.charCodeAt(1);\r\nconst codeBB = codes.charCodeAt(2);\r\nconst codeBF = codes.charCodeAt(3);\r\nconst codeBV = codes.charCodeAt(4);\r\nconst codeBR = codes.charCodeAt(5);\r\n\r\nexport abstract class Entity {\r\n    private jName: string;\r\n    schema: any;\r\n    ver: number = 0;\r\n    sys?: boolean;\r\n    readonly uq: UqMan;\r\n    readonly name: string;\r\n    readonly typeId: number;\r\n    readonly cache: LocalCache;\r\n    readonly uqApi: UqApi;\r\n    abstract get typeName(): string;\r\n    get sName():string {return this.jName || this.name}\r\n    fields: Field[];\r\n    arrFields: ArrFields[];\r\n    returns: ArrFields[];\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        this.uq = uq;\r\n        this.name = name;\r\n        this.typeId = typeId;\r\n        this.sys = this.name.indexOf('$') >= 0;\r\n        this.cache = this.uq.localMap.item(this.name); // new EntityCache(this);\r\n        this.uqApi = this.uq.uqApi;\r\n    }\r\n\r\n    public face: any;           // 对应字段的label, placeHolder等等的中文，或者语言的翻译\r\n\r\n    //getApiFrom() {return this.entities.uqApi;}\r\n\r\n    private fieldMaps: {[arr:string]: FieldMap} = {};\r\n    fieldMap(arr?:string): FieldMap {\r\n        if (arr === undefined) arr = '$';\r\n        let ret = this.fieldMaps[arr];\r\n        if (ret === undefined) {\r\n            let fields:Field[];\r\n            if (arr === '$') fields = this.fields;\r\n            else if (this.arrFields !== undefined) {\r\n                let arrFields = this.arrFields.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            else if (this.returns !== undefined) {\r\n                let arrFields = this.returns.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            if (fields === undefined) return {};\r\n            ret = {};\r\n            for (let f of fields) ret[f.name] = f;\r\n            this.fieldMaps[arr] = ret;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public async loadSchema():Promise<void> {\r\n        if (this.schema !== undefined) return;\r\n        let schema = this.cache.get();\r\n        if (!schema) {\r\n            schema = await this.uq.loadEntitySchema(this.name);\r\n        }\r\n        //this.setSchema(schema);\r\n\t\t//this.buildFieldsTuid();\r\n\t\tthis.buildSchema(schema);\r\n\t\tawait this.loadValues();\r\n\t}\r\n\r\n\tbuildSchema(schema: any) {\r\n        this.setSchema(schema);\r\n\t\tthis.buildFieldsTuid();\r\n\t\t//await this.loadValues();\r\n\t}\r\n\t\r\n\tprotected async loadValues():Promise<any> {}\r\n\r\n    // 如果要在setSchema里面保存cache，必须先调用clearSchema\r\n    public clearSchema() {\r\n        this.schema = undefined;\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        if (schema === undefined) return;\r\n        let {name, version} = schema;\r\n        this.ver = version || 0;\r\n\t\tthis.setJName(name);\r\n        this.cache.set(schema);\r\n\t\tthis.schema = schema;\r\n\t\tthis.buildFieldsTuid();\r\n\t}\r\n\t\r\n\tprotected setJName(name:string) {\r\n        if (name !== this.name) this.jName = name;\r\n\t}\r\n\r\n    public buildFieldsTuid() {\r\n        let {fields, arrs, returns} = this.schema;\r\n        this.uq.buildFieldTuid(this.fields = fields);\r\n        this.uq.buildArrFieldsTuid(this.arrFields = arrs, fields);\r\n        this.uq.buildArrFieldsTuid(this.returns = returns, fields);\r\n    }\r\n\r\n    schemaStringify():string {\r\n        return JSON.stringify(this.schema, (key:string, value:any) => {\r\n            if (key === '_tuid') return undefined;\r\n            return value;\r\n        }, 4);\r\n    }\r\n\r\n    tuidFromName(fieldName:string, arrName?:string):Tuid {\r\n        if (this.schema === undefined) return;\r\n        let {fields, arrs} = this.schema;\r\n        let entities = this.uq;\r\n        function getTuid(fn:string, fieldArr:Field[]) {\r\n            if (fieldArr === undefined) return;\r\n            let f = fieldArr.find(v => v.name === fn);\r\n            if (f === undefined) return;\r\n            return entities.getTuid(f.tuid);\r\n        }\r\n        let fn = fieldName.toLowerCase();\r\n        if (arrName === undefined) return getTuid(fn, fields);\r\n        if (arrs === undefined) return;\r\n        let an = arrName.toLowerCase();\r\n        let arr = (arrs as ArrFields[]).find(v => v.name === an);\r\n        if (arr === undefined) return;\r\n        return getTuid(fn, arr.fields);\r\n    }\r\n\r\n    buildParams(params:any):any {\r\n        let result:any = {};\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.buildFieldsParams(result, fields, params);\r\n        let arrs = this.arrFields;\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let {name, fields} = arr;\r\n                let paramsArr:any[] = params[name];\r\n                if (paramsArr === undefined) continue;\r\n                let arrResult:any[] = [];\r\n                result[name] = arrResult;\r\n                for (let pa of params) {\r\n                    let rowResult = {};\r\n                    this.buildFieldsParams(rowResult, fields, pa);\r\n                    arrResult.push(rowResult);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private buildFieldsParams(result:any, fields:Field[], params:any) {\r\n        for (let field of fields) {\r\n            let {name, type} = field;            \r\n            let d = params[name];\r\n            let val:any;\r\n            switch (type) {\r\n\t\t\t\tcase 'datetime':\r\n                \tval = this.buildDateTimeParam(d);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'date':\r\n\t\t\t\t\tif (d instanceof Date) {\r\n\t\t\t\t\t\tval = `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tval = d;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tswitch (typeof d) {\r\n\t\t\t\t\t\tdefault: val = d; break;\r\n\t\t\t\t\t\tcase 'object':\r\n\t\t\t\t\t\t\tif (d instanceof Date) {\r\n\t\t\t\t\t\t\t\tval = d;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlet tuid = field._tuid;\r\n\t\t\t\t\t\t\tif (tuid === undefined) val = d.id;\r\n\t\t\t\t\t\t\telse val = tuid.getIdFromObj(d);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n            }\r\n            result[name] = val;\r\n        }\r\n    }\r\n\r\n    buildDateTimeParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return undefined;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'string':\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        return Math.floor(dt.getTime()/1000);\r\n    }\r\n\r\n    buildDateParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return '';\r\n            case 'string': return val;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        let ret = dt.toISOString();\r\n        let p = ret.indexOf('T');\r\n        return p>0? ret.substr(0, p) : ret;\r\n    }\r\n\r\n    pack(data:any):string {\r\n        let ret:string[] = [];\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.packRow(ret, fields, data);\r\n        let arrs = this.arrFields; \r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n\t\t\t\tlet {name, fields} = arr;\r\n\t\t\t\tlet arrData = getObjPropIgnoreCase(data, name);\r\n\t\t\t\t//if (!arrData) arrData = data[name.toLowerCase()];\r\n                this.packArr(ret, fields, arrData);\r\n            }\r\n        }\r\n        return ret.join('');\r\n    }\r\n\r\n    private escape(row:any, field:Field):any {\r\n        let d = row[field.name];\r\n        switch (field.type) {\r\n            case 'datetime':\r\n                return this.buildDateTimeParam(d);\r\n            default:\r\n                switch (typeof d) {\r\n                    default: return d;\r\n                    case 'object':\r\n                        let tuid = field._tuid;\r\n                        if (tuid === undefined) return d.id;\r\n                        return tuid.getIdFromObj(d);\r\n                    case 'string':\r\n                        let len = d.length;\r\n                        let r = '', p = 0;\r\n                        for (let i=0;i<len;i++) {\r\n                            let c:number = d.charCodeAt(i), ch:string;\r\n                            switch(c) {\r\n\t\t\t\t\t\t\t\tdefault: continue;\r\n\t\t\t\t\t\t\t\tcase codeBackSlash: ch = '\\\\\\\\'; break;\r\n                                case codeBT: ch = '\\\\t'; break;\r\n\t\t\t\t\t\t\t\tcase codeBN: ch = '\\\\n'; break;\r\n\t\t\t\t\t\t\t\tcase codeBF: ch = '\\\\f'; break;\r\n\t\t\t\t\t\t\t\tcase codeBV: ch = '\\\\v'; break;\r\n\t\t\t\t\t\t\t\tcase codeBB: ch = '\\\\b'; break;\r\n\t\t\t\t\t\t\t\tcase codeBR: ch = '\\\\r'; break;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tr += d.substring(p, i) + ch;\r\n\t\t\t\t\t\t\tp = i+1;\r\n                        }\r\n                        return r + d.substring(p);\r\n                    case 'undefined': return '';\r\n                }\r\n        }\r\n    }\r\n\r\n    private packRow(result:string[], fields:Field[], data:any) {\r\n        let len = fields.length;\r\n        if (len === 0) return;\r\n        let ret = '';\r\n        ret += this.escape(data, fields[0]);\r\n        for (let i=1;i<len;i++) {\r\n            let f = fields[i];\r\n            ret += tab + this.escape(data, f);\r\n        }\r\n        result.push(ret + ln);\r\n    }\r\n\r\n    private packArr(result:string[], fields:Field[], data:any[]) {\r\n        if (data !== undefined) {\r\n\t\t\tif (data.length === 0) {\r\n\t\t\t\tresult.push(ln);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (let row of data) {\r\n\t\t\t\t\tthis.packRow(result, fields, row);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tresult.push(ln);\r\n\t\t}\r\n        result.push(ln);\r\n    }\r\n    protected cacheFieldsInValue(values:any, fields:Field[]) {\r\n        for (let f of fields as Field[]) {\r\n            let {name, _tuid} = f;\r\n            if (_tuid === undefined) continue;\r\n            let id = values[name];\r\n            //_tuid.useId(id);\r\n            values[name] = _tuid.boxId(id);\r\n        }\r\n    }\r\n\r\n    protected unpackTuidIdsOfFields(values:string[], fields: Field[]):any[] {\r\n        if (fields === undefined) return values as any[];\r\n        //if (this.fields === undefined) return values as any[];\r\n        let ret:any[] = []\r\n        for (let ln of values) {\r\n            if (!ln) continue;\r\n            let len = ln.length;\r\n            let p = 0;\r\n            while (p<len) {\r\n                let ch = ln.charCodeAt(p);\r\n                if (ch === 10) {\r\n                    ++p;\r\n                    break;\r\n                }\r\n                let row = {};\r\n                p = this.unpackRow(row, fields, ln, p);\r\n                ret.push(row);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    unpackSheet(data:string):any {\r\n        let ret = {} as any; //new this.newMain();\r\n        //if (schema === undefined || data === undefined) return;\r\n        let fields = this.fields;\r\n        let p = 0;\r\n        if (fields !== undefined) p = this.unpackRow(ret, fields, data, p);\r\n        let arrs = this.arrFields; //schema['arrs'];\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                p = this.unpackArr(ret, arr, data, p);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n\tunpackReturns(data:string, returns?:ArrFields[]):{[name:string]:any[]} {\r\n\t\tif (data === undefined) debugger;\r\n\t\tlet ret = {} as any;\r\n\t\tlet p = 0;\r\n\t\tlet arrs = returns || this.returns;\r\n\t\tif (arrs !== undefined) {\r\n\t\t\tfor (let arr of arrs) {\r\n\t\t\t\tp = this.unpackArr(ret, arr, data, p);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n    protected unpackRow(ret:any, fields:Field[], data:string, p:number):number {\r\n        let ch0 = 0, ch = 0, c = p, i = 0, len = data.length, fLen = fields.length;\r\n        for (;p<len;p++) {\r\n            ch0 = ch;\r\n            ch = data.charCodeAt(p);\r\n            if (ch === 9) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                c = p+1;\r\n                ++i;\r\n                if (i>=fLen) {\r\n                    p = data.indexOf('\\n', c);\r\n                    if (p >= 0) ++p;\r\n                    else p = len;\r\n                    return p;\r\n                }\r\n            }\r\n            else if (ch === 10) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                ++p;\r\n                ++i;\r\n                return p;\r\n            }\r\n        }\r\n        let f = fields[i];\r\n        let {name} = f;\r\n        if (ch0 !== 8) {\r\n            let v = data.substring(c);\r\n            ret[name] = this.to(ret, v, f);\r\n        }\r\n        return len;\r\n    }\r\n\r\n    private to(ret:any, v:string, f:Field):any {\r\n        switch (f.type) {\r\n\t\t\tdefault: return v;\r\n\t\t\tcase 'text':\r\n\t\t\tcase 'char':\r\n\t\t\t\treturn this.reverseNT(v);\r\n            case 'datetime':\r\n            case 'time':\r\n\t\t\tcase 'timestamp':\r\n                let n = Number(v);\r\n                let date = isNaN(n) === true? new Date(v) : new Date(n*1000);\r\n                return date;\r\n            case 'date':\r\n                let parts = v.split('-');\r\n                return new Date(Number(parts[0]), Number(parts[1])-1, Number(parts[2]));\r\n            case 'tinyint':\r\n            case 'smallint':\r\n            case 'int':\r\n            case 'bigint':\r\n            case 'dec':\r\n                return Number(v);\r\n            case 'id':\r\n                let id = Number(v);\r\n                let {_tuid} = f;\r\n                if (_tuid === undefined) return id;\r\n                return _tuid.boxId(id);\r\n        }\r\n\t}\r\n\t\r\n\tprivate reverseNT(text:string):string {\r\n\t\tif (text === undefined) return;\r\n\t\tif (text === null) return;\r\n\t\tlet len = text.length;\r\n\t\tlet r = '';\r\n\t\tlet p = 0;\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet c = text.charCodeAt(i);\r\n\t\t\tif (c === codeBackSlash) {\r\n\t\t\t\tif (i===len-1) break;\r\n\t\t\t\tlet c1 = text.charCodeAt(i+1);\r\n\t\t\t\tlet ch:string;\r\n\t\t\t\tswitch (c1) {\r\n\t\t\t\t\tdefault: continue;\r\n\t\t\t\t\tcase codeBackSlash: ch = '\\\\'; break;\r\n\t\t\t\t\tcase codeN: ch = '\\n'; break;\r\n\t\t\t\t\tcase codeT: ch = '\\t'; break;\r\n\t\t\t\t\tcase codeB: ch = '\\b'; break;\r\n\t\t\t\t\tcase codeF: ch = '\\f'; break;\r\n\t\t\t\t\tcase codeV: ch = '\\v'; break;\r\n\t\t\t\t\tcase codeR: ch = '\\r'; break;\r\n\t\t\t\t}\r\n\t\t\t\tr += text.substring(p, i) + ch;\r\n\t\t\t\tp = i+2;\r\n\t\t\t\t++i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tr += text.substring(p, len);\r\n\t\treturn r;\r\n\t}\r\n\r\n    private unpackArr(ret:any, arr:ArrFields, data:string, p:number):number {\r\n\t\tlet p0 = p;\r\n        let vals:any[] = [], len = data.length;\r\n        let {name, fields} = arr;\r\n        while (p<len) {\r\n            let ch = data.charCodeAt(p);\r\n            if (ch === 10) {\r\n\t\t\t\tif (p === p0) {\r\n\t\t\t\t\tch = data.charCodeAt(p);\r\n\t\t\t\t\tif (ch !== 10) {\r\n\t\t\t\t\t\tthrow new Error('upackArr: arr第一个字符是10，则必须紧跟一个10，表示整个arr的结束')\r\n\t\t\t\t\t}\r\n\t\t\t\t\t++p;\r\n\t\t\t\t}\r\n                ++p;\r\n                break;\r\n            }\r\n            let val = {} as any; //new creater();\r\n            vals.push(val);\r\n            p = this.unpackRow(val, fields, data, p);\r\n        }\r\n        ret[name] = vals;\r\n        return p;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { ItemSchema, UiItem, UiSelectBase } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { observable } from 'mobx';\r\nimport { FieldRule } from '../form/rules';\r\nimport { Image } from '../image';\r\nimport { Edit } from './edit';\r\n\r\nexport abstract class ItemEdit {\r\n\tprotected edit: Edit;\r\n\tprotected name: string;\r\n\tprotected _itemSchema: ItemSchema;\r\n    get itemSchema(): ItemSchema {return this._itemSchema}\r\n    protected _uiItem:UiItem;\r\n    get uiItem():UiItem {return this._uiItem}\r\n    value: any;\r\n\tlabel: string;\r\n\tget editInRow(): boolean {return false;}\r\n\r\n    @observable protected error: string;\r\n    @observable protected isChanged: boolean = false;\r\n    protected newValue: any;\r\n\r\n    constructor(edit:Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string, value: any) {\r\n\t\tthis.edit = edit;\r\n        this._itemSchema = itemSchema;\r\n        this._uiItem = uiItem\r\n        this.value = value;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this.label = label;\r\n\t}\r\n\t\r\n\tinit() {\t\t\r\n\t}\r\n\r\n    async start():Promise<any> {\r\n        return await this.internalStart();\r\n    }\r\n\r\n    protected abstract internalStart():Promise<any>;\r\n\r\n    async end():Promise<any> {\r\n        await this.internalEnd()\r\n    }\r\n\r\n\trenderContent() {\r\n        let {name, type} = this._itemSchema;\r\n        let divValue:any;\r\n        let uiItem = this._uiItem;\r\n        let label:string, labelHide:boolean;\r\n        if (uiItem === undefined) {\r\n            label = name;\r\n        }\r\n        else {\r\n\t\t\tlabel = uiItem.label;\r\n\t\t\tlabelHide = uiItem.labelHide;\r\n            let templet = uiItem.Templet;\r\n            if (templet !== undefined) {\r\n                if (typeof templet === 'function') {\r\n\t\t\t\t\tif (this.value !== undefined) divValue = templet(this.value);\r\n\t\t\t\t}\r\n                else {\r\n\t\t\t\t\tdivValue = {templet};\r\n\t\t\t\t}\r\n            }\r\n            else if (this.value !== undefined) {\r\n                switch (uiItem.widget) {\r\n                    case 'radio':\r\n                    case 'select':\r\n                        let {list} = uiItem as UiSelectBase;\r\n                        divValue = <b>{list.find(v => v.value === this.value).title}</b>;\r\n                        break;\r\n                    case 'id':\r\n                        divValue = <b>no templet for {name}={this.value}</b>\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        if (divValue === undefined) {\r\n            switch (type) {\r\n                default:\r\n                    divValue = this.value? \r\n\t\t\t\t\t\t<b>{this.value}</b> \r\n\t\t\t\t\t\t:\r\n\t\t\t\t\t\t<small className=\"text-muted\">[{labelHide===true? label:'无'}]</small>;\r\n                    break;\r\n                case 'image':\r\n                    divValue = <Image className=\"w-4c h-4c\" src={this.value} />;\r\n                    break;\r\n            }\r\n\t\t}\r\n\t\treturn divValue;\r\n\t}\r\n\r\n    protected async internalEnd():Promise<void> {nav.pop()}\r\n\r\n    protected verifyValue() {\r\n        if (this.uiItem === undefined) return;\r\n        let {rules} = this.uiItem;\r\n        if (rules === undefined) return;\r\n        let nv = this.newValue;\r\n        function verifyRule(rule:FieldRule, value: any):string {\r\n            let error = rule(nv);\r\n            if (error !== undefined) {\r\n                if (typeof error !== 'object')\r\n                    return error;\r\n                else\r\n                    return JSON.stringify(error);\r\n            }\r\n        }\r\n        if (Array.isArray(rules)) {\r\n            for (let rule of rules) {\r\n                let error = verifyRule(rule as FieldRule, nv);\r\n                if (error !== undefined) {\r\n                    this.error = error;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.error = verifyRule(rules as FieldRule, nv);\r\n        }\r\n    }\r\n}\r\n","//import _ from 'lodash';\r\nimport { Caller } from '../net';\r\nimport { Entity } from './entity';\r\nimport { Action } from './action';\r\nimport { Query } from './query';\r\n\r\ninterface UqResponseSchema {\r\n    uq: any;\r\n    entity: any;\r\n}\r\n\r\nexport abstract class EntityCaller<T> extends Caller<T> {\r\n    private tries: number;\r\n    protected _entity: Entity;\r\n\r\n    constructor(entity: Entity, params:T, waiting: boolean = true) {\r\n        super(params, waiting);\r\n        this.tries = 0;\r\n        this._entity = entity;\r\n    }\r\n\r\n    protected get entity(): Entity {return this._entity;}\r\n\r\n    //大多的entityCaller都不需要这个\r\n    //buildParams() {return this.entity.buildParams(this.params);}\r\n    \r\n    async request(): Promise<any> {\r\n        await this.entity.loadSchema();\r\n        let ret = await this.innerRequest();\r\n        return ret;\r\n    }\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        return await this.entity.uqApi.xcall(this);\r\n    }\r\n\r\n    async innerRequest(): Promise<any> {\r\n        let jsonResult = await this.innerCall();\r\n        let {$uq, $modify, res} = jsonResult;\r\n        this.entity.uq.pullModify($modify);\r\n        if ($uq === undefined) {\r\n            //if (res === undefined) debugger;\r\n            let ret = this.xresult(res);\r\n            //if (ret === undefined) debugger;\r\n            return ret;\r\n        }\r\n        return await this.retry($uq);\r\n    }\r\n\r\n    xresult(res:any):any {return res}\r\n\r\n    get headers(): {[header:string]: string} {\r\n        let {ver, uq} = this.entity;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }\r\n\r\n    private async retry(schema: UqResponseSchema) {\r\n        ++this.tries;\r\n        if (this.tries > 5) throw new Error('can not get right uq response schema, 5 tries');\r\n        this.rebuildSchema(schema);\r\n        return await this.innerRequest();\r\n    }\r\n\r\n    private rebuildSchema(schema: UqResponseSchema) {\r\n        let {uq, entity} = schema;\r\n        if (uq !== undefined) {\r\n\t\t\tthis.entity.uq.buildEntities(uq);\r\n\t\t}\r\n        if (entity !== undefined) {\r\n\t\t\tthis.entity.setSchema(entity);\r\n\t\t}\r\n    }\r\n}\r\n\r\nexport abstract class ActionCaller extends EntityCaller<any> {\r\n    protected get entity(): Action {return this._entity as Action;}\r\n}\r\n\r\nexport class QueryQueryCaller extends EntityCaller<any> {\r\n    protected get entity(): Query {return this._entity as Query};\r\n    get path():string {return `query/${this.entity.name}`;}\r\n    xresult(res:any) {\r\n        let data = this.entity.unpackReturns(res);\r\n        return data;\r\n    }\r\n    buildParams() {return this.entity.buildParams(this.params);}\r\n}\r\n\r\nexport class QueryPageCaller extends EntityCaller<any> {\r\n    protected get params(): {pageStart:any; pageSize:number, params:any} {return this._params};\r\n\tprotected get entity(): Query {return this._entity as Query};\r\n\t//results: {[name:string]:any[]};\r\n\tget path():string {return `query-page/${this.entity.name}`;}\t\r\n    buildParams() {\r\n        let {pageStart, pageSize, params} = this.params;\r\n        let p:any;\r\n        if (params === undefined) {\r\n            p = {key: ''};\r\n        }\r\n        else {\r\n            p = this.entity.buildParams(params);\r\n        }\r\n        /*\r\n        switch (typeof params) {\r\n            case 'undefined': p = {key: ''}; break;\r\n            default: p = _.clone(params); break;\r\n        }\r\n        */\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        return p;\r\n    };\r\n    xresult(res:any): {[name:string]:any[]} {\r\n        let ret = this.entity.unpackReturns(res);\r\n\t\t//return this.results.$page;// as any[];\r\n\t\treturn ret;\r\n    }\r\n}\r\n","import {bridgeCenterApi, isBridged} from './appBridge';\r\nimport {FetchError} from './fetchError';\r\nimport {HttpChannelUI} from './httpChannelUI';\r\nimport {nav} from '../components/nav';\r\nimport { Caller } from './caller';\r\nimport { env } from '../tool';\r\n\r\n/*\r\nexport async function httpGet(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.get('', params);\r\n    return ret;\r\n}\r\n\r\nexport async function httpPost(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.post('', params);\r\n    return ret;\r\n}\r\n*/\r\n\r\nconst methodsWithBody = ['POST', 'PUT'];\r\n\r\nexport abstract class HttpChannel {\r\n    private timeout: number;\r\n    protected ui?: HttpChannelUI;\r\n    protected hostUrl: string;\r\n    protected apiToken: string;\r\n\r\n    constructor(hostUrl: string, apiToken:string, ui?: HttpChannelUI) {\r\n        this.hostUrl = hostUrl;\r\n        this.apiToken = apiToken;\r\n        this.ui = ui;\r\n        this.timeout = env.isDevelopment === true? 500000:50000;\r\n    }\r\n\r\n    private startWait = (waiting: boolean) => {\r\n        if (waiting === true) {\r\n            if (this.ui !== undefined) this.ui.startWait();\r\n        }\r\n    }\r\n\r\n    private endWait = (url?:string, reject?:(reason?:any)=>void) => {\r\n        if (this.ui !== undefined) this.ui.endWait();\r\n        if (reject !== undefined) reject('访问webapi超时 ' + url);\r\n    }\r\n\r\n    private showError = async (error:FetchError) => {\r\n        if (this.ui !== undefined) await this.ui.showError(error);\r\n    }\r\n\r\n    used() {\r\n        this.post('', {});\r\n    }\r\n\r\n    async xcall(urlPrefix:string, caller:Caller<any>): Promise<void> {\r\n        let options = this.buildOptions();\r\n        let {headers, path, method} = caller;\r\n        if (headers !== undefined) {\r\n            let h = options.headers;\r\n            for (let i in headers) {\r\n\t\t\t\t//h.append(i, encodeURI(headers[i]));\r\n\t\t\t\th[i] = encodeURI(headers[i]);\r\n            }\r\n        }\r\n        options.method = method;\r\n        let p = caller.buildParams();\r\n        if (methodsWithBody.indexOf(method) >= 0 && p !== undefined) {\r\n            options.body = JSON.stringify(p)\r\n        }\r\n        return await this.innerFetch(urlPrefix + path, options, caller.waiting);\r\n    }\r\n\r\n    private async innerFetchResult(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let ret = await this.innerFetch(url, options, waiting);\r\n        return ret.res;\r\n    }\r\n\r\n    async get(url: string, params: any = undefined, waiting?: boolean): Promise<any> {\r\n        if (params) {\r\n            let keys = Object.keys(params);\r\n            if (keys.length > 0) {\r\n                let c = '?';\r\n                for (let k of keys) {\r\n                    let v = params[k];\r\n                    if (v === undefined) continue;\r\n                    url += c + k + '=' + params[k];\r\n                    c = '&';\r\n                }\r\n            }\r\n        }\r\n        let options = this.buildOptions();\r\n        options.method = 'GET';\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async post(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'POST';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async put(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'PUT';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async delete(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'DELETE';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n    async fetch(url: string, options: any, waiting: boolean, resolve:(value?:any)=>any, reject:(reason?:any)=>void):Promise<void> {\r\n        let that = this;\r\n        this.startWait(waiting);\r\n        let path = url;\r\n        function buildError(err: any, ex?: string) {\r\n            switch (typeof err) {\r\n                case 'string':\r\n                    if (ex !== undefined) err += ' ' + ex;\r\n                    break;\r\n                case 'object':\r\n                    let keys = Object.keys(err);\r\n                    let retErr:any = {\r\n                        ex: ex,\r\n                    };\r\n                    for (let key of keys) {\r\n                        retErr[key] = err[key];\r\n                    }\r\n                    err = retErr;\r\n                    break;\r\n            }\r\n            return {\r\n                channel: that,\r\n                url: path,\r\n                options: options,\r\n                resolve: resolve,\r\n                reject: reject,\r\n                error: err,\r\n            }\r\n        }\r\n        try {\r\n            console.log('%s-%s %s', options.method, path, options.body || '');\r\n            let now = Date.now();\r\n            let timeOutHandler = env.setTimeout(\r\n                undefined, //'httpChannel.fetch',\r\n                () => {\r\n                    that.endWait(url + ' timeout endWait: ' + (Date.now() - now) + 'ms', reject);\r\n                },\r\n                this.timeout);\r\n            let res = await fetch(encodeURI(path), options);\r\n            if (res.ok === false) {\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('ok false endWait');       \r\n                that.endWait();\r\n                console.log('call error %s', res.statusText);\r\n                throw res.statusText;\r\n            }\r\n            let ct = res.headers.get('content-type');\r\n            if (ct && ct.indexOf('json')>=0) {\r\n                return res.json().then(async retJson => {\r\n                    env.clearTimeout(timeOutHandler);\r\n                    that.endWait();\r\n                    if (retJson.ok === true) {\r\n                        if (typeof retJson !== 'object') {\r\n                            debugger;\r\n                        }\r\n                        else if (Array.isArray(retJson) === true) {\r\n                            debugger;\r\n                        }\r\n                        return resolve(retJson);\r\n                    }\r\n                    let retError = retJson.error;\r\n                    if (retError === undefined) {\r\n                        await that.showError(buildError('not valid tonva json'));\r\n                    }\r\n                    else {\r\n                        await that.showError(buildError(retError, 'retJson.error'));\r\n                        reject(retError);\r\n                    }\r\n                }).catch(async error => {\r\n                    await that.showError(buildError(error, 'catch res.json()'));\r\n                });\r\n            }\r\n            else {\r\n                let text = await res.text();\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('text endWait');\r\n                that.endWait();\r\n                resolve(text);\r\n            }\r\n        }\r\n        catch(error) {\r\n            this.endWait(url, reject);\r\n            if (typeof error === 'string') {\r\n                let err = error.toLowerCase();\r\n                if (err.startsWith('unauthorized') === true) {\r\n                    nav.logout();\r\n                    return;\r\n                }\r\n            }\r\n            console.error('fecth error (no nav.showError): ' + url);\r\n            // await this.showError(buildError(error, 'catch outmost'));\r\n        };\r\n    }\r\n\r\n    protected abstract innerFetch(url: string, options: any, waiting: boolean): Promise<any>;\r\n\r\n    async callFetch(url:string, method:string, body:any):Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = method;\r\n        options.body = body;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(url, options, true, resolve, reject);\r\n        });\r\n    }\r\n\r\n    //private buildOptions(): {method:string; headers:Headers; body:any} {\r\n\t\tprivate buildOptions(): {method:string; headers:{[name:string]: string}; body:any} {\r\n        let headers = this.buildHeaders();\r\n        let options = {\r\n            headers: headers,\r\n            method: undefined as any,\r\n            body: undefined as any,\r\n            // cache: 'no-cache',\r\n        };\r\n        return options;\r\n    }\r\n\r\n\t/*\r\n    protected buildHeaders():Headers {\r\n        let {language, culture} = nav;\r\n        let headers = new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        headers.append('Accept-Language', lang);\r\n        if (this.apiToken) { \r\n            headers.append('Authorization', this.apiToken); \r\n        }\r\n        return headers;\r\n\t}\r\n\t*/\r\n\tprotected buildHeaders():{[name:string]: string} { \r\n        let {language, culture} = nav;\r\n        let headers:{[name:string]: string} = {}; //new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n\t\t//headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n\t\theaders['Content-Type'] = 'application/json;charset=UTF-8';\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n\t\t//headers.append('Accept-Language', lang);\r\n\t\theaders['Accept-Language'] = lang;\r\n        if (this.apiToken) { \r\n\t\t\t//headers.append('Authorization', this.apiToken); \r\n\t\t\theaders['Authorization'] = this.apiToken;\r\n        }\r\n        return headers;\r\n\t}\r\n}\r\n\r\nexport class CenterHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        if (this.apiToken === undefined && isBridged())\r\n            return await bridgeCenterApi(u, options.method, options.body);\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n\r\nexport class UqHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n","import {nav} from '../components/nav';\r\nimport {FetchError} from './fetchError';\r\n\r\nexport interface HttpChannelUI {\r\n    startWait():void;\r\n    endWait():void;\r\n    showError(error:FetchError):Promise<void>;\r\n    showUpgradeUq(uq:string, version:number):Promise<void>;\r\n}\r\n\r\nexport class HttpChannelNavUI implements HttpChannelUI {\r\n    startWait() {\r\n        nav.startWait();\r\n    }\r\n    endWait() {\r\n        nav.endWait();\r\n    }\r\n    async showError(error:FetchError):Promise<void> {\r\n        nav.endWait();\r\n        /*\r\n        if (error.name === 'SyntaxError') {\r\n            error = {\r\n                name: error.name,\r\n                message: error.message,\r\n            }\r\n        }*/\r\n        await nav.onError(error);\r\n    }\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await nav.showUpgradeUq(uq, version);\r\n    }\r\n}\r\n\r\n","import _ from 'lodash';\r\nimport {HttpChannel, CenterHttpChannel, UqHttpChannel} from './httpChannel';\r\nimport {HttpChannelNavUI} from './httpChannelUI';\r\nimport {appUq, logoutUqTokens, buildAppUq} from './appBridge';\r\nimport {ApiBase} from './apiBase';\r\nimport { host } from './host';\r\nimport { LocalMap, env } from '../tool';\r\nimport {decodeUserToken} from '../tool/user';\r\n\r\ninterface PromiseValue<T> {\r\n\tresolve: (value?: T | PromiseLike<T>) => void;\r\n\treject: (reason?: any) => void;\r\n}\r\nlet channelUIs:{[name:string]: HttpChannel|(PromiseValue<any>[])} = {};\r\nlet channelNoUIs:{[name:string]: HttpChannel|(PromiseValue<any>[])} = {};\r\n\r\nexport function logoutApis() {\r\n    channelUIs = {};\r\n    channelNoUIs = {};\r\n    logoutUnitxApis();\r\n    logoutUqTokens();\r\n}\r\n\r\ninterface UqLocal {\r\n    user: number;\r\n    unit: number;\r\n    value: any;\r\n    tick?: number;\r\n    isNet?: boolean;\r\n}\r\n/*\r\ninterface UqLocals {\r\n    user: number;\r\n    unit: number;\r\n    uqs: {[uq:string]: UqLocal};\r\n}\r\n*/\r\n/*\r\nconst uqLocalEntities = 'uqLocalEntities';\r\nclass CacheUqLocals {\r\n    private local:UqLocals;\r\n\r\n    async loadAccess(uqApi: UqApi):Promise<any> {\r\n        try {\r\n            let {uqOwner, uqName} = uqApi;\r\n            if (this.local === undefined) {\r\n                let ls = null; // localStorage.getItem(uqLocalEntities);\r\n                if (ls !== null) {\r\n                    this.local = JSON.parse(ls);\r\n                }\r\n            }\r\n            if (this.local !== undefined) {\r\n                let {user, uqs} = this.local;\r\n                if (user !== loginedUserId || uqs === undefined) {\r\n                    this.local = undefined;\r\n                }\r\n                else {\r\n                    for (let i in uqs) {\r\n                        let ul = uqs[i];\r\n                        ul.isNet = undefined;\r\n                    }\r\n                }\r\n            }\r\n            if (this.local === undefined) {\r\n                this.local = {\r\n                    user: loginedUserId,\r\n                    unit: undefined,\r\n                    uqs: {}\r\n                };\r\n            }\r\n\r\n            let ret: any;\r\n            let un = uqOwner+'/'+uqName;\r\n            let uq = this.local.uqs[un];\r\n            if (uq !== undefined) {\r\n                let {value} = uq;\r\n                ret = value;\r\n            }\r\n            if (ret === undefined) {\r\n                ret = await uqApi.__loadAccess();\r\n                //this.saveLocal(un, ret);\r\n            }\r\n            return _.cloneDeep(ret);\r\n        }\r\n        catch (err) {\r\n            this.local = undefined;\r\n            localStorage.removeItem(uqLocalEntities);\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    private saveLocal(uqName:string, accessValue: any) {\r\n        this.local.uqs[uqName] = {\r\n            value: accessValue,\r\n            isNet: true,\r\n        }\r\n        let str = JSON.stringify(this.local);\r\n        localStorage.setItem(uqLocalEntities, str);\r\n    }\r\n\r\n    async checkAccess(uqApi: UqApi):Promise<boolean> {\r\n        if (this.local === undefined) return false;\r\n        let {uqOwner, uqName} = uqApi;\r\n        let un = uqOwner+'/'+uqName;\r\n        let uq = this.local.uqs[un];\r\n        if (uq === undefined) return false;\r\n        let {isNet, value} = uq;\r\n        if (isNet === true) return true;\r\n        let ret = await uqApi.__loadAccess();\r\n        let isMatch = _.isMatch(value, ret);\r\n        if (isMatch === false) {\r\n            this.saveLocal(un, ret);\r\n            return false;\r\n        }\r\n        uq.isNet = true;\r\n        return true;\r\n    }\r\n}\r\n\r\nconst localUqs = new CacheUqLocals;\r\n*/\r\nexport class UqApi extends ApiBase {\r\n    private access:string[];\r\n    appOwner:string;\r\n    appName:string;\r\n    uqOwner: string;\r\n    uqName: string;\r\n    uq: string;\r\n\r\n    constructor(basePath:string, appOwner:string, appName:string, uqOwner:string, uqName:string, access:string[], showWaiting?: boolean) {\r\n        super(basePath, showWaiting);\r\n        this.appOwner = appOwner;\r\n        this.appName = appName;\r\n        if (uqName) {\r\n            this.uqOwner = uqOwner;\r\n            this.uqName = uqName;\r\n            this.uq = uqOwner + '/' + uqName;\r\n        }\r\n        this.access = access;\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    //setUqVersion(uqVersion:number) {this.uqVersion = undefined}\r\n\r\n    async init() {\r\n        await buildAppUq(this.uq, this.uqOwner, this.uqName, this.appOwner, this.appName);\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channels: {[name:string]: HttpChannel|(PromiseValue<any>[])};\r\n        let channelUI: HttpChannelNavUI;\r\n        if (this.showWaiting === true || this.showWaiting === undefined) {\r\n            channels = channelUIs;\r\n            channelUI = new HttpChannelNavUI();\r\n        }\r\n        else {\r\n            channels = channelNoUIs;\r\n        }\r\n        let channel = channels[this.uq];\r\n\t\tif (channel !== undefined) {\r\n\t\t\tif (Array.isArray(channel) === false) return channel as HttpChannel;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tchannel = channels[this.uq] = [];\r\n\t\t}\r\n\t\tlet arr = channel as PromiseValue<any>[];\r\n\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\tarr.push({resolve, reject});\r\n\t\t\tif (arr.length !== 1) return;\r\n\t\t\tlet uqToken = appUq(this.uq); //, this.uqOwner, this.uqName);\r\n\t\t\tif (!uqToken) {\r\n\t\t\t\t//debugger;\r\n\t\t\t\tawait this.init();\r\n\t\t\t\tuqToken = appUq(this.uq);\r\n\t\t\t}\r\n\t\t\tlet {url, token} = uqToken;\r\n\t\t\tthis.token = token;\r\n\t\t\tchannel = new UqHttpChannel(url, token, channelUI);\r\n\t\t\tchannels[this.uq] = channel;\r\n\t\t\tfor (let pv of arr) {\r\n\t\t\t\tpv.resolve(channel);\r\n\t\t\t}\r\n\r\n\t\t});\r\n    }\r\n\r\n    async loadAccess():Promise<any> {\r\n        //return await localUqs.loadAccess(this);\r\n        let acc = this.access === undefined?\r\n            '' :\r\n            this.access.join('|');\r\n        let ret = await this.get('access', {acc:acc});\r\n        return ret;\r\n    }\r\n\r\n\tasync allSchemas(): Promise<any> {\r\n\t\treturn await this.get('all-schemas');\r\n\t}\r\n\r\n    async schema(name:string):Promise<any> {\r\n        return await this.get('schema/' + name);\r\n    }\r\n\r\n    async queueModify(start:number, page:number, entities:string) {\r\n        return await this.post('queue-modify', {start:start, page:page, entities:entities});\r\n    }\r\n\r\n\tasync getRoles():Promise<string[]> {\r\n\t\tlet ret = await this.get('get-roles',);\r\n\t\tif (!ret) return null;\r\n\t\tlet parts:string[] = (ret as string).split('|');\r\n\t\tlet s:string[] = [];\r\n\t\tfor (let p of parts) {\r\n\t\t\tp = p.trim();\r\n\t\t\tif (!p) continue;\r\n\t\t\ts.push(p);\r\n\t\t}\r\n\t\tif (s.length === 0) return null;\r\n\t\treturn s;\r\n\t}\r\n\t\r\n\tasync getAllRoleUsers():Promise<{user:number, admin:number, roles:string}[]> {\r\n\t\tlet ret = await this.get('get-all-role-users');\r\n\t\treturn ret;\r\n\t}\r\n\tasync setUserRoles(theUser:number, roles:string):Promise<void> {\r\n\t\tawait this.post('set-user-roles', {theUser, roles});\r\n\t}\r\n\tasync deleteUserRoles(theUser:number):Promise<void> {\r\n\t\tawait this.get('delete-user-roles', {theUser});\r\n\t}\r\n}\r\n\r\nlet channels:{[unitId:number]: HttpChannel} = {};\r\n\r\nexport function logoutUnitxApis() {\r\n    channels = {};\r\n}\r\n\r\nexport class UnitxApi extends UqApi {\r\n    private unitId:number;\r\n    constructor(unitId:number) {\r\n        super('tv/', undefined, undefined, undefined, undefined, undefined, true);\r\n        this.unitId = unitId;\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channel = channels[this.unitId];\r\n        if (channel !== undefined) return channel;\r\n        return channels[this.unitId] = await this.buildChannel();\r\n    }\r\n\r\n    private async buildChannel():Promise<HttpChannel> {\r\n        let channelUI = new HttpChannelNavUI();\r\n        let centerAppApi = new CenterAppApi('tv/', undefined);\r\n        let ret = await centerAppApi.unitxUq(this.unitId);\r\n        let {token, db, url, urlTest} = ret;\r\n        let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n        this.token = token;\r\n        return new UqHttpChannel(realUrl, token, channelUI);\r\n    }\r\n}\r\n\r\nlet centerHost:string;\r\n\r\nexport function setCenterUrl(url:string) {\r\n    console.log('setCenterUrl %s', url);\r\n    centerHost = url;\r\n    //centerToken = undefined;\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nexport let centerToken:string|undefined = undefined;\r\n\r\nlet loginedUserId:number = 0;\r\nexport function setCenterToken(userId:number, t?:string) {\r\n    loginedUserId = userId;\r\n    centerToken = t;\r\n    console.log('setCenterToken %s', t);\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nlet centerChannelUI:HttpChannel;\r\nlet centerChannel:HttpChannel;\r\nfunction getCenterChannelUI():HttpChannel {\r\n    if (centerChannelUI !== undefined) return centerChannelUI;\r\n    return centerChannelUI = new CenterHttpChannel(centerHost, centerToken, new HttpChannelNavUI());\r\n}\r\nfunction getCenterChannel():HttpChannel {\r\n    if (centerChannel !== undefined) return centerChannel;\r\n    return centerChannel = new CenterHttpChannel(centerHost, centerToken);\r\n}\r\n\r\nexport abstract class CenterApiBase extends ApiBase {\r\n    /*\r\n    constructor(path: string, showWaiting?: boolean) {\r\n        super(path, showWaiting);\r\n    }*/\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        return (this.showWaiting === true || this.showWaiting === undefined)?\r\n            getCenterChannelUI():\r\n            getCenterChannel();\r\n    }\r\n}\r\n\r\nconst uqTokensName = 'uqTokens';\r\nexport class UqTokenApi extends CenterApiBase {\r\n    private localMap: LocalMap = env.localDb.map(uqTokensName);\r\n\r\n    async uq(params: {unit:number, uqOwner:string, uqName:string, appOwner:string, appName:string}):Promise<any> {\r\n        let {uqOwner, uqName} = params;\r\n        let un = uqOwner+'/'+uqName;\r\n        let localCache = this.localMap.child(un);\r\n        try {\r\n            let uqToken:UqLocal = localCache.get();\r\n            if (uqToken !== undefined) {\r\n                let {unit, user} = uqToken;\r\n                if (unit !== params.unit || user !== loginedUserId) {\r\n                    localCache.remove();\r\n                    uqToken = undefined;\r\n                }\r\n            }\r\n            let nowTick = Math.floor(Date.now() / 1000);\r\n            if (uqToken !== undefined) {\r\n                let {tick, value} = uqToken;\r\n                if (value !== undefined && (nowTick - tick) < 24*3600) {\r\n                    return _.clone(value);\r\n                }\r\n            }\r\n            let appUqParams:any = _.clone(params);\r\n            appUqParams.testing = host.testing;\r\n            let ret = await this.get('app-uq', appUqParams);\r\n            if (ret === undefined) {\r\n                let {unit, uqOwner, uqName} = params;\r\n                let err = `center get app-uq(unit=${unit}, '${uqOwner}/${uqName}') - not exists or no unit-service`;\r\n                throw err;\r\n            }\r\n\r\n            uqToken = {\r\n                unit: params.unit,\r\n                user: loginedUserId,\r\n                tick: nowTick,\r\n                value: ret,\r\n            }\r\n            localCache.set(uqToken);\r\n            return _.clone(ret);\r\n        }\r\n        catch (err) {\r\n            localCache.remove();\r\n            throw err;\r\n        }\r\n    }\r\n}\r\n\r\nexport const uqTokenApi = new UqTokenApi('tv/tie/', undefined);\r\n\r\nexport class CallCenterApi extends CenterApiBase {\r\n    directCall(url:string, method:string, body:any):Promise<any> {\r\n        return this.call(url, method, body);\r\n    }\r\n}\r\nexport const callCenterapi = new CallCenterApi('', undefined);\r\n\r\nexport interface UqAppData {\r\n    appName: string;\r\n    appOwner: string;\r\n    id: number;\r\n    version: string;        // AppUI version\r\n    uqs: UqData[];\r\n}\r\n\r\nexport interface UqData {\r\n    id: number;\r\n    uqOwner: string;\r\n    uqName: string;\r\n    access: string;\r\n    newVersion: boolean;\r\n}\r\n\r\nexport interface UqServiceData {\r\n    id: number;\r\n    db: string;\r\n    url: string;\r\n    urlTest: string;\r\n    token: string;\r\n}\r\n\r\n//const appUqsName = 'appUqs';\r\n\r\nexport class CenterAppApi extends CenterApiBase {\r\n    //private local: LocalCache = env.localDb.item(appUqsName);\r\n    //private cachedUqs: UqAppData;\r\n    async uqs(appOwner:string, appName:string):Promise<UqAppData> {\r\n        let ret:UqAppData = await this.get('tie/app-uqs', {appOwner:appOwner, appName:appName});\r\n        return ret;\r\n        /*\r\n        let ret:UqAppData;\r\n        let appUqs = this.local.get();\r\n        if (appUqs) {\r\n            let {appOwner:rAppOwner, appName:rAppName} = appUqs;\r\n            if (appOwner === rAppOwner && appName === rAppName) ret = appUqs;\r\n        }\r\n        if (ret === undefined) {\r\n            ret = await this.uqsPure(appOwner, appName);\r\n            ret.appName = appName;\r\n            ret.appOwner = appOwner;\r\n            //localStorage.setItem(JSON.stringify(obj));\r\n            this.local.set(ret);\r\n        }\r\n        //return this.cachedUqs = _.cloneDeep(ret);\r\n        return ret;\r\n        */\r\n    }\r\n    private async uqsPure(appOwner:string, appName:string):Promise<UqAppData> {\r\n        return await this.get('tie/app-uqs', {appOwner:appOwner, appName:appName});\r\n    }\r\n    /*\r\n    private async isOkCheckUqs(appOwner:string, appName:string):Promise<boolean> {\r\n        let ret = await this.uqsPure(appOwner, appName);\r\n        let {id:cachedId, uqs:cachedUqs} = this.local.get(); //.cachedUqs;\r\n        let {id:retId, uqs:retUqs} = ret;\r\n        if (cachedId !== retId) return false;\r\n        if (cachedUqs.length !== retUqs.length) return false;\r\n        let len = cachedUqs.length;\r\n        for (let i=0; i<len; i++) {\r\n            if (_.isMatch(cachedUqs[i], retUqs[i]) === false) return false;\r\n        }\r\n        return true;\r\n    }\r\n    async checkUqs(appOwner:string, appName:string):Promise<boolean> {\r\n        let ret = await this.isOkCheckUqs(appOwner, appName);\r\n        if (ret === false) {\r\n            this.local.remove();\r\n            nav.start();\r\n        }\r\n        return ret;\r\n    }\r\n    */\r\n    async unitxUq(unit:number):Promise<UqServiceData> {\r\n        return await this.get('tie/unitx-uq', {unit:unit});\r\n    }\r\n    async changePassword(param: {orgPassword:string, newPassword:string}) {\r\n        return await this.post('tie/change-password', param);\r\n    }\r\n}\r\n\r\nexport async function loadAppUqs(appOwner:string, appName:string): Promise<UqAppData> {\r\n    let centerAppApi = new CenterAppApi('tv/', undefined);\r\n    //let unit = meInFrame.unit;\r\n    let ret = await centerAppApi.uqs(appOwner, appName);\r\n    //await centerAppApi.checkUqs(appOwner, appName);\r\n    /*\r\n    .then(v => {\r\n        if (v === false) {\r\n            localStorage.removeItem(appUqs);\r\n            nav.start();\r\n        }\r\n    });\r\n    */\r\n    return ret;\r\n}\r\n\r\n//import { nav } from '../ui';\r\n\r\nexport interface RegisterParameter {\r\n    nick:string, \r\n    user:string, \r\n    pwd:string,\r\n    country:number, \r\n    mobile:number, \r\n    mobileCountry:number,\r\n    email:string,\r\n    verify:string,\r\n};\r\n\r\nexport class UserApi extends CenterApiBase {\r\n    async login(params: {user: string, pwd: string, guest: number}): Promise<any> {\r\n        //(params as any).device = nav.local.device.get();\r\n        let ret = await this.get('user/login', params);\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeUserToken(ret);\r\n            case 'object':\r\n                let token = ret.token;\r\n                let user = decodeUserToken(token);\r\n                let {nick, icon} = ret;\r\n                if (nick) user.nick = nick;\r\n                if (icon) user.icon = icon;\r\n                return user;\r\n        }\r\n        // !== undefined) return decodeToken(token);\r\n    }\r\n    async register(params: RegisterParameter): Promise<any>\r\n    {\r\n        return await this.post('user/register', params);\r\n    }\r\n\r\n    async sendVerify(account:string, type:'mobile'|'email', oem:string) {\r\n        return await this.post('user/set-verify', {account:account, type:type, oem:oem});\r\n    }\r\n\r\n    async checkVerify(account:string, verify:string) {\r\n        return await this.post('user/check-verify', {account:account, verify:verify});\r\n    }\r\n\r\n    async isExists(account:string) {\r\n        return await this.get('user/is-exists', {account:account});\r\n    }\r\n\r\n    async resetPassword(account:string, password:string, verify:string, type:'mobile'|'email'):Promise<any[]> {\r\n        return await this.post('user/reset-password', {account:account, password, verify, type});\r\n    }\r\n    \r\n    async userSetProp(prop:string, value:any) {\r\n        await this.post('tie/user-set-prop', {prop:prop, value:value});\r\n    }\r\n\r\n    async me():Promise<any> {\r\n        return await this.get('tie/me');\r\n    }\r\n\r\n    async user(id:number): Promise<any> {\r\n        return await this.get('tie/user', {id:id});\r\n\t}\r\n\t\r\n\tasync fromKey(key:string): Promise<{id:number, name:string, nick:string, icon:string}> {\r\n\t\treturn await this.get('tie/user-from-key', {key});\r\n\t}\r\n}\r\n\r\nexport const userApi = new UserApi('tv/', undefined);\r\n","export * from './uqMan';\r\nexport * from './entity';\r\nexport * from './action';\r\nexport * from './query';\r\nexport * from './sheet';\r\nexport * from './tuid';\r\nexport * from './book';\r\nexport * from './map';\r\nexport * from './history';\r\nexport * from './pending';\r\nexport * from './uqsMan';\r\nexport * from './tag/tag';\r\nexport * from './enum';\r\nexport * from './buildUqApp';\r\n","import _ from 'lodash';\r\n\r\nexport interface KeyValueRes {\r\n    [key:string]: any;\r\n}\r\n\r\nexport interface Res<T extends KeyValueRes> {\r\n    [lang:string]: T | {[district:string]: T};\r\n}\r\n\r\nexport const resOptions:{\r\n\tlang: string;\r\n\t$lang: string;\r\n\tdistrict: string;\r\n\t$district: string;\r\n} = {\r\n\tlang: undefined,\r\n\t$lang: undefined,\r\n\tdistrict: undefined,\r\n\t$district: undefined,\r\n}\r\n\r\nexport function setResOptions(lang:string, district:string) {\r\n\tresOptions.lang = lang;\r\n\tresOptions.$lang = '$' + lang;\r\n    resOptions.district = district;\r\n    resOptions.$district = '$' + district;\r\n}\r\n\r\n(function() {\r\n    let lang: string, district: string;\r\n    let language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\r\n        || navigator.language; // ||   // All browsers\r\n    //navigator.userLanguage; // IE <= 10\r\n    if (!language) {\r\n        lang = 'zh';\r\n        district = 'CN';\r\n    }\r\n    else {\r\n        let parts = language.split('-');\r\n        lang = parts[0];\r\n        if (parts.length > 1) district = parts[1].toUpperCase();\r\n    }\r\n    setResOptions(lang, district);\r\n}());\r\n\r\nexport function resLang<T extends KeyValueRes>(res:Res<T>):T {\r\n    let {lang, district} = resOptions;\r\n    let ret:T = {} as T;\r\n    if (res === undefined) return ret;\r\n    _.merge(ret, res._);\r\n    let l = res[lang];\r\n    if (l === undefined) return ret;\r\n    _.merge(ret, l._);\r\n    let d = l[district];\r\n    if (d === undefined) return ret;\r\n    _.merge(ret, d);\r\n    let {entity} = ret;\r\n    if (entity !== undefined) {\r\n        for (let i in entity) {\r\n            entity[i.toLowerCase()] = entity[i];\r\n        }\r\n    }\r\n    return ret;\r\n}\r\n\r\nconst resGlobal:any = {};\r\nexport function setRes(target: any, res: any):(str:string)=>any {\r\n\tif (res === undefined) return;\r\n\tlet {$lang, $district} = resOptions;\r\n\t_.merge(target, res);\r\n\tif ($lang !== undefined) {\r\n\t\tlet l = res[$lang];\r\n\t\tif (l !== undefined) {\r\n\t\t\t_.merge(target, l);\r\n\t\t\tlet d = l[$district];\r\n\t\t\tif (d !== undefined) {\r\n\t\t\t\t_.merge(target, d);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn function(str:string) {\r\n\t\treturn target[str] || str;\r\n\t}\r\n}\r\nexport function setGlobalRes(res: any) {\r\n\tsetRes(resGlobal, res);\r\n}\r\nexport function t(str:string):any {\r\n\treturn resGlobal[str] || str;\r\n}\r\n","const ALPHABET = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\nconst ID_LENGTH = 8;\r\n\r\nexport function uid():string {\r\n    let len = ALPHABET.length;\r\n    let rtn = '';\r\n    for (let i = 0; i < ID_LENGTH; i++) {\r\n        rtn += ALPHABET.charAt(Math.floor(Math.random() * len));\r\n    }\r\n    return rtn;\r\n}\r\n","import _ from 'lodash';\r\nimport {observable, IObservableArray} from 'mobx';\r\nimport { PageItems } from '../tool';\r\nimport {Field, ArrFields} from './uqMan';\r\nimport {Entity} from './entity';\r\nimport { QueryQueryCaller, QueryPageCaller } from './caller';\r\n\r\nexport type QueryPageApi = (name:string, pageStart:any, pageSize:number, params:any) => Promise<string>;\r\n\r\nexport class QueryPager<T extends any> extends PageItems<T> {\r\n\tprivate query: Query;\r\n\tprivate $page: any;\r\n\tprotected idFieldName: any;\r\n    constructor(query: Query, pageSize?: number, firstSize?: number, itemObservable?:boolean) {\r\n        super(itemObservable);\r\n        this.query = query;\r\n        if (pageSize !== undefined) this.pageSize = pageSize;\r\n\t\tif (firstSize !== undefined) this.firstSize = firstSize;\r\n\t}\r\n\r\n\tsetReverse() {\r\n\t\tthis.appendPosition = 'head';\r\n\t}\r\n\r\n    protected async onLoad() {\r\n\t\tif (this.$page) return;\r\n        let {schema} = this.query;\r\n        if (schema === undefined) {\r\n\t\t\tawait this.query.loadSchema();\r\n\t\t\tschema = this.query.schema;\r\n\t\t}\r\n\t\tif (schema === undefined) return;\r\n\t\tlet $page = this.$page = (schema.returns as any[]).find(v => v.name === '$page');\r\n\t\tif ($page === undefined) return;\r\n\t\tthis.sortOrder = $page.order;\r\n\t\tlet fields = $page.fields;\r\n\t\tif (fields !== undefined) {\r\n\t\t\tlet field = fields[0];\r\n\t\t\tif (field) this.idFieldName = field.name;\r\n\t\t}\r\n    }\r\n\r\n    protected async loadResults(param:any, pageStart:number, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.query.page(param, pageStart, pageSize);\r\n\t\treturn ret;\r\n\t}\r\n\tprotected getPageId(item:T) {\r\n\t\tif (item === undefined) return;\r\n\t\tif (typeof item === 'number') return item;\r\n\t\tlet start = (item as any)[this.idFieldName];\r\n\t\tif (start === null) return;\r\n\t\tif (start === undefined) return;\r\n\t\tif (typeof start === 'object') {\r\n\t\t\tlet id = start.id;\r\n\t\t\tif (id !== undefined) return id;\r\n\t\t}\r\n\t\treturn start;\r\n\t}\r\n\tasync refreshItems(item:T) {\r\n\t\tlet index = this._items.indexOf(item);\r\n\t\tif (index < 0) return;\r\n\t\tlet startIndex:number;\r\n\t\tif (this.appendPosition === 'tail') {\r\n\t\t\tstartIndex = index - 1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstartIndex = index + 1;\r\n\t\t}\r\n\t\tlet pageStart = this.getPageId(this._items[startIndex]);\r\n\t\tlet pageSize = 1;\r\n        let ret = await this.load(\r\n\t\t\tthis.param, \r\n\t\t\tpageStart,\r\n\t\t\tpageSize);\r\n\t\tlet len = ret.length;\r\n\t\tif (len === 0) {\r\n\t\t\tthis._items.splice(index, 1);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet newItem = ret[i];\r\n\t\t\tif (!newItem) continue;\r\n\t\t\tlet newId = newItem[this.idFieldName];\r\n\t\t\tif (newId === undefined || newId === null) continue;\r\n\t\t\tif (typeof newId === 'object') newId = newId.id;\r\n\t\t\tlet oldItem = this._items.find(v => {\r\n\t\t\t\tlet oldId = (v as any)[this.idFieldName];\r\n\t\t\t\tif (oldId === undefined || oldId === null) return false;\r\n\t\t\t\tif (typeof oldId === 'object') oldId = oldId.id;\r\n\t\t\t\treturn oldId = newId;\r\n\t\t\t});\r\n\t\t\tif (oldItem) {\r\n\t\t\t\t_.merge(oldItem, newItem);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class UqQuery<P, R> extends Entity {\r\n    get typeName(): string { return 'query';}\r\n    private pageStart: any;\r\n    private pageSize:number;\r\n    private params:any;\r\n    private more: boolean;\r\n    private startField: Field;\r\n    @observable list:IObservableArray; // = observable.array([], {deep: false});\r\n    returns: ArrFields[];\r\n    isPaged: boolean;\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {returns} = schema;\r\n        //this.returns = returns;\r\n        this.isPaged = returns && (returns as any[]).find(v => v.name === '$page') !== undefined;\r\n    }\r\n\r\n    resetPage(size:number, params:any) {\r\n        this.pageStart = undefined;\r\n        this.pageSize = size;\r\n        this.params = params;\r\n        this.more = false;\r\n        this.list = undefined;\r\n    }\r\n    get hasMore() {return this.more;}\r\n    async loadPage():Promise<void> {\r\n        if (this.pageSize === undefined) {\r\n            throw new Error('call resetPage(size:number, params:any) first');\r\n        }\r\n        let pageStart:any;\r\n        if (this.pageStart !== undefined) {\r\n            switch (this.startField.type) {\r\n                default: pageStart = this.pageStart; break;\r\n                case 'date':\r\n                case 'time':\r\n                case 'datetime': pageStart = (this.pageStart as Date).getTime(); break;\r\n            }\r\n        }\r\n\t\tlet ret = await this.page(this.params, pageStart, this.pageSize+1);\r\n\t\tlet page = (ret as any).$page;\r\n        /*\r\n        await this.loadSchema();\r\n        let res = await this.tvApi.page(this.name, pageStart, this.pageSize+1, this.params);\r\n        let data = await this.unpackReturns(res);\r\n        let page = data['$page'] as any[];\r\n        */\r\n        this.list = observable.array([], {deep: false});\r\n        if (page !== undefined) {\r\n            if (page.length > this.pageSize) {\r\n                this.more = true;\r\n                page.pop();\r\n                let ret = this.returns.find(r => r.name === '$page');\r\n                this.startField = ret.fields[0];\r\n                this.pageStart = page[page.length-1][this.startField.name];\r\n            }\r\n            else {\r\n                this.more = false;\r\n            }\r\n            this.list.push(...page);\r\n        }\r\n        //this.loaded = true;\r\n    }\r\n\r\n    protected pageCaller(params: any, showWaiting: boolean = true): QueryPageCaller {\r\n        return new QueryPageCaller(this, params, showWaiting);\r\n    }\r\n\r\n    async page(params:P, pageStart:any, pageSize:number, showWaiting: boolean = true):Promise<R> {\r\n        let p = {pageStart, pageSize, params};\r\n        let res = await this.pageCaller(p, showWaiting).request();\r\n        return res;\r\n    }\r\n    protected queryCaller(params: P, showWaiting: boolean = true): QueryQueryCaller {\r\n        return new QueryQueryCaller(this, params, showWaiting);\r\n    }\r\n    async query(params:P, showWaiting:boolean = true):Promise<R> {\r\n        let res = await this.queryCaller(params, showWaiting).request();\r\n        return res;\r\n    }\r\n    async table(params:P, showWaiting:boolean = true): Promise<any[]> {\r\n        let ret = await this.query(params, showWaiting);\r\n        for (let i in ret) {\r\n            return (ret as any)[i];\r\n        }\r\n    }\r\n    async obj(params:P, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.table(params, showWaiting);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:P, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.obj(params, showWaiting);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nexport class Query extends UqQuery<any, any> {\r\n}\r\n","import { messageHub } from \"./messageHub\";\r\n\r\nlet subAppWindow:Window;\r\nfunction postWsToSubApp(msg:any) {\r\n    if (subAppWindow === undefined) return;\r\n    subAppWindow.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport function setSubAppWindow(win:Window) {\r\n    subAppWindow = win;\r\n}\r\n\r\nexport function postWsToTop(msg:any) {\r\n    window.top.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport abstract class WsBase {\r\n\tprivate messageHub = messageHub;\r\n\t/*\r\n    wsBaseId:string;\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n\tprivate msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n\t*/\r\n\t/*\r\n    onWsReceiveAny(handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.anyHandlers[seed] = handler;\r\n        return seed;\r\n    }\r\n    onWsReceive(type:string, handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.msgHandlers[seed] = {type:type, handler: handler};\r\n        return seed;\r\n    }\r\n    endWsReceive(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n\t}\r\n\t*/\r\n    async receive(msg:any) {\r\n\t\tthis.messageHub.dispatch(msg);\r\n\t\t/*\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n\t\t}\r\n\t\t*/\r\n    }\r\n}\r\n\r\nlet wsBaseSeed = 1;\r\nexport class WsBridge extends WsBase {\r\n    wsBaseId:string = 'WsBridge seed ' + wsBaseSeed++;\r\n}\r\n\r\nexport const wsBridge = new WsBridge();\r\n\r\nexport class WSChannel extends WsBase {\r\n    wsBaseId:string = 'WSChannel seed ' + wsBaseSeed++;\r\n    static centerToken:string;\r\n    private wsHost: string;\r\n    private token: string;\r\n    private ws: WebSocket;\r\n\r\n    constructor(wsHost: string, token: string) {\r\n        super();\r\n        this.wsHost = wsHost;\r\n        this.token = token;\r\n    }\r\n\r\n    static setCenterToken(token?: string) {\r\n        WSChannel.centerToken = token;\r\n    }\r\n    \r\n    connect():Promise<void> {\r\n        //this.wsHost = wsHost;\r\n        //this.token = token || WSChannel.centerToken;\r\n        if (this.ws !== undefined) return;\r\n        let that = this;\r\n        return new Promise((resolve, reject) => {\r\n            let ws = new WebSocket(this.wsHost, this.token || WSChannel.centerToken);\r\n            console.log('connect webSocket %s', this.wsHost);\r\n            ws.onopen = (ev) => {\r\n                console.log('webSocket connected %s', this.wsHost);\r\n                that.ws = ws;\r\n                resolve();\r\n            };\r\n            ws.onerror = (ev) => {\r\n                reject('webSocket can\\'t open!');\r\n            };\r\n            ws.onmessage = async (msg) => await that.wsMessage(msg);\r\n            ws.onclose = (ev) => {\r\n                that.ws = undefined;\r\n                console.log('webSocket closed!');\r\n            }\r\n        });\r\n    }\r\n    close() {\r\n        if (this.ws !== undefined) {\r\n            this.ws.close();\r\n            this.ws = undefined;\r\n        }\r\n    }\r\n    private async wsMessage(event:any):Promise<void> {\r\n        try {\r\n            console.log('websocket message: %s', event.data);\r\n            let msg = JSON.parse(event.data);\r\n            postWsToSubApp(msg);\r\n            await this.receive(msg);\r\n        }\r\n        catch (err) {\r\n            console.log('ws msg error: ', err);\r\n        }\r\n    }\r\n    sendWs(msg:any) {\r\n        let netThis = this;\r\n        this.connect().then(() => {\r\n            netThis.ws.send(msg);\r\n        });\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { nav } from './nav';\r\n\r\nexport interface ImageProps {\r\n    src: string;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    altImage?: string;\r\n}\r\n\r\n// src = .src, 表示fontawesome Icon\r\nexport function Image(props: ImageProps) {\r\n\tlet {className, style, src, altImage} = props;\r\n\tlet icon:string;\r\n    if (src) {\r\n\t\tif (src.indexOf('.') !== 0) {\r\n\t\t\tif (src.startsWith(':') === true) {\r\n\t\t\t\tsrc = nav.resUrl + src.substr(1);\r\n\t\t\t}\r\n\t\t\treturn <img src={src} className={className} alt=\"img\"\r\n\t\t\t\tstyle={style}\r\n\t\t\t\tonError={evt=>{\r\n\t\t\t\t\tif (altImage) evt.currentTarget.src=altImage;\r\n\t\t\t\t\telse evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n\t\t\t\t}} />;\r\n\t\t}\r\n\t\ticon = src.substr(1);\r\n\t}\r\n\telse {\r\n\t\ticon = 'file-o'\r\n\t}\r\n\treturn <span className={classNames(className, 'image-none')} style={style}>\r\n\t\t<i className={'fa fa-' + icon} />\r\n\t</span>;\r\n}\r\n","import jwtDecode from 'jwt-decode';\r\n\r\nexport interface Unit {\r\n    id: number;\r\n    name: string;\r\n}\r\n\r\nexport interface Guest {\r\n    id: number;             // id = 0\r\n    guest: number;\r\n    token: string;\r\n}\r\n\r\nexport interface User extends Guest {\r\n    id: number;\r\n    name: string;\r\n    nick?: string;\r\n    icon?: string;\r\n}\r\n\r\nexport function decodeUserToken(token: string): User {\r\n    let ret:any = jwtDecode(token);\r\n    let user: User = {\r\n        id: ret.id,\r\n        name: ret.name,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return user;\r\n}\r\n\r\nexport function decodeGuestToken(token: string): Guest {\r\n    let ret:any = jwtDecode(token);\r\n    let guest: Guest = {\r\n        id: 0,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return guest;\r\n}\r\n","import { env } from '../tool';\r\n\r\nconst centerHost = process.env['REACT_APP_CENTER_HOST'];\r\nconst centerDebugHost = 'localhost:3000'; //'192.168.86.64';\r\nconst resHost = process.env['REACT_APP_RES_HOST'] || centerHost;\r\nconst resDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugBuilderHost = 'localhost:3009';\r\ninterface HostValue {\r\n    value: string;\r\n\tlocal: boolean;\r\n}\r\nconst hosts:{[name:string]:HostValue} = {\r\n    centerhost: {\r\n        value: process.env['REACT_APP_CENTER_DEBUG_HOST'] || centerDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    reshost: {\r\n        value: process.env['REACT_APP_RES_DEBUG_HOST'] || resDebugHost,\r\n\t\tlocal: false,\r\n    },\r\n    uqhost: {\r\n        value: process.env['REACT_APP_UQ_DEBUG_HOST'] || uqDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    unitxhost: {\r\n        value: process.env['REACT_APP_UQ_DEBUG_HOST'] || uqDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    \"uq-build\": {\r\n        value: process.env['REACT_APP_UQ_DEBUG_BUILDER_HOST'] || uqDebugBuilderHost, \r\n\t\tlocal: false,\r\n    }\r\n}\r\n\r\nconst httpArr = ['https://', 'http://'];\r\nfunction isAbsoluteUrl(url:string):boolean {\r\n    for (let str of httpArr) {\r\n        if (url.startsWith(str) === true) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction urlFromHost(host:string):string {\r\n    if (isAbsoluteUrl(host) === true) {\r\n        if (host.endsWith('/')) return host;\r\n        return host + '/';\r\n    }\r\n    return `http://${host}/`;\r\n}\r\n\r\nfunction centerUrlFromHost(host:string):string {\r\n    return urlFromHost(host);\r\n}\r\nfunction centerWsFromHost(host:string) {\r\n    let https = 'https://';\r\n    if (host.startsWith(https) === true) {\r\n        host = host.substr(https.length);\r\n        if (host.endsWith('/') === true) host = host.substr(0, host.length-1);\r\n        return 'wss://' + host + '/tv/';\r\n    }\r\n    return `ws://${host}/tv/`\r\n}\r\nexport function resUrlFromHost(host:string) {\r\n\tif (!host) return;\r\n    let url = urlFromHost(host);\r\n    return url + 'res/';\r\n}\r\n\r\nconst fetchOptions = {\r\n    method: \"GET\",\r\n    mode: \"no-cors\", // no-cors, cors, *same-origin\r\n    headers: {\r\n        \"Content-Type\": \"text/plain\"\r\n    },\r\n};\r\n\r\nclass Host {\r\n    testing: boolean;\r\n    url: string;\r\n    ws: string;\r\n    resHost: string;\r\n\r\n    async start(testing:boolean) {\r\n\t\tif (!centerHost) debugger;\r\n        this.testing = testing;\r\n        if (env.isDevelopment === true) {\r\n            await this.tryLocal();\r\n        }\r\n        let host = this.getCenterHost();\r\n        this.url = centerUrlFromHost(host);\r\n        this.ws = centerWsFromHost(host);\r\n\t\tthis.resHost = this.getResHost();\r\n    }\r\n\r\n    private debugHostUrl(host:string) {return `http://${host}/hello`}\r\n    private async tryLocal() {\r\n        let promises:PromiseLike<any>[] = [];\r\n        let hostArr:string[] = [];\r\n        for (let i in hosts) {\r\n            let hostValue = hosts[i];\r\n            let {value} = hostValue;\r\n            if (hostArr.findIndex(v => v === value) < 0) hostArr.push(value);\r\n        }\r\n\r\n        for (let host of hostArr) {\r\n            let fetchUrl = this.debugHostUrl(host);\r\n            promises.push(localCheck(fetchUrl));\r\n        }\r\n        let results = await Promise.all(promises);\r\n        let len = hostArr.length;\r\n        for (let i=0; i<len; i++) {\r\n            let local = results[i];\r\n            let host = hostArr[i];\r\n            for (let j in hosts) {\r\n                let hostValue = hosts[j];\r\n                if (hostValue.value === host) {\r\n                    hostValue.local = local;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private getCenterHost():string {\r\n        let {value, local} = hosts.centerhost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return centerHost;\r\n    }\r\n\r\n    private getResHost():string {\r\n        let {value, local} = hosts.reshost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return resHost;\r\n    }\r\n\r\n    getUrlOrDebug(url:string, debugHost:string = 'uqhost'):string {\r\n        if (env.isDevelopment === false) return url;\r\n        let host = hosts[debugHost];\r\n        if (host === undefined) return url;\r\n        let {value, local} = host;\r\n        if (local === false) return url;\r\n        return `http://${value}/`;\r\n    }\r\n    getUrlOrTest(db:string, url:string, urlTest:string):string {\r\n\t\tlet path:string;\r\n\t\tif (!urlTest) {\r\n\t\t\turlTest = url;\r\n\t\t\tif (!urlTest) {\r\n\t\t\t\tconsole.error('no server set for ' + db);\r\n\t\t\t\tdebugger;\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (!url) {\r\n\t\t\turl = urlTest;\r\n\t\t\tthis.testing = true\r\n\t\t}\r\n        if (this.testing === true) {\r\n            if (urlTest !== '-') url = urlTest;\r\n            path = 'uq/test/' + db + '/';\r\n        }\r\n        else {\r\n            path = 'uq/prod/' + db + '/';\r\n        }\r\n\t\turl = this.getUrlOrDebug(url);\r\n\t\tif (url.endsWith('/') === false) {\r\n\t\t\turl += '/';\r\n\t\t}\r\n        return url + path;\r\n    }\r\n\r\n    async localCheck(urlDebug: string):Promise<boolean> {\r\n        return await localCheck(urlDebug);\r\n    }\r\n}\r\n\r\nexport const host:Host = new Host();\r\n\r\n// 因为测试的都是局域网服务器，甚至本机服务器，所以一秒足够了\r\n// 网上找了上面的fetch timeout代码。\r\n// 尽管timeout了，fetch仍然继续，没有cancel\r\n\r\n// 实际上，一秒钟不够。web服务器会自动停。重启的时候，可能会比较长时间。也许两秒甚至更多。\r\n//const timeout = 2000;\r\nconst timeout = 2000;\r\n\r\nfunction fetchLocalCheck(url:string):Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n      fetch(url, fetchOptions as any)\r\n      .then(v => {\r\n          v.text().then(resolve).catch(reject);\r\n      })\r\n      .catch(reject);\r\n      const e = new Error(\"Connection timed out\");\r\n      env.setTimeout('fetchLocalCheck', reject, timeout, e);\r\n    });\r\n}\r\n\r\nasync function localCheck(url:string):Promise<boolean> {\r\n    try {\r\n\t\tawait fetchLocalCheck(url);\r\n        return true;\r\n    }\r\n    catch (err) {\r\n        return false;\r\n    }\r\n}\r\n\r\n/*\r\nexport interface IUqForChannel {\r\n    uq: string;\r\n    uqVersion: number;\r\n}\r\n*/","export * from './form';\r\nexport * from './multiStep';","import React from 'react';\r\nimport { PageHeaderProps } from './pageHeader';\r\n\r\nconst scrollAfter = 20; // 20ms之后，scroll执行\r\nexport class Scroller {\r\n    private el: HTMLBaseElement;\r\n    constructor(el: HTMLBaseElement) {\r\n        this.el = el;\r\n    }\r\n\r\n    scrollToTop():void {\r\n        setTimeout(() => this.el.scrollTo(0, 0), scrollAfter);\r\n    }\r\n    scrollToBottom():void {\r\n        setTimeout(() => this.el.scrollTo(0, this.el.scrollTop + this.el.offsetHeight), scrollAfter);\r\n    }\r\n}\r\n\r\nexport interface ScrollProps {\r\n    onScroll?: (e:any) => void;\r\n    onScrollTop?: (scroller: Scroller) => Promise<boolean>;\r\n\tonScrollBottom?: (scroller: Scroller) => Promise<void>;\r\n\tclassName?: string;\r\n}\r\ninterface ScrollViewProps extends ScrollProps {\r\n\tclassName?: string;\r\n\tstyle?: React.CSSProperties;\r\n}\r\nconst scrollTimeGap = 100;\r\nabstract class ScrollViewBase<T extends ScrollViewProps> extends React.Component<T, null> {\r\n    private bottomTime:number = 0;\r\n\tprivate topTime:number = 0;\r\n\tprivate div: HTMLDivElement;\r\n\r\n\tprotected refDiv = (div:HTMLDivElement) => {\r\n\t\tif (!div) {\r\n\t\t\tif (this.div) {\r\n\t\t\t\tthis.div.removeEventListener('resize', this.onResize)\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.div = div;\r\n\t\tthis.div.addEventListener('resize', this.onResize);\r\n\t}\r\n\r\n\tprivate onResize = (ev:UIEvent) => {\r\n\t\tconsole.error('div resize');\r\n\t};\r\n\r\n    protected onScroll = async (e:any) => {\r\n        let {onScroll, onScrollTop, onScrollBottom} = this.props;\r\n        if (onScroll) onScroll(e);\r\n        let el = e.target as HTMLBaseElement;\r\n        let scroller = new Scroller(el);\r\n        if (el.scrollTop < 30) {\r\n            if (onScrollTop !== undefined) {\r\n                let topTime = new Date().getTime();\r\n                if (topTime-this.topTime > scrollTimeGap) {\r\n                    this.topTime = topTime;\r\n\t\t\t\t\tonScrollTop(scroller).then(ret => {\r\n\t\t\t\t\t\t // has more\r\n\t\t\t\t\t\tif (ret === true) {\r\n\t\t\t\t\t\t\tlet sh = el.scrollHeight;\r\n\t\t\t\t\t\t\tlet top = 200;\r\n\t\t\t\t\t\t\tif (top > sh) top = sh;\r\n\t\t\t\t\t\t\tel.scrollTop = top;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n                }\r\n            }\r\n        }\r\n        if (el.scrollTop + el.offsetHeight > el.scrollHeight - 30) {\r\n            //this.eachChild(this, 'bottom');\r\n            if (onScrollBottom !== undefined) {\r\n                let bottomTime = new Date().getTime();\r\n                if (bottomTime - this.bottomTime > scrollTimeGap) {\r\n                    this.bottomTime = bottomTime;\r\n                    onScrollBottom(scroller);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    private eachChild(c:any, direct:'top'|'bottom') {\r\n        let { props } = c;\r\n        if (props === undefined)\r\n            return;\r\n        let { children } = props;\r\n        if (children === undefined)\r\n            return;\r\n        React.Children.forEach(children, (child, index) => {\r\n            let {_$scroll} = child as any;\r\n            if (_$scroll) _$scroll(direct);\r\n            console.log(child.toString());\r\n            this.eachChild(child, direct);\r\n        });\r\n\t}\r\n}\r\n\r\nexport class ScrollView extends ScrollViewBase<ScrollViewProps> {\r\n    render() {\r\n\t\tlet {className, style} = this.props;\r\n\t\treturn <div ref={this.refDiv} className=\"tv-page\"\r\n\t\t\tonScroll={this.onScroll} style={style}>\r\n\t\t\t<article className={className}>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</article>\r\n\t\t</div>;\r\n    }\r\n}\r\n\r\nexport interface PageWebNav {\r\n\tnavHeader?: JSX.Element; \r\n\tnavRawHeader?: JSX.Element; \r\n\tnavFooter?: JSX.Element; \r\n\tnavRawFooter?: JSX.Element; \r\n\trenderPageHeader?: (props:PageHeaderProps)=>JSX.Element;\r\n}\r\ninterface WebNavScrollViewProps extends ScrollViewProps {\r\n\twebNav: PageWebNav;\r\n}\r\n\r\nexport class WebNavScrollView extends ScrollViewBase<WebNavScrollViewProps> {\r\n    render() {\r\n\t\tlet {className, style, webNav} = this.props;\r\n\t\tlet {navHeader, navRawHeader, navFooter, navRawFooter} = webNav;\r\n\t\tlet vHeader:any, vFooter:any;\r\n\t\tif (navRawHeader) vHeader = navRawHeader;\r\n\t\telse if (navHeader) vHeader = <header><main>{navHeader}</main></header>\r\n\t\tif (navRawFooter) vFooter = navRawFooter;\r\n\t\telse if (navFooter) vFooter = <footer><main>{navFooter}</main></footer>\r\n\r\n\t\treturn <div ref={this.refDiv} className=\"tv-page-webnav\"\r\n\t\t\tonScroll={this.onScroll} style={style}>\r\n\t\t\t{vHeader}\r\n\t\t\t<article className={className}>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</article>\r\n\t\t\t{vFooter}\r\n\t\t</div>;\r\n    }\r\n}\r\n","import { Entity } from './entity';\r\nimport { ActionCaller } from './caller';\r\n\r\nexport class UqAction<P, R> extends Entity {\r\n    get typeName(): string { return 'action';}\r\n    async submit(data:P, waiting: boolean = true) {\r\n\t\tlet caller = new ActionSubmitCaller(this, data)\r\n\t\tlet ret = await caller.request();\r\n\t\treturn ret;\r\n    }\r\n    async submitReturns(data:P):Promise<R> {\r\n       return await new SubmitReturnsCaller(this, data).request();\r\n    }\r\n    async submitConvert(data:P) {\r\n        return await new SubmitConvertCaller(this, data).request();\r\n    }\r\n}\r\n\r\nexport class Action extends UqAction<any, any> {\r\n}\r\n\r\nexport class ActionSubmitCaller extends ActionCaller {\r\n    get path():string {return 'action/' + this.entity.name;}\r\n    buildParams():any {\r\n\t\treturn {data: this.entity.pack(this.params)}\r\n\t}\r\n}\r\n\r\nclass SubmitReturnsCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action/' + this.entity.name + '/returns';}\r\n    xresult(res:any):any {\r\n        let {returns} = this.entity;\r\n        let len = returns.length;\r\n        let ret:{[r:string]:any[]} = {};\r\n        for (let i=0; i<len; i++) {\r\n            let retSchema = returns[i];\r\n            ret[retSchema.name] = res[i];\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass SubmitConvertCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action-convert/' + this.entity.name;}\r\n    buildParams():any {\r\n        return {\r\n            data: this.params\r\n        };\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-badge.css';\r\n\r\nexport interface BadgeProps {\r\n    className?: string;\r\n    badge?: string|number;\r\n    size?: 'xs' | 'sm' | 'lg';\r\n    color?: 'secondary'|'success'|'danger'|'primary'|'info'|'warning';\r\n    badgeAlign?: 'left'|'center'|'right';\r\n    badgeVertical?: 'top'|'middle'|'bottom';\r\n}\r\n\r\n@observer\r\nexport class Badge extends React.Component<BadgeProps> {\r\n    render() {\r\n        let {className, badge, size, color, badgeAlign, badgeVertical, children} = this.props;\r\n        let cn = classNames(\r\n            className,\r\n            'va-badge',\r\n            size && 'va-badge-'+size,\r\n            'va-badge-' + (color||'secondary'),\r\n            badgeAlign && 'va-badg-'+badgeAlign,\r\n            badgeVertical && 'va-badg-'+badgeVertical,\r\n        );\r\n        let b;\r\n        if (badge) b = <b>{badge}</b>;\r\n        return <div className={cn}>\r\n            {children}\r\n            {b}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-lmr.css';\r\n\r\nexport interface LMRProps {\r\n    className?: string | string[];\r\n    left?: string|JSX.Element;\r\n    right?: string|JSX.Element;\r\n    onClick?: ()=>void;\r\n}\r\n\r\n@observer\r\nexport class LMR extends React.Component<LMRProps> {\r\n    render() {\r\n        let {className, left, children, right, onClick} = this.props;\r\n        let l, r;\r\n        if (left !== undefined) l = <header>{left}</header>;\r\n        if (right !== undefined) r = <footer>{right}</footer>;\r\n        let cursor;\r\n        if (onClick !== undefined) cursor = 'cursor-pointer';\r\n        return <div className={classNames('va-lmr', className, cursor)} onClick={onClick}>\r\n            {l}\r\n            <div>{children}</div>\r\n            {r}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface FAProps {\r\n    name: string;\r\n    className?: string;\r\n    size?: 'lg'|'2x'|'3x'|'4x'|'5x';\r\n    spin?: boolean;\r\n    fixWidth?: boolean;\r\n    border?: boolean;\r\n    pull?: 'left'|'right';\r\n    pulse?: boolean;\r\n    rotate?: 90|180|270;\r\n    flip?: 'horizontal'|'vertical';\r\n    inverse?: boolean;\r\n}\r\n\r\nexport class FA extends React.Component<FAProps> {\r\n    render() {\r\n        let {name, className, size, spin, fixWidth, border, pull, pulse, rotate, flip, inverse} = this.props;\r\n        let cn = classNames(className, 'fa',\r\n            name && ('fa-' + name),\r\n            size && 'fa-'+size,\r\n            fixWidth && 'fa-fw',\r\n            border && 'fa-border',\r\n            pull && 'fa-pull-' + pull,\r\n            spin && 'fa-spin',\r\n            pulse && 'fa-pulse',\r\n            rotate && 'fa-rotate-' + rotate,\r\n            flip && 'fa-flip-' + flip,\r\n            inverse && 'fa-inverse',\r\n        );\r\n        return <i className={cn} />\r\n    }\r\n}\r\n\r\nexport interface StackedFAProps {\r\n    className?: string;\r\n    size?: 'lg',\r\n}\r\nexport class StackedFA extends React.Component<StackedFAProps> {\r\n    render() {\r\n        let {className, size, children} = this.props;\r\n        let cn = classNames(\r\n            'fa-stack',\r\n            className,\r\n            size && 'fa-' + size);\r\n        return <span className={cn}>\r\n            {children}\r\n        </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport const Muted = (props:any) => \r\n<small className={classNames('text-muted', props.className)} style={props.style}>\r\n    {props.children}\r\n</small>;\r\n","import * as React from 'react';\r\nimport {FA} from './FA';\r\n\r\nexport interface IconTextProps {\r\n    icon: string;\r\n    iconClass?: string;\r\n    text: string;\r\n    textClass?: string;\r\n}\r\n\r\nexport class IconText extends React.Component<IconTextProps> {\r\n    render() {\r\n        let {icon, iconClass, text, textClass} = this.props;\r\n        return <div className=\"py-2\">\r\n            <FA className={iconClass} name={icon} fixWidth={true} />\r\n            <span className={textClass}>{text}</span>\r\n        </div>;\r\n    }\r\n}\r\n","import _ from 'lodash';\r\n\r\nclass _LocalStorage {\r\n    getItem(key:string) {\r\n        return localStorage.getItem(key)\r\n    }\r\n    setItem(key:string, value:string) {\r\n        localStorage.setItem(key, value);\r\n    }\r\n    removeItem(key:string) {\r\n        localStorage.removeItem(key);\r\n    }\r\n}\r\n\r\nconst __ls = new _LocalStorage(); // new Ls;\r\n\r\nexport class LocalCache {\r\n    private readonly local: Local;\r\n    //private value: T;\r\n    readonly key: string|number;\r\n\r\n    constructor(local:Local, key:string|number) {\r\n        this.local = local;\r\n        this.key = key;\r\n    }\r\n    get():any {\r\n        try {\r\n            // 下面缓冲的内容不能有，可能会被修改，造成circular引用\r\n            //if (this.value !== undefined) return this.value;\r\n            let text = this.local.getItem(this.key);\r\n            if (text === null) return;\r\n            if (text === undefined) return undefined;\r\n            //return this.value = \r\n            return JSON.parse(text);\r\n        }\r\n        catch (err) {\r\n            this.local.removeItem(this.key);\r\n            return;\r\n        }\r\n    }\r\n    set(value:any) {\r\n\t\tlet t = JSON.stringify(value, (key, value) => {\r\n\t\t\tif (key !== '_tuid') return value;\r\n\t\t});\r\n\t\tthis.local.setItem(this.key, t);\r\n    }\r\n    remove(local?:Local) {\r\n        if (local === undefined) {\r\n            this.local.removeItem(this.key);\r\n        }\r\n        else {\r\n            this.local.removeLocal(local);\r\n        }\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        return this.local.child(key);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        return this.local.arr(key);\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        return this.local.map(key);\r\n    }\r\n}\r\n\r\nabstract class Local {\r\n    private readonly caches: {[key:string]:LocalCache};\r\n    private readonly locals: {[key:string]:Local};\r\n    protected readonly name: string;\r\n    constructor(name: string) {\r\n        this.name = name;\r\n        this.caches = {};\r\n        this.locals = {};\r\n    }\r\n\r\n    protected abstract keyForGet(key:string|number):string;\r\n    protected abstract keyForSet(key:string|number):string;\r\n    protected abstract keyForRemove(key:string|number):string;\r\n    abstract removeAll():void;\r\n    getItem(key:string|number):string {\r\n        let k = this.keyForGet(key);\r\n        if (k === undefined) return;\r\n        return __ls.getItem(k);\r\n    }\r\n    setItem(key:string|number, value: string):void {\r\n        let k = this.keyForSet(key);\r\n        __ls.setItem(k, value);\r\n    }\r\n    removeItem(key:string|number):void {\r\n        let k = this.keyForSet(key);\r\n        if (k === undefined) return;\r\n        localStorage.removeItem(k);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        let sk = String(key);\r\n        let arr = this.locals[sk] as LocalArr;\r\n        if (arr === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = arr = new LocalArr(k);\r\n        }\r\n        return arr;\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        let sk = String(key);\r\n        let map = this.locals[sk] as LocalMap;\r\n        if (map === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = map = new LocalMap(k);\r\n        }\r\n        return map;\r\n    }\r\n    removeLocal(local:Local) {\r\n        let sk = local.name;\r\n        let k = this.keyForRemove(sk);\r\n        if (k === undefined) return;\r\n        let arr = this.locals[sk];\r\n        if (arr === undefined) arr = new LocalArr(k);\r\n        else this.locals[sk] = undefined;\r\n        arr.removeAll();\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        let ks = String(key);\r\n        let ret = this.caches[ks];\r\n        if (ret !== undefined) return ret;\r\n        return this.caches[ks] =ret = new LocalCache(this, key);\r\n    }\r\n}\r\n\r\nconst maxArrSize = 500;\r\nexport class LocalArr extends Local {\r\n    private readonly index: number[];\r\n    constructor(name: string) {\r\n        super(name);\r\n        let index = __ls.getItem(this.name);\r\n        this.index = index === null? [] : index.split('\\n').map(v => Number(v));\r\n    }\r\n    private saveIndex() {\r\n        __ls.setItem(this.name, this.index.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i < 0) return undefined;\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i<0) {\r\n            this.index.unshift(key);\r\n            if (this.index.length > maxArrSize) this.index.pop();\r\n        }\r\n        else {\r\n            this.index.splice(i, 1);\r\n            this.index.unshift(key)\r\n        }\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForRemove(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i<0) return;\r\n        this.index.splice(i, 1);\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i of this.index) {\r\n            __ls.removeItem(`${this.name}.${i}`);\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.index.splice(0);\r\n    }\r\n    item(index:number):LocalCache {\r\n        return this.child(index);\r\n    }\r\n}\r\n\r\nexport class LocalMap extends Local {\r\n    private readonly index: {[key:string]:number};\r\n    private max: number;\r\n    constructor(name: string) {\r\n        super(name);\r\n        this.max = 0;\r\n        this.index = {};\r\n        let index = __ls.getItem(this.name);\r\n        if (index !== null) {\r\n            let ls = index.split('\\n');\r\n            ls.forEach(l => {\r\n                let p = l.indexOf('\\t');\r\n                if (p<0) return;\r\n                let key = l.substr(0, p);\r\n                let i = Number(l.substr(p+1));\r\n                if (isNaN(i) === true) return;\r\n                this.index[key] = i;\r\n                if (i>this.max) this.max = i;\r\n            });\r\n        }\r\n    }\r\n    private saveIndex() {\r\n        let ls:string[] = [];\r\n        for (let k in this.index) {\r\n            let v = this.index[k];\r\n            if (v === undefined) continue;\r\n            ls.push(`${k}\\t${v}`);\r\n        }\r\n        __ls.setItem(this.name, ls.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) return undefined;\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) {\r\n            ++this.max;\r\n            i = this.max;\r\n            this.index[key] = i;\r\n            this.saveIndex();\r\n        }\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForRemove(key:string|number):string {\r\n        let i = this.index[key];\r\n        if (i===undefined) return;\r\n        this.index[key] = undefined;\r\n        this.saveIndex();\r\n        return `${this.name}.${i}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i in this.index) {\r\n            __ls.removeItem(`${this.name}.${this.index[i]}`);\r\n            this.index[i] = undefined;\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.max = 0;\r\n    }\r\n    item(key:string):LocalCache {\r\n        return this.child(key);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { BoxId } from './boxId';\r\nimport { Tuid } from './tuid';\r\nimport { observer } from 'mobx-react';\r\n\r\nconst TuidContent = (tuidName:string, values:any, x?:any) => {\r\n    return <>{tuidName}: {uqStringify(values)}</>;\r\n};\r\n\r\nexport function uqStringify(values: any): string {\r\n    let s = '{';\r\n    if (values === undefined) return 'undefined';\r\n    for (let i in values) {\r\n        let v = values[i];\r\n        s += i + ': ';\r\n        if (v === undefined) {\r\n            s += 'undefined';\r\n        }\r\n        else if (v === null) {\r\n            s += 'null';\r\n        }\r\n        else {\r\n            switch (typeof v) {\r\n                default:\r\n                    s += v;\r\n                    break;\r\n                case 'function':\r\n                    s += 'function';\r\n                    break;\r\n                case 'object':\r\n                    s += '{obj}';\r\n                    break;\r\n            }\r\n        }\r\n        s += ', ';\r\n    }\r\n    return s + '}';\r\n}\r\n\r\nexport class ReactBoxId implements BoxId {\r\n    readonly id: number;\r\n    protected tuid: Tuid;\r\n    protected ui: (values:any) => JSX.Element;\r\n    readonly isUndefined:boolean;\r\n    constructor(id: number, tuid: Tuid, ui: (values:any) => JSX.Element) {\r\n        this.id = Number(id);\r\n        this.tuid = tuid;\r\n        this.ui = ui;\r\n        this.isUndefined = (this.tuid === undefined);\r\n    }\r\n\r\n    get obj():any {\r\n        return this.tuid.valueFromId(this.id);\r\n    }\r\n\r\n    equ(id:BoxId|number): boolean {\r\n        if (id === undefined || id === null) return false;\r\n        if (typeof id === 'object') return this.id === id.id;\r\n        return this.id === id;\r\n    }\r\n\r\n    render(ui:TvTemplet, x:any):JSX.Element {\r\n        if (this.id === undefined || this.id === null || isNaN(this.id) === true) return;\r\n        let boxName = this.boxName; // this.tuid.name;\r\n        let val = this.obj; // this.tuid.valueFromId(this.id);\r\n        if (this.isUndefined === true) {\r\n            if (ui !== undefined) return ui(val, x);\r\n            return TuidContent(boxName, val, x);\r\n        }\r\n        switch (typeof val) {\r\n            case 'undefined':\r\n                return <span className=\"text-black-50\">{boxName} undefined</span>;\r\n            case 'number':\r\n                return <span className=\"text-light\">{boxName} {this.id}</span>;\r\n        }\r\n        if (ui === undefined) {\r\n            ui = this.ui;\r\n        }\r\n        if (ui !== undefined) {\r\n            if (typeof ui !== 'function') {\r\n                ui = (ui as any).content;\r\n            }\r\n            if (ui !== undefined) {\r\n                let ret = ui(val/*, this.tuidUR.res*/);\r\n                if (ret !== undefined) return ret;\r\n                return <span className=\"text-danger\">{boxName} {this.id}</span>;\r\n            }\r\n        }\r\n\r\n        return TuidContent(boxName, val);\r\n    }\r\n\r\n    get boxName():string {return this.tuid.name}\r\n    // ui(): TvTemplet {return this.tuid.ui}\r\n    // res(): any {return this.tuid.res}\r\n\r\n    async assure(): Promise<BoxId> {\r\n        await this.tuid.assureBox(this.id);\r\n        return this;\r\n    }\r\n}\r\n\r\nfunction boxIdContent(bi: number|BoxId, ui:TvTemplet, x:any) {\r\n    let logContent:any;\r\n    let boxId:ReactBoxId = bi as ReactBoxId;\r\n    switch(typeof bi) {\r\n        case 'undefined': logContent = <>boxId undefined</>; break;\r\n        case 'number': logContent = <>id:{bi}</>; break;\r\n        default:\r\n            if (typeof boxId.render !== 'function') {\r\n                if (ui === undefined) {\r\n                    logContent = TuidContent(boxId.boxName, bi, x);\r\n                }\r\n                else {\r\n                    return ui(bi, x);\r\n                }\r\n            }\r\n            break;\r\n    }\r\n    if (logContent !== undefined) {\r\n        return <del className=\"text-danger\">{logContent}</del>;\r\n    }\r\n    return boxId.render(ui, x);\r\n}\r\n\r\nexport type TvTemplet = (values?:any, x?:any) => JSX.Element;\r\n\r\ninterface Props {\r\n    tuidValue: number|BoxId, \r\n    ui?: TvTemplet,\r\n    x?: any,\r\n    nullUI?: ()=>JSX.Element\r\n}\r\n\r\nconst Tv = observer(({tuidValue, ui, x, nullUI}:Props) => {\r\n    if (tuidValue === undefined) {\r\n        if (nullUI === undefined) return <small className=\"text-muted\">[无]</small>;\r\n        return nullUI();\r\n    }\r\n    if (tuidValue === null) {\r\n        if (nullUI === undefined) return <>[null]</>;\r\n        return nullUI();\r\n    }\r\n    let ttv = typeof tuidValue;\r\n    switch (ttv) {\r\n        default:\r\n            if (ui === undefined)\r\n                return <>{ttv}-{tuidValue}</>;\r\n            else {\r\n                let ret = ui(tuidValue, x);\r\n                if (ret !== undefined) return ret;\r\n                return <>{tuidValue}</>;\r\n            }\r\n        case 'object':\r\n            let divObj = boxIdContent(tuidValue, ui, x);\r\n            if (divObj !== undefined) return divObj;\r\n            return nullUI === undefined? <>id null</>: nullUI();\r\n        case 'number':\r\n            return <>id...{tuidValue}</>;\r\n    }\r\n});\r\n\r\nexport const tv = (tuidValue:number|BoxId, ui?:TvTemplet, x?:any, nullUI?:()=>JSX.Element):JSX.Element => {\r\n    return <Tv tuidValue={tuidValue} ui={ui} x={x} nullUI={nullUI} />;\r\n};\r\n","import * as React from 'react';\r\n\r\nexport function Loading() {\r\n    return <div className=\"d-flex h-100 align-items-center justify-content-center\">\r\n        <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />\r\n    </div>;\r\n}\r\n","import * as React from 'react';\r\nimport {observable, computed} from 'mobx';\r\nimport {FormView} from '../formView';\r\nimport {Field} from '../field';\r\nimport {Face} from '../face';\r\nimport {Rule} from '../rule';\r\n\r\nexport abstract class ControlBase {\r\n    protected formView: FormView;\r\n    constructor(formView:FormView) {\r\n        this.formView = formView;\r\n    }\r\n    render():JSX.Element {\r\n        return <div className=\"col-sm-10\">\r\n            {this.renderControl()}\r\n        </div>;\r\n    }\r\n    protected abstract renderControl():JSX.Element;\r\n    @computed get hasError():boolean {return false;}\r\n    @computed get filled():boolean {return false;}\r\n    clear() {}\r\n    clearErrors() {}\r\n    readValues(values:any):any {}\r\n    setError(fieldName:string, error:string) {}\r\n    setInitValues(values: any) {}\r\n    isOk():boolean {this.validate(); return !this.hasError;}\r\n    protected validate() {}\r\n}\r\n\r\nexport abstract class Control extends ControlBase {\r\n    protected _field: Field;\r\n    protected _face: Face;\r\n    protected props: any;\r\n    protected rules: Rule[];\r\n\r\n    protected element: HTMLElement;\r\n    @observable protected isOK?: boolean;\r\n    @observable protected error: string;\r\n    @observable protected value: any;\r\n\r\n    constructor(formView:FormView, field:Field, face:Face) {\r\n        super(formView);\r\n        if (field === undefined) debugger;\r\n        this._field = field;\r\n        this._face = face;\r\n        this.init();\r\n        this.setProps();\r\n    }\r\n    protected ref(element: HTMLElement) {\r\n        this.element = element;\r\n    }\r\n    protected init() {\r\n        this.rules = [];\r\n        let r = this._field.rules;\r\n        if (r !== undefined) {\r\n            if (Array.isArray(r) === true) this.rules.push(...(r as Rule[]));\r\n            else this.rules.push(r as Rule);\r\n        }\r\n    };\r\n    protected setProps():any {\r\n        return this.props = {\r\n            ref: this.ref.bind(this),\r\n            name: this._field.name,\r\n        }\r\n    };\r\n    @computed get hasError():boolean {return this.error !== undefined;}\r\n    @computed get filled():boolean {\r\n        let ret = this.value !== undefined && this.value !== this._field.defaultValue;\r\n        return ret;\r\n    }\r\n    clearValue() { this.value = undefined; }\r\n    clear() { this.clearErrors(); this.clearValue(); }\r\n    clearErrors() { this.isOK = undefined; this.error = undefined; }\r\n    readValues(values:any):any {\r\n        values[this._field.name] = this.value;\r\n    }\r\n    setError(fieldName:string, error:string) {}\r\n    setInitValues(values: any) {}\r\n    protected getValueFromElement():any {return this.value;}\r\n    protected validate() {\r\n        try {\r\n            let v = this.getValueFromElement();\r\n            if (this.rules.length > 0) {\r\n                let isOk:boolean;\r\n                for (let rule of this.rules) {\r\n                    console.log('validate: %s', v);\r\n                    let err = rule(v);\r\n                    console.log('validate: %s err: %s', v, err);\r\n                    if (err === true) {\r\n                        this.error = undefined;\r\n                        isOk = true;\r\n                    }\r\n                    else if (err !== undefined) {\r\n                        //console.log('field %s onBlur v=%s rule=%s err=%s', \r\n                        //    this.field.name, JSON.stringify(v), rule, err);\r\n                        this.error = err;\r\n                        this.isOK = false;\r\n                        return;\r\n                    }\r\n                }\r\n                this.isOK = isOk;\r\n            }\r\n            this.value = v;\r\n        }\r\n        catch (e:any) {\r\n            this.error = e.message;\r\n        }\r\n    }\r\n    render():JSX.Element {\r\n        let n:any;\r\n        if (this._face !== undefined) {\r\n            let {notes} = this._face;\r\n            if (notes !== undefined) n = <small className=\"text-muted\">{notes}</small>;\r\n        }\r\n        return <div className=\"col-sm-10\">\r\n            {this.renderControl()}\r\n            {n}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport {BoolField} from '../field';\r\nimport {CheckBoxFace} from '../face';\r\nimport {Control} from './control';\r\n\r\nexport class CheckControl extends Control {    \r\n    protected element: HTMLInputElement;\r\n    private trueValue: any;\r\n    private falseValue: any;\r\n\r\n    protected get field(): BoolField {return this._field as BoolField}\r\n    protected get face(): CheckBoxFace {return this._face as CheckBoxFace}\r\n\r\n    protected init() {\r\n        super.init();\r\n        let {trueValue, falseValue} = this.field;\r\n        if (trueValue === undefined) this.trueValue = 1;\r\n        if (falseValue === undefined) this.falseValue = 0;\r\n    }\r\n\r\n    setProps() {\r\n        super.setProps();\r\n        _.assign(this.props, {\r\n            onChange: this.onChange.bind(this),\r\n        });\r\n    }\r\n\r\n    clearValue() {\r\n        this.element.checked = this._field.defaultValue === this.trueValue;\r\n        this.value = this.getValueFromElement();\r\n    }\r\n\r\n    setInitValues(values: any) {\r\n        let v = values[this._field.name];\r\n        if (v === undefined) {\r\n            v = this._field.defaultValue;\r\n        }\r\n        if (v !== undefined) {\r\n            //this.element.checked = v === this.trueValue;\r\n            //this.value = this.getValueFromElement();\r\n        }\r\n    }\r\n\r\n    protected getValueFromElement():any { return this.element.checked? this.trueValue:this.falseValue; }\r\n\r\n    private onChange() {\r\n        this.value = this.getValueFromElement();\r\n    }\r\n\r\n    renderControl():JSX.Element {\r\n        return <div className=\"form-control-static\">\r\n            <label className=\"form-control\">\r\n                <label className=\"custom-control custom-checkbox mb-0\">\r\n                    <input type='checkbox'\r\n                        name={this._field.name}\r\n                        ref={this.props.ref}\r\n                        onChange={this.props.onChange}\r\n                        className=\"custom-control-input\" />\r\n                    <span className=\"custom-control-indicator\" />\r\n                    <span className=\"custom-control-description\">{this.face.label}</span>\r\n                </label>\r\n            </label>\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {RadioFace} from '../face';\r\nimport {Control} from './control';\r\n\r\nexport class RadioControl extends Control {\r\n    protected get face(): RadioFace {return this._face as RadioFace}\r\n    renderControl():JSX.Element {\r\n        return <div className=\"form-control-static\">\r\n            <div className=\"form-control\">\r\n            {\r\n                this.face.list.map((item, index) => {\r\n                    let t:any; //, v:any;\r\n                    if (typeof item !== 'object') t = item;\r\n                    else {\r\n                        t = item.text;\r\n                        //v = item.value;\r\n                    }\r\n                    return <label key={index} className=\"custom-control custom-radio w-25\">\r\n                        <input type='radio'\r\n                            name={this._field.name} \r\n                            className=\"custom-control-input\" />\r\n                        <span className=\"custom-control-indicator\"></span>\r\n                        <span className=\"custom-control-description\">{t}</span>\r\n                    </label>;\r\n                })\r\n            }\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport _ from 'lodash';\r\nimport {Placeholder} from '../face';\r\nimport {Control} from './control';\r\n\r\nconst TxtRequired = '必须填入要求内容';\r\n\r\nexport abstract class CharsControl extends Control {\r\n    protected init() {\r\n        super.init();\r\n        if (this._field.required === true) {\r\n            this.rules.push((v) => {\r\n                if (v===null || v===undefined || (v as string).trim().length === 0) return TxtRequired;\r\n                return true;\r\n            });\r\n        }\r\n    }\r\n\r\n    protected element: HTMLInputElement;\r\n    protected getValueFromElement():any {return this.parseValue(this.element.value)}\r\n\r\n    protected setProps() {\r\n        super.setProps();\r\n        _.assign(this.props, {\r\n            onBlur: this.onBlur.bind(this),\r\n            onFocus: this.onFocus.bind(this),\r\n            onChange: this.onChange.bind(this),\r\n        });\r\n        let face = this._face as Placeholder;\r\n        if (face !== undefined) {\r\n            _.assign(this.props, {\r\n                placeholder: face.placeholder,\r\n            });\r\n        }\r\n        return this.props;\r\n    };\r\n    protected parseValue(value?:string):any {return value;}\r\n    private onBlur() {\r\n        //console.log('field %s onBlure', this.field.name);\r\n        this.validate();\r\n    }\r\n    private onChange() {\r\n        console.log('onChange');\r\n        this.validate();\r\n    }\r\n    private onFocus() {\r\n        this.clearErrors();\r\n        //this.error = undefined;\r\n        //this.formView.clearErrors();\r\n    }\r\n    protected className() {\r\n        return classNames({\r\n            \"form-control\": true,\r\n            \"has-success\": this.isOK === true,\r\n            \"is-invalid\": this.error !== undefined,\r\n            \"is-valid\": this.error === undefined && this.isOK === true,\r\n        });\r\n    }\r\n    protected renderInput():JSX.Element {\r\n        return <input className={this.className()} {...this.props} />;\r\n    }\r\n    protected ref(element: HTMLInputElement) {\r\n        super.ref(element);\r\n        if (element) {\r\n            element.value = this.value === undefined? '':this.value;\r\n        }\r\n    }\r\n    protected renderError():JSX.Element {\r\n        //if (this.field.name === 'name') console.log('charsControl renderControl');\r\n        if (this.error === undefined) return null;\r\n        return <div className=\"invalid-feedback\">{this.error}</div>\r\n    }\r\n    clearValue() { super.clearValue(); this.element.value = ''; }\r\n    setError(fieldName:string, error:string) {\r\n        if (this._field.name === fieldName) this.error = error;\r\n    }\r\n    setInitValues(values: any) {\r\n        let v = values[this._field.name];\r\n        if (v === undefined) return;\r\n        //this.element.value = v;\r\n        this.value = v;\r\n    }\r\n    renderControl():JSX.Element {\r\n        return <React.Fragment>\r\n            {this.renderInput()}\r\n            {this.renderError()}\r\n        </React.Fragment>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport * as _ from 'lodash';\r\nimport {CharsControl} from './charsControl';\r\nimport {StringField} from '../field';\r\nimport {TextAreaFace} from '../face';\r\n\r\nexport class TextAreaControl extends CharsControl {\r\n    protected get face(): TextAreaFace {return this._face as TextAreaFace}\r\n    private el: HTMLTextAreaElement;\r\n\r\n    protected get field(): StringField {return this._field as StringField}\r\n\r\n    protected setProps() {\r\n        let p = super.setProps();\r\n        let {maxLength} = this.field;\r\n        let {rows} = this.face;\r\n        _.assign(p, {\r\n            maxLength: maxLength,\r\n            rows: rows,\r\n        });\r\n        return p;\r\n    };\r\n    protected renderInput():JSX.Element {\r\n        return <textarea ref={t=>{this.el = t;if (t!==undefined) t.value=''}} className={this.className()} {...this.props} />;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {FormView} from '../formView';\r\nimport {Field} from '../field';\r\nimport {Face, SelectFace} from '../face';\r\nimport {Control} from './control';\r\n\r\nexport class SelectControl extends Control {\r\n    constructor (formView:FormView, field:Field, face:Face) {\r\n        super(formView, field, face);\r\n        this.ref = this.ref.bind(this);\r\n    }\r\n    protected get face(): SelectFace {return this._face as SelectFace}\r\n    protected element: HTMLSelectElement;\r\n    protected getValueFromElement():any {\r\n        let {selectedOptions} = this.element;\r\n        let v:any = selectedOptions[0].value;\r\n        switch (this._field.type) {\r\n            case 'number': v = Number(v); break;\r\n            case 'date': v = new Date(v); break;\r\n            case 'bool': \r\n                if (typeof v === 'string') {\r\n                    v = ((v as string).toLowerCase() === 'true');\r\n                }\r\n                break;\r\n        }\r\n        return v;\r\n    }\r\n    renderControl():JSX.Element {\r\n        let {list} = this.face;\r\n        let def = this.face.default;\r\n        let options: any[] = [];\r\n        if (def === undefined)\r\n            options.push(<option key={-1} value={undefined}>请选择</option>);\r\n        options.push(...list.map((item, index) => {\r\n            let t, v;\r\n            if (typeof item !== 'object') t = v = item;\r\n            else {\r\n                t = item.text;\r\n                v = item.value;\r\n            }\r\n            return <option key={index} value={v}>{t}</option>;\r\n        }));\r\n        return <div className=\"form-control-static\">\r\n            <select name={this._field.name} className=\"form-control\" ref={this.ref}>\r\n                {options}\r\n            </select>\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {Control, ControlBase} from './control';\r\nimport {FormView} from '../formView';\r\n\r\nexport class UnknownControl extends Control {\r\n    renderControl():JSX.Element {\r\n        return <div className=\"form-control-plaintext\">\r\n            <div className=\"alert alert-primary\" role=\"alert\">\r\n            don't know how to create control<br/>\r\n            field: {JSON.stringify(this._field)} must be object <br/>\r\n            face: {JSON.stringify(this._face)} must be object <br/>\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class EmptyControl extends ControlBase {\r\n    private element:JSX.Element;\r\n    constructor(formView:FormView, element:JSX.Element) {\r\n        super(formView);\r\n        this.element = element;\r\n    }\r\n    renderControl():JSX.Element {\r\n        return <div className=\"form-control-plaintext\">\r\n            {this.element}\r\n        </div>;\r\n    }\r\n}\r\n","import _ from 'lodash';\r\nimport {CharsControl} from './charsControl';\r\nimport {StringField} from '../field';\r\n\r\nexport class StringControl extends CharsControl {\r\n    protected get field(): StringField {return this._field as StringField}\r\n\r\n    protected setProps() {\r\n        let p = super.setProps();\r\n        _.assign(p, {\r\n            type: 'text',\r\n            maxLength: this.field.maxLength,\r\n        });\r\n        return p;\r\n    };\r\n    protected parseValue(value?:string):any {\r\n        if (value === undefined) return undefined;\r\n        if (value.trim().length === 0) return undefined;\r\n        return value;\r\n    }\r\n}\r\n\r\nexport class PasswordControl extends StringControl {\r\n    protected setProps() {\r\n        let p = super.setProps();\r\n        _.assign(p, {\r\n            type: 'password',\r\n            maxLength: this.field.maxLength,\r\n        });\r\n        return p;\r\n    };\r\n}","import _ from 'lodash';\r\nimport {IntField, DecField, NumberField} from '../field';\r\nimport {CharsControl} from './charsControl';\r\n\r\nconst ErrInvalidNumber = '无效的数字';\r\nconst ErrMin = '最小值为';\r\nconst ErrMax = '最大值为';\r\n\r\nconst KeyCode_Neg = 45;\r\nconst KeyCode_Dot = 46;\r\n\r\nexport class NumberControl extends CharsControl {\r\n    protected value: number;\r\n    protected extraChars: number[];\r\n\r\n    protected get field(): IntField | DecField | NumberField {return this._field as IntField | DecField | NumberField}\r\n    \r\n    protected init() {\r\n        super.init();\r\n        this.extraChars = [];\r\n        let {min, max} = this.field;\r\n        if (min !== undefined) {\r\n            this.rules.push((v:number) => {if (v === undefined) return; if (v<min) return ErrMin + min; return true;});\r\n            if (min < 0) this.extraChars.push(KeyCode_Neg);\r\n        }\r\n        else {\r\n            this.extraChars.push(KeyCode_Neg);\r\n        }\r\n\r\n        if (max !== undefined) {\r\n            this.rules.push((v:number) => {if (v === undefined) return; if (v>max) return ErrMax + max; return true});\r\n        }\r\n        switch (this._field.type) {\r\n            case 'dec':\r\n            case 'number': this.extraChars.push(KeyCode_Dot); break;\r\n        }\r\n    }\r\n\r\n    protected parseValue(value?:string):any {\r\n        if (value === undefined) return undefined;\r\n        if (value.trim().length === 0) return undefined;\r\n        let n = Number.parseFloat(value);\r\n        if (isNaN(n)) throw new Error(ErrInvalidNumber);\r\n        return n;\r\n    }\r\n\r\n    protected setProps() {\r\n        super.setProps();\r\n        _.assign(this.props, {\r\n            type: 'number',\r\n            step: (this._field as DecField).step,\r\n            onKeyPress: this.onKeyPress.bind(this),\r\n        });\r\n    }\r\n\r\n    onKeyPress(event:KeyboardEvent) {\r\n        let ch = event.charCode;\r\n        if (ch === 8 || ch === 0 || ch === 13 || (ch >= 48 && ch <= 57)) return;\r\n        if (this.extraChars !== undefined) {\r\n            if (this.extraChars.indexOf(ch) >= 0) {\r\n                switch (ch) {\r\n                    case KeyCode_Dot: this.onKeyDot(); break;\r\n                    case KeyCode_Neg: this.onKeyNeg(); event.preventDefault(); break;\r\n                }\r\n                return;\r\n            }\r\n        }\r\n        event.preventDefault();\r\n    }\r\n\r\n    private onKeyDot() {\r\n        let v = this.element.value;\r\n        let p = v.indexOf('.');\r\n        if (p >= 0) this.element.value = v.replace('.', '');\r\n    }\r\n    private onKeyNeg() {\r\n        let v = this.element.value;\r\n        let p = v.indexOf('-');\r\n        if (p >= 0) v = v.replace('-', '');\r\n        else v = '-'+v;\r\n        this.element.value = v;\r\n    }\r\n}\r\n","import {computed, observable} from 'mobx';\r\nimport {IdPickFace} from '../face';\r\nimport {Control} from './control';\r\n\r\nexport class PickIdControl extends Control {\r\n    protected get face(): IdPickFace {return this._face as IdPickFace}\r\n    @observable private caption: string|JSX.Element;\r\n\r\n    private onClick = async () => {\r\n        let {pick, fromPicked} = this.face;\r\n        let item = await pick(this.face, this.formView.props, this.formView.readValues());\r\n        if (item === undefined) {\r\n            this.value = undefined;\r\n            return;\r\n        }\r\n        if (fromPicked === undefined) {\r\n            this.value = item.id;\r\n            return;\r\n        }\r\n        let {id, caption} = fromPicked(item);\r\n        this.value = id;\r\n        this.caption = caption;\r\n    }\r\n    @computed get hasError():boolean {\r\n        return this._field.required === true && this.value === undefined;\r\n    }\r\n    onPicked = (value: any) => {\r\n        this.value = value.id;\r\n    }\r\n    setInitValues(values: any) {\r\n        let v = values[this._field.name];\r\n        this.value = v;\r\n    }\r\n    private controlContent():string|JSX.Element {\r\n        let {itemFromId, fromPicked, initCaption} = this.face;\r\n        if (this.value === undefined) {\r\n            return initCaption || '请选择Id';\r\n        }\r\n        if (this.caption !== undefined) {\r\n            return this.caption;\r\n        }\r\n        if (itemFromId !== undefined) {\r\n            if (fromPicked !== undefined) {\r\n                let item = itemFromId(this.value);\r\n                if (item) {\r\n                    let ret = fromPicked(item);\r\n                    if (ret !== undefined) return ret.caption;\r\n                }\r\n            }\r\n        }\r\n        return String(this.value);\r\n    }\r\n    renderControl():JSX.Element {\r\n        let {tuid, input} = this.face;\r\n        if (input === undefined) {\r\n            return <div className=\"form-control-plaintext px-2 border text-primary rounded cursor-pointer\"\r\n                onClick={this.onClick}>\r\n                {this.controlContent()}\r\n            </div>;\r\n        }\r\n        return <div className=\"form-control-static \">\r\n            <input.component id={this.value} \r\n                ui={tuid}\r\n                />\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observable} from 'mobx';\r\nimport {FormView} from '../formView';\r\nimport {Field} from '../field';\r\nimport {Face, TuidPickFace} from '../face';\r\nimport {Control} from './control';\r\n\r\nexport class PickTuidControl extends Control {\r\n    protected get face(): TuidPickFace {return this._face as TuidPickFace}\r\n    // protected value: number;\r\n    @observable private caption: string|JSX.Element;\r\n    constructor(formView:FormView, field:Field, face:Face) {\r\n        super(formView, field, face);\r\n        this.onIdChanged = this.onIdChanged.bind(this);\r\n        //this.onClick = this.onClick.bind(this);\r\n    }\r\n    /*\r\n    private async onClick() {\r\n        let {pick, fromPicked} = this.face;\r\n        let item = await pick(this.face, this.formView.props, this.formView.readValues());\r\n        if (item === undefined) {\r\n            this.value = undefined;\r\n            return;\r\n        }\r\n        if (fromPicked === undefined) {\r\n            this.value = item.id;\r\n            return;\r\n        }\r\n        let {id, caption} = fromPicked(item);\r\n        this.value = id;\r\n        this.caption = caption;\r\n    }*/\r\n    onIdChanged(id: any) {\r\n        this.value = id.id;\r\n    }\r\n    setInitValues(values: any) {\r\n        let v = values[this._field.name];\r\n        this.value = v;\r\n    }\r\n    private buildContent():JSX.Element {\r\n\t\t/*\r\n        return <this.face.input.component \r\n            {...this.face}\r\n            id={this.value}\r\n            onFormValues={()=>this.formView.readValues()}\r\n\t\t\tonIdChanged={this.onIdChanged} />;\r\n\t\t*/\r\n\t\treturn React.createElement(this.face.input.component, {\r\n\t\t\tid: this.value,\r\n            onFormValues: ()=>this.formView.readValues(),\r\n\t\t\tonIdChanged: this.onIdChanged,\r\n\t\t\t...this.face\r\n\t\t})\r\n    }\r\n    renderControl():JSX.Element {\r\n        return <div className=\"form-control-static \">\r\n            {this.buildContent()}\r\n        </div>;\r\n    }\r\n}\r\n/*\r\n<button className=\"form-control btn btn-outline-info\"\r\ntype=\"button\"\r\nstyle={{textAlign:'left', paddingLeft:'0.75rem'}}\r\nonClick={this.onClick}>\r\n{this.buildContent()}\r\n</button>\r\n*/","import * as React from 'react';\r\nimport {observable} from 'mobx';\r\nimport {PickFace} from '../face';\r\nimport {Control} from './control';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class PickControl extends Control {\r\n    protected get face(): PickFace {return this._face as PickFace}\r\n\r\n    @observable private caption: string|JSX.Element;\r\n\r\n    private onClick = async () => {\r\n        let {pick, fromPicked} = this.face;\r\n        let item = await pick(this.face, this.formView.props, this.formView.readValues());\r\n        if (item === undefined) {\r\n            this.value = undefined;\r\n            return;\r\n        }\r\n        let {id, caption} = fromPicked(item);\r\n        this.value = id;\r\n        this.caption = caption;\r\n    }\r\n    setInitValues(values: any) {\r\n        let v = values[this._field.name];\r\n        this.value = v;\r\n    }\r\n    /*\r\n    private controlContent():string|JSX.Element {\r\n        let {content: Content} = this.face;\r\n        if (this.value === undefined) {\r\n            return '请选择';\r\n        }\r\n        \r\n        if (this.caption !== undefined) {\r\n            return this.caption;\r\n        }\r\n        return <Content id={this.value} />;\r\n    }*/\r\n    /*\r\n    private buildContent():string|JSX.Element {\r\n        let {tuid, input} = this.face;\r\n        if (input === undefined) {\r\n            //return <div>no input on idpick</div>;\r\n            return <div onClick={this.onClick}>{this.controlContent()}</div>;\r\n        }\r\n        return <input.component id={this.value} \r\n            tuid={tuid}\r\n            input={input}\r\n            entitiesUI={this.formView.props.context} \r\n            params={this.formView.readValues()}\r\n            onPicked={this.onPicked} />;\r\n    }*/\r\n    renderControl():JSX.Element {\r\n        return React.createElement(this.view);\r\n        /*\r\n        let {content:Content} = this.face;\r\n        //if (this.value === undefined) {\r\n            //return <div>no input on idpick</div>;\r\n        //}\r\n        //return <div className=\"form-control-static \">\r\n        //    <Content />\r\n        //</div>;\r\n        */\r\n    }\r\n\r\n    private view = observer(() => {\r\n        let content:any;\r\n        let {content: Content} = this.face;\r\n        if (this.value === undefined || this.value === null) {\r\n            content = '请选择';\r\n        }\r\n        /*\r\n        else if (this.caption !== undefined) {\r\n            content = this.caption;\r\n        }*/\r\n        else {\r\n            content = <Content id={this.value} />;\r\n        } \r\n        return <div\r\n            className=\"form-control-plaintext px-2 border text-primary rounded cursor-pointer bg-light\"\r\n            onClick={this.onClick}>\r\n            {content}\r\n        </div>\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport { ControlBase } from './control';\r\n\r\nexport class ButtonsControl extends ControlBase {\r\n    constructor(props) {\r\n        super(props);\r\n        this.otherClick = this.otherClick.bind(this);\r\n    }\r\n    private otherClick() {\r\n        let onOther = this.formView.props.onOther;\r\n        if (onOther === undefined) return;\r\n        let values = this.formView.readValues();\r\n        onOther(values);\r\n    }\r\n    renderControl(): JSX.Element {\r\n        console.log('buttons.renderControl');\r\n        let nothing = this.formView.nothing;\r\n        let hasError = this.formView.hasError;\r\n        let props = this.formView.props;\r\n        console.log('buttons.renderControl nothing:%s hasError:%s', nothing, hasError);\r\n        let { submitButton, otherButton } = props;\r\n        let btnOther: any;\r\n        if (otherButton !== undefined) {\r\n            btnOther = <button className=\"btn btn-outline-info ms-auto\" onClick={this.otherClick}>\r\n                {otherButton}\r\n            </button>\r\n        }\r\n        return <div className=\"d-flex justify-content-start\">\r\n            <button\r\n                className=\"btn btn-primary\"\r\n                type=\"submit\"\r\n                disabled={nothing || hasError}>\r\n                {submitButton || '提交'}\r\n            </button>\r\n            {btnOther}\r\n        </div>;\r\n    }\r\n}\r\n","import {Field} from '../field';\r\nimport {Face} from '../face';\r\nimport {Control, ControlBase} from './control';\r\nimport {CheckControl} from './checkControl';\r\nimport {RadioControl} from './radioControl';\r\nimport {TextAreaControl} from './textAreaControl';\r\nimport {SelectControl} from './selectControl';\r\nimport {UnknownControl, EmptyControl} from './unknownControl';\r\nimport {StringControl, PasswordControl} from './stringControl';\r\nimport {NumberControl} from './numberControl';\r\n\r\nimport {FormView, FormRow, GroupRow, FieldRow, LabelFormRow} from '../formView';\r\nimport { PickIdControl } from './pickIdControl';\r\nimport { PickTuidControl } from './pickTuidControl';\r\nimport { PickControl } from './pickControl';\r\n\r\nexport * from './control';\r\nexport * from './buttonsControl';\r\nexport * from './stringControl';\r\nexport * from './numberControl';\r\n\r\nexport type CreateControl = (form:FormView, row: FormRow) => ControlBase\r\n\r\nexport const createControl:CreateControl = ((form:FormView, row: LabelFormRow):ControlBase => {\r\n    let control:ControlBase;\r\n    let label = row.label;\r\n    if ((row as GroupRow).group !== undefined) {\r\n        control = createGroupControl(form, label, row as GroupRow);\r\n    }\r\n    else if ((row as FieldRow).field !== undefined) {\r\n        control = createFieldControl(form, label, row as FieldRow);\r\n    }\r\n    else {\r\n        control = new EmptyControl(form, row.help);\r\n    }\r\n    return control;\r\n}) as CreateControl;\r\n\r\nconst controlTypes:{[type:string]: new (formView:FormView, field:Field, face:Face) => Control} = {\r\n    \"string\": StringControl,\r\n    \"password\": PasswordControl,\r\n    \"number\": NumberControl,\r\n    \"checkbox\": CheckControl,\r\n    \"radiobox\": RadioControl,\r\n    \"select\": SelectControl,\r\n    \"pick-id\": PickIdControl,\r\n    \"pick-tuid\": PickTuidControl,\r\n    \"textarea\": TextAreaControl,\r\n    \"pick\": PickControl,\r\n};\r\nconst defaultFaces:{[type:string]: Face} = {\r\n    \"string\": {type:'string'},\r\n    \"number\": {type:'number'},\r\n    \"int\": {type:'number'},\r\n    \"dec\": {type:'number'},\r\n    \"bool\": {type:'checkbox'},\r\n}\r\nfunction createFieldControl(form:FormView, label:string, fieldRow: FieldRow):Control {\r\n    let {field, face} = fieldRow;\r\n    switch (typeof field) {\r\n        case 'string':\r\n            field = {\r\n                name: (field as any) as string,\r\n                type: 'string',\r\n            }\r\n            break;\r\n        case 'object':\r\n            break;\r\n        default:\r\n            return new UnknownControl(form, field, face);\r\n    }\r\n    let fieldType = field.type || 'string';\r\n    if (face === undefined) {\r\n        face = defaultFaces[fieldType];\r\n        if (face === undefined) return new UnknownControl(form, field, face);\r\n    }\r\n    else if (face.type === undefined) {\r\n        let f = defaultFaces[fieldType];\r\n        face.type = f===undefined? 'string' : f.type;\r\n    }\r\n    let controlType = controlTypes[face.type || fieldType] || UnknownControl;\r\n    let c = new controlType(form, field, face);\r\n    return c;\r\n}\r\n\r\nfunction createGroupControl(form:FormView, label:string, groupRow: GroupRow):Control {\r\n    return new UnknownControl(form, groupRow as any, undefined);\r\n}\r\n","import { LocalMap } from './localDb';\r\n\r\n// 如果路径上有独立的test单词，则是test环境\r\nfunction isTesting():boolean {\r\n\tlet ret = /(\\btest\\b)/i.test(document.location.href);\r\n\treturn ret;\r\n}\r\n\r\nexport const env = (function () {\r\n    let testing = isTesting();\r\n    let localDb = new LocalMap(testing===true? '$$':'$');\r\n    return {\r\n        testing: testing,\r\n        isDevelopment: process.env.NODE_ENV === 'development',\r\n        localDb: localDb,\r\n        setTimeout: (tag:string, callback: (...args: any[]) => void, ms: number, ...args: any[]):NodeJS.Timer => {\r\n            //if (tag !== undefined) console.log('setTimeout ' + tag);\r\n            return global.setTimeout(callback, ms, ...args);\r\n        },\r\n        clearTimeout: (handle:NodeJS.Timer):void => {\r\n            global.clearTimeout(handle);\r\n        },\r\n        setInterval: (callback: (...args: any[]) => void, ms: number, ...args: any[]): NodeJS.Timer => {\r\n            return global.setInterval(callback, ms, ...args);\r\n        },\r\n        clearInterval: (handle:NodeJS.Timer):void => {\r\n            global.clearInterval(handle);\r\n        }\r\n    }\r\n}());\r\n","\r\nexport * from './boxId';\r\nexport * from './tuid';\r\nexport { TuidsCache } from './tuidsCache';\r\nexport { tv, ReactBoxId, uqStringify } from './reactBoxId';","import * as React from 'react';\r\nimport {FormView, FormRow, FieldRow, GroupRow, LabelFormRow} from '../formView';\r\nimport {ControlBase, createControl, CreateControl} from '../control';\r\n\r\nexport type CreateRow = (form:FormView, row: FormRow)=>RowContainer;\r\n\r\nexport abstract class RowContainer {\r\n    protected form:FormView;\r\n    protected row: FormRow;\r\n    protected control: ControlBase;\r\n    constructor(form:FormView, row: FormRow) {\r\n        this.form = form;\r\n        this.row = row;\r\n        if ((row as JSX.Element).type === undefined) {\r\n            let cc:CreateControl = (row as LabelFormRow).createControl;\r\n            if (cc === undefined) cc = form.createControl;\r\n            if (cc === undefined) cc = createControl;\r\n            this.control = cc(form, row);\r\n        }\r\n    }\r\n    abstract render(key:string):JSX.Element;\r\n    \r\n    isOk():boolean {\r\n        if (this.control === undefined) return true;\r\n        return this.control.isOk();\r\n    }\r\n\r\n    contains(fieldName:string):boolean {\r\n        let field = (this.row as FieldRow).field;\r\n        if (field !== undefined) return fieldName === field.name;\r\n        let group = (this.row as GroupRow).group;\r\n        if (group !== undefined) return group.find(g => g.field.name === fieldName)!==undefined;\r\n        return false;\r\n    }\r\n    get hasError():boolean {return this.control.hasError;}\r\n    get filled():boolean {return this.control.filled;}\r\n    clear() {\r\n        if (this.control !== undefined) this.control.clear();\r\n    }\r\n    clearErrors() {\r\n        if (this.control !== undefined) this.control.clearErrors();\r\n    }\r\n    readValues(values:any):any {\r\n        if (this.control !== undefined) this.control.readValues(values);\r\n    }\r\n    setError(fieldName:string, error:string) {\r\n        if (this.control !== undefined) this.control.setError(fieldName, error);\r\n    }\r\n    setInitValues(values:any) {\r\n        if (this.control !== undefined) this.control.setInitValues(values);\r\n    }\r\n}\r\n\r\nclass ElementRowContainer extends RowContainer {\r\n    render(key:string):JSX.Element {\r\n        return <div key={key} className=\"form-group\">{this.row as JSX.Element}</div>;\r\n    }\r\n    get hasError():boolean {return false;}\r\n    get filled():boolean {return false;}\r\n}\r\n\r\nclass BootStrapRowContainer extends RowContainer {\r\n    render(key:string):JSX.Element {\r\n        return <div key={key} className='form-group row'>\r\n            <label className='col-sm-2 col-form-label'>\r\n                {(this.row as LabelFormRow).label}\r\n            </label>\r\n            {this.control.render()}\r\n        </div>;\r\n\r\n        //has-success is-valid\r\n    }\r\n}\r\n\r\nexport function bootstrapCreateRow(form:FormView, row: FormRow):RowContainer {\r\n    return new BootStrapRowContainer(form, row);\r\n}\r\n\r\nexport function elementCreateRow(form:FormView, row: FormRow):RowContainer {\r\n    return new ElementRowContainer(form, row);\r\n}\r\n","export * from './id';\r\nexport * from './dev';\r\nexport * from './unitApp';","import {HttpChannel} from './httpChannel';\r\nimport { Caller } from './caller';\r\n\r\nexport async function refetchApi(channel:HttpChannel, url:string, options:any, \r\n    resolve:(values:any)=>any, reject:(reason:any)=>void)\r\n{\r\n    await channel.fetch(url, options, false, resolve, reject);\r\n}\r\n\r\nexport abstract class ApiBase {\r\n    protected token: string;\r\n    protected path: string;\r\n    protected showWaiting: boolean;\r\n\r\n    constructor(path: string, showWaiting: boolean) {\r\n        this.path = path || '';\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    protected abstract getHttpChannel(): Promise<HttpChannel>;\r\n\r\n    async xcall(caller:Caller<any>):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.xcall(this.path, caller);\r\n    }\r\n\r\n    public async call(url:string, method:string, body:any):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.callFetch(url, method, body);\r\n    }\r\n\r\n    public async get(path:string, params:any=undefined): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.get(this.path + path, params);\r\n    }\r\n\r\n    public async post(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.post(this.path + path, params);\r\n    }\r\n\r\n    public async put(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.put(this.path + path, params);\r\n    }\r\n\r\n    public async delete(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.delete(this.path + path, params);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { UiImageItem } from '../schema';\r\nimport { ImageUploader } from '../resUploader';\r\nimport { nav } from '../nav';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class ImageItemEdit extends ItemEdit {\r\n    get uiItem(): UiImageItem { return this._uiItem as UiImageItem }\r\n    @observable private resId: string;\r\n\r\n    protected async internalStart(): Promise<any> {\r\n        this.resId = this.value;\r\n        return new Promise<any>((resolve, reject) => {\r\n            nav.push(React.createElement(this.page, { resolve: resolve, reject: reject }), () => reject());\r\n        });\r\n    }\r\n\r\n    /*\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let ret = await this.resUploader.upload();\r\n        if (ret === null) {\r\n            this.overSize = true;\r\n            env.setTimeout('imageItemEdit upload', () => this.overSize = false, 3000);\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.value);\r\n    }\r\n    */\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let size: any = this.uiItem && this.uiItem.size;\r\n\r\n        /*\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>resolve(this.resId)}>保存</button>;\r\n        let overSize:any;\r\n        if (this.overSize === true) {\r\n            overSize = <div className=\"text-danger\">\r\n                <i className=\"fa fa-times-circle\" /> 图片文件大小超过2M，无法上传\r\n            </div>;\r\n        }\r\n        */\r\n        return <ImageUploader\r\n            label={'更改' + this.label}\r\n            id={this.resId}\r\n            size={size}\r\n            onSaved={(resId): Promise<void> => { resolve(resId); return; }} />;\r\n        /*\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div>上传图片：</div>\r\n                    <div className=\"my-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} multiple={false} maxSize={2048} />\r\n                    </div>\r\n                    <div>\r\n                        <button className=\"btn btn-primary\" onClick={this.upload}>上传</button>\r\n                    </div>\r\n                </div>\r\n                {overSize}\r\n                <div className=\"small muted my-4\">支持JPG、GIF、PNG格式图片，不超过2M。</div>\r\n                <div className=\"d-flex\">\r\n                    <div className=\"w-12c h-12c me-4\"\r\n                        style={{border: '1px dotted gray', padding: '8px'}}>\r\n                        <Image className=\"w-100 h-100\" src={this.resId} />\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"small\">图片预览</div>\r\n                        <Image className=\"w-4c h-4c mt-3\" src={this.resId} />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n        */\r\n    })\r\n}\r\n","import _ from 'lodash';\r\nimport {observable, IObservableArray, computed} from 'mobx';\r\n\r\nexport abstract class PageItems<T> {\r\n    constructor(itemObservable:boolean = false) {\r\n\t\tif (itemObservable === undefined) itemObservable = false;\r\n        this._items = observable.array<T>([], {deep:itemObservable});\r\n    }\r\n\tprivate isFirst: boolean = true;\r\n\tprivate pageItemAction: (item:T, results:{[name:string]:any[]}) => void;\r\n\tprivate itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T;\r\n    @observable loading: boolean = false;\r\n    @observable private beforeLoad: boolean = true;\r\n    @observable protected loaded: boolean = false;\r\n    protected _items:IObservableArray<T>;\r\n    @observable allLoaded: boolean = false;\r\n    @computed get items():IObservableArray<T> {\r\n        if (this.beforeLoad === true) return null;\r\n        if (this.loaded === false) return undefined;\r\n        return this._items;\r\n\t}\r\n\t\r\n\tsetEachPageItem(pageItemAction: (item:T, results:{[name:string]:any[]}) => void) {\r\n\t\tthis.pageItemAction = pageItemAction;\r\n\t}\r\n\r\n\tsetItemConverter(itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T) {\r\n\t\tthis.itemConverter = itemConverter;\r\n\t}\r\n\r\n    @observable topDiv:string = '$$top';\r\n    @observable bottomDiv:string = '$$bottom';\r\n    scrollToTop = () => {\r\n\t\tthis.scrollIntoView(this.topDiv);\r\n\t\t//let id = '$$top'+uid();\r\n\t\t//this.topDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.topDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n    }\r\n    scrollToBottom = () => {\r\n\t\tthis.scrollIntoView(this.bottomDiv);\r\n\t\t//let id = '$$bottom'+uid();\r\n\t\t//this.bottomDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.bottomDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n\t}\r\n\tprivate scrollIntoView(divId:string) {\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(divId);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t}\r\n\r\n    protected param: any;\r\n    protected firstSize = 100;\r\n    protected pageStart:any = undefined;\r\n    protected pageSize = 30;\r\n    protected appendPosition:'head'|'tail' = 'tail';\r\n\r\n\tprotected sortOrder:'asc'|'desc';\r\n\tprotected abstract loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}>;\r\n\tprotected getPageId(item:T):any {return;}\r\n\tprotected setPageStart(item:T) {\r\n\t\tthis.pageStart = this.getPageId(item);\r\n\t}\r\n\t\r\n\tprotected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n\t\tlet results = await this.loadResults(param, pageStart, pageSize);\r\n\t\tlet pageList = results.$page;\r\n\t\tif (this.itemConverter) {\r\n\t\t\tlet ret:T[] = [];\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = this.itemConverter(pageList[i], results);\r\n\t\t\t\tret.push(item);\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\tif (this.pageItemAction !== undefined) {\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tthis.pageItemAction(pageList[i], results);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn pageList;\r\n\t}\r\n\r\n    reset() {\r\n        this.isFirst = true;\r\n        this.beforeLoad = true;\r\n        this.loaded = false;\r\n        this.param = undefined;\r\n\t\tthis.allLoaded = false;\r\n\t\tthis.pageStart = undefined;\r\n        this._items.clear();\r\n        //this.setPageStart(undefined);\r\n    }\r\n\r\n    append(item:T) {\r\n        if (this.appendPosition === 'tail')\r\n            this._items.unshift(item);\r\n        else\r\n            this._items.push(item);\r\n    }\r\n\r\n    async first(param:any):Promise<void> {\r\n        this.reset();\r\n        this.beforeLoad = false;\r\n        this.param = param;\r\n        await this.more();\r\n\t}\r\n\r\n\tprivate changing = false;\r\n\tasync attach(): Promise<void> {\r\n\t\tif (this.sortOrder === undefined) {\r\n\t\t\tconsole.error('没有定义增减序，无法attach');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet items = this._items;\r\n\t\tlet isAsc = this.sortOrder === 'asc';\r\n\t\t//let isTail:boolean, \r\n\t\tlet endItem:T;\r\n\t\tlet scrollToEnd:() => void;\r\n\t\tlet pushItem:(item:T) => void;\r\n\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t//isTail = true;\r\n\t\t\tendItem = items[0];\r\n\t\t\tscrollToEnd = this.scrollToTop;\r\n\t\t\tpushItem = (item:T) => items.unshift(item);\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//isTail = false;\r\n\t\t\tlet endIndex = items.length;\r\n\t\t\tendItem = items[endIndex-1];\r\n\t\t\tscrollToEnd = this.scrollToBottom;\r\n\t\t\tpushItem = (item:T) => items.splice(endIndex, 0, item);\r\n\t\t}\r\n\t\tlet startId = this.getPageId(endItem);\r\n\t\tlet pid = undefined;\r\n\t\tlet sum = 0, max = 50;\r\n\t\tfor (;sum < max;) {\r\n\t\t\tlet ret = await this.load(this.param, pid, 3);\r\n\t\t\tlet len = ret.length;\r\n\t\t\tif (len === 0) break;\r\n\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = ret[i];\r\n\t\t\t\tpid = this.getPageId(item);\r\n\t\t\t\tif (isAsc === true) {\r\n\t\t\t\t\tif (pid >= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pid <= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpushItem(item);\r\n\t\t\t\t/*\r\n\t\t\t\tif (isTail === true) {\r\n\t\t\t\t\tthis._items.unshift(item);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._items.push(item);\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\t++sum;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.changing = false;\r\n\t\tif (sum > 0) {\r\n\t\t\tscrollToEnd();\r\n\t\t\t/*\r\n\t\t\tif (isTail === true) this.scrollToTop();\r\n\t\t\telse this.scrollToBottom();\r\n\t\t\t*/\r\n\t\t}\r\n\t}\r\n\r\n\tasync refresh(): Promise<void> {\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet ret = await this.load(this.param, undefined, this.firstSize>this.pageSize? this.firstSize:this.pageSize);\r\n\t\tthis._items.clear();\r\n\t\tthis.setLoaded(ret);\r\n\t\t/*\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet item = ret[i];\r\n\t\t\tlet pid = this.getRefreshPageId(item);\r\n\t\t\tlet index = this._items.findIndex(v => this.getRefreshPageId(v) === pid);\r\n\t\t\t//let index = _.sortedIndexBy(this._items, item, v=>this.getRefreshPageId(v));\r\n\t\t\t//let oldItem = this._items[index];\r\n\t\t\t//let oid = this.getRefreshPageId(oldItem);\r\n\t\t\tif (index >= 0) {\r\n\t\t\t\t_.merge(this._items[index], item);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.splice(0, 0, item);\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t\tthis.changing = false;\r\n\t}\r\n\r\n\tprotected getRefreshPageId(item:T) {\r\n\t\treturn this.getPageId(item);\r\n\t}\r\n\r\n    protected async onLoad(): Promise<void> {}\r\n    protected async onLoaded(): Promise<void> {}\r\n\r\n    async more():Promise<boolean> {\r\n        if (this.allLoaded === true) return false;\r\n\t\tif (this.loading === true) return true;\r\n\t\tif (this.changing === true) return true;\r\n\t\tthis.loading = true;\r\n\t\tthis.changing = true;\r\n        await this.onLoad();\r\n        if (this.pageStart === undefined) this.setPageStart(undefined);\r\n        let pageSize = this.pageSize + 1;\r\n        if (this.isFirst === true) {\r\n            if (this.firstSize > this.pageSize) pageSize = this.firstSize+1;\r\n        }\r\n        let ret = await this.load(\r\n                this.param, \r\n                this.pageStart,\r\n\t\t\t\tpageSize);\r\n        this.loaded = true;\r\n\t\tlet len = ret.length;\r\n        if ((this.isFirst===true && len>this.firstSize) ||\r\n            (this.isFirst===false && len>this.pageSize))\r\n        {\r\n            this.allLoaded = false;\r\n            --len;\r\n            ret.splice(len, 1);\r\n        }\r\n        else {\r\n            this.allLoaded = true;\r\n\t\t}\r\n\t\t/*\r\n        if (len === 0) {\r\n\t\t\tthis.setPageStart(undefined);\r\n            this._items.clear();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setPageStart(ret[len-1]);\r\n\t\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t\tthis._items.push(...ret);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.unshift(...ret.reverse());\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t\tthis.setLoaded(ret);\r\n\t\tthis.isFirst = false;\r\n\t\tthis.onLoaded();\r\n\t\tthis.changing = false;\r\n\t\tthis.loading = false;\r\n\t\treturn !this.allLoaded;\r\n\t}\r\n\t\r\n\tprivate setLoaded(data:any[]) {\r\n\t\tlet len = data.length;\r\n        if (len === 0) {\r\n\t\t\tthis.setPageStart(undefined);\r\n            this._items.clear();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setPageStart(data[len-1]);\r\n\t\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t\tthis._items.push(...data);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.unshift(...data.reverse());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfindItem(item:any):T {\r\n\t\tlet pid = this.getPageId(item);\r\n\t\tlet index = _.findIndex(this._items, v => this.getPageId(v) === pid);\r\n\t\tif (index < 0) return;\r\n\t\treturn this._items[index];\r\n\t\t//let oldItem = this._items[index];\r\n\t\t//let oid = this.getPageId(oldItem);\r\n\t\t//if (pid === oid) return oldItem;\r\n\t}\r\n}\r\n","class MessageHub {\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n    private msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n\tregisterReceiveHandler(handler:(msg:any)=>Promise<void>):number;\r\n\tregisterReceiveHandler(type:string, handler:(msg:any)=>Promise<void>):number;\t\r\n    registerReceiveHandler(...args:any[]):number {\r\n\t\tlet seed = this.handlerSeed++;\r\n\t\tlet args0 = args[0];\r\n\t\tlet handler:(msg:any)=>Promise<void>;\r\n\t\tswitch (typeof args0) {\r\n\t\t\tcase 'string':\r\n\t\t\t\thandler = args[1];\r\n\t\t\t\tthis.msgHandlers[seed] = {type:args0, handler};\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis.anyHandlers[seed] = args0;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn seed;\r\n    }\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n    }\r\n    async dispatch(msg:any) {\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n        }\r\n    }\r\n}\r\n\r\nexport const messageHub = new MessageHub();\r\n","// typescript version of krasimir/navigo\r\n\r\nexport type RouteFunc = (params?:string|{[name:string]:string}, query?:string) => void;\r\n\r\nexport interface NamedRoute {\r\n\tas: string;\r\n\tuses: RouteFunc;\r\n\thooks?: Hooks;\r\n}\r\nexport interface Hooks {\r\n\tbefore: (done:()=>void, params:object) => void;\r\n\tafter: (params:object) => void;\r\n\tleave: (params:object) => void;\r\n\talready: (params:object) => void;\r\n}\r\ninterface Handler {\r\n\thandler: RouteFunc;\r\n\thooks: Hooks;\r\n}\r\ninterface LastResolved {\r\n\turl: string;\r\n\tquery: string;\r\n\thooks: Hooks;\r\n\tparams?: {[name:string]:string};\r\n\tname?: string;\r\n}\r\ninterface Route {\r\n\troute: string|RegExp;\r\n\thandler: RouteFunc,\r\n\tname: string,\r\n\thooks: Hooks\r\n}\r\n\r\nexport class Navigo {\r\n\tprivate static PARAMETER_REGEXP = /([:*])(\\w+)/g;\r\n\tprivate static WILDCARD_REGEXP = /\\*/g;\r\n\tprivate static REPLACE_VARIABLE_REGEXP = '([^\\\\/]+)';   \t// 单\\，编译错误 ([^\\/]+)\r\n\tprivate static REPLACE_WILDCARD = `(?:.*)`;\r\n\tprivate static FOLLOWED_BY_SLASH_REGEXP = '(?:\\\\/$|$)';\t\t// 单\\，编译错误 (?:\\/$|$)\r\n\tprivate static MATCH_REGEXP_FLAGS = '';\r\n\r\n\tprivate static isPushStateAvailable() {\r\n\t\treturn !!(\r\n\t\t  typeof window !== 'undefined' &&\r\n\t\t  window.history &&\r\n\t\t  window.history.pushState\r\n\t\t);\r\n\t}\r\n\t\r\n\tprivate static clean(s:string|RegExp) {\r\n\t\tif (s instanceof RegExp) return s;\r\n\t\treturn Navigo.cleanUrl(s);\r\n\t}\r\n\tprivate static cleanUrl(s:string) {\r\n\t\treturn s.replace(/\\/+$/, '').replace(/^\\/+/, '^/');\r\n\t}\r\n\r\n\tprivate static regExpResultToParams(match:any[], names:string[]) {\r\n\t\tif (names.length === 0) return null;\r\n\t\tif (!match) return null;\r\n\t\treturn match\r\n\t\t  .slice(1, match.length)\r\n\t\t  .reduce((params, value, index) => {\r\n\t\t\t\tif (params === null) params = {};\r\n\t\t\t\tparams[names[index]] = decodeURIComponent(value);\r\n\t\t\t\treturn params;\r\n\t\t  }, null);\r\n\t}\r\n\t  \r\n\tprivate static replaceDynamicURLParts(route:string|RegExp) {\r\n\t\tlet paramNames:string[] = [], regexp:RegExp;\r\n\t  \r\n\t\tif (route instanceof RegExp) {\r\n\t\t\tregexp = route;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tregexp = new RegExp(\r\n\t\t\t\troute.replace(Navigo.PARAMETER_REGEXP, function (full, dots, name) {\r\n\t\t\t\t\t\tparamNames.push(name);\r\n\t\t\t\t\t\treturn Navigo.REPLACE_VARIABLE_REGEXP;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.replace(Navigo.WILDCARD_REGEXP, Navigo.REPLACE_WILDCARD) + Navigo.FOLLOWED_BY_SLASH_REGEXP\r\n\t\t\t\t, Navigo.MATCH_REGEXP_FLAGS);\r\n\t\t}\r\n\t\treturn { regexp, paramNames };\r\n\t}\r\n\t  \r\n\tprivate static getUrlDepth(url:string):number {\r\n\t\treturn url.replace(/\\/$/, '').split('/').length;\r\n\t}\r\n\t  \r\n\tprivate static compareUrlDepth(urlA:string, urlB:string) {\r\n\t\treturn Navigo.getUrlDepth(urlB) - Navigo.getUrlDepth(urlA);\r\n\t}\r\n\t  \r\n\tprivate static findMatchedRoutes(url:string, routes:Route[] = []) {\r\n\t\treturn routes.map(route => {\r\n\t\t\tlet { regexp, paramNames } = Navigo.replaceDynamicURLParts(Navigo.clean(route.route));\r\n\t\t\tlet match = url.replace(/^\\/+/, '/').match(regexp);\r\n\t\t\tlet params = Navigo.regExpResultToParams(match, paramNames);\r\n\t\t\treturn match ? { match, route, params } : false;\r\n\t\t}).filter(m => m);\r\n\t}\r\n\t  \r\n\tprivate static match(url:string, routes:Route[]) {\r\n\t\treturn Navigo.findMatchedRoutes(url, routes)[0] || false;\r\n\t}\r\n\t  \r\n\tprivate static root(url:string, routes:Route[]) {\r\n\t\tconst colonExp = RegExp('\\\\/:\\\\D(\\\\w*)', 'g');\r\n\t\tconst exp = ''; // '($|\\\\/)';  // 单\\，编译报错 ($|\\/)\r\n\t\tlet matched = routes.map(\r\n\t\t\troute => {\r\n\t\t\t\tlet r = route.route;\r\n\t\t\t\tif (r === '' || r === '*') return url;\r\n\t\t\t\tif (typeof r === 'string') {\r\n\t\t\t\t\tr = r.replace(colonExp, '\\\\/(\\\\w|%|[\\u4E00-\\u9FCC])+');\r\n\t\t\t\t}\r\n\t\t\t\tlet routeExp = r + exp;\r\n\t\t\t\tlet ret = url.split(new RegExp(routeExp))[0];\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t);\r\n\t\tlet fallbackURL = Navigo.cleanUrl(url);\r\n\t\tlet len = matched.length;\r\n\t\tif (len === 0) return fallbackURL;\r\n\t\tlet matched0 = matched[0];\r\n\t\tif (len === 1) return matched0;\r\n\t\treturn matched.reduce((result, url) => {\r\n\t\t\tif (result.length > url.length) result = url;\r\n\t\t\treturn result;\r\n\t\t}, matched0);\r\n\t}\r\n\t  \r\n\tprivate static isHashChangeAPIAvailable() {\r\n\t\treturn typeof window !== 'undefined' && 'onhashchange' in window;\r\n\t}\r\n\t  \r\n\tprivate static extractGETParameters(url:string):string {\r\n\t\treturn url.split(/\\?(.*)?$/).slice(1).join('');\r\n\t}\r\n\t  \r\n\tprivate static getOnlyURL(url:string, useHash:boolean, hash:string) {\r\n\t\tlet onlyURL = url, split:string[];\r\n\t\tvar cleanGETParam = (str:string) => str.split(/\\?(.*)?$/)[0];\r\n\t  \r\n\t\tif (typeof hash === 'undefined') {\r\n\t\t\t// To preserve BC\r\n\t\t\thash = '#';\r\n\t\t}\r\n\t  \r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t  \tonlyURL = cleanGETParam(url).split(hash)[0];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsplit = url.split(hash);\r\n\t\t\tonlyURL = split.length > 1 ? cleanGETParam(split[1]) : cleanGETParam(split[0]);\r\n\t\t}\r\n\t\treturn onlyURL;\r\n\t}\r\n\t  \r\n\tprivate static manageHooks(handler:RouteFunc, hooks:Hooks, params?:any, exHooks?:Hooks) {\r\n\t\tif (hooks && typeof hooks === 'object') {\r\n\t\t\tif (hooks.before) {\r\n\t\t\t\thooks.before((shouldRoute = true) => {\r\n\t\t\t\tif (!shouldRoute) return;\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\t}, params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if (hooks.after) {\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\thandler();\r\n\t}\r\n\t  \r\n\tprivate static isHashedRoot(url:string, useHash:boolean, hash:string) {\r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t  return false;\r\n\t\t}\r\n\t  \r\n\t\tif (!url.match(hash)) {\r\n\t\t  return false;\r\n\t\t}\r\n\t  \r\n\t\tlet split = url.split(hash);\r\n\t  \r\n\t\treturn split.length < 2 || split[1] === '';\r\n\t}\r\n\t\r\n\tprivate root:string;\r\n\tprivate _routes:Route[] = [];\r\n\tprivate _useHash:boolean;\r\n\tprivate _hash:string;\r\n\tprivate _paused:boolean;\r\n\tprivate _destroyed:boolean;\r\n\tprivate _lastRouteResolved:LastResolved;\r\n\tprivate _notFoundHandler:Handler;\r\n\tprivate _defaultHandler:Handler;\r\n\tprivate _usePushState:boolean;\r\n\tprivate _genericHooks:Hooks;\r\n\tprivate _historyUpdateMethod: 'pushState' | 'replaceState'; // HistoryUpdateMethod;\r\n\tprivate timout: any; //NodeJS.Timeout;\r\n\r\n\tconstructor(r:string = null, useHash:boolean = false, hash:string = '#') {\r\n\t\tthis.root = null;\r\n\t\tthis._useHash = useHash;\r\n\t\tthis._hash = (!hash)? '#' : hash;\r\n\t\tthis._paused = false;\r\n\t\tthis._destroyed = false;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._notFoundHandler = null;\r\n\t\tthis._defaultHandler = null;\r\n\t\tthis._usePushState = !useHash && Navigo.isPushStateAvailable();\r\n\t\t//this._onLocationChange = this._onLocationChange.bind(this);\r\n\t\tthis._genericHooks = null;\r\n\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\r\n\t\tif (r) {\r\n\t\t\tthis.root = useHash ? r.replace(/\\/$/, '/' + this._hash) : r.replace(/\\/$/, '');\r\n\t\t} else if (useHash) {\r\n\t\t\tthis.root = this._cLoc().split(this._hash)[0].replace(/\\/$/, '/' + this._hash);\r\n\t\t}\r\n\t\r\n\t\tthis._listen();\r\n\t\tthis.updatePageLinks();\r\n\t}\r\n  \r\n\tnavigate(path:string, absolute:boolean = false):Navigo {\r\n\t\tlet to:string;\r\n\t\tpath = path || '';\r\n\t\tif (this._usePushState) {\r\n\t\t\tto = (!absolute ? this._getRoot() + '/' : '') + path.replace(/^\\/+/, '/');\r\n\t\t\tto = to.replace(/([^:])(\\/{2,})/g, '$1/');\r\n\t\t\tto = to.replace('/#test/', '/');\r\n\t\t\tthis._historyUpdate({}, '', to);\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t\telse if (typeof window !== 'undefined') {\r\n\t\t\tpath = path.replace(new RegExp('^' + this._hash), '');\r\n\t\t\tlet {location} = window;\r\n\t\t\tlocation.href = location.href\r\n\t\t\t\t.replace(/#$/, '')\r\n\t\t\t\t.replace(new RegExp(this._hash + '.*$'), '') + this._hash + path;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\ton(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\ton(...args:any[]):Navigo {\r\n\t\tlet arg0 = args[0];\r\n\t\tlet arg1 = args[1];\r\n\t\tswitch (typeof arg0) {\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis._defaultHandler = { handler: arg0, hooks: arg1 };\r\n\t\t\t\tif (!this._notFoundHandler) {\r\n\t\t\t\t\tthis._notFoundHandler = this._defaultHandler;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'object':\r\n\t\t\t\tlet orderedRoutes = Object.keys(arg0).sort(Navigo.compareUrlDepth);\r\n\t\t\t\torderedRoutes.forEach(route => this.on(route, arg0[route]));\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tif (args.length < 2) break;\r\n\t\t\t\tif (arg0 === '/') {\r\n\t\t\t\t\tthis._defaultHandler = { \r\n\t\t\t\t\t\thandler: typeof arg1 === 'object'? arg1.uses : arg1, \r\n\t\t\t\t\t\thooks: args[2],\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tthis._add(arg0, arg1, args[2]);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\toff(handler:RouteFunc):Navigo {\r\n\t\tif (this._defaultHandler !== null && handler === this._defaultHandler.handler) {\r\n\t\t\tthis._defaultHandler = null;\r\n\t\t}\r\n\t\telse if (this._notFoundHandler !== null && handler === this._notFoundHandler.handler) {\r\n\t\t\tthis._notFoundHandler = null;\r\n\t\t}\r\n\t\tthis._routes = this._routes.reduce((result, r) => {\r\n\t\t\tif (r.handler !== handler) result.push(r);\r\n\t\t\treturn result;\r\n\t\t}, []);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tnotFound(handler:RouteFunc, hooks:Hooks):Navigo {\r\n\t\tthis._notFoundHandler = { handler, hooks };\r\n\t\treturn this;\r\n\t}\r\n\r\n\tresolve(current?:string) {\r\n\t\tlet c = current || this._cLoc();\r\n\t\tlet root = this._getRoot();\r\n\t\tlet url = c.replace(root, '');\r\n\t\r\n\t\tif (this._useHash) {\r\n\t\t\tconst exp = '^\\\\/';  // 单\\，编译报错 ^\\/\r\n\t\t\turl = url.replace(new RegExp(exp + this._hash), '/');\r\n\t\t}\r\n\t\r\n\t\tlet GETParameters = Navigo.extractGETParameters(current || this._cLoc());\r\n\t\tlet onlyURL = Navigo.getOnlyURL(url, this._useHash, this._hash);\r\n\t\tif (onlyURL.startsWith('/') === false) {\r\n\t\t\tonlyURL = '/' + onlyURL;\r\n\t\t}\r\n\t\r\n\t\tif (this._paused) return false;\r\n\t\r\n\t\tif (\r\n\t\t\tthis._lastRouteResolved &&\r\n\t\t\tonlyURL === this._lastRouteResolved.url &&\r\n\t\t\tGETParameters === this._lastRouteResolved.query\r\n\t\t) {\r\n\t\t\tif (this._lastRouteResolved.hooks && this._lastRouteResolved.hooks.already) {\r\n\t\t\t\tthis._lastRouteResolved.hooks.already(this._lastRouteResolved.params);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\r\n\t\tlet matched = Navigo.match(onlyURL, this._routes);\r\n\t\r\n\t\tlet manageHooks = (handler:Handler) => {\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\thooks: handler.hooks\r\n\t\t\t\t\t};\r\n\t\t\t\t\thandler.handler(GETParameters);\r\n\t\t\t\t}, handler.hooks);\r\n\t\t\t}, this._genericHooks);\r\n\t\t}\r\n\r\n\t\tif (matched === false) {\r\n\t\t\tif (this._defaultHandler && (\r\n\t\t\t\tonlyURL === '' ||\r\n\t\t\t\tonlyURL === '/' ||\r\n\t\t\t\tonlyURL === this._hash ||\r\n\t\t\t\tNavigo.isHashedRoot(onlyURL, this._useHash, this._hash)\r\n\t\t\t)) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\t\thooks: this._defaultHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._defaultHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._defaultHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._defaultHandler);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse if (this._notFoundHandler) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters,\r\n\t\t\t\t\t\t\thooks: this._notFoundHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._notFoundHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._notFoundHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._notFoundHandler);\r\n\t\t\t}\r\n\t\t\treturn false;\t\r\n\t\t}\r\n\t\tlet m = matched;\r\n\t\tif (m) {\r\n\t\t\tthis._callLeave();\r\n\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\turl: onlyURL,\r\n\t\t\t\tquery: GETParameters,\r\n\t\t\t\thooks: m.route.hooks,\r\n\t\t\t\tparams: m.params,\r\n\t\t\t\tname: m.route.name\r\n\t\t\t};\r\n\t\t\tlet handler = m.route.handler;\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tm.route.route instanceof RegExp ?\r\n\t\t\t\t\thandler(...(m.match.slice(1, m.match.length))) :\r\n\t\t\t\t\thandler(m.params, GETParameters);\r\n\t\t\t\t}, m.route.hooks, m.params, this._genericHooks);\r\n\t\t\t}, this._genericHooks, m.params);\r\n\t\t\treturn m;\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis._routes = [];\r\n\t\tthis._destroyed = true;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._genericHooks = null;\r\n\t\tclearTimeout(this.timout);\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\twindow.removeEventListener('popstate', this._onLocationChange);\r\n\t\t\twindow.removeEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t}\r\n\r\n\tupdatePageLinks() {\r\n\t\t//var self = this;\r\n\t\tif (typeof document === 'undefined') return;\r\n\t\t\tthis._findLinks().forEach(link => {\r\n\t\t\tif (!link.hasListenerAttached) {\r\n\t\t\t\tlink.addEventListener('click', (e: React.MouseEvent<HTMLElement>) => {\r\n\t\t\t\t\tif((e.ctrlKey || e.metaKey) && e.currentTarget.tagName.toLowerCase() === 'a'){ return false; }\r\n\t\t\t\t\tvar location = this.getLinkPath(link);\r\n\t\t\r\n\t\t\t\t\tif (!this._destroyed) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tthis.navigate(location.replace(/\\/+$/, '').replace(/^\\/+/, '/'));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tlink.hasListenerAttached = true;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgenerate(name:string, data:any = {}) {\r\n\t\tlet result = this._routes.reduce((result, route) => {\r\n\t\t\tif (route.name === name) {\r\n\t\t\t\tresult = route.route.toString();\r\n\t\t\t\tfor (let key in data) {\r\n\t\t\t\t\tresult = result.replace(':' + key, data[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}, '');\r\n\t\r\n\t\treturn this._useHash ? this._hash + result : result;\r\n\t}\r\n\r\n\tlink(path:string) {\r\n\t\treturn this._getRoot() + path;\r\n\t}\r\n\r\n\tpause(status:boolean = true) {\r\n\t\tthis._paused = status;\r\n\t\tif (status) {\r\n\t\t\tthis._historyUpdateMethod = 'replaceState';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\t}\r\n\t}\r\n\r\n\tresume() {\r\n\t\tthis.pause(false);\r\n\t}\r\n\r\n\thistoryAPIUpdateMethod(value:'pushState' | 'replaceState') {\r\n\t\tif (typeof value === 'undefined') return this._historyUpdateMethod;\r\n\t\tthis._historyUpdateMethod = value;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tdisableIfAPINotAvailable() {\r\n\t\tif (!Navigo.isPushStateAvailable()) {\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tlastRouteResolved() {\r\n\t\treturn this._lastRouteResolved;\r\n\t}\r\n\r\n\tgetLinkPath(link:any) {\r\n\t\treturn link.getAttribute('href');\r\n\t}\r\n\r\n\thooks(hooks:Hooks) {\r\n\t\tthis._genericHooks = hooks;\r\n\t}\r\n\r\n\tprivate _add(route:string|RegExp, handler:RouteFunc|NamedRoute, hooks:Hooks) {\r\n\t\tif (typeof route === 'string') {\r\n\t\t\troute = encodeURI(route);\r\n\t\t}\r\n\t\tthis._routes.push(\r\n\t\t\ttypeof handler === 'object' ?\r\n\t\t\t{\r\n\t\t\t\troute,\r\n\t\t\t\thandler: handler.uses,\r\n\t\t\t\tname: handler.as,\r\n\t\t\t\thooks: hooks || handler.hooks\r\n\t\t\t} \r\n\t\t\t:\r\n\t\t\t{\r\n\t\t\t\troute,\r\n\t\t\t\thandler, \r\n\t\t\t\tname: undefined,\r\n\t\t\t\thooks,\r\n\t\t\t}\r\n\t\t);\r\n\t\treturn this._add;\r\n\t}\r\n\r\n\tprivate _historyUpdate(data:any, title:string, url?:string) {\r\n\t\tswitch (this._historyUpdateMethod) {\r\n\t\t\tdefault: throw Error('unknow history method ' + this._historyUpdateMethod);\r\n\t\t\tcase 'pushState': window.history.pushState(data, title, url); return;\r\n\t\t\tcase 'replaceState': window.history.replaceState(data, title, url); return;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _getRoot() {\r\n\t\tif (this.root === null) {\r\n\t\t\tlet cLoc = this._cLoc();\r\n\t\t\tlet cLocRoot = cLoc.split('?')[0];\r\n\t\t\tthis.root = Navigo.root(cLocRoot, this._routes);\r\n\t\t}\r\n\t\tlet root = this.root.replace('#test', '');\r\n\t\treturn root;\r\n\t}\r\n\r\n\tprivate _listen() {\r\n\t\tif (this._usePushState) {\r\n\t\t\twindow.addEventListener('popstate', this._onLocationChange);\r\n\t\t}\r\n\t\telse if (Navigo.isHashChangeAPIAvailable()) {\r\n\t\t\twindow.addEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet cached = this._cLoc();\r\n\t\r\n\t\t\tlet check = () => {\r\n\t\t\t\tlet current = this._cLoc();\r\n\t\t\t\tif (cached !== current) {\r\n\t\t\t\t\tcached = current;\r\n\t\t\t\t\tthis.resolve();\r\n\t\t\t\t}\r\n\t\t\t\tif (this.timout) clearTimeout(this.timout);\r\n\t\t\t\tthis.timout = setTimeout(check, 200);\r\n\t\t\t};\r\n\t\t\tcheck();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _cLoc() {\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\t//if (typeof window.__NAVIGO_WINDOW_LOCATION_MOCK__ !== 'undefined') {\r\n\t\t\t//\treturn window.__NAVIGO_WINDOW_LOCATION_MOCK__;\r\n\t\t\t//}\r\n\t\t\tlet {href} = window.location;\r\n\t\t\treturn Navigo.cleanUrl(href);\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate _findLinks() {\r\n\t\treturn [].slice.call(document.querySelectorAll('[data-navigo]'));\r\n\t}\r\n\r\n\tprivate _onLocationChange = () => {\r\n\t\tconsole.log('_onLocationChange');\r\n\t\tthis.resolve();\r\n\t}\r\n\r\n\tprivate _callLeave() {\r\n\t\tconst lastRouteResolved = this._lastRouteResolved;\t\r\n\t\tif (lastRouteResolved) {\r\n\t\t\tlet {params, hooks} = lastRouteResolved;\r\n\t\t\tif (hooks) {\r\n\t\t\t\tif (hooks.leave) {\r\n\t\t\t\t\thooks.leave(params);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//export default Navigo;\r\nexport const navigo = new Navigo();\r\n","import * as React from 'react';\r\nimport { nav } from '../nav';\r\n\r\nexport interface PageHeaderProps {\r\n\tback?: 'back' | 'close' | 'none';\r\n\tcenter: string | JSX.Element;\r\n\tright?: JSX.Element;\r\n\tlogout?: boolean | (() => Promise<void>);\r\n\tclassName?: string;\r\n\tafterBack?: () => void;\r\n\tex?: JSX.Element;\r\n}\r\n\r\nexport function renderPageHeader(props: PageHeaderProps, inWebNav?: boolean) {\r\n\tlet onBack = async () => {\r\n\t\tawait nav.back(); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet { afterBack } = props;\r\n\t\tif (afterBack) afterBack();\r\n\t}\r\n\tlet onLogoutClick = () => {\r\n\t\tlet logout = async () => {\r\n\t\t\tlet { logout } = props;\r\n\t\t\tif (typeof logout === 'function') {\r\n\t\t\t\tawait logout();\r\n\t\t\t}\r\n\t\t\tawait nav.logout(undefined);\r\n\t\t}\r\n\t\tnav.showLogout(logout);\r\n\t}\r\n\r\n\tlet b = nav.level > 1 || window.self !== window.top;\r\n\tlet { back, right, center, logout, className, ex } = props;\r\n\tif (inWebNav === true && !back && !right && !center) return;\r\n\tlet vBack: any, debugLogout: any;\r\n\tif (logout !== undefined && window.self === window.top) {\r\n\t\tif ((typeof logout === 'boolean' && logout === true)\r\n\t\t\t|| typeof logout === 'function') {\r\n\t\t\tlet { user } = nav;\r\n\t\t\tif (user !== undefined) {\r\n\t\t\t\tlet { nick, name } = user;\r\n\t\t\t\tdebugLogout = <div className=\"d-flex align-items-center\">\r\n\t\t\t\t\t<small className=\"text-light\">{nick || name}</small>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\t\t<div className=\"ms-2 py-2 px-3 cursor-pointer\"\r\n\t\t\t\t\t\t\trole=\"button\"\r\n\t\t\t\t\t\t\tonClick={onLogoutClick}>\r\n\t\t\t\t\t\t\t<i className=\"fa fa-sign-out fa-lg\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (b) {\r\n\t\tswitch (props.back) {\r\n\t\t\tcase 'none':\r\n\t\t\t\tvBack = undefined;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\tcase 'back':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{nav.backIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'close':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{nav.backIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (window.self !== window.top) {\r\n\t\tconsole.log(document.location.href);\r\n\t\t// pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n\t}\r\n\tif (vBack === undefined && typeof center === 'string') {\r\n\t\tcenter = <div className=\"px-3\">{center}</div>;\r\n\t}\r\n\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\tlet header = <header className={className}>\r\n\t\t<nav>\r\n\t\t\t{vBack}\r\n\t\t\t{/*pop 弹出window暂时停止作用 */}\r\n\t\t\t<div>{center}</div>\r\n\t\t\t{rightView}\r\n\t\t</nav>\r\n\t\t{ex}\r\n\t</header>;\r\n\tif (inWebNav === true) return header;\r\n\treturn <>\r\n\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t{header}\r\n\t</>;\r\n}\r\n\r\nexport class PageHeader extends React.Component<PageHeaderProps> {\r\n\trender() { return renderPageHeader(this.props) }\r\n\t/*\r\n\tprivate back = async () => {\r\n\t\tawait nav.back(); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet {afterBack} = this.props;\r\n\t\tif (afterBack) afterBack();\r\n\t}\r\n\topenWindow() {\r\n\t\twindow.open(document.location.href);\r\n\t}\r\n\tprivate logoutClick = () => {\r\n\t\tnav.showLogout(this.logout);\r\n\t}\r\n\tprivate logout = async () => {\r\n\t\tlet {logout} = this.props;\r\n\t\tif (typeof logout === 'function') {\r\n\t\t\tawait logout(); \r\n\t\t}\r\n\t\tawait nav.logout(undefined);\r\n\t}\r\n\trender() {\r\n\t\tlet b = nav.level > 1 || window.self !== window.top;\r\n\t\tlet {right, center, logout, className, ex} = this.props;\r\n\t\tlet back:any, debugLogout:any;\r\n\t\tif (logout !== undefined && window.self === window.top) {\r\n\t\t\tif ((typeof logout === 'boolean' && logout === true)\r\n\t\t\t\t|| typeof logout === 'function')\r\n\t\t\t{\r\n\t\t\t\tlet {user} = nav;\r\n\t\t\t\tif (user !== undefined) {\r\n\t\t\t\t\tlet {nick, name} = user;\r\n\t\t\t\t\tdebugLogout = <div className=\"d-flex align-items-center\">\r\n\t\t\t\t\t\t<small className=\"text-light\">{nick || name}</small>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\t\t\t<div className=\"ms-2 py-2 px-3 cursor-pointer\"\r\n\t\t\t\t\t\t\t\trole=\"button\"\r\n\t\t\t\t\t\t\t\tonClick={this.logoutClick}>\r\n\t\t\t\t\t\t\t\t<i className=\"fa fa-sign-out fa-lg\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (b) {\r\n\t\t\tswitch (this.props.back) {\r\n\t\t\t\tcase 'none':\r\n\t\t\t\t\tback = undefined;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tcase 'back':\r\n\t\t\t\t\tback = <nav onClick={this.back}><i className=\"fa fa-angle-left\" /></nav>;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'close':\r\n\t\t\t\t\tback = <nav onClick={this.back}><i className=\"fa fa-close\" /></nav>;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (window.self !== window.top) {\r\n\t\t\tconsole.log(document.location.href);\r\n\t\t\t// pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n\t\t}\r\n\t\tif (back === undefined && typeof center === 'string') {\r\n\t\t\tcenter = <div className=\"px-3\">{center}</div>;\r\n\t\t}\r\n\t\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\t\tlet header = <header className={className}>\r\n\t\t\t<nav>\r\n\t\t\t\t{back}\r\n\t\t\t\t<div>{center}</div>\r\n\t\t\t\t{rightView}\r\n\t\t\t</nav>\r\n\t\t\t{ex}\r\n\t\t</header>;\r\n\t\treturn <>\r\n\t\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t\t{header}\r\n\t\t</>;\r\n\t}\r\n\t*/\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport { IVPage } from './page';\r\nimport { IObservableValue } from 'mobx';\r\nimport '../../css/va-tab.css';\r\nimport { ScrollView } from './scrollView';\r\n\r\nexport type TabCaption = (selected:boolean) => JSX.Element;\r\n\r\nexport interface TabProp {\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontent?: () => JSX.Element;\r\n\tpage?: IVPage;\r\n    notify?: IObservableValue<number>;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tisSelected?: boolean;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n}\r\n\r\nexport interface TabsProps {\r\n    tabs: TabProp[];\r\n    tabPosition?: 'top' | 'bottom';\r\n    size?: 'sm' | 'lg' | 'md';\r\n    tabBg?: string;\r\n    contentBg?: string;\r\n    sep?: string;\r\n    selected?: string;\r\n    borderColor?: string;\r\n    borderWidth?: string;\r\n}\r\n\r\nclass Tab {\r\n\t@observable private loaded: boolean = false;\r\n    name: string;\r\n    @observable selected: boolean;\r\n    caption: TabCaption;\r\n\tcontentBuilder: ()=>JSX.Element;\r\n\tpage: IVPage;\r\n    notify: IObservableValue<number>;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n\r\n    private _content: JSX.Element;\r\n    \r\n    get content(): JSX.Element {\r\n\t\tif (this.load && this.loaded === false) return null;\r\n\t\tif (this.selected === false) return this._content;\r\n\t\tif (!this._content) {\r\n\t\t\tif (this.contentBuilder !== undefined) {\r\n\t\t\t\tthis._content = this.contentBuilder();\r\n\t\t\t}\r\n\t\t\telse if (this.page !== undefined) {\r\n\t\t\t\tthis._content = this.page.content();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._content = <div className=\"p-5\">tab 应该定义content或者page</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._content;\r\n    }\r\n\r\n    async shown() {\r\n        if (this.onShown !== undefined) {\r\n            await this.onShown();\r\n        }\r\n        if (this.load !== undefined) {\r\n\t\t\tif (this.loaded === false) {\r\n\t\t\t\tawait this.load();\r\n\t\t\t\tthis.loaded = true;\r\n\t\t\t}\r\n        }\r\n    }\r\n}\r\n\r\nexport const TabCaptionComponent = (label:string, icon:string, color:string) => <div \r\n    className={'d-flex justify-content-center align-items-center flex-column cursor-pointer ' + color}>\r\n    <div><i className={'fa fa-lg fa-' + icon} /></div>\r\n    <small>{label}</small>\r\n</div>;\r\n\r\n//export const TabCaption = TabCaptionComponent;\r\n\r\nexport class TabsView {\r\n\tprivate props: TabsProps;\r\n    private size: string;\r\n    private tabBg: string;\r\n    //private contentBg: string;\r\n    private sep: string;\r\n    @observable private selectedTab: Tab;\r\n    @observable private tabArr: Tab[];\r\n\r\n    constructor(props: TabsProps) {\r\n\t\tthis.props = props;\r\n\t\tlet {size, tabs, tabBg: tabBack, sep, selected} = props;\r\n\t\tthis.size = size || 'md';\r\n        this.tabArr = tabs.map(v => {\r\n            let tab = new Tab();\r\n            let {name, caption, content, page, notify, load, onShown, isSelected, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\ttab.name = name;\r\n\t\t\tif (isSelected === true || name === selected) {\r\n\t\t\t\tthis.selectedTab = tab;\r\n\t\t\t}\r\n\t\t\ttab.selected = false;\r\n\t\t\ttab.caption = caption;\r\n\t\t\tif (content !== undefined) {\r\n\t\t\t\ttab.contentBuilder = content;\r\n\t\t\t}\r\n\t\t\telse if (page !== undefined) {\r\n\t\t\t\ttab.page = page;\r\n\t\t\t\t//contentBuilder = () => {return page.content()};\r\n\t\t\t}\r\n            tab.notify = notify;\r\n            tab.load = load;\r\n\t\t\ttab.onShown = onShown;\r\n\t\t\ttab.onScroll = onScroll;\r\n\t\t\ttab.onScrollTop = onScrollTop;\r\n\t\t\ttab.onScrollBottom = onScrollBottom;\r\n\t\t\ttab.className = className;\r\n            return tab;\r\n        });\r\n        this.tabBg = tabBack;\r\n        //this.contentBg = contentBack;\r\n        this.sep = sep;\r\n        if (this.selectedTab === undefined) {\r\n\t\t\tthis.selectedTab = this.tabArr[0];\r\n\t\t}\r\n        this.selectedTab.selected = true;\r\n    }\r\n\r\n    tabClick = async (tab:Tab) => {\r\n\t\tif (!tab) {\r\n\t\t\ttab = this.selectedTab;\r\n\t\t\tif (tab === undefined) {\r\n\t\t\t\tif (this.tabArr === undefined) return;\r\n\t\t\t\tif (this.tabArr.length === 0) return;\r\n\t\t\t\ttab = this.tabArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\r\n        this.selectedTab.selected = false;\r\n        tab.selected = true;\r\n\t\tthis.selectedTab = tab;\r\n\t\t\r\n\t\tawait tab.shown();\r\n    }\r\n\r\n\t/*\r\n    showTab(tabName: string) {\r\n        let tab = this.tabs.find(v => v.name === tabName);\r\n        if (tab === undefined) return;\r\n        if (this.selectedTab !== undefined) this.selectedTab.selected = false;\r\n        tab.selected = true;\r\n        this.selectedTab = tab;\r\n\t}\r\n\t*/\r\n\r\n\tprivate tabs = observer(() => {\r\n        let {tabPosition, borderColor} = this.props;\r\n        let bsCur:React.CSSProperties, bsTab:React.CSSProperties\r\n        if (borderColor) {\r\n            bsCur = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderLeftWidth: 1,\r\n                borderRightWidth: 1,\r\n                borderBottomWidth: 1,\r\n            }\r\n            bsTab = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderBottomWidth: 1,\r\n                borderLeftWidth: 0,\r\n                borderRightWidth: 0,\r\n            }\r\n            if (tabPosition === 'top') {\r\n                bsCur.borderBottomWidth = 0;\r\n                bsCur.borderTopLeftRadius = 10;\r\n                bsCur.borderTopRightRadius = 10;\r\n                bsTab.borderTopWidth = 0;\r\n            }\r\n            else {\r\n                bsCur.borderTopWidth = 0;\r\n                bsCur.borderBottomLeftRadius = 10;\r\n                bsCur.borderBottomRightRadius = 10;\r\n                bsTab.borderBottomWidth = 0;\r\n            }\r\n        }\r\n\t\tlet cn = classNames('tv-tabs', this.tabBg, this.sep, 'tv-tabs-' + this.size);\r\n\t\tlet tabs = <div className={cn}>\r\n            {this.tabArr.map((v,index) => {\r\n                let {selected, caption, notify} = v;\r\n                let notifyCircle:any;\r\n                if (notify !== undefined) {\r\n                    let num = notify.get();\r\n                    if (num !== undefined) {\r\n                        if (num > 0) notifyCircle = <u>{num>99?'99+':num}</u>;\r\n                        else if (num < 0) notifyCircle = <u className=\"dot\" />;\r\n                    }\r\n                }\r\n                return <div key={index} onClick={()=>this.tabClick(v)} style={selected===true? bsCur:bsTab}>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t{notifyCircle}\r\n\t\t\t\t\t{caption(selected)}\r\n\t\t\t\t\t</div>\r\n                </div>\r\n            })}\r\n\t\t</div>;\r\n\t\treturn tabs;\r\n\t});\r\n\r\n\tcontent = observer(() => {\r\n\t\tlet displayNone:React.CSSProperties = {visibility: 'hidden'};\r\n\t\treturn <>\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet {tabPosition} = this.props;\r\n\t\t\t\tlet {content, page, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\t\tlet tabs = React.createElement(this.tabs);\r\n\t\t\t\tlet pageHeader:any, pageFooter:any;\r\n\t\t\t\tif (page !== undefined) {\r\n\t\t\t\t\tpageHeader = page.header();\r\n\t\t\t\t\tpageFooter = page.footer();\r\n\t\t\t\t}\r\n\t\t\t\tlet header:any, footer:any;\r\n\t\t\t\tlet visibility:React.CSSProperties = {visibility:'hidden'};\r\n\t\t\t\tif (tabPosition === 'top') {\r\n\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t<section className=\"tv-page-header\">\r\n\t\t\t\t\t\t\t<header>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<header style={visibility}>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t\tif (pageFooter !== undefined) {\r\n\t\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t\t<footer style={visibility}>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t<section className=\"tv-page-footer\">\r\n\t\t\t\t\t\t\t\t<footer>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pageHeader !== undefined) {\r\n\t\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t\t<section className='tv-page-header'>\r\n\t\t\t\t\t\t\t\t<header>{pageHeader}</header>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t\t<header style={visibility}>{pageHeader}</header>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t<footer style={visibility}>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t<section className='tv-page-footer'>\r\n\t\t\t\t\t\t\t<footer>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = displayNone;\r\n\t\t\t\treturn <ScrollView key={index} className={className}\r\n\t\t\t\t\tstyle={style}\r\n\t\t\t\t\tonScroll={onScroll} onScrollTop={onScrollTop} onScrollBottom={onScrollBottom}>\r\n\t\t\t\t\t{header}\r\n\t\t\t\t\t{content}\r\n\t\t\t\t\t{footer}\r\n\t\t\t\t</ScrollView>;\r\n\t\t\t})}\r\n\t\t</>;\r\n\t});\r\n\r\n    render() {\r\n\t\tlet {tabPosition} = this.props;\r\n\t\tlet tabs = React.createElement(this.tabs);\r\n\t\tlet header:any, footer:any;\r\n\t\tlet visibility:React.CSSProperties = {display:'none'};\r\n\t\tif (tabPosition === 'top') {\r\n\t\t\theader = <header>{tabs}</header>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfooter = <footer>{tabs}</footer>;\r\n\t\t}\r\n\t\treturn <>\r\n\t\t\t{header}\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = visibility;\r\n\t\t\t\treturn <div key={index} className={classNames(v.className)} style={style}>\r\n\t\t\t\t\t{v.content}\r\n\t\t\t\t</div>;\r\n\t\t\t})}\r\n\t\t\t{footer}\r\n\t\t</>;\r\n    }\r\n};\r\n\r\n@observer export class Tabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n    }\r\n\r\n    render() {\r\n\t\treturn this.tabsView.render();\r\n    }\r\n};\r\n\r\n@observer export class RootTabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n    }\r\n\r\n    render() {\r\n\t\treturn React.createElement(this.tabsView.content);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport { nav } from './nav';\r\nimport { Loading } from './loading';\r\nimport { Image as ImageControl } from './image';\r\nimport { Page } from './page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { LMR } from './simple';\r\n\r\nexport interface ResUploaderProps {\r\n    className?: string;\r\n    label?: string;\r\n    multiple?: boolean;\r\n    maxSize?: number;\r\n    onFilesChange?: (evt: React.ChangeEvent<HTMLInputElement>) => void;\r\n}\r\n\r\n@observer\r\nexport class ResUploader extends React.Component<ResUploaderProps> {\r\n    private fileInput: HTMLInputElement;\r\n    @observable private fileName: string;\r\n\r\n    buildFormData(): FormData {\r\n        let { maxSize } = this.props;\r\n        if (maxSize === undefined || maxSize <= 0)\r\n            maxSize = 100000000000;\r\n        else\r\n            maxSize = maxSize * 1024;\r\n        var files: FileList = this.fileInput.files;\r\n        var data = new FormData();\r\n        let len = files.length;\r\n        for (let i = 0; i < len; i++) {\r\n            let file = files[i];\r\n            if (file.size > maxSize) return null;\r\n            data.append('files[]', file, file.name);\r\n        }\r\n    }\r\n\r\n    getFile0(): File {\r\n        return this.fileInput.files[0];\r\n    }\r\n\r\n    upload = async (formData?: FormData): Promise<string | { error: any }> => {\r\n        let resUrl = nav.resUrl + 'upload';\r\n        if (!formData) formData = this.buildFormData();\r\n        try {\r\n            nav.startWait();\r\n            let headers = new Headers();\r\n            headers.append('Access-Control-Allow-Origin', '*');\r\n            //2019-12-18：因为 vivo按oppo某些版本不支持，暂时先不要 \r\n            //let abortController = new AbortController();\r\n            let res = await fetch(resUrl, {\r\n                method: \"POST\",\r\n                body: formData,\r\n                headers: headers,\r\n                //signal: abortController.signal,\r\n            });\r\n            let json = await res.json();\r\n            return ':' + json.res.id;\r\n        }\r\n        catch (err) {\r\n            console.error('%s %s', resUrl, err);\r\n            return { error: err };\r\n        }\r\n        finally {\r\n            nav.endWait();\r\n        }\r\n    }\r\n\r\n    private onFilesChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let { onFilesChange } = this.props;\r\n        if (onFilesChange) onFilesChange(evt);\r\n        let files = evt.target.files;\r\n        let len = files.length;\r\n        let names: string[] = [];\r\n        for (let i = 0; i < len; i++) {\r\n            names.push(files.item(i).name);\r\n        }\r\n        this.fileName = names.join(', ');\r\n    }\r\n\r\n    render() {\r\n        let { className, multiple, label } = this.props;\r\n        return <div>\r\n            <label className=\"btn btn-outline-success\">\r\n                {label || '选择文件'}\r\n                <input\r\n                    className={className}\r\n                    ref={t => this.fileInput = t}\r\n                    onChange={this.onFilesChange}\r\n                    type='file' name='file'\r\n                    multiple={multiple} style={{ display: 'none' }} />\r\n            </label>\r\n            &nbsp;\r\n            {this.fileName}\r\n        </div>\r\n    }\r\n}\r\n\r\nfunction formatSize(size: number, pointLength: number = 2, units?: string[]) {\r\n    var unit;\r\n    units = units || ['B', 'K', 'M', 'G', 'TB'];\r\n    while ((unit = units.shift()) && size > 1024) {\r\n        size = size / 1024;\r\n    }\r\n    return (unit === 'B' ? size : size.toFixed(pointLength === undefined ? 2 : pointLength)) + unit;\r\n}\r\n\r\ninterface ImageUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw';\r\n    onSaved?: (imageId: string) => Promise<void>;\r\n    imageTypes?: string[];\r\n}\r\n\r\nconst xlargeSize = 1600;\r\nconst largeSize = 800;\r\nconst mediumSize = 400;\r\nconst smallSize = 180;\r\n\r\n@observer\r\nexport class ImageUploader extends React.Component<ImageUploaderProps> {\r\n    private static imageTypes = ['gif', 'jpg', 'jpeg', 'png', 'svg', 'apng', 'bmp', 'ico', 'cur', 'tiff', 'tif', 'webp'];\r\n    private imgBaseSize: number;\r\n    private imageTypes: string[];\r\n    private suffix: string;\r\n    private resUploader: ResUploader;\r\n    @observable private file: File;\r\n    @observable private desImgWidth: number;\r\n    @observable private desImgHeight: number;\r\n    @observable private desImgSize: number;\r\n    @observable private srcImgWidth: number;\r\n    @observable private srcImgHeight: number;\r\n    @observable private isChanged: boolean = false;\r\n    @observable private resId: string;\r\n    @observable private enableUploadButton: boolean = false;\r\n    @observable private srcImage: string;\r\n    @observable private desImage: string;\r\n    @observable private fileError: string;\r\n    @observable private uploaded: boolean = false;\r\n\r\n    constructor(props: ImageUploaderProps) {\r\n        super(props);\r\n        this.resId = props.id;\r\n        this.imageTypes = props.imageTypes || ImageUploader.imageTypes;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos + 1).toLowerCase();\r\n            if (this.imageTypes.indexOf(this.suffix) < 0) {\r\n                this.fileError = `图片类型必须是 ${this.imageTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n                this.srcImage = reader.result as string;\r\n                switch (this.suffix) {\r\n                    default:\r\n                        await this.setSize(this.props.size);\r\n                        break;\r\n                    case 'svg':\r\n                        this.imgBaseSize = mediumSize;\r\n                        this.desImgSize = this.srcImage.length;\r\n                        this.desImage = this.srcImage;\r\n                        break;\r\n                }\r\n            };\r\n        }\r\n    }\r\n\r\n    private async setSize(size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw') {\r\n        switch (size) {\r\n            default:\r\n            case 'sm':\r\n                this.imgBaseSize = smallSize; break;\r\n            case 'md':\r\n                this.imgBaseSize = mediumSize; break;\r\n            case 'lg':\r\n                this.imgBaseSize = largeSize; break;\r\n            case 'xl':\r\n                this.imgBaseSize = xlargeSize; break;\r\n            case 'raw':\r\n                this.imgBaseSize = -1; break;\r\n        }\r\n        this.desImage = await this.compress();\r\n    }\r\n\r\n    private compress = (): Promise<string> => {\r\n        return new Promise<string>((resolve, reject) => {\r\n            var img = new Image();\r\n            img.src = this.srcImage;\r\n            img.onload = () => {\r\n                //var that = this;\r\n                // 默认按比例压缩\r\n                let { width, height } = img;\r\n                this.srcImgWidth = width;\r\n                this.srcImgHeight = height;\r\n                let scale = width / height;\r\n                let w: number, h: number;\r\n                if (this.imgBaseSize < 0) {\r\n                    w = width;\r\n                    h = height;\r\n                }\r\n                else if (width <= this.imgBaseSize && height <= this.imgBaseSize) {\r\n                    w = width;\r\n                    h = height;\r\n                }\r\n                else if (scale < 0) {\r\n                    w = this.imgBaseSize;\r\n                    h = w / scale;\r\n                }\r\n                else {\r\n                    h = this.imgBaseSize;\r\n                    w = h * scale;\r\n                }\r\n                this.desImgWidth = Math.round(w);\r\n                this.desImgHeight = Math.round(h);\r\n                var quality = 0.7;  // 默认图片质量为0.7\r\n                //生成canvas\r\n                var canvas = document.createElement('canvas');\r\n                var ctx = canvas.getContext('2d');\r\n                // 创建属性节点\r\n                var anw = document.createAttribute(\"width\");\r\n                anw.nodeValue = String(w);\r\n                var anh = document.createAttribute(\"height\");\r\n                anh.nodeValue = String(h);\r\n                canvas.setAttributeNode(anw);\r\n                canvas.setAttributeNode(anh);\r\n                ctx.drawImage(img, 0, 0, w, h);\r\n                let base64 = canvas.toDataURL('image/' + this.suffix, quality);\r\n                let blob = this.convertBase64UrlToBlob(base64);\r\n                this.desImgSize = blob.size;\r\n                if (this.desImgSize > 3 * 1024 * 1024) {\r\n                    this.fileError = \"图片大于3M，无法上传\";\r\n                    this.enableUploadButton = false;\r\n                }\r\n                resolve(base64);\r\n            }\r\n        });\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string): Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while (n--) {\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], { type: mime });\r\n    }\r\n\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.desImage);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let { error } = ret;\r\n            let type = typeof error;\r\n            let err: string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let { onSaved } = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    private showOrgImage = () => {\r\n        nav.push(<Page header=\"原图\">\r\n            <div className=\"p-3 text-center\">\r\n                <ImageControl className=\"h-min-4c\" style={{ maxWidth: '100%' }} src={this.srcImage} />\r\n            </div>\r\n        </Page>);\r\n    }\r\n\r\n    private levelDiv() {\r\n        if (this.props.size) return;\r\n        let arr = [{ caption: '小图', size: 'sm' }];\r\n        if (this.srcImgHeight > mediumSize || this.srcImgWidth > mediumSize) {\r\n            arr.push({ caption: '中图', size: 'md' });\r\n        }\r\n        if (this.srcImgHeight > largeSize || this.srcImgWidth > largeSize) {\r\n            arr.push({ caption: '大图', size: 'lg' });\r\n        }\r\n        if (this.srcImgHeight > xlargeSize || this.srcImgWidth > xlargeSize) {\r\n            arr.push({ caption: '超大图', size: 'xl' });\r\n            arr.push({ caption: '原图', size: 'raw' });\r\n        }\r\n        if (arr.length < 2) return;\r\n        return <div>{arr.map((v, index) => {\r\n            let { caption, size } = v;\r\n            return <label key={index} className=\"me-3\"><input type=\"radio\" name=\"size\"\r\n                onChange={() => this.setSize(size as any)}\r\n                defaultChecked={index === 0} /> {caption}</label>;\r\n        })}</div>\r\n    }\r\n\r\n    render() {\r\n        let { label } = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改图片'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v => this.resUploader = v}\r\n                            multiple={false} maxSize={2048}\r\n                            label=\"选择图片文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {this.imageTypes.join(', ')} 格式图片。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                    <LMR left=\r\n                        {\r\n                            this.uploaded === true ?\r\n                                <div className=\"text-success p-2\">上传成功！</div>\r\n                                :\r\n                                this.file && this.desImgSize > 0 && <div className=\"mb-3 d-flex align-items-end\">\r\n                                    <div className=\"me-5\">\r\n                                        {this.levelDiv()}\r\n                                        <div>分辨率：{this.desImgWidth} x {this.desImgHeight}\r\n                                            &nbsp; &nbsp;\r\n                                            文件大小：{formatSize(this.desImgSize)}\r\n                                        </div>\r\n                                    </div>\r\n                                    <button className=\"btn btn-primary\"\r\n                                        disabled={!this.enableUploadButton}\r\n                                        onClick={this.upload}>上传</button>\r\n                                </div>\r\n                        }\r\n                        right={this.desImage &&\r\n                            <button className=\"btn btn-link btn-sm text-end mb-3\" onClick={this.showOrgImage}>\r\n                                原图大小: {formatSize(this.file.size)}<br />\r\n                                分辨率：{this.srcImgWidth} x {this.srcImgHeight}\r\n                            </button>\r\n                        }\r\n                    ></LMR>\r\n                </div>\r\n                <div className=\"text-center\"\r\n                    style={{\r\n                        border: (this.uploaded === true ? '2px solid green' : '1px dotted gray'),\r\n                        padding: '8px'\r\n                    }}>\r\n                    <ImageControl className=\"h-min-4c\" style={{ maxWidth: '100%' }} src={this.desImage} />\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface AudioUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    onSaved?: (imageId: string) => Promise<void>;\r\n}\r\n\r\n@observer\r\nexport class AudioUploader extends React.Component<AudioUploaderProps> {\r\n    private static audioTypes = ['mp3', 'wav'];\r\n\r\n    private suffix: string;\r\n    private resUploader: ResUploader;\r\n    @observable private content: string;\r\n    @observable private file: File;\r\n    @observable private fileSize: number;\r\n\r\n    @observable private isChanged: boolean = false;\r\n    @observable private resId: string;\r\n    @observable private enableUploadButton: boolean = false;\r\n    @observable private fileError: string;\r\n    @observable private uploaded: boolean = false;\r\n    @observable private uploading: boolean = false;\r\n\r\n    constructor(props: AudioUploaderProps) {\r\n        super(props);\r\n        this.resId = props.id;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos + 1).toLowerCase();\r\n            if (AudioUploader.audioTypes.indexOf(this.suffix) < 0) {\r\n                this.fileError = `音频类型必须是 ${AudioUploader.audioTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n                this.content = reader.result as string;\r\n                this.fileSize = this.content.length;\r\n            };\r\n        }\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string): Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while (n--) {\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], { type: mime });\r\n    }\r\n\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        this.uploading = true;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.content);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let { error } = ret;\r\n            let type = typeof error;\r\n            let err: string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let { onSaved } = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    render() {\r\n        let { label } = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改文件'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v => this.resUploader = v}\r\n                            multiple={false} maxSize={2048}\r\n                            label=\"选择音频文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {AudioUploader.audioTypes.join(', ')} 格式。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <LMR left=\r\n                {\r\n                    this.uploaded === true ?\r\n                        <div className=\"text-success p-2\">上传成功！</div>\r\n                        :\r\n                        this.uploading === true ?\r\n                            <div className=\"m-3\"><Loading /></div>\r\n                            :\r\n                            this.file && this.content && <div className=\"m-3\">\r\n                                <div className=\"mb-3\">\r\n                                    文件大小：{formatSize(this.fileSize)}\r\n                                </div>\r\n                                <button className=\"btn btn-primary\"\r\n                                    disabled={!this.enableUploadButton}\r\n                                    onClick={this.upload}>上传</button>\r\n                            </div>\r\n                }\r\n            />\r\n        </Page>;\r\n    }\r\n}\r\n","import _ from 'lodash';\r\nimport { UqApi, UqData, UnitxApi, appInFrame } from '../net';\r\nimport { Tuid, TuidDiv, TuidImport, TuidInner, TuidBox, TuidsCache } from './tuid';\r\nimport { Action } from './action';\r\nimport { Sheet } from './sheet';\r\nimport { Query } from './query';\r\nimport { Book } from './book';\r\nimport { History } from './history';\r\nimport { Map } from './map';\r\nimport { Pending } from './pending';\r\nimport { CreateBoxId, BoxId } from './tuid';\r\nimport { LocalMap, LocalCache } from '../tool';\r\nimport { UQsMan } from './uqsMan';\r\nimport { ReactBoxId } from './tuid/reactBoxId';\r\nimport { Tag } from './tag/tag';\r\nimport { UqEnum } from './enum';\r\nimport { Entity } from './entity';\r\n\r\nexport type FieldType = 'id' | 'tinyint' | 'smallint' | 'int' | 'bigint' | 'dec' | 'char' | 'text'\r\n    | 'datetime' | 'date' | 'time' | 'timestamp';\r\n\r\nexport function fieldDefaultValue(type:FieldType) {\r\n    switch (type) {\r\n        case 'tinyint':\r\n        case 'smallint':\r\n        case 'int':\r\n        case 'bigint':\r\n        case 'dec':\r\n            return 0;\r\n        case 'char':\r\n        case 'text':\r\n            return '';\r\n        case 'datetime':\r\n        case 'date':\r\n            return '2000-1-1';\r\n        case 'time':\r\n            return '0:00';\r\n    }\r\n}\r\n\r\nexport interface Field {\r\n    name: string;\r\n    type: FieldType;\r\n    tuid?: string;\r\n    arr?: string;\r\n    null?: boolean;\r\n    size?: number;\r\n    owner?: string;\r\n    _tuid: TuidBox;\r\n}\r\nexport interface ArrFields {\r\n    name: string;\r\n    fields: Field[];\r\n    id?: string;\r\n    order?: string;\r\n}\r\nexport interface FieldMap {\r\n    [name:string]: Field;\r\n}\r\nexport interface SchemaFrom {\r\n    owner:string;\r\n    uq:string;\r\n}\r\nexport interface TuidModify {\r\n    max: number;\r\n    seconds: number;\r\n}\r\n\r\nexport class UqMan {\r\n\tprivate readonly enums: {[name:string]: UqEnum} = {};\r\n    private readonly actions: {[name:string]: Action} = {};\r\n    private readonly sheets: {[name:string]: Sheet} = {};\r\n    private readonly queries: {[name:string]: Query} = {};\r\n    private readonly books: {[name:string]: Book} = {};\r\n    private readonly maps: {[name:string]: Map} = {};\r\n    private readonly histories: {[name:string]: History} = {};\r\n\tprivate readonly pendings: {[name:string]: Pending} = {};\r\n\tprivate readonly tags: {[name:string]: Tag} = {};\r\n    private readonly tuidsCache: TuidsCache;\r\n    private readonly localAccess: LocalCache;\r\n    private readonly tvs:{[entity:string]:(values:any)=>JSX.Element};\r\n    readonly localMap: LocalMap;\r\n    readonly localModifyMax: LocalCache;\r\n    readonly tuids: {[name:string]: Tuid} = {};\r\n    readonly createBoxId: CreateBoxId;\r\n    readonly newVersion: boolean;\r\n    readonly uqOwner: string;\r\n    readonly uqName: string;\r\n    readonly name: string;\r\n    readonly uqApi: UqApi;\r\n    readonly id: number;\r\n\r\n    uqVersion: number;\r\n\r\n    constructor(uqs:UQsMan, uqData: UqData, createBoxId:CreateBoxId, tvs:{[entity:string]:(values:any)=>JSX.Element}) {\r\n        this.createBoxId = createBoxId;\r\n        if (createBoxId === undefined) {\r\n            this.createBoxId = this.createBoxIdFromTVs;\r\n            this.tvs = tvs || {};\r\n        }\r\n        let {id, uqOwner, uqName, access, newVersion} = uqData;\r\n        this.newVersion = newVersion;\r\n        this.uqOwner = uqOwner;\r\n        this.uqName = uqName;\r\n        this.id = id;\r\n        this.name = uqOwner + '/' + uqName;\r\n        this.uqVersion = 0;\r\n        this.localMap = uqs.localMap.map(this.name);\r\n        this.localModifyMax = this.localMap.child('$modifyMax');\r\n        this.localAccess = this.localMap.child('$access');\r\n        //let hash = document.location.hash;\r\n        let baseUrl = 'tv/';\r\n\r\n        let acc: string[];\r\n        if (access === null || access === undefined || access === '*') {\r\n            acc = [];\r\n        }\r\n        else {\r\n            acc = access.split(';').map(v => v.trim()).filter(v => v.length > 0);\r\n        }\r\n        if (this.name === '$$$/$unitx') {\r\n            // 这里假定，点击home link之后，已经设置unit了\r\n            // 调用 UnitxApi会自动搜索绑定 unitx service\r\n            this.uqApi = new UnitxApi(appInFrame.unit);\r\n        }\r\n        else {\r\n            let {appOwner, appName} = uqs;\r\n            this.uqApi = new UqApi(baseUrl, appOwner, appName, uqOwner, uqName, acc, true);\r\n        }\r\n        this.tuidsCache = new TuidsCache(this);\r\n    }\r\n\r\n    get entities() {\r\n        return _.merge({}, \r\n            this.actions, this.sheets, this.queries, this.books,\r\n\t\t\tthis.maps, this.histories, this.pendings, this.tuids,\r\n\t\t\tthis.tags,\r\n        );\r\n    }\r\n\r\n    private createBoxIdFromTVs:CreateBoxId = (tuid:Tuid, id:number):BoxId =>{\r\n        let {name} = tuid;\r\n        /*\r\n        let tuidUR = this.tuidURs[name];\r\n        if (tuidUR === undefined) {\r\n            let {ui, res} = this.getUI(tuid);\r\n            this.tuidURs[name] = tuidUR = new TuidWithUIRes(tuid, ui, res);\r\n        }\r\n        */\r\n        return new ReactBoxId(id, tuid, this.tvs[name]);\r\n    }\r\n\r\n    tuid(name:string):Tuid {return this.tuids[name.toLowerCase()]}\r\n    tuidDiv(name:string, div:string):TuidDiv {\r\n        let tuid = this.tuids[name.toLowerCase()]\r\n        return tuid && tuid.div(div.toLowerCase());\r\n    }\r\n    action(name:string):Action {return this.actions[name.toLowerCase()]}\r\n    sheet(name:string):Sheet {return this.sheets[name.toLowerCase()]}\r\n    query(name:string):Query {return this.queries[name.toLowerCase()]}\r\n    book(name:string):Book {return this.books[name.toLowerCase()]}\r\n    map(name:string):Map {return this.maps[name.toLowerCase()]}\r\n    history(name:string):History {return this.histories[name.toLowerCase()]}\r\n    pending(name:string):Pending {return this.pendings[name.toLowerCase()]}\r\n\r\n    sheetFromTypeId(typeId:number):Sheet {\r\n        for (let i in this.sheets) {\r\n            let sheet = this.sheets[i];\r\n            if (sheet.typeId === typeId) return sheet;\r\n        }\r\n    }\r\n\r\n    readonly tuidArr: Tuid[] = [];\r\n    readonly actionArr: Action[] = [];\r\n    readonly enumArr: UqEnum[] = [];\r\n    readonly sheetArr: Sheet[] = [];\r\n    readonly queryArr: Query[] = [];\r\n    readonly bookArr: Book[] = [];\r\n    readonly mapArr: Map[] = [];\r\n    readonly historyArr: History[] = [];\r\n    readonly pendingArr: Pending[] = [];\r\n    readonly tagArr: Tag[] = [];\r\n\r\n    async init() {\r\n        await this.uqApi.init();\r\n    }\r\n\r\n    async loadEntities(): Promise<string> {\r\n        try {\r\n            let accesses = this.localAccess.get();\r\n            if (!accesses) {\r\n                accesses = await this.uqApi.loadAccess();\r\n            }\r\n            if (!accesses) return;\r\n            this.buildEntities(accesses);\r\n        }\r\n        catch (err) {\r\n            return err;\r\n        }\r\n    }\r\n\r\n\tbuildEntities(entities:any) {\r\n        if (entities === undefined) {\r\n            debugger;\r\n        }\r\n        this.localAccess.set(entities);\r\n        let {access, tuids, version} = entities;\r\n        this.uqVersion = version;\r\n        this.buildTuids(tuids);\r\n        this.buildAccess(access);\r\n\t}\r\n\t\r\n    private buildTuids(tuids:any) {\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let {typeId, from} = schema;\r\n            let tuid = this.newTuid(i, typeId, from);\r\n            tuid.sys = true;\r\n        }\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let tuid = this.getTuid(i);\r\n            tuid.setSchema(schema);\r\n        }\r\n        for (let i in this.tuids) {\r\n            let tuid = this.tuids[i];\r\n            tuid.buildFieldsTuid();\r\n        }\r\n\t}\r\n\r\n    async loadEntitySchema(entityName: string): Promise<any> {\r\n        return await this.uqApi.schema(entityName);\r\n    }\r\n\r\n\tasync loadAllSchemas():Promise<void> {\r\n\t\tlet ret = await this.uqApi.allSchemas();\r\n\t\tlet entities: Entity[][] = [\r\n\t\t\tthis.actionArr, \r\n\t\t\tthis.enumArr,\r\n\t\t\tthis.sheetArr,\r\n\t\t\tthis.queryArr,\r\n\t\t\tthis.bookArr,\r\n\t\t\tthis.mapArr,\r\n\t\t\tthis.historyArr,\r\n\t\t\tthis.pendingArr,\r\n\t\t\tthis.tagArr,\r\n\t\t];\r\n\t\tentities.forEach(arr => {\r\n\t\t\tarr.forEach(v => {\r\n\t\t\t\tlet entity = ret[v.name.toLowerCase()];\r\n\t\t\t\tif (!entity) return;\r\n\t\t\t\tlet schema = entity.call;\r\n\t\t\t\tif (!schema) return;\r\n\t\t\t\tv.buildSchema(schema);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n    getTuid(name:string): Tuid {\r\n        return this.tuids[name];\r\n    }\r\n\r\n    private buildAccess(access:any) {\r\n        for (let a in access) {\r\n            let v = access[a];\r\n            switch (typeof v) {\r\n                case 'string': this.fromType(a, v); break;\r\n                case 'object': this.fromObj(a, v); break;\r\n            }\r\n        }\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.tuidsCache.cacheTuids(defer);\r\n    }\r\n\r\n    newEnum(name:string, id:number):UqEnum {\r\n        let enm = this.enums[name];\r\n        if (enm !== undefined) return enm;\r\n        enm = this.enums[name] = new UqEnum(this, name, id)\r\n        this.enumArr.push(enm);\r\n        return enm;\r\n    }\r\n\tnewAction(name:string, id:number):Action {\r\n        let action = this.actions[name];\r\n        if (action !== undefined) return action;\r\n        action = this.actions[name] = new Action(this, name, id)\r\n        this.actionArr.push(action);\r\n        return action;\r\n    }\r\n    private newTuid(name:string, id:number, from:SchemaFrom):Tuid {\r\n        let tuid = this.tuids[name];\r\n        if (tuid !== undefined) return tuid;\r\n        if (from !== undefined)\r\n            tuid = new TuidImport(this, name, id, from);\r\n        else\r\n            tuid = new TuidInner(this, name, id);\r\n        this.tuids[name] = tuid;\r\n        this.tuidArr.push(tuid);\r\n        return tuid;\r\n    }\r\n    newQuery(name:string, id:number):Query {\r\n        let query = this.queries[name];\r\n        if (query !== undefined) return query;\r\n        query = this.queries[name] = new Query(this, name, id)\r\n        this.queryArr.push(query);\r\n        return query;\r\n    }\r\n    private newBook(name:string, id:number):Book {\r\n        let book = this.books[name];\r\n        if (book !== undefined) return book;\r\n        book = this.books[name] = new Book(this, name, id);\r\n        this.bookArr.push(book);\r\n        return book;\r\n    }\r\n    private newMap(name:string, id:number):Map {\r\n        let map = this.maps[name];\r\n        if (map !== undefined) return map;\r\n        map = this.maps[name] = new Map(this, name, id)\r\n        this.mapArr.push(map);\r\n        return map;\r\n    }\r\n    private newTag(name:string, id:number):Tag {\r\n        let tag = this.tags[name];\r\n        if (tag !== undefined) return tag;\r\n        tag = this.tags[name] = new Tag(this, name, id)\r\n        this.tagArr.push(tag);\r\n        return tag;\r\n    }\r\n    private newHistory(name:string, id:number):History {\r\n        let history = this.histories[name];\r\n        if (history !== undefined) return;\r\n        history = this.histories[name] = new History(this, name, id)\r\n        this.historyArr.push(history);\r\n        return history;\r\n    }\r\n    private newPending(name:string, id:number):Pending {\r\n        let pending = this.pendings[name];\r\n        if (pending !== undefined) return;\r\n        pending = this.pendings[name] = new Pending(this, name, id)\r\n        this.pendingArr.push(pending);\r\n        return pending;\r\n    }\r\n    newSheet(name:string, id:number):Sheet {\r\n        let sheet = this.sheets[name];\r\n        if (sheet !== undefined) return sheet;\r\n        sheet = this.sheets[name] = new Sheet(this, name, id);\r\n        this.sheetArr.push(sheet);\r\n        return sheet;\r\n    }\r\n    private fromType(name:string, type:string) {\r\n        let parts = type.split('|');\r\n        type = parts[0];\r\n        let id = Number(parts[1]);\r\n        switch (type) {\r\n            //case 'uq': this.id = id; break;\r\n            case 'tuid':\r\n                // Tuid should not be created here!;\r\n                //let tuid = this.newTuid(name, id);\r\n                //tuid.sys = false;\r\n                break;\r\n            case 'action': this.newAction(name, id); break;\r\n            case 'query': this.newQuery(name, id); break;\r\n            case 'book': this.newBook(name, id); break;\r\n            case 'map': this.newMap(name, id); break;\r\n            case 'history': this.newHistory(name, id); break;\r\n            case 'sheet':this.newSheet(name, id); break;\r\n\t\t\tcase 'pending': this.newPending(name, id); break;\r\n\t\t\tcase 'tag': this.newTag(name, id); break;\r\n\t\t\tcase 'enum': this.newEnum(name, id); break;\r\n        }\r\n    }\r\n    private fromObj(name:string, obj:any) {\r\n        switch (obj['$']) {\r\n            case 'sheet': this.buildSheet(name, obj); break;\r\n        }\r\n    }\r\n    private buildSheet(name:string, obj:any) {\r\n        let sheet = this.sheets[name];\r\n        if (sheet === undefined) sheet = this.newSheet(name, obj.id);\r\n        sheet.build(obj);\r\n    }\r\n    buildFieldTuid(fields:Field[], mainFields?:Field[]) {\r\n        if (fields === undefined) return;\r\n        for (let f of fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            f._tuid = t.buildTuidBox();\r\n        }\r\n        for (let f of fields) {\r\n            let {owner} = f;\r\n            if (owner === undefined) continue;\r\n            let ownerField = fields.find(v => v.name === owner);\r\n            if (ownerField === undefined) {\r\n                if (mainFields !== undefined) {\r\n                    ownerField = mainFields.find(v => v.name === owner);\r\n                }\r\n                if (ownerField === undefined) {\r\n                    debugger;\r\n                    throw new Error(`owner field ${owner} is undefined`);\r\n                }\r\n            }\r\n            let {arr, tuid} = f;\r\n            let t = this.getTuid(ownerField._tuid.tuid.name);\r\n            if (t === undefined) continue;\r\n            let div = t.div(arr || tuid);\r\n            f._tuid = div && div.buildTuidDivBox(ownerField);\r\n            if (f._tuid === undefined) {\r\n                debugger;\r\n                throw new Error(`owner field ${owner} is not tuid`);\r\n            }\r\n        }\r\n    }\r\n    buildArrFieldsTuid(arrFields:ArrFields[], mainFields:Field[]) {\r\n        if (arrFields === undefined) return;\r\n        for (let af of arrFields) {\r\n            let {fields} = af;\r\n            if (fields === undefined) continue;\r\n            this.buildFieldTuid(fields, mainFields);\r\n        }\r\n    }\r\n\r\n    pullModify(modifyMax:number) {\r\n        this.tuidsCache.pullModify(modifyMax);\r\n    }\r\n}\r\n","import { Entity } from './entity';\r\nimport { PageItems } from '../tool/pageItems';\r\nimport { EntityCaller } from './caller';\r\nimport { ArrFields } from './uqMan';\r\n\r\nexport interface SheetState {\r\n    name: string;\r\n    actions: SheetAction[];\r\n}\r\n\r\nexport interface SheetAction {\r\n    name: string;\r\n}\r\n\r\nexport interface StateCount {\r\n    state: string;\r\n    count: number;\r\n}\r\n\r\nexport interface SheetSaveReturnV<V> {\r\n    id: number;\r\n    flow: number;\r\n    state: string;\r\n    verify: V[];\r\n}\r\n\r\nexport interface SheetSaveReturn extends SheetSaveReturnV<any> {\r\n}\r\n\r\ninterface GetSheetReturn<M> {\r\n    brief: any;\r\n    data: M;\r\n    flows: any[];\r\n}\r\n\r\nexport class UqSheet<M, V> extends Entity {\r\n    get typeName(): string { return 'sheet'; }\r\n    states: SheetState[];\r\n    verify: { returns: ArrFields[] };\r\n\r\n    /*\r\n    setStates(states: SheetState[]) {\r\n        for (let state of states) {\r\n            this.setStateAccess(this.states.find(s=>s.name==state.name), state);\r\n        }\r\n    }*/\r\n    setSchema(schema: any) {\r\n        super.setSchema(schema);\r\n        this.states = schema.states;\r\n        this.verify = schema.verify;\r\n    }\r\n    build(obj: any) {\r\n        this.states = [];\r\n        for (let op of obj.ops) {\r\n            this.states.push({ name: op, actions: undefined });\r\n        }\r\n        /*\r\n        for (let p in obj) {\r\n            switch(p) {\r\n                case '#':\r\n                case '$': continue;\r\n                default: this.states.push(this.createSheetState(p, obj[p])); break;\r\n            }\r\n        }*/\r\n    }\r\n    private createSheetState(name: string, obj: object): SheetState {\r\n        let ret: SheetState = { name: name, actions: [] };\r\n        let actions = ret.actions;\r\n        for (let p in obj) {\r\n            let action: SheetAction = { name: p };\r\n            actions.push(action);\r\n        }\r\n        return ret;\r\n    }\r\n    async save(discription: string, data: M): Promise<SheetSaveReturn> {\r\n        let { id } = this.uq;\r\n        let params = { app: id, discription: discription, data: data };\r\n        return await new SaveCaller(this, params).request();\r\n    }\r\n    async saveDebugDirect(discription: string, data: M): Promise<SheetSaveReturn> {\r\n        let { id } = this.uq;\r\n        let params = { app: id, discription: discription, data: data };\r\n        return await new SaveDirectCaller(this, params).request();\r\n    }\r\n    async action(id: number, flow: number, state: string, action: string) {\r\n        return await new ActionCaller(this, { id: id, flow: flow, state: state, action: action }).request();\r\n    }\r\n    async actionDebugDirect(id: number, flow: number, state: string, action: string) {\r\n        return await new ActionDirectCaller(this, { id: id, flow: flow, state: state, action: action }).request();\r\n    }\r\n    private unpack(data: any): GetSheetReturn<M> {\r\n        //if (this.schema === undefined) await this.loadSchema();\r\n        let ret = data[0];\r\n        let brief = ret[0];\r\n        let sheetData = this.unpackSheet(brief.data);\r\n        let flows = data[1];\r\n        return {\r\n            brief: brief,\r\n            data: sheetData,\r\n            flows: flows,\r\n        }\r\n    }\r\n    async getSheet(id: number): Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.getSheet(this.name, id);\r\n        */\r\n        let ret = await new GetSheetCaller(this, id).request();\r\n        if (ret[0].length === 0) return await this.getArchive(id);\r\n        return this.unpack(ret);\r\n    }\r\n    async getArchive(id: number): Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchive(this.name, id)\r\n        return this.unpack(ret);\r\n        */\r\n        let ret = await new SheetArchiveCaller(this, id).request();\r\n        return this.unpack(ret);\r\n    }\r\n\r\n    async getArchives(pageStart: number, pageSize: number) {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchives(this.name, {pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = { pageStart: pageStart, pageSize: pageSize };\r\n        return await new SheetArchivesCaller(this, params).request();\r\n    }\r\n\r\n    async getStateSheets(state: string, pageStart: number, pageSize: number): Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.stateSheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = { state: state, pageStart: pageStart, pageSize: pageSize };\r\n        return await new StateSheetsCaller(this, params).request();\r\n    }\r\n    createPageStateItems<T>(): PageStateItems<T> { return new PageStateItems<T>(this); }\r\n\r\n    async stateSheetCount(): Promise<StateCount[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret:StateCount[] = await this.uqApi.stateSheetCount(this.name);\r\n        return this.states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = ret.find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n        */\r\n        return await new StateSheetCountCaller(this, undefined).request();\r\n    }\r\n\r\n    async userSheets(state: string, user: number, pageStart: number, pageSize: number): Promise<any[]> {\r\n        let params = { state: state, user: user, pageStart: pageStart, pageSize: pageSize };\r\n        return await new UserSheetsCaller(this, params).request();\r\n    }\r\n\r\n    async mySheets(state: string, pageStart: number, pageSize: number): Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.mySheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = { state: state, pageStart: pageStart, pageSize: pageSize };\r\n        return await new MySheetsCaller(this, params).request();\r\n    }\r\n}\r\n\r\nexport class Sheet extends UqSheet<any, any> {\r\n}\r\n\r\nabstract class SheetCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Sheet { return this._entity as Sheet; }\r\n    protected readonly suffix: string;\r\n    get path(): string { return `sheet/${this.entity.name}/${this.suffix}`; }\r\n}\r\n\r\nclass SaveCaller extends SheetCaller<{ app: number; discription: string; data: any }> {\r\n    get path(): string { return `sheet/${this.entity.name}`; }\r\n    buildParams() {\r\n        let { app, discription, data } = this.params;\r\n        return {\r\n            app: app,\r\n            discription: discription,\r\n            data: this.entity.pack(data)\r\n        };\r\n    }\r\n    xresult(res: any): any {\r\n        let { verify } = this.entity;\r\n        if (verify === undefined) return res;\r\n        let resVerify = res.verify;\r\n        if (resVerify === undefined || resVerify.length === 0) {\r\n            res.verify = undefined;\r\n            return res;\r\n        }\r\n        let { returns } = verify;\r\n        res.verify = this.entity.unpackReturns(resVerify, returns);\r\n        return res;\r\n    }\r\n}\r\n\r\nclass SaveDirectCaller extends SaveCaller {\r\n    get path(): string { return `sheet/${this.entity.name}/direct`; }\r\n}\r\n\r\nclass ActionCaller extends SheetCaller<{ id: number, flow: number, state: string, action: string }> {\r\n    method = 'PUT';\r\n    get path(): string { return `sheet/${this.entity.name}`; }\r\n}\r\n\r\nclass ActionDirectCaller extends ActionCaller {\r\n    get path(): string { return `sheet/${this.entity.name}/direct`; }\r\n}\r\n\r\nclass GetSheetCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //private id:number;\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() { }\r\n    get path(): string { return `sheet/${this.entity.name}/get/${this.params}`; }\r\n}\r\n\r\nclass SheetArchiveCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() { }\r\n    get path(): string { return `sheet/${this.entity.name}/archive/${this.params}`; }\r\n}\r\n\r\nclass SheetArchivesCaller extends SheetCaller<{ pageStart: number, pageSize: number }> {\r\n    protected readonly suffix = 'archives';\r\n}\r\n\r\nclass StateSheetsCaller extends SheetCaller<{ state: string, pageStart: number, pageSize: number }> {\r\n    protected readonly suffix = 'states';\r\n}\r\n\r\nclass StateSheetCountCaller extends SheetCaller<undefined> {\r\n    method = 'GET';\r\n    protected readonly suffix = 'statecount';\r\n    xresult(res: any): any {\r\n        let { states } = this.entity;\r\n        return states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = (res as any[]).find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return { state: n, count: count }\r\n        });\r\n    }\r\n}\r\n\r\nclass UserSheetsCaller extends SheetCaller<{ state: string, user: number, pageStart: number, pageSize: number }> {\r\n    protected readonly suffix = 'user-sheets';\r\n    xresult(res: any): any {\r\n        return res;\r\n    }\r\n}\r\n\r\nclass MySheetsCaller extends SheetCaller<{ state: string, pageStart: number, pageSize: number }> {\r\n    protected readonly suffix = 'my-sheets';\r\n    xresult(res: any): any {\r\n        return res;\r\n    }\r\n}\r\n\r\nexport class PageStateItems<T> extends PageItems<T> {\r\n    private sheet: Sheet;\r\n    constructor(sheet: Sheet) {\r\n        super(true);\r\n        this.sheet = sheet;\r\n        this.pageSize = 10;\r\n    }\r\n    protected async loadResults(param: any, pageStart: any, pageSize: number): Promise<{ [name: string]: any[] }> {\r\n        let ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n        return { $page: ret };\r\n    }\r\n    /*\r\n    protected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n        let ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n        return ret;\r\n    }\r\n    */\r\n    protected getPageId(item: T) {\r\n        return item === undefined ? 0 : (item as any).id;\r\n    }\r\n    /*\r\n    protected setPageStart(item:any) {\r\n        this.pageStart = item === undefined? 0 : item.id;\r\n    }\r\n    */\r\n}\r\n","import {Query} from './query';\r\nimport { QueryQueryCaller } from './caller';\r\n\r\nexport class Book extends Query {\r\n    get typeName(): string { return 'book';}\r\n    protected queryApiName = 'book';\r\n\r\n    protected queryCaller(params: any): QueryQueryCaller {\r\n        return new BookQueryCaller(this, params);\r\n    }\r\n}\r\n\r\nexport class BookQueryCaller extends QueryQueryCaller {\r\n    get path():string {return `book/${this.entity.name}`;}\r\n}\r\n","import {Query} from './query';\r\n\r\nexport class History extends Query {\r\n    get typeName(): string { return 'history';}\r\n    protected queryApiName = 'history';\r\n}\r\n","import { Entity } from './entity';\r\nimport { Action, ActionSubmitCaller } from './action';\r\nimport { Query } from './query';\r\nimport { Field } from './uqMan';\r\nimport { EntityCaller, QueryPageCaller, QueryQueryCaller } from './caller';\r\n\r\ninterface MapActions {\r\n    add: Action;\r\n    del: Action;\r\n}\r\ninterface MapQueries {\r\n    all: Query;\r\n    page: Query;\r\n    query: Query;\r\n}\r\n\r\nexport class Map extends Entity {\r\n    get typeName(): string { return 'map';}\r\n    keys: Field[];\r\n    actions: MapActions = {} as any;\r\n    queries: MapQueries = {} as any;\r\n    schemaFrom: {owner:string; uq:string};\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.schemaFrom = this.schema.from;\r\n        let {actions, queries, keys} = schema;\r\n        this.uq.buildFieldTuid(this.keys = keys);\r\n        for (let i in actions) {\r\n            let actionSchema = actions[i];\r\n            let {name} = actionSchema;\r\n            let action = this.uq.newAction(name, undefined);\r\n            action.setSchema(actionSchema);\r\n            action.buildFieldsTuid();\r\n            (this.actions as any)[i] = action;\r\n        }\r\n        for (let i in queries) {\r\n            let querySchema = queries[i];\r\n            let {name} = querySchema;\r\n            let query = this.uq.newQuery(name, undefined);\r\n            query.setSchema(querySchema);\r\n            query.buildFieldsTuid();\r\n            (this.queries as any)[i] = query;\r\n        }\r\n    }\r\n\r\n    async add(param:any) {\r\n        let ret = await new AddCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async del(param:any) {\r\n        let ret = await new DelCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async all() {\r\n        let ret = await new AllCaller(this, undefined).request();\r\n        return ret;\r\n    }\r\n\r\n    async page(param:any, pageStart:any, pageSize: number) {\r\n        let ret = await new PageCaller(this, {pageStart:pageStart, pageSize:pageSize, param:param}).request();\r\n        return ret;\r\n    }\r\n\r\n    async query(param:any) {\r\n       let qc = new QueryCaller(this, param);\r\n       let ret = await qc.request();\r\n       return ret;\r\n   }\r\n    async table(params:any): Promise<any[]> {\r\n        let ret = await this.query(params);\r\n        for (let i in ret) {\r\n            return ret[i];\r\n        }\r\n    }\r\n    async obj(params:any):Promise<any> {\r\n        let ret = await this.table(params);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:any):Promise<any> {\r\n        let ret = await this.obj(params);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nabstract class MapCaller extends EntityCaller<any> {\r\n    protected get entity(): Map {return this._entity as Map;}\r\n    get path():string {return undefined;}\r\n\r\n    protected abstract getCaller(param: any):EntityCaller<any>;\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        let caller = this.getCaller(this.params);\r\n        let res = await this.entity.uqApi.xcall(caller);\r\n        let ret = caller.xresult(res.res);\r\n        return {res: ret};\r\n    }\r\n\r\n    buildParams() {\r\n        let p = super.buildParams();\r\n        return p;\r\n    }\r\n}\r\n\r\nclass AddCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAddCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass DelCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapDelCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass AllCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAllCaller(this.entity, this.entity.queries.all, param);\r\n    }\r\n}\r\n\r\nclass PageCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapPageCaller(this.entity, this.entity.queries.page, param);\r\n    }\r\n}\r\n\r\nclass QueryCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapQueryCaller(this.entity, this.entity.queries.query, param);\r\n    }\r\n}\r\n\r\nclass MapAddCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/add`}\r\n    get headers(): {[header:string]: string} {return undefined;}\r\n}\r\n\r\nclass MapDelCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/del`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapAllCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/all`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapPageCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/page`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapQueryCaller extends QueryQueryCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/query`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n","import {Query} from './query';\r\n\r\nexport class Pending extends Query {\r\n    get typeName(): string { return 'pending';}\r\n    protected queryApiName = 'pending';\r\n}\r\n","import { Entity } from \"./entity\";\r\n\r\nexport class UqEnum extends Entity {\r\n    get typeName(): string { return 'enum';}\r\n}","export * from './rule';\r\nexport * from './field';\r\nexport * from './face';\r\nexport * from './rowContainer';\r\nexport * from './formView';\r\nexport * from './TonvaForm';\r\nexport {ControlBase} from './control';\r\n","import * as React from 'react';\r\nimport {FormEvent} from 'react';\r\nimport {computed} from 'mobx';\r\nimport {uid} from 'tonva';\r\nimport {Rule} from './rule';\r\nimport {Field} from './field';\r\nimport {Face} from './face';\r\nimport {CreateControl, ButtonsControl} from './control';\r\nimport {RowContainer, CreateRow, bootstrapCreateRow, elementCreateRow} from './rowContainer';\r\n\r\nexport interface FieldView {\r\n    field: Field;\r\n    face?: Face;\r\n}\r\n\r\nexport interface LabeledRow {\r\n    label?: string;\r\n    createRow?: CreateRow;\r\n    createControl?: CreateControl;\r\n    help?: JSX.Element;\r\n}\r\n\r\nexport interface FieldRow extends LabeledRow, FieldView {\r\n}\r\n\r\nexport interface GroupRow extends LabeledRow {\r\n    group: FieldView[];\r\n}\r\n\r\nexport type LabelFormRow = FieldRow|GroupRow|LabeledRow;\r\nexport type FormRow = LabelFormRow|JSX.Element;\r\n\r\nexport interface SubmitResult {\r\n    success: boolean;\r\n    message?: string\r\n    result?: any;\r\n}\r\n\r\nexport interface FormProps {\r\n    formRows: FormRow[];\r\n    //context?: any;              // form context，比如，可以是EntitiesUI\r\n    rules?: Rule | Rule[];\r\n    onSubmit: (values:any) => Promise<SubmitResult|undefined>;\r\n    submitButton?: string|JSX.Element;\r\n    otherButton?: string|JSX.Element;\r\n    onOther?: (values:any) => void;\r\n    createRow?: CreateRow;\r\n    createControl?: CreateControl;\r\n    readOnly?: boolean;\r\n}\r\n\r\nexport class FormView {\r\n    uid:string;\r\n    private rows: RowContainer[] = [];\r\n    private buttonsRow: RowContainer;\r\n    props: FormProps;\r\n    createControl?: CreateControl;\r\n    constructor(props:FormProps) {\r\n        this.uid = uid();\r\n        this.props = props;\r\n        this.buildRows(props);\r\n        this.createControl = props.createControl;\r\n        this.onSubmit = this.onSubmit.bind(this);\r\n    }\r\n\r\n    @computed get hasError():boolean {\r\n        let ret = this.rows.map((v, index) => index + ': ' + v.hasError + '\\n');\r\n        console.log(ret);\r\n        return this.rows.some(row => row.hasError);\r\n    }\r\n    @computed get nothing():boolean {\r\n        let ret = this.rows.every(row => !row.filled);\r\n        return ret;\r\n    }\r\n\r\n    readValues():any {\r\n        let values = {} as any;\r\n        for (let row of this.rows) {\r\n            row.readValues(values);\r\n        }\r\n        return values;\r\n    }\r\n\r\n    clear() {\r\n        for (let row of this.rows) {\r\n            row.clear();\r\n        }\r\n    }\r\n\r\n    clearErrors() {\r\n        for (let row of this.rows) {\r\n            row.clearErrors();\r\n        }\r\n    }\r\n\r\n    setError(fieldName:string, error:string) {\r\n        for (let row of this.rows) {\r\n            row.setError(fieldName, error);\r\n        }\r\n    }\r\n\r\n    setInitValues(initValues:any) {\r\n        if (initValues === undefined) return;\r\n        for (let row of this.rows) {\r\n            row.setInitValues(initValues);\r\n        }\r\n    }\r\n\r\n    private buildRows(props:FormProps) {\r\n        let {formRows, createRow} = props;\r\n        if (formRows !== undefined) {\r\n            for (let row of formRows) {\r\n                this.rows.push(this.buildRow(row, createRow));\r\n            }\r\n            if (this.props.readOnly !== true) {\r\n                this.buttonsRow = this.buildRow({createControl:this.createButtons.bind(this)}, undefined);\r\n            }\r\n        }\r\n        else {\r\n            this.rows.push(elementCreateRow(this, <div className=\"text-warning\">TonvaForm need formRows defined</div>));\r\n        }\r\n    }\r\n\r\n    private buildRow(formRow: FormRow, formRowCreator: CreateRow):RowContainer {\r\n        let createRow:CreateRow;\r\n        let type = (formRow as JSX.Element).type;\r\n        if (type !== undefined) {\r\n            createRow = elementCreateRow;\r\n        }\r\n        else {\r\n            createRow = (formRow as (FieldRow | GroupRow | LabeledRow)).createRow;\r\n            if (createRow === undefined) {\r\n                createRow = formRowCreator;\r\n                if (createRow === undefined) createRow = bootstrapCreateRow;\r\n            }\r\n        }\r\n        let row = createRow(this, formRow);\r\n        return row;\r\n    }\r\n\r\n    private createButtons(form:FormView, row: FormRow) {\r\n        return new ButtonsControl(form);\r\n    }\r\n\r\n    private isOk():boolean {\r\n        let isOk = true;\r\n        for (let row of this.rows) {\r\n            if (!row.isOk()) isOk = false;\r\n        }\r\n        return isOk;\r\n    }\r\n\r\n    render():JSX.Element {\r\n        return <form onSubmit={this.onSubmit}>\r\n            {this.rows.map((row,index) => row.render(this.uid + index))}\r\n            {this.buttons()}\r\n        </form>;\r\n    }\r\n\r\n    buttons():JSX.Element {\r\n        if (this.buttonsRow === undefined) return;\r\n        return this.buttonsRow.render(this.uid + this.rows.length);\r\n    }\r\n    \r\n    async onSubmit(event:FormEvent<HTMLFormElement>) {\r\n        event.preventDefault();\r\n        if (!this.isOk()) return;\r\n        let values = this.readValues();\r\n        await this.props.onSubmit(values);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { Page, ItemSchema, UiSchema, StringSchema, UiTextItem, Edit, ImageSchema, nav, UiImageItem } from '../components';\r\nimport { userApi } from '../net';\r\n\r\nexport class EditMeInfo extends React.Component {\r\n    private schema:ItemSchema[] = [\r\n        {name:'nick', type:'string'} as StringSchema,\r\n        {name:'icon', type:'image'} as ImageSchema\r\n    ];\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            nick: {widget:'text', label:'别名', placeholder:'好的别名更方便记忆'} as UiTextItem,\r\n            icon: {widget:'image', label:'头像'} as UiImageItem,\r\n        }\r\n    }\r\n    @observable private data:any;\r\n\r\n    constructor(props:any) {\r\n        super(props);\r\n        let {nick, icon} = nav.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        }\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema:ItemSchema, newValue:any, preValue:any) => {\r\n        let {name} = itemSchema;        \r\n        await userApi.userSetProp(name, newValue);\r\n        this.data[name] = newValue;\r\n        let user:any = nav.user;\r\n        user[name] = newValue;\r\n        nav.saveLocalUser();\r\n    }\r\n\r\n    render() {\r\n        return <Page header=\"个人信息\">\r\n            <Edit schema={this.schema} uiSchema={this.uiSchema}\r\n                data={this.data}\r\n                onItemChanged={this.onItemChanged} />\r\n        </Page>;\r\n    }\r\n}\r\n","import { Login } from '../components';\r\n\r\nexport async function createLogin():Promise<Login> {\r\n\tlet importCLogin = await import('./CLogin');\r\n\treturn new importCLogin.CLogin(undefined);\r\n}\r\n","import * as React from 'react';\r\nimport { IValuesView, IValuesViewRenderOptions } from '../../components';\r\nimport { Tag, TagValue } from './tag';\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class TagView implements IValuesView {\r\n\tprivate tag: Tag;\r\n\tconstructor(tag: Tag) {\r\n\t\tthis.tag = tag;\r\n\t}\r\n\trender(values: number|string):JSX.Element {\r\n\t\tlet names:string[];\r\n\t\tif (typeof values === 'number') {\r\n\t\t\tnames = [this.tag.nameFromId(values)];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tnames = this.tag.namesFromIds(values);\r\n\t\t}\r\n\t\treturn <div className=\"d-flex flex-wrap \">{names.map((name, index)=>{\r\n\t\t\treturn <div key={index} className=\"mx-2 border border-muted rounded px-3 bg-light\">{name}</div>\r\n\t\t})}</div>;\r\n\t}\r\n\trenderRadios(value: number, options: IValuesViewRenderOptions): JSX.Element {\r\n        let content = this.tag.values.map((item,index) => {\r\n\t\t\treturn <div className=\"col\" key={index}>{this.renderRadio(item, value, options)}</div>;\r\n        });\r\n\t\treturn this.renderView(options, content);\r\n\t}\r\n\trenderChecks(values: string, options: IValuesViewRenderOptions): JSX.Element {\r\n\t\tlet arr = values===undefined? undefined : values.split('|').map(v => Number(v));\r\n\t\tlet content = this.tag.values.map((item,index) => {\r\n\t\t\tlet checked: boolean = arr===undefined? undefined : arr.indexOf(item.id)>=0;\r\n\t\t\treturn <div className=\"col\" key={index}>{this.renderCheck(item, checked, options)}</div>\r\n\t\t});\r\n\t\treturn this.renderView(options, content);\r\n\t}\r\n\tprivate renderView(options: IValuesViewRenderOptions, content:any) {\r\n\t\tlet {className, wrapClassName} = options;\r\n\t\twrapClassName = wrapClassName?\r\n\t\t\t'row ' + wrapClassName\r\n\t\t\t:\r\n\t\t\t'row row-cols-2 row-cols-sm-3 row-cols-md-4';\r\n\t\treturn <div className={className} style={radioStyle}>\r\n\t\t\t<div className={wrapClassName}>\r\n                {content}\r\n\t\t\t</div>\r\n        </div>;\r\n\t}\r\n\tprivate renderRadio(item:TagValue, value: number, options: IValuesViewRenderOptions):JSX.Element {\r\n\t\tlet {id, name} = item;\r\n\t\tlet {inputs, inputName, onInputChange} = options;\r\n\t\tlet ref = inputs && ((input:HTMLInputElement)=>inputs[id]=input);\r\n\t\treturn <label className=\"form-radio-inline\">\r\n\t\t\t<input ref={ref} type=\"radio\" name={inputName}\r\n\t\t\t\tvalue={id} defaultChecked={value===id}\r\n\t\t\t\tonChange={onInputChange} />\r\n\t\t\t{name}\r\n\t\t</label>;\r\n\t}\r\n\r\n\tprivate renderCheck(item:TagValue, checked: boolean, options: IValuesViewRenderOptions):JSX.Element {\r\n\t\tlet {id, name} = item;\r\n\t\tlet {inputs, onInputChange} = options;\r\n\t\tlet ref = inputs && ((input:HTMLInputElement)=>inputs[id]=input);\r\n\t\treturn <label className=\"form-radio-inline\">\r\n\t\t\t<input ref={ref} type=\"checkbox\"\r\n\t\t\t\tvalue={id} defaultChecked={checked}\r\n\t\t\t\tonChange={onInputChange} />\r\n\t\t\t{name}\r\n\t\t</label>;\r\n\t}\r\n}\r\n","import { Entity } from \"../entity\";\r\nimport { TagView } from \"./tagView\";\r\n\r\nexport interface TagValue {\r\n\tid: number;\r\n\tname: string;\r\n\text: string;\r\n}\r\n\r\nexport class Tag extends Entity {\r\n    get typeName(): string { return 'tag';}\r\n\tvalues: TagValue[];\r\n\tprivate coll: {[id:number]: TagValue} = {};\r\n\r\n\tprivate _view: TagView;\r\n\tget view(): TagView { \r\n\t\tif (this._view !== undefined) return this._view; \r\n\t\treturn this._view = new TagView(this);\r\n\t}\r\n\r\n\tnameFromId(id:number) {\r\n\t\tlet c = this.coll[id]; \r\n\t\treturn c===undefined? undefined : c.name;\r\n\t}\r\n\r\n\tnamesFromIds(ids:string):string[] {\r\n\t\tlet ret:string[] = [];\r\n\t\tfor (let id of ids.split('|')) {\r\n\t\t\tlet c = this.coll[Number(id)];\r\n\t\t\tlet name = c===undefined? undefined : c.name;\r\n\t\t\tif (name !== undefined) ret.push(name);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync loadValues():Promise<TagValue[]> {\r\n\t\tif (this.values !== undefined) return this.values;\r\n\t\tthis.values = [];\r\n\t\tlet ret = await this.uqApi.get('tag/values/' + this.name);\r\n\t\tif (ret === undefined) return;\r\n\t\tlet lines = (ret as string).split('\\n');\r\n\t\tfor (let line of lines) {\r\n\t\t\tif (line.length === 0) continue;\r\n\t\t\tlet parts = line.split('\\t');\r\n\t\t\tlet id = Number(parts[0]);\r\n\t\t\tlet val = {\r\n\t\t\t\tid: id,\r\n\t\t\t\tname: parts[1],\r\n\t\t\t\text: parts[2],\r\n\t\t\t};\r\n\t\t\tthis.values.push(val);\r\n\t\t\tthis.coll[id] = val;\r\n\t\t}\r\n\t\treturn this.values;\r\n\t}\r\n}\r\n","//import _ from 'lodash';\r\nimport { KeyValueRes, Res } from './res';\r\n\r\nexport interface FormRes extends KeyValueRes {\r\n    required: string;\r\n    number: string;\r\n    integer: string;\r\n    min: string;\r\n    max: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const formRes:Res<FormRes> = {\r\n    _: {\r\n        required: 'required',\r\n        number: 'not valid number',\r\n        integer: 'not valid integer',\r\n        min: 'min value is ${min}',\r\n        max: 'max value is ${max}',\r\n    },\r\n    zh: {\r\n        _: {\r\n            required: '必须填',\r\n            number: '需要数字',\r\n            integer: '需要整数',\r\n            min: '不能小于${min}',\r\n            max: '不能大于${max}',\r\n        }\r\n    },\r\n}\r\n","import { KeyValueRes, Res } from './res';\r\n\r\nexport interface ListRes extends KeyValueRes {\r\n    none: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const listRes:Res<ListRes> = {\r\n    _: {\r\n        none: '[none]',\r\n    },\r\n    zh: {\r\n        _: {\r\n            none: '[无]',\r\n        }\r\n    },\r\n}\r\n","export * from './page';\r\nexport * from './tabs';\r\nexport * from './scrollView';\r\nexport * from './pageHeader';","export * from './schema';\r\nexport * from './uiSchema';\r\nexport * from './toUiSelectItems';\r\nexport * from './IValuesView';","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface DropdownAction {\r\n    icon?: string;\r\n    caption?: string;\r\n    action?: () => void;\r\n    iconClass?: string;\r\n    captionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsProps {\r\n    icon?: string;\r\n    actions: DropdownAction[];\r\n    isRight?: boolean;\r\n    className?: string;\r\n    itemIconClass?: string;\r\n    itemCaptionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsState {\r\n    dropdownOpen: boolean;\r\n}\r\n\r\nexport class DropdownActions extends React.Component<DropdownActionsProps, DropdownActionsState> {\r\n    private menu: HTMLDivElement;\r\n    private button: HTMLElement;\r\n    constructor(props: DropdownActionsProps) {\r\n        super(props);\r\n        this.state = {\r\n            dropdownOpen: false\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        document.addEventListener('click', this.handleDocumentClick);\r\n        document.addEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.removeEventListener('click', this.handleDocumentClick);\r\n        document.removeEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\r\n    private handleDocumentClick = (evt: any) => {\r\n        if (this.state.dropdownOpen === false) return;\r\n        if (this.button && this.button.contains(evt.target)) return;\r\n        if (!this.menu) return;\r\n        //if (!this.menu.contains(evt.target)) \r\n        this.toggle();\r\n    }\r\n\r\n    private toggle = () => {\r\n        this.setState({\r\n            dropdownOpen: !this.state.dropdownOpen\r\n        });\r\n    }\r\n\r\n    render() {\r\n        let { icon, actions, isRight, className, itemIconClass, itemCaptionClass } = this.props;\r\n        if (isRight === undefined) isRight = true;\r\n        let hasIcon = actions.some(v => v.icon !== undefined);\r\n        let { dropdownOpen } = this.state;\r\n        //isOpen={this.state.dropdownOpen} toggle={this.toggle}\r\n        let cn = className || 'cursor-pointer dropdown-toggle btn btn-sm';\r\n        //if (className) cn += className;\r\n        return <div className={'dropdown'}>\r\n            <button ref={v => this.button = v}\r\n                className={cn}\r\n                data-toggle=\"dropdown\"\r\n                aria-expanded={dropdownOpen}\r\n                onClick={this.toggle}>\r\n                <i className={classNames('fa fa-fw ', 'fa-' + (icon || 'ellipsis-v'))} />\r\n            </button>\r\n            <div ref={v => this.menu = v} className={classNames({ \"dropdown-menu\": true, \"dropdown-menu-right\": isRight, \"show\": dropdownOpen })}>\r\n                {\r\n                    actions.map((v, index) => {\r\n                        if (!v) {\r\n                            return <div className=\"dropdown-divider\" key={index} />;\r\n                        }\r\n                        let { icon, caption, action, iconClass, captionClass } = v;\r\n                        if (icon === undefined && caption === undefined)\r\n                            return <div className=\"dropdown-divider\" />;\r\n                        let i: any;\r\n                        if (hasIcon === true) {\r\n                            if (icon !== undefined) icon = 'fa-' + icon;\r\n                            i = <i className={classNames('me-2', 'fa', icon, 'fa-fw', iconClass || itemIconClass)}\r\n                                aria-hidden={true}></i>;\r\n                        }\r\n                        if (action === undefined)\r\n                            return <h6 className=\"dropdown-header\">{i} {caption}</h6>;\r\n                        let onMenuItemClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n                            evt.preventDefault();\r\n                            action();\r\n                        }\r\n                        let onTouchStart = (evt: React.TouchEvent<HTMLAnchorElement>) => {\r\n                            action();\r\n                        }\r\n                        // eslint-disable-next-line\r\n                        return <a className=\"dropdown-item\" key={index} href=\"#/\"\r\n                            onClick={onMenuItemClick} onTouchStart={onTouchStart}\r\n                        >{i} <span className={captionClass || itemCaptionClass}>{caption}</span></a>\r\n                    })\r\n                }\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { setRes } from '../../components';\r\n\r\nexport interface EasyDateProps {\r\n    date: Date | number;\r\n}\r\n\r\n//type YMD = (year:number, month:number, date:number) => string;\r\n//type MD = (month:number, date:number) => string;\r\n\r\nconst timeRes:{[prop:string]:any} = {\r\n\tmd: (month:number, date:number) => `${month}-${date}`,\r\n\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\r\n\tyesterday: 'Yday',\r\n\ttoday: 'Today',\r\n\ttomorrow: 'Tmw',\r\n\t$zh: {\r\n\t\tmd: (month:number, date:number) => `${month}月${date}日`,\r\n\t\tymd: (year:number, month:number, date:number) => `${year}年${month}月${date}日`,\r\n\t\tyesterday: '昨天',\r\n\t\ttoday: '今天',\r\n\t\ttomorrow: '明天',\r\n\t},\r\n\t$en: {\r\n\t\tmd: (month:number, date:number) => `${month}-${date}`,\r\n\t\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\r\n\t\tyesterday: 'Yday',\r\n\t\ttoday: 'Today',\r\n\t\ttomorrow: 'Tmw',\r\n\t}\r\n}\r\n\r\nsetRes(timeRes, timeRes);\r\n\r\nfunction tt(str:string):any {\r\n\treturn timeRes[str];\r\n}\r\n\r\nfunction renderDate(vDate:Date|number, withTime:boolean, always:boolean = false) {\r\n    if (!vDate) return null;\r\n    let date: Date;\r\n    switch (typeof vDate) {\r\n        default: date = vDate as Date; break;\r\n        case 'string': date = new Date(vDate); break;\r\n        case 'number': date = new Date((vDate as number)*1000); break;\r\n    }\r\n\r\n    let now = new Date();\r\n    let tick:number, nDate:number, _date:number, month:number, year:number, nowYear:number;\r\n    let d = date;\r\n    tick = now.getTime() - d.getTime();\r\n    let hour=d.getHours(), minute=d.getMinutes();\r\n    nDate=now.getDate();\r\n    _date=d.getDate();\r\n    month=d.getMonth()+1;\r\n    year=d.getFullYear();\r\n\tnowYear = now.getFullYear();\r\n\r\n\tlet appendTime:boolean = false;\r\n\tlet dPart:string = (function() {\r\n\t\tif (tick < -24*3600*1000) {\r\n\t\t\tif (year === nowYear) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('md')(month, _date);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('ymd')(year, month, _date);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tick < 24*3600*1000) {\r\n\t\t\tif (_date!==nDate) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt(tick < 0? 'tomorrow' : 'yesterday');\r\n\t\t\t}\r\n\t\t\tif (withTime===true) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\treturn tt('today');\r\n\t\t}\r\n\t\tif (year === nowYear) {\r\n\t\t\treturn tt('md')(month, _date);\r\n\t\t}\r\n\t\treturn tt('ymd')(year, month, _date);\r\n\t})();\r\n\r\n\tlet hm = hour + ((minute<10?':0':':') + minute);\r\n\r\n\t/*\r\n    if (tick < -24*3600*1000) {\r\n        if (year === nowYear)\r\n            return tt('md')(month, _date) + ' ' + hm;\r\n        else\r\n            return tt('ymd')(year, month, _date) + ' ' + hm;\r\n    }\r\n    if (always === true || tick < 24*3600*1000) {\r\n        return _date!==nDate? \r\n            tt(tick < 0? 'tomorrow' : 'yesterday') + ' ' + hm \r\n            : withTime===true? hm : tt('today');\r\n    }\r\n    if (year === nowYear) {\r\n        return tt('md')(month, _date);\r\n    }\r\n\treturn tt('ymd')(year, month, _date);\r\n\t*/\r\n\tif (appendTime === true || always === true) {\r\n\t\treturn dPart + ' ' + hm;\r\n\t}\r\n\treturn dPart;\r\n}\r\n\r\n\r\nexport class EasyDate extends React.Component<EasyDateProps> {\r\n    render() {\r\n        return renderDate(this.props.date, false);\r\n    }\r\n}\r\n\r\ninterface EasyTimeProps extends EasyDateProps {\r\n\talways?: boolean;\r\n}\r\nexport class EasyTime extends React.Component<EasyTimeProps> {\r\n    render() {\r\n\t\tlet {date, always} = this.props;\r\n        return renderDate(date, true, always);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Image } from '.';\r\n\r\nexport interface MediaProps {\r\n    icon: string;\r\n    main: string | JSX.Element;\r\n    discription?: string | JSX.Element;\r\n    px?: number;\r\n    py?: number;\r\n}\r\n\r\nexport class Media extends React.Component<MediaProps> {\r\n    render() {\r\n        let { icon, main, discription, px, py } = this.props;\r\n        let disp: any;\r\n        if (typeof discription === 'string')\r\n            disp = <div>{discription}</div>;\r\n        else\r\n            disp = discription;\r\n        let cn = classNames(\r\n            'media',\r\n            px === undefined ? 'px-0' : 'px-' + px,\r\n            py === undefined ? 'py-2' : 'py-' + py);\r\n        return <div className={cn}>\r\n            <Image className=\"me-3 w-4c h-4c\" src={icon} />\r\n            <div className=\"media-body\">\r\n                <h5 className=\"mt-0\">{main}</h5>\r\n                {disp}\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observable } from 'mobx';\r\n\r\nexport interface SearchBoxProps {\r\n    className?: string;\r\n    label?: string;\r\n    initKey?: string;\r\n    placeholder?: string;\r\n    buttonText?: string;\r\n    maxLength?: number;\r\n    size?: 'sm' | 'md' | 'lg';\r\n    inputClassName?: string;\r\n    onSearch: (key: string) => Promise<void>;\r\n    onFocus?: () => void;\r\n    allowEmptySearch?: boolean;\r\n}\r\n\r\n/*\r\nexport interface SearchBoxState {\r\n    disabled: boolean;\r\n}*/\r\n\r\nexport class SearchBox extends React.Component<SearchBoxProps> { //}, SearchBoxState> {\r\n    private input: HTMLInputElement;\r\n    private key: string = null;\r\n    @observable private disabled: boolean;\r\n\r\n    private onChange = (evt: React.ChangeEvent<any>) => {\r\n        this.key = evt.target.value;\r\n        if (this.key !== undefined) {\r\n            this.key = this.key.trim();\r\n            if (this.key === '') this.key = undefined;\r\n        }\r\n        if (this.props.allowEmptySearch !== true) {\r\n            this.disabled = !this.key;\r\n        }\r\n    }\r\n    private onSubmit = async (evt: React.FormEvent<any>) => {\r\n        evt.preventDefault();\r\n        if (this.key === null) this.key = this.props.initKey || '';\r\n        if (this.props.allowEmptySearch !== true) {\r\n            if (!this.key) return;\r\n            if (this.input) this.input.disabled = true;\r\n        }\r\n        await this.props.onSearch(this.key);\r\n        if (this.input) this.input.disabled = false;\r\n    }\r\n    clear() {\r\n        if (this.input) this.input.value = '';\r\n    }\r\n    render() {\r\n        let { className, inputClassName, onFocus,\r\n            label, placeholder, buttonText, maxLength, size } = this.props;\r\n        let inputSize: string;\r\n        switch (size) {\r\n            default:\r\n            case 'sm': inputSize = 'input-group-sm'; break;\r\n            case 'md': inputSize = 'input-group-md'; break;\r\n            case 'lg': inputSize = 'input-group-lg'; break;\r\n        }\r\n        return <form className={className} onSubmit={this.onSubmit} >\r\n            <div className={classNames(\"input-group\", inputSize)}>\r\n                {label && <div className=\"input-group-addon align-self-center me-2\">{label}</div>}\r\n                <input ref={v => this.input = v} onChange={this.onChange}\r\n                    type=\"text\"\r\n                    name=\"key\"\r\n                    onFocus={onFocus}\r\n                    className={classNames('form-control', inputClassName || 'border-primary')}\r\n                    placeholder={placeholder}\r\n                    defaultValue={this.props.initKey}\r\n                    maxLength={maxLength} />\r\n                <div className=\"input-group-append\">\r\n                    <button className=\"btn btn-primary\"\r\n                        type=\"submit\"\r\n                        disabled={this.disabled}>\r\n                        <i className='fa fa-search' />\r\n                        <i className=\"fa\" />\r\n                        {buttonText}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </form>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { nav } from './nav';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { userApi } from '../net';\r\nimport { User } from '../tool';\r\n\r\nexport type UserLoader = (userId:number)=>Promise<any>;\r\n\r\nexport class UserCache<T> {\r\n\tprivate loader: UserLoader;\r\n\tprivate onLoaded: (user:User) => void;\r\n\tprivate map = observable(new Map<number, T|number>());\r\n\r\n\tconstructor(loader: UserLoader) {\r\n\t\tif (loader === undefined) loader = (userId:number)=>userApi.user(userId);\r\n\t\tthis.loader = loader;\r\n\t}\r\n\r\n\tuse(id:number|any, onLoaded?:(user:User)=>void) {\t\t\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tif (!id) return;\r\n\t\tthis.onLoaded = onLoaded;\r\n\t\tid = Number(id);\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (ret === undefined) {\r\n\t\t\tthis.map.set(id, id);\r\n\t\t}\r\n\t}\r\n\r\n\tgetValue(id:number|any):any {\r\n\t\tif (!id) return;\r\n\t\tswitch (typeof(id)) {\r\n\t\t\tcase 'object': \r\n\t\t\t\tid = id.id; \r\n\t\t\t\tif (!id) return;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (!ret) return;\r\n\t\tswitch (typeof(ret)) {\r\n\t\tdefault:\r\n\t\t\treturn ret;\r\n\t\tcase 'number':\r\n\t\t\tif (ret < 0) return id;\r\n\t\t\tthis.map.set(id, -id);\r\n\t\t\tthis.loader(id).then(v => {\r\n\t\t\t\tif (!v) v = null;\r\n\t\t\t\tthis.map.set(id, v);\r\n\t\t\t\tif (this.onLoaded) this.onLoaded(v);\r\n\t\t\t}).catch(reason => {\r\n\t\t\t\tconsole.error(reason);\r\n\t\t\t});\r\n\t\t\treturn id;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst userCache = new UserCache(undefined);\r\n\r\nexport interface UserIconProps {\r\n    id: number;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    altImage?: string;\r\n    noneImage?: any;\r\n}\r\n\r\nexport const UserIcon = observer((props: UserIconProps):JSX.Element => {\r\n    let {className, style, id, altImage, noneImage} = props;\r\n    let user = userCache.getValue(id);\r\n    switch (typeof user) {\r\n\tcase 'undefined':\r\n\tcase 'number':\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            {noneImage || <i className=\"fa fa-file-o\" />}\r\n        </div>;\r\n    }\r\n    let {icon} = user;\r\n    if (!icon) {\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            <i className=\"fa fa-file-o\" />\r\n        </div>;\r\n    }\r\n    if (icon.startsWith(':') === true) {\r\n        icon = nav.resUrl + icon.substr(1);\r\n    }\r\n    return <img src={icon} className={className} alt=\"img\"\r\n        style={style}\r\n        onError={evt=>{\r\n            if (altImage) evt.currentTarget.src=altImage;\r\n            else evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n        }} />;\r\n});\r\n\r\nexport interface UserViewProps {\r\n\tid?: number;\r\n\tuser?: number|User;\r\n\trender: (user:User) => JSX.Element;\r\n\tonLoaded?: (user:User) => void\r\n}\r\n\r\nexport const UserView = observer((props: UserViewProps):JSX.Element => {\r\n\tlet {id:idProp, user, render, onLoaded} = props;\r\n\tif (user === null) return <>null</>;\r\n\tswitch (typeof user) {\r\n\t\tcase 'undefined': \r\n\t\t\tuser = userCache.getValue(idProp);\r\n\t\t\tbreak;\r\n\t\tcase 'object': \r\n\t\t\tlet {/*obj, */id} = user as any;\r\n\t\t\t//if (typeof obj !== 'object') {\r\n\t\t\t\tuseUser(id, onLoaded);\r\n\t\t\t\tuser = userCache.getValue(id);\r\n\t\t\t//}\r\n\t\t\tbreak;\r\n\t\tcase 'number':\r\n\t\t\tuseUser(user as number, onLoaded);\r\n\t\t\tuser = userCache.getValue(user as number);\r\n\t\t\tbreak;\r\n\t\tcase 'string':\r\n\t\t\tuseUser(Number(user), onLoaded);\r\n\t\t\tuser = userCache.getValue(Number(user));\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tuser = undefined;\r\n\t\t\tbreak;\r\n\t}\r\n    switch (typeof user) {\r\n\t\tcase 'undefined':\r\n\t\tcase 'number':\r\n        \treturn <>{user}</>;\r\n    }\r\n    return render(user);\r\n});\r\n\r\nexport function useUser(id: number|object, onLoaded?: (user:User)=>void) {\r\n\tif (!id) return;\r\n\tif (typeof(id) === 'object') {\r\n\t\tid = (id as any).id;\r\n\t}\r\n\tuserCache.use(id, onLoaded);\r\n}\r\n","import React from \"react\";\r\nimport classNames from 'classnames';\r\nimport { nav } from \"../nav\";\r\n\r\nexport interface AxProps extends React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement> {\r\n\t//children: React.ReactNode;\r\n\t//href: string;\r\n\t//onClick?: (event:React.MouseEvent) => void;\r\n\t//className?: string;\r\n\taClassName?: string;\r\n\tnaClassName?: string;\r\n\t//target?: string;\r\n\t//props?: any;\r\n}\r\n\r\n// 如果是web方式，用webNav方式route网页\r\n// 如果是app方式，用click方式压栈页面\r\nexport const Ax = (axProps: AxProps) => {\r\n\tlet {href, children, className, onClick} = axProps;\r\n\tif (nav.isWebNav === true) {\r\n\t\tlet {aClassName } = axProps;\r\n\t\tif (!href) return <span className=\"text-danger\">Error: href not defined in Ax</span>;\r\n\t\tlet onAxClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\t\tevt.preventDefault();\r\n\t\t\tlet ret:boolean;\r\n\t\t\tif (onClick) {\r\n\t\t\t\tret = onClick(evt) as unknown as boolean;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tnav.navigate(href);\r\n\t\t\t\tret = false;\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\treturn <a {...axProps} className={classNames(className, aClassName)} onClick={onAxClick}>{children}</a>;\r\n\t}\r\n\telse {\r\n\t\tlet {naClassName} = axProps;\r\n\t\tif (!onClick) {\r\n\t\t\tonClick = () => {\r\n\t\t\t\tnav.openSysPage(href); //.navigate(href);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <span className={classNames(className, 'cursor-pointer', naClassName)} onClick={onClick}>{children}</span>;\r\n\t}\r\n}\r\n\r\n// 同普通的a tag\r\n// 会自动处理href，处理生产版跟测试版之间的不同\r\nexport const A = (props: React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement>) => {\r\n\tlet {children} = props;\r\n\tif (nav.isWebNav === false) {\r\n\t\treturn <a {...props}>{children}</a>;\r\n\t}\r\n\tlet {href} = props;\r\n\t//if (nav.testing === true) href += '#test';\r\n\tlet onClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\tevt.preventDefault();\r\n\t\tnav.navigate(href);\r\n\t\treturn false;\r\n\t}\r\n\treturn <a {...props} href={href} onClick={onClick}>{children}</a>;\r\n}\r\n","import React from 'react';\r\nimport { observer } from \"mobx-react\";\r\nimport { IObservableValue } from 'mobx';\r\n\r\n//export function autoHideTips(visible: IObservableValue<boolean>, tips:string|JSX.Element, timeout?:number):React.FunctionComponentElement<any>;\r\n//export function autoHideTips(tips: IObservableValue<string>, tips:string|JSX.Element, timeout?:number):React.FunctionComponentElement<any>;\r\n\r\nexport function autoHideTips(\r\n\ttips: IObservableValue<boolean|string|JSX.Element>, \r\n\ttemplet?:string|JSX.Element|((v:string|JSX.Element)=>JSX.Element), \r\n\ttimeout?:number):React.FunctionComponentElement<any> {\r\n/*\r\nexport function autoHideTips(tips: IObservableValue<boolean|string|JSX.Element>, timeout?:number):React.FunctionComponentElement<any>;\r\nexport function autoHideTips(tips: IObservableValue<boolean|string|JSX.Element>, templet:(tips: boolean|string|JSX.Element) => JSX.Element, timeout?:number):React.FunctionComponentElement<any>;\r\n\r\nexport function autoHideTips(tips: IObservableValue<boolean|string|JSX.Element>, ...params:any[]) {\r\n*/\r\n\tlet timer:any;\r\n\treturn React.createElement(observer(():JSX.Element => {\r\n\t\tif (timer) {\r\n\t\t\tclearTimeout(timer);\r\n\t\t\ttimer = undefined;\r\n\t\t}\r\n\t\tlet t = tips.get();\r\n\t\tif (!t) return null;\r\n\t\tif (timeout === undefined) timeout = 3000;\r\n\t\t//let p0 = params[0];\r\n\t\t//let timeout = 3000;\r\n\t\t//let templet: (tips: boolean|string|JSX.Element) => JSX.Element;\r\n\t\t/*\r\n\t\tswitch (typeof p0) {\r\n\t\t\tcase 'number':\r\n\t\t\t\ttimeout = p0;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'function':\r\n\t\t\t\ttemplet = p0;\r\n\t\t\t\tlet p1 = params[1];\r\n\t\t\t\tif (typeof p1 === 'number') {\r\n\t\t\t\t\ttimeout = p1;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\tif (timeout > 0) {\r\n\t\t\ttimer = setTimeout(() => {\r\n\t\t\t\ttips.set(null);\r\n\t\t\t}, timeout);\r\n\t\t}\r\n\t\tswitch (typeof templet) {\r\n\t\t\tcase 'undefined': return <>{t}</>;\r\n\t\t\tcase 'function': return templet(t as string);\r\n\t\t\tcase 'string': return <>{templet}</>;\r\n\t\t\tdefault: return templet;\r\n\t\t}\r\n\t}));\r\n};\r\n","import { UqMan, TuidModify } from '../uqMan';\r\nimport { Tuid } from \"./tuid\";\r\nimport { env } from '../../tool';\r\n\r\ninterface Modify {\r\n    id: number;\r\n    entity: string;\r\n    key: string;\r\n}\r\n\r\nexport class TuidsCache {\r\n    private readonly uq: UqMan;\r\n    private modifyMax: TuidModify;\r\n    private cacheTimer: any;\r\n    constructor(uq: UqMan) {\r\n        this.uq = uq;\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.clearCacheTimer();\r\n        this.cacheTimer = env.setTimeout('TuidsCache.cacheTuids', this.loadIds, defer);\r\n    }\r\n    private clearCacheTimer() {\r\n        if (this.cacheTimer === undefined) return;\r\n        env.clearTimeout(this.cacheTimer);\r\n        this.cacheTimer = undefined;\r\n    }\r\n    private loadIds = () => {\r\n        this.clearCacheTimer();\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            let tuid = tuids[i];\r\n            tuid.cacheIds();\r\n        }\r\n    }\r\n    \r\n    pullModify(modifyMax:number) {\r\n        if (modifyMax === undefined) return;\r\n        let now = Math.floor(Date.now() / 1000);\r\n        if (this.modifyMax === undefined) {\r\n            this.modifyMax = this.uq.localModifyMax.get();\r\n            if (this.modifyMax === undefined) {\r\n                this.modifyMax = {\r\n                    max: modifyMax,\r\n                    seconds: now,\r\n                };\r\n                this.uq.localModifyMax.set(this.modifyMax);\r\n            }\r\n        }\r\n        let {max, seconds} = this.modifyMax;\r\n        let lockGap = 3600;\r\n        if (now - seconds < lockGap) return;\r\n        if (modifyMax <= max) return;\r\n        let tuidCached:string[] = [];\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            //if (tuids[i].cached === true) \r\n            tuidCached.push(i);\r\n        }\r\n        if (tuidCached.length === 0) return;\r\n        this.modifyMax.seconds = now;\r\n        this.innerPullModify(tuidCached.join('\\t'));\r\n    }\r\n\r\n    private async innerPullModify(tuidLists:string):Promise<void> {\r\n        let {uqApi, tuids} = this.uq;\r\n        let {max} = this.modifyMax;\r\n        let ret:{queue:Modify[], queueMax:number} = await uqApi.queueModify(max, 30, tuidLists);\r\n        let group:{[entity:string]: {tuid:Tuid; ids: string[]}} = {};\r\n        let modifyMax:number = 0;\r\n        for (let modify of ret.queue) {\r\n\t\t\tlet {id, entity, key} = modify;\r\n\t\t\tif (!key) continue;\r\n            let tuid = tuids[entity];\r\n            if (tuid === undefined) continue;\r\n            let item = group[entity];\r\n            if (item === undefined) {\r\n                item = group[entity] = {tuid: tuid, ids:[]};\r\n            }\r\n            item.ids.push(key);\r\n            if (id > modifyMax) modifyMax = id;\r\n        }\r\n        for (let i in group) {\r\n            let {tuid, ids} = group[i];\r\n            await tuid.modifyIds(ids);\r\n        }\r\n        let now = Math.floor(Date.now() / 1000);\r\n        this.modifyMax = {\r\n            max: modifyMax,\r\n            seconds: now,\r\n        }\r\n        this.uq.localModifyMax.set(this.modifyMax);\r\n    }\r\n}\r\n","import { LocalMap, LocalCache, env } from '../tool';\r\nimport { UqData, UqAppData, loadAppUqs } from '../net';\r\nimport { UqMan } from './uqMan';\r\nimport { TuidImport, TuidInner } from './tuid';\r\nimport { nav } from '../components';\r\n\r\nexport interface TVs {\r\n    [uqName:string]: {\r\n        [tuidName: string]: (values: any) => JSX.Element;\r\n    }\r\n}\r\n\r\nexport class UQsMan {\r\n\tstatic _uqs: any;\r\n\tstatic value: UQsMan;\r\n\tstatic errors: string[];\r\n\r\n\tstatic async load(tonvaAppName:string, version:string, tvs:TVs) {\r\n\t\tlet uqsMan = UQsMan.value = new UQsMan(tonvaAppName, tvs);\r\n        let {appOwner, appName} = uqsMan;\r\n        let {localData} = uqsMan;\r\n        let uqAppData:UqAppData = localData.get();\r\n        if (!uqAppData || uqAppData.version !== version) {\r\n\t\t\tuqAppData = await loadAppUqs(appOwner, appName);\r\n\t\t\tif (!uqAppData.id) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t`${appOwner}/${appName}不存在。请仔细检查app全名。`\r\n\t\t\t\t];\r\n\t\t\t}\r\n            uqAppData.version = version;\r\n            localData.set(uqAppData);\r\n            // \r\n            for (let uq of uqAppData.uqs) uq.newVersion = true;\r\n        }\r\n        let {id, uqs} = uqAppData;\r\n        uqsMan.id = id;\r\n        await uqsMan.init(uqs);\r\n        let retErrors = await uqsMan.load();\r\n        if (retErrors.length === 0) {\r\n            retErrors.push(...uqsMan.setTuidImportsLocal());\r\n            if (retErrors.length === 0) {\r\n                UQsMan._uqs = uqsMan.buildUQs();\r\n                return;\r\n            }\r\n        }\r\n        UQsMan.errors = retErrors;\r\n\t}\r\n\r\n    private collection: {[uqName: string]: UqMan};\r\n    private readonly tvs: TVs;\r\n\r\n    readonly appOwner: string;\r\n    readonly appName: string;\r\n    readonly localMap: LocalMap;\r\n    readonly localData: LocalCache;\r\n    id: number;\r\n\r\n    private constructor(tonvaAppName:string, tvs:TVs) {\r\n        this.tvs = tvs || {};\r\n        this.buildTVs();\r\n        this.collection = {};\r\n        let parts = tonvaAppName.split('/');\r\n        if (parts.length !== 2) {\r\n            throw new Error('tonvaApp name must be / separated, owner/app');\r\n        }\r\n        this.appOwner = parts[0];\r\n        this.appName = parts[1];\r\n        this.localMap = env.localDb.map(tonvaAppName);\r\n        this.localData = this.localMap.child('uqData');\r\n    }\r\n\r\n    // to be removed in the future\r\n    addUq(uq: UqMan) {\r\n        this.collection[uq.name] = uq;\r\n    }\r\n\r\n    private buildTVs() {\r\n        for (let i in this.tvs) {\r\n            let uqTVs = this.tvs[i];\r\n            if (uqTVs === undefined) continue;\r\n            let l = i.toLowerCase();\r\n            if (l === i) continue;\r\n            this.tvs[l] = uqTVs;\r\n            for (let j in uqTVs) {\r\n                let en = uqTVs[j];\r\n                if (en === undefined) continue;\r\n                let lj = j.toLowerCase();\r\n                if (lj === j) continue;\r\n                uqTVs[lj] = en;\r\n            }\r\n        }\r\n    }\r\n\r\n    async init(uqsData:UqData[]):Promise<void> {\r\n        let promiseInits: PromiseLike<void>[] = uqsData.map(uqData => {\r\n\t\t\tlet {uqOwner, uqName} = uqData;\r\n\t\t\tlet uqFullName = uqOwner + '/' + uqName;\r\n\t\t\t//let uqUI = this.ui.uqs[uqFullName] as UqUI || {};\r\n\t\t\t//let cUq = this.newCUq(uqData, uqUI);\r\n\t\t\t//this.cUqCollection[uqFullName] = cUq;\r\n\t\t\t//this.uqs.addUq(cUq.uq);\r\n\t\t\tlet uq = new UqMan(this, uqData, undefined, this.tvs[uqFullName] || this.tvs[uqName]);\r\n\t\t\tthis.collection[uqFullName] = uq;\r\n\t\t\tlet lower = uqFullName.toLowerCase();\r\n\t\t\tif (lower !== uqFullName) {\r\n\t\t\t\tthis.collection[lower] = uq;\r\n\t\t\t}\r\n\t\t\treturn uq.init();\r\n\t\t});\r\n        await Promise.all(promiseInits);\r\n    }\r\n\r\n    async load(): Promise<string[]> {\r\n        let retErrors:string[] = [];\r\n        let promises: PromiseLike<string>[] = [];\r\n        for (let i in this.collection) {\r\n            let uq = this.collection[i];\r\n            promises.push(uq.loadEntities());\r\n\t\t}\r\n        let results = await Promise.all(promises);\r\n        for (let result of results)\r\n        {\r\n            let retError = result; // await cUq.loadSchema();\r\n            if (retError !== undefined) {\r\n                retErrors.push(retError);\r\n                continue;\r\n            }\r\n\t\t}\r\n        return retErrors;\r\n    }\r\n\r\n    buildUQs(): any {\r\n        let that = this;\r\n        let uqs:any = {};\r\n        for (let i in this.collection) {\r\n            let uqMan = this.collection[i];\r\n            //let n = uqMan.name;\r\n            let uqName = uqMan.uqName;\r\n            let l = uqName.toLowerCase();\r\n\t\t\tlet uqKey:string = uqName.split(/[-._]/).join('').toLowerCase();\r\n            let entities = uqMan.entities;\r\n            let keys = Object.keys(entities);\r\n            for (let key of keys) {\r\n                let entity = entities[key];\r\n\t\t\t\tlet {name} = entity;\r\n\t\t\t\tentities[name.toLowerCase()] = entity;\r\n            }\r\n            let proxy = uqs[l] = new Proxy(entities, {\r\n                get: function(target, key, receiver) {\r\n                    let lk = (key as string).toLowerCase();\r\n                    let ret = target[lk];\r\n                    if (ret !== undefined) return ret;\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t\tlet err = `entity ${uqName}.${String(key)} not defined`;\r\n                    console.error(err);\r\n                    that.showReload('UQ错误：' + err);\r\n                    return undefined;\r\n                }\r\n\t\t\t})\r\n\t\t\tif (uqKey !== l) uqs[uqKey] = proxy;\r\n        }\r\n        //let uqs = this.collection;\r\n        return new Proxy(uqs, {\r\n            get: function (target, key, receiver) {\r\n                let lk = (key as string).toLowerCase();\r\n                let ret = target[lk];\r\n                if (ret !== undefined) return ret;\r\n                /*\r\n                for (let i in uqs) {\r\n                    if (i.toLowerCase() === lk) {\r\n                        return uqs[i];\r\n                    }\r\n                }*/\r\n                debugger;\r\n                console.error('error in uqs');\r\n                that.showReload(`代码错误：新增 uq ${String(key)}`);\r\n                return undefined;\r\n            },\r\n        });\r\n\t}\r\n\t\r\n\tgetUqCollection() {\r\n\t\treturn this.collection;\r\n\t}\r\n\r\n    private showReload(msg: string) {\r\n        this.localMap.removeAll();\r\n        nav.showReloadPage(msg);\r\n    }\r\n\r\n    setTuidImportsLocal():string[] {\r\n        let ret:string[] = [];\r\n        for (let i in this.collection) {\r\n            let uq = this.collection[i];\r\n            for (let tuid of uq.tuidArr) {\r\n                if (tuid.isImport === true) {\r\n                    let error = this.setInner(tuid as TuidImport);\r\n                    if (error) ret.push(error);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private setInner(tuidImport: TuidImport):string {\r\n        let {from} = tuidImport;\r\n        let fromName = from.owner + '/' + from.uq;\r\n        let uq = this.collection[fromName];\r\n        if (uq === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} is not loaded`;\r\n        }\r\n        let iName = tuidImport.name\r\n        let tuid = uq.tuid(iName);\r\n        if (tuid === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} has no Tuid ${iName}`;\r\n        }\r\n        if (tuid.isImport === true) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} Tuid ${iName} is import`;\r\n        }\r\n        tuidImport.setFrom(tuid as TuidInner);\r\n    }\r\n}\r\n","import fs from 'fs';\r\nimport {\r\n\tAction, Book, Query, Sheet, Tuid, UqEnum, UqMan, UQsMan\r\n\t, Map, History, Tag, Pending, Entity, ArrFields, Field\r\n} from './index';\r\nimport { nav } from '../components';\r\nimport { AppConfig } from '../app';\r\n//import { env } from 'tonva/tool';\r\n\r\n//const uqAppPath = 'src/UqApp';\r\nconst red = '\\x1b[41m%s\\x1b[0m';\r\nlet lastBuildTime: number = 0;\r\nlet gUqOwnerMap: { [key: string]: string };\r\n\r\nexport interface UqAppOptions extends Partial<AppConfig> {\r\n\tuqAppName: string;\r\n\tuqAppVersion: string;\r\n\tuqAppUnitId: number;\r\n\tuqAppSrcPath?: string;\r\n\tuqOwnerMap?: { [key: string]: string };\r\n}\r\n\r\nexport async function uqAppStart(options: UqAppOptions) {\r\n\tlet { uqAppName, uqAppVersion: appVersion, uqAppUnitId: appUnitId } = options;\r\n\tprocess.env.REACT_APP_UNIT = String(appUnitId);\r\n\tnav.forceDevelopment = true;\r\n\tawait nav.init();\r\n\tawait UQsMan.load(uqAppName, appVersion, undefined);\r\n}\r\nexport async function buildUqApp(options: UqAppOptions) {\r\n\tlet { uqAppSrcPath, uqOwnerMap } = options;\r\n\tif (!uqAppSrcPath) uqAppSrcPath = 'src/UqApp';\r\n\tgUqOwnerMap = uqOwnerMap || {};\r\n\tfor (let i in gUqOwnerMap) {\r\n\t\tgUqOwnerMap[i.toLowerCase()] = gUqOwnerMap[i];\r\n\t}\r\n\tif (lastBuildTime > 0) {\r\n\t\t//if (Date.now() - lastBuildTime < 30*1000) {\r\n\t\tconsole.log(red, 'quit !');\r\n\t\treturn;\r\n\t}\r\n\tif (!fs.existsSync(uqAppSrcPath)) {\r\n\t\tfs.mkdirSync(uqAppSrcPath);\r\n\t}\r\n\tlet tsAppName = buildTsAppName(options);\r\n\tsaveTsFile(uqAppSrcPath, 'appName', tsAppName);\r\n\tlet tsAppConfig = buildTsAppConfig(options);\r\n\tsaveTsFileIfNotExists(uqAppSrcPath, 'appConfig', tsAppConfig);\r\n\tlet tsIndex = buildTsIndex();\r\n\tsaveTsFile(uqAppSrcPath, 'index', tsIndex);\r\n\tlet tsCApp = buildTsCApp();\r\n\tsaveTsFileIfNotExists(uqAppSrcPath, 'CApp', tsCApp);\r\n\tlet tsCBase = buildTsCBase();\r\n\tsaveTsFile(uqAppSrcPath, 'CBase', tsCBase);\r\n\tlet tsVMain = buildTsVMain();\r\n\tsaveTsFileIfNotExists(uqAppSrcPath, 'VMain', tsVMain, 'tsx');\r\n\r\n\tsaveTsFile(uqAppSrcPath, 'uqs', '');\r\n\tfs.unlinkSync(uqAppSrcPath + '/uqs.ts');\r\n\tawait buildUqsFolder(uqAppSrcPath + '/uqs', options);\r\n};\r\n\r\nfunction saveTsFileIfNotExists(uqAppSrcPath: string, fileName: string, content: string, suffix: string = 'ts') {\r\n\tlet tsFile = `${uqAppSrcPath}/${fileName}.${suffix}`;\r\n\tif (fs.existsSync(tsFile) === true) return;\r\n\tsaveTsFile(uqAppSrcPath, fileName, content, suffix);\r\n}\r\nfunction saveTsFile(uqAppSrcPath: string, fileName: string, content: string, suffix: string = 'ts') {\r\n\tlet srcFile = `${uqAppSrcPath}/${fileName}.${suffix}.txt`;\r\n\tlet tsFile = `${uqAppSrcPath}/${fileName}.${suffix}`;\r\n\tif (!fs.existsSync(srcFile)) {\r\n\t\tif (fs.existsSync(tsFile)) {\r\n\t\t\tfs.renameSync(tsFile, srcFile);\r\n\t\t}\r\n\t}\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\nfunction overrideTsFile(uqAppSrcPath: string, fileName: string, content: string, suffix: string = 'ts') {\r\n\tlet tsFile = `${uqAppSrcPath}/${fileName}.${suffix}`;\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\nfunction buildTsHeader() {\r\n\treturn `//=== UqApp builder created on ${new Date()} ===//`;\r\n}\r\nfunction buildTsAppName(options: UqAppOptions): string {\r\n\tlet { uqAppName, appName } = options;\r\n\treturn `${buildTsHeader()}\r\nexport const appName = '${uqAppName || appName}';\r\n`;\r\n}\r\nfunction buildTsAppConfig(options: UqAppOptions): string {\r\n\tlet { version, noUnit, tvs, oem, htmlTitle } = options;\r\n\tfunction toString(s: string) {\r\n\t\tif (s === undefined) return;\r\n\t\tif (s === null) return null;\r\n\t\treturn `'${s}'`;\r\n\t}\r\n\treturn `${buildTsHeader()}\r\nimport { AppConfig } from \"tonva\";\r\nimport { appName } from \"./appName\";\r\n\r\nexport const appConfig: AppConfig = {\r\n    appName: appName,\r\n\tversion: ${toString(version)},\r\n\tnoUnit: ${noUnit},\r\n    tvs: ${JSON.stringify(tvs)},\r\n\toem: ${toString(oem)},\r\n\thtmlTitle: ${toString(htmlTitle)},\r\n};\r\n`;\r\n}\r\nfunction buildTsIndex(): string {\r\n\treturn `${buildTsHeader()}\r\nexport { appConfig } from './appConfig';\r\nexport { CUqApp, CUqBase, CUqSub } from './CBase';\r\nexport { CApp } from './CApp';\r\nexport * from './uqs';\r\n`;\r\n}\r\nfunction buildTsCApp(): string {\r\n\treturn `${buildTsHeader()}\r\nimport { CUqApp } from \"./CBase\";\r\nimport { VMain } from \"./VMain\";\r\n\r\nexport class CApp extends CUqApp {\r\n\tprotected async internalStart(isUserLogin: boolean) {\r\n\t\tthis.openVPage(VMain, undefined, this.dispose);\r\n\t}\r\n}\r\n`;\r\n}\r\nfunction buildTsCBase(): string {\r\n\treturn `${buildTsHeader()}\r\nimport { CSub, CBase, CAppBase, IConstructor } from 'tonva';\r\nimport { UQs } from './uqs';\r\nimport { CApp } from './CApp';\r\n\r\nexport abstract class CUqBase extends CBase {\r\n\tget cApp(): CApp { return this._cApp; }\r\n\tprotected get uqs(): UQs { return this._uqs as UQs };\r\n}\r\n\r\nexport abstract class CUqSub<T extends CUqBase> extends CSub<T> {\r\n\tget cApp(): CApp { return this._cApp; }\r\n\tprotected get uqs(): UQs { return this._uqs as UQs };\r\n\tget owner(): T { return this._owner as T }\r\n}\r\n\r\nexport abstract class CUqApp extends CAppBase {\r\n\tget uqs(): UQs { return this._uqs };\r\n\r\n\tprotected newC<T extends CUqBase>(type: IConstructor<T>): T {\r\n\t\tlet c = new type(this);\r\n\t\tc.init();\r\n\t\treturn c;\r\n\t}\r\n}\r\n`;\r\n}\r\nfunction buildTsVMain() {\r\n\treturn `${buildTsHeader()}\r\nimport { VPage, Page } from 'tonva';\r\nimport { CApp } from './CApp';\r\n\r\nexport class VMain extends VPage<CApp> {\r\n\tasync open(param?: any, onClosePage?: (ret:any)=>void) {\r\n\t\tthis.openPage(this.render, param, onClosePage);\r\n\t}\r\n\r\n\trender = (param?: any): JSX.Element => {\r\n\t\treturn <Page header=\"TEST\">\r\n\t\t\t<div className=\"m-3\">\r\n\t\t\t\t<div>{this.renderMe()}</div>\r\n\t\t\t\t<div className=\"mb-5\">同花样例主页面</div>\r\n\t\t\t</div>\r\n\t\t</Page>;\r\n\t}\r\n}\r\n`;\r\n}\r\n\r\nasync function buildUqsFolder(uqsFolder: string, options: UqAppOptions) {\r\n\tawait uqAppStart(options);\r\n\r\n\tlet uqsMan = UQsMan.value;\r\n\tlet coll = uqsMan.getUqCollection();\r\n\r\n\tlet promiseArr: Promise<void>[] = [];\r\n\tlet uqs: UqMan[] = [];\r\n\tfor (let i in coll) {\r\n\t\tlet lowerI = i.toLowerCase();\r\n\t\tif (lowerI !== i) continue;\r\n\t\tuqs.push(coll[i]);\r\n\t}\r\n\r\n\tif (!uqsMan.id) {\r\n\t\tlet error = options.uqAppName + ' not defined!';\r\n\t\tthrow new Error(error);\r\n\t}\r\n\r\n\tfor (let uq of uqs) {\r\n\t\tpromiseArr.push(loadUqEntities(uq));\r\n\t}\r\n\tawait Promise.all(promiseArr);\r\n\r\n\tif (!fs.existsSync(uqsFolder)) {\r\n\t\tfs.mkdirSync(uqsFolder);\r\n\t}\r\n\tlet tsUqsIndexHeader = buildTsHeader();\r\n\tlet tsUqsIndexContent = `\\n\\nexport interface UQs {`;\r\n\tlet tsUqsExports = '\\n\\n';\r\n\tfor (let uq of uqs) {\r\n\t\tlet { uqOwner, uqName } = uq;\r\n\t\tlet o1 = getUqOwnerName(uqOwner);\r\n\t\tlet n1 = getUqName(uqName);\r\n\t\tlet tsUq = buildTsUq(uq);\r\n\t\toverrideTsFile(uqsFolder, o1 + n1, tsUq);\r\n\t\t// as ${o1}${n1}\r\n\t\ttsUqsIndexHeader += `\\nimport { ${o1}${n1} } from './${o1}${n1}';`;\r\n\t\ttsUqsIndexContent += `\\n\\t${o1}${n1}: ${o1}${n1}.Uq${o1}${n1};`;\r\n\r\n\t\ttsUqsExports += `\\nexport {`;\r\n\t\tfor (let enm of uq.enumArr) {\r\n\t\t\tlet enmName = `${capitalCaseString(enm.sName)}`;\r\n\t\t\ttsUqsExports += `\\n\\t${enmName} as ${o1}${n1}${enmName},`;\r\n\t\t}\r\n\t\ttsUqsExports += `\\n} from './${o1}${n1}';`;\r\n\t}\r\n\r\n\toverrideTsFile(uqsFolder, 'index',\r\n\t\ttsUqsIndexHeader + tsUqsIndexContent + '\\n}' + tsUqsExports + '\\n');\r\n}\r\n\r\nfunction buildTsUq(uq: UqMan) {\r\n\tlet ret = buildTsHeader();\r\n\tret += '\\nimport { UqTuid, UqQuery, UqAction, UqSheet/*, Map, Tag*/ } from \"tonva\";';\r\n\r\n\t//for (let uq of uqs) {\r\n\tret += '\\n';\r\n\tret += '\\n//===============================';\r\n\tret += `\\n//======= UQ ${uq.name} ========`;\r\n\tret += '\\n//===============================';\r\n\tret += '\\n';\r\n\tret += buildUQ(uq);\r\n\tret += '\\n';\r\n\tret += '\\n';\r\n\t//}\r\n\t/*\r\n\tret += '\\n//===============================';\r\n\tret += `\\n//============= UQs =============`;\r\n\tret += '\\n//===============================';\r\n\tret += '\\nexport interface UQs {';\r\n\tfor (let uq of uqs) {\r\n\t\tlet {uqOwner, uqName} = uq;\r\n\t\tlet o1 = getUqOwnerName(uqOwner);\r\n\t\tlet n1 = getUqName(uqName);\r\n\t\tret += `\\n\\t${o1}${n1}: ${o1}${n1}.Uq;`;\r\n\t}\r\n\tret += '\\n}\\n';\r\n\t*/\r\n\treturn ret;\r\n}\r\n\r\nfunction capitalCaseString(s: string): string {\r\n\tlet parts = s.split(/[-._]/);\r\n\treturn parts.map(v => firstCharUppercase(v)).join('');\r\n}\r\n\r\nfunction camelCaseString(s: string): string {\r\n\tlet parts = s.split(/[-._]/);\r\n\tlet len = parts.length;\r\n\tparts[0] = firstCharLowercase(parts[0]);\r\n\tfor (let i = 1; i < len; i++) {\r\n\t\tparts[1] = firstCharUppercase(parts[1]);\r\n\t}\r\n\treturn parts.join('');\r\n}\r\nfunction entityName(s: string): string {\r\n\treturn capitalCaseString(s);\r\n}\r\n\r\nfunction getUqOwnerName(uqOwner: string) {\r\n\tlet uo = gUqOwnerMap[uqOwner.toLowerCase()];\r\n\tif (uo === undefined) return '';\r\n\tif (uo.length === 0) return '';\r\n\treturn capitalCaseString(uo);\r\n}\r\n\r\nfunction getUqName(uqName: string) {\r\n\treturn capitalCaseString(uqName);\r\n}\r\n\r\nfunction uqBlock<T extends Entity>(entity: T, build: (entity: T) => string) {\r\n\tlet { name } = entity;\r\n\tif (name.indexOf('$') > 0) return '';\r\n\tlet entityCode = build(entity);\r\n\tif (!entityCode) return '';\r\n\treturn '\\n' + entityCode;\r\n}\r\n\r\nfunction uqEntityInterface<T extends Entity>(entity: T, buildInterface: (entity: T) => string) {\r\n\tlet { name } = entity;\r\n\tif (name.indexOf('$') > 0) return '';\r\n\tlet entityCode = buildInterface(entity);\r\n\tif (!entityCode) return '';\r\n\t//return uqFirstLine(entity) + \r\n\treturn '\\n' + entityCode + '\\n';\r\n}\r\n\r\nconst aCode = 'a'.charCodeAt(0);\r\nconst zCode = 'z'.charCodeAt(0);\r\nfunction firstCharUppercase(s: string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= aCode && c <= zCode) {\r\n\t\treturn String.fromCharCode(c - 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\nconst ACode = 'A'.charCodeAt(0);\r\nconst ZCode = 'Z'.charCodeAt(0);\r\nfunction firstCharLowercase(s: string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= ACode && c <= ZCode) {\r\n\t\treturn String.fromCharCode(c + 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\n\r\nasync function loadUqEntities(uq: UqMan): Promise<void> {\r\n\tawait uq.loadAllSchemas();\r\n\t/*\r\n\tlet arr: Promise<any>[] = [];\r\n\tuq.actionArr.forEach(v => arr.push(v.loadSchema()));\r\n\tuq.enumArr.forEach(v => arr.push(v.loadSchema()));\r\n\tuq.sheetArr.forEach(v => arr.push(v.loadSchema()));\r\n\tuq.queryArr.forEach(v => arr.push(v.loadSchema()));\r\n\tuq.bookArr.forEach(v => arr.push(v.loadSchema()));\r\n\tuq.mapArr.forEach(v => arr.push(v.loadSchema()));\r\n\tuq.historyArr.forEach(v => arr.push(v.loadSchema()));\r\n\tuq.pendingArr.forEach(v => arr.push(v.loadSchema()));\r\n\tuq.tagArr.forEach(v => arr.push(v.loadSchema()));\r\n\tawait Promise.all(arr);\r\n\t*/\r\n}\r\n\r\nfunction buildUQ(uq: UqMan) {\r\n\tlet { uqOwner, uqName } = uq;\r\n\tlet ts: string = ``;\r\n\tuq.enumArr.forEach(v => ts += uqEntityInterface<UqEnum>(v, buildEnumInterface));\r\n\r\n\tts += `\\nexport declare namespace ${getUqOwnerName(uqOwner)}${getUqName(uqName)} {`;\r\n\tuq.tuidArr.forEach(v => ts += uqEntityInterface<Tuid>(v, buildTuidInterface));\r\n\tuq.actionArr.forEach(v => ts += uqEntityInterface<Action>(v, buildActionInterface));\r\n\tuq.sheetArr.forEach(v => ts += uqEntityInterface<Sheet>(v, buildSheetInterface));\r\n\tuq.queryArr.forEach(v => ts += uqEntityInterface<Query>(v, buildQueryInterface));\r\n\tuq.bookArr.forEach(v => ts += uqEntityInterface<Book>(v, buildBookInterface));\r\n\tuq.mapArr.forEach(v => ts += uqEntityInterface<Map>(v, buildMapInterface));\r\n\tuq.historyArr.forEach(v => ts += uqEntityInterface<History>(v, buildHistoryInterface));\r\n\tuq.pendingArr.forEach(v => ts += uqEntityInterface<Pending>(v, buildPendingInterface));\r\n\tuq.tagArr.forEach(v => ts += uqEntityInterface<Tag>(v, buildTagInterface));\r\n\r\n\tts += `\\n\\nexport interface Uq${getUqOwnerName(uqOwner)}${getUqName(uqName)} {`;\r\n\tuq.tuidArr.forEach(v => ts += uqBlock<Tuid>(v, buildTuid));\r\n\tuq.actionArr.forEach(v => ts += uqBlock<Action>(v, buildAction));\r\n\t//uq.enumArr.forEach(v => ts += uqBlock<UqEnum>(v, buildEnum));\r\n\tuq.sheetArr.forEach(v => ts += uqBlock<Sheet>(v, buildSheet));\r\n\tuq.queryArr.forEach(v => ts += uqBlock<Query>(v, buildQuery));\r\n\tuq.bookArr.forEach(v => ts += uqBlock<Book>(v, buildBook));\r\n\tuq.mapArr.forEach(v => ts += uqBlock<Map>(v, buildMap));\r\n\tuq.historyArr.forEach(v => ts += uqBlock<History>(v, buildHistory));\r\n\tuq.pendingArr.forEach(v => ts += uqBlock<Pending>(v, buildPending));\r\n\tuq.tagArr.forEach(v => ts += uqBlock<Tag>(v, buildTag));\r\n\tts += '\\n}\\n}\\n';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildFields(fields: Field[], indent: number = 1) {\r\n\tif (!fields) return;\r\n\tlet ts = '';\r\n\tfor (let f of fields) {\r\n\t\tts += buildField(f, indent);\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\nconst fieldTypeMap: { [type: string]: string } = {\r\n\t\"char\": \"string\",\r\n\t\"text\": \"string\",\r\n\t\"id\": \"number\",\r\n\t\"int\": \"number\",\r\n\t\"bigint\": \"number\",\r\n\t\"smallint\": \"number\",\r\n\t\"tinyint\": \"number\",\r\n};\r\nfunction buildField(field: Field, indent: number = 1) {\r\n\tlet { type } = field;\r\n\tlet s = fieldTypeMap[type];\r\n\tif (!s) s = 'any';\r\n\treturn `\\n${'\\t'.repeat(indent)}${field.name}: ${s};`;\r\n}\r\n\r\nfunction buildArrs(arrFields: ArrFields[]): string {\r\n\tif (!arrFields) return '';\r\n\tlet ts = '\\n';\r\n\tfor (let af of arrFields) {\r\n\t\tts += `\\t${camelCaseString(af.name)}: {`;\r\n\t\tts += buildFields(af.fields, 2);\r\n\t\tts += '\\n\\t}[];\\n';\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\nfunction buildReturns(entity: Entity, returns: ArrFields[]): string {\r\n\tif (!returns) return;\r\n\tlet { sName } = entity;\r\n\tsName = capitalCaseString(sName);\r\n\tlet ts = '';\r\n\tfor (let ret of returns) {\r\n\t\tlet retName = capitalCaseString(ret.name);\r\n\t\tts += `interface Return${sName}${retName} {`;\r\n\t\tts += buildFields(ret.fields);\r\n\t\tts += '\\n}\\n';\r\n\t}\r\n\r\n\tts += `interface Result${sName} {\\n`;\r\n\tfor (let ret of returns) {\r\n\t\tlet retName = capitalCaseString(ret.name);\r\n\t\tts += `\\t${ret.name}: Return${sName}${retName}[];\\n`;\r\n\t}\r\n\tts += '}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildTuid(tuid: Tuid) {\r\n\tlet ts = `\\t${entityName(tuid.sName)}: UqTuid<Tuid${capitalCaseString(tuid.sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildTuidInterface(tuid: Tuid) {\r\n\tlet ts = `export interface Tuid${capitalCaseString(tuid.sName)} {`;\r\n\tts += buildFields(tuid.fields);\r\n\tts += '\\n}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildAction(action: Action) {\r\n\tlet ts = `\\t${entityName(action.sName)}: UqAction<Param${capitalCaseString(action.sName)}, Result${capitalCaseString(action.sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildActionInterface(action: Action) {\r\n\tlet ts = `export interface Param${capitalCaseString(action.sName)} {`;\r\n\tts += buildFields(action.fields);\r\n\tts += buildArrs(action.arrFields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(action, action.returns);\r\n\treturn ts;\r\n}\r\n\r\nfunction buildEnumInterface(enm: UqEnum) {\r\n\tlet { schema } = enm;\r\n\tif (!schema) return;\r\n\tlet { values } = schema;\r\n\tlet ts = `export enum ${capitalCaseString(enm.sName)} {`;\r\n\tlet first: boolean = true;\r\n\tfor (let i in values) {\r\n\t\tif (first === false) {\r\n\t\t\tts += ',';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\t\tlet v = values[i];\r\n\t\tts += '\\n\\t' + i + ' = ';\r\n\t\tif (typeof v === 'string') {\r\n\t\t\tts += '\"' + v + '\"';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tts += v;\r\n\t\t}\r\n\t}\r\n\treturn ts += '\\n};'\r\n}\r\n\r\nfunction buildQuery(query: Query) {\r\n\tlet { sName } = query;\r\n\tlet ts = `\\t${entityName(sName)}: UqQuery<Param${capitalCaseString(sName)}, Result${capitalCaseString(sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildQueryInterface(query: Query) {\r\n\tlet ts = `export interface Param${capitalCaseString(query.sName)} {`;\r\n\tts += buildFields(query.fields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(query, query.returns);\r\n\treturn ts;\r\n}\r\n\r\nfunction buildSheet(sheet: Sheet) {\r\n\tlet { sName, verify } = sheet;\r\n\tlet cName = capitalCaseString(sName);\r\n\tlet v = verify ? `Verify${cName}` : 'any';\r\n\tlet ts = `\\t${entityName(sName)}: UqSheet<Sheet${cName}, ${v}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildSheetInterface(sheet: Sheet) {\r\n\tlet { sName, fields, arrFields, verify } = sheet;\r\n\tlet ts = `export interface Sheet${capitalCaseString(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += buildArrs(arrFields);\r\n\tts += '}';\r\n\r\n\tif (verify) {\r\n\t\tlet { returns } = verify;\r\n\t\tts += `\\nexport interface Verify${capitalCaseString(sName)} {`;\r\n\t\tfor (let item of returns) {\r\n\t\t\tlet { name: arrName, fields } = item;\r\n\t\t\tts += '\\n\\t' + arrName + ': {';\r\n\t\t\tts += buildFields(fields, 2);\r\n\t\t\tts += '\\n\\t}[];';\r\n\t\t}\r\n\t\tts += '\\n}';\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\nfunction buildBook(book: Book): string {\r\n\treturn;\r\n}\r\n\r\nfunction buildBookInterface(book: Book): string {\r\n\treturn;\r\n}\r\n\r\nfunction buildMap(map: Map): string {\r\n\treturn;\r\n}\r\n\r\nfunction buildMapInterface(map: Map): string {\r\n\treturn;\r\n}\r\n\r\nfunction buildHistory(history: History): string {\r\n\treturn;\r\n}\r\n\r\nfunction buildHistoryInterface(history: History): string {\r\n\treturn;\r\n}\r\n\r\nfunction buildPending(pending: Pending): string {\r\n\treturn;\r\n}\r\n\r\nfunction buildPendingInterface(pending: Pending): string {\r\n\treturn;\r\n}\r\n\r\nfunction buildTag(tag: Tag): string {\r\n\treturn;\r\n}\r\n\r\nfunction buildTagInterface(tag: Tag): string {\r\n\treturn;\r\n}\r\n","export interface Id {\r\n    id: number;\r\n}\r\n\r\nexport interface Api {\r\n    name: string;\r\n    url: string;\r\n    token: string;\r\n}\r\n\r\nexport interface App extends Id {\r\n    name: string;\r\n    discription: string;\r\n    icon: string;\r\n    owner: number;\r\n    ownerName: string;\r\n    ownerDiscription: string;\r\n    url: string;\r\n    apis?: {[name:string]: Api};\r\n}\r\n\r\nexport interface Unit extends Id {\r\n    type: number;\r\n    name: string;\r\n    nick: string;\r\n    discription: string;\r\n    icon: string;\r\n    readMe: string;\r\n    isRoot: number;\r\n    isOwner: number;\r\n    isAdmin: number;\r\n    isDev: number;\r\n    owner?: number;\r\n    ownerName?: string;\r\n    ownerNick?: string;\r\n    ownerIcon?: string;\r\n}\r\n\r\nconst unitCaptions = {\r\n    1: '开发号',\r\n    2: '小号',\r\n    3: '系统号'\r\n}\r\nexport function unitCaption(unit:Unit):String {\r\n    return unitCaptions[unit.type] as string\r\n}\r\n\r\nexport interface UnitApps extends Unit {\r\n    apps: App[];\r\n}\r\n\r\nexport interface UnitAdmin extends Id {\r\n    name: string;\r\n    nick: string;\r\n    icon: string;\r\n    type: number;\r\n    country: string;\r\n    mobile: string;\r\n    email: string;\r\n    isRoot: number;\r\n    isOwner: number;\r\n    isAdmin: number;\r\n    isDev: number;\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {FormView, FormProps} from './formView';\r\n\r\n/*\r\nexport function tonvaDebug() {\r\n    let a = 0;\r\n}\r\n*/\r\nexport interface TonvaFormProps extends FormProps {\r\n    className?: string;\r\n    initValues?: any;\r\n}\r\n\r\n@observer \r\nexport class TonvaForm extends React.Component<TonvaFormProps, {}> {\r\n    formView: FormView;\r\n    constructor(props:TonvaFormProps) {\r\n        super(props);\r\n        this.formView = new FormView(this.props);\r\n        this.formView.setInitValues(this.props.initValues);\r\n    }\r\n    debug() {\r\n        //let s = null;\r\n    }\r\n    render() {\r\n        let {className, children} = this.props;\r\n        return <div className={className}>\r\n            {\r\n                children === undefined? \r\n                    this.formView.render() : \r\n                    <form onSubmit={this.formView.onSubmit}>{children}</form>\r\n            }\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport className from 'classnames';\r\nimport {FormProps, FormRow, SubmitResult, TonvaForm} from '../form';\r\n\r\nexport interface Step {\r\n    formRows: FormRow[];\r\n    next: undefined | string | ((values:any) => string);    // 返回下一步的step名称或者直接就是名称\r\n    ex?: any;                                   // 每一步额外的参数\r\n}\r\n\r\nexport interface MultiStepProps {\r\n    className?: string;\r\n    header?: (step:Step, num:number) => JSX.Element; //name: step name, num: 第几步，1开始\r\n    footer?: (step:Step, num:number) => JSX.Element; //name: step name, num: 第几步，1开始\r\n    steps: {[name:string]: Step};\r\n    first: string;         // 第一步的名字\r\n    onSubmit: (values:any) => Promise<SubmitResult|undefined>;\r\n    submitButton?: string|JSX.Element;\r\n}\r\n\r\nexport interface StepView {\r\n    stepName: string;\r\n    step: Step;\r\n    props: FormProps;\r\n    //view: JSX.Element;\r\n}\r\nexport interface MultiStepState {\r\n    //num: number;\r\n    //step: Step;\r\n    //formView: FormView;\r\n    topView: StepView;\r\n    stepViews: StepView[];\r\n}\r\n\r\nexport class MultiStep extends React.Component<MultiStepProps, MultiStepState> {\r\n    private values: any = {};\r\n    private stepViews: StepView[] = [];\r\n    private topView: StepView;\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            topView: undefined,\r\n            stepViews: [],\r\n        }\r\n        //this.onPrev = this.onPrev.bind(this);\r\n        //this.onNext = this.onNext.bind(this);\r\n        this.setStep(this.props.first);\r\n    }\r\n    \r\n    private setStep(stepName: string) {\r\n        let step = this.props.steps[stepName];\r\n        if (step === undefined) return; //throw new Error('Unknown step name: ' + stepName);\r\n        if (this.topView !== undefined) this.stepViews.push(this.topView);\r\n        let otherButton, onOther;\r\n        if (this.stepViews.length > 0) {\r\n            otherButton = <ButtonConten prefix=\"undo\" text=\"上一步\" />;\r\n            onOther = this.onPrev;\r\n        }\r\n        //let {header, footer} = this.props;\r\n        let btnContent = step.next === undefined?\r\n            {prefix: 'cloud-upload', text: this.props.submitButton || '提交'} :\r\n            {suffix: 'arrow-right', text: '下一步'}\r\n        let formProps = {\r\n            formRows: step.formRows,\r\n            submitButton: <ButtonConten {...btnContent} />,\r\n            onSubmit: this.onNext,\r\n            otherButton: otherButton,\r\n            onOther: onOther,\r\n        };\r\n        //let num = this.stepViews.length + 1;\r\n        this.topView = {\r\n            stepName: stepName,\r\n            step: step,\r\n            props: formProps,\r\n        };\r\n        this.setState({\r\n            topView: this.topView,\r\n            stepViews: this.stepViews\r\n        });\r\n    }\r\n    private onPrev = (values:any) => {\r\n        _.assign(this.values, values);\r\n        this.topView = this.stepViews.pop();\r\n        this.setState({\r\n            topView: this.topView,\r\n            stepViews: this.stepViews\r\n        });\r\n    }\r\n    private onNext = (values:any): Promise<SubmitResult|undefined> => {\r\n        _.assign(this.values, values);\r\n        //let {num, step} = this.state;\r\n        let {next} = this.topView.step;\r\n        if (next === undefined) {\r\n            return this.props.onSubmit(this.values)\r\n        }\r\n        let nextStepName:string;\r\n        if (typeof next === 'string') {\r\n            nextStepName = next;\r\n        }\r\n        else {\r\n            nextStepName = next(this.values);\r\n        }\r\n        this.setStep(nextStepName);\r\n    }\r\n    render() {\r\n        let {className, header, footer} = this.props;\r\n        let {topView, stepViews} = this.state;\r\n        let {stepName, step} = topView;\r\n        //let hidden = {visibility: 'hidden'};\r\n        let num = stepViews.length + 1;\r\n        return <div className={className}>\r\n            <div>\r\n                {header && header(step, num)}\r\n                <TonvaForm key={stepName} initValues={this.values} {...topView.props} />\r\n                {footer && footer(step, num)}\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nconst ButtonConten = (props:{prefix?:string, text?:string|JSX.Element, suffix?:string}) => {\r\n    let {prefix, suffix} = props;\r\n    let pIcon:any, sIcon:any;\r\n    if (prefix !== undefined) pIcon = <i className={className('fa', 'fa-' + prefix)} />;\r\n    if (suffix !== undefined) sIcon = <i className={className('fa', 'fa-' + suffix)} />;\r\n    return <React.Fragment>{pIcon} {props.text} {sIcon}</React.Fragment>;\r\n}\r\n    \r\n","import _ from 'lodash';\r\nimport { Context } from '../context';\r\nimport { FormRes } from '../../../res/formRes';\r\n\r\nexport abstract class Rule {\r\n    abstract check(defy:string[], value:any):void;\r\n}\r\n\r\nexport type ContextRule = (context:Context)=>{[target:string]:string[]|string} | string[] | string;\r\nexport type FieldRule = (value:any) => string[] | string;\r\n\r\nexport class RuleCustom extends Rule {\r\n    private func: FieldRule;\r\n    constructor(func: FieldRule) {\r\n        super();\r\n        this.func = func;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        let ret = this.func(value);\r\n        if (ret === undefined) return;\r\n        switch (typeof ret) {\r\n            case 'undefined': return;\r\n            case 'string': defy.push(ret as string); return;\r\n            default: defy.push(...ret); return;\r\n        }        \r\n    }\r\n}\r\n\r\nexport abstract class RulePredefined extends Rule {\r\n    protected res: FormRes;\r\n    constructor(res: FormRes) {\r\n        super();\r\n        this.res = res;\r\n    }\r\n}\r\n\r\nexport class RuleRequired extends RulePredefined {\r\n    check(defy:string[], value:any) {\r\n        switch (typeof value) {\r\n            default:\r\n            case 'boolean': return;\r\n            case 'object':\r\n                if (value !== null) return;\r\n                break;\r\n            case 'string':\r\n                if ((value as string).trim().length > 0) return;\r\n                break;\r\n            case 'number':\r\n                if (isNaN(value as number) === false) return;\r\n                break;\r\n            case 'undefined':\r\n                break;\r\n        }\r\n        defy.push(this.res.required);\r\n    }\r\n}\r\n\r\nexport class RuleNum extends RulePredefined {\r\n    private minMsg: _.TemplateExecutor;\r\n    private maxMsg: _.TemplateExecutor;\r\n    protected min: number;\r\n    protected max: number\r\n    constructor(res: FormRes, min?: number, max?: number) {\r\n        super(res);\r\n        this.minMsg = _.template(res.min);\r\n        this.maxMsg = _.template(res.max);\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        if (value === undefined || value === null) return;\r\n        let n = Number(value);\r\n        if (isNaN(n) === true) {\r\n            defy.push(this.res.number);\r\n        }\r\n        else {\r\n            this.checkMore(defy, n);\r\n        }\r\n    }\r\n\r\n    protected checkMore(defy:string[], value: number) {\r\n        if (this.min !== undefined && Number(value) < this.min) {\r\n            defy.push(this.minMsg({min:this.min}));\r\n        }\r\n        if (this.max !== undefined && Number(value) > this.max) {\r\n            defy.push(this.maxMsg({max:this.max}));\r\n        }\r\n    }\r\n}\r\n\r\nexport class RuleInt extends RuleNum {\r\n    protected checkMore(defy:string[], n: number) {\r\n        super.checkMore(defy, n);\r\n        if (Number.isInteger(n) === false) {\r\n            defy.push(this.res.integer);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiItem, ChangingHandler, ChangedHandler } from '../../schema';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { ItemSchema } from '../../schema';\r\nimport { Rule, RuleRequired, RuleCustom, FieldRule } from '../rules';\r\nimport { computed, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Widget {\r\n    name: string;\r\n    protected context: Context;\r\n    protected fieldProps: FieldProps;\r\n    protected children: React.ReactNode;\r\n    protected _itemSchema: ItemSchema;\r\n    protected _ui: UiItem;\r\n    protected defaultValue: any;\r\n    protected value: any;\r\n    protected rules: Rule[];\r\n    @observable errors: string[] = [];\r\n    @observable protected contextErrors: string[] = [];\r\n    @computed protected get hasError(): boolean { return (this.errors.length + this.contextErrors.length) > 0 }\r\n    protected readOnly: boolean;\r\n    protected disabled: boolean;\r\n    @observable visible: boolean;\r\n\r\n    constructor(context: Context, itemSchema: ItemSchema, fieldProps: FieldProps, children: React.ReactNode) {\r\n        this.context = context;\r\n        let { name } = itemSchema;\r\n        this.name = name;\r\n        this._itemSchema = itemSchema;\r\n        this.fieldProps = fieldProps;\r\n        this.children = children;\r\n        this._ui = context.getUiItem(name);\r\n        if (this.ui === undefined) {\r\n            this.readOnly = false;\r\n            this.disabled = false;\r\n            this.visible = true;\r\n        }\r\n        else {\r\n            let { readOnly, disabled, visible } = this.ui;\r\n            this.readOnly = (readOnly === true);\r\n            this.disabled = (disabled === true);\r\n            this.visible = !(visible === false);\r\n        }\r\n        this.value = this.defaultValue = context.getValue(name); //defaultValue;\r\n        // this.init();\r\n    }\r\n\r\n    protected get itemSchema(): ItemSchema { return this._itemSchema };\r\n    protected get ui(): UiItem { return this._ui };\r\n\r\n    init() {\r\n        this.rules = [];\r\n        if (this.itemSchema.required === true) {\r\n            this.rules.push(new RuleRequired(this.context.form.res));\r\n        }\r\n        this.buildRules();\r\n        if (this.ui === undefined) return;\r\n        let { rules } = this.ui;\r\n        if (rules === undefined) return;\r\n        if (Array.isArray(rules) === false) {\r\n            this.rules.push(new RuleCustom(rules as FieldRule));\r\n            return;\r\n        }\r\n        for (let rule of rules as FieldRule[]) {\r\n            this.rules.push(new RuleCustom(rule));\r\n        }\r\n    }\r\n\r\n    protected buildRules() {\r\n    }\r\n\r\n    checkRules() {\r\n        let defy: string[] = [];\r\n        for (let r of this.rules) r.check(defy, this.value);\r\n        if (defy.length === 0) {\r\n            this.context.removeErrorWidget(this);\r\n        }\r\n        else {\r\n            this.context.addErrorWidget(this);\r\n            this.errors.push(...defy);\r\n        }\r\n    }\r\n\r\n    @computed get isOk() {\r\n        return this.errors.length === 0;\r\n    }\r\n\r\n    setError(err: string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.errors.push(err);\r\n        else this.errors.push(...err);\r\n    }\r\n\r\n    setContextError(err: string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.contextErrors.push(err);\r\n        else this.contextErrors.push(...err);\r\n    }\r\n\r\n    clearError() {\r\n        this.errors.splice(0);\r\n    }\r\n\r\n    clearContextError() {\r\n        this.contextErrors.splice(0);\r\n    }\r\n\r\n    protected parse(value: any): any { return value }\r\n\r\n    protected setElementValue(value: any) { }\r\n    protected setDataValue(value: any) {\r\n        if (this.isChanging === true) return;\r\n        this.context.initData[this.name] = this.value = this.parse(value);\r\n    }\r\n\r\n    setValue(value: any) {\r\n        if (this.isChanging === true) return;\r\n        //this.setDataValue(value);\r\n        //this.setElementValue(value);\r\n        this.changeValue(value, false);\r\n    }\r\n\r\n    getValue() {\r\n        return this.context.getValue(this.name);\r\n    }\r\n\r\n    getReadOnly(): boolean { return this.readOnly }\r\n    getDisabled(): boolean { return this.disabled }\r\n    getVisible(): boolean { return this.visible }\r\n    setReadOnly(value: boolean) { this.readOnly = value }\r\n    setDisabled(value: boolean) { this.disabled = value }\r\n    setVisible(value: boolean) { this.visible = value }\r\n\r\n    private isChanging: boolean;\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n\r\n    protected changeValue(newValue: any, fromElement: boolean) {\r\n        let prev = this.value;\r\n        let onChanging: ChangingHandler;\r\n        let onChanged: ChangedHandler;\r\n        if (this.ui !== undefined) {\r\n            onChanging = this.ui.onChanging;\r\n            onChanged = this.ui.onChanged;\r\n        }\r\n        let allowChange = true;\r\n        if (onChanging !== undefined) {\r\n            this.isChanging = true;\r\n            allowChange = onChanging(this.context, this.value, prev);\r\n            this.isChanging = false;\r\n        }\r\n        if (allowChange === true) {\r\n            this.setDataValue(newValue);\r\n            if (fromElement !== true) this.setElementValue(newValue);\r\n            if (onChanged !== undefined) {\r\n                this.isChanging = true;\r\n                onChanged(this.context, this.value, prev);\r\n                this.isChanging = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected get className(): string {\r\n        let fieldClass: string;\r\n        if (this.context.inNode === false) fieldClass = 'form-control';\r\n        return classNames(fieldClass, this.context.form.FieldClass, this.ui && this.ui.className);\r\n    }\r\n\r\n    protected abstract render(): JSX.Element;\r\n\r\n    protected renderBody(): JSX.Element {\r\n        let elDiscription;\r\n        if (this.hasError === false && this.ui) {\r\n            let { discription, discriptionClassName } = this.ui;\r\n            if (discriptionClassName === undefined) discriptionClassName = 'small text-muted';\r\n            elDiscription = <span className={discriptionClassName}>\r\n                {discription}\r\n            </span>;\r\n        }\r\n        return <>\r\n            {this.render()}\r\n            {elDiscription}\r\n        </>;\r\n    }\r\n\r\n    container = observer((): JSX.Element => {\r\n        if (this.visible === false) return null;\r\n        let { form, inNode } = this.context;\r\n        if (inNode === true) return this.render();\r\n        let label: any = this.label;\r\n        if (this.itemSchema.required === true && form.props.requiredFlag !== false) {\r\n            if (label !== null) label = <>{label}&nbsp;<span className=\"text-danger\">*</span></>;\r\n        }\r\n        return form.FieldContainer(label, this.renderBody());\r\n    })\r\n\r\n    protected get label(): string {\r\n        let label: any;\r\n        if (this.ui === undefined) {\r\n            label = this.name;\r\n        }\r\n        else {\r\n            let uiLabel = this.ui.label;\r\n            if (uiLabel === null) label = null;\r\n            else label = uiLabel || this.name;\r\n        }\r\n        return label;\r\n    }\r\n\r\n    protected renderTemplet(): JSX.Element | undefined {\r\n        if (this.children !== undefined) {\r\n            return <>{this.children}</>;\r\n        }\r\n        if (this.ui === undefined) return undefined;\r\n        let { Templet } = this.ui;\r\n        if (typeof Templet === 'function') return Templet(this.value);\r\n        return Templet;\r\n    }\r\n\r\n    protected renderErrors() {\r\n        let errorList: string[] = [...this.errors, ...this.contextErrors];\r\n        if (errorList.length === 0) return null;\r\n        let { inNode } = this.context;\r\n        let tag = inNode === true ? 'span' : 'div';\r\n        return errorList.map(err => React.createElement(tag,\r\n            {\r\n                key: err,\r\n                className: 'text-danger d-inline-block my-2 ms-3'\r\n            },\r\n            <><i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}</>\r\n        ));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTextItem, StringSchema } from '../../schema';\r\nimport { observable } from 'mobx';\r\n\r\nexport class TextWidget extends Widget {\r\n    protected inputType = 'text';\r\n    protected get ui(): UiTextItem {return this._ui as UiTextItem};\r\n    protected input: HTMLInputElement;\r\n    @observable protected hasFocus: boolean;\r\n\r\n    protected setElementValue(value:any) {\r\n        if (this.input === null) return;\r\n        this.input.value = value;\r\n    }\r\n    protected get placeholder() {return (this.ui && this.ui.placeholder) || this.name}\r\n    protected onKeyDown = async (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n        this.internalOnKeyDown(evt);\r\n        if (evt.keyCode !== 13) return;\r\n        let {onEnter} = this.context.form.props;\r\n        if (onEnter === undefined) return;\r\n\r\n        this.changeValue(evt.currentTarget.value, true);\r\n\r\n        //this.checkRules();\r\n        //this.context.checkContextRules();\r\n        this.input.blur();\r\n\r\n        let ret = await onEnter(this.name, this.context);\r\n        if (ret !== undefined) {\r\n            this.context.setError(this.name, ret);\r\n        }\r\n    }\r\n\r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n    }\r\n\r\n    protected onBlur = (evt: React.FocusEvent<any>) => {\r\n        this.onInputChange(evt);\r\n        this.checkRules();\r\n\t\tthis.context.checkContextRules();\r\n\t\tthis.hasFocus = false;\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n        this.clearError();\r\n        this.context.removeErrorWidget(this);\r\n        this.context.clearErrors();\r\n\t\tthis.hasFocus = true;\r\n    }\r\n    protected onChange(evt: React.ChangeEvent<any>) {\r\n    }\r\n\r\n    setReadOnly(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.readOnly = this.readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.disabled = this.disabled = value;\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {\r\n            //'form-control': true,\r\n        };\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, cn)}\r\n            type={this.inputType}\r\n            defaultValue={this.value}\r\n            onChange={(evt: React.ChangeEvent<any>) => this.onChange(evt)}\r\n            placeholder={this.placeholder}\r\n            readOnly={this.readOnly}\r\n            disabled={this.disabled}\r\n            onKeyDown = {this.onKeyDown}\r\n            onFocus = {this.onFocus}\r\n            onBlur={this.onBlur}\r\n            maxLength={(this.itemSchema as StringSchema).maxLength} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTextAreaItem } from '../../schema';\r\nimport { StringSchema } from '../../schema';\r\n\r\nexport class TextAreaWidget extends Widget {\r\n    protected get itemSchema(): StringSchema {return this._itemSchema as StringSchema};\r\n    protected input: HTMLTextAreaElement;\r\n    protected get ui(): UiTextAreaItem {return this._ui as UiTextAreaItem};\r\n\r\n    protected setElementValue(value:any) {this.input.value = value}\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.setValue(evt.currentTarget.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n\tprotected onBlur = (evt: React.FocusEvent<any>) => {\r\n        this.onInputChange(evt);\r\n        this.checkRules();\r\n        this.context.checkContextRules();\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n        this.clearError();\r\n        this.context.removeErrorWidget(this);\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {};\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <>\r\n\t\t\t<textarea ref={(input) => this.input=input}\r\n\t\t\t\tonBlur={this.onBlur} \r\n\t\t\t\tonFocus={this.onFocus}\r\n                className={classNames(this.className, cn)}\r\n                rows={this.ui && this.ui.rows}\r\n                maxLength={this.itemSchema.maxLength}\r\n                defaultValue={this.defaultValue} onChange={this.onInputChange} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class PasswordWidget extends TextWidget {\r\n    protected inputType = 'password';\r\n}\r\n\r\nexport class UrlWidget extends TextWidget {\r\n    protected inputType = 'url';\r\n}\r\n\r\nexport class EmailWidget extends TextWidget {\r\n    protected inputType = 'email';\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\nimport { RuleNum, RuleInt } from '../rules';\r\nimport { NumBaseSchema } from '../../schema';\r\n\r\nexport class NumberWidget extends TextWidget {\r\n    protected inputType = 'number';\r\n    protected get itemSchema(): NumBaseSchema {return this._itemSchema as NumBaseSchema};\r\n\r\n    protected buildRules() {\r\n        super.buildRules();\r\n        let res = this.context.form.res;\r\n        let {min, max} = this.itemSchema;\r\n        this.rules.push(\r\n            this.itemSchema.type === 'integer'?\r\n                new RuleNum(res, min, max) :\r\n                new RuleInt(res, min, max)\r\n        );\r\n        /*\r\n        if (this.itemSchema.type === 'integer') {\r\n            this.rules.push(new RuleInt);\r\n        }\r\n        let {min, max} = this.itemSchema;\r\n        if (min !== undefined) this.rules.push(new RuleMin(min));\r\n        if (max !== undefined) this.rules.push(new RuleMax(max));\r\n        */\r\n    }\r\n\r\n    protected parse(value:any):any {\r\n        if (value === undefined || value === null) return;\r\n        return Number(value);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { NumberWidget } from './numberWidget';\r\n\r\nexport class UpdownWidget extends NumberWidget {\r\n    protected inputType = 'number';\r\n\r\n    protected isValidKey(key:number):boolean {\r\n        return key===46 || key===8 || key===37 || key===39\r\n            || (key>=48 && key<=57)\r\n            || (key>=96 && key<=105)\r\n            || key===109 || key===189;\r\n    }\r\n    \r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n        let key = evt.keyCode;\r\n        window.event.returnValue = this.isValidKey(key);\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class DateWidget extends TextWidget {\r\n    protected inputType = 'date';\r\n}\r\n\r\nexport class DateTimeWidget extends TextWidget {\r\n    protected inputType = 'datetime';\r\n}\r\n\r\nexport class TimeWidget extends TextWidget {\r\n    protected inputType = 'time';\r\n}\r\n\r\nexport class MonthWidget extends TextWidget {\r\n    protected inputType = 'month';\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiCheckItem } from '../../schema';\r\n\r\nexport class CheckBoxWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiCheckItem {return this._ui as UiCheckItem};\r\n    protected trueValue: any;\r\n    protected falseValue: any;\r\n\r\n    init() {\r\n        super.init();\r\n        if (this.ui !== undefined) {\r\n            let {trueValue, falseValue} = this.ui;\r\n            if (trueValue === undefined) this.trueValue = true;\r\n            else this.trueValue = trueValue;\r\n            if (falseValue === undefined) this.falseValue = false;\r\n            else this.falseValue = falseValue;\r\n        }\r\n        else {\r\n            this.trueValue = true;\r\n            this.falseValue = false;\r\n        }\r\n    }\r\n    protected setElementValue(value:any) {\r\n        this.input.checked = value === this.trueValue;\r\n    }\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let v = evt.target.checked === true? this.trueValue : this.falseValue;\r\n        this.setDataValue(v);\r\n    }\r\n\r\n    protected onClick = () => {\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let cn = classNames(this.className, 'form-check-inline p-0');\r\n        let input = <input\r\n            ref={(input)=>this.input = input}\r\n            className={'align-self-center'}\r\n            type=\"checkbox\"\r\n            defaultChecked={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            onClick={this.onClick} />;\r\n        if (this.context.inNode === true) {\r\n            return <label className={cn}>\r\n                {input} {(this.ui&&this.ui.label) || this.name}\r\n            </label>\r\n        }\r\n        else {\r\n            return <div className={cn}>\r\n                <label className=\"w-100 h-100 mb-0 d-flex justify-content-center\">{input}</label>\r\n            </div>;\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observable } from 'mobx';\r\nimport { Widget } from './widget';\r\nimport { UiSelect } from '../../schema';\r\n\r\nexport class SelectWidget extends Widget {\r\n    protected select: HTMLSelectElement;\r\n    protected get ui(): UiSelect {return this._ui as UiSelect};\r\n    @observable protected readOnly: boolean;\r\n\r\n    protected setElementValue(value:any) {this.select.value = value}\r\n    protected onInputChange = (evt:React.ChangeEvent<HTMLSelectElement>) => {\r\n        this.setDataValue(evt.target.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.select.disabled = this.readOnly = !value}\r\n    setDisabled(value:boolean) {this.select.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        if (this.readOnly === true) {\r\n            let option = this.ui.list.find(v => v.value === this.value);\r\n            let title = (option === undefined)? '(???)' : option.title;\r\n            return <span className=\"form-control w-min-6c\">{title}</span>;\r\n        }\r\n        return <select\r\n            ref={(select)=>this.select = select}\r\n            className={classNames(this.className, 'form-control')}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}>\r\n            {this.ui.list.map((v,index) => {\r\n                let {title, value} = v;\r\n                let cn:string;\r\n                //if (value === undefined || value === null) cn = 'text-light small';\r\n                //else cn = 'text-danger';\r\n                return <option className={cn} key={index} value={value}>{title || value}</option>\r\n            })}\r\n        </select>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n//import { TextWidget } from './textWidget';\r\nimport { Widget } from './widget';\r\nimport { UiRadio } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class RadioWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiRadio {return this._ui as UiRadio};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n    }\r\n\r\n    /*\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n    */\r\n\r\n    render() {\r\n        let {defaultValue, list} = this.ui;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n        return <span className={cn} style={radioStyle}>\r\n                {list.map((v,index) => {\r\n                    let {value, title} = v;\r\n                    let name = this.name;\r\n                    if (rowKey !== undefined) name += '-' + rowKey;\r\n                    return <label key={index} className=\"form-radio-inline\">\r\n                        <input ref={input=>this.inputs[index]=input} type=\"radio\" name={name}\r\n                            value={value} defaultChecked={(this.defaultValue || defaultValue)===value}\r\n                            onChange={this.onInputChange} />\r\n                        {title || value}\r\n                    </label>;\r\n                    //</span>\r\n                })}\r\n            </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiRange } from '../../schema';\r\nimport { Widget } from './widget';\r\n\r\nexport class RangeWidget extends Widget {\r\n    protected inputType = 'range';\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiRange {return this._ui as UiRange};\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        let {min, max, step} = this.ui;\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, 'form-control', 'w-min-6c')}\r\n            type={this.inputType}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            max={max}\r\n            min={min}\r\n            step={step}\r\n            />\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiIdItem, TempletType } from '../../schema';\r\nimport { observable } from 'mobx';\r\n\r\nconst none = <small className=\"text-muted\">[无]</small>;\r\n\r\nexport class IdWidget extends Widget {\r\n    protected get ui(): UiIdItem {return this._ui as UiIdItem};\r\n    @observable protected value:number;\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {this.disabled = value}    \r\n\r\n    protected onClick = async () => {\r\n        let pickId = this.ui && this.ui.pickId;\r\n        if (pickId === undefined) {\r\n            alert('no pickId defined!');\r\n            return;\r\n        }\r\n        let id = await pickId(this.context, this.name, this.value);        \r\n        this.setDataValue(id);\r\n        this.clearError();\r\n        this.clearContextError();\r\n        this.checkRules();\r\n    }\r\n\r\n    render() {\r\n        let placeholder:string|JSX.Element, Templet: TempletType;\r\n        if (this.ui !== undefined) {\r\n            placeholder = this.ui.placeholder;\r\n            Templet = this.ui.Templet;\r\n        }\r\n        let cn:any = {\r\n            'form-control': true,\r\n            'required-item': this.itemSchema.required === true,\r\n            'cursor-pointer': true,\r\n            'is-invalid': this.hasError,\r\n        };\r\n        let content;\r\n        if (this.value === undefined || this.value === null) {\r\n            content = placeholder || none;\r\n            cn['text-muted'] = true;\r\n        }\r\n        else if (Templet === undefined) {\r\n            let c: any;\r\n            if (this.value === null) {\r\n                c = 'null';\r\n            }\r\n            else {\r\n                switch (typeof this.value) {\r\n                    case 'undefined': c = none; break;\r\n                    case 'object': c = (this.value as any).id; break;\r\n                    default: c = this.value; break;\r\n                }\r\n            }\r\n            content = <>{c}</>;\r\n        }\r\n        else if (typeof Templet === 'function') {\r\n            content = Templet(this.value);\r\n        }\r\n        else {\r\n            content = Templet;\r\n        }\r\n        return <>\r\n            <div className={classNames(cn)} onClick={this.onClick}>{content}</div>\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { DataType } from '../../schema';\r\nimport { UiType } from '../../schema';\r\n\r\nexport const Unknown = (dataType:DataType, uiType:UiType, dataTypes:DataType[]) => {\r\n    return <span className=\"text-danger\">!!data type {dataType} only support {(dataTypes || []).join(', ')}, can't use ui {uiType}!!</span>;\r\n};\r\n","import * as React from 'react';\r\nimport { UiButton, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { Widget } from './widget';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class ButtonWidget extends Widget {\r\n    protected get ui(): UiButton {return this._ui as UiButton};\r\n\r\n    protected onClick = async () => {\r\n        this.clearError();\r\n        this.clearContextError();\r\n        let {name, type} = this.itemSchema;\r\n        if (type === 'submit') {\r\n            await this.context.submit(name);\r\n        }\r\n        /*\r\n        let {onButtonClick} = this.context.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${name} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(name, this.context);\r\n        if (ret === undefined) return;\r\n        this.context.setError(name, ret);\r\n        */\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let {name, type} = this.itemSchema;\r\n        let Templet:TempletType, cn:string, caption:string;\r\n        if (this.ui !== undefined) {\r\n            let {widget:widgetType} = this.ui;\r\n            if (widgetType !== 'button') return Unknown(type, widgetType, ['button']);\r\n            Templet = this.ui.Templet;\r\n            cn = this.ui.className;\r\n            caption = this.ui.label;\r\n        }\r\n        let {form, hasError} = this.context;\r\n        let context = this.context;\r\n        let disabled = type==='submit' && hasError;\r\n        let content:any;\r\n        if (this.children !== undefined) content = this.children;\r\n        else if (typeof Templet === 'function') content = Templet();\r\n        else if (Templet !== undefined) content = Templet;\r\n        else content = caption; \r\n        let button = <button \r\n            className={cn} \r\n            type=\"button\"\r\n            disabled={disabled}\r\n            onClick={this.onClick}>\r\n            {content || name}\r\n        </button>;\r\n        if (context.inNode === true) return <>{button}{this.renderErrors()}</>;\r\n        return <div className={form.ButtonClass}>\r\n            <div>{this.renderErrors()}</div>\r\n            {button}\r\n        </div>;\r\n    });\r\n    \r\n    protected get label():string {return null}\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Form } from './form';\r\nimport { UiSchema, UiArr, UiItem } from '../schema';\r\nimport { ArrSchema, ItemSchema } from '../schema';\r\nimport { Widget } from './widgets/widget';\r\n//import { ArrRow } from './arrRow';\r\nimport { observable, computed } from 'mobx';\r\nimport { ContextRule } from './rules';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Context {\r\n    private subContexts: { [name: string]: { [rowKey: string]: Context } };\r\n    readonly form: Form;\r\n    readonly uiSchema: UiSchema;\r\n    readonly initData: any;\r\n    readonly inNode: boolean;           // true: 在</> 流中定义Field\r\n    readonly widgets: { [name: string]: Widget } = {};\r\n    readonly rules: ContextRule[];\r\n    readonly isRow: boolean;\r\n    @observable errors: string[] = [];\r\n    @observable errorWidgets: Widget[] = [];\r\n\r\n    constructor(form: Form, uiSchema: UiSchema, data: any, inNode: boolean, isRow: boolean) {\r\n        this.form = form;\r\n        this.uiSchema = uiSchema;\r\n        this.initData = data;\r\n        this.inNode = inNode;\r\n        this.isRow = isRow;\r\n        if (uiSchema !== undefined) {\r\n            let { rules } = uiSchema;\r\n            if (rules !== undefined) {\r\n                this.rules = [];\r\n                if (Array.isArray(rules) === false)\r\n                    this.rules.push(rules as ContextRule);\r\n                else\r\n                    this.rules.push(...rules as ContextRule[]);\r\n            }\r\n        }\r\n    }\r\n\r\n    getArrRowContexts(arrName: string) {\r\n        if (this.subContexts === undefined) this.subContexts = {};\r\n        let arrRowContexts = this.subContexts[arrName];\r\n        if (arrRowContexts === undefined) this.subContexts[arrName] = arrRowContexts = {};\r\n        return arrRowContexts;\r\n    }\r\n\r\n    abstract get data(): any;\r\n    abstract getItemSchema(itemName: string): ItemSchema;\r\n    abstract getUiItem(itemName: string): UiItem;\r\n    get arrName(): string { return undefined }\r\n    getValue(itemName: string): any { return this.initData[itemName] }\r\n    setValue(itemName: string, value: any) {\r\n        this.initData[itemName] = value;\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setValue(value);\r\n    }\r\n    getDisabled(itemName: string): boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) return widget.getDisabled();\r\n        return undefined;\r\n    }\r\n    setDisabled(itemName: string, value: boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setDisabled(value);\r\n    }\r\n    getReadOnly(itemName: string): boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getReadOnly();\r\n        return undefined;\r\n    }\r\n    setReadOnly(itemName: string, value: boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setReadOnly(value);\r\n    }\r\n    getVisible(itemName: string): boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getVisible();\r\n        return undefined;\r\n    }\r\n    setVisible(itemName: string, value: boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setVisible(value);\r\n    }\r\n\r\n    async submit(buttonName: string) {\r\n        this.checkRules()\r\n        if (this.hasError === true) {\r\n            let err = '';\r\n            for (let ew of this.errorWidgets) {\r\n                err += ew.name + ':\\n' + ew.errors.join('\\n');\r\n            }\r\n            console.error(err);\r\n            return;\r\n        }\r\n        let { onButtonClick } = this.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${buttonName} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this);\r\n        if (ret === undefined) return;\r\n        this.setError(buttonName, ret);\r\n\r\n    }\r\n\r\n    checkFieldRules() {\r\n        for (let i in this.widgets) {\r\n            this.widgets[i].checkRules();\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                arrRowContexts[j].checkFieldRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    checkContextRules() {\r\n        this.clearErrors();\r\n        if (this.rules === undefined) return;\r\n        for (let rule of this.rules) {\r\n            let ret = rule(this);\r\n            if (ret === undefined) continue;\r\n            if (Array.isArray(ret) === true) {\r\n                this.errors.push(...ret as string[]);\r\n            }\r\n            else if (typeof ret === 'string') {\r\n                this.errors.push(ret as string);\r\n            }\r\n            else {\r\n                for (let i in ret as object) this.setError(i, (ret as any)[i]);\r\n            }\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                let rowContext = arrRowContexts[j];\r\n                rowContext.clearErrors();\r\n                rowContext.checkContextRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    setError(itemName: string, error: string) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget === undefined) return;\r\n        widget.setContextError(error);\r\n        this.addErrorWidget(widget);\r\n    }\r\n\r\n    clearContextErrors() {\r\n        for (let i in this.widgets) {\r\n            let widget = this.widgets[i];\r\n            if (widget === undefined) continue;\r\n            widget.clearContextError();\r\n        }\r\n    }\r\n\r\n    clearWidgetsErrors() {\r\n        for (let i in this.widgets) {\r\n            let widget = this.widgets[i];\r\n            if (widget === undefined) continue;\r\n            widget.clearError();\r\n        }\r\n    }\r\n\r\n    checkRules() {\r\n        this.clearErrors();\r\n        this.clearWidgetsErrors();\r\n        this.checkFieldRules();\r\n        if (this.hasError === true) return;\r\n        this.checkContextRules();\r\n    }\r\n\r\n    addErrorWidget(widget: Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos < 0) this.errorWidgets.push(widget);\r\n    }\r\n    removeErrorWidget(widget: Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos >= 0) this.errorWidgets.splice(pos, 1);\r\n    }\r\n\r\n    protected checkHasError(): boolean {\r\n        let ret = (this.errorWidgets.length + this.errors.length) > 0;\r\n        if (ret === true) return true;\r\n        if (this.subContexts === undefined) return false;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                if (arrRowContexts[j].hasError === true) return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    @computed get hasError(): boolean {\r\n        return this.checkHasError();\r\n    };\r\n\r\n    clearErrors() {\r\n        this.errors.splice(0);\r\n        this.errorWidgets.splice(0);\r\n        this.clearContextErrors();\r\n    }\r\n\r\n    renderErrors = observer((): JSX.Element => {\r\n        let { errors } = this;\r\n        if (errors.length === 0) return null;\r\n        return <>\r\n            {errors.map(err => <span key={err} className=\"text-danger inline-block my-1 ms-3\">\r\n                <i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}\r\n            </span>)}\r\n        </>\r\n    });\r\n}\r\n\r\nlet rowKeySeed: number = 1;\r\nexport class RowContext extends Context {\r\n    readonly parentContext: Context;\r\n    readonly arrSchema: ArrSchema;\r\n    readonly rowKey: number;\r\n    readonly data: any;\r\n    //readonly uiSchema: UiArr;\r\n\r\n    constructor(parentContext: Context, arrSchema: ArrSchema, data: any, inNode: boolean) {\r\n        let uiArr: UiArr;\r\n        let { uiSchema } = parentContext;\r\n        if (uiSchema !== undefined) {\r\n            let { items } = uiSchema;\r\n            if (items !== undefined) uiArr = items[arrSchema.name] as UiArr;\r\n        }\r\n        super(parentContext.form, uiArr, data, inNode, true);\r\n        this.parentContext = parentContext;\r\n        this.arrSchema = arrSchema;\r\n        this.rowKey = rowKeySeed++;\r\n        this.data = data;\r\n    }\r\n    getItemSchema(itemName: string): ItemSchema { return this.arrSchema.itemSchemas[itemName] }\r\n    getUiItem(itemName: string): UiItem {\r\n        if (this.uiSchema === undefined) return undefined;\r\n        let { items } = this.uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName]\r\n    }\r\n    get arrName(): string { return this.arrSchema.name }\r\n    clearErrors() {\r\n        super.clearErrors();\r\n        this.parentContext.clearErrors();\r\n    }\r\n\r\n    get parentData(): any { return this.parentContext.data; }\r\n}\r\n\r\nexport class FormContext extends Context {\r\n    constructor(form: Form, inNode: boolean) {\r\n        super(form, form.uiSchema, form.data, inNode, false);\r\n    }\r\n    get data(): any { return this.form.data }\r\n    getItemSchema(itemName: string): ItemSchema { return this.form.itemSchemas[itemName] }\r\n    getUiItem(itemName: string): UiItem {\r\n        let { uiSchema } = this.form;\r\n        if (uiSchema === undefined) return undefined;\r\n        let { items } = uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName];\r\n    }\r\n}\r\n\r\nexport const ContextContainer = React.createContext<Context>({} as any);\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\n//import { ArrRow } from '../arrRow';\r\nimport { Context, RowContext, ContextContainer } from '../context';\r\nimport { ArrSchema } from '../../schema';\r\nimport { UiArr, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { factory } from './factory';\r\n\r\nexport const ArrComponent = observer((\r\n    {parentContext, arrSchema, children}:{parentContext: Context, arrSchema: ArrSchema, children: React.ReactNode}) => \r\n{\r\n    let {name, arr} = arrSchema;\r\n    let data = parentContext.initData[name] as any[];\r\n    let {form} = parentContext;\r\n    let arrRowContexts = parentContext.getArrRowContexts(name);\r\n\tlet ui = parentContext.getUiItem(name) as UiArr;\r\n\tlet {onDeleted, onRestored} = ui;\r\n    let arrLabel = name;\r\n    let Templet:TempletType;\r\n    let selectable:boolean, deletable:boolean, restorable:boolean;\r\n    let {ArrContainer, RowContainer, RowSeperator, uiSchema} = form;\r\n    if (uiSchema !== undefined) {\r\n        let {selectable:formSelectable, deletable:formDeletable, restorable:formRestorable} = uiSchema;\r\n        if (selectable !== true) selectable = formSelectable;\r\n        if (deletable !== true) deletable = formDeletable;\r\n        if (restorable !== true) restorable = formRestorable;\r\n    }\r\n    if (ui !== undefined) {\r\n        let {widget:widgetType, label, \r\n            selectable:arrSelectable, deletable:arrDeletable, restorable:arrRestorable,\r\n            ArrContainer:ac, RowContainer:rc, RowSeperator:rs\r\n        } = ui;\r\n        if (arrSelectable !== undefined) selectable = arrSelectable;\r\n        if (arrDeletable !== undefined) deletable = arrDeletable;\r\n        if (arrRestorable !== undefined) restorable = arrRestorable;\r\n        if (ac !== undefined) ArrContainer = ac;\r\n        if (rc !== undefined) RowContainer = rc;\r\n        if (rs !== undefined) RowSeperator = rs;\r\n        Templet = ui.Templet;\r\n        if (widgetType !== 'arr') return Unknown(arrSchema.type, widgetType, ['arr']);\r\n        arrLabel = label || arrLabel;\r\n    }\r\n    let first = true;\r\n    return ArrContainer(arrLabel, <>\r\n        {data.map((row:any, index) => {\r\n            let rowContext: RowContext;\r\n            let rowContent: JSX.Element;\r\n            let sep = undefined;\r\n            if (first === false) sep = RowSeperator;\r\n            else first = false;\r\n            if (children !== undefined) {\r\n                rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                rowContent = <>{children}</>;\r\n            }\r\n            else {\r\n                let typeofTemplet = typeof Templet;\r\n                if (typeofTemplet === 'function') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = React.createElement(observer(Templet as React.StatelessComponent), row);\r\n                }\r\n                else if (typeofTemplet === 'object') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = Templet as JSX.Element;\r\n                }\r\n                else {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, false);\r\n                    rowContent = <>{\r\n                        arr.map((v, index) => {\r\n                            return <React.Fragment key={v.name}>\r\n                                {factory(rowContext, v, undefined)}\r\n                            </React.Fragment>\r\n                        })}\r\n                    </>;\r\n                }\r\n            }\r\n            let {rowKey} = rowContext;\r\n            arrRowContexts[rowKey] = rowContext;\r\n\r\n            let selectCheck:JSX.Element, deleteIcon:JSX.Element;\r\n            if (selectable === true) {\r\n                let onClick = (evt: React.MouseEvent<HTMLInputElement>)=>{\r\n                    let {checked} = (evt.target as HTMLInputElement);\r\n                    row.$isSelected = checked;\r\n                    let {$source} = row;\r\n                    if ($source !== undefined) $source.$isSelected = checked;\r\n                    rowContext.clearErrors();\r\n                }\r\n                selectCheck = <div className=\"form-row-checkbox\">\r\n                    <input type=\"checkbox\" onClick={onClick} defaultChecked={row.$isSelected} />\r\n                </div>;\r\n            }\r\n            let isDeleted = !(row.$isDeleted===undefined || row.$isDeleted===false);\r\n            if (deletable === true) {\r\n                let icon = isDeleted? 'fa-undo' : 'fa-trash';\r\n                let onDelClick = () => {\r\n                    if (restorable === true) {\r\n                        row.$isDeleted = !isDeleted;\r\n                        let {$source} = row;\r\n\t\t\t\t\t\tif ($source !== undefined) $source.$isDeleted = !isDeleted;\r\n\t\t\t\t\t\tif (onRestored) onRestored(row);\r\n                    }\r\n                    else {\r\n                        let p = data.indexOf(row);\r\n\t\t\t\t\t\tif (p>=0) data.splice(p, 1);\r\n\t\t\t\t\t\tif (onDeleted) onDeleted(row);\r\n                    }\r\n                    rowContext.clearErrors();\r\n                }\r\n                deleteIcon = <div className=\"form-row-edit text-info\" onClick={onDelClick}>\r\n                    <i className={classNames('fa', icon, 'fa-fw')} />\r\n                </div>;\r\n            }\r\n            let editContainer = selectable===true || deletable===true?\r\n                (content:any) => <fieldset disabled={isDeleted}><div className={classNames('d-flex', {'deleted':isDeleted, 'row-selected':row.$isSelected})}>\r\n                    {selectCheck}\r\n                    <div className={selectable===true && deletable===true? \"form-row-content\":\"form-row-content-1\"}>{content}</div>\r\n                    {deleteIcon}\r\n                </div></fieldset>\r\n                :\r\n                (content:any) => content;\r\n\r\n            return <ContextContainer.Provider key={rowKey} value={rowContext}>\r\n                {sep}\r\n                {RowContainer(editContainer(<><rowContext.renderErrors />{rowContent}</>))}\r\n            </ContextContainer.Provider>;\r\n        })}\r\n    </>);\r\n});\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiImageItem } from '../../schema';\r\nimport { Image } from '../../image';\r\nimport { ImageItemEdit } from '../../edit/imageItemEdit';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\n\r\nexport class ImageWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiImageItem {return this._ui as UiImageItem};\r\n    @observable private imageSrc: string;\r\n\r\n    init() {\r\n        super.init();\r\n        this.imageSrc = this.value;\r\n    }\r\n\r\n    protected onClick = async () => {\r\n        let edit = new ImageItemEdit(undefined, this.itemSchema, this.ui, this.ui.label, this.value);\r\n        let ret = await edit.start();\r\n        if (ret !== null) {\r\n            this.setValue(ret);\r\n            this.imageSrc = ret;\r\n        }\r\n        await edit.end();\r\n    }\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let cn = [\r\n            'bg-white p-1 d-flex justify-content-center',\r\n        ];\r\n        let onClick: any;\r\n        if (!this.readOnly && !this.disabled) {\r\n            cn.push('cursor-pointer');\r\n            onClick = this.onClick;\r\n        }\r\n        return <div className={classNames(cn)} onClick={onClick}>\r\n            <Image src={this.imageSrc} className=\"w-4c h-4c\"/>\r\n        </div>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTag, IValuesViewRenderOptions } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\nabstract class TagWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiTag {return this._ui as UiTag};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n\t}\r\n\t\r\n\tabstract render():JSX.Element;\r\n}\r\n\r\nexport class TagSingleWidget extends TagWidget {\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet name = this.name;\r\n\t\tif (rowKey !== undefined) name += '-' + rowKey;\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputName: name,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderRadios(this.defaultValue, options);\r\n    }\r\n}\r\n\r\nexport class TagMultiWidget extends TagWidget {\r\n\tprivate defaultArr:number[];\r\n\tinit() {\r\n\t\tsuper.init();\r\n\t\tlet def = this.defaultValue;\r\n\t\tswitch (typeof def) {\r\n\t\t\tdefault:\r\n\t\t\t\tthis.defaultArr = [];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'string':\r\n\t\t\t\tthis.defaultArr = def.split('|').map(v => Number(v));\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.changeValue(values.join('|'), true);\r\n\t}\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputs: this.inputs,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderChecks(this.defaultValue, options);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { ArrSchema, DataType, ItemSchema } from '../../schema';\r\nimport { TypeWidget, UiCustom } from '../../schema';\r\nimport { TextWidget } from './textWidget';\r\nimport { TextAreaWidget } from './textareaWidget';\r\nimport { PasswordWidget, UrlWidget, EmailWidget } from './passwordWidget';\r\nimport { UpdownWidget } from './updownWidget';\r\nimport { NumberWidget } from './numberWidget';\r\nimport { DateWidget, DateTimeWidget, TimeWidget, MonthWidget } from './dateWidget';\r\nimport { CheckBoxWidget } from './checkBoxWidget';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { SelectWidget } from './selectWidget';\r\nimport { RadioWidget } from './radioWidget';\r\nimport { RangeWidget } from './rangeWidget';\r\nimport { IdWidget } from './idWidget';\r\nimport { ButtonWidget } from './buttonWidget';\r\nimport { ArrComponent } from './arrComponent';\r\nimport { ImageWidget } from './imageWidget';\r\nimport { TagSingleWidget, TagMultiWidget } from './tagWidget';\r\n\r\nconst widgetsFactory: {[type: string]: {widget?: TypeWidget, dataTypes?: DataType[]}} = {\r\n    id: {\r\n        dataTypes: ['id'],\r\n        widget: IdWidget,\r\n    },\r\n    text: {\r\n        dataTypes: ['integer', 'number', 'string'],\r\n        widget: TextWidget\r\n    },\r\n    textarea: {\r\n        dataTypes: ['string'],\r\n        widget: TextAreaWidget\r\n    },\r\n    password: {\r\n        dataTypes: ['string'],\r\n        widget: PasswordWidget\r\n    },\r\n    date: {\r\n        dataTypes: ['date'],\r\n        widget: DateWidget\r\n    },\r\n    datetime: {\r\n        dataTypes: ['date'],\r\n        widget: DateTimeWidget\r\n    },\r\n    time: {\r\n        dataTypes: ['date'],\r\n        widget: TimeWidget\r\n    },\r\n    month: {\r\n        dataTypes: ['date'],\r\n        widget: MonthWidget\r\n    },\r\n    select: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: SelectWidget\r\n    },\r\n    url: {\r\n        dataTypes: ['string'],\r\n        widget: UrlWidget\r\n    },\r\n    email: {\r\n        dataTypes: ['string'],\r\n        widget: EmailWidget\r\n    },\r\n    number: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: NumberWidget\r\n    },\r\n    updown: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: UpdownWidget\r\n    },\r\n    color: {\r\n\r\n    },\r\n    checkbox: {\r\n        dataTypes: ['boolean', 'integer', 'number'],\r\n        widget: CheckBoxWidget\r\n    },\r\n    image: {\r\n        dataTypes: ['string'],\r\n        widget: ImageWidget,\r\n    },\r\n    checkboxes: {\r\n\r\n    },\r\n    radio: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: RadioWidget\r\n\t},\r\n\ttagSingle: {\r\n\t\tdataTypes: ['integer'],\r\n\t\twidget: TagSingleWidget\r\n\t},\r\n\ttagMulti: {\r\n\t\tdataTypes: ['string'],\r\n\t\twidget: TagMultiWidget\r\n\t},\r\n    range: {\r\n        dataTypes: ['integer'],\r\n        widget: RangeWidget,\r\n    },\r\n    button: {\r\n        dataTypes: ['button', 'submit'],\r\n        widget: ButtonWidget,\r\n    }\r\n}\r\n\r\nexport function factory(context: Context, itemSchema: ItemSchema, children:React.ReactNode, fieldProps?: FieldProps):JSX.Element {\r\n    if (context === undefined) {\r\n        debugger;\r\n        return null;\r\n    }\r\n    if (itemSchema === undefined) return undefined;\r\n    let {name, type} = itemSchema;\r\n    switch (type) {\r\n    case 'arr':\r\n        let arrSchema = context.getItemSchema(name) as ArrSchema;\r\n        return <ArrComponent parentContext={context} arrSchema={arrSchema} children={children} />;\r\n    default:\r\n        break;\r\n    }\r\n\r\n    let typeWidget: TypeWidget;\r\n    let ui = context.getUiItem(name);\r\n    function getTypeWidget(t:DataType): TypeWidget {\r\n        switch(t) {\r\n        default: return TextWidget; \r\n        case 'id': return IdWidget;\r\n        case 'integer': return UpdownWidget;\r\n        case 'number': return NumberWidget; \r\n        case 'string': return TextWidget; \r\n        case 'date': return DateWidget; \r\n        case 'boolean': return CheckBoxWidget; \r\n        case 'button':\r\n        case 'submit': return ButtonWidget;\r\n        }\r\n    }\r\n    if (ui === undefined) { \r\n        typeWidget = getTypeWidget(type);\r\n    }\r\n    else {\r\n        let {widget:widgetType} = ui;\r\n        switch (widgetType) {\r\n        default:\r\n            if (widgetType !== undefined) {\r\n                let widgetFactory = widgetsFactory[widgetType];\r\n                typeWidget = widgetFactory.widget;\r\n            }\r\n            if (typeWidget === undefined) typeWidget = getTypeWidget(type);\r\n            break;\r\n        case 'custom':\r\n            typeWidget = (ui as UiCustom).WidgetClass;\r\n            break;\r\n        case 'group':\r\n            return <span>impletment group</span>;\r\n        }\r\n        //label = uiLabel || name;\r\n    }\r\n    \r\n\tlet {widgets} = context;\r\n\tlet widget = widgets[name];\r\n\tif (!widget) {\r\n\t\twidget = new typeWidget(context, itemSchema, fieldProps, children);\r\n\t\twidget.init();\r\n\t\twidgets[name] = widget;\r\n\t}\r\n\r\n    return <widget.container />;\r\n    /*\r\n    if (isRow === false) {\r\n        let WidgetElement = observer(() => widget.container());\r\n        return <WidgetElement />;\r\n    }\r\n    else {\r\n        let widgetElement = widget.container();\r\n        return widgetElement;\r\n    }\r\n    */\r\n}\r\n\r\n","import * as React from 'react';\r\nimport {observable, IReactionDisposer, autorun} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { Schema, ItemSchema, ArrSchema } from '../schema';\r\nimport { UiSchema, TempletType } from '../schema';\r\nimport { factory } from './widgets';\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport { ContextContainer, FormContext, Context } from './context';\r\nimport { FormRes, formRes } from '../../res';\r\nimport { resLang } from '../../res/res';\r\n\r\nexport type FormButtonClick = (name:string, context: Context) => Promise<any>;\r\nexport type InputEnter = (name:string, context: Context) => Promise<any>;\r\n\r\nexport interface FormProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    uiSchema?: UiSchema;\r\n    formData?: any;\r\n    onButtonClick?: FormButtonClick;\r\n    onEnter?: InputEnter;\r\n    fieldLabelSize?: number;            // col-sm-2 for label\r\n    requiredFlag?: boolean;             // default=true\r\n    beforeShow?: (formContext:FormContext) => void;\r\n    res?: FormRes;\r\n\r\n    Container?: (content:JSX.Element) => JSX.Element;\r\n    FieldContainer?: (label:string|JSX.Element, content:JSX.Element) => JSX.Element;\r\n    FieldClass?: string;\r\n    ButtonClass?: string;\r\n}\r\n\r\nexport class Form extends React.Component<FormProps> {\r\n    readonly schema: Schema;\r\n    readonly itemSchemas: {[name:string]: ItemSchema};\r\n    readonly uiSchema: UiSchema;\r\n    readonly res?: FormRes;\r\n    protected formContext: FormContext;\r\n    private disposer: IReactionDisposer;\r\n    readonly data:any;\r\n\r\n    readonly Container: (content:JSX.Element) => JSX.Element;\r\n    readonly FieldContainer: (label:any, content:JSX.Element) => JSX.Element;\r\n    readonly FieldClass: string;\r\n    readonly ButtonClass: string;\r\n    \r\n    constructor(props:FormProps) {\r\n        super(props);\r\n        let {schema, uiSchema, \r\n            Container, FieldContainer, FieldClass, \r\n            ButtonClass, res,\r\n        } = props;\r\n        this.Container = Container || this.DefaultContainer;\r\n        this.FieldContainer = FieldContainer || this.DefaultFieldContainer;\r\n        this.FieldClass = FieldClass!==undefined && FieldClass!==''&&FieldClass!==null? FieldClass : this.DefaultFieldClass;\r\n        this.res = res || this.DefaultRes;\r\n        this.ButtonClass = ButtonClass || this.DefaultButtonClass;\r\n\r\n        this.schema = schema;\r\n        this.itemSchemas = {};\r\n        for (let itemSchema of this.schema) {\r\n            this.itemSchemas[itemSchema.name] = itemSchema;\r\n        }\r\n        this.uiSchema = uiSchema;\r\n\r\n        this.disposer = autorun(this.watch);\r\n        this.data = {};\r\n    }\r\n\r\n    private renderContent():any {\r\n        this.initData(this.props.formData);\r\n        let {children} = this.props;\r\n        if (children !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return <>{children}</>;\r\n        }\r\n\r\n        let Templet: TempletType;\r\n        if (this.uiSchema !== undefined) {\r\n            Templet = this.uiSchema.Templet;\r\n        }\r\n        if (Templet !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return typeof(Templet) === 'function'? Templet(this.data) : Templet;\r\n        }\r\n\r\n\t\tif (!this.formContext) {\r\n\t\t\tthis.formContext = new FormContext(this, false);\r\n\t\t}\r\n        return <>{this.schema.map((v, index) => {\r\n            return <React.Fragment key={index}>{factory(this.formContext, v, children)}</React.Fragment>\r\n        })}</>;\r\n    }\r\n\r\n    private initData(formData: any) {\r\n        if (formData === undefined) formData = {};\r\n        if (this.uiSchema !== undefined) {\r\n            let {items} = this.uiSchema;\r\n            if (items !== undefined) {\r\n                for (let i in items) {\r\n                    let ui = items[i];\r\n                    let dv = ui.defaultValue;\r\n                    if (dv !== undefined) {\r\n                        if (formData[i] === undefined) {\r\n                            formData[i] = dv;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (let itemSchema of this.schema) {\r\n            this.initDataItem(itemSchema, this.data, formData);\r\n        }\r\n    }\r\n\r\n    private initDataItem(itemSchema: ItemSchema, data:any, formData: any):any {\r\n        let {name, type} = itemSchema;\r\n        if (type === 'button') return;\r\n        if (type !== 'arr') {\r\n            data[name] = formData[name];\r\n            return;\r\n        }\r\n\r\n        let arrItem:ArrSchema = itemSchema as ArrSchema;\r\n        let {arr:arrItems} = arrItem;\r\n        if (arrItems === undefined) return;\r\n        let arrDict:any = arrItem.itemSchemas = {};\r\n        for (let item of arrItems) {\r\n            arrDict[item.name] = item;\r\n        }\r\n        let val:any[] = formData[name];\r\n        if (val === undefined) val = [];\r\n        else if (Array.isArray(val) === false) val = [val];\r\n        let arr:any[] = [];\r\n        for (let row of val) {\r\n            let {$isSelected, $isDeleted} = row;\r\n            let r = {\r\n                $source: row,\r\n                $isSelected: $isSelected,\r\n                $isDeleted: $isDeleted,\r\n            };\r\n            for (let item of arrItems) {\r\n                this.initDataItem(item, r, row);\r\n            }\r\n            arr.push(r);\r\n        }\r\n        // 如果没有observable，行删除标志点击不管用\r\n        // 不知道这里为什么要去掉observable。有可能会有别的问题\r\n        data[name] = observable(arr);\r\n        //data[name] = arr;\r\n        return;\r\n    }\r\n\r\n    private watch = () => {\r\n        let {formData} = this.props;\r\n        if (formData === undefined) return;\r\n        //this.initData(formData);\r\n        this.calcSelectOrDelete();\r\n    }\r\n    private calcSelectOrDelete() {\r\n        for (let itemSchema of this.schema) {\r\n            this.arrItemOperated(itemSchema);\r\n        }\r\n    }\r\n\r\n    private arrItemOperated(itemSchema: ItemSchema) {\r\n        let {name, type} = itemSchema;\r\n        if (type !== 'arr') return;\r\n        if (this.data === undefined) return;\r\n        let formArrVal = this.data[name];\r\n        if (formArrVal === undefined) return;\r\n        let {arr: arrItems} = itemSchema as ArrSchema;\r\n        for (let row of formArrVal) {\r\n            let {$source} = row;\r\n            if ($source === undefined) continue;\r\n            let {$isSelected, $isDeleted} = $source;\r\n            row.$isSelected = $isSelected;\r\n            row.$isDeleted = $isDeleted;\r\n            //console.log($isSelected, $isDeleted);\r\n            for (let item of arrItems) {\r\n                this.arrItemOperated(item);\r\n            }\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        let {beforeShow} = this.props;\r\n        if (beforeShow !== undefined) beforeShow(this.formContext);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        if (this.disposer !== undefined) this.disposer();\r\n    }\r\n\r\n    render() {\r\n        let content = this.renderContent();\r\n        return <ContextContainer.Provider value={this.formContext}>\r\n            {React.createElement(this.formContext.renderErrors)}\r\n            {this.Container(content)}\r\n        </ContextContainer.Provider>;\r\n    }\r\n\r\n    async buttonClick(buttonName:string) {\r\n        this.formContext.checkRules()\r\n        if (this.formContext.hasError === true) return;\r\n\r\n        let {onButtonClick} = this.formContext.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this.formContext);\r\n        if (ret === undefined) return;\r\n        this.formContext.setError(buttonName, ret);\r\n    }\r\n\r\n    protected DefaultContainer = (content:JSX.Element): JSX.Element => {\r\n        return <form className={classNames(this.props.className)} onSubmit={e=>e.preventDefault()}>\r\n            {content}\r\n        </form>;\r\n    }\r\n    protected DefaultFieldContainer = (label:string|JSX.Element, content:JSX.Element): JSX.Element => {\r\n        let {fieldLabelSize} = this.props;\r\n\r\n        if (fieldLabelSize > 0) {\r\n            let labelView:any;\r\n            if (label === null) {\r\n                fieldLabelSize = 0;\r\n            }\r\n            else {\r\n                labelView = <label className={classNames('col-sm-' + fieldLabelSize, 'col-form-label')}>{label}</label>\r\n            }\r\n            let fieldCol = 'col-sm-' + (12 - fieldLabelSize);\r\n            return <div className=\"form-group row\">\r\n                {labelView}\r\n                <div className={fieldCol}>{content}</div>\r\n            </div>;\r\n        }\r\n        return <div className=\"form-group\">\r\n            {label===null? null:<label className=\"col-form-label\">{label}</label>}\r\n            {content}\r\n        </div>;\r\n    }\r\n    protected DefaultFieldClass:string = undefined;\r\n    protected DefaultButtonClass = 'text-center py-2';\r\n    protected DefaultRes:FormRes = resLang<FormRes>(formRes);\r\n\r\n    ArrContainer = (label:any, content:JSX.Element): JSX.Element => {\r\n        return <div>\r\n            <div className={classNames('small text-muted text-center bg-light py-1 px-3 mt-4 mb-1')}>{label}</div>\r\n            {content}\r\n        </div>;\r\n    }\r\n    RowContainer = (content:JSX.Element): JSX.Element => {\r\n        let cn = classNames({\r\n            'py-3': true\r\n        });\r\n        return <div className={cn}>{content}</div>\r\n    }\r\n    RowSeperator = <div className=\"border border-gray border-top\" />;\r\n}\r\n","import * as React from 'react';\r\nimport { factory } from './widgets';\r\nimport { ContextContainer, Context } from './context';\r\n\r\nexport interface FieldProps {\r\n    name: string;\r\n}\r\n\r\nexport class FormField extends React.Component<FieldProps> {\r\n    static contextType = ContextContainer;\r\n    render() {\r\n        let {name, children } = this.props;\r\n        let context:Context = this.context;\r\n        if (context === undefined) return <span className=\"text-danger\">!only in Form!</span>;\r\n        let itemSchema = context.getItemSchema(name);\r\n        let content = factory(context, itemSchema, children, this.props);\r\n        if (content === undefined) {\r\n            return <span className=\"text-danger\">!!{name} is not defined!!</span>;\r\n        }\r\n        return content;\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { nav } from '../components';\r\nimport { VPage } from '../vm';\r\nimport { CLogin } from './CLogin';\r\n\r\nexport class VLogout extends VPage<CLogin> {\r\n\tprivate onLogout: ()=>void;\r\n\r\n\tinit(param: any) {\r\n\t\tthis.onLogout = param;\r\n\t}\r\n\theader() {return this.isWebNav === true? false : '安全退出';}\r\n\tfooter() {\r\n\t\treturn <div className=\"mt-5 text-center justify-content-center\">\r\n\t\t\t<button className=\"btn btn-outline-warning\" onClick={nav.resetAll}>升级软件</button>\r\n\t\t</div>;\r\n\t}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\r\n\tcontent() {\r\n\t\treturn <div className=\"m-5 border border-info bg-white rounded-3 p-5 text-center\">\r\n\t\t\t<div>退出当前账号不会删除任何历史数据，下次登录依然可以使用本账号</div>\r\n\t\t\t<div className=\"mt-5 text-center\">\r\n\t\t\t\t<button className=\"btn btn-danger\" onClick={this.onLogout}>安全退出</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","export default __webpack_public_path__ + \"static/media/logo.2d27ead7.svg\";","import * as React from 'react';\r\nimport { nav } from '../components';\r\nimport { mobileRegex, emailRegex } from '../tool';\r\nimport logo from '../img/logo.svg';\r\n\r\nexport function tonvaTop() {\r\n    return nav.loginTop(<div className=\"d-flex align-items-center position-relative\">\r\n        <img className=\"App-logo h-3c position-absolute\" src={logo} alt=\"img\" />\r\n        <div className=\"h3 flex-fill text-center\"><span className=\"text-primary me-3\">同</span>\r\n            <span className=\"text-danger\">花</span>\r\n        </div>\r\n    </div>);\r\n}\r\n\r\ninterface Sender {\r\n    type: string;\r\n    caption: string;\r\n    regex: RegExp;\r\n}\r\n\r\nconst senders: Sender[] = [\r\n    { type: 'mobile', caption: '手机号', regex: mobileRegex },\r\n    { type: 'email', caption: '邮箱', regex: emailRegex }\r\n];\r\n\r\nexport function getSender(un: string): Sender {\r\n    let sender = senders.find(v => v.regex.test(un) === true);\r\n    return sender;\r\n}","import { nav, Form, Schema, UiSchema, UiTextItem, UiPasswordItem, Context, UiButton, StringSchema, Ax } from '../components';\r\nimport { tonvaTop, getSender } from './tools';\r\nimport { CLogin } from './CLogin';\r\nimport { VPage } from '../vm';\r\n\r\nconst schema: Schema = [\r\n    { name: 'username', type: 'string', required: true, maxLength: 100 } as StringSchema,\r\n    { name: 'password', type: 'string', required: true, maxLength: 100 } as StringSchema,\r\n    { name: 'login', type: 'submit' },\r\n];\r\n\r\nexport class VLogin extends VPage<CLogin> {\r\n    private onLogin: (un: string, pwd: string) => Promise<boolean>;\r\n    private withBack: boolean;\r\n\r\n    init({ onLogin, withBack }: { onLogin: (un: string, pwd: string) => Promise<boolean>; withBack: boolean; }) {\r\n        this.onLogin = onLogin;\r\n        this.withBack = withBack;\r\n    }\r\n\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            username: { placeholder: '手机/邮箱/用户名', label: '登录账号' } as UiTextItem,\r\n            password: { widget: 'password', placeholder: '密码', label: '密码' } as UiPasswordItem,\r\n            login: { widget: 'button', className: 'btn btn-primary btn-block mt-3', label: '登录' } as UiButton,\r\n        }\r\n    }\r\n\r\n    private onSubmit = async (name: string, context: Context): Promise<string> => {\r\n        let values = context.form.data;\r\n        let un = values['username'];\r\n        let pwd = values['password'];\r\n        if (pwd === undefined) {\r\n            return 'something wrong, pwd is undefined';\r\n        }\r\n        let ret = await this.onLogin(un, pwd);\r\n        if (ret === true) return;\r\n\r\n        let sender = getSender(un);\r\n        let type: string = sender !== undefined ? sender.caption : '用户名';\r\n        return type + '或密码错！';\r\n    }\r\n    private onEnter = async (name: string, context: Context): Promise<string> => {\r\n        if (name === 'password') {\r\n            return await this.onSubmit('login', context);\r\n        }\r\n    }\r\n\r\n    header() {\r\n        if (this.withBack === true) {\r\n            return '登录';\r\n        }\r\n        return false;\r\n    }\r\n\r\n    footer() {\r\n        return <div className=\"d-block\">\r\n            <div className='text-center'>\r\n                <Ax href=\"/register\" className=\"btn btn-link\" style={{ margin: '0px auto' }}>\r\n                    注册账号\r\n                </Ax>\r\n            </div>\r\n            {nav.privacyEntry()}\r\n        </div>;\r\n    }\r\n\r\n    content() {\r\n        return <div className=\"d-flex p-5 flex-column justify-content-center align-items-center\">\r\n            <div className=\"flex-fill\" />\r\n            <div className=\"w-20c\">\r\n                {tonvaTop()}\r\n                <div className=\"h-2c\" />\r\n                <Form schema={schema} uiSchema={this.uiSchema}\r\n                    onButtonClick={this.onSubmit}\r\n                    onEnter={this.onEnter}\r\n                    requiredFlag={false} />\r\n                {/*onClick={() => this.clickForget()}*/}\r\n                <Ax className=\"btn btn-link btn-block\" href=\"/forget\">\r\n                    忘记密码\r\n                </Ax>\r\n            </div>\r\n            <div className=\"flex-fill\" />\r\n            <div className=\"flex-fill\" />\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage } from '../vm';\r\nimport { Page, Form, ItemSchema, UiSchema, StringSchema, UiPasswordItem, Context, ButtonSchema, UiButton, nav } from '../components';\r\n//import { CenterAppApi } from '../net';\r\nimport { CLogin } from './CLogin';\r\n\r\nexport class VChangePassword extends VPage<CLogin> {\r\n    private schema: ItemSchema[] = [\r\n        {name:'orgPassword', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'newPassword', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'newPassword1', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'submit', type: 'submit'} as ButtonSchema\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            orgPassword: {\r\n                widget: 'password',\r\n                label: '原密码',\r\n                placeholder: '输入原来的密码'\r\n            } as UiPasswordItem,\r\n            newPassword: {\r\n                widget: 'password',\r\n                label: '新密码',\r\n                placeholder: '输入新设的密码'\r\n            } as UiPasswordItem,\r\n            newPassword1: {\r\n                widget: 'password',\r\n                label: '确认密码', \r\n                placeholder: '再次输入新设密码'\r\n            } as UiPasswordItem,\r\n            submit: {\r\n                widget: 'button',\r\n                label: '提交',\r\n                className: 'btn btn-primary'\r\n            } as UiButton,\r\n        }\r\n\t};\r\n\t\r\n\tprivate onChange: (orgPassword:string, newPassword:string) => Promise<boolean>\r\n\tinit(onChange: (orgPassword:string, newPassword:string) => Promise<boolean>) {\r\n\t\tthis.onChange = onChange;\r\n\t}\r\n\r\n    private onSubmit = async (name:string, context: Context):Promise<any> => {\r\n        let {orgPassword, newPassword, newPassword1} = context.data;\r\n        if (newPassword !== newPassword1) {\r\n            context.setError('newPassword1', '新密码错误，请重新输入');\r\n            return;\r\n        }\r\n        //let centerAppApi = new CenterAppApi('tv/', undefined);\r\n\t\t//let ret = await centerAppApi.changePassword({orgPassword, newPassword});\r\n\t\tlet ret = await this.onChange(orgPassword, newPassword);\r\n        if (ret === false) {\r\n            context.setError('orgPassword', '原密码错误');\r\n            return;\r\n        }\r\n        nav.replace(<Page header=\"修改密码\" back=\"close\">\r\n            <div className=\"m-3  text-success\">\r\n                密码修改成功！\r\n            </div>\r\n        </Page>);\r\n        return;\r\n    }\r\n\r\n\theader() {return '修改密码'}\r\n\r\n    content() {\r\n        return <Form\r\n\t\t\tclassName=\"m-3\" \r\n\t\t\tschema={this.schema}\r\n\t\t\tuiSchema={this.uiSchema}\r\n\t\t\tonButtonClick={this.onSubmit}\r\n\t\t\tfieldLabelSize={2} />\r\n    }\r\n}\r\n","import { VPage } from \"../../vm\";\r\nimport { tonvaTop, getSender } from '../tools';\r\nimport { nav, Schema, UiSchema, UiTextItem, UiButton, Form, Context, StringSchema, Ax } from '../../components';\r\nimport { CForget, CRegBase, CRegister } from './CRegister';\r\n\r\nexport abstract class VStart<T extends CRegBase> extends VPage<T> {\r\n    private schema: Schema = [\r\n        { name: 'user', type: 'string', required: true, maxLength: 100 } as StringSchema,\r\n        { name: 'verify', type: 'submit' },\r\n    ]\r\n    private uiSchema: UiSchema;\r\n\r\n    abstract get accountLable(): string;\r\n    abstract get pageCaption(): string;\r\n\r\n    init() {\r\n        this.uiSchema = {\r\n            items: {\r\n                user: {\r\n                    widget: 'text',\r\n                    label: this.accountLable,\r\n                    placeholder: '手机号或邮箱',\r\n                } as UiTextItem,\r\n                verify: { widget: 'button', className: 'btn btn-primary btn-block mt-3', label: '发送验证码' } as UiButton,\r\n            }\r\n        }\r\n    }\r\n\r\n    header() { return this.pageCaption; }\r\n    footer() {\r\n        return <div className=\"text-center\">\r\n            <Ax href=\"/login\" className=\"text-primary\">已有账号，直接登录</Ax>\r\n        </div>;\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        return <div className=\"w-max-20c my-5 py-5\"\r\n            style={{ marginLeft: 'auto', marginRight: 'auto' }}>\r\n            {tonvaTop()}\r\n            <div className=\"h-3c\" />\r\n            <Form schema={this.schema} uiSchema={this.uiSchema}\r\n                onButtonClick={this.onSubmit}\r\n                onEnter={this.onEnter}\r\n                requiredFlag={false} />\r\n            {nav.privacyEntry()}\r\n        </div>;\r\n    }\r\n\r\n    private onSubmit = async (name: string, context: Context): Promise<string> => {\r\n        context.clearContextErrors();\r\n        let user = 'user';\r\n        let value = context.getValue(user);\r\n        let sender = getSender(value);\r\n        if (sender === undefined) {\r\n            context.setError(user, '必须是手机号或邮箱');\r\n            return;\r\n        }\r\n        let type: 'mobile' | 'email' = sender.type as 'mobile' | 'email';\r\n        if (type === 'mobile') {\r\n            if (value.length !== 11 || value[0] !== '1') {\r\n                context.setError(user, '请输入正确的手机号');\r\n                return;\r\n            }\r\n        }\r\n        this.controller.account = value;\r\n        this.controller.type = type;\r\n        let ret = await this.controller.checkAccount();\r\n        if (ret !== undefined) context.setError(user, ret);\r\n    }\r\n\r\n    private onEnter = async (name: string, context: Context): Promise<string> => {\r\n        if (name === 'user') {\r\n            return await this.onSubmit('verify', context);\r\n        }\r\n    }\r\n}\r\n\r\nexport class VRegisterStart extends VStart<CRegister> {\r\n    get accountLable(): string { return '账号' }\r\n    get pageCaption(): string { return '注册账号' }\r\n}\r\n\r\nexport class VForgetStart extends VStart<CForget> {\r\n    footer(): JSX.Element { return null; }\r\n    get accountLable(): string { return '账号' }\r\n    get pageCaption(): string { return '密码找回' }\r\n}\r\n","import React from 'react';\r\nimport { VPage } from \"../../vm\";\r\nimport { CRegBase } from \"./CRegister\";\r\nimport {Schema, UiSchema, UiTextItem, UiButton, Form, Context, NumSchema} from '../../components';\r\n\r\nexport class VVerify extends VPage<CRegBase> {\r\n    private schema: Schema = [\r\n        {name: 'verify', type: 'number', required: true, maxLength: 6} as NumSchema,\r\n        {name: 'submit', type: 'submit'},\r\n    ]\r\n\r\n    private onVerifyChanged = (context:Context, value:any, prev:any) => {\r\n        context.setDisabled('submit', !value || (value.length !== 6));\r\n    }\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            verify: {\r\n                widget: 'text',\r\n                label: '验证码',\r\n                placeholder: '请输入验证码',\r\n                onChanged: this.onVerifyChanged,\r\n            } as UiTextItem, \r\n            submit: {\r\n                widget: 'button', \r\n                className: 'btn btn-primary btn-block mt-3', \r\n                label: '下一步 >',\r\n                disabled: true\r\n            } as UiButton,\r\n        }\r\n\t}\r\n\t\r\n\tprivate onVerify: (verify:string) => Promise<number>;\r\n\tinit(onVerify: (verify:string) => Promise<number>) {\r\n\t\tthis.onVerify = onVerify;\r\n\t}\r\n\r\n\tprivate onSubmit = async (name:string, context:Context):Promise<string> => {\r\n        let verify = context.getValue('verify');\r\n        let ret = await this.onVerify(verify);\r\n        if (ret === 0) {\r\n            context.setError('verify', '验证码错误');\r\n            return;\r\n        }\r\n    }\r\n\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'verify') {\r\n            return await this.onSubmit('submit', context);\r\n        }\r\n    }\r\n\r\n\theader() {return '验证码'}\r\n\r\n\tcontent() {\r\n        let typeText:string, extra:any;\r\n        switch (this.controller.type) {\r\n            case 'mobile': typeText = '手机号'; break;\r\n            case 'email': \r\n                typeText = '邮箱'; \r\n                extra = <><span className=\"text-danger\">注意</span>: 有可能误为垃圾邮件，请检查<br/></>;\r\n                break;\r\n        }\r\n        return <div className=\"w-max-20c my-5 py-5\"\r\n\t\t\tstyle={{marginLeft:'auto', marginRight:'auto'}}>\r\n\t\t\t验证码已经发送到{typeText}<br/>\r\n\t\t\t<div className=\"py-2 px-3 my-2 text-primary bg-light\"><b>{this.controller.account}</b></div>\r\n\t\t\t{extra}\r\n\t\t\t<div className=\"h-1c\" />\r\n\t\t\t<Form schema={this.schema} uiSchema={this.uiSchema} \r\n\t\t\t\tonButtonClick={this.onSubmit} \r\n\t\t\t\tonEnter={this.onEnter}\r\n\t\t\t\trequiredFlag={false} />\r\n\t\t</div>;\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { VPage } from \"../../vm\";\r\nimport {nav, Page, Schema, UiSchema, UiPasswordItem, UiButton, Form, Context, StringSchema} from '../../components';\r\nimport { CForget, CRegBase, CRegister } from './CRegister';\r\n\r\nexport abstract class VPassword<T extends CRegBase> extends VPage<T> {\r\n\tprotected abstract get pageCaption():string;\r\n\tprotected abstract get submitCaption():string;\r\n\r\n\tget account():string {return this.controller.account}\r\n\r\n    private schema: Schema = [\r\n        {name: 'pwd', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n        {name: 'rePwd', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n        {name: 'submit', type: 'submit'},\r\n    ]\r\n\r\n\tprivate onButtonSubmit = async (name:string, context:Context):Promise<string> => {\r\n        let values = context.form.data;\r\n        let {pwd, rePwd} = values;\r\n        let error:string;\r\n        if (!pwd || pwd !== rePwd) {\r\n            context.setValue('pwd', '');\r\n            context.setValue('rePwd', '');\r\n            error = '密码错误，请重新输入密码！';\r\n            context.setError('pwd', error);\r\n        }\r\n        else {\r\n\t\t\terror = await this.controller.onPasswordSubmit(pwd);\r\n            if (error !== undefined) {\r\n                nav.push(<Page header=\"注册不成功\"><div className=\"p-5 text-danger\">{error}</div></Page>);\r\n            }\r\n        }\r\n        return error;\r\n    }\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'rePwd') {\r\n            return await this.onButtonSubmit('submit', context);\r\n        }\r\n    }\r\n\t\r\n\theader() {\r\n\t\treturn this.pageCaption;\r\n\t}\r\n\r\n\tcontent() {\r\n\t\tlet uiSchema: UiSchema = {\r\n\t\t\titems: {\r\n\t\t\t\tpwd: {widget: 'password', placeholder: '密码', label: '密码'} as UiPasswordItem,\r\n\t\t\t\trePwd: {widget: 'password', placeholder: '重复密码', label: '重复密码'} as UiPasswordItem,\r\n\t\t\t\tsubmit: {widget: 'button', className: 'btn btn-primary btn-block mt-3', label: this.submitCaption} as UiButton,\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <div className=\"w-max-20c my-5 py-5\"\r\n\t\t\tstyle={{marginLeft:'auto', marginRight:'auto'}}>\r\n\t\t\t注册账号<br/>\r\n\t\t\t<div className=\"py-2 px-3 my-2 text-primary bg-light\"><b>{this.account}</b></div>\r\n\t\t\t<div className=\"h-1c\" />\r\n\t\t\t<Form schema={this.schema} uiSchema={uiSchema}\r\n\t\t\t\tonButtonClick={this.onButtonSubmit}\r\n\t\t\t\tonEnter={this.onEnter}\r\n\t\t\t\trequiredFlag={false} />\r\n\t\t</div>;\r\n    }\r\n}\r\n\r\nexport class VRegisterPassword extends VPassword<CRegister> {\r\n\tget pageCaption():string {return '注册账号'}\r\n\tget submitCaption():string {return '注册新账号'}\r\n}\r\n\r\nexport class VForgetPassword extends VPassword<CForget> {\r\n\tget pageCaption():string {return '账号密码'}\r\n\tget submitCaption():string {return '改密码'}\r\n}\r\n","import React from 'react';\r\nimport { VPage } from \"../../vm\";\r\nimport { CRegBase } from './CRegister';\r\n\r\nexport abstract class VSuccess extends VPage<CRegBase> {\r\n\theader() {return false;}\r\n}\r\n\r\nexport class VRegisterSuccess extends VSuccess {\r\n\tcontent() {\r\n    \tconst {account, login} = this.controller;\r\n\t\treturn <div className=\"container w-max-30c\">\r\n\t\t\t<div className=\"my-5\">\r\n\t\t\t\t<div className=\"py-5 text-center\">\r\n\t\t\t\t\t账号 <strong className=\"text-primary\">{account} </strong> 注册成功！\r\n\t\t\t\t</div>\r\n\t\t\t\t<button className=\"btn btn-success btn-block\" type=\"button\" onClick={()=>login(undefined)}>\r\n\t\t\t\t\t直接登录\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nexport class VForgetSuccess extends VSuccess {\r\n\tcontent() {\r\n    \tconst {login} = this.controller;\r\n\t\treturn <div className=\"container w-max-30c\">\r\n\t\t\t<div className=\"my-5\">\r\n\t\t\t\t<div className=\"py-5 text-center text-success\">成功修改密码</div>\r\n\t\t\t\t<button className=\"btn btn-primary btn-block\" onClick={()=>login()}>\r\n\t\t\t\t\t登录账号\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t}\t\r\n}\r\n","import { Controller, VPage } from \"../../vm\";\r\nimport { nav } from '../../components';\r\nimport { VRegisterStart, VForgetStart } from './VStart';\r\nimport { userApi, RegisterParameter } from '../../net';\r\nimport { VVerify } from './VVerify';\r\nimport { VRegisterPassword, VForgetPassword } from './VPassword';\r\nimport { VForgetSuccess, VRegisterSuccess } from \"./VSuccess\";\r\n\r\nexport abstract class CRegBase extends Controller {\r\n    account: string;\r\n    type:'mobile'|'email';\r\n    password: string;\r\n    verify: string;\r\n\r\n\tprotected abstract get VStart(): new(c:Controller) => VPage<any>;\r\n    protected async internalStart() {\r\n        this.openVPage(this.VStart);\r\n    }\r\n\r\n\tprotected get VVerify(): new(c:Controller) => VPage<any> {return VVerify as any};\r\n    toVerify() {\r\n        //this.account = account;\r\n        this.openVPage(this.VVerify, async (verify: string) => {\r\n\t\t\tthis.verify = verify;\r\n\t\t\tlet ret = await userApi.checkVerify(this.account, verify);\r\n\t\t\tif (ret === 0) return ret;\r\n\t\t\tthis.toPassword();\r\n\t\t});\r\n    }\r\n\r\n\tprotected abstract get VPassword(): new(c:Controller) => VPage<any>;\r\n    toPassword() {\r\n        this.openVPage(this.VPassword);\r\n    }\r\n\r\n\tprotected abstract get VSuccess(): new(c:Controller) => VPage<any>;\r\n    toSuccess() {\r\n        this.openVPage(this.VSuccess);\r\n\t}\r\n\r\n    login = async (account?:string) => {\r\n        let retUser = await userApi.login({user: account || this.account, pwd: this.password, guest: nav.guest});\r\n        if (retUser === undefined) {\r\n            alert('something wrong!');\r\n            return;\r\n        }\r\n\t\tawait nav.userLogined(retUser);\r\n\t\t//await nav.start();\r\n\t\tif (this.isWebNav) nav.navigate('/');\r\n    }\r\n\r\n    async checkAccount():Promise<string> {\r\n        let ret = await userApi.isExists(this.account);\r\n        let error = this.accountError(ret);\r\n        if (error !== undefined) return error;\r\n        ret = await userApi.sendVerify(this.account, this.type, nav.oem);\r\n        this.toVerify();\r\n        return;\r\n    }\r\n\r\n    protected abstract accountError(isExists: number):string;\r\n\tabstract onPasswordSubmit(pwd:string):Promise<string>;\r\n}\r\n\r\nexport class CRegister extends CRegBase {\r\n\tprotected get VStart(): new(c:Controller) => VPage<any> {return VRegisterStart as any};\r\n\tprotected get VPassword(): new(c:Controller) => VPage<any> {return VRegisterPassword as any};\r\n\tprotected get VSuccess(): new(c:Controller) => VPage<any> {return VRegisterSuccess as any}\r\n    protected accountError(isExists: number) {\r\n        if (isExists > 0) return '已经被注册使用了';\r\n    }\r\n\r\n    async onPasswordSubmit(pwd:string):Promise<string> {\r\n\t\tthis.password = pwd;\r\n        let params: RegisterParameter = {\r\n            nick: undefined,\r\n            user: this.account, \r\n            pwd,\r\n            country: undefined,\r\n            mobile: undefined,\r\n            mobileCountry: undefined,\r\n            email: undefined,\r\n            verify: this.verify\r\n        }\r\n        switch (this.type) {\r\n            case 'mobile':\r\n                params.mobile = Number(this.account);\r\n                params.mobileCountry=86;\r\n                break;\r\n            case 'email':\r\n                params.email = this.account;\r\n                break;\r\n        }\r\n        let ret = await userApi.register(params);\r\n        if (ret === 0) {\r\n            nav.clear();\r\n            this.toSuccess();\r\n            return;\r\n        }\r\n        let error = this.regReturn(ret)\r\n        return error;\r\n\t}\r\n\t\r\n    private regReturn(registerReturn:number):string {\r\n        let msg:any;\r\n        switch (registerReturn) {\r\n            default: return '服务器发生错误';\r\n            case 4: return '验证码错误';\r\n            case 0: return;\r\n            case 1: msg = '用户名 ' + this.account; break;\r\n            case 2: msg = '手机号 +' + this.account; break;\r\n            case 3: msg = '邮箱 ' + this.account; break;\r\n        }\r\n        return msg + ' 已经被注册过了';\r\n    }\r\n}\r\n\r\nexport class CForget extends CRegBase {\r\n\tprotected get VStart(): new(c:Controller) => VPage<any> {return VForgetStart as any};\r\n\tprotected get VPassword(): new(c:Controller) => VPage<any> {return VForgetPassword as any};\r\n\tprotected get VSuccess(): new(c:Controller) => VPage<any> {return VForgetSuccess as any}\r\n\tprotected accountError(isExists: number) {\r\n        if (isExists === 0) return '请输入正确的账号';\r\n    }\r\n    async onPasswordSubmit(pwd:string):Promise<string> {\r\n\t\tthis.password = pwd;\r\n\t\tlet ret = await userApi.resetPassword(this.account, this.password, this.verify, this.type);\r\n\t\tif (ret.length === 0) {\r\n\t\t\tlet err = 'something wrong in reseting password';\r\n\t\t\tconsole.log(err);\r\n\t\t\tthrow err;\r\n\t\t}\r\n        nav.clear();\r\n        this.toSuccess();\r\n        return;\r\n    }\r\n}\r\n","import { User } from '../tool';\r\nimport { nav, Login } from '../components';\r\nimport { Controller, VPage } from \"../vm\";\r\nimport { VLogout } from './VLogout';\r\n//import { Login as LoginPage } from './login';\r\nimport { VLogin } from './VLogin';\r\nimport { CenterAppApi, userApi } from '../net';\r\nimport { VChangePassword } from './VChangePassword';\r\nimport { CRegister } from './register';\r\nimport { CForget } from './register';\r\n\r\nexport class CLogin extends Controller implements Login {\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\tasync showLogin(callback?: (user: User) => Promise<void>, withBack?: boolean): Promise<void> {\r\n\t\tlet onLogin = async (un: string, pwd: string): Promise<boolean> => {\r\n\t\t\tlet user = await userApi.login({\r\n\t\t\t\tuser: un,\r\n\t\t\t\tpwd: pwd,\r\n\t\t\t\tguest: nav.guest,\r\n\t\t\t});\r\n\r\n\t\t\tif (user === undefined) return false;\r\n\t\t\tconsole.log(\"onLoginSubmit: user=%s pwd:%s\", user.name, user.token);\r\n\t\t\tawait nav.userLogined(user, callback);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tthis.openVPage(VLogin, { onLogin, withBack });\r\n\t}\r\n\r\n\tasync showLogout(callback?: () => Promise<void>) {\r\n\t\tthis.openVPage(VLogout, () => {\r\n\t\t\tnav.logout(callback);\r\n\t\t});\r\n\t}\r\n\r\n\tasync showRegister() {\r\n\t\tlet cRegister = new CRegister(this.res);\r\n\t\tawait cRegister.start();\r\n\t}\r\n\r\n\tasync showForget() {\r\n\t\tlet cForget = new CForget(this.res);\r\n\t\tawait cForget.start();\r\n\t}\r\n\r\n\tprotected getVChangePassword(): new (cLogin: CLogin) => VPage<CLogin> {\r\n\t\treturn VChangePassword;\r\n\t}\r\n\tasync showChangePassword() {\r\n\t\tlet vPage = this.getVChangePassword();\r\n\t\tthis.openVPage(vPage, async (orgPassword: string, newPassword: string): Promise<boolean> => {\r\n\t\t\tlet centerAppApi = new CenterAppApi('tv/', undefined);\r\n\t\t\tlet ret = await centerAppApi.changePassword({ orgPassword, newPassword });\r\n\t\t\treturn ret;\r\n\t\t});\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport interface InputOptions {\r\n    type: string;\r\n    min?: number;\r\n    max?: number;\r\n    step?: number;\r\n}\r\n\r\nexport class StringItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem { return this._uiItem as UiTextItem }\r\n    protected async internalStart(): Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, { resolve, reject });\r\n            nav.push(element, reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    protected inputOptions(): InputOptions {\r\n        return {\r\n            type: 'text',\r\n        }\r\n    }\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let onSave = () => {\r\n            this.verifyValue();\r\n            if (this.error === undefined) {\r\n                let val = this.newValue;\r\n                resolve(val);\r\n            }\r\n        }\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n        let onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n            if (evt.keyCode === 13) onSave();\r\n        }\r\n        let { type, max, min, step } = this.inputOptions();\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <input type={type}\r\n                    onChange={this.onChange}\r\n                    onKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\"\r\n                    defaultValue={this.value} min={min} max={max} step={step} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiRadio } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class RadioItemEdit extends ItemEdit {\r\n    get uiItem(): UiRadio {return this._uiItem as UiRadio}\r\n\r\n\tinit() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\r\n        }\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value: any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let {name} = this.itemSchema;\r\n        let {list} = this.uiItem;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (this.error === undefined) resolve(this.newValue);\r\n            }}>保存</button>;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input name={name} type=\"radio\" value={value} \r\n                        onClick={()=>this.onChange(value)} \r\n                        defaultChecked={value === this.value} /> {title || value} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"m-3\">\r\n\t\t\t\t<div className=\"row row-cols-2 row-cols-sm-3 row-cols-md-4\">{content}</div>\r\n\t\t\t</div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiSelect } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class SelectItemEdit extends ItemEdit {\r\n    get uiItem(): UiSelect {return this._uiItem as UiSelect}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiIdItem } from '../schema';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class IdItemEdit extends ItemEdit {\r\n    get uiItem(): UiIdItem {return this._uiItem as UiIdItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            //let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            //nav.push(element,reject);\r\n\r\n            let {pickId} = this.uiItem;\r\n            if (pickId === undefined) {\r\n                alert('IdItemEdit.pickId = undefined');\r\n                return;\r\n            }\r\n            let boxId = await pickId(undefined, undefined, this.value);\r\n            //if (typeof id === 'object') {\r\n            //    id = (id as any).id;\r\n            //}\r\n            this.onChange(boxId.id);\r\n            resolve(boxId);\r\n            //this.newValue = id;\r\n        });\r\n    }\r\n\r\n    protected async internalEnd():Promise<void> {}\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        /*\r\n        let {resolve, reject} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n        */\r\n        return <Page header={'更改' + this.label}>\r\n            ddd\r\n        </Page>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiTag } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nabstract class TagItemEdit extends ItemEdit {\r\n\tprotected inputs: {[index:number]: HTMLInputElement} = {};\r\n\tprotected inputType: 'checkbox' | 'radio';\r\n    get uiItem(): UiTag {return this._uiItem as UiTag};\r\n\r\n\tinit() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\r\n        }\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n\t}\r\n\t\r\n\trenderContent() {\r\n\t\tlet valuesView = this.uiItem.valuesView;\r\n\t\tif (valuesView === undefined) return super.renderContent();\r\n\t\treturn valuesView.render(this.value);\r\n\t}\r\n\r\n\tprotected abstract renderInputs():JSX.Element;\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (this.error === undefined) resolve(this.newValue);\r\n\t\t\t}}>保存</button>;\r\n\t\t/*\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {name:itemName, id} = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input ref={input=>this.inputs[id] = input} name={name} type={this.inputType} value={id} \r\n\t\t\t\t\t\tonClick={(e)=>this.onChange(e.currentTarget.checked, id)}\r\n                        defaultChecked={this.defaultChecked(id)} /> {itemName} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n\t\t\t<>no list defined</>;\r\n\t\t*/\r\n        return <Page header={'更改' + this.label} right={right}>\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t\t{this.renderInputs()}\r\n\t\t\t</div>\r\n        </Page>;\r\n    })\r\n}\r\n\r\nexport class TagSingleItemEdit extends TagItemEdit {\r\n\tprotected inputType:'radio'|'checkbox' = 'radio';\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet {currentTarget} = evt;\r\n\t\tif (currentTarget.checked === false) return;\r\n        this.newValue = Number(currentTarget.value);\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\t\r\n\tprotected renderInputs():JSX.Element {\r\n\t\tlet {valuesView} = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange,\r\n\t\t};\r\n\t\treturn valuesView.renderRadios(this.value, options);\r\n\t}\r\n}\r\n\r\nexport class TagMultiItemEdit extends TagItemEdit {\r\n\t//private arr:number[];\r\n\tprotected inputType:'radio'|'checkbox' = 'checkbox';\r\n\r\n\tprivate onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.newValue = values.join('|');\r\n        //this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\tprotected renderInputs():JSX.Element {\r\n\t\tlet {valuesView} = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t};\r\n\t\treturn valuesView.renderChecks(this.value, options);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class TextAreaItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem { return this._uiItem as UiTextItem }\r\n    protected async internalStart(): Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, { resolve, reject });\r\n            nav.push(element, reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let onSave = () => {\r\n            this.verifyValue();\r\n            if (this.error === undefined) {\r\n                let val = this.newValue;\r\n                resolve(val);\r\n            }\r\n        }\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n        let onKeyDown = (evt: React.KeyboardEvent<HTMLTextAreaElement>) => {\r\n            // if (evt.keyCode === 13) onSave();\r\n        }\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <textarea\r\n                    onChange={this.onChange}\r\n                    onKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\"\r\n                    defaultValue={this.value}\r\n                    rows={6} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import React from 'react';\r\nimport { UiCheckItem } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class CheckBoxItemEdit extends ItemEdit {\r\n\tprivate input: HTMLInputElement;\r\n    get uiItem(): UiCheckItem {return this._uiItem as UiCheckItem}\r\n\tget editInRow(): boolean {return true;}\r\n    protected async internalStart():Promise<any> {\r\n\t\tif (!this.input) return;\r\n\t\tlet uiItem = this.uiItem;\r\n\t\tif (uiItem === undefined) return this.input.checked;\r\n\t\tlet {checked} = this.input;\r\n\t\treturn this.getValue(checked);\r\n    }\r\n\tasync end():Promise<any> {}\r\n\trenderContent() {\r\n\t\tlet {readOnly} = this.uiItem;\r\n\t\tlet disabled = readOnly === true;\r\n\t\tlet onChange:any;\r\n\t\tif (readOnly !== true) onChange = this.onChange;\r\n\t\treturn <input ref={r => this.input=r} type=\"checkbox\" \r\n\t\t\tdefaultChecked={this.value} disabled={disabled}\r\n\t\t\tonChange={onChange} />\r\n\t}\r\n\r\n\tprivate getValue(checked: boolean) {\r\n\t\tlet {trueValue, falseValue} = this.uiItem;\r\n        return checked === true? (trueValue??true) : (falseValue??false);\r\n\t}\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = this.getValue(evt.target.checked);\r\n        let preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t\tthis.edit.onItemChanged(this, this.newValue);\r\n    }\r\n}\r\n","import { UiRange } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class RangeItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiRange).min\r\n\t\t\tmax = (this._uiItem as UiRange).max\r\n\t\t\tstep = (this._uiItem as UiRange).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'range',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import { UiNumberItem } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class NumberItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiNumberItem).min\r\n\t\t\tmax = (this._uiItem as UiNumberItem).max\r\n\t\t\tstep = (this._uiItem as UiNumberItem).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'number',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import * as React from 'react';\r\n//import _ from 'lodash';\r\nimport { observer } from 'mobx-react';\r\nimport { Schema, UiSchema, ItemSchema, UiItem, UiRadio, UiTagSingle, UiTagMulti } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { StringItemEdit } from './stringItemEdit';\r\nimport { ImageItemEdit } from './imageItemEdit';\r\nimport { RadioItemEdit } from './radioItemEdit';\r\nimport { SelectItemEdit } from './selectItemEdit';\r\nimport { IdItemEdit } from './idItemEdit';\r\nimport { TagSingleItemEdit, TagMultiItemEdit } from './tagItemEdit';\r\nimport { TextAreaItemEdit } from './textAreaItemEdit';\r\nimport { CheckBoxItemEdit } from './checkBoxItemEdit';\r\nimport { RangeItemEdit } from './rangeItemEdit';\r\nimport { NumberItemEdit } from './numberItemEdit';\r\n\r\nexport interface EditProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    data: any;\r\n    onItemClick?: (itemSchema: ItemSchema, uiItem: UiItem, value: any) => Promise<void>;\r\n    onItemChanged?: (itemSchema: ItemSchema, newValue: any, preValue: any) => Promise<void>;\r\n    stopEdit?: boolean;\r\n    uiSchema?: UiSchema;\r\n    sepClassName?: string;\r\n    topBorderClassName?: string;\r\n    bottomBorderClassName?: string;\r\n    rowContainerClassName?: string;\r\n}\r\n\r\n@observer\r\nexport class Edit extends React.Component<EditProps> {\r\n    private defaultSepClassName = 'border-top edit-sep-light-gray';\r\n    private defaultRowContainerClassName = 'd-flex px-3 py-2 bg-white align-items-center';\r\n    private topBorder: JSX.Element;\r\n    private bottomBorder: JSX.Element;\r\n    private rowContainerClassName?: string;\r\n    private sep: JSX.Element;\r\n    private uiSchema: { [name: string]: UiItem };\r\n\r\n    constructor(props: EditProps) {\r\n        super(props);\r\n        let { topBorderClassName, bottomBorderClassName, sepClassName, rowContainerClassName, uiSchema } = props;\r\n        this.topBorder = <div className={topBorderClassName || this.defaultSepClassName} />;\r\n        this.bottomBorder = <div className={bottomBorderClassName || this.defaultSepClassName} />;\r\n        this.rowContainerClassName = rowContainerClassName || this.defaultRowContainerClassName;\r\n        //if (stopEdit !== true) this.rowContainerClassName += ' cursor-pointer';\r\n        this.sep = <div className={sepClassName || this.defaultSepClassName} />;\r\n        this.uiSchema = (uiSchema && uiSchema.items) || {};\r\n    }\r\n\r\n    render() {\r\n        let { schema } = this.props;\r\n        let sep: any;\r\n        return <div>\r\n            {this.topBorder}\r\n            {schema.map((itemSchema, index) => {\r\n                let { stopEdit } = this.props;\r\n                let { name } = itemSchema;\r\n                let uiItem = this.uiSchema === undefined ? undefined : this.uiSchema[name];\r\n                let label: string, labelHide: any;\r\n                if (uiItem !== undefined) {\r\n                    label = uiItem.label || name;\r\n                    labelHide = uiItem.labelHide;\r\n                };\r\n                let value = this.props.data[name];\r\n                let itemEdit = createItemEdit(this, itemSchema, uiItem, label, value);\r\n                let rowContainerClassName = this.rowContainerClassName;\r\n                let { editInRow } = itemEdit;\r\n                if (editInRow === false) {\r\n                    if (stopEdit !== true) editInRow = false;\r\n                }\r\n                if (editInRow === false) rowContainerClassName += ' cursor-pointer';\r\n\r\n                let { required } = itemSchema;\r\n                let requireFlag = required === true && <span className=\"text-danger\">*</span>;\r\n                let divLabel: any, cn: string = 'flex-fill d-flex ';\r\n                if (labelHide === true) {\r\n                    divLabel = undefined;\r\n                }\r\n                else {\r\n                    divLabel = <div>{label} {requireFlag}</div>;\r\n                    cn += 'justify-content-end';\r\n                }\r\n                let ret = <React.Fragment key={index}>\r\n                    {sep}\r\n                    <div className={'d-flex align-items-center' + rowContainerClassName}\r\n                        onClick={async () => await this.rowClick(itemEdit)}>\r\n                        {divLabel}\r\n                        <div className={cn}>{\r\n                            itemEdit === undefined ? undefined : itemEdit.renderContent()\r\n                        }</div>\r\n                        {editInRow === false && <div className=\"w-2c text-end\"><i className=\"fa fa-angle-right\" /></div>}\r\n                    </div>\r\n                </React.Fragment>;\r\n                sep = this.sep;\r\n                return ret;\r\n            })}\r\n            {this.bottomBorder}\r\n        </div>;\r\n    }\r\n\r\n    async onItemChanged(itemEdit: ItemEdit, newValue: any) {\r\n        let { itemSchema, uiItem, value } = itemEdit;\r\n        this.props.data[itemSchema.name] = newValue;\r\n        let { onItemChanged, stopEdit } = this.props;\r\n        if (stopEdit === true) return;\r\n        if (uiItem?.readOnly === true) return;\r\n        if (onItemChanged === undefined) {\r\n            alert(`${itemSchema.name} value changed, new: ${newValue}, pre: ${value}`);\r\n            // 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n            //this.props.data[itemSchema.name] = changeValue;\r\n        }\r\n        else {\r\n            await onItemChanged(itemSchema, newValue, value);\r\n        }\r\n    }\r\n\r\n    private rowClick = async (itemEdit: ItemEdit) => {\r\n        if (itemEdit === undefined) {\r\n            alert('item has no edit');\r\n            return;\r\n        }\r\n        let { itemSchema, uiItem, value, editInRow } = itemEdit;\r\n        if (editInRow === true) return;\r\n        let { onItemChanged, onItemClick, stopEdit } = this.props;\r\n        if (stopEdit === true) return;\r\n        if (uiItem?.readOnly === true) return;\r\n        let changeValue: any;\r\n        if (onItemClick !== undefined) {\r\n            await onItemClick(itemSchema, uiItem, value);\r\n            return;\r\n        }\r\n        //let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);\r\n        if (itemEdit === undefined) {\r\n            alert('undefined: let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);');\r\n            return;\r\n        }\r\n        try {\r\n            changeValue = await itemEdit.start();\r\n            if (changeValue !== value) {\r\n                // 2020-04-15：改值之后，应该赋值吧。所以移到这里来\r\n                this.props.data[itemSchema.name] = changeValue;\r\n                if (onItemChanged === undefined) {\r\n                    alert(`${itemSchema.name} value changed, new: ${changeValue}, pre: ${value}`);\r\n                    // 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n                    //this.props.data[itemSchema.name] = changeValue;\r\n                }\r\n                else {\r\n                    await onItemChanged(itemSchema, changeValue, value);\r\n                }\r\n            }\r\n            await itemEdit.end();\r\n        }\r\n        catch (err) {\r\n            // 如果直接back，会触发reject，就到这里了\r\n            console.log('no value changed');\r\n            console.error(err);\r\n        }\r\n    }\r\n}\r\n\r\ntype NewItemEdit = new (edit: Edit, itemSchema: ItemSchema, uiItem: UiItem, label: string, value: any) => ItemEdit;\r\n\r\nfunction createItemEdit(edit: Edit, itemSchema: ItemSchema, uiItem: UiItem, label: string, value: any): ItemEdit {\r\n    let ie: ItemEdit;\r\n    let itemEdit: NewItemEdit;\r\n    if (uiItem !== undefined) {\r\n        switch (uiItem.widget) {\r\n            default: break;\r\n            case 'id': itemEdit = IdItemEdit; break;\r\n            case 'text': itemEdit = StringItemEdit; break;\r\n            case 'textarea': itemEdit = TextAreaItemEdit; break;\r\n            case 'image': itemEdit = ImageItemEdit; break;\r\n            case 'select': itemEdit = SelectItemEdit; break;\r\n            case 'range': itemEdit = RangeItemEdit; break;\r\n            case 'number':\r\n            case 'updown': itemEdit = NumberItemEdit; break;\r\n            case 'checkbox': itemEdit = CheckBoxItemEdit; break;\r\n            case 'radio':\r\n                ie = new RadioItemEdit(edit, itemSchema, uiItem as UiRadio, label, value);\r\n                break;\r\n            case 'tagSingle':\r\n                ie = new TagSingleItemEdit(edit, itemSchema, uiItem as UiTagSingle, label, value);\r\n                break;\r\n            case 'tagMulti':\r\n                ie = new TagMultiItemEdit(edit, itemSchema, uiItem as UiTagMulti, label, value);\r\n                break;\r\n        }\r\n    }\r\n    if (ie === undefined) {\r\n        if (itemEdit === undefined) {\r\n            switch (itemSchema.type) {\r\n                case 'string': itemEdit = StringItemEdit; break;\r\n                case 'image': itemEdit = ImageItemEdit; break;\r\n                case 'boolean': itemEdit = CheckBoxItemEdit; break;\r\n                case 'number':\r\n                case 'integer': itemEdit = RangeItemEdit; break;\r\n            }\r\n        }\r\n        if (itemEdit === undefined) return;\r\n        ie = new itemEdit(edit, itemSchema, uiItem, label, value);\r\n    }\r\n    ie.init();\r\n    return ie;\r\n}\r\n","import {CenterApiBase} from '../net';\r\n\r\nexport class CenterApi extends CenterApiBase {\r\n    async userAppUnits(app:number):Promise<any[]> {\r\n        return await this.get('tie/user-app-units', {app:app});\r\n    }\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await this.get('user/user-name-nick-icon-from-id', {userId:userId});\r\n\t}\r\n\tasync userFromKey(userName:string):Promise<any> {\r\n\t\treturn await this.get('tie/user-from-key', {key:userName});\r\n\t}\r\n}\r\n\r\nexport const centerApi = new CenterApi('tv/', undefined);\r\n","import * as React from 'react';\r\nimport { Page, FA, nav, LMR, List } from \"../components\";\r\nimport { VPage } from '../vm';\r\nimport { appInFrame } from '../net';\r\nimport { CAppBase } from \"./CAppBase\";\r\nimport { UQsMan } from '../uq';\r\n\r\n/*\r\nexport class VAppMain extends VPage<CMainBase> {\r\n    async open(param?:any) {\r\n        this.openPage(this.appPage);\r\n    }\r\n\r\n    render(param?:any) {\r\n        return this.appContent();\r\n    }\r\n\r\n    protected appPage = () => {\r\n        let {caption} = this.controller;\r\n        return <Page header={caption} logout={async()=>{appInFrame.unit = undefined}}>\r\n            {this.appContent()}\r\n        </Page>;\r\n    }\r\n\r\n    protected appContent = () => {\r\n        let {cUqArr} = this.controller;\r\n        let content:any;\r\n        if (cUqArr.length === 0) {\r\n            content = <div className=\"text-danger\">\r\n                <FA name=\"\" /> 此APP没有绑定任何的UQ\r\n            </div>;\r\n        }\r\n        else {\r\n            content = cUqArr.map((v,i) => <div key={i}>{v.render()}</div>);\r\n        }\r\n        return <>{content}</>;\r\n    };\r\n}\r\n*/\r\nexport class VUnsupportedUnit extends VPage<CAppBase> {\r\n    async open(predefinedUnit: number) {\r\n        this.openPage(this.page, {predefinedUnit:predefinedUnit});\r\n    }\r\n\r\n    private page = ({predefinedUnit}:{predefinedUnit: number}) => {\r\n        let {user} = nav;\r\n        let userName:string = user? user.name : '[未登录]';\r\n        let {appOwner, appName} = UQsMan.value;\r\n        return <Page header=\"APP无法运行\" logout={true}>\r\n            <div className=\"m-3 text-danger container\">\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">登录用户</div>\r\n                    <div className=\"col-sm text-body\">{userName}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">App</div>\r\n                    <div className=\"col-sm text-body\">{`${appOwner}/${appName}`}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">预设小号</div>\r\n                    <div className=\"col-sm text-body\">{predefinedUnit || <small className=\"\">[无预设小号]</small>}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">\r\n                        可能原因<FA name=\"exclamation-triangle\" />\r\n                    </div>\r\n                    <div className=\"col-sm text-body\">\r\n                        <ul className=\"p-0\">\r\n                            <li>没有小号运行 {appName}</li>\r\n                            <li>用户 <b>{userName}</b> 没有加入任何一个运行{appName}的小号</li>\r\n                            {\r\n                                predefinedUnit && \r\n                                <li>预设小号 <b>{predefinedUnit}</b> 没有运行App {appName}</li>\r\n                            }\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">小号{predefinedUnit}</div>\r\n                    <div className=\"col-sm text-body\">\r\n                        预设小号定义在 public/unit.json 文件中。\r\n                        定义了这个文件的程序，只能由url直接启动。\r\n                        用户第一次访问app之后，会缓存在localStorage里。<br/>\r\n                        如果要删去缓存的预定义Unit，logout然后再login。\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class VUnitSelect extends VPage<CAppBase> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderRow = (item: any, index: number):JSX.Element => {\r\n        let {id, nick, name} = item;\r\n        return <LMR className=\"px-3 py-2\" right={'id: ' + id}>\r\n            <div>{nick || name}</div>\r\n        </LMR>;\r\n    }\r\n    private onRowClick = async (appUnit: any) => {\r\n\t\tappInFrame.unit = appUnit.id; // 25;\r\n\t\tthis.controller.setAppUnit(appUnit);\r\n        await this.controller.start();\r\n    }\r\n\r\n    private page = () => {\r\n        return <Page header=\"选择小号\" logout={true}>\r\n            <List items={this.controller.appUnits} item={{render: this.renderRow, onClick: this.onRowClick}}/>\r\n        </Page>\r\n    }\r\n}\r\n\r\nexport class VErrorsPage extends VPage<CAppBase> {\r\n    async open(errors:string[]) {\r\n        this.openPage(this.page, {errors:errors});\r\n    }\r\n\r\n    private page = (errors:{errors:string[]}) => {\r\n        return <Page header=\"ERROR\">\r\n            <div className=\"m-3\">\r\n\t\t\t\t<div className=\"p-3 d-flex justify-content-center align-items-center\">\r\n\t\t\t\t\t<button className=\"btn btn-danger\" onClick={nav.resetAll}>重启网页</button>\r\n\t\t\t\t</div>\r\n\r\n                <div>Load Uqs 发生错误：</div>\r\n                {errors.errors.map((r, i) => <div key={i}>{r}</div>)}\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class VStartError extends VPage<CAppBase> {\r\n    async open(error:any) {\r\n        this.openPage(this.page, {error:error});\r\n    }\r\n\r\n    private page = ({error}:{error:any}) => {\r\n        return <Page header=\"App start error!\">\r\n            <pre>\r\n                {typeof error === 'string'? error : error.message}\r\n            </pre>\r\n        </Page>;\r\n    }\r\n}","import { nav, t, setGlobalRes, RouteFunc, Hooks, Navigo, NamedRoute } from \"../components\";\r\nimport { Controller } from '../vm';\r\nimport { UQsMan, TVs } from \"../uq\";\r\nimport { appInFrame } from \"../net\";\r\nimport { centerApi } from \"./centerApi\";\r\nimport { VUnitSelect, VErrorsPage, VStartError, VUnsupportedUnit } from \"./vMain\";\r\n\r\nexport interface IConstructor<T> {\r\n    new (...args: any[]): T;\r\n}\r\n\r\nexport interface AppConfig {\r\n    appName: string;        // 格式: owner/appName\r\n    version: string;        // 版本变化，缓存的uqs才会重载\r\n    tvs: TVs;\r\n    uqNameMap?: {[uqName:string]: string};      // uqName='owner/uq' 映射到内存简单名字：uq, 可以注明映射，也可以自动。有可能重\r\n    loginTop?: JSX.Element;\r\n    oem?: string;               // 用户注册发送验证码的oem厂家，默认同花\r\n\tprivacy?: string;\r\n\tnoUnit?: boolean;\t\t\t// app的运行，不跟unit绑定\r\n\thtmlTitle?: string;\r\n}\r\n\r\nexport interface Elements {\r\n\t[id:string]: (element: HTMLElement)=>void,\r\n}\r\n\r\nexport abstract class CAppBase extends Controller {\r\n\tprivate appConfig: AppConfig;\r\n    protected _uqs: any;\r\n\r\n    protected readonly name: string;\r\n\tprotected readonly noUnit: boolean;\r\n\r\n    appUnits:any[];\r\n\r\n    constructor(config?: AppConfig) {\r\n\t\tsuper(undefined);\r\n\t\tthis.appConfig = config || (nav.navSettings as AppConfig);\r\n\t\tif (this.appConfig) {\r\n\t\t\tlet {appName, noUnit} = this.appConfig;\r\n\t\t\tthis.name = appName;\r\n\t\t\tif (appName === undefined) {\r\n\t\t\t\tthrow new Error('appName like \"owner/app\" must be defined in MainConfig');\r\n\t\t\t}\r\n\t\t\tthis.noUnit = noUnit;\r\n\t\t}\r\n    }\r\n\r\n    get uqs(): any {return this._uqs;}\r\n\r\n\tinternalT(str:string):any {\r\n\t\treturn t(str);\r\n\t}\r\n\t\r\n\tprotected setRes(res:any) {\r\n\t\tsetGlobalRes(res);\r\n\t}\r\n\r\n\tprivate appUnit:any;\r\n\tprivate roleDefines: string[];\r\n\thasRole(role: string|number):boolean {\r\n\t\tlet nRole:number;\r\n\t\tif (typeof role === 'string') {\r\n\t\t\tif (role.length === 0) return false;\r\n\t\t\tlet index = this.roleDefines.findIndex(v => v === role);\r\n\t\t\tif (index < 0) return false;\r\n\t\t\tnRole = 1<<index;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tnRole = role;\r\n\t\t}\r\n\t\treturn (this.appUnit.roles & nRole) !== 0;\r\n\t}\r\n\r\n\tsetAppUnit(appUnit:any) {\r\n\t\tthis.appUnit = appUnit;\r\n\t\tlet {roleDefs} = appUnit;\r\n\t\tif (roleDefs) {\r\n\t\t\tthis.roleDefines = roleDefs.split('\\t');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.roleDefines = [];\r\n\t\t}\r\n}\r\n\t\r\n    protected async beforeStart():Promise<boolean> {\r\n        try {\r\n\t\t\tthis.onNavRoutes();\r\n\t\t\tif (!this.appConfig) return true;\r\n\t\t\tlet {appName, version, tvs} = this.appConfig;\r\n\t\t\tawait UQsMan.load(appName, version, tvs);\r\n\t\t\tthis._uqs = UQsMan._uqs;\t\t\t\r\n            //let retErrors = await this.load();\r\n            //let app = await loadAppUqs(this.appOwner, this.appName);\r\n            // if (isDevelopment === true) {\r\n\t\t\t// 这段代码原本打算只是在程序员调试方式下使用，实际上，也可以开放给普通用户，production方式下\r\n\t\t\tlet retErrors = UQsMan.errors;\r\n            let {predefinedUnit} = appInFrame;\r\n            let {user} = nav;\r\n            if (user !== undefined && user.id > 0) {\r\n\t\t\t\tlet result = await centerApi.userAppUnits(UQsMan.value.id);\r\n\t\t\t\tthis.appUnits = result;\r\n\t\t\t\t/*\r\n\t\t\t\t// 老版本，只返回一个数组。新版本，返回两个数组。下面做两个数组的判断\r\n\t\t\t\tif (result.length === 0) {\r\n\t\t\t\t\tthis.appUnits = result;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (Array.isArray(result[0]) === true) {\r\n\t\t\t\t\t\tthis.appUnits = result[0];\r\n\t\t\t\t\t\tlet result1 = result[1];\r\n\t\t\t\t\t\tif (Array.isArray(result1) === true) {\r\n\t\t\t\t\t\t\tthis.roleDefines = result1[0]?.roles?.split('\\t');\r\n\t\t\t\t\t\t\tif (this.roleDefines === undefined) this.roleDefines = [];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.appUnits = result;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\tif (this.noUnit === true) return true;\r\n                switch (this.appUnits.length) {\r\n                    case 0:\r\n                        this.showUnsupport(predefinedUnit);\r\n\t\t\t\t\t\treturn false;\r\n                    case 1:\r\n\t\t\t\t\t\tlet appUnit = this.appUnits[0];\r\n\t\t\t\t\t\tthis.setAppUnit(appUnit);\r\n\t\t\t\t\t\tlet {id} = appUnit;\r\n                        let appUnitId = id;\r\n                        if (appUnitId === undefined || appUnitId < 0 || \r\n                            (predefinedUnit !== undefined && appUnitId !== predefinedUnit))\r\n                        {\r\n                            this.showUnsupport(predefinedUnit);\r\n                            return false;\r\n                        }\r\n                        appInFrame.unit = appUnitId;\r\n                        break;\r\n                    default:\r\n                        if (predefinedUnit>0 && this.appUnits.find(v => v.id===predefinedUnit) !== undefined) {\r\n                            appInFrame.unit = predefinedUnit;\r\n                            break;\r\n                        }\r\n                        this.openVPage(VUnitSelect);\r\n                        return false;\r\n                }\r\n            }\r\n            if (retErrors !== undefined) {\r\n                this.openVPage(VErrorsPage, retErrors);\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n        catch (err) {\r\n            this.openVPage(VStartError, err);\r\n            return false;\r\n        }\r\n    }\r\n\tprotected async afterStart():Promise<void> {\r\n\t\tnav.resolveRoute();\r\n\t}\r\n\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await centerApi.userFromId(userId);\r\n    }\r\n\r\n\tprotected on(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\tprotected on(...args:any[]):Navigo {\r\n\t\treturn nav.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tprotected onNavRoutes() {return;}\r\n\r\n    private showUnsupport(predefinedUnit: number) {\r\n        nav.clear();\r\n        this.openVPage(VUnsupportedUnit, predefinedUnit);\r\n    }\r\n}\r\n","import { AppConfig, CAppBase } from './CAppBase';\r\n\r\nexport async function start(CApp: new (config: AppConfig) => CAppBase, appConfig: AppConfig, isUserLogin?:boolean) {\r\n\tif (appConfig) {\r\n\t\tlet {htmlTitle} = appConfig;\r\n\t\tif (htmlTitle) {\r\n\t\t\tdocument.title = htmlTitle;\r\n\t\t}\r\n\t\tlet html = document.getElementsByTagName('html');\r\n\t\tlet html0 = html[0];\r\n\t\tif (html0) {\r\n\t\t\tlet version = html0?.getAttribute('data-version');\r\n\t\t\tif (version) appConfig.version = version;\r\n\t\t}\r\n\t}\r\n\r\n\tlet cApp = new CApp(appConfig);\r\n    await cApp.start(isUserLogin);\r\n}\r\n","import _ from 'lodash';\r\nimport { Controller, WebNav } from \"../vm\";\r\nimport { IConstructor } from \"./CAppBase\";\r\n\r\nexport abstract class CBase extends Controller {\r\n    protected readonly _uqs: any;\r\n    protected readonly _cApp: any;\r\n\r\n    constructor(cApp: any) {\r\n        super(cApp.res);\r\n        this._cApp = cApp;\r\n        this._uqs = cApp && cApp.uqs;\r\n\t}\r\n\r\n    protected get uqs(): any {return this._uqs}\r\n\tget cApp(): any {return this._cApp}\r\n\thasRole(role:string|number):boolean {\r\n\t\treturn this._cApp?.hasRole(role);\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._cApp.internalT(str);\r\n\t}\r\n\r\n    protected newC<T extends CBase>(type: IConstructor<T>, param?:any):T {\r\n\t\tlet c = new type(this.cApp);\r\n\t\tc.init(param);\r\n\t\treturn c;\r\n    }\r\n\r\n    protected newSub<O extends CBase, T extends CSub<O>>(type: IConstructor<T>, param?:any):T {\r\n\t\tlet s = new type(this);\r\n\t\ts.init(param);\r\n\t\treturn s;\r\n\t}\r\n\t\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this._cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ret = _.clone(wn);\r\n\t\t_.merge(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nexport abstract class CSub<T extends CBase> extends CBase {\r\n    protected _owner: T;\r\n\r\n    constructor(owner: T) {\r\n        super(owner.cApp);\r\n        this._owner = owner;\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._owner.internalT(str);\r\n\t}\r\n\r\n    protected get owner(): CBase {return this._owner}\r\n\t\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this._cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ownerWNs:WebNav<any>[] = [];\r\n\t\tfor (let p = this.owner; p!==undefined; p = (p as any)?.owner) {\r\n\t\t\townerWNs.push(p.webNav);\r\n\t\t}\r\n\t\tlet ret = _.clone(wn);\r\n\t\tfor (;;) {\r\n\t\t\tlet own = ownerWNs.pop();\r\n\t\t\tif (own === undefined) break;\r\n\t\t\t_.merge(ret, own);\r\n\t\t}\r\n\t\t_.merge(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { IObservableArray, computed } from 'mobx';\r\nimport { PageItems } from '../../tool/pageItems';\r\nimport {List} from './index';\r\n\r\nexport abstract class ListBase {\r\n    protected list: List;\r\n    constructor(list: List) {\r\n        this.list = list;\r\n    }\r\n    get isPaged():boolean {\r\n        let items = this.list.props.items;\r\n        return (items !== null && items !== undefined && Array.isArray(items) === false);\r\n    }\r\n    get items():any[]|IObservableArray<any> {\r\n        let items = this.list.props.items;\r\n        if (items === null) return null;\r\n        if (items === undefined) return undefined;\r\n        if (Array.isArray(items) === true)\r\n            return items as IObservableArray<any>;\r\n        else\r\n            return (items as PageItems<any>).items;\r\n    }\r\n    @computed get loading():boolean {\r\n        let items = this.list.props.items;\r\n        if (items === null) return false;\r\n        if (items === undefined) return true;\r\n        let pageItems = items as PageItems<any>;\r\n        if (pageItems.items === undefined) return false;\r\n        return pageItems.loading;\r\n    }\r\n    get selectedItems():any[] { return undefined; }\r\n    //updateProps(nextProps:any) {}\r\n    dispose() {};\r\n    abstract render: (item:any, index:number) => JSX.Element;\r\n    protected renderContent(item:any, index:number) {\r\n        let {render} = this.list.props.item;\r\n        if (render === undefined) return <div className=\"px-3 py-2\">{JSON.stringify(item)}</div>;\r\n        return render(item, index);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\n\r\nexport class Clickable extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key, onClick} = this.list.props.item;\r\n        return <li key={key===undefined?index:key(item)} className={classNames('va-row-clickable', className)} onClick={()=>onClick && onClick(item)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { ListBase } from './base';\r\nimport { uid } from '../../tool/uid';\r\n\r\nexport class Static extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key} = this.list.props.item;\r\n        if (typeof item === 'string') {\r\n            let cn = classNames('va-list-gap', 'px-3', 'pt-1');\r\n            return <li key={uid()} className={cn}>{item}</li>;\r\n        }\r\n        return <li key={key===undefined?index:key(item)} className={classNames(className)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observable, IObservableArray, isObservableArray, observe} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\nimport {uid} from '../../tool/uid';\r\nimport { PageItems } from '../../tool/pageItems';\r\nimport { List } from './index';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport interface SelectableItem {\r\n    selected: boolean;\r\n    item: any;\r\n    labelId: string;\r\n}\r\n\r\nexport class Selectable extends ListBase {\r\n    @observable private _items: SelectableItem[];\r\n    private inputItems:{[uid:string]: HTMLInputElement} = {};\r\n\r\n    constructor(list: List) {\r\n        super(list);\r\n        this.buildItems();\r\n        this.listenArraySplice();\r\n    }    \r\n\r\n    private listenArraySplice() {\r\n        let {items} = this.list.props;\r\n        if (items === undefined) return;\r\n        if (items === null) return;\r\n        let itemsArray:any;\r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as PageItems<any>).items;\r\n        }\r\n        if (isObservableArray(items) === true) {\r\n            observe(itemsArray as IObservableArray<any>, (change) => {                \r\n                if (change.type === 'splice') {\r\n                    let {index, removedCount, added} = change;\r\n                    let _added = added && added.map(v => {\r\n                        return {\r\n                            selected: false, \r\n                            item: v, \r\n                            labelId:uid()\r\n                        }\r\n                    });\r\n                    this._items.splice(index, removedCount, ..._added);\r\n                    this.buildItems();\r\n                }\r\n            }, true);\r\n        }\r\n    }\r\n\r\n    private buildItems = () => {\r\n        let {items, isItemSelected, selectedItems, compare} = this.list.props;\r\n        let itemsArray:any[] | IObservableArray<any>;\r\n        if (items === undefined) {\r\n            this._items = undefined;\r\n            return;\r\n        }\r\n        if (items === null) {\r\n            this._items = null;\r\n            return;\r\n        }\r\n        \r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as PageItems<any>).items;\r\n        }\r\n\r\n\t\tif (isItemSelected) {\r\n\t\t\tlet retItems = itemsArray.map(v => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tselected: isItemSelected(v),\r\n\t\t\t\t\titem: v, \r\n\t\t\t\t\tlabelId:uid()\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tthis._items = retItems;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet comp: ((item:any, selectItem:any)=>boolean);\r\n\t\t\tif (compare === undefined) {\r\n\t\t\t\tcomp = (item:any, selectItem:any) => item === selectItem;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcomp = compare;\r\n\t\t\t}\r\n\t\t\tlet retItems = itemsArray.map(v => {\r\n\t\t\t\t//let isObserved = isObservable(v);\r\n\t\t\t\t//let obj = isObserved === true? toJS(v) : v;\r\n\t\t\t\t//let obj = v;\r\n\t\t\t\tlet selected = selectedItems === undefined?\r\n\t\t\t\t\tfalse\r\n\t\t\t\t\t: selectedItems.find(si => comp(v, si)) !== undefined;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tselected: selected, \r\n\t\t\t\t\titem: v, \r\n\t\t\t\t\tlabelId:uid()\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tthis._items = retItems;\r\n\t\t}\r\n    }\r\n\r\n    get items() {\r\n        //if (this._items === undefined) \r\n        //this.buildItems();\r\n        return this._items;\r\n    }\r\n    private checkAll(on: boolean) {\r\n        for (let i in this.inputItems) this.inputItems[i].checked = on;\r\n        for (let item of this._items) item.selected = on;\r\n    }\r\n    selectAll() {\r\n        //if (this._items) this._items.forEach(v => v.selected = true);\r\n        this.checkAll(true);\r\n        this.list.props.item.onSelect(undefined, true, this.anySelected);\r\n    }\r\n    unselectAll() {\r\n        // if (this._items) this._items.forEach(v => v.selected = false);\r\n        this.checkAll(false);\r\n        this.list.props.item.onSelect(undefined, false, this.anySelected);\r\n    }\r\n    /*\r\n    updateProps(nextProps:any) {\r\n        if (nextProps.selectedItems === this._selectedItems) return;\r\n        this.buildItems();\r\n    }\r\n    */\r\n    private get anySelected():boolean {return this._items.some(v => v.selected)}\r\n    private onSelect(item:SelectableItem, selected:boolean) {\r\n        item.selected = selected;\r\n        this.list.props.item.onSelect(item.item, selected, this.anySelected);\r\n    }\r\n    \r\n    get selectedItems():any[] {\r\n        return this._items.filter(v => v.selected === true).map(v => v.item);\r\n    }\r\n    /*\r\n    set selectedItems(value: any[]) {\r\n        if (value === undefined) return;\r\n        if (this._items === undefined) return;\r\n        let sLen = this._items.length;\r\n        let list = value.slice();\r\n        for (let n=0; n<sLen; n++) {\r\n            let sItem = this._items[n];\r\n            let len = list.length;\r\n            if (len === 0) break;\r\n            let item = sItem.item;\r\n            for (let i=0; i<len; i++) {\r\n                let v = list[i];\r\n                if (item === v) {\r\n                    sItem.selected = true;\r\n                    value.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        };\r\n    }\r\n    */\r\n    //w-100 mb-0 pl-3\r\n    //m-0 w-100\r\n    render = (item:SelectableItem, index:number):JSX.Element => {\r\n        let {key} = this.list.props.item;\r\n\t\treturn React.createElement(this.row, {item, index, key:key===undefined?index:key(item)});\r\n    }\r\n\r\n    private row = observer((props: {item:SelectableItem, index:number}):JSX.Element => {\r\n        let {item, index} = props;\r\n        let {className} = this.list.props.item;\r\n        let {labelId, selected, item:obItem} = item;\r\n        return <li className={classNames(className)}>\r\n            <div className=\"d-flex align-items-center px-3\">\r\n                <input ref={input=>{if (input) this.inputItems[labelId] = input;}}\r\n                    className=\"\" type=\"checkbox\" value=\"\" id={labelId}\r\n                    defaultChecked={selected}\r\n                    onChange={(e)=>{\r\n                        this.onSelect(item, e.target.checked)} \r\n                    }/>\r\n                <label className=\"\" style={{flex:1, marginBottom:0}} htmlFor={labelId}>\r\n                    {this.renderContent(obItem, index)}\r\n                </label>\r\n            </div>\r\n        </li>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport _ from 'lodash';\r\nimport {PageItems} from '../../tool/pageItems';\r\nimport {ListBase} from './base';\r\nimport {Clickable} from './clickable';\r\nimport {Static} from './static';\r\nimport {Selectable} from './selectable';\r\nimport '../../css/va-list.css';\r\nimport { IObservableArray } from 'mobx';\r\nimport { resLang } from '../../res/res';\r\nimport { ListRes, listRes } from '../../res';\r\n\r\ntype StaticRow = string|JSX.Element|(()=>string|JSX.Element);\r\ninterface ItemProps {\r\n\tclassName?: string|string[];\r\n\trender?: (item:any, index:number) => JSX.Element;\r\n\tonSelect?: (item:any, isSelected:boolean, anySelected:boolean)=>void;\r\n\tonClick?: (item:any)=>void;\r\n\tkey?: (item:any)=>string|number;\r\n}\r\n\r\nexport interface ListProps {\r\n    className?: string|string[];\r\n    items: any[] | IObservableArray<any> | PageItems<any>;\r\n    item: ItemProps;\r\n\tisItemSelected?: (item:any) => boolean;\r\n    compare?: (item:any, selectItem:any) => boolean;\r\n\tselectedItems?:any[];\r\n    header?: StaticRow;\r\n    footer?: StaticRow;\r\n    before?: StaticRow;\r\n    loading?: StaticRow;\r\n\tnone?: StaticRow;\r\n\tonFocus?: (evt: React.FocusEvent<HTMLUListElement>)=>void;\r\n}\r\n\r\n@observer\r\nexport class List extends React.Component<ListProps> {\r\n\tprivate static res:ListRes = resLang<ListRes>(listRes);\r\n\r\n\tprivate listBase: ListBase;\r\n\tprivate selectable: Selectable;\r\n    constructor(props:ListProps) {\r\n\t\tsuper(props);\r\n        this.buildBase();\r\n    }\r\n    _$scroll = (direct: 'top'|'bottom') => {\r\n        console.log('############### items scroll to ' + direct);\r\n    }\r\n    private buildBase() {\r\n        let {item} = this.props;\r\n        let {onClick, onSelect} = item;\r\n        if (onSelect !== undefined)\r\n            this.selectable = this.listBase = new Selectable(this);\r\n        else if (onClick !== undefined)\r\n            this.listBase = new Clickable(this);\r\n        else\r\n            this.listBase = new Static(this);\r\n\t}\r\n\tcomponentDidUpdate(prevProps: Readonly<ListProps>, prevState: Readonly<any>) {\r\n\t\tif (_.isEqual(this.props.item, prevProps.item) === false) {\r\n\t\t\tthis.buildBase();\r\n\t\t\tthis.forceUpdate();\r\n\t\t}\r\n\t}\r\n    componentWillUnmount() {\r\n        this.listBase.dispose();\r\n    }\r\n    selectAll() {\r\n        if (this.selectable) this.selectable.selectAll();\r\n    }\r\n    unselectAll() {\r\n        if (this.selectable) this.selectable.unselectAll();\r\n    }\r\n    get selectedItems():any[] {\r\n        return this.listBase.selectedItems;\r\n    }\r\n    render() {\r\n        let {className, header, footer, before, loading, none, onFocus} = this.props;\r\n        if (before === undefined) before = '-';\r\n        if (loading === undefined) loading = () => <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />;\r\n        if (none === undefined) none = List.res.none;\r\n        //this.listBase.selectedItems = selectedItems;\r\n        let {items, loading:isLoading} = this.listBase;\r\n        function staticRow(row:StaticRow, type:string) {\r\n            if (!row) return;\r\n            switch (typeof row) {\r\n                default:\r\n                case 'string': return <li className={\"va-list-\"+type}>{row}</li>;\r\n                case 'function': return <li className={\"va-list-\"+type}>{(row as ()=>string|JSX.Element)()}</li>;\r\n                case 'object': return <li>{row}</li>\r\n            } \r\n        }\r\n        let content:any, waitingMore:any;\r\n        if (items === null)\r\n            content = staticRow(before, 'before');\r\n        else if (items === undefined)\r\n            content = staticRow(loading, 'loading');\r\n        else if (items.length === 0)\r\n            content = staticRow(none, 'none');\r\n        else {\r\n            content = items.map((item, index) => {\r\n                return this.listBase.render(item, index);\r\n            });\r\n        }\r\n        if (isLoading === true && items) {\r\n            waitingMore = staticRow(loading, 'loading');\r\n\t\t}\r\n\t\tlet tabIndex:number;\r\n\t\tif (onFocus !== undefined) tabIndex = -1;\r\n        return <ul className={classNames('va-list', className)} onFocus={onFocus} tabIndex={tabIndex}>\r\n            {staticRow(header, 'header')}\r\n            {content}\r\n            {waitingMore}\r\n            {staticRow(footer, 'footer')}\r\n        </ul>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport className from 'classnames';\r\nimport {PropGridProps} from './PropGrid';\r\nimport {LabeledProp, StringProp, NumberProp, ListProp, ComponentProp} from './propView';\r\n\r\nexport abstract class PropRow {\r\n    setValues(values: any) {}\r\n    abstract render(key:string): any;\r\n}\r\n\r\nexport class PropBorder extends PropRow {\r\n    render(key:string): JSX.Element {\r\n        return <div key={'_b_' + key} className=\"\">\r\n            <div className=\"w-100\">\r\n                <div style={{borderTop: '1px solid #f0f0f0'}} />\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class PropGap extends PropRow {\r\n    private param: string;\r\n    constructor(param?: string) {\r\n        super();\r\n        this.param = param;\r\n    }\r\n    render(key:string): JSX.Element {\r\n        let w: string;\r\n        switch (this.param) {\r\n            default: w = 'py-2'; break;\r\n            case '=': w = 'py-1'; break;\r\n            case '-': w = 'pb-1'; break;\r\n        }\r\n        let cn = className(w);\r\n        return <div key={'_g_' + key} className={cn} />;\r\n    }\r\n}\r\n\r\nconst valueAlignStart = 'justify-content-start';\r\nconst valueAlignCenter = 'justify-content-center';\r\nconst valueAlignEnd = 'justify-content-end';\r\nexport abstract class LabeledPropRow extends PropRow {\r\n    protected gridProps: PropGridProps;\r\n    protected _prop: LabeledProp;\r\n    protected get prop():LabeledProp {return this._prop}\r\n    protected content: any;\r\n    protected col: string;\r\n    //protected values: any;\r\n    constructor(gridProps:PropGridProps, prop: LabeledProp) {\r\n        super();\r\n        this.gridProps = gridProps;\r\n        this._prop = prop;\r\n        this.col = gridProps.labelFixLeft === true? 'col' : 'col-sm';\r\n        //this.values = values;\r\n    }\r\n    render(key:string):any {\r\n        let {onClick, bk} = this.prop;\r\n        let cn = className({\r\n            \"cursor-pointer\": onClick !== undefined,\r\n            \"bg-white\": bk === undefined, \r\n            \"row\": true\r\n        });\r\n        return <div key={key} className={cn} onClick={onClick}>\r\n            {this.renderLabel()}\r\n            {this.renderProp()}\r\n        </div>;\r\n    }\r\n    protected renderLabel():any {\r\n        let {label} = this.prop;\r\n        if (label === undefined) return null;\r\n        return <label className={this.col + '-3 col-form-label'}>\r\n            {label}\r\n        </label>;\r\n    }\r\n    protected renderProp():any {\r\n        let {label} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string = this.col + (label===undefined? '-12':'-9');\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n    protected renderPropBody():any {\r\n        return <div className=\"form-control-plaintext\">\r\n            {this.renderPropContent()}\r\n        </div>;\r\n    }\r\n    protected renderPropContent():any {\r\n        return this.content;\r\n    }\r\n}\r\n\r\nexport class StringPropRow extends LabeledPropRow {\r\n    protected get prop(): StringProp {return this._prop as StringProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class NumberPropRow extends LabeledPropRow {\r\n    protected get prop(): NumberProp {return this._prop as NumberProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class ListPropRow extends LabeledPropRow {\r\n    protected get prop(): ListProp {return this._prop as ListProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else {\r\n            let list = this.prop.list;\r\n            if (typeof list === 'string') this.content = values[list];\r\n            else this.content = undefined;\r\n        }\r\n    }\r\n    protected renderPropBody() {\r\n        let {list, row} = this.prop;\r\n        let items:any[] = typeof list === 'string'? this.content : list;\r\n        if (items === undefined) return <div/>;\r\n        // new row(item)\r\n        return <div className=\"w-100\">\r\n            {\r\n                items.map((item, index) => <React.Fragment key={index}>\r\n                    {index===0? null: <div style={{width:'100%', borderBottom:'1px solid #f0f0f0'}} />}\r\n                    {React.createElement(row, item)}\r\n                </React.Fragment>)\r\n            }\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class ComponentPropRow extends LabeledPropRow {\r\n    protected get prop(): ComponentProp {return this._prop as ComponentProp;}\r\n    protected renderPropBody() {\r\n        let {component} = this.prop;\r\n        return component;\r\n    }\r\n    protected renderProp():any {\r\n        let {label, full} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string;\r\n        if (full !== true)\r\n            col = this.col + (label===undefined? '-12':'-9');\r\n        else\r\n            col = 'w-100';\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n}\r\n","import { PropGridProps } from './PropGrid';\r\nimport {\r\n    PropRow, PropBorder, PropGap, \r\n    StringPropRow, NumberPropRow, ListPropRow, ComponentPropRow\r\n} from './row';\r\n\r\nexport interface Format {\r\n\r\n}\r\n\r\nexport interface PropBase {\r\n    onClick?: () => void;\r\n}\r\n\r\nexport interface LabeledProp extends PropBase {\r\n    label?: string;\r\n    bk?: string;\r\n    vAlign?: 'top' | 'bottom' | 'center' | 'stretch';\r\n}\r\n\r\nexport interface StringProp extends LabeledProp {\r\n    type: 'string';\r\n    name: string;\r\n}\r\n\r\nexport interface NumberProp extends LabeledProp {\r\n    type: 'number';\r\n    name: string;\r\n}\r\n\r\nexport interface FormatProp extends LabeledProp {\r\n    type: 'format';\r\n    format: Format;\r\n}\r\n\r\nexport interface ListProp extends LabeledProp {\r\n    type: 'list';\r\n    list: string | any[];  // string 表示名字，否则就是值\r\n    row: new (props: any) => React.Component;\r\n}\r\n\r\nexport interface ComponentProp extends LabeledProp {\r\n    type: 'component';\r\n    full?: boolean;\r\n    component: any; //JSX.Element;\r\n}\r\n\r\nexport type Prop = StringProp | NumberProp | FormatProp | ListProp | ComponentProp | string;\r\n\r\nexport class PropView {\r\n    private gridProps: PropGridProps\r\n    private props: Prop[];\r\n    //private values:any;\r\n    private rows: PropRow[];\r\n\r\n    constructor(gridProps: PropGridProps, props: Prop[]) {\r\n        this.gridProps = gridProps;\r\n        this.props = props;\r\n        //this.values = values;\r\n        this.buildRows();\r\n    }\r\n\r\n    private buildRows() {\r\n        this.rows = [];\r\n        let isGap: boolean = true;\r\n        for (let prop of this.props) {\r\n            if (typeof prop === 'string') {\r\n                this.rows.push(new PropGap(prop));\r\n                isGap = true;\r\n            }\r\n            else {\r\n                if (!isGap) this.rows.push(new PropBorder());\r\n                let row;\r\n                switch (prop.type) {\r\n                    default: continue;\r\n                    case 'string': row = new StringPropRow(this.gridProps, prop); break;\r\n                    case 'number': row = new NumberPropRow(this.gridProps, prop); break;\r\n                    case 'list': row = new ListPropRow(this.gridProps, prop); break;\r\n                    case 'component': row = new ComponentPropRow(this.gridProps, prop); break;\r\n                }\r\n                this.rows.push(row);\r\n                isGap = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    setValues(values: any) {\r\n        for (let r of this.rows) r.setValues(values);\r\n    }\r\n\r\n    render() {\r\n        return this.rows.map((row, index) => row.render(String(index)));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, PropView} from './propView';\r\n\r\nexport interface PropGridProps {\r\n    className?: string;\r\n    rows: Prop[];\r\n    values: any;\r\n    alignValue?: 'left'|'center'|'right';\r\n    labelFixLeft?: boolean;\r\n}\r\n\r\n@observer\r\nexport class PropGrid extends React.Component<PropGridProps> {\r\n    render() {\r\n        let {className, rows, values} = this.props;\r\n        let propView = new PropView(this.props, rows);\r\n        propView.setValues(values);\r\n        let cn = classNames('container-fluid', className);\r\n        return <div className={cn}>\r\n            {propView.render()}\r\n        </div>;\r\n    }\r\n}\r\n","import { observable } from 'mobx';\r\nimport { isNumber } from 'util';\r\nimport _ from 'lodash';\r\nimport { LocalArr } from '../../tool';\r\nimport { BoxId } from './boxId';\r\nimport { TuidInner, TuidDiv } from './tuid';\r\n\r\nconst maxCacheSize = 1000;\r\n\r\nexport class IdCache {\r\n    private queue: number[] = [];               // 每次使用，都排到队头\r\n\tprivate cache = observable.map({}, {deep: false});    // 已经缓冲的\r\n\tprivate loading:boolean = false;\r\n\r\n    protected localArr:LocalArr;\r\n    protected waitingIds: number[] = [];          // 等待loading的\r\n    protected tuidInner: TuidInner;\r\n\r\n    constructor(tuidLocal: TuidInner) {\r\n        this.tuidInner = tuidLocal;\r\n        this.initLocalArr();\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    useId(id:number, defer?:boolean) {\r\n        if (!id) return;\r\n        if (isNumber(id) === false) return;\r\n        if (this.cache.has(id) === true) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n        this.tuidInner.cacheTuids(defer===true?70:20);\r\n        this.cache.set(id, id);\r\n        if (this.waitingIds.findIndex(v => v === id) >= 0) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n\r\n        if (this.queue.length >= maxCacheSize) {\r\n            // 缓冲已满，先去掉最不常用的\r\n            let r = this.queue.shift();\r\n            if (r === id) {\r\n                // 如果移除的，正好是现在用的，则插入\r\n                this.queue.push(r);\r\n                return;\r\n            }\r\n\r\n            //let rKey = String(r);\r\n            if (this.cache.has(r) === true) {\r\n                // 如果移除r已经缓存\r\n                this.cache.delete(r);\r\n            }\r\n            else {\r\n                // 如果移除r还没有缓存\r\n                let index = this.waitingIds.findIndex(v => v === r);\r\n                this.waitingIds.splice(index, 1);\r\n            }\r\n        }\r\n        this.waitingIds.push(id);\r\n        this.queue.push(id);\r\n        return;\r\n    }\r\n\r\n    private moveToHead(id:number) {\r\n        let index = this.queue.findIndex(v => v === id);\r\n        this.queue.splice(index, 1);\r\n        this.queue.push(id);\r\n    }\r\n\r\n    getValue(id:number) {\r\n        return this.cache.get(id);\r\n    }\r\n\r\n    remove(id:number) {\r\n        this.cache.delete(id);\r\n        let index = this.queue.findIndex(v => v === id);\r\n\t\tthis.queue.splice(index, 1);\r\n\t\tthis.localArr.removeItem(id);\r\n    }\r\n\r\n    valueFromId(id:number|BoxId):any {\r\n        let _id:number;\r\n        switch (typeof id) {\r\n            case 'object': _id = (id as BoxId).id; break;\r\n            case 'number': _id = id as number; break;\r\n            default: return;\r\n        }\r\n        return this.getValue(_id);\r\n    }\r\n\r\n    resetCache(id:number) {\r\n        this.remove(id);\r\n        this.useId(id);\r\n    }\r\n\r\n    cacheValue(val:any):boolean {\r\n        if (val === undefined) return false;\r\n        let id = this.getIdFromObj(val);\r\n        if (id === undefined) return false;\r\n        let index = this.waitingIds.findIndex(v => v === id);\r\n        if (index>=0) this.waitingIds.splice(index, 1);\r\n        this.cache.set(id, val);\r\n        return true;\r\n    }\r\n    protected getIdFromObj(val:any) {return this.tuidInner.getIdFromObj(val)}\r\n\r\n    async cacheIds():Promise<void> {\r\n        if (this.waitingIds.length === 0) return;\r\n\t\tlet tuidValues = await this.loadIds();\r\n\t\tif (tuidValues === undefined || tuidValues.length === 0) {\r\n\t\t\tthis.waitingIds.splice(0, this.waitingIds.length);\r\n\t\t\treturn;\r\n\t\t}\r\n        this.cacheIdValues(tuidValues);\r\n    }\r\n\r\n    private cacheIdValues(tuidValues: any[]) {\r\n        if (tuidValues === undefined) return;\r\n        let tuids = this.unpackTuidIds(tuidValues);\r\n        for (let tuidValue of tuids) {\r\n            if (this.cacheValue(tuidValue) === false) continue;\r\n            this.cacheTuidFieldValues(tuidValue);\r\n        }\r\n    }\r\n    async modifyIds(ids:any[]):Promise<void> {\r\n        let tuidValues:string[] = await this.loadTuidIdsOrLocal(ids);\r\n        let localedValues = tuidValues.filter(v => {\r\n            let p = v.indexOf('\\t');\r\n            if (p<0) p = v.length;\r\n            let id = Number(v.substr(0, p));\r\n            let val = this.localArr.getItem(id);\r\n            return (val !== undefined);\r\n        });\r\n        if (localedValues.length === 0) return;\r\n        this.cacheIdValues(localedValues);\r\n    }\r\n    protected divName:string = undefined;\r\n    protected async loadIds(): Promise<any[]> {\r\n\t\tif (this.loading === true) return;\r\n\t\tthis.loading = true;\r\n\t\tlet ret = await this.loadTuidIdsOrLocal(this.waitingIds);\r\n\t\tthis.loading = false;\r\n        return ret;\r\n    }\r\n    protected unpackTuidIds(values:string[]):any[] {\r\n        return this.tuidInner.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.tuidInner.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\r\n    async assureObj(id:number):Promise<void> {\r\n        let val = this.cache.get(id);\r\n        switch (typeof val) {\r\n            case 'object': return val;\r\n            case 'number': this.cache.set(id, id); break;\r\n        }\r\n        let ret = await this.loadTuidIdsOrLocal([id]);\r\n        this.cacheIdValues(ret);\r\n    }\r\n\r\n    private async loadTuidIdsOrLocal(ids:number[]):Promise<string[]> {\r\n        let ret:string[] = [];        \r\n        let netIds:number[] = [];\r\n        for (let id of ids) {\r\n            let value = this.localArr.getItem(id);\r\n            //if (value === undefined)\r\n            // 值不存在或者是空字符串，重新获取\r\n            if (!value)\r\n                netIds.push(id);\r\n            else\r\n                ret.push(value);\r\n        }\r\n        let len = netIds.length;\r\n        if (len > 0) {\r\n            let netRet = await this.tuidInner.loadTuidIds(this.divName, netIds);\r\n            for (let i=0; i<len; i++) {\r\n                //有些id可能没有内容，不会返回\r\n                //let id = netIds[i]; \r\n                let row:string = netRet[i];\r\n                if (!row) continue;\r\n                let p = row.indexOf('\\t');\r\n                if (p < 0) p = row.length;\r\n                let id = Number(row.substr(0, p));\r\n\t\t\t\t_.remove(netIds, v => v === id);\r\n                ret.push(row);\r\n                this.localArr.setItem(id, row);\r\n            }\r\n            len = netIds.length;\r\n            for (let i=0; i<len; i++) {\r\n                this.localArr.setItem(netIds[i], '');\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nexport class IdDivCache extends IdCache {\r\n    private div: TuidDiv;\r\n    protected divName:string;\r\n\r\n    constructor(tuidLocal:TuidInner, div: TuidDiv) {\r\n        super(tuidLocal);\r\n        this.div = div;\r\n        this.divName = div.name;\r\n        this.localArr = tuidLocal.cache.arr(tuidLocal.name + '.ids.' + this.divName);\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        // 这个不需要，必须去掉\r\n        // this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    protected getIdFromObj(val:any) {return this.div.getIdFromObj(val)}\r\n    protected unpackTuidIds(values:string[]):any[] {\r\n        return this.div.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.div.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\r\n    /*\r\n    async cacheIds():Promise<void> {\r\n        if (this.waitingIds.length === 0) return;\r\n        let tuidValues = await this.loadIds();\r\n        if (tuidValues !== undefined) {\r\n            let tuids = this.tuidLocal.unpackTuidIds(tuidValues);\r\n            for (let tuidValue of tuids) {\r\n                if (this.cacheValue(tuidValue) === false) continue;\r\n                this.tuidLocal.cacheTuidFieldValues(tuidValue);\r\n                this.afterCacheValue(tuidValue);\r\n            }\r\n        }\r\n    }\r\n    */\r\n}\r\n","import _ from 'lodash';\r\nimport { LocalArr } from '../../tool';\r\nimport { Entity } from '../entity';\r\nimport { UqMan, ArrFields, Field, SchemaFrom } from '../uqMan';\r\nimport { EntityCaller } from '../caller';\r\nimport { BoxId } from './boxId';\r\nimport { IdCache, IdDivCache } from './idCache';\r\n\r\nexport interface TuidSaveResult {\r\n    id: number;\r\n    inId: number;\r\n}\r\n\r\nexport interface TuidNOResult {\r\n\tdate: string;\r\n\tno: number;\r\n}\r\n\r\nexport abstract class UqTuid<M> extends Entity {\r\n    protected noCache: boolean;\r\n    readonly typeName:string = 'tuid';\r\n    protected idName: string;\r\n    cached: boolean;\r\n    unique: string[];\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {id} = schema;\r\n        this.idName = id;\r\n    }\r\n\r\n    buildTuidBox(): TuidBox {\r\n        return new TuidBox(this);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    stopCache():void {this.noCache = true}\r\n    abstract useId(id:number):void;\r\n    abstract boxId(id:number):BoxId;\r\n    abstract valueFromId(id:number):any;\r\n\tabstract resetCache(id:number|BoxId):void;\r\n\tabstract assureBox<T> (id:number|BoxId): Promise<T>;\r\n\tstatic idValue(id: {id:number}|number):number {\r\n\t\tswitch (typeof id) {\r\n\t\t\tdefault: debugger; throw new Error('unknown id');\r\n\t\t\tcase 'object': return id.id;\r\n\t\t\tcase 'number': return id;\r\n\t\t}\r\n\t}\r\n    static equ(id1:{id:number}|number, id2:{id:number}|number): boolean {\r\n        if (id1 === undefined || id1 === null) return false;\r\n\t\tif (id2 === undefined || id2 === null) return false;\r\n\t\treturn Tuid.idValue(id1) === Tuid.idValue(id2);\r\n\t\t/*\r\n        if (typeof id1 === 'object') {\r\n\t\t\tlet id1Id = id1.id;\r\n            return typeof id2 === 'object'? id1Id === id2.id : id1Id === id2;\r\n        }\r\n        if (typeof id2 === 'object') {\r\n\t\t\tlet id2Id = id2.id;\r\n            return typeof id1 === 'object'? id2Id === id1.id : id2Id === id1;\r\n        }\r\n\t\treturn id1 === id2;\r\n\t\t*/\r\n    }\r\n    cacheIds() {}\r\n    async modifyIds(ids:any[]) {}\r\n    isImport = false;\r\n    abstract get hasDiv():boolean;// {return this.divs!==undefined}\r\n    abstract div(name:string):TuidDiv;\r\n    abstract loadMain(id:number|BoxId):Promise<M>;\r\n\tabstract load(id:number|BoxId):Promise<M>;\r\n    abstract all():Promise<M[]>;\r\n\tabstract save(id:number, props:M):Promise<TuidSaveResult>;\r\n\tabstract saveProp(id:number, prop:string, value:any):Promise<void>;\r\n    abstract search(key:string, pageStart:string|number, pageSize:number):Promise<M[]>;\r\n    abstract searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any>;\r\n    abstract loadArr(arr:string, owner:number, id:number):Promise<any>;\r\n    abstract saveArr(arr:string, owner:number, id:number, props:any):Promise<void>;\r\n\tabstract posArr(arr:string, owner:number, id:number, order:number):Promise<void>;\r\n\tabstract no():Promise<TuidNOResult>;\r\n}\r\n\r\nexport abstract class Tuid extends UqTuid<any> {\r\n}\r\n\r\nexport class TuidInner extends Tuid {\r\n    private divs: {[div:string]: TuidDiv};\r\n    protected cacheFields: Field[];\r\n    protected idCache: IdCache;\r\n    protected localArr:LocalArr;\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        super(uq, name, typeId);\r\n        this.idCache = new IdCache(this);\r\n        this.localArr = this.cache.arr(this.name + '.whole');\r\n        if (uq.newVersion === true) this.localArr.removeAll();\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {arrs} = schema;\r\n        if (arrs !== undefined) {\r\n            this.divs = {};\r\n            for (let arr of arrs) {\r\n                let {name} = arr;\r\n                let tuidDiv = new TuidDiv(this.uq, this, name);\r\n                this.divs[name] = tuidDiv;\r\n                tuidDiv.setSchema(arr);\r\n                tuidDiv.buildFieldsTuid();\r\n            }\r\n        }\r\n    }\r\n    \r\n    useId(id:number, defer?:boolean) {\r\n        if (this.noCache === true) return;\r\n        if (!id) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n    boxId(id:number):BoxId {\r\n        if (!id) return;\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        let {createBoxId} = this.uq;\r\n        if (!createBoxId) return {id: id} as BoxId;\r\n        return createBoxId(this, id);\r\n    }\r\n    valueFromId(id:number) {return this.idCache.getValue(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tthis.idCache.resetCache(id);\r\n\t}\r\n    async assureBox<T> (id:number|BoxId):Promise<T> {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    cacheIds() {\r\n        this.idCache.cacheIds();\r\n        if (this.divs === undefined) return;\r\n        for (let i in this.divs) this.divs[i].cacheIds();\r\n    }\r\n    async modifyIds(ids:any[]) {\r\n        await this.idCache.modifyIds(ids);\r\n    }\r\n    cacheTuids(defer:number) {this.uq.cacheTuids(defer)}\r\n    get hasDiv():boolean {return this.divs!==undefined}\r\n    div(name:string):TuidDiv {\r\n        return this.divs && this.divs[name];\r\n    }\r\n    async loadTuidIds(divName:string, ids:number[]):Promise<any[]> {\r\n        let ret:any[] = await new IdsCaller(this, {divName:divName, ids:ids}, false).request();\r\n        if (ret.length > 0) this.cached = true;\r\n        return ret;\r\n    }\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        if (typeof id === 'object') id = id.id;\r\n        await this.idCache.assureObj(id);\r\n        return this.idCache.valueFromId(id);\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let cacheValue = this.idCache.valueFromId(id); \r\n        //if (typeof cacheValue === 'object') return cacheValue;\r\n        if (typeof id === 'object') id = id.id;\r\n        let valuesText = undefined; //this.localArr.getItem(id);\r\n        let values: any;\r\n        if (valuesText) {\r\n            values = JSON.parse(valuesText);\r\n        }\r\n        else {\r\n            values = await new GetCaller(this, id).request();\r\n            if (values !== undefined) {\r\n                // this.localArr.setItem(id, JSON.stringify(values));\r\n            }\r\n        }\r\n        if (values === undefined) return;\r\n        for (let f of this.schema.fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.uq.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            let n = f.name;\r\n            values[n] = t.boxId(values[n]);\r\n        }\r\n        this.idCache.cacheValue(values);\r\n        this.cacheTuidFieldValues(values);\r\n        return values;\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let {fields, arrs} = this.schema;\r\n        this.cacheFieldsInValue(values, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs as ArrFields[]) {\r\n                let {name, fields} = arr;\r\n                let arrValues = values[name];\r\n                if (arrValues === undefined) continue;\r\n                let tuidDiv = this.div(name);\r\n                for (let row of arrValues) {\r\n                    //row._$tuid = tuidDiv;\r\n                    //row.$owner = this.boxId(row.owner);\r\n                    tuidDiv.cacheValue(row);\r\n                    this.cacheFieldsInValue(row, fields);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields, $create, $update, stampOnMain} = this.schema;\r\n\t\tif (mainFields === undefined) debugger;\r\n\t\tthis.cacheFields = mainFields || this.fields;\r\n\t\tif (stampOnMain === true) {\r\n\t\t\tif ($create === true) this.cacheFields.push({name: '$create', type: 'timestamp', _tuid: undefined});\r\n\t\t\tif ($update === true) this.cacheFields.push({name: '$update', type: 'timestamp', _tuid: undefined});\r\n\t\t}\r\n        this.uq.buildFieldTuid(this.cacheFields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        let ret = await new SaveCaller(this, {id:id, props:props}).request();\r\n        if (id !== undefined) {\r\n            this.idCache.remove(id);\r\n            this.localArr.removeItem(id);\r\n        }\r\n        return ret;\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait new SavePropCaller(this, {id, prop, value}).request();\r\n\t\tthis.idCache.remove(id);\r\n\t\tawait this.idCache.assureObj(id);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        let ret: any[] = await new AllCaller(this, {}).request();\r\n        return ret;\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any[]> {\r\n        let ret:any[] = await this.searchArr(undefined, key, pageStart, pageSize);\r\n        return ret;\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        //let api = this.uqApi;\r\n        //let ret = await api.tuidSearch(this.name, undefined, owner, key, pageStart, pageSize);\r\n        let params:any = {arr:undefined, owner:owner, key:key, pageStart:pageStart, pageSize:pageSize};\r\n        let ret = await new SearchCaller(this, params).request();\r\n        let {fields} = this.schema;\r\n        for (let row of ret) {\r\n            this.cacheFieldsInValue(row, fields);\r\n        }\r\n        return ret;\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let api = this.uqApi;\r\n        //return await api.tuidArrGet(this.name, arr, owner, id);\r\n        return await new LoadArrCaller(this, {arr:arr, owner:owner, id:id}).request();\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any) {\r\n        //let params = _.clone(props);\r\n        //params[\"$id\"] = id;\r\n        //return await this.uqApi.tuidArrSave(this.name, arr, owner, params);\r\n        return await new SaveArrCaller(this, {arr:arr, owner:owner, id:id, props:props}).request();\r\n    }\r\n\r\n    async posArr(arr:string, owner:number, id:number, order:number) {\r\n        //return await this.uqApi.tuidArrPos(this.name, arr, owner, id, order);\r\n        return await new ArrPosCaller(this, {arr:arr, owner:owner, id:id, order:order}).request();\r\n\t}\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await new TuidNoCaller(this, undefined).request();\r\n\t}\r\n}\r\n\r\nabstract class TuidCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Tuid {return this._entity as Tuid};\r\n}\r\n\r\n// 包含main字段的load id\r\n// 当前为了兼容，先调用的包含所有字段的内容\r\nclass GetCaller extends TuidCaller<number> {\r\n    method = 'GET';\r\n    get path():string {return `tuid/${this.entity.name}/${this.params}`}\r\n}\r\n\r\nclass IdsCaller extends TuidCaller<{divName:string, ids:number[]}> {\r\n    get path():string {\r\n        let {divName} = this.params;\r\n        return `tuidids/${this.entity.name}/${divName !== undefined?divName:'$'}`;\r\n    }\r\n    buildParams():any {return this.params.ids}\r\n    xresult(res:any):any {\r\n        return (res as string).split('\\n');\r\n    }\r\n}\r\n\r\n\r\nclass SaveCaller extends TuidCaller<{id:number, props:any}> {\r\n    get path():string {return `tuid/${this.entity.name}`}\r\n    buildParams():any {\r\n        let {fields, arrs} = this.entity.schema;\r\n        let {id, props} = this.params;\r\n        let params:any = {$id: id};\r\n        this.transParams(params, props, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let arrName = arr.name;\r\n                let arrParams = [];\r\n                let arrFields = arr.fields;\r\n                let arrValues = props[arrName];\r\n                if (arrValues !== undefined) {\r\n                    for (let arrValue of arrValues) {\r\n                        let row = {};\r\n                        this.transParams(row, arrValue, arrFields);\r\n                        arrParams.push(row);\r\n                    }\r\n                }\r\n                params[arrName] = arrParams;\r\n            }\r\n        }\r\n        return params;\r\n    }\r\n    private transParams(values:any, params:any, fields:Field[]) {\r\n        if (params === undefined) return;\r\n        for (let field of fields) {\r\n            let {name, tuid, type} = field;\r\n            let val = params[name];\r\n            if (tuid !== undefined) {\r\n                if (typeof val === 'object') {\r\n                    if (val !== null) val = val.id;\r\n                }\r\n            }\r\n            else {\r\n                switch (type) {\r\n                    case 'date':\r\n                        val = this.entity.buildDateParam(val); \r\n                        //val = (val as string).replace('T', ' ');\r\n                        //val = (val as string).replace('Z', '');\r\n                        break;\r\n                    case 'datetime':\r\n                        val = this.entity.buildDateTimeParam(val);\r\n                        //val = new Date(val).toISOString();\r\n                        //val = (val as string).replace('T', ' ');\r\n                        //val = (val as string).replace('Z', '');\r\n                        break;\r\n                }\r\n            }\r\n            values[name] = val;\r\n        }\r\n    }\r\n}\r\n\r\nclass SearchCaller extends TuidCaller<{arr:string, owner:number, key:string, pageStart:string|number, pageSize:number}> {\r\n    get path():string {return `tuids/${this.entity.name}`}\r\n}\r\n\r\nclass AllCaller extends TuidCaller<{}> {\r\n    method = 'GET';\r\n    get path():string {return `tuid-all/${this.entity.name}`}\r\n}\r\n\r\nclass LoadArrCaller extends TuidCaller<{arr:string, owner:number, id:number}> {\r\n    method = 'GET';\r\n    get path():string {\r\n        let {arr, owner, id} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/${id}`;\r\n    }\r\n}\r\nclass SavePropCaller extends TuidCaller<{id:number, prop:string, value:any}> {\r\n    get path():string {return `tuid-prop/${this.entity.name}/`;}\r\n}\r\nclass SaveArrCaller extends TuidCaller<{arr:string, owner:number, id:number, props:any}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, props} = this.params;\r\n        let params = _.clone(props);\r\n        params['$id'] = id;\r\n        return params;\r\n    }\r\n}\r\nclass ArrPosCaller extends TuidCaller<{arr:string, owner:number, id:number, order:number}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr-pos/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, order} = this.params;\r\n        return { bid: id, $order: order}\r\n    }\r\n}\r\nclass TuidNoCaller extends TuidCaller<{}> {\r\n    get path():string {\r\n        return `tuid-no/${this.entity.name}/`;\r\n    }\r\n    buildParams():any {\r\n\t\tlet d = new Date();\r\n\t\tlet year = d.getFullYear();\r\n\t\tlet month = d.getMonth() + 1;\r\n\t\tlet date = d.getDate();\r\n        return {year, month, date};\r\n    }\r\n}\r\n\r\nexport class TuidImport extends Tuid {\r\n    private tuidLocal: TuidInner;\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number, from: SchemaFrom) {\r\n        super(uq, name, typeId);\r\n        this.from = from;\r\n    }\r\n\r\n    setFrom(tuidLocal: TuidInner) {this.tuidLocal = tuidLocal}\r\n    \r\n    readonly from: SchemaFrom;\r\n    isImport = true;\r\n\r\n    useId(id:number) {this.tuidLocal.useId(id);}\r\n    boxId(id:number):BoxId {return this.tuidLocal.boxId(id);}\r\n    valueFromId(id:number) {return this.tuidLocal.valueFromId(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tthis.tuidLocal.resetCache(id);\r\n\t}\r\n    async assureBox<T>(id:number):Promise<T> {\r\n        await this.tuidLocal.assureBox(id);\r\n\t\treturn this.tuidLocal.valueFromId(id);\r\n    }\r\n    get hasDiv():boolean {return this.tuidLocal.hasDiv}\r\n    div(name:string):TuidDiv {return this.tuidLocal.div(name)}\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        let ret = await this.tuidLocal.loadMain(id);\r\n        return ret;\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        return await this.tuidLocal.load(id);\r\n    }\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        return await this.tuidLocal.save(id, props);\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait this.tuidLocal.saveProp(id, prop, value);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        return await this.tuidLocal.all();\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.search(key, pageStart, pageSize);\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.searchArr(owner, key, pageStart, pageSize);\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        return await this.tuidLocal.loadArr(arr, owner, id);\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any):Promise<void> {\r\n        await this.tuidLocal.saveArr(arr, owner, id, props);\r\n    }\r\n    async posArr(arr:string, owner:number, id:number, order:number):Promise<void> {\r\n        await this.tuidLocal.posArr(arr, owner, id, order);\r\n    }\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await this.tuidLocal.no();\r\n\t}\r\n}\r\n\r\n// field._tuid 用这个接口\r\n// Tuid, TuidDiv 实现这个接口\r\nexport class TuidBox {\r\n    tuid: Tuid;\r\n    ownerField:Field = undefined;\r\n    constructor(tuid: Tuid) {\r\n        this.tuid = tuid;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.tuid.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.tuid.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.tuid.useId(id);\r\n    }\r\n    async showInfo() {\r\n        alert('showInfo not implemented');\r\n    }\r\n}\r\n\r\n\r\nexport class TuidDiv extends TuidInner /* Entity*/ {\r\n    readonly typeName:string = 'div';\r\n    protected cacheFields: Field[];\r\n    protected tuid: TuidInner;\r\n    protected idName: string;\r\n    protected idCache: IdDivCache;\r\n\r\n    //ui: React.StatelessComponent<any>;\r\n    //res: any;\r\n\r\n    constructor(uq: UqMan, tuid: TuidInner, name: string) {\r\n        super(uq, name, 0);\r\n        this.tuid = tuid;\r\n        this.idName = 'id';\r\n        this.idCache = new IdDivCache(tuid, this);\r\n    }\r\n\r\n    get owner() {return this.tuid}\r\n\r\n    /*\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.buildFieldsTuid();\r\n    }*/\r\n\r\n    /*\r\n    setUIRes(ui:any, res:any) {\r\n        this.ui = ui && ui.content;\r\n        this.res = res;\r\n    }\r\n    */\r\n\r\n    buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields} = this.schema;\r\n        if (mainFields === undefined) debugger;\r\n        this.uq.buildFieldTuid(this.cacheFields = mainFields);\r\n    }\r\n\r\n    buildTuidDivBox(ownerField: Field): TuidBoxDiv {\r\n        return new TuidBoxDiv(this.tuid, this, ownerField);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    cacheValue(value:any):void {\r\n        this.idCache.cacheValue(value);\r\n    }\r\n\r\n    useId(id:number, defer?:boolean):void {\r\n        if (this.noCache === true) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n\r\n    /*\r\n    boxId(id:number):BoxId {\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        //return new BoxDivId(this.tuid, this, id);\r\n        return this.tuid.boxDivId(this, id);\r\n    }\r\n    */\r\n    valueFromId(id:number):any {\r\n        return this.idCache.getValue(id)\r\n    }\r\n\r\n    async assureBox<T>(id:number):Promise<T> {\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    async cacheIds() {\r\n        await this.idCache.cacheIds();\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let fields = this.schema.fields;\r\n        this.cacheFieldsInValue(values, fields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n}\r\n\r\nexport class TuidBoxDiv extends TuidBox {\r\n    ownerField: Field;\r\n    private div: TuidDiv;\r\n    constructor(tuid: Tuid, div: TuidDiv, ownerField: Field) {\r\n        super(tuid);\r\n        this.div = div;\r\n        this.ownerField = ownerField;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.div.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.div.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.div.useId(id);\r\n    }\r\n}\r\n","import {appInFrame, CenterApiBase} from 'tonva';\r\n\r\nclass MainApi extends CenterApiBase {\r\n    async userAppUnits(app:number):Promise<any[]> {\r\n        return await this.get('tie/user-app-units', {app:app});\r\n    }\r\n    async stickies():Promise<any[]> {\r\n        return await this.get('sticky/list', {start:0, pageSize:30});\r\n    }\r\n\r\n    async ties():Promise<any[]> {\r\n        return await this.get('tie/list', {start:0, pageSize:30});\r\n    }\r\n\r\n    async apps(unit:number):Promise<any> {\r\n        return await this.get('tie/apps', {unit:unit});\r\n    }\r\n\r\n    async appApi(unit:number, app:number, apiName:string) {\r\n        return await this.get('tie/app-api', {unit:unit, app:app, apiName:apiName});\r\n    }\r\n\r\n    async userId(name:string):Promise<number> {\r\n        return await this.get('tie/user-id', {name:name});\r\n    }\r\n\r\n    async user(id:number):Promise<any> {\r\n        return await this.get('tie/user', {id:id});\r\n    }\r\n\r\n    async userUnitAdmins():Promise<any[]> {\r\n        return await this.get('tie/user-admin-units', {});\r\n    }\r\n\r\n    async sendMessage(toUser:number, type:string, content:any) {\r\n        let {unit} = appInFrame;\r\n        let adminApp = 0;\r\n        return await this.post('tie/send-message', {\r\n            type: type, \r\n            fromUnit: unit, \r\n            fromApp: adminApp,\r\n            toUser: toUser, \r\n            content: content, \r\n        });\r\n    }\r\n\r\n    async unit(unit:number):Promise<any> {\r\n        return await this.get('unit/', {unit:unit});\r\n    }\r\n\r\n    async unitMemberCount(unit:number):Promise<number> {\r\n        return await this.get('unit/member-count', {unit:unit});\r\n    }\r\n\r\n    async unitAdmins(unit:number):Promise<any[]> {\r\n        return await this.get('unit/admins', {unit:unit});\r\n    }\r\n\r\n    async unitAppAdmins(unit:number, app:number):Promise<any[]> {\r\n        return await this.get('unit/app-admins', {unit:unit, app:app});\r\n    }\r\n\r\n    async unitSetAdmin(fellow:number, unit:number, isOwner:number, isAdmin:number, isDev:number):Promise<any> {\r\n        return await this.post('unit/set-admin', {fellow:fellow, unit:unit, isOwner:isOwner, isAdmin:isAdmin, isDev:isDev});\r\n    }\r\n\r\n    async unitAddAdmin(user:string, unit:number, isOwner:number, isAdmin:number, isDev:number):Promise<any> {\r\n        return await this.post('unit/add-admin', {user:user, unit:unit, isOwner:isOwner, isAdmin:isAdmin, isDev});\r\n    }\r\n\r\n    async unitDelAdmin(unit:number, user:number):Promise<any> {\r\n        return await this.post('unit/del-admin', {user:user, unit:unit});\r\n    }\r\n\r\n    async adminDevs(unit:number):Promise<any[][]> {\r\n        return await this.get('unit/admin-devs', {unit:unit});\r\n    }\r\n\r\n    async addDev(unit:number, dev:string):Promise<any> {\r\n        return await this.post('unit/add-dev', {unit:unit, dev:dev})\r\n    }\r\n\r\n    async delDev(unit:number, dev:number):Promise<string> {\r\n        return await this.post('unit/del-dev', {unit:unit, dev:dev})\r\n    }\r\n\r\n    async unitApps(unit:number):Promise<any[]> {\r\n        return await this.get('unit/apps', {unit:unit});\r\n    }\r\n\r\n    async unitAddApp(unit:number, app:number):Promise<number> {\r\n        let ret = await this.post('unit/add-app', {unit:unit, app:app});\r\n        return ret;\r\n    }\r\n\r\n    async unitDeleteApp(unit:number, app:number, deleted:number):Promise<void> {\r\n        await this.post('unit/delete-app', {unit:unit, app:app, deleted:deleted});\r\n    }\r\n\r\n    async unitChangeProp(unit:number, prop:string, value:any):Promise<void> {\r\n        await this.post('unit/change-prop', {unit:unit, prop:prop, value:value});\r\n    }\r\n\r\n    async searchApp(unit:number, key:string, pageStart:any, pageSize:number):Promise<any[]> {\r\n        return await this.get('unit/search-app', {unit:unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n\r\n    async unitRoles(unit:number):Promise<any[]> {\r\n        return await this.get('unit/roles', {unit:unit});\r\n    }\r\n\r\n    async unitAddRole(unit:number, name:string, discription:string):Promise<number> {\r\n        return await this.post('unit/add-role', {unit:unit, name:name, discription:discription});\r\n    }\r\n\r\n    async unitRoleChangeProp(unit:number, role:number, prop:string, value:any):Promise<void> {\r\n        await this.post('unit/change-role-prop', {unit:unit, role:role, prop:prop, value:value});\r\n    }\r\n\r\n    async unitRoleApps(unit:number, role:number):Promise<any[]> {\r\n        return await this.get('unit/role-apps', {unit:unit, role:role});\r\n    }\r\n\r\n    async unitRoleSetApps(unit:number, role:number, apps:number[]):Promise<void> {\r\n        await this.post('unit/role-set-apps', {unit:unit, role:role, apps:apps});\r\n    }\r\n\r\n    async unitMembers(unit:number, role:number, key:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        return await this.get('unit/members', {unit:unit, role:role, key, pageStart, pageSize});\r\n    }\r\n\r\n    async unitAssignMember(unit:number, member:number, assigned:string):Promise<void> {\r\n        await this.post('unit/assign-member', {unit:unit, member:member, assigned:assigned});\r\n    }\r\n\r\n    async unitMemberRoles(unit:number, member:number):Promise<any[]> {\r\n        return await this.get('unit/member-roles', {unit:unit, member:member});\r\n    }\r\n\r\n    async unitSetMemberRoles(unit:number, member:number, roles:number[]):Promise<void> {\r\n        await this.post('unit/member-set-roles', {unit:unit, member:member, roles:roles});\r\n    }\r\n\r\n    async unitUsers(unit:number, key:string, pageStart:number, pageSize:number):Promise<any> {\r\n        return await this.get('unit/users', {unit: unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async unitAppUsers(unit:number, key:string, pageStart:number, pageSize:number):Promise<any> {\r\n        return await this.get('unit/app-users', {unit: unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async unitOneAppUsers(unit:number, app:number, pageStart:number, pageSize:number):Promise<any[]> {\r\n        return await this.get('unit/one-app-users', {unit: unit, app:app, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async unitOneUserApps(unit:number, user:number, pageStart:number, pageSize:number):Promise<any[]> {\r\n        return await this.get('unit/one-user-apps', {unit: unit, user:user, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async unitAppEditUsers(unit:number, app:number, key:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        return await this.get('unit/app-edit-users', {unit: unit, app:app, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async unitUserEditApps(unit:number, user:number, key:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        return await this.get('unit/user-edit-apps', {unit: unit, user:user, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async bindAppUser(unit:number, app:number, user:number, bind:number):Promise<void> {\r\n        await this.post('unit/bind-app-user', {unit: unit, app:app, user:user, bind:bind});\r\n    }\r\n\r\n    async userFromKey(key:string):Promise<any> {\r\n        return await this.get('tie/user-from-key', {key:key});\r\n    }\r\n    async unitAddUser(unit:number, user:number) {\r\n        await this.post('unit/add-user', {unit:unit, user:user});\r\n    }\r\n\r\n    async setAppAdmin(unit:number, app:number, user:number, name:string, isAdmin:number):Promise<any> {\r\n        return await this.post('unit/set-app-admin', {unit:unit, app:app, user:user, name:name, isAdmin:isAdmin});\r\n    }\r\n\r\n    async setAppRoles(unit:number, app:number, user:number, name:string, roles:number):Promise<any> {\r\n        return await this.post('unit/set-app-roles', {unit:unit, app:app, user:user, name:name, roles:roles});\r\n    }\r\n}\r\n\r\nexport const mainApi = new MainApi('tv/', true);\r\n","import {CenterApiBase} from 'tonva';\r\n\r\nclass DevApi extends CenterApiBase {\r\n    async userAppUnits(app:number):Promise<any[]> {\r\n        return await this.get('tie/user-app-units', {app:app});\r\n    }\r\n    async uqBuilderUrl():Promise<any> {\r\n        let ret = await this.get('uq-builder-url', undefined);\r\n        return ret;\r\n    }    \r\n    async counts(unit:number):Promise<any> {\r\n        return await this.get('counts', {unit:unit});\r\n    }\r\n    async app(id:number):Promise<any> {\r\n        return await this.get('app', {id:id});\r\n    }\r\n    async bus(id:number):Promise<any> {\r\n        let ret = await this.get('bus', {id:id});\r\n\t\tlet {schema, source} = ret;\r\n\t\tif (!source) ret.source = schema;\r\n\t\treturn ret;\r\n    }\r\n    async uq(id:number):Promise<any> {\r\n        return await this.get('uq', {id:id});\r\n    }\r\n    async server(id:number):Promise<any> {\r\n        return await this.get('server', {id:id});\r\n    }\r\n    async apps(unit:number, pageSize:number=30):Promise<any[]> {\r\n        return await this.get('apps', {unit:unit, pageSize: pageSize});\r\n    }\r\n    async uqs(unit:number, pageSize:number=30):Promise<any[]> {\r\n        return await this.get('uqs', {unit, pageSize});\r\n    }\r\n    async unitUQs(unit:number, pageSize:number=30):Promise<any[]> {\r\n        return await this.get('unit-uqs', {unit, pageSize});\r\n    }\r\n    async buses(unit:number, pageSize:number=30):Promise<any[]> {\r\n        return await this.get('buses', {unit:unit, pageSize: pageSize});\r\n    }\r\n    async servers(unit:number, pageSize:number=30):Promise<any[]> {\r\n        return await this.get('servers', {unit:unit, pageSize: pageSize});\r\n    }\r\n    async services(unit:number, pageSize:number=30):Promise<any[]> {\r\n        return await this.get('services', {unit:unit, pageSize: pageSize});\r\n    }\r\n    async saveApp(values:any):Promise<number> {\r\n        return await this.post('app-save', values);\r\n    }\r\n    async saveUq(values:any):Promise<number> {\r\n        return await this.post('uq-save', values);\r\n    }\r\n    async saveBus(values:any):Promise<number> {\r\n        return await this.post('bus-save', values);\r\n    }\r\n    async saveServer(values:any):Promise<number> {\r\n        return await this.post('server-save', values);\r\n    }\r\n    async saveService(values:any):Promise<number> {\r\n        return await this.post('service-save', values);\r\n    }\r\n    async delApp(unit:number,id:number):Promise<void> {\r\n        return await this.post('app-del', {unit:unit, id:id});\r\n    }\r\n    async delUq(unit:number,id:number):Promise<void> {\r\n        return await this.post('uq-del', {unit:unit, id:id});\r\n    }\r\n    async delBus(unit:number,id:number):Promise<void> {\r\n        return await this.post('bus-del', {unit:unit, id:id});\r\n    }\r\n    async delServer(unit:number,id:number):Promise<void> {\r\n        return await this.post('server-del', {unit:unit, id:id});\r\n    }\r\n    async delUqdb(unit:number,id:number):Promise<void> {\r\n        return await this.post('uqdb-del', {unit:unit, id:id});\r\n    }\r\n    async delService(unit:number,id:number):Promise<void> {\r\n        return await this.post('service-del', {unit:unit, id:id});\r\n    }\r\n    async loadAppUqs(app:number):Promise<any[]> {\r\n        return await this.get('app-uqs', {app: app});\r\n    }\r\n    async appBindUq(unit:number,app:number,uqs:number[]):Promise<void> {\r\n        let uqsText = uqs.join(';');\r\n        await this.post('app-bind-uq', {unit:unit, app:app, uqs:uqsText});\r\n    }\r\n    async appSetUqMain(unit:number, app:number, uq:number): Promise<void> {\r\n        await this.post('app-set-uq-main', {unit:unit, app:app, uq:uq});\r\n    }\r\n    async searchUq(unit:number,key:string,pageStart:number,pageSize:number):Promise<any[]> {\r\n        return await this.get('uq-search', {unit:unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async getMyUqs(unit:number):Promise<any[]> {\r\n        return await this.get('my-uqs', {unit:unit});\r\n    }\r\n    async searchApp(unit:number,key:string,pageStart:number,pageSize:number):Promise<any[]> {\r\n        return await this.get('app-search', {unit:unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async searchServer(unit:number,key:string,pageStart:number,pageSize:number):Promise<any[]> {\r\n        return await this.get('server-search', {unit:unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async searchUqdb(unit:number,key:string,pageStart:number,pageSize:number):Promise<any[]> {\r\n        return await this.get('uqdb-search', {unit:unit, key:key, pageStart:pageStart, pageSize:pageSize});\r\n    }\r\n    async loadUqServices(unit:number, uq:number):Promise<any[]> {\r\n        return await this.get('uq-services', {unit:unit, uq:uq});\r\n    }\r\n    async changeServiceProp(unit:number, service:number, prop:string, value:any):Promise<number> {\r\n        return await this.post('service-change-prop', {unit:unit, service:service, prop:prop, value:value});\r\n    }\r\n    async uqGetEntities(unit:number, uq:number):Promise<any[][]> {\r\n        return await this.get('uq-get-entities', {unit:unit, uq:uq});\r\n    }\r\n    async adminDevAdd(param: {unit:number, type:string, dev:number, devUser:number}):Promise<void> {\r\n        await this.post('admin-dev-add', param);\r\n    }\r\n    async adminDevDel(param: {unit:number, type:string, dev:number, devUser:number}):Promise<void> {\r\n        await this.post('admin-dev-del', param);\r\n    }\r\n}\r\n\r\nexport const devApi = new DevApi('tv/dev/', true);\r\n","import {CacheIds, User} from 'tonva';\r\nimport {Unit, DevUQ, DevApp, DevBus, DevServer} from '../model';\r\nimport {mainApi, devApi} from '../api';\r\n\r\nclass CacheUnits extends CacheIds<Unit> {\r\n    protected async _loadIds(ids:number[]):Promise<Unit[]> {\r\n        return;\r\n    }\r\n    protected async _loadId(id:number):Promise<Unit> {\r\n        return await mainApi.unit(id);\r\n    }\r\n}\r\n\r\nclass CacheUqs extends CacheIds<DevUQ> {\r\n    protected async _loadIds(ids:number[]):Promise<DevUQ[]> {\r\n        return;\r\n    }\r\n    protected async _loadId(id:number):Promise<DevUQ> {\r\n        return await devApi.uq(id);\r\n    }\r\n}\r\n\r\nclass CacheApps extends CacheIds<DevApp> {\r\n    protected async _loadIds(ids:number[]):Promise<DevApp[]> {\r\n        return;\r\n    }\r\n    protected async _loadId(id:number):Promise<DevApp> {\r\n        return await devApi.app(id);\r\n    }\r\n}\r\n\r\nclass CacheBuses extends CacheIds<DevBus> {\r\n    protected async _loadIds(ids:number[]):Promise<DevBus[]> {\r\n        return;\r\n    }\r\n    protected async _loadId(id:number):Promise<DevBus> {\r\n        let ret = await devApi.bus(id);\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass CacheUsers extends CacheIds<User> {\r\n    protected async _loadIds(ids:number[]):Promise<User[]> {\r\n        return;\r\n    }\r\n    protected async _loadId(id:number):Promise<User> {\r\n        let ret = await mainApi.user(id);\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass CacheServers extends CacheIds<DevServer> {\r\n    protected async _loadIds(ids:number[]):Promise<DevServer[]> {\r\n        return;\r\n    }\r\n    protected async _loadId(id:number):Promise<DevServer> {\r\n        return await devApi.server(id);\r\n    }\r\n}\r\n\r\nclass Caches {\r\n    units: CacheUnits;\r\n    uqs: CacheUqs;\r\n    apps: CacheApps;\r\n    buses: CacheBuses;\r\n    servers: CacheServers;\r\n    users: CacheUsers;\r\n\r\n    constructor() {\r\n        this.reset();\r\n    }\r\n\r\n    reset() {\r\n        this.units = new CacheUnits();\r\n        this.uqs = new CacheUqs();\r\n        this.apps = new CacheApps();\r\n        this.buses = new CacheBuses();\r\n        this.servers = new CacheServers();\r\n        this.users = new CacheUsers();\r\n    }\r\n};\r\n\r\nexport const caches:Caches = new Caches();\r\n","import { observable } from 'mobx';\r\nimport _ from 'lodash';\r\nimport { devApi } from '../api';\r\nimport { Store } from './store';\r\nimport { DevObjBase, DevApp, DevUQ, DevBus, DevServer, DevService } from 'model';\r\n\r\ninterface Counts {\r\n    uq: number;\r\n    app: number;\r\n    bus: number;\r\n    server: number;\r\n    service: number;\r\n    //uqdb: number;\r\n}\r\n\r\nexport abstract class ObjItems<T extends DevObjBase> {\r\n    protected store: Store;\r\n    protected dev: Dev;\r\n    constructor(store: Store, dev: Dev) {\r\n        this.store = store;\r\n        this.dev = dev;\r\n    }\r\n\r\n    @observable items: T[] = undefined;\r\n    @observable cur: T = undefined;\r\n\r\n    async load(): Promise<void> {\r\n        let ret = await this._load();\r\n        this.items = ret;\r\n    }\r\n    protected abstract _load(): Promise<T[]>;\r\n    async saveCur(item: T): Promise<boolean> {\r\n        let values: any = {};\r\n        if (this.cur !== undefined) {\r\n            _.assign(values, this.cur, item);\r\n        }\r\n        else {\r\n            _.assign(values, item);\r\n        }\r\n\r\n        values.unit = item.unit = this.store.unit.id;\r\n        let id = await this._save(values);\r\n        if (this.cur === undefined) {\r\n            if (id === 0) return false;\r\n            values.id = id;\r\n            if (this.items !== undefined) this.items.unshift(values);\r\n            this._inc();\r\n            this.cur = observable(values);\r\n        }\r\n        else {\r\n            _.assign(this.cur, values);\r\n        }\r\n        return true;\r\n    }\r\n    async check(item: T): Promise<boolean> {\r\n        return true;\r\n    }\r\n    async save(item: T): Promise<T> {\r\n        let values: any = {};\r\n        _.assign(values, item);\r\n\r\n        values.unit = item.unit = this.store.unit.id;\r\n        let id = await this._save(values);\r\n        if (id === 0) return;\r\n        values.id = id;\r\n        return values;\r\n    }\r\n    protected abstract _save(item: T): Promise<number>;\r\n    async del(): Promise<void> {\r\n        let c = this.cur;\r\n        if (c === undefined) return;\r\n        let id = c.id;\r\n        await this._del(c);\r\n        if (this.items === undefined) return;\r\n        let index = this.items.findIndex(v => v.id === id);\r\n        if (index >= 0) {\r\n            this.items.splice(index, 1);\r\n            this._dec();\r\n        }\r\n    }\r\n    protected abstract _del(item: T): Promise<void>;\r\n    protected abstract _inc();\r\n    protected abstract _dec();\r\n}\r\n\r\nclass Apps extends ObjItems<DevApp> {\r\n    @observable uqs: DevUQ[] = undefined;\r\n    @observable searchedUqs: DevUQ[] = undefined;\r\n    //@observable service: Service = null;\r\n    protected async _load() {\r\n        return await devApi.apps(this.store.unit.id);\r\n    }\r\n    protected async _save(item: DevApp): Promise<number> {\r\n        return await devApi.saveApp(item);\r\n    }\r\n    protected async _del(item: DevApp): Promise<void> {\r\n        await devApi.delApp(this.store.unit.id, item.id);\r\n    }\r\n    protected _inc() { this.dev.counts.app++; }\r\n    protected _dec() { this.dev.counts.app--; }\r\n\r\n    public async loadCurUqs() {\r\n        let ret = await devApi.loadAppUqs(this.cur.id);\r\n        this.uqs = ret;\r\n    }\r\n    public async searchUq(key: string) {\r\n        this.searchedUqs = await devApi.searchUq(this.store.unit.id, key, 0, searchPageSize);\r\n    }\r\n    /*\r\n    public async appBindUq(uqIds:number[]) {\r\n        let allUqs:{id:number}[] = this.uqs.map(v => {return {id: v.id};});\r\n        for (let id of uqIds) {\r\n            let index = allUqs.findIndex(v => v.id === id);\r\n            if (index < 0) allUqs.unshift({id: id});\r\n        }\r\n        await devApi.appBindUq(this.store.unit.id, this.cur.id, allUqs);\r\n        for (let id of uqIds) {\r\n            let index = this.uqs.findIndex(a => a.id === id);\r\n            if (index>=0) this.uqs.splice(index, 1);\r\n            if (this.searchedUqs !== undefined) {\r\n                let find = this.searchedUqs.find(a => a.id === id);\r\n                if (find !== undefined) this.uqs.unshift(find);\r\n            }\r\n        }\r\n    }\r\n    async appRemoveUq(removeUqIds:number[]):Promise<void> {\r\n        let uqs:{id:number}[] = [];\r\n        for (let uq of this.uqs) {\r\n            if (removeUqIds.findIndex(v => v === uq.id)>=0) continue;\r\n            uqs.push({id: uq.id});\r\n        }\r\n        await devApi.appBindUq(this.store.unit.id, this.cur.id, uqs);\r\n        for (let removeUqId of removeUqIds) {\r\n            let index = this.uqs.findIndex((v:UQ) => v.id === removeUqId);\r\n            if (index < 0) continue;\r\n            this.uqs.splice(index, 1);\r\n        };\r\n    }\r\n    */\r\n}\r\n\r\nclass Uqs extends ObjItems<DevUQ> {\r\n    protected async _load() {\r\n        let ret = await devApi.uqs(this.store.unit.id);\r\n        return ret;\r\n    }\r\n    protected async _save(item: DevUQ): Promise<number> {\r\n        //let {access} = item;\r\n        //if (!access) access = \"*';\r\n        //let parts = access.split(',').map(v => v.trim()).filter(v => v!=='');\r\n        //item.access = parts.join(',');\r\n        return await devApi.saveUq(item);\r\n    }\r\n    protected async _del(item: DevUQ): Promise<void> {\r\n        await devApi.delUq(this.store.unit.id, item.id);\r\n    }\r\n    protected _inc() { this.dev.counts.uq++; }\r\n    protected _dec() { this.dev.counts.uq--; }\r\n}\r\n\r\nclass Buses extends ObjItems<DevBus> {\r\n    protected async _load() {\r\n        let ret = await devApi.buses(this.store.unit.id);\r\n        for (let item of ret) {\r\n            let { schema, source } = item;\r\n            if (!source) item.source = schema;\r\n        }\r\n        return ret;\r\n    }\r\n    protected async _save(item: DevBus): Promise<number> {\r\n        return await devApi.saveBus(item);\r\n    }\r\n    protected async _del(item: DevBus): Promise<void> {\r\n        await devApi.delBus(this.store.unit.id, item.id);\r\n    }\r\n    protected _inc() { this.dev.counts.bus++; }\r\n    protected _dec() { this.dev.counts.bus--; }\r\n    private checkBusName(item: DevBus, busName: string): boolean {\r\n        let parts = busName.split('/');\r\n        switch (parts.length) {\r\n            default:\r\n                alert(`'${busName}'不符合bus名称的格式: 所有者/名称`);\r\n                return false;\r\n            case 1:\r\n                if (parts[0].toLowerCase() !== item.name) {\r\n                    alert(`$prop '${busName}' in schema 应该跟名称一致`);\r\n                    return false;\r\n                }\r\n                break;\r\n            case 2:\r\n                if (parts[0].toLowerCase() !== this.store.unit.name.toLowerCase()\r\n                    || parts[1].toLowerCase() !== item.name.toLowerCase()) {\r\n                    alert(`$prop '${busName}' in schema 应该跟 所有者/名称 一致`);\r\n                    return false;\r\n                }\r\n                break;\r\n        }\r\n        return true;\r\n    }\r\n    async check(item: DevBus): Promise<boolean> {\r\n        let { source } = item;\r\n        try {\r\n            let bus = JSON.parse(source);\r\n            for (let i in bus) {\r\n                let face = bus[i];\r\n                if (face === null || face === undefined) {\r\n                    alert(`face ${i} is null，请设置内容`);\r\n                    return false;\r\n                }\r\n                switch (typeof face) {\r\n                    case 'object': break;\r\n                    case 'string':\r\n                        if (i === '$') {\r\n                            if (this.checkBusName(item, face) === false) return false;\r\n                        }\r\n                        delete bus[i];\r\n                        continue;\r\n                    default:\r\n                        delete bus[i];\r\n                        continue;\r\n                    /*\r\n                    case 'function':\r\n                        alert(`face ${i} is function，不接受function`);\r\n                        return false;\r\n                    //case 'bigint':\r\n                    case 'boolean':\r\n                    case 'number':\r\n                        alert(`face ${i} 应该是数组或者对象`);\r\n                        return false;\r\n                    */\r\n                }\r\n                if (Array.isArray(face) === true) {\r\n                    if (checkBusFace(face, bus) === false) return false;\r\n                }\r\n                else {\r\n                    if (checkBusQuery(face, bus) === false) return false;\r\n                }\r\n            }\r\n            for (let i in bus) {\r\n                let face = bus[i];\r\n                if (!face) continue;\r\n                if (faceReplaceStringWithFace(face, bus, []) === false) {\r\n                    alert(`face ${i} 包含了循环引用`);\r\n                    return false;\r\n                };\r\n            }\r\n            item.schema = JSON.stringify(bus);\r\n            if (!item.owner) {\r\n                item.owner = this.store.unit.name;\r\n            }\r\n            return true;\r\n        }\r\n        catch (err) {\r\n            alert((err as any).message);\r\n            return false;\r\n        }\r\n    }\r\n}\r\n\r\nconst paramTypes = ['id', 'number', 'string'];\r\nconst busTypes = [...paramTypes, 'array'];\r\nfunction refNameOk(faceName: string, bus: any): boolean {\r\n    let face = bus[faceName];\r\n    if (face === undefined) {\r\n        alert(`face ${faceName} not defined`);\r\n        return false;\r\n    }\r\n    if (Array.isArray(face) === false) {\r\n        alert(`face ${faceName} is referenced, bus is not array`);\r\n        return false;\r\n    }\r\n    return true;\r\n    //return refArrayOk(face as any[], bus);\r\n}\r\n\r\nfunction refArrayOk(items: any[], bus: any): boolean {\r\n    for (let item of items) {\r\n        let type: string;\r\n        if (typeof item === 'string') {\r\n            let pos = item.indexOf(':');\r\n            if (pos <= 0) {\r\n                alert('type is not defined');\r\n                return false;\r\n            }\r\n            type = item.substr(pos + 1).trim();\r\n        }\r\n        else {\r\n            type = item.type;\r\n        }\r\n        if (['id', 'string', 'number', 'array'].indexOf(type) < 0) {\r\n            alert(`type ${type} out of ['id', 'string', 'number', 'array']`);\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction faceReplaceStringWithFace(face: any[], bus: any, arr: any[]): boolean {\r\n    let len = face.length;\r\n    let hasFaceReplace: boolean = false;\r\n    let newFace = [];\r\n    for (let i = 0; i < len; i++) {\r\n        let field = face[i];\r\n        if (typeof field !== 'string') {\r\n            pushFaceField(newFace, field);\r\n            continue;\r\n        }\r\n        hasFaceReplace = true;\r\n        let faceFromName = bus[field];\r\n        if (!faceFromName) continue;\r\n        if (arr.findIndex(v => v === faceFromName) >= 0) return false;\r\n        if (faceReplaceStringWithFace(faceFromName, bus, [face]) === false) return false;\r\n        for (let f of faceFromName) {\r\n            pushFaceField(newFace, f);\r\n        }\r\n    }\r\n    if (hasFaceReplace === true) {\r\n        face.splice(0, face.length, ...newFace);\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction pushFaceField(face: any[], field: any) {\r\n    for (let f of face) {\r\n        let { name: fn } = f;\r\n        let { name, type } = field;\r\n        if (fn.toLowerCase() === name.toLowerCase()) {\r\n            f.type = type;\r\n            return;\r\n        }\r\n    }\r\n    face.push(field);\r\n}\r\n\r\nfunction parseField(str: string): object | string | undefined {\r\n    if (str === undefined) return undefined;\r\n    let p = str.indexOf('--');\r\n    if (p >= 0) {\r\n        str = str.substr(0, p);\r\n    }\r\n    str = str.trim();\r\n    if (str.length === 0) return undefined;\r\n    let parts = str.split(':');\r\n    let len = parts.length;\r\n    if (len === 0) return undefined;\r\n    if (len === 1) return str;\r\n    //\"detail: order-detail -- { name: detail, type: array, fields: order-detail }\"\r\n    let name = parts[0].trim();\r\n    let type = parts[1].trim();\r\n    if (name.length === 0) return undefined;\r\n    let fields: string = undefined;\r\n    switch (type) {\r\n        default:\r\n            fields = type;\r\n            type = 'array';\r\n            break;\r\n        case 'id':\r\n        case 'number':\r\n        case 'string': break;\r\n    }\r\n    return { name, type, fields };\r\n}\r\n\r\nfunction checkBusFace(face: any[], bus: any): boolean {\r\n    if (Array.isArray(face) === false) {\r\n        alert('face must be array');\r\n        return false;\r\n    }\r\n    let len = face.length;\r\n    let delArr: number[] = [];\r\n    for (let i = 0; i < len; i++) {\r\n        let field = face[i];\r\n        switch (typeof field) {\r\n            default:\r\n                alert('face中的项，只能是object或者字符串');\r\n                return false;\r\n            case 'object':\r\n                if (field['-']) delete field['-'];\r\n                if (field['--']) delete field['--'];\r\n                break;\r\n            case 'string':\r\n                let parsed = parseField(field);\r\n                if (parsed === undefined) {\r\n                    delArr.push(i);\r\n                    continue;\r\n                }\r\n                if (typeof parsed === 'string') {\r\n                    let faceFromName = bus[parsed];\r\n                    if (!faceFromName) {\r\n                        alert(`'${field}' 没有定义`);\r\n                        return false;\r\n                    }\r\n                    face.splice(i, 1, parsed);\r\n                    continue;\r\n                }\r\n                field = parsed;\r\n                face.splice(i, 1, parsed);\r\n                break;\r\n        }\r\n        let { type } = field;\r\n        if (type === undefined) {\r\n            alert('type not defined');\r\n            return false;\r\n        }\r\n        if (type === 'array') {\r\n            let { fields } = field;\r\n            if (refNameOk(fields, bus) === false) {\r\n                return false;\r\n            }\r\n        }\r\n        if (busTypes.indexOf(type) < 0) {\r\n            if (type === 'date') {\r\n                alert('不再支持数据类型date，请用number unixtime作为媒介')\r\n            }\r\n            else {\r\n                alert(`不支持数据类型 ${type}`);\r\n            }\r\n            return false;\r\n        }\r\n    }\r\n    len = delArr.length;\r\n    for (let i = len - 1; i >= 0; i--) {\r\n        face.splice(delArr[i], 1);\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction checkBusQuery(face: any, bus: any): boolean {\r\n    for (let i in face) {\r\n        let item = face[i];\r\n        switch (i) {\r\n            default:\r\n                alert(i + ': not allowed in bus query.');\r\n                return false;\r\n            case 'param':\r\n                if (checkBusQueryParam(item, bus) === false) return false;\r\n                break;\r\n            case 'returns':\r\n                let returns = item;\r\n                if (typeof item === 'string') {\r\n                    returns = bus[item];\r\n                    if (returns === undefined) {\r\n                        alert(item + ' is not defined');\r\n                        return false;\r\n                    }\r\n                    bus.returns = returns;\r\n                }\r\n                if (checkBusFace(returns, bus) === false) return false;\r\n                break;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction checkBusQueryParam(param: any, bus: any): boolean {\r\n    if (param === null || param === undefined) return true;\r\n    switch (typeof param) {\r\n        case 'string':\r\n            return refNameOk(param, bus);\r\n        default:\r\n            if (Array.isArray(param)) {\r\n                if (refArrayOk(param, bus) === false) return false;\r\n                for (let i = 0; i < param.length; i++) {\r\n                    let item = param[i];\r\n                    if (typeof item === 'string') {\r\n                        param[i] = parseField(item);\r\n                    }\r\n                }\r\n                return true;\r\n            }\r\n            break;\r\n    }\r\n    alert('param of a query can only be string or array');\r\n    return false;\r\n}\r\n\r\nclass Servers extends ObjItems<DevServer> {\r\n    protected async _load() {\r\n        return await devApi.servers(this.store.unit.id);\r\n    }\r\n    protected async _save(item: DevServer): Promise<number> {\r\n        return await devApi.saveServer(item);\r\n    }\r\n    protected async _del(item: DevServer): Promise<void> {\r\n        await devApi.delServer(this.store.unit.id, item.id);\r\n    }\r\n    protected _inc() { this.dev.counts.server++; }\r\n    protected _dec() { this.dev.counts.server--; }\r\n}\r\nclass Services extends ObjItems<DevService> {\r\n    protected async _load() {\r\n        return await devApi.services(this.store.unit.id);\r\n    }\r\n    protected async _save(item: DevService): Promise<number> {\r\n        return await devApi.saveService(item);\r\n    }\r\n    protected async _del(item: DevService): Promise<void> {\r\n        await devApi.delService(this.store.unit.id, item.id);\r\n    }\r\n    protected _inc() { this.dev.counts.service++; }\r\n    protected _dec() { this.dev.counts.service--; }\r\n    async changeProp(prop: string, value: any): Promise<number> {\r\n        let ret = await devApi.changeServiceProp(this.store.unit.id, this.cur.id, prop, value);\r\n        switch (prop) {\r\n            case 'url': this.cur.url = value; break;\r\n            case 'urlTest': this.cur.urlTest = value; break;\r\n            case 'server': this.cur.server = value; break;\r\n            case 'db': this.cur.db = value; break;\r\n            //case 'db_type': this.cur.db_type = value; break;\r\n            //case 'connection': this.cur.connection = value; break;\r\n        }\r\n        return ret;\r\n    }\r\n    async loadUqServices(uq: number): Promise<void> {\r\n        let ret = await devApi.loadUqServices(this.store.unit.id, uq);\r\n        this.items = ret[0];\r\n    }\r\n}\r\n\r\nconst searchPageSize = 50;\r\ntype Search = (unit: number, key: string, pageStart: number, pageSize: number) => Promise<any[]>;\r\nclass SearchItems<T extends DevObjBase> {\r\n    private store: Store;\r\n    private dev: Dev;\r\n    private search: (unit: number, key: string, pageStart: number, pageSize: number) => Promise<any[]>;\r\n\r\n    constructor(store: Store, dev: Dev, search: Search) {\r\n        this.store = store;\r\n        this.dev = dev;\r\n        this.search = search;\r\n    }\r\n\r\n    @observable items: T[] = undefined;\r\n    allLoaded: boolean = false;\r\n    private key: string;\r\n    private pageStart = 0;\r\n\r\n    async first(key: string) {\r\n        this.key = key;\r\n        this.items = undefined;\r\n        this.allLoaded = false;\r\n        this.pageStart = 0;\r\n        await this.more();\r\n    }\r\n\r\n    async more(): Promise<void> {\r\n        if (this.allLoaded === true) return;\r\n        let ret = await this.search(this.store.unit.id, this.key, this.pageStart, searchPageSize);\r\n        let len = ret.length;\r\n        if (len > searchPageSize) {\r\n            this.allLoaded = false;\r\n            --len;\r\n            ret.splice(len, 1);\r\n        }\r\n        else {\r\n            this.allLoaded = true;\r\n        }\r\n        if (len > 0) {\r\n            this.pageStart = ret[len - 1].id;\r\n            if (this.items === undefined)\r\n                this.items = ret;\r\n            else\r\n                this.items.push(...ret);\r\n        }\r\n        else {\r\n            this.items = [];\r\n        }\r\n    }\r\n}\r\n\r\nexport class Dev {\r\n    private store: Store;\r\n    constructor(store: Store) {\r\n        this.store = store;\r\n        this.apps = new Apps(store, this);\r\n        this.uqs = new Uqs(store, this);\r\n        this.buses = new Buses(store, this);\r\n        this.servers = new Servers(store, this);\r\n        //this.uqdbs = new Uqdbs(store, this);\r\n        this.services = new Services(store, this);\r\n        this.searchApp = new SearchItems<DevApp>(store, this, devApi.searchApp.bind(devApi));\r\n        this.searchUq = new SearchItems<DevUQ>(store, this, devApi.searchUq.bind(devApi));\r\n        this.searchServer = new SearchItems<DevServer>(store, this, devApi.searchServer.bind(devApi));\r\n    }\r\n\r\n    @observable counts: Counts = undefined;\r\n    apps: Apps = undefined;\r\n    uqs: Uqs = undefined;\r\n    buses: Buses = undefined;\r\n    servers: Servers = undefined;\r\n    services: Services = undefined;\r\n\r\n    searchApp: SearchItems<DevApp> = undefined;\r\n    searchUq: SearchItems<DevUQ> = undefined;\r\n    searchServer: SearchItems<DevServer> = undefined;\r\n\r\n    async loadCounts(): Promise<void> {\r\n        let { unit } = this.store;\r\n        this.counts = await devApi.counts(unit.id);\r\n    }\r\n}\r\n","import {observable} from 'mobx';\r\nimport _ from 'lodash';\r\nimport {appInFrame, host} from 'tonva';\r\nimport {mainApi, devApi} from '../api';\r\nimport {Unit, UnitApp, Role, RoleMember, UnitAdmin} from '../model';\r\nimport {Dev} from './dev';\r\n\r\nexport class Store {\r\n    private get unitId():number {return appInFrame.unit;};\r\n    dev:Dev;\r\n    uqServer: string;\r\n\r\n    @observable unit: Unit;\r\n    @observable memberCount: number;\r\n    @observable apps: UnitApp[];\r\n    @observable role:Role;\r\n    @observable roles: Role[];\r\n    @observable roleApps: UnitApp[];\r\n    @observable roleMember: RoleMember;\r\n    @observable roleMembers: RoleMember[];\r\n    @observable memberRoles: Role[];\r\n\r\n    unitAdmins: UnitAdmin[]; // 仅仅为Admins调试用。从登录用户获取units\r\n    accUnits: UnitAdmin[];\r\n    devUnits: UnitAdmin[];\r\n    bothUnits: UnitAdmin[];\r\n\r\n    init() {\r\n        this.unit = undefined;\r\n        this.apps = undefined;\r\n        //this.admins = new Admins(this);\r\n        this.dev = new Dev(this);\r\n    }\r\n\r\n    logout() {\r\n        //meInFrame.app = undefined;\r\n        appInFrame.hash = undefined;\r\n        //let unitId = process.env.REACT_APP_DEBUG_UNITID;\r\n        //if (unitId !== undefined)\r\n        //    meInFrame.unit = Number(unitId);\r\n        appInFrame.unit = undefined;\r\n        this.init();\r\n        this.memberCount = undefined;\r\n        this.apps = undefined;\r\n        this.role = undefined;\r\n        this.roles = undefined;\r\n        this.roleApps = undefined;\r\n        this.roleMember = undefined;\r\n        this.roleMembers = undefined;\r\n        this.memberRoles = undefined;\r\n    }\r\n\r\n    async loadAdminUnits(): Promise<void> {\r\n        let ret = await mainApi.userUnitAdmins();\r\n        let unitAdmins = this.unitAdmins = ret[0];\r\n        if (unitAdmins.length === 1) {\r\n            appInFrame.unit = unitAdmins[0].id;\r\n            await store.loadUnit();\r\n        }\r\n        else {\r\n            this.accUnits = [];\r\n            this.devUnits = [];\r\n            this.bothUnits = [];\r\n            for (let ua of unitAdmins) {\r\n                let {type} = ua;\r\n                if ((type & 3) === 3) {\r\n                    this.bothUnits.push(ua);\r\n                }\r\n                else if ((type & 1) === 1) {\r\n                    this.devUnits.push(ua);\r\n                }\r\n                else if ((type & 2) === 2) {\r\n                    this.accUnits.push(ua);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    setRole(role:Role) {\r\n        if (this.role === role) return;\r\n        this.role = role;\r\n        this.roleApps = undefined;\r\n        this.roleMember = undefined;\r\n        this.roleMembers = undefined;\r\n        this.memberRoles = undefined;\r\n    }\r\n\r\n    setRoleUser(user:RoleMember) {\r\n        if (this.roleMember === user) return;\r\n        this.roleMember = user;\r\n        this.memberRoles = undefined;\r\n    }\r\n\r\n    async unitChangeProp(prop:string, value:any):Promise<void> {\r\n        await mainApi.unitChangeProp(this.unit.id, prop, value);\r\n        this.unit[prop] = value;\r\n    }\r\n\r\n    async loadApps(): Promise<void> {\r\n        if (this.apps !== undefined) return;\r\n        this.apps = await mainApi.unitApps(this.unitId);\r\n    }\r\n\r\n    async loadUnit(): Promise<void> {\r\n        if (this.unitId === undefined) return;\r\n        let ret = await mainApi.unit(this.unitId);\r\n        this.unit = ret;\r\n        this.memberCount = await mainApi.unitMemberCount(this.unitId);\r\n        let uqServer = await devApi.uqBuilderUrl();\r\n        let {url} = uqServer;\r\n        this.uqServer = host.getUrlOrDebug(url, 'uq-build');\r\n    }\r\n\r\n    async stopUnitApp(appId:number): Promise<void> {\r\n        await mainApi.unitDeleteApp(this.unit.id, appId, 1);\r\n        let app = this.apps.find(v => v.id === appId);\r\n        app.inUnit = 0;\r\n    }\r\n\r\n    async restoreUnitApp(appId:number): Promise<number> {\r\n        let ret = await mainApi.unitAddApp(this.unit.id, appId);\r\n        if (ret <= 0) return ret;\r\n        let app = this.apps.find(v => v.id === appId);\r\n        app.inUnit = 1;\r\n        return 1;\r\n    }\r\n\r\n    async addUnitApp(app:UnitApp): Promise<number> {\r\n        let ret = await mainApi.unitAddApp(this.unit.id, app.id);\r\n        if (ret <= 0) return ret;\r\n        this.apps.push(app);\r\n        return 1;\r\n    }\r\n\r\n    async loadRoles(): Promise<void> {\r\n        if (this.roles !== undefined) return;\r\n        let ret = await mainApi.unitRoles(this.unit.id);\r\n        ret.forEach(v => {\r\n            switch (v.id) {\r\n                case 1: \r\n                    v.name= '访客';\r\n                    v.discription = '可以获取开放信息';\r\n                    break;\r\n                case 2: \r\n                    v.name= '普通';\r\n                    v.discription = '能访问最基本的功能';\r\n                    break;\r\n            }\r\n        });\r\n        this.roles = ret;\r\n    }\r\n\r\n    async unitAddRole(name:string, discription:string): Promise<number> {\r\n        let id = await mainApi.unitAddRole(this.unit.id, name, discription);\r\n        if (id > 0) {\r\n            this.roles.push({\r\n                id: id,\r\n                name: name,\r\n                discription: discription,\r\n                count: undefined,\r\n            });\r\n        }\r\n        return id;\r\n    }\r\n\r\n    async roleChangeProp(prop:string, value:any):Promise<void> {\r\n        await mainApi.unitRoleChangeProp(this.unit.id, this.role.id, prop, value);\r\n        this.role[prop] = value;\r\n    }\r\n\r\n    async loadRoleApps():Promise<void> {\r\n        let ret = await mainApi.unitRoleApps(this.unit.id, this.role.id);\r\n        this.roleApps = ret.map(v => {\r\n            return this.apps.find(app=>app.id === v.id);\r\n        });\r\n    }\r\n\r\n    async setRoleApps(apps:UnitApp[]) {\r\n        await mainApi.unitRoleSetApps(this.unit.id, this.role.id, apps.map(v=>v.id));\r\n        this.roleApps = apps;\r\n    }\r\n\r\n    async loadMembers():Promise<void> {\r\n        let ret = await mainApi.unitMembers(this.unit.id, this.role === undefined? 0:this.role.id, undefined, 0, 100);\r\n        this.roleMembers = ret;\r\n    }\r\n\r\n    async unitAssignMember(assigned:string):Promise<void> {\r\n        await mainApi.unitAssignMember(this.unit.id, this.roleMember.id, assigned);\r\n        this.roleMember.assigned = assigned;\r\n    }\r\n\r\n    async loadMemberRoles():Promise<void> {\r\n        let ret = await mainApi.unitMemberRoles(this.unit.id, this.roleMember.id);\r\n        let roles:Role[] = ret.map(v => {\r\n            let rId = v.id;\r\n            let role = this.roles.find(r => r.id === rId);\r\n            return _.clone(role);\r\n        });\r\n        this.memberRoles = roles;\r\n    }\r\n\r\n    async setMemberRoles(memberRoles:Role[]) {\r\n        await mainApi.unitSetMemberRoles(this.unit.id, this.roleMember.id, memberRoles.map(v=>v.id));\r\n        this.roles.forEach(role => {\r\n            let rId = role.id;\r\n            let org = this.memberRoles.find(v => v.id === rId);\r\n            let cur = memberRoles.find(v => v.id === rId);\r\n            if (org !== undefined) {\r\n                if (cur !== undefined) return;\r\n                role.count--;\r\n                return;\r\n            }\r\n            if (cur === undefined) return;\r\n            role.count++;\r\n        });\r\n        this.memberRoles = memberRoles;\r\n    }\r\n};\r\n\r\nexport const store = new Store();\r\n","import { CSub, CBase } from 'tonva';\r\nimport { CApp } from './CApp';\r\n\r\nexport abstract class CUqBase extends CBase {\r\n    get cApp(): CApp { return this._cApp; }\r\n}\r\n\r\nexport abstract class CUqSub<T extends CUqBase> extends CSub<T> {\r\n    get cApp(): CApp { return this.cApp; }\r\n    protected get owner(): CUqBase { return this._owner as CUqBase }\r\n}\r\n\r\nexport abstract class CRenderBase extends CUqBase {\r\n    protected async internalStart(param:any, ...params:any[]):Promise<void> {\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {EasyDate, EasyTime} from 'tonva';\r\n\r\nexport interface IdDatesProps {\r\n    date_init: Date;\r\n    date_update: Date;\r\n}\r\n\r\nexport class IdDates extends React.Component<IdDatesProps> {\r\n    render() {\r\n        let {date_init, date_update} = this.props;\r\n        return <small className=\"text-muted\">\r\n            更新: <EasyTime date={date_update}/>\r\n            <i className=\"fa fa-fw\" />\r\n            创建: <EasyDate date={date_init}/>\r\n        </small>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport function span(\r\n    isLink:boolean,\r\n    className:string, \r\n    onClick:(evt:React.MouseEventHandler<HTMLElement>)=>void,\r\n    content:any): JSX.Element\r\n{\r\n    let tag:string;\r\n    let props:any;\r\n    if (isLink === true) {\r\n        tag = 'a';\r\n        props = {\r\n            className: classNames(className, 'cursor-pointer'),\r\n            onClick: onClick,\r\n            href: '#',\r\n        }\r\n    }\r\n    else {\r\n        tag = 'span';\r\n        props = {\r\n            className: className,\r\n        }\r\n    }\r\n    return React.createElement(tag, props, content);\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, Media, PropGrid} from 'tonva';\r\nimport {nav, Page}  from 'tonva';\r\nimport {caches} from '../store';\r\nimport {span} from './span';\r\n\r\nexport interface UnitLinkProps {\r\n    className?: string;\r\n    id: number;\r\n    isLink?: boolean;\r\n}\r\n\r\n@observer\r\nexport class UnitSpan extends React.Component<UnitLinkProps> {\r\n    onClick = (evt) => {\r\n        evt.preventDefault();\r\n        nav.push(<UnitInfo id={this.props.id} />);\r\n        return false;\r\n    }\r\n    render() {\r\n        let {id, isLink, className} = this.props;\r\n        if (id === undefined) return null;\r\n        if (id === null) return null;\r\n        let unit = caches.units.get(id);\r\n        if (!unit) return null;\r\n        let content:any;\r\n        let {name, nick, discription} = unit;\r\n        let disc = discription && '- ' + discription;\r\n        if (nick) {\r\n            content = <>{nick} &nbsp; <small className=\"text-muted\">{name} {disc}</small></>;\r\n        }\r\n        else if (name) {\r\n            content = <>{name} &nbsp; <small className=\"text-muted\">{disc}</small></>;\r\n        }\r\n        else {\r\n            content = id;\r\n        }\r\n        return span(isLink, className, this.onClick, content);\r\n    }\r\n}\r\n\r\n@observer\r\nexport class UnitName extends React.Component<UnitLinkProps> {\r\n    render() {\r\n        let {id} = this.props;\r\n        if (id === undefined) return null;\r\n        let unit = caches.units.get(id);\r\n        let {name} = unit;\r\n        return <>{name}</>;\r\n    }\r\n}\r\n\r\nclass UnitInfo extends React.Component<UnitLinkProps> {\r\n    private rows:Prop[];\r\n    render() {\r\n        let unit = caches.units.get(this.props.id);\r\n        let {name, icon, discription} = unit;\r\n        this.rows = [\r\n            '',\r\n            {type: 'component', component: <Media icon={icon} main={name} discription={discription} />},\r\n            '',\r\n        ];\r\n        return <Page header={'小号 - 详细资料'}>\r\n            <PropGrid rows={this.rows} values={this.props} />\r\n        </Page>;\r\n    }\r\n}\r\n","export const appIcon = process.env.REACT_APP_ICON;\r\nexport const appItemIcon = process.env.REACT_APP_ITEM_ICON;\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, Media, PropGrid} from 'tonva';\r\nimport {nav, Page}  from 'tonva';\r\nimport {appIcon} from 'consts';\r\nimport {caches} from 'store';\r\nimport {IdDates} from './idDates';\r\nimport {span} from './span';\r\nimport {UnitSpan} from './unitSpan';\r\n\r\nexport interface UqLinkProps {\r\n    className?: string;\r\n    id: number;\r\n    isLink?: boolean;\r\n}\r\n\r\n@observer\r\nexport class UqSpan extends React.Component<UqLinkProps> {\r\n    onClick = (evt) => {\r\n        evt.preventDefault();\r\n        nav.push(<UqInfo id={this.props.id} />);\r\n        return false;\r\n    }\r\n    render() {\r\n        let {id, className, isLink} = this.props;\r\n        let api = caches.uqs.get(id);\r\n        let content;\r\n        if (api === null) {\r\n            content = id;\r\n        }\r\n        else {\r\n            let {name, discription} = api;\r\n            let disc = discription && '- ' + discription;\r\n            if (name !== undefined) {\r\n                content = <>{name}&nbsp;<small className=\"text-muted\">{disc}</small></>;\r\n            }\r\n            else {\r\n                content = id;\r\n            }\r\n        }\r\n        return span(isLink, className, this.onClick, content);\r\n    }\r\n}\r\n\r\n@observer\r\nclass UqInfo extends React.Component<UqLinkProps> {\r\n    private rows:Prop[];\r\n    render() {\r\n        let uq = caches.uqs.get(this.props.id);\r\n        let {name, discription, unit, date_init, date_update} = uq;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        this.rows = [\r\n            '',\r\n            {type: 'component', component: <Media icon={appIcon} main={name} discription={disp} />},\r\n            '',\r\n            {type: 'component', label: '所有者', component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> },\r\n        ];\r\n        return <Page header={'UQ - 详细资料'}>\r\n            <PropGrid rows={this.rows} values={this.props} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { Prop, ListProp, Media, PropGrid } from 'tonva';\r\nimport { nav, Page } from 'tonva';\r\nimport { caches } from '../store';\r\nimport { devApi } from '../api';\r\nimport { span } from './span';\r\nimport { IdDates } from './idDates';\r\nimport { UnitSpan } from './unitSpan';\r\n\r\nexport interface AppSpanProps {\r\n    className?: string;\r\n    id: number;\r\n    isLink?: boolean;\r\n}\r\n\r\nclass AppRow extends React.Component<any> {\r\n    render() {\r\n        let { name, discription } = this.props;\r\n        let disp;\r\n        if (discription) disp = <div className=\"small text-muted\">{discription}</div>;\r\n        return <div className='form-control-plaintext'>\r\n            <div>{name}</div>\r\n            {disp}\r\n        </div>\r\n    }\r\n}\r\n\r\n@observer\r\nexport class AppSpan extends React.Component<AppSpanProps> {\r\n    onClick = (evt) => {\r\n        evt.preventDefault();\r\n        nav.push(<AppInfo id={this.props.id} />)\r\n        return false;\r\n    }\r\n    render() {\r\n        let { id, isLink, className } = this.props;\r\n        let app = caches.apps.get(id);\r\n        let content;\r\n        if (app === null) {\r\n            content = id;\r\n        }\r\n        else {\r\n            let { name, discription } = app;\r\n            //let isPublic = app.public;\r\n            let disc = discription && '- ' + discription;\r\n            if (name !== undefined) {\r\n                content = <React.Fragment>{name} &nbsp; <small className=\"text-muted\">{disc}</small></React.Fragment>;\r\n            }\r\n            else {\r\n                content = id;\r\n            }\r\n        }\r\n        return span(isLink, className, this.onClick, content);\r\n    }\r\n}\r\n\r\n\r\n@observer\r\nclass AppInfo extends React.Component<AppSpanProps> {\r\n    private rows: Prop[];\r\n    @observable private apis: ListProp = {\r\n        label: '关联API', type: 'list', list: undefined, row: AppRow\r\n    };\r\n    /*\r\n    constructor(props:any) {\r\n        super(props);\r\n    }*/\r\n    async componentDidMount() {\r\n        this.apis.list = await devApi.loadAppUqs(this.props.id);\r\n    }\r\n    render() {\r\n        let app = caches.apps.get(this.props.id);\r\n        let { unit, name, discription, icon, date_init, date_update } = app;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        this.rows = [\r\n            '',\r\n            { type: 'component', component: <Media icon={icon} main={name} discription={disp} /> },\r\n            '',\r\n            { type: 'component', label: '所有者', component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> },\r\n            this.apis,\r\n        ];\r\n        return <Page header={'APP - 详细资料'}>\r\n            <PropGrid rows={this.rows} values={this.props} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, Media, PropGrid} from 'tonva';\r\nimport {nav, Page}  from 'tonva';\r\nimport {appIcon} from 'consts';\r\nimport {caches} from 'store';\r\nimport {IdDates} from './idDates';\r\nimport {span} from './span';\r\nimport {UnitSpan} from './unitSpan';\r\n\r\nexport interface BusLinkProps {\r\n    className?: string;\r\n    id: number;\r\n    isLink?: boolean;\r\n}\r\n\r\n@observer\r\nexport class BusSpan extends React.Component<BusLinkProps> {\r\n    onClick = (evt) => {\r\n        evt.preventDefault();\r\n        nav.push(<BusInfo id={this.props.id} />);\r\n        return false;\r\n    }\r\n    render() {\r\n        let {id, className, isLink} = this.props;\r\n        let api = caches.buses.get(id);\r\n        let content:any;\r\n        if (api === null) {\r\n            content = id;\r\n        }\r\n        else {\r\n            let {name, owner} = api;\r\n            if (name !== undefined) {\r\n                content = <>{name} / {owner}</>;\r\n            }\r\n            else {\r\n                content = id;\r\n            }\r\n        }\r\n        return span(isLink, className, this.onClick, content);\r\n    }\r\n}\r\n\r\n@observer\r\nclass BusInfo extends React.Component<BusLinkProps> {\r\n    private rows:Prop[];\r\n    render() {\r\n        let bus = caches.buses.get(this.props.id);\r\n        let {name, discription, unit, date_init, date_update} = bus;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        this.rows = [\r\n            '',\r\n            {type: 'component', component: <Media icon={appIcon} main={name} discription={disp} />},\r\n            '',\r\n            {type: 'component', label: '所有者', component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> },\r\n        ];\r\n        return <Page header={'UQ - 详细资料'}>\r\n            <PropGrid rows={this.rows} values={this.props} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, Media, PropGrid} from 'tonva';\r\nimport {nav, Page}  from 'tonva';\r\nimport {appIcon} from '../consts';\r\nimport {caches} from '../store';\r\nimport {span} from './span';\r\nimport {UnitSpan} from './unitSpan';\r\n\r\nexport interface ServerSpanProps {\r\n    className?: string;\r\n    id: number;\r\n    isLink?: boolean;\r\n}\r\n\r\n@observer\r\nexport class ServerSpan extends React.Component<ServerSpanProps> {\r\n    onClick = (evt) => {\r\n        evt.preventDefault();\r\n        nav.push(<ServerInfo id={this.props.id} />)\r\n        return false;\r\n    }\r\n    render() {\r\n        let {id, isLink, className} = this.props;\r\n        let server = caches.servers.get(id);\r\n        let content:any;\r\n        if (server === null) {\r\n            content = id;\r\n        }\r\n        else {\r\n            let {ip, name, url} = server;\r\n            if (name !== undefined) {\r\n                content = <>\r\n                    {name}&nbsp; <small className=\"text-muted\">{url || ip}</small>\r\n                </>;\r\n            }\r\n            else {\r\n                content = id;\r\n            }\r\n        }\r\n        if (!content) content = <small className=\"text-muted\">[无]</small>;\r\n        return span(isLink, className, this.onClick, content);\r\n    }\r\n}\r\n\r\nclass ServerInfo extends React.Component<ServerSpanProps> {\r\n    private rows:Prop[];\r\n    render() {\r\n        let server = caches.servers.get(this.props.id);\r\n        let {discription, ip, unit} = server;\r\n        /*\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        */\r\n        this.rows = [\r\n            '',\r\n            {type: 'component', component: <Media icon={appIcon} main={discription} discription={ip} />},\r\n            '',\r\n            {type: 'component', label: '所有者', component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> },\r\n            {type: 'string', label: '云服务', name: 'cloud'},\r\n        ];\r\n        return <Page header={'服务器 - 详细资料'}>\r\n            <PropGrid rows={this.rows} values={this.props} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {nav, Page} from 'tonva';\r\n\r\ninterface StringValueEditProps {\r\n    title: string;\r\n    onChanged:(value:any, orgValue:any)=>Promise<string|void>;\r\n    value?: any;\r\n    buttonText?: string;\r\n    info?: string;\r\n}\r\ninterface StringValueEditState {\r\n    disabled: boolean;\r\n    error?: string;\r\n}\r\n\r\nexport class StringValueEdit extends React.Component<StringValueEditProps, StringValueEditState> {\r\n    //private input:HTMLInputElement;\r\n    protected value: string;\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            disabled: true,\r\n        };\r\n    }\r\n    /*\r\n    private ref = (input:HTMLInputElement) => {\r\n        if (!input) return;\r\n        input.value = this.props.value || '';\r\n        this.input = input;\r\n    }*/\r\n    private onChange = (evt:React.FormEvent<HTMLInputElement>) => {\r\n        let val = this.props.value;\r\n        let org = val && val.trim();\r\n        this.value = evt.currentTarget.value.trim();\r\n        this.setState({\r\n            disabled: org === this.value\r\n        });\r\n        \r\n    }\r\n    protected onSubmit = async () => {\r\n        let val = this.props.value;\r\n        let org = val && val.trim();\r\n        let v = this.value; // this.input.value.trim();\r\n        let onChanged = this.props.onChanged;\r\n        if (onChanged !== undefined) {\r\n            let ret = await onChanged(v, org);\r\n            if (typeof ret === 'string') {\r\n                this.setState({error: ret});\r\n                return;\r\n            }\r\n            nav.pop();\r\n        }\r\n    }\r\n    protected renderControl() {\r\n        return <input className=\"form-control w-100\" type=\"text\"\r\n            // ref={this.ref}\r\n            defaultValue={this.props.value}\r\n            onChange={this.onChange} />\r\n    }\r\n    render() {\r\n        let {title, buttonText, info} = this.props;\r\n        let {disabled, error} = this.state;\r\n        let right = <button\r\n            className=\"btn btn-success btn-sm\"\r\n            disabled={disabled}\r\n            onClick={this.onSubmit}\r\n        >\r\n            {buttonText||'保存'}\r\n        </button>;\r\n        let errorDiv;\r\n        if (error !== undefined) errorDiv = <div className='text-danger'>{error}</div>;\r\n        return <Page header={title} right={right}>\r\n            <div className=\"my-4 mx-3\">\r\n                {this.renderControl()}\r\n                {errorDiv}\r\n                <small className=\"d-block mt-2 text-muted\">{info}</small>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class TextValueEdit extends StringValueEdit {\r\n    /*\r\n    private textArea:HTMLTextAreaElement;\r\n    private refTextArea = (textArea:HTMLTextAreaElement) => {\r\n        if (!textArea) return;\r\n        textArea.value = this.props.value || '';\r\n        this.textArea = textArea;\r\n    }\r\n    */\r\n    private onTextAreaChange = (evt:React.FormEvent<HTMLTextAreaElement>) => {\r\n        let val = this.props.value;\r\n        let org = val && val.trim();\r\n        this.value = evt.currentTarget.value.trim();\r\n        this.setState({\r\n            disabled: org === this.value\r\n        })\r\n    }\r\n    protected renderControl() {\r\n        return <textarea className=\"form-control w-100\" rows={8}\r\n            // ref={this.refTextArea}\r\n            defaultValue={this.props.value}\r\n            onChange={this.onTextAreaChange} />\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { nav, Page } from 'tonva';\r\nimport { SearchBox, List } from 'tonva';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport interface IdPickPageProps {\r\n    caption: string;\r\n    searchPlaceHolder?: string;\r\n    candidateItems: ((params:any, key:string) => Promise<any[]>) | any[];\r\n    moreCandidates: () => Promise<void>;\r\n    row: (item:any, index:number) => JSX.Element;\r\n    idFromItem: (item:any) => number;\r\n    resolve: (item?: any) => void;\r\n    params: any;\r\n}\r\n\r\n@observer\r\nexport class IdPickPage extends React.Component<IdPickPageProps> {\r\n    @observable private items:any[];\r\n\r\n    async componentDidMount() {\r\n        let {candidateItems, params} = this.props;\r\n        this.items = Array.isArray(candidateItems)? \r\n            candidateItems \r\n            : await candidateItems(params, '');\r\n    }\r\n    private itemClick = (item:any):Promise<void> => {\r\n        let {resolve, idFromItem} = this.props;\r\n        resolve(idFromItem(item));\r\n        nav.pop();\r\n        return;\r\n    }\r\n    private onSearch = async (key: string):Promise<void> => {\r\n        let {candidateItems, params} = this.props;\r\n        if (typeof candidateItems === 'function') {\r\n            let ret = await candidateItems(params, key);\r\n            this.items = ret;\r\n        }\r\n        return;\r\n    }\r\n    render() {\r\n        let {caption, row, searchPlaceHolder} = this.props;\r\n        return <Page header={caption} back=\"close\">\r\n            <div className=\"container\">\r\n                <SearchBox className=\"my-2\" \r\n                    onSearch={this.onSearch} \r\n                    placeholder={searchPlaceHolder}\r\n                    maxLength={100} />\r\n            </div>\r\n            <List items={this.items} item={{onClick:this.itemClick, render:row}} />\r\n        </Page>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {nav, Page} from 'tonva';\r\nimport {IdPick, IdPickFace} from 'tonva-form';\r\nimport {List, SearchBox} from 'tonva';\r\n\r\nexport interface IdPickProps {\r\n    caption: string;\r\n    searchPlaceHolder?: string;\r\n    candidateItems: ((params:any, key:string) => Promise<any[]>) | any[];\r\n    moreCandidates: () => Promise<void>;\r\n    row: (item:any, index:number) => JSX.Element;\r\n}\r\n\r\nexport function createIdPick(props: IdPickProps):IdPick {\r\n    return function(face: IdPickFace, params: any):Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            nav.push(<IdPickPage resolve={resolve} face={face} params={params} {...props} />);\r\n        });\r\n    }\r\n}\r\n\r\ninterface IdPickPageProps extends IdPickProps {\r\n    face: IdPickFace;\r\n    resolve: (item?: any) => void;\r\n    params: any;\r\n}\r\ninterface IdPickPageState {\r\n    items?: any[];\r\n}\r\n\r\nclass IdPickPage extends React.Component<IdPickPageProps, IdPickPageState> {\r\n    private items:any[];\r\n    constructor(props:IdPickPageProps) {\r\n        super(props);\r\n        this.state = {\r\n            items: null,\r\n        }\r\n        this.itemClick = this.itemClick.bind(this);\r\n        this.onSearch = this.onSearch.bind(this);\r\n    }\r\n    async componentDidMount() {\r\n        let {candidateItems, params} = this.props;\r\n        this.setState({\r\n            items: Array.isArray(candidateItems)? candidateItems : await candidateItems(params, ''),\r\n        });\r\n    }\r\n    itemClick(item:any) {\r\n        let {resolve} = this.props;\r\n        resolve(item);\r\n        nav.pop();\r\n    }\r\n    async onSearch(key: string) {\r\n        //alert('search ' + key);\r\n        //await store.dev.searchServer.first(key)\r\n        let {candidateItems, params} = this.props;\r\n        if (typeof candidateItems === 'function') {\r\n            let ret = await candidateItems(params, key);\r\n            this.setState({items: ret});\r\n        }\r\n    }\r\n    render() {\r\n        let {caption, row, searchPlaceHolder} = this.props;\r\n        return <Page header={caption} back=\"close\">\r\n            <div className=\"container\">\r\n                <SearchBox className=\"my-2\" \r\n                    onSearch={this.onSearch} \r\n                    placeholder={searchPlaceHolder}\r\n                    maxLength={100} />\r\n            </div>\r\n            <List items={this.state.items} item={{onClick:this.itemClick, render:row}} />\r\n        </Page>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport {Media, List, LMR, Prop, PropGrid, FA} from 'tonva';\r\nimport {nav} from 'tonva';\r\nimport {IdDates, UnitSpan} from '../tools';\r\nimport {UnitApp} from '../model';\r\nimport {store} from '../store';\r\nimport { devApi } from 'api';\r\n\r\n@observer\r\nexport class Info extends React.Component<{app:UnitApp, appActed?:(appId:number, inUnit:number)=>void}> {\r\n    @observable private uqAccesses: any[];\r\n    async componentDidMount() {\r\n        this.uqAccesses = await devApi.loadAppUqs(this.props.app.id);\r\n    }\r\n\r\n    private renderUqRow = (uqAccess:any, index:number):JSX.Element => {\r\n        let {name, owner, discription} = uqAccess;\r\n        return <LMR className=\"py-2\" right={<small className=\"text-muted\">{discription}</small>}>\r\n            {owner} / {name}\r\n        </LMR>;\r\n    }\r\n\r\n    private act = async () => {\r\n        let {app, appActed} = this.props;\r\n        let {id, inUnit} = app;\r\n        let newInUnit:number = 1;\r\n        if (inUnit === 0) {\r\n            let ret = await store.restoreUnitApp(id);\r\n            if (ret <= 0) alert('app 或者 uq 没有定义 service');\r\n        }\r\n        else if (inUnit === 1) {\r\n            await store.stopUnitApp(id);\r\n            newInUnit = 0;\r\n        }\r\n        else {\r\n            let newApp:UnitApp = _.clone(app);\r\n            newApp.id = id;\r\n            newApp.inUnit = 1;\r\n            let ret = await store.addUnitApp(newApp);\r\n            if (ret <= 0) alert('app 或者 uq 没有定义 service');\r\n        }\r\n        if (appActed !== undefined) {\r\n            appActed(id, newInUnit);\r\n        }\r\n        nav.pop();\r\n    }\r\n    render() {\r\n        let {unit, name, discription, icon, inUnit, date_init, date_update} = this.props.app;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        let faName:string, text:string, color:string;\r\n        if (inUnit === 1) {\r\n            faName = 'ban';\r\n            text = '停用APP';\r\n            color = 'btn-danger';\r\n        }\r\n        else if (inUnit === 0) {\r\n            faName = 'refresh';\r\n            text = '恢复APP';\r\n            color = 'btn-success';\r\n        }\r\n        else {\r\n            faName = 'plus';\r\n            text = '启用APP';\r\n            color = 'btn-primary';\r\n        }\r\n        let rows:Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component', \r\n                component: <Media icon={icon} main={name} discription={disp} />\r\n            },\r\n            '',\r\n            {\r\n                type: 'component', \r\n                label: '开发号', \r\n                component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div>\r\n            },\r\n            {\r\n                type: 'component', \r\n                label: '关联UQ', \r\n                component: <List className=\"w-100\" items={this.uqAccesses} item={{render: this.renderUqRow}} />\r\n            },\r\n            '',\r\n            '',\r\n            {\r\n                type: 'component', \r\n                bk: '', \r\n                component: <button className={classNames('btn', 'w-100', color)} onClick={this.act}>\r\n                    <FA name={faName} size=\"lg\" /> {text}\r\n                </button>\r\n            },\r\n        ];\r\n        return <div>\r\n            <PropGrid rows={rows} values={this.props} />\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {IObservableArray} from 'mobx';\r\nimport {observer} from 'mobx-react';\r\nimport {SearchBox, List, LMR, Badge} from 'tonva';\r\nimport {nav, Page, PageItems, Image} from 'tonva';\r\nimport {mainApi} from '../api';\r\nimport {store} from '../store';\r\nimport {UnitApp} from '../model';\r\nimport {Info} from './info';\r\n\r\nclass PageApps extends PageItems<UnitApp> {\r\n    private unitId:number;\r\n    constructor(unitId:number) {\r\n        super();\r\n        this.unitId = unitId;\r\n\t}\r\n\t/*\r\n    protected async load():Promise<UnitApp[]> {\r\n        return await mainApi.searchApp(this.unitId, this.param, this.pageStart, this.pageSize);\r\n\t}\r\n\t*/\r\n    protected async loadResults(param: any, pageStart: any, pageSize: number): Promise<{\r\n        [name: string]: any[];\r\n    }> {\r\n\t\tlet ret = await mainApi.searchApp(this.unitId, this.param, this.pageStart, this.pageSize);\r\n\t\treturn {$page: ret};\r\n\t}\r\n    protected setPageStart(item:UnitApp) {\r\n        if (item === undefined)\r\n            this.pageStart = 0;\r\n        else\r\n            this.pageStart = item.id;\r\n    }\r\n}\r\n\r\n@observer\r\nexport class NewApp extends React.Component {\r\n    private apps: PageApps;\r\n    constructor(props:any) {\r\n        super(props);\r\n        this.apps = new PageApps(store.unit.id);\r\n    }\r\n    private onSearch = async (key:string) => {\r\n        await this.apps.first(key);\r\n    }\r\n    private appClick = (app:UnitApp) => {\r\n        nav.push(<Page header=\"App详细信息\">\r\n            <Info app={app} appActed={this.appActed}/>\r\n        </Page>);\r\n    }\r\n    private appActed = (appId:number, inUnit:number) => {\r\n        let apps = this.apps.items as IObservableArray<UnitApp>; //.replace .find(v => v.id === appId);\r\n        let app = apps.find(v => v.id === appId);\r\n        app.inUnit = inUnit;\r\n        apps.replace([app]);\r\n    }\r\n    private renderApp(app:UnitApp):JSX.Element {\r\n        let {name, discription, icon, inUnit} = app;\r\n        let right;\r\n        if (inUnit === 1)\r\n            right = <small>已启用</small>;\r\n        else if (inUnit === 0)\r\n            right = <small>已停用</small>;\r\n        return <LMR className=\"px-3 py-2\"\r\n            left={<Badge><Image src={icon} /></Badge>}\r\n            right={right}>\r\n            <div className=\"px-3\">\r\n                <div>{name}</div>\r\n                <small className=\"text-muted\">{discription}</small>\r\n            </div>\r\n        </LMR>;\r\n    }\r\n    render() {\r\n        let items = this.apps.items;\r\n        let center = <SearchBox onSearch={this.onSearch} \r\n            className=\"w-100 mx-1\" \r\n            placeholder=\"搜索App\" \r\n            maxLength={100} />;\r\n        return <Page header={center}>\r\n            <List\r\n                items={items}\r\n                item={{onClick:this.appClick, render:this.renderApp}}\r\n                before=\"搜索App名字\" />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { List, FA, LMR, Badge } from 'tonva';\r\nimport { nav, Page, Image } from 'tonva';\r\nimport { store } from '../store';\r\nimport { NewApp } from './new';\r\nimport { UnitApp } from '../model';\r\nimport { Info } from './info';\r\n\r\n@observer\r\nexport default class AppsPage extends React.Component {\r\n    async componentDidMount() {\r\n        await store.loadApps();\r\n    }\r\n    private itemRender(app: UnitApp, index: number) {\r\n        let { name, discription, icon, inUnit } = app;\r\n        let ban;\r\n        if (inUnit === 0)\r\n            ban = <FA className=\"text-danger\" name='ban' />;\r\n        return <LMR className=\"px-3 py-1\"\r\n            left={<Badge><Image src={icon} /></Badge>}\r\n            right={ban}>\r\n            <div className=\"px-3\">\r\n                <div>{name}</div>\r\n                <small className=\"text-muted\">{discription}</small>\r\n            </div>\r\n        </LMR>;\r\n    }\r\n    private appClick(app: UnitApp) {\r\n        nav.push(<Page header=\"App详细信息\">\r\n            <Info app={app} />\r\n        </Page>);\r\n    }\r\n    private newItem() {\r\n        nav.push(<NewApp {...this.props} />);\r\n    }\r\n    render() {\r\n        let right = <button\r\n            className='btn btn-success btn-sm me-1 align-self-center'\r\n            onClick={() => this.newItem()}><FA name=\"plus\" /></button>;\r\n        return <Page header=\"启停App\" right={right}>\r\n            <List items={store.apps} item={{ render: this.itemRender, onClick: this.appClick }} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, Image, EasyDate } from 'tonva';\r\nimport { AppController } from '.';\r\nimport { List, LMR, Badge, FA } from 'tonva';\r\nimport { DevApp } from 'model';\r\n\r\nexport class AppsPage extends VPage<AppController> {\r\n    async open(param: any) {\r\n        this.openPage(this.page);\r\n    }\r\n    private page = (): JSX.Element => {\r\n        let { appList, listRowClick, showNewApp } = this.controller;\r\n        let right = <button className='btn btn-success btn-sm me-2' onClick={showNewApp}>\r\n            <FA name=\"plus\" /></button>;\r\n        return <Page header=\"App\" right={right}>\r\n            <List items={appList} item={{ render: this.appRow, onClick: listRowClick }} />\r\n        </Page>\r\n    }\r\n    private appRow = (item: DevApp): JSX.Element => {\r\n        let { name, caption, icon, date_init } = item;\r\n        let left = <Badge size=\"sm\"><Image src={icon} /></Badge>;\r\n        /*let urlDiv = <div className=\"text-muted small\">\r\n            {url || '-'} {urlDebug}\r\n        </div>;*/\r\n        let spanCaption = caption ?\r\n            <><div className=\"small text-muted\">{name}</div><div><b>{caption}</b></div></> :\r\n            <div><b>{name}</b></div>;\r\n        //let disDiv = <div><Muted>{discription}</Muted></div>\r\n        let right = <small className=\"text-muted\"><EasyDate date={date_init} /></small>;\r\n        return <LMR className=\"py-2 px-3 align-items-stretch\" left={left} right={right}>\r\n            <div className=\"px-3\">\r\n                {spanCaption}\r\n            </div>\r\n        </LMR>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport { AppController } from '.';\r\nimport { VPage, nav, Page, ItemSchema, UiSchema, StringSchema, BoolSchema, \r\n    UiTextItem, UiTextAreaItem, UiCheckItem, Form, \r\n    ButtonSchema, Context, ImageSchema, UiImageItem, IdSchema, UiIdItem } from 'tonva';\r\n//import { IdPickProps } from 'createIdPick';\r\nimport { store } from 'store';\r\nimport { IdPickPage, ServerSpan } from '../../tools';\r\nimport { observer } from 'mobx-react';\r\nimport { DevServer, DevApp } from 'model';\r\n\r\nconst ServerCaption = (item:DevServer) => {\r\n    let {discription, cloud, ip} = item;\r\n    return <>{discription} {cloud} {ip}</>;\r\n}\r\n/*\r\nconst idPickServerProps: IdPickProps = {\r\n    caption: '选择服务器',\r\n    searchPlaceHolder: '搜索服务器',\r\n    candidateItems: async (params:any, key:string) => {\r\n        await store.dev.searchServer.first(key);\r\n        return store.dev.searchServer.items;\r\n    },\r\n    moreCandidates: async () => {\r\n        await store.dev.searchServer.more();\r\n    },\r\n    row: (item:Server, index:number) => {\r\n        return <div className=\"px-3 py-2\"><ServerCaption {...item} /></div>;\r\n    },\r\n};\r\n*/\r\nconst schema:ItemSchema[] = [\r\n    {name: 'name', type: 'string', maxLength: 100, required: true} as StringSchema,\r\n    {name: 'caption', type: 'string', maxLength: 100} as StringSchema,\r\n    {name: 'discription', type: 'string', maxLength: 250} as StringSchema,\r\n    {name: 'url', type: 'string', maxLength: 200} as StringSchema,\r\n    {name: 'public', type: 'boolean'} as BoolSchema,\r\n    {name: 'server', type: 'id'} as IdSchema,\r\n    {name: 'icon', type: 'image'} as ImageSchema,\r\n    {name: 'submit', type: 'submit'} as ButtonSchema,\r\n];\r\n\r\nexport abstract class EditBasePage extends VPage<AppController> {\r\n    private candidateItems = async (params:any, key:string):Promise<any[]> => {\r\n        await store.dev.searchServer.first(key);\r\n        return store.dev.searchServer.items;\r\n    }\r\n\r\n    private moreCandidates = async ():Promise<void> => {\r\n        await store.dev.searchServer.more();\r\n    }\r\n\r\n    private renderRow = (item:DevServer, index:number): JSX.Element => {\r\n        return <div className=\"px-3 py-2\"><ServerCaption {...item} /></div>;\r\n    }\r\n\r\n    private pickServerId = (context:Context, name:string, value:number): Promise<number> => {\r\n        return new Promise<number>((resolve, reject) => {\r\n            nav.push(<IdPickPage \r\n                caption=\"选择服务器\" \r\n                searchPlaceHolder=\"搜索服务器\"\r\n                candidateItems={this.candidateItems}\r\n                moreCandidates={this.moreCandidates}\r\n                row={this.renderRow}\r\n                idFromItem={(item:DevServer) => item.id}\r\n                resolve={resolve} params={undefined} />, \r\n                ()=> {\r\n                    reject();\r\n                });\r\n        });\r\n    }\r\n\r\n    private renderServerInput = (itemId:number): JSX.Element => {\r\n        return <ServerSpan id={itemId} />;\r\n    };\r\n\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            name: {widget: 'text', label: '名称'} as UiTextItem,\r\n            caption: {widget: 'text', label: '标题'} as UiTextItem,\r\n            discription: {widget: 'textarea', label: '描述', rows: 5} as UiTextAreaItem,\r\n            url: {widget: 'text', label: 'URL', placeholder: 'http(s)://APP地址'} as UiTextItem,\r\n            'public': {widget: 'checkbox', label: '公开', } as UiCheckItem,\r\n            server: {widget: 'id', label: '服务器', pickId: this.pickServerId, Templet: this.renderServerInput} as UiIdItem,\r\n            icon: {widget: 'image', label: '标志图'} as UiImageItem,\r\n            submit: {widget: 'button', label: '提交', className: 'btn btn-primary'}\r\n        }\r\n    }\r\n    \r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n    private onButtonClick = async (name:string, context: Context) => {\r\n        let {data} = context;\r\n        let app:DevApp = _.clone(this.controller.app) || {} as any;\r\n        _.merge(app, data);\r\n        await this.controller.saveApp(app);\r\n        nav.pop();\r\n    }\r\n    protected page: ()=>JSX.Element;\r\n    protected form = observer(() => {\r\n        return <Form fieldLabelSize={2}\r\n            className=\"m-3\" \r\n            schema={schema} \r\n            uiSchema={this.uiSchema}\r\n            formData={this.initValues}\r\n            onButtonClick={this.onButtonClick} />\r\n    });\r\n    abstract get initValues():any;\r\n}\r\n\r\nexport class EditPage extends EditBasePage {\r\n    get initValues():any {return this.controller.app}\r\n    protected page = () => {\r\n        let {app} = this.controller;\r\n        let {name} = app;\r\n        return <Page header={'修改APP - ' + name} back=\"close\">\r\n            {React.createElement(this.form)}\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class NewPage extends EditBasePage {\r\n    get initValues():any {return {}}\r\n    protected page = () => {\r\n        return <Page header={'新建APP'} back=\"close\">\r\n            {React.createElement(this.form)}\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { List, LMR, SearchBox } from 'tonva';\r\nimport { Page, VPage } from 'tonva';\r\nimport { AppController } from '.';\r\nimport { DevUQ } from 'model';\r\n\r\nexport class SearchUqPage extends VPage<AppController> {\r\n    @observable private uqs: DevUQ[];\r\n\r\n    async open() {\r\n        //this.uqs = await this.controller.getMyUqs();\r\n        let pageStart = 0, pageSize = 200;\r\n        this.uqs = await this.controller.searchUq('', pageStart, pageSize);\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onSearch = async (key: string) => {\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        this.uqs = await this.controller.searchUq(key, pageStart, pageSize);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { onUq } = this.controller;\r\n        let header = <SearchBox className=\"w-100 mx-1\"\r\n            label=\"选择关联UQ \"\r\n            onSearch={this.onSearch}\r\n            placeholder=\"搜索UQ名字\"\r\n            maxLength={100} />;\r\n        return <Page back=\"close\" header={header}>\r\n            <List items={this.uqs} item={{ render: this.row, onClick: onUq }} />\r\n        </Page>;\r\n    });\r\n\r\n    private row = (uq: DevUQ) => {\r\n        let { owner, name, discription } = uq;\r\n        return <LMR className=\"py-2 px-3\" right={discription}>\r\n            <div>{owner} / {name}</div>\r\n        </LMR>;\r\n    };\r\n}\r\n/*\r\n@observer\r\nexport class AppUqs extends React.Component {\r\n    @observable anySelected: boolean = false;\r\n    private list:List;\r\n    private onSelect = (item: UQ, isSelected:boolean, anySelected:boolean) => {\r\n        this.anySelected = anySelected;\r\n    }\r\n    private row = (item: UQ) => {\r\n        let {name, unit, discription} = item;\r\n        return <LMR className=\"px-3 py-2\" right={<small className=\"text-muted\">{discription}</small>}>\r\n            <UnitSpan id={unit} />/{name}\r\n        </LMR>;\r\n    }\r\n    private removeBind = () => {\r\n        if (this.list === null) return;\r\n        let {selectedItems} = this.list;\r\n        if (selectedItems === undefined) return;\r\n        if (selectedItems.length === 0) return;\r\n        store.dev.apps.appRemoveUq(selectedItems.map(v => v.id));\r\n    }\r\n    render() {\r\n        let btnProps = this.anySelected?\r\n            {color:'danger', onClick:this.removeBind, icon:'trash', text:'取消'}:\r\n            {color:'primary', onClick:()=>nav.push(<Uqs/>), icon:'plus', text:'新增'};\r\n        let btn = (p)=><button \r\n            className={classNames('btn', 'btn-outline-'+p.color, 'btn-sm')} \r\n            onClick={p.onClick}>\r\n            <i className={\"fa fa-\" + p.icon} /> {p.text}关联\r\n        </button>;\r\n        let listHeader = <div className=\"va-row py-1 justify-content-center\">{btn(btnProps)}</div>;\r\n        return <Page header=\"关联UQ\">\r\n            <List ref={list=>this.list=list} header={listHeader}\r\n                items={store.dev.apps.uqs}\r\n                item={{render: this.row, onSelect: this.onSelect}} />\r\n        </Page>;\r\n    }\r\n}\r\n\r\n@observer\r\nclass Uqs extends React.Component {\r\n    onSearch = async (key:string) => {\r\n        await store.dev.apps.searchUq(key);\r\n    }\r\n    onBind(uq: UQ, bind: boolean) {\r\n        store.dev.apps.appBindUq([uq.id]);\r\n    }\r\n    row = (uq: UQ) => {\r\n        let isConnected = store.dev.apps.uqs.find(a => a.id === uq.id) !== undefined;\r\n        let cn = ['btn', 'btn-sm'];\r\n        let btnContent:any, onClick:any;\r\n        if (isConnected) {\r\n            cn.push('btn-success');\r\n            //onClick = ()=>this.onBind(uq, false);\r\n            btnContent = <div>已关联</div>;\r\n        }\r\n        else {\r\n            cn.push('btn-primary');\r\n            onClick = ()=>this.onBind(uq, true);\r\n            btnContent = <button className={classNames(cn)} onClick={onClick}><span><i className=\"fa fa-check\"/> 关联</span></button>;\r\n        }\r\n        return <div className=\"d-flex justify-content-start py-1 px-3\">\r\n            <div className=\"align-self-center\">{uq.name + ' - ' + uq.discription}</div>\r\n            <footer className=\"ms-auto\">{btnContent}</footer>\r\n        </div>\r\n    }\r\n    render() {\r\n        let header = <SearchBox className=\"w-100 mx-1\" \r\n            onSearch={this.onSearch} \r\n            placeholder=\"搜索UQ名字\" \r\n            maxLength={100} />;\r\n        return <Page back=\"close\" header={header}>\r\n            <List items={store.dev.apps.searchedUqs} item={{render: this.row}} loading={null} />\r\n        </Page>;\r\n    }\r\n}\r\n*/","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page, nav, Prop, Media, PropGrid, DropdownActions, List, LMR, FA } from 'tonva';\r\nimport { AppController/*, UqAccess*/ } from '.';\r\nimport { IdDates, UnitSpan, ServerSpan, UnitName } from 'tools';\r\nimport { EditPage } from './editPage';\r\nimport { SearchUqPage } from './appUqs';\r\nimport { DevUQ } from 'model';\r\n//import { DevModel } from 'model';\r\n\r\nexport class AppPage extends VPage<AppController> {\r\n    async open() {\r\n        //this.uqs.list = this.controller.uqs;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private editItem = async () => {\r\n        await this.openVPage(EditPage);\r\n        //nav.push(<EditAppPage {...this.props} />);\r\n    }\r\n\r\n    private deleteItem = async () => {\r\n        if (window.confirm('真的要删除吗？系统删除时并不会检查相关引用，请谨慎') === true) {\r\n            await this.controller.deleteApp();\r\n            nav.pop();\r\n        }\r\n    }\r\n\r\n    private page = observer((): JSX.Element => {\r\n        let { app, uqs } = this.controller;\r\n        //let mainId = mainUq === undefined? 0: mainUq.id;\r\n        let { unit, name, caption, discription, icon, server, date_init, date_update } = app;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        let menuItems = [\r\n            // {icon: 'cogs', caption:'设置关联UQ', action: ()=>nav.push(<AppUqs />)},\r\n            { caption: '修改App', action: this.editItem, icon: 'edit' },\r\n            { caption: '删除', action: this.deleteItem, icon: 'trash-o' }\r\n        ];\r\n\r\n        let right = <DropdownActions actions={menuItems} className=\"btn-primary me-2\" />;\r\n        let spanCaption = caption ?\r\n            <>{name}: <b>{caption}</b></> :\r\n            <b>{name}</b>;\r\n        let rows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <Media icon={icon} main={spanCaption} discription={disp} />\r\n            },\r\n            '',\r\n            {\r\n                type: 'component',\r\n                label: '开发号',\r\n                component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div>\r\n            },\r\n            /*\r\n            {\r\n                type: 'component', \r\n                label: 'Service',\r\n                vAlign: 'stretch',\r\n                component: <ServiceRow />,\r\n            },*/\r\n            {\r\n                label: 'URL',\r\n                name: 'url',\r\n                type: 'string',\r\n            },\r\n            {\r\n                type: 'component',\r\n                label: '服务器',\r\n                component: <ServerSpan id={server} />\r\n            },\r\n            '',\r\n            //this.uqs,\r\n        ];\r\n        let btnAddUq = <button\r\n            className=\"btn btn-outline-primary btn-sm\"\r\n            onClick={() => this.openVPage(SearchUqPage)}>增加UQ</button>;\r\n        //let slaveUqs = uqs.filter(v => v.id !== mainId);\r\n        return <Page header={'App - ' + name} right={right}>\r\n            <PropGrid rows={rows} values={app} />\r\n            <LMR className=\"mx-3 mt-3 mb-1\" right={btnAddUq}>关联UQ</LMR>\r\n            <List\r\n                items={uqs}\r\n                item={{ render: this.renderUqRow, onClick: this.uqClick }} />\r\n        </Page>\r\n    })\r\n\r\n    private uqClick = (uq: DevUQ) => {\r\n        this.controller.onUq(uq);\r\n    }\r\n\r\n    private renderUqRow = (uq: DevUQ, index: number): JSX.Element => {\r\n        if (uq === undefined) return null;\r\n        let { name, discription, unit } = uq;\r\n        let right = discription && <div className=\"small text-muted\"> &nbsp; {discription}</div>;\r\n        let isMain = this.controller.isMain(uq);\r\n        let cn = classNames(\"px-3 py-2 align-items-center bg-white\", isMain === true && \"font-weight-bold my-2\");\r\n        return <LMR className={cn} right={right}>\r\n            {isMain === true && <FA className=\"text-warning me-3\" name=\"star-o\" />}\r\n            <UnitName id={unit} /> / {name}\r\n        </LMR>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, nav, FA } from 'tonva';\r\nimport { AppController } from '.';\r\nimport { LMR } from 'tonva';\r\nimport { DevUQ } from 'model';\r\n\r\nexport class UqBindPage extends VPage<AppController> {\r\n    private uq: DevUQ;\r\n    //private accesses: string[];\r\n    //private accessChecked:{[name:string]:boolean};\r\n    async open(uq: DevUQ) {\r\n        this.uq = uq;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private saveUqBind = async () => {\r\n        await this.controller.saveUqBind(this.uq/*, acc*/);\r\n        this.closePage(2);\r\n    }\r\n\r\n    private removeUqBind = async () => {\r\n        await this.controller.removeUqBind(this.uq);\r\n        nav.pop();\r\n    }\r\n\r\n    private setMainUQ = async () => {\r\n        this.controller.saveSetUqMain(this.uq);\r\n        this.closePage();\r\n    }\r\n\r\n    private page = (): JSX.Element => {\r\n        //let {uq/*, bind_access*/} = this.uqAccess;\r\n        let { owner, name, discription } = this.uq;\r\n        let btnLeft: any, btnRight: any;\r\n        if (this.controller.isBinded(this.uq) === true) {\r\n            if (this.controller.isMain(this.uq) === false) {\r\n                btnLeft = <button className=\"btn btn-primary btn-sm\" onClick={this.setMainUQ}>设为主UQ</button>;\r\n            }\r\n            else {\r\n                btnLeft = <div><FA className=\"text-warning\" name=\"star-o\" /> 主UQ</div>;\r\n            }\r\n            btnRight = <button className=\"btn btn-outline-danger btn-sm\" onClick={this.removeUqBind}>取消关联</button>;\r\n        }\r\n        else {\r\n            btnLeft = <button className=\"btn btn-primary btn-sm\" onClick={this.saveUqBind}>保存关联</button>;\r\n        }\r\n        //let btnDelete = <button className=\"btn btn-outline-danger btn-sm\" onClick={this.removeUqBind}>取消关联</button>;\r\n        /*\r\n        if (bind_access !== null && bind_access !== undefined) {\r\n            btnDelete = <button className=\"btn btn-outline-danger btn-sm\" onClick={this.removeUqBind}>取消关联</button>;\r\n        }\r\n        */\r\n        /*\r\n        let checkAccessList:any;\r\n        if (this.accesses) {\r\n            checkAccessList = <div className=\"mt-3\">\r\n            {\r\n                this.accesses.map(v => {\r\n                    let checked = this.accessChecked[v];\r\n                    return <label key={v} className=\"d-inline-block me-4\">\r\n                        <input onChange={this.onCheckChanged}\r\n                            style={{width:'1.1rem', height:'1.1rem'}} \r\n                            name={v} type=\"checkbox\" defaultChecked={checked} />&nbsp;{v}\r\n                    </label>;\r\n                })\r\n            }\r\n            </div>;\r\n        }\r\n        */\r\n        return <Page header=\"关联UQ\">\r\n            <div className=\"m-3 py-3 px-3 bg-white border\">\r\n                <div>{owner} / {name}</div>\r\n                <div className=\"text-muted\">{discription}</div>\r\n                {/*checkAccessList*/}\r\n                <LMR className=\"pt-3\" right={btnRight}>{btnLeft}</LMR>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}","import _ from 'lodash';\r\nimport { observable } from 'mobx';\r\nimport { Controller } from 'tonva';\r\nimport { devApi } from 'api';\r\nimport { AppsPage } from './appsPage';\r\nimport { AppPage } from './appPage';\r\nimport { UqBindPage } from './uqBindPage';\r\nimport { NewPage } from './editPage';\r\nimport { DevApp, DevUQ } from 'model';\r\n\r\n/*\r\nexport interface UqAccess {\r\n    uq: UQ;\r\n    //bind_access: string[];\r\n}\r\n*/\r\n\r\nexport class AppController extends Controller {\r\n    private unitId: number;\r\n    app: DevApp;\r\n    @observable appList: DevApp[];\r\n    @observable uqs: DevUQ[];\r\n    @observable uqMain: DevUQ;\r\n    protected async internalStart(unitId:any) {\r\n        this.unitId = unitId;\r\n        this.appList = await devApi.apps(this.unitId);\r\n        this.openVPage(AppsPage);\r\n    }\r\n\r\n    listRowClick = async (item:DevApp) => {\r\n        this.app = item;\r\n        let {uqMain:uqMainId} = item;\r\n        let ret = await devApi.loadAppUqs(item.id);\r\n        let mainIdex:number;\r\n        this.uqs = ret.map((v, index) => {\r\n            let {owner, id, name, discription, unit, date_init, date_update} = v;\r\n            let ret = {\r\n                    id: id,\r\n                    name: name,\r\n                    discription: discription,\r\n                    unit: unit,\r\n                    //access: access,\r\n                    owner: owner,\r\n                    date_init: date_init,\r\n                    date_update: date_update, \r\n                    service_count: undefined,\r\n            }\r\n            if (id === uqMainId) {\r\n                this.uqMain = ret;\r\n                mainIdex = index;\r\n            }\r\n            return ret;\r\n        });\r\n        if (mainIdex !== undefined) {\r\n            this.uqs.splice(mainIdex, 1);\r\n            this.uqs.unshift(this.uqMain);\r\n        }\r\n        this.openVPage(AppPage);\r\n    }\r\n\r\n    saveSetUqMain = async (uq:DevUQ) => {\r\n        await devApi.appSetUqMain(this.unitId, this.app.id, uq.id);\r\n        this.setUqMain(uq);\r\n    }\r\n\r\n    private setUqMain(uq:DevUQ) {\r\n        this.uqMain = uq;\r\n        let index = this.uqs.findIndex(v => v.id === uq.id);\r\n        if (index >= 0) {\r\n            this.uqs.splice(index, 1);\r\n        }\r\n        this.uqs.unshift(uq);\r\n    }\r\n\r\n\r\n\r\n    showNewApp = () => {\r\n        this.app = undefined;\r\n        this.openVPage(NewPage);\r\n    }\r\n\r\n    saveApp = async (values: DevApp) => {\r\n        let app: DevApp;\r\n        let now = new Date();\r\n        if (this.app === undefined) {\r\n            app = _.clone(values);\r\n            app.date_init = now;\r\n        }\r\n        else {\r\n            app = _.clone(this.app);\r\n            _.merge(app, values);\r\n        }\r\n        app.unit = this.unitId;\r\n        app.date_update = now;\r\n        let ret = await devApi.saveApp(app);\r\n        app.id = ret;\r\n        let org = this.appList.find(v => v.id === ret);\r\n        if (org !== undefined) {\r\n            _.merge(org, app);\r\n        }\r\n        else {\r\n            this.appList.push(app);\r\n        }\r\n    }\r\n\r\n    isBinded = (uq:DevUQ):boolean => {\r\n        return this.uqs.findIndex(v => v.id === uq.id) >= 0;\r\n    }\r\n\r\n    isMain = (uq:DevUQ):boolean => {\r\n        return this.uqMain !== undefined && this.uqMain.id === uq.id;\r\n    }\r\n\r\n    deleteApp = async () => {\r\n        await devApi.delApp(this.unitId, this.app.id);\r\n        let index = this.appList.findIndex(v => v.id === this.app.id);\r\n        if (index >= 0) this.appList.splice(index, 1);\r\n    }\r\n\r\n    searchUq = async (key:string, pageStart:number, pageSize:number) => {\r\n        return await devApi.searchUq(this.unitId, key, pageStart, pageSize);\r\n    }\r\n\r\n    getMyUqs = async () => {\r\n        return await devApi.getMyUqs(this.unitId);\r\n    }\r\n\r\n    onUq = (uq: DevUQ) => {\r\n        this.openVPage(UqBindPage, uq);\r\n    }\r\n\r\n    saveUqBind = async (uq: DevUQ) => {\r\n        let uqs:number[] = this.uqs.map(v => v.id);\r\n        let index = uqs.findIndex(v => v === uq.id);\r\n        if (index < 0) uqs.push(uq.id);\r\n        await devApi.appBindUq(this.unitId, this.app.id, uqs);\r\n        this.uqs.push(uq);\r\n        if (this.uqs.length === 1) {\r\n            this.setUqMain(uq);\r\n        }\r\n    }\r\n\r\n    removeUqBind = async (uq: DevUQ) => {\r\n        let uqs:number[] = [];\r\n        for (let u of this.uqs) {\r\n            if (u.id !== uq.id) uqs.push(u.id);\r\n        }\r\n        await devApi.appBindUq(this.unitId, this.app.id, uqs);\r\n        let index = this.uqs.findIndex(v => v.id === uq.id);\r\n        if (index>=0) this.uqs.splice(index, 1);\r\n        if (this.uqMain && this.uqMain.id === uq.id) {\r\n            this.uqMain = undefined;\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\nimport ReactDOMServer from 'react-dom/server';\r\nimport { FA } from 'tonva';\r\nimport { observable } from 'mobx';\r\n//import { observer } from 'mobx-react';\r\n\r\nconst groupStart = '///++++++';\r\nconst groupEnd = '------///';\r\n\r\nexport abstract class Section {\r\n    rowId: number;\r\n\trender: () => JSX.Element;\r\n\trenderHtml() {\r\n\t\treturn ReactDOMServer.renderToStaticMarkup(this.render());\r\n\t}\r\n\tafterMount() {}\r\n\tisMe(name:string):boolean {return false;}\r\n}\r\n\r\nclass StringSection extends Section {\r\n    text: string;\r\n    constructor(text:string) {\r\n        super(); \r\n        this.text = text;\r\n    }\r\n    render = (): JSX.Element => {\r\n        if (this.text.trim().length === 0) return null;\r\n        let parts = this.text.split('\\n');\r\n        return <>{parts.map((v, i) => v.length === 0?\r\n            <div key={i}>&nbsp;</div> :\r\n            <div key={i}>{v}</div>\r\n        )}</>;\r\n    }\r\n}\r\n\r\nclass GroupSection extends Section {\r\n\tname: string;\r\n    group: string[];\r\n    @observable collaps: 1|2|3;\r\n    constructor(name:string, group:string[]) {\r\n\t\tsuper();\r\n\t\tthis.name = name;\r\n        this.group = group;\r\n        this.collaps = 1;\r\n\t}\r\n\tget elId() {return 'g' + this.rowId}\r\n\tget cId() {return 'c' + this.rowId}\r\n\tsetCollaps(c:1|2|3) {\r\n\t\tthis.collaps = c;\r\n\t\tlet el = document.getElementById(this.elId);\r\n\t\tlet elIcon = el.firstElementChild;\r\n\t\tif (elIcon) {\r\n\t\t\tlet fa:string;\r\n\t\t\tswitch (c) {\r\n\t\t\t\tcase 1: fa = 'fa fa-spin text-primary'; break;\r\n\t\t\t\tcase 2: fa = 'fa fa-arrow-circle-down text-success'; break;\r\n\t\t\t\tcase 3: fa = 'fa fa-arrow-circle-up text-success'; break;\r\n\t\t\t}\r\n\t\t\telIcon.className = fa;\t\t\t\r\n\t\t}\r\n\t\tif (c === 3) {\r\n             let content = ReactDOMServer.renderToStaticMarkup(<div id={this.cId}>\r\n                {\r\n                    this.group.map((v, i) => {\r\n                        if (v.trim().length === 0) return null;\r\n                        return <pre style={{whiteSpace: 'pre-wrap'}} key={i}>{v}</pre>\r\n                    })\r\n                }\r\n\t\t\t</div>);\r\n\t\t\tconst range = document.createRange();\r\n\t\t\trange.selectNode(el);\r\n\t\t\tconst child = range.createContextualFragment(content);\r\n\t\t\tel.parentNode.insertBefore(child, el.nextSibling);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet c = document.getElementById(this.cId);\r\n\t\t\tif (c) {\r\n\t\t\t\tc.parentNode.removeChild(c);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tisMe(name:string):boolean {\r\n\t\treturn this.name === name;\r\n\t}\r\n\tprivate onClick = () => {\r\n\t\tlet c = this.collaps;\r\n\t\tif (c === 1) return;\r\n\t\tif (c === 2) c = 3;\r\n\t\telse c = 2;\r\n\t\tthis.setCollaps(c);\r\n\t}\r\n\tafterMount() {\r\n\t\tlet el = document.getElementById(this.elId);\r\n\t\tif (el) {\r\n\t\t\tel.addEventListener('click', this.onClick);\r\n\t\t}\r\n\t}\r\n    render = /*observer(*/():JSX.Element => {\r\n        //let groupId = 'text-group-' + index;\r\n        let line = this.group[0];\r\n        let title: string;\r\n        let p0 = 0, p = line.indexOf('\\n');\r\n        if (p < 0) p = undefined;\r\n        else {\r\n            let l = line.indexOf('(');\r\n            if (l < p) p = l;\r\n        }\r\n        title = line.substring(p0, p);\r\n\r\n\t\tlet titleIcon:any, content:any;\r\n\t\tif (this.collaps === 1) {\r\n\t\t\ttitleIcon = <FA name='spinner' className='text-primary fa-spin' />;\r\n\t\t}\r\n        else if (this.collaps===3) {\r\n            titleIcon = <FA name='arrow-circle-up' className='text-success' />;\r\n            content = <div id={this.cId}>\r\n                {\r\n                    this.group.map((v, i) => {\r\n                        if (v.trim().length === 0) return null;\r\n                        return <pre style={{whiteSpace: 'pre-wrap'}} key={i}>{v}</pre>\r\n                    })\r\n                }\r\n            </div>;\r\n        }\r\n        else {\r\n            titleIcon = <FA name='arrow-circle-down' className='text-success' />;\r\n        }\r\n        return <>\r\n            <div id={this.elId} className=\"cursor-pointer text-primary\" onClick={this.onClick}>{titleIcon} <u>{title}</u></div>\r\n            {content}\r\n        </>;\r\n    }//);\r\n}\r\n\r\nclass EndSection extends Section {\r\n\tname: string;\r\n\tconstructor(name:string) {super(); this.name = name}\r\n}\r\n\r\nclass ErrorSection extends Section {\r\n    error: string[];\r\n    constructor(error:string[]) {super(); this.error = error}\r\n    render = ():JSX.Element => {\r\n        return <div className=\"text-danger\">\r\n            <FA name=\"exclamation-circle\" />&nbsp;\r\n            {this.error.join().split('\\n').map((v, index)=><React.Fragment key={index}>{v}<br/></React.Fragment>)}\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class ResultSections {\r\n    private text: string;\r\n    private p: number;\r\n    private group: string[];\r\n    private stop: boolean;\r\n    @observable hasError: boolean = false;\r\n    @observable seconds: number;\r\n    //readonly sections: (string | string[])[] = [];\r\n    private sectionId: number = 1;\r\n\t@observable readonly sections: Section[] = []; //observable.array([], {deep: true});\r\n\tprivate containerElement: HTMLDivElement\r\n\r\n\tconstructor(containerElement: HTMLDivElement) {\r\n\t\tthis.containerElement = containerElement;\r\n\t}\r\n\r\n    add(text:string):void {\r\n        this.stop = false;\r\n        if (this.text === undefined) {\r\n            this.p = 0;\r\n            this.text = text;\r\n        }\r\n        else {\r\n            this.text = this.text + text;\r\n        }\r\n        if (this.text.length < 10) return;\r\n        while (this.stop === false) {\r\n            this.addToGroup();\r\n            this.addText();\r\n        }\r\n\t}\r\n\t\r\n\tprivate addHtml(text:string) {\r\n\t\tconst range = document.createRange();\r\n\t\trange.selectNode(this.containerElement);\r\n\t\tconst child = range.createContextualFragment(text);\r\n\t\tthis.containerElement.appendChild(child);\r\n\t};\r\n\r\n    private addSection(section:Section) {\r\n        section.rowId = this.sectionId;\r\n        this.sectionId++;\r\n\t\tthis.sections.push(section);\r\n\t\t/*\r\n        let len = this.sections.length;\r\n        if (len > 500) {\r\n            this.sections.splice(0, len - 500);\r\n\t\t}\r\n\t\t*/\r\n\t\tlet html = section.renderHtml();\r\n\t\tthis.addHtml(html);\r\n\t\tsection.afterMount();\r\n    }\r\n\r\n    private mayStart(token:string):boolean {\r\n        let len = this.text.length - token.length;\r\n        if (this.p < len) return false;\r\n        for (let i=0; i<len; i++) {\r\n            if (this.text.charCodeAt(this.p + i) !== token.charCodeAt(i)) return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private parse():Section {\r\n        let type: string = '';\r\n\t\tlet len = this.group.length;\r\n        for (let i=0; i<len; i++) {\r\n            let ln = this.group[i];\r\n            let pos = ln.indexOf('\\n');\r\n            if (pos < 0) {\r\n                type += ln;\r\n                continue;\r\n            }\r\n            type += ln.substr(0, pos);\r\n            for (let s=0; s<i+1; s++) this.group.shift();\r\n            this.group.unshift(ln.substr(pos+1));\r\n            switch (type) {\r\n                default:\r\n\t\t\t\tcase '': \r\n                    return new GroupSection(type, this.group);\r\n                case 'error': \r\n                    this.hasError = true;\r\n                    return new ErrorSection(this.group);\r\n            }            \r\n        }\r\n\t\treturn new EndSection(type);\r\n\t}\r\n\r\n    private addToGroup():void {\r\n        if (this.group === undefined) return;\r\n        if (this.text === undefined) return;\r\n        let p = this.text.indexOf(groupEnd, this.p);\r\n        if (p < 0) {\r\n            if (this.mayStart(groupEnd) === true) return;\r\n            this.group.push(this.p === 0? this.text : this.text.substr(this.p));\r\n            this.p = 0;\r\n            this.text = undefined;\r\n            this.stop = true;\r\n            return;\r\n        }\r\n\t\tthis.group.push(this.text.substring(this.p, p));\r\n\t\tlet sec = this.parse();\r\n\t\tif (sec.render !== undefined) {\r\n\t\t\tthis.addSection(sec);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet n = (sec as EndSection).name;\r\n\t\t\tlet len = this.sections.length;\r\n\t\t\tfor (let i=len-1; i>=0; i--) {\r\n\t\t\t\tlet sec = this.sections[i];\r\n\t\t\t\tif (!sec) continue;\r\n\t\t\t\tif (sec.isMe(n) === true) {\r\n\t\t\t\t\t(sec as GroupSection).setCollaps(2);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n        this.group = undefined;\r\n        this.p = p + 9;\r\n    }\r\n\r\n    private addText():void {\r\n        if (this.text === undefined) return;\r\n        let p = this.text.indexOf(groupStart, this.p);\r\n        if (p < 0) {\r\n            if (this.mayStart(groupStart) === true) return;\r\n            this.addSection(new StringSection(this.p === 0? this.text : this.text.substr(this.p)));\r\n            this.p = 0;\r\n            this.text = undefined;\r\n            this.stop = true;\r\n            return;\r\n\t\t}\r\n\t\tlet sec = this.text.substring(this.p, p);\r\n        this.addSection(new StringSection(sec));\r\n        this.p = p + 9;\r\n        this.group = [];\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { UqActionProps } from './uqActionProps';\r\nimport { DevUQ } from 'model';\r\nimport { observer } from 'mobx-react';\r\nimport { ResultSections, Section } from './resultSections';\r\nimport { nav, Page } from 'tonva';\r\n\r\ninterface CompileResultProps extends UqActionProps {\r\n    uq: DevUQ;\r\n\tcaption?: string;\r\n    action: 'upload' | 'test' | 'deploy';\r\n\tactionName: string;\r\n    res: Response;\r\n    abortController: AbortController;\r\n}\r\n\r\n@observer\r\nexport class CompileResultPage extends React.Component<CompileResultProps> {\r\n    private resultSections: ResultSections;\r\n    private timeHandler:any;\r\n    constructor(props:CompileResultProps) {\r\n        super(props);\r\n        this.resultSections = new ResultSections(undefined);\r\n    }\r\n\tprivate autoScrollEnd:boolean = false;\r\n\tprivate autoScroll = true;\r\n    private startAutoScrollToBottom() {\r\n\t\tif (this.autoScrollEnd === true) return;\r\n\t\tthis.autoScroll = true;\r\n\t\tif (this.timeHandler !== undefined) return;\r\n        this.timeHandler = setInterval(() => {\r\n\t\t\tif (this.autoScroll === false) return;\r\n            var pane = document.getElementById('bottomDiv');\r\n            pane && pane.scrollIntoView();\r\n        }, 100);\r\n    }\r\n    private endAutoScrollToBottom() {\r\n        setTimeout(() => {\r\n\t\t\tthis.autoScroll = false;\r\n\t\t\tthis.autoScrollEnd = true;\r\n\t\t\tif (this.timeHandler === undefined) return;\r\n\t\t\tclearInterval(this.timeHandler);\r\n\t\t\tthis.timeHandler = undefined;\r\n\t\t}, 300);\r\n\t}\r\n\tprivate pauseAutoScrollToBottom() {\r\n\t\tthis.autoScroll = false;\r\n\t}\r\n    private getParent(el:HTMLElement):HTMLElement {\r\n        if (!el) return;\r\n        if (el.tagName === 'MAIN') return el;\r\n        return this.getParent(el.parentElement);\r\n    }\r\n    private topIntoView() {\r\n        var pane = document.getElementById('topDiv');\r\n        pane && pane.scrollIntoView();\r\n    }\r\n    private bottomIntoView() {\r\n        var pane = document.getElementById('bottomDiv');\r\n        pane && pane.scrollIntoView();\r\n    }\r\n    private doubleClick = () => {\r\n\t\tif (this.autoScrollEnd === true) return;\r\n        var pane = document.getElementById('scrollDiv');\r\n        let main = this.getParent(pane);\r\n        if (!main) return;\r\n        if (main.scrollTop >= main.scrollHeight / 2) {\r\n            this.topIntoView();\r\n        }\r\n        else {\r\n            this.bottomIntoView();\r\n        }\r\n    }\r\n    private lastScrollTop = 0;\r\n    private onScroll = (e:any) => {\r\n        let el = e.target as HTMLBaseElement;\r\n        let {scrollTop, scrollHeight, offsetHeight} = el;\r\n        if (scrollTop <= this.lastScrollTop) {\r\n            this.pauseAutoScrollToBottom();\r\n        }\r\n        else if (scrollTop + offsetHeight > scrollHeight - 30) {\r\n            this.startAutoScrollToBottom();\r\n        }\r\n\r\n        this.lastScrollTop = scrollTop;\r\n    }\r\n\r\n    private uintToString(uintArray:number[]):string {\r\n        let encodedString = String.fromCharCode(...uintArray);\r\n        try {\r\n            return decodeURIComponent(escape(encodedString));\r\n        }\r\n        catch (err) {\r\n            return encodedString;\r\n        }\r\n    }\r\n\r\n    private startTime: Date;\r\n\tprivate total: number;\r\n    private async pump(reader: ReadableStreamReader<any>, resultSections: ResultSections):Promise<boolean> {\r\n\t\tlet ret = await reader.read();\r\n        let {done, value} = ret;\r\n        if (done) {\r\n            this.resultSections.seconds = (new Date().getTime() - this.startTime.getTime());\r\n            let {action, services} = this.props;\r\n            if (services !== undefined) {\r\n                let now = Date.now() / 1000;\r\n                for (let service of services) {\r\n                    switch (action) {\r\n                        case 'test': service.compile_time = now; break;\r\n                        case 'deploy': service.deploy_time = now; break;\r\n                    }\r\n                }\r\n            }\r\n            return true;\r\n\t\t}\r\n\t\tlet buf:Uint8Array = value;\r\n\t\tfor (let p=0; p<buf.length; p+=0x4000) {\r\n\t\t\tlet sec = buf.slice(p, p+0x4000);\r\n\t\t\tlet text = this.uintToString(sec as any);\r\n\t\t\t//this.resultSections.add(text);\r\n\t\t\tresultSections.add(text);\r\n\t\t\tthis.total += value.byteLength;\r\n\t\t}\r\n        return false;\r\n    }\r\n\r\n    async componentDidMount() {\r\n        nav.regConfirmClose(async ():Promise<boolean>=>{\r\n            if (this.resultSections.seconds>=0) return true;\r\n            return new Promise<boolean>((resolve, reject) => {\r\n                try {\r\n                    if (window.confirm(`正在${this.props.actionName}中，真的要中止吗？`) === true) {\r\n                        try {\r\n                            this.props.abortController.abort();\r\n                        }\r\n                        catch (err) {\r\n                            console.error(err);\r\n                        }\r\n                        resolve(true);\r\n                    }\r\n                    else {\r\n                        resolve(false);\r\n                    }\r\n                }\r\n                catch (err) {\r\n                    reject(err);\r\n                }\r\n            })\r\n        });\r\n        \r\n        this.startAutoScrollToBottom();\r\n        try {\r\n            let reader = this.props.res.body.getReader();\r\n            this.startTime = new Date();\r\n\t\t\tthis.total = 0;\r\n\t\t\tlet containerElement = document.getElementById('scrollDiv') as HTMLDivElement;\r\n\t\t\tlet resultSections = new ResultSections(containerElement);\r\n            while (true) {\r\n\t\t\t\tlet retPump = await this.pump(reader, resultSections);\r\n                if (retPump === true) break;\r\n            }\r\n        }\r\n        catch (err) {\r\n            console.error(err);\r\n        }\r\n        finally {\r\n            this.endAutoScrollToBottom();\r\n        }\r\n    }\r\n    private renderText = (section:Section, index:number):JSX.Element => {\r\n        return <section.render key={section.rowId} />;\r\n    }\r\n    render() {\r\n        let {uq, actionName, caption} = this.props;\r\n        let {seconds, /*sections, */hasError} = this.resultSections;\r\n        let finish = hasError === true? '发生错误' : '完成';\r\n\t\tlet header:string;\r\n\t\tif (caption) header = '[' + caption + '] ';\r\n\t\telse header = '';\r\n        if (uq !== undefined) header += uq.name + ' - ';\r\n\t\theader += actionName + (seconds>=0? finish : \"中...\");\r\n        return <Page header={header} back=\"close\" onScroll={this.onScroll}>\r\n            <div id='topDiv' />\r\n            <div id='scrollDiv'\r\n                onDoubleClick={this.doubleClick} \r\n                className='py-2 px-3' \r\n                style={{wordWrap: 'break-word', whiteSpace: 'normal'}}>\r\n                {/*sections.map(this.renderText)*/}\r\n            </div>\r\n            {seconds>=0? <div className='px-3 pb-3' style={{color: 'red', fontWeight: 'bold'}}>\r\n                {actionName}完成。共计用时{Math.floor(seconds/1000)}秒\r\n            </div> : undefined}\r\n            <div id='bottomDiv' />\r\n        </Page>;\r\n    }\r\n}\r\n","import React, { CSSProperties, MouseEvent, MouseEventHandler, useRef } from \"react\";\r\nimport { useEffect } from \"react\";\r\nimport { useState } from \"react\";\r\n\r\ninterface Props extends React.DetailedHTMLProps<React.ButtonHTMLAttributes<HTMLButtonElement>, HTMLButtonElement> {\r\n    children: React.ReactNode;\r\n}\r\n\r\nexport function ButtonAsync(props: { onClick: (evt: MouseEvent<HTMLButtonElement>) => Promise<void> } & Props): JSX.Element {\r\n    const [isWaiting, setIsWaiting] = useState<boolean>(false);\r\n    let { children, onClick } = props;\r\n    let isMounted = useRef<boolean>(false);\r\n    let newOnClick: MouseEventHandler<HTMLButtonElement> | undefined;\r\n    useEffect(() => {\r\n        isMounted.current = true;\r\n        return () => {\r\n            isMounted.current = false;\r\n        }\r\n    });\r\n    if (onClick) {\r\n        newOnClick = async (evt: MouseEvent<HTMLButtonElement>) => {\r\n            setIsWaiting(true);\r\n            try {\r\n                await onClick(evt);\r\n            }\r\n            catch (err) {\r\n                console.error(err);\r\n                throw err;\r\n            }\r\n            finally {\r\n                if (isMounted.current === true) {\r\n                    setIsWaiting(false);\r\n                }\r\n            }\r\n        };\r\n    }\r\n    if (isWaiting === true) {\r\n        let { className } = props;\r\n        className = (className ?? '') + ' position-relative';\r\n        let style: CSSProperties = {\r\n            zIndex: 30001,\r\n            background: 'rgba(0, 0, 0, 0.3)',\r\n            left: 0,\r\n            top: 0,\r\n            right: 0,\r\n            bottom: 0,\r\n        }\r\n        return <button {...props} disabled={true} className={className}>\r\n            {children}\r\n            <div className=\"d-flex position-absolute align-items-center justify-content-center\" style={style}>\r\n                <i className=\"fa fa-spinner fa-spin\" />\r\n            </div>\r\n        </button>;\r\n    }\r\n    else {\r\n        return <button {...props} onClick={newOnClick}>{children}</button>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { nav, Page } from 'tonva';\r\nimport { List, EasyDate, LMR, Muted } from 'tonva';\r\nimport { store } from '../../store';\r\nimport { UqActionProps } from './uqActionProps';\r\nimport { CompileResultPage } from './compileResultPage';\r\nimport { ButtonAsync } from 'components';\r\n\r\ninterface State {\r\n    files: any[];\r\n    compiled?: string;\r\n    text?: string;\r\n}\r\n\r\n//const fastUpload = '快速测试';\r\n//const thoroughlyUpload = '完全测试';\r\nexport class UqUpload extends React.Component<UqActionProps, State> {\r\n    private fileInput: HTMLInputElement;\r\n\r\n    constructor(props: UqActionProps) {\r\n        super(props);\r\n        this.state = {\r\n            files: undefined,\r\n        }\r\n    }\r\n\r\n    private onFilesChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let upFiles: any[] = [];\r\n        let { files } = evt.target;\r\n        let len = files.length;\r\n        for (let i = 0; i < len; i++) {\r\n            upFiles.push(files[i]);\r\n        }\r\n        this.setState({\r\n            files: upFiles,\r\n        });\r\n    }\r\n    fileRender(file: any, index: number): JSX.Element {\r\n        let { name, size, lastModifiedDate } = file;\r\n        function sz(): string {\r\n            let n: number, u: string;\r\n            if (size < 1024) {\r\n                n = size; u = 'b';\r\n            }\r\n            else if (size < 1024 * 1024) {\r\n                n = Math.trunc((size / 1024) * 100) / 100; u = 'k';\r\n            }\r\n            else {\r\n                n = Math.trunc((size / 1024 / 1024) * 100) / 100; u = 'm';\r\n            }\r\n            return n + ' ' + u;\r\n        }\r\n        return <LMR className=\"px-2 py-1\" right={<Muted>{sz()}</Muted>}>\r\n            <div>{name}</div>\r\n            <div><Muted>修改日期: <EasyDate date={lastModifiedDate} /></Muted></div>\r\n        </LMR>;\r\n    }\r\n    private fileClick = (file: any) => {\r\n        let fr = new FileReader();\r\n        fr.onload = function (f) {\r\n            nav.push(<UqPage name={file.name} content={this.result} />)\r\n        }\r\n        fr.readAsText(file, \"utf8\");\r\n    }\r\n    private onSubmit = (evt: React.FormEvent<any>) => {\r\n        evt.preventDefault();\r\n    }\r\n\r\n    private async upload() {\r\n        var files: FileList = this.fileInput.files;\r\n        var data = new FormData();\r\n        let len = files.length;\r\n        for (let i = 0; i < len; i++) {\r\n            let file = files[i];\r\n            data.append('files[]', file, file.name);\r\n        }\r\n\r\n        let url = store.uqServer + 'uq-compile/' + this.props.uq.id + '/upload';\r\n        try {\r\n            let abortController = new AbortController();\r\n\r\n            let res = await fetch(url, {\r\n                method: \"POST\",\r\n                body: data,\r\n                signal: abortController.signal,\r\n                headers: buildHeaders()\r\n            });\r\n            nav.push(<CompileResultPage {...this.props}\r\n                actionName=\"上传\"\r\n                action=\"upload\"\r\n                res={res} abortController={abortController} />);\r\n        }\r\n        catch (e) {\r\n            console.error('%s %s', url, e);\r\n        }\r\n    }\r\n    private onUpload = async () => {\r\n        nav.ceaseTop();\r\n        await this.upload();\r\n    }\r\n    render() {\r\n        let { files } = this.state;\r\n        let fileList: any;\r\n        if (files !== undefined) {\r\n            fileList = <List\r\n                className=\"my-3\"\r\n                items={files}\r\n                item={{ render: this.fileRender, onClick: this.fileClick }} />;\r\n        }\r\n        let button: any;\r\n        if (files !== undefined && files.length > 0) {\r\n            button = <div className=\"my-2 d-flex\">\r\n                <button className=\"btn btn-primary\" type=\"submit\" onClick={this.onUpload}>提交UQ</button>\r\n            </div>;\r\n        }\r\n        return <Page header={'提交UQ - ' + this.props.uq.name}>\r\n            <div className=\"py-2 px-3\">\r\n                <form className=\"my-1\" encType=\"multipart/form-data\" onSubmit={this.onSubmit}>\r\n                    <div className=\"my-1\">\r\n                        <button className=\"btn btn-outline-success\"\r\n                            onClick={() => this.fileInput.click()}>选择UQ源代码文件</button>\r\n                        <input\r\n                            ref={(fileInput) => this.fileInput = fileInput}\r\n                            type=\"file\"\r\n                            className=\"w-100 form-control-file d-none\"\r\n                            name=\"files\" multiple={true}\r\n                            onChange={this.onFilesChange} />\r\n                    </div>\r\n                    {fileList}\r\n                    {button}\r\n                </form>\r\n                <pre>{this.state.compiled}</pre>\r\n                <div>{this.state.text}</div>\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n\r\ninterface Options {\r\n    action: 'test' | 'deploy';\r\n    caption: string;\r\n    compile: string;\r\n    //fast: string;\r\n    //thoroughly: string;\r\n    description: any;\r\n}\r\nconst test: Options = {\r\n    action: 'test',\r\n    caption: '测试版',\r\n    compile: '编译',\r\n    //fast: '快速编译',\r\n    //thoroughly: '完全编译',\r\n    description: <>\r\n        <li>用上传的UQ代码，生成测试数据库</li>\r\n        <li>自动做增量快速编译。比较源代码，仅对修改的源代码，生成数据库</li>\r\n        <li>编译器升级后，会自动完全编译</li>\r\n    </>\r\n}\r\n\r\nconst deploy: Options = {\r\n    action: 'deploy',\r\n    caption: '发布版',\r\n    compile: '编译',\r\n    //fast: '快速编译',\r\n    //thoroughly: '完全编译',\r\n    description: <>\r\n        <li>将已经编译测试过的代码，发布到生产服务器</li>\r\n        <li>自动做增量快速编译。比较源代码，仅对修改的源代码，生成数据库</li>\r\n        <li>编译器升级后，会自动完全编译</li>\r\n    </>\r\n}\r\n\r\nexport class UqDeploy extends React.Component<UqActionProps> {\r\n    readonly options: Options;\r\n    constructor(props: UqActionProps) {\r\n        super(props);\r\n        switch (props.action) {\r\n            case 'test':\r\n                this.options = test;\r\n                break;\r\n            case 'deploy':\r\n                this.options = deploy;\r\n                break;\r\n        }\r\n    }\r\n\r\n    private onCompile = async (e: React.MouseEvent<HTMLButtonElement>) => {\r\n        e.currentTarget.disabled = true;\r\n        nav.ceaseTop();\r\n        //let thoroughly = false;\r\n        await this.compile(/*thoroughly*/);\r\n    }\r\n    /*\r\n    private onCompileThoroughly = async () => {\r\n        nav.ceaseTop();\r\n        let thoroughly = true;\r\n        await this.compile(thoroughly);\r\n    }\r\n    */\r\n    private async compile(/*isThoroughly: boolean*/) {\r\n        let { caption, action, compile/* thoroughly, fast*/ } = this.options;\r\n        let url = store.uqServer + 'uq-compile/' + this.props.uq.id + '/' + action;\r\n        let actionName: string;\r\n        /*if (isThoroughly === true) {\r\n            actionName = thoroughly;\r\n            url += '-thoroughly';\r\n        }\r\n        else {*/\r\n        actionName = compile; //fast;\r\n        //}\r\n        try {\r\n            let abortController = new AbortController();\r\n            let res = await fetch(url, {\r\n                method: \"POST\",\r\n                signal: abortController.signal,\r\n                headers: buildHeaders(),\r\n            });\r\n            nav.push(<CompileResultPage {...this.props}\r\n                caption={caption}\r\n                action={action}\r\n                actionName={actionName}\r\n                res={res} abortController={abortController} />);\r\n        }\r\n        catch (e) {\r\n            console.error('%s %s', url, e);\r\n        }\r\n    }\r\n    render() {\r\n        let { caption, compile, /*fast, thoroughly, */description } = this.options;\r\n        return <Page header={caption + ' - ' + this.props.uq.name}>\r\n            <div className=\"bg-white p-3\">\r\n                <ul className=\"my-3\">{description}</ul>\r\n                <div className=\"d-flex p-3 justify-content-center\">\r\n                    <ButtonAsync className=\"btn btn-primary w-8c\"\r\n                        type=\"submit\" onClick={this.onCompile}>\r\n                        {compile}\r\n                    </ButtonAsync>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface UqPgeProps {\r\n    name: string;\r\n    content: string | ArrayBuffer;\r\n}\r\nclass UqPage extends React.Component<UqPgeProps> {\r\n    render() {\r\n        return <Page header={this.props.name}>\r\n            <pre className=\"px-3 py-2\">{this.props.content}</pre>\r\n        </Page>;\r\n    }\r\n}\r\n\r\n\r\nfunction buildHeaders(): { [name: string]: string } {\r\n    let headers: { [name: string]: string } = {};\r\n    headers['user-token'] = nav.userToken;\r\n    return headers;\r\n}\r\n","import { IdPickProps, createIdPick } from '../../tools';\r\nimport { store, caches } from 'store';\r\nimport { Field, FormRow, TonvaForm, SubmitResult } from 'tonva-form';\r\nimport { CUq } from './CUq';\r\nimport { VPage, nav, Page } from 'tonva';\r\nimport { DevServer, Unit } from 'model';\r\n\r\nconst ServerCaption = (item:DevServer) => {\r\n    let {discription, cloud, ip} = item;\r\n    return <>{discription} {cloud} {ip}</>;\r\n}\r\n\r\nconst idPickServerProps: IdPickProps = {\r\n    caption: '选择服务器',\r\n    searchPlaceHolder: '搜索服务器',\r\n    candidateItems: async (params:any, key:string) => {\r\n        await store.dev.searchServer.first(key);\r\n        return store.dev.searchServer.items;\r\n    },\r\n    moreCandidates: async () => {\r\n        await store.dev.searchServer.more();\r\n    },\r\n    row: (item:DevServer, index:number) => {\r\n        return <div className=\"px-3 py-2\"><ServerCaption {...item} /></div>;\r\n    },\r\n};\r\n\r\nconst serverField:Field = {name: 'server', type: 'id', required: true};\r\nconst testServerField:Field = {name: 'serverTest', type: 'id', required: true};\r\nconst uqUniqueUnitField:Field = {name: 'uqUniqueUnit', type: 'id', required: true};\r\nconst dbField:Field = {name: 'db', type: 'string', maxLength:50, required: true};\r\n\r\nconst fromPicked = (item:DevServer)=>{\r\n\treturn {\r\n\t\tid: item.id, \r\n\t\tcaption: <ServerCaption {...item} />,\r\n\t};\r\n}\r\n\r\nconst itemFromId = (id:number)=>caches.servers.get(id);\r\n\r\nconst serverRow = {\r\n    label: '运行服务器',\r\n    field: serverField,\r\n    face: {\r\n        type: 'pick-id', \r\n        initCaption: '请选择运行服务器', \r\n        pick: createIdPick(idPickServerProps), //this.idPick,\r\n        fromPicked: fromPicked,\r\n        itemFromId: itemFromId,\r\n    },\r\n};\r\n\r\nconst testServerRow = {\r\n    label: '测试服务器', \r\n    field: testServerField,\r\n    face: {\r\n        type: 'pick-id', \r\n        initCaption: '请选择测试服务器', \r\n        pick: createIdPick(idPickServerProps), //this.idPick,\r\n        fromPicked: fromPicked,\r\n        itemFromId: itemFromId,\r\n    },\r\n};\r\n\r\n\r\nconst UnitCaption = (item:Unit) => {\r\n    let {name, discription} = item;\r\n    return <>{name ?? discription}</>;\r\n}\r\nconst idPickUnitProps: IdPickProps = {\r\n    caption: '选择小号($unit)',\r\n    searchPlaceHolder: '搜索小号($unit)',\r\n    candidateItems: async (params:any, key:string) => {\r\n        // await store.dev.searchServer.first(key);\r\n        //return store.dev.searchServer.items;\r\n        return store.accUnits;\r\n    },\r\n    moreCandidates: async () => {\r\n        // await store.dev.searchServer.more();\r\n    },\r\n    row: (item:Unit, index:number) => {\r\n        return <div className=\"px-3 py-2\"><UnitCaption {...item} /></div>;\r\n    },\r\n};\r\n\r\nconst uqUniqueUnitRow = {\r\n    label: '小号($unit)',\r\n    field: uqUniqueUnitField,\r\n    face: {\r\n        type: 'pick-id', \r\n        initCaption: '请选择小号($unit)', \r\n        pick: createIdPick(idPickUnitProps), \r\n        fromPicked: (item:Unit)=>{\r\n            return {\r\n                id: item.id, \r\n                caption: <UnitCaption {...item} />,\r\n            };\r\n        },\r\n        itemFromId: (id:number)=>caches.units.get(id),\r\n    },\r\n};\r\n\r\nconst dbRow = {\r\n    label: '数据库名字',\r\n    field: dbField,\r\n};\r\n\r\nexport class NewServicePage extends VPage<CUq> {\r\n    private formRows:FormRow[] = [\r\n        dbRow,\r\n        uqUniqueUnitRow,\r\n\t\tserverRow,\r\n\t\ttestServerRow,\r\n    ];\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n    private onSubmit = async (values:any):Promise<SubmitResult | undefined> => {\r\n        values.type = 2; // uq type, to be removed\r\n        values.uqId = this.controller.uq.id;\r\n        let ret = await this.controller.saveService(values);\r\n        if (ret === 0) {\r\n            return;\r\n        }\r\n        nav.pop();\r\n        return;\r\n    }\r\n    private page = () => {\r\n        return <Page header=\"新建Service\">\r\n            <TonvaForm className=\"m-3\" formRows={this.formRows} onSubmit={this.onSubmit} />\r\n        </Page>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { Page, VPage, nav } from 'tonva';\r\nimport { CUq } from './CUq';\r\nimport { Prop, PropGrid } from 'tonva';\r\nimport { StringValueEdit, ServerSpan, UnitSpan } from 'tools';\r\nimport { observer } from 'mobx-react';\r\nimport { DevService } from 'model';\r\n\r\nexport class ServicePage extends VPage<CUq> {\r\n    @observable private service: DevService;\r\n    async open(service: DevService) {\r\n        this.service = service;\r\n        this.openPage(this.page);\r\n    }\r\n    private async changeProp(prop:string, value:any):Promise<any> {\r\n        return await this.controller.changeServiceProp(this.service, prop, value);\r\n\t}\r\n    private onDbChanged = async (value:any, orgValue:any):Promise<string|void> => {\r\n        let ret = await this.changeProp('db', value);\r\n        if (ret === 0) {\r\n            return 'Db已经被使用了';\r\n        }\r\n        this.service.db = value;\r\n    }\r\n    private onUnitPick = async () => {\r\n        let ret = await this.controller.pickUnit();\r\n        this.changeProp('uq_unique_unit', ret);\r\n        this.service.uqUniqueUnit = ret;\r\n    }\r\n    private onServerPick = async () => {\r\n        let ret = await this.controller.pickServer();\r\n        this.changeProp('server', ret);\r\n        this.service.server = ret;\r\n    }\r\n    private onServerTestPick = async () => {\r\n        let ret = await this.controller.pickServer();\r\n        this.changeProp('server_test', ret);\r\n        this.service.serverTest = ret;\r\n    }\r\n    private onDeleteClick = async () => {\r\n        if (window.confirm(\"真的要删除Service吗？删除了不可恢复，需要重新录入。\")!==true) return;\r\n        await this.controller.delService(this.service);\r\n        nav.pop();\r\n    }\r\n    private page = observer(() => {\r\n        let {uq} = this.controller;\r\n        let rows:Prop[] = [\r\n            '',\r\n            {\r\n                type: 'string',\r\n                name: 'db',\r\n                label: '数据库名',\r\n                onClick: ()=>nav.push(<StringValueEdit \r\n                    title=\"数据库名字\"\r\n                    value={this.service.db}\r\n                    onChanged={this.onDbChanged} />)\r\n            },\r\n            {\r\n                type: 'component',\r\n                label: '小号($unit)',\r\n                component: <UnitSpan id={this.service.uqUniqueUnit} />,\r\n                onClick: this.onUnitPick\r\n            },\r\n            '',\r\n            {\r\n                type: 'component',\r\n                label: '生产服务器',\r\n                component: <ServerSpan id={this.service.server} />,\r\n                onClick: this.onServerPick\r\n            },\r\n            {\r\n                type: 'component',\r\n                label: '测试服务器',\r\n                component: <ServerSpan id={this.service.serverTest} />,\r\n                onClick: this.onServerTestPick\r\n\t\t\t},\r\n        ];\r\n        let right = <button onClick={this.onDeleteClick} \r\n            className=\"btn btn-sm btn-success align-self-center\">删除</button>;\r\n        return <Page header={'UQ - ' + uq.name} right={right}>\r\n            <PropGrid rows={rows} values={this.service} />\r\n        </Page>\r\n    })\r\n}\r\n\r\n","import { CUq } from './CUq';\r\nimport { VPage, nav, Page } from 'tonva';\r\nimport { SubmitResult, TonvaForm } from 'tonva-form';\r\n\r\nconst formRows = [\r\n    {\r\n        label: '名称', \r\n        field: {name: 'name', type: 'string', maxLength: 100, required: true},\r\n    },\r\n    {\r\n        label: '描述',\r\n        field: {name: 'discription', type: 'string', maxLength: 250},\r\n        face: {type: 'textarea'}\r\n    },\r\n    //{\r\n    //    label: '入口',\r\n    //    field: {name: 'access', type: 'string', maxLength: 250},\r\n    //    face: {type: 'textarea', placeholder: '逗号分隔的入口名'}\r\n    //},\r\n];\r\n\r\n\r\nexport abstract class EditBasePage extends VPage<CUq> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n    protected onSubmit = async (values:any):Promise<SubmitResult> => {\r\n        await this.controller.saveUq(values);\r\n        nav.pop();\r\n        return;\r\n    }\r\n    protected page: ()=>JSX.Element;\r\n    protected form(initValues:any):JSX.Element {\r\n        return <TonvaForm\r\n            className=\"m-3\"\r\n            formRows={formRows} \r\n            onSubmit={this.onSubmit} initValues={initValues} />\r\n    }\r\n}\r\n\r\nexport class EditPage extends EditBasePage {\r\n    protected page = () => {\r\n        let {uq} = this.controller;\r\n        let {name} = uq;\r\n        return <Page header={'修改UQ - ' + name} back=\"close\">\r\n            {this.form(uq)}\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class NewPage extends EditBasePage {\r\n    protected page = () => {\r\n        return <Page header={'新建UQ'} back=\"close\">\r\n            {this.form({})}\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, nav, EasyTime } from 'tonva';\r\nimport { CUq } from './CUq';\r\nimport { IdDates, UnitSpan, ServerSpan } from 'tools';\r\nimport { Prop, LMR, FA, PropGrid, Muted, List, DropdownActions } from 'tonva';\r\nimport { EditPage } from './editPage';\r\nimport { store } from 'store';\r\nimport { observer } from 'mobx-react';\r\nimport { DevService } from 'model';\r\n\r\nexport class UQPage extends VPage<CUq> {\r\n    async open() {\r\n        this.openPageElement(React.createElement(this.page));\r\n    }\r\n\r\n    private editItem = async () => {\r\n        await this.openVPage(EditPage);\r\n    }\r\n\r\n    private deleteItem = async () => {\r\n        if (window.confirm('真的要删除UQ吗？') === true) {\r\n            await this.controller.deleteUq();\r\n            nav.pop();\r\n        }\r\n    }\r\n\r\n    private page = observer((): JSX.Element => {\r\n        let { onUqUpload, onUqTest, onUqDeploy, onUqDevsAdmin, serviceClick, uq, services } = this.controller;\r\n        let { unit } = store;\r\n        let { isOwner } = unit;\r\n        let { name, discription, unit: unitId, date_init, date_update } = uq;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        let menuItems = [\r\n            { caption: '修改UQ', action: this.editItem, icon: 'edit' },\r\n            { caption: '删除', action: this.deleteItem, icon: 'trash-o' }\r\n        ];\r\n        let right = isOwner > 0 && <DropdownActions className=\"btn-primary me-2\" actions={menuItems} />;\r\n        let angle = <FA className=\"align-self-center\" name=\"angle-right\" />;\r\n        let action = (icon: string, cnIcon: string, label: string, onClick: () => void): Prop => {\r\n            return {\r\n                type: 'component',\r\n                label: undefined, // '上传UQ', \r\n                component: <LMR onClick={onClick} className=\"w-100 py-2 cursor-pointer\"\r\n                    left={<span className=\"align-self-center\"><FA className={cnIcon} name={icon} fixWidth={true} /> &nbsp; {label}</span>} right={angle} />\r\n            };\r\n        };\r\n        let rows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <LMR className=\"py-2\"\r\n                    left={<FA name=\"database\" className=\"text-primary fa-2x me-3\" />}>\r\n                    <div><b>{name}</b></div>\r\n                    {disp}\r\n                </LMR>\r\n            },\r\n            {\r\n                type: 'component',\r\n                label: '开发号',\r\n                component: <div className=\"py-2\"><UnitSpan id={unitId} isLink={true} /></div>\r\n            },\r\n            '',\r\n            action('code', 'text-info', '上传提交UQ代码', onUqUpload),\r\n            action('database', 'text-warning', '测试版 - 编译UQ数据库', onUqTest),\r\n            action('database', 'text-success', '发布版 - 编译UQ数据库', onUqDeploy),\r\n        ];\r\n\r\n        let adminDev: any;\r\n        let btnAddService: any;\r\n        if (isOwner > 0) {\r\n            btnAddService = <button\r\n                className=\"btn btn-outline-primary btn-sm\"\r\n                onClick={() => this.controller.showNewServicePage()}>\r\n                增加\r\n            </button>;\r\n            let devList = this.controller.uqDevs.filter(v => v.isOwner === 0);\r\n            adminDev = <>\r\n                <div className=\"d-flex mx-3 mt-3 mb-1 align-items-end\">\r\n                    <Muted style={{ display: 'block', flex: 1 }}>开发者</Muted>\r\n                    <button\r\n                        className=\"btn btn-outline-primary btn-sm\"\r\n                        onClick={onUqDevsAdmin}>\r\n                        管理\r\n                    </button>\r\n                </div>\r\n                <div className=\"px-3 py-2 d-flex flex-wrap bg-white\">\r\n                    {\r\n                        devList.length === 0 ?\r\n                            <div className=\"small text-muted\">[无]</div>\r\n                            :\r\n                            devList.map((v: any) => {\r\n                                return <div key={v.userId} className=\"my-2 me-3\">{v.nick || v.name}</div>\r\n                            })}\r\n                </div>\r\n            </>;\r\n        }\r\n\r\n        let onServiceClick: any;\r\n        if (isOwner > 0) onServiceClick = serviceClick;\r\n\r\n        return <Page header={'UQ - ' + name} right={right}>\r\n            <PropGrid rows={rows} values={uq} />\r\n            {adminDev}\r\n            <div className=\"d-flex mx-3 mt-3 mb-1 align-items-end\">\r\n                <Muted style={{ display: 'block', flex: 1 }}>Service</Muted>\r\n                {btnAddService}\r\n            </div>\r\n            <List items={services} item={{\r\n                render: (service: DevService, index: number) =>\r\n                    React.createElement(this.renderService, { service, index }),\r\n                onClick: onServiceClick\r\n            }} />\r\n        </Page>;\r\n    });\r\n    private renderService = observer((props: { service: DevService; index: number }): JSX.Element => {\r\n        let { service } = props;\r\n        let { db, server, serverTest, uqUniqueUnit, compile_time, deploy_time } = service;\r\n        let compile = !compile_time ?\r\n            <Muted>未测试</Muted>\r\n            :\r\n            <EasyTime date={compile_time} />;\r\n        let deploy = !deploy_time ?\r\n            <Muted>未发布</Muted>\r\n            :\r\n            <EasyTime date={deploy_time} />;\r\n\r\n        return <div className=\"d-block w-100 cursor-pointer mb-2 py-2 px-3\">\r\n            <div>\r\n                <small>数据库名：</small>{db}\r\n                &nbsp; &nbsp; &nbsp;\r\n                <small>小号($unit)：</small><UnitSpan id={uqUniqueUnit} />\r\n            </div>\r\n            <LMR className=\"align-items-center\"\r\n                right={<small>{deploy}</small>}>\r\n                <div>\r\n                    <small>生产：</small>\r\n                    <ServerSpan id={server} />\r\n                </div>\r\n            </LMR>\r\n            <LMR className=\"align-items-center\"\r\n                right={<small>{compile}</small>}>\r\n                <div>\r\n                    <small>测试：</small>\r\n                    <ServerSpan id={serverTest} />\r\n                </div>\r\n            </LMR>\r\n        </div>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, EasyTime, DropdownActions, DropdownAction, nav } from 'tonva';\r\nimport { CUq } from './CUq';\r\nimport { List, LMR, Muted, FA } from 'tonva';\r\nimport { NewPage } from './editPage';\r\nimport { store } from 'store';\r\nimport { DevUQ } from 'model';\r\nimport { CompileResultPage } from './compileResultPage';\r\n\r\nexport class ListPage extends VPage<CUq> {\r\n    async open(param: any) {\r\n        this.openPage(this.page);\r\n    }\r\n    private newItem = () => {\r\n        this.controller.uq = undefined;\r\n        this.openVPage(NewPage);\r\n    }\r\n    private batchCompile = () => {\r\n        this.openPage(this.batchCompilePage);\r\n    }\r\n    private page = (): JSX.Element => {\r\n        let { uqList: list, listRowClick } = this.controller;\r\n        let { isOwner } = store.unit;\r\n        let actions: DropdownAction[] = [\r\n            { icon: 'plus', caption: '新增UQ', action: this.newItem },\r\n            { icon: 'plus', caption: '批量编译', action: this.batchCompile },\r\n        ];\r\n        let right = isOwner > 0 &&\r\n            <DropdownActions className=\"btn-primary me-2 align-self-center\" icon=\"bars\" actions={actions}>\r\n                <button className='btn btn-primary btn-sm' onClick={() => this.newItem()}><FA name=\"plus\" /></button>\r\n            </DropdownActions>\r\n        return <Page header=\"UQ\" right={right}>\r\n            <List items={list} item={{ render: this.listRow, onClick: listRowClick }} />\r\n        </Page>\r\n    }\r\n    private listRow = (item: DevUQ): JSX.Element => {\r\n        let { name, discription, service_count, date_update } = item;\r\n        return <LMR className=\"py-1 px-3 align-items-center\"\r\n            left={<FA name=\"database\" className=\"text-primary fa-lg\" />}\r\n            right={<div className=\"text-end\">\r\n                <div><small className=\"text-muted\">服务数:</small> {service_count}</div>\r\n                <div className=\"small text-muted\"><EasyTime date={date_update} /></div>\r\n            </div>}>\r\n            <div className=\"py-2 px-3\">\r\n                <div><b>{name}</b></div>\r\n                <div><Muted>{discription}</Muted></div>\r\n            </div>\r\n        </LMR>;\r\n    }\r\n\r\n    private onSelect = (item: DevUQ, isSelected: boolean, anySelected: boolean) => {\r\n        //alert('ok');\r\n    }\r\n\r\n    private listCompileRow = (item: DevUQ): JSX.Element => {\r\n        let { name, discription, date_update } = item;\r\n        return <LMR className=\"py-1 px-3 align-items-center\"\r\n            left={<FA name=\"database\" className=\"text-info fa-lg\" />}\r\n            right={<div className=\"text-end\">\r\n                <div className=\"small text-muted\"><EasyTime date={date_update} /></div>\r\n            </div>}>\r\n            <div className=\"py-2 px-3\">\r\n                <div><b>{name}</b></div>\r\n                <div><Muted>{discription}</Muted></div>\r\n            </div>\r\n        </LMR>;\r\n    }\r\n\r\n    private list: List;\r\n    private selectAll = () => {\r\n        this.list.selectAll();\r\n    }\r\n    private unselectAll = () => {\r\n        this.list.unselectAll();\r\n    }\r\n    private test = () => {\r\n        this.compile('test', false);\r\n    }\r\n    /*\r\n    根据uq编译器版本，自动决定是不是需要彻底编译\r\n    private testThoroughly = () => {\r\n        this.compile('test', true);\r\n    }\r\n    */\r\n    private deploy = () => {\r\n        this.compile('deploy', false);\r\n    }\r\n    /*\r\n    根据uq编译器版本，自动决定是不是需要彻底编译\r\n    private deployThoroughly = () => {\r\n        this.compile('deploy', true);\r\n    }\r\n    */\r\n    private async compile(action: 'test' | 'deploy', thoroughly: boolean) {\r\n        let selectItems = this.list.selectedItems;\r\n        //let {action, thoroughly, fast} = this.options;\r\n        let url = store.uqServer + 'uq-compile/batch';\r\n        let actionName: string;\r\n        switch (action) {\r\n            case 'test': actionName = '测试'; break;\r\n            case 'deploy': actionName = '发布'; break;\r\n        }\r\n        try {\r\n            let abortController = new AbortController();\r\n            let body = {\r\n                test: action === 'test',\r\n                thoroughly: thoroughly,\r\n                uqs: selectItems.map(v => v.id)\r\n            };\r\n            //let data = new FormData();\r\n            //data.append( \"json\", JSON.stringify(body) );\r\n            let res = await fetch(url, {\r\n                method: \"POST\",\r\n                signal: abortController.signal,\r\n                headers: {\r\n                    //'Accept': 'application/json',\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify(body)\r\n            });\r\n            nav.push(<CompileResultPage uq={undefined} services={undefined}\r\n                action={action}\r\n                actionName={actionName}\r\n                res={res} abortController={abortController} />);\r\n        }\r\n        catch (e) {\r\n            console.error('%s %s', url, e);\r\n        }\r\n    }\r\n\r\n    private batchCompilePage = (): JSX.Element => {\r\n        let { uqList: list } = this.controller;\r\n        let right = <span>\r\n            <button className=\"btn btn-sm btn-link\" onClick={this.selectAll}>全选</button>\r\n            <button className=\"btn btn-sm btn-link\" onClick={this.unselectAll}>全清</button>\r\n        </span>;\r\n        let cnBtn = 'btn btn-sm btn-outline-primary me-3';\r\n        let bar = <span className=\"px-3 py-1 d-flex w-100\">\r\n            <span className=\"flex-grow-1\">\r\n                <button className={cnBtn} onClick={this.test}>测试</button>\r\n                <button className={cnBtn} onClick={this.deploy}>发布</button>\r\n            </span>\r\n            {right}\r\n        </span>;\r\n        /*\r\n        根据uq编译器版本，自动决定是不是需要彻底编译\r\n        <button className={cnBtn} onClick={this.testThoroughly}>彻底测试</button>\r\n        <button className={cnBtn} onClick={this.deployThoroughly}>彻底发布</button>\r\n        */\r\n\r\n        return <Page header=\"批量编译\" footer={bar}>\r\n            <List ref={list => this.list = list} items={list} item={{ render: this.listCompileRow, onSelect: this.onSelect }} />\r\n        </Page>\r\n    }\r\n}\r\n\r\n","import { VPage, Page, LMR, Image, List } from 'tonva';\r\nimport { CUq } from './CUq';\r\nimport { UnitAdmin } from '../../model';\r\n\r\nexport class VUqDevsAdmin extends VPage<CUq> {\r\n    async open() {\r\n        await this.controller.loadAdmins();\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onSelect = async (admin: any, isSelected: boolean) => {\r\n        await this.controller.devChanged(admin, isSelected);\r\n    }\r\n\r\n    private page = (): JSX.Element => {\r\n        let { uqDevs, admins } = this.controller;\r\n        let selectedItems = admins.devs.filter(v => uqDevs.find(d => d.userId === v.id) !== undefined);\r\n        let listHeader = <div className=\"px-3 py-1 small text-muted\">开发者</div>;\r\n        return <Page header=\"增减开发者\">\r\n            <div className='my-3'>\r\n                {listHeader}\r\n                <List\r\n                    items={admins.devs}\r\n                    none='[无]'\r\n                    selectedItems={selectedItems}\r\n                    item={{ onSelect: this.onSelect, render: this.row }}\r\n                />\r\n            </div>\r\n        </Page>;\r\n    }\r\n\r\n    private row = ({ icon, name, nick }: UnitAdmin) => {\r\n        let content = nick ?\r\n            <><b>{nick}</b> &nbsp; <small className=\"text-muted\">{name}</small></>\r\n            :\r\n            <b>{name}</b>;\r\n        let left = <Image className=\"w-2-5c h-2-5c\" src={icon} />;\r\n        return <LMR className=\"py-2 px-3 align-items-stretch\" left={left}>\r\n            <div className=\"px-3\">{content}</div>\r\n        </LMR>;\r\n    }\r\n\r\n}\r\n","import { CUqBase } from \"UqApp\";\r\nimport { VPage, Page, SearchBox, List, PageItems } from \"tonva\";\r\nimport { observer } from 'mobx-react';\r\nimport { devApi } from 'api';\r\nimport { store } from 'store';\r\nimport { ServerSpan } from 'tools';\r\nimport { DevServer } from 'model';\r\n\r\nexport class CPickServer extends CUqBase {\r\n    pageItems: PageServerItems;\r\n\r\n    async internalStart() {\r\n        this.pageItems = new PageServerItems();\r\n    }\r\n\r\n    async pick(): Promise<number> {\r\n        this.pageItems = new PageServerItems();\r\n        await this.pageItems.first('');\r\n        return await this.vCall(VPickServer);\r\n    }\r\n\r\n    onSearch = async (key: string): Promise<void> => {\r\n        await this.pageItems.first(key);\r\n    }\r\n}\r\n\r\nclass PageServerItems extends PageItems<DevServer> {\r\n    protected async loadResults(param: any, pageStart: any, pageSize: number): Promise<{ [name: string]: DevServer[] }> {\r\n        let unitId = store.unit.id;\r\n        let ret = await devApi.searchServer(unitId, param, pageStart, pageSize);\r\n        return { $page: ret };\r\n    }\r\n    protected setPageStart(item: DevServer): void {\r\n        this.pageStart = item === undefined ? 0 : item.id;\r\n    }\r\n}\r\n\r\nclass VPickServer extends VPage<CPickServer> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderServer = (server: DevServer, index: number): JSX.Element => {\r\n        return <div className=\"px-3 py-2\"><ServerSpan id={server.id} /></div>;\r\n    }\r\n\r\n    private clickServer = (server: DevServer) => {\r\n        this.closePage();\r\n        this.returnCall(server.id);\r\n    }\r\n\r\n    private onClickNullServer = () => {\r\n        this.closePage();\r\n        this.returnCall(null);\r\n    }\r\n\r\n    private page = observer((): JSX.Element => {\r\n        let searchBox = <SearchBox label=\"选择服务器\" onSearch={this.controller.onSearch} />\r\n        return <Page header={searchBox}>\r\n            <div className=\"px-3 py-2 cursor-pointer bg-white border-bottom\"\r\n                onClick={this.onClickNullServer}>\r\n                <span className=\"text-danger me-3\">NULL</span>\r\n                <small className=\"text-muted\">[不选服务器]</small>\r\n            </div>\r\n            <List items={this.controller.pageItems.items}\r\n                item={{ render: this.renderServer, onClick: this.clickServer }} />\r\n        </Page>;\r\n    });\r\n}\r\n","import {observable} from 'mobx';\r\nimport {Unit, UnitAdmin} from '../model';\r\nimport {mainApi} from '../api';\r\n//import {Store} from './store';\r\n\r\nexport class Admins {\r\n    //private store:Store;\r\n    private unit: Unit;\r\n    constructor(unit: Unit/*store:Store*/) {\r\n        //this.store = store;\r\n        this.unit = unit;\r\n    }\r\n\r\n    @observable cur: UnitAdmin = undefined;\r\n    @observable owners: UnitAdmin[] = undefined;\r\n    @observable admins: UnitAdmin[] = undefined;\r\n    @observable devs: UnitAdmin[] = undefined;\r\n    \r\n    async load(): Promise<void> {\r\n        let unit = this.unit;\r\n        if (unit === undefined) return;\r\n        if (unit.id === undefined) return;\r\n        if (this.admins !== undefined) return;\r\n        let all = await mainApi.unitAdmins(unit.id);\r\n        let owners:UnitAdmin[] = [];\r\n        let admins:UnitAdmin[] = [];\r\n        let devs:UnitAdmin[] = [];\r\n        all.forEach(ua => {\r\n            let {isOwner, isAdmin, isDev} = ua;\r\n            if (isDev)\r\n                devs.push(ua);\r\n            else {\r\n                if (isOwner === 1) owners.push(ua);\r\n                if (isAdmin === 1) admins.push(ua);\r\n            }\r\n        });\r\n        this.owners = owners;\r\n        this.admins = admins;\r\n        this.devs = devs;\r\n    }\r\n\r\n    private removeOneUnitAdmin(arr: UnitAdmin[], unitAdmin?: UnitAdmin) {\r\n        let index = arr.findIndex(v => v.id===unitAdmin.id);\r\n        if (index >=0) arr.splice(index, 1);\r\n    }\r\n\r\n    private removeUnitAdmin(unitAdmin?: UnitAdmin) {\r\n        if (unitAdmin === undefined) unitAdmin = this.cur;\r\n        this.removeOneUnitAdmin(this.owners, unitAdmin);\r\n        this.removeOneUnitAdmin(this.admins, unitAdmin);\r\n        this.removeOneUnitAdmin(this.devs, unitAdmin);\r\n    }\r\n\r\n    async unitSetAdmin(isOwner:number, isAdmin:number, isDev:number) {\r\n        let cur = this.cur;\r\n        let fellowId = cur.id, unitId = this.unit.id;\r\n        await mainApi.unitSetAdmin(fellowId, unitId, isOwner, isAdmin, isDev);\r\n        cur.isOwner = isOwner;\r\n        cur.isAdmin = isAdmin;\r\n        this.removeUnitAdmin();\r\n        if (isOwner === 0 && isAdmin === 0)\r\n            this.devs.unshift(cur);\r\n        else {\r\n            if (isOwner === 1) this.owners.unshift(cur);\r\n            if (isAdmin === 1) this.admins.unshift(cur);\r\n        }\r\n    }\r\n\r\n    async unitAddAdmin(user:string, isOwner:number, isAdmin:number, isDev:number):Promise<UnitAdmin|string> {\r\n        let admin = await mainApi.unitAddAdmin(user, this.unit.id, isOwner, isAdmin, isDev);\r\n        if (admin === undefined) return 'unauthorized';\r\n        let {r} = admin;\r\n        if (r !== undefined) return r;\r\n\r\n        let cur = this.cur = admin;\r\n        this.removeUnitAdmin();\r\n        if (isOwner === 0 && isAdmin === 0)\r\n            this.devs.unshift(cur);\r\n        else {\r\n            if (isOwner === 1) this.owners.unshift(cur);\r\n            if (isAdmin === 1) this.admins.unshift(cur);\r\n        }\r\n        return admin;\r\n    }\r\n\r\n    async unitDelAdmin(unitAdmin: UnitAdmin) {\r\n        await mainApi.unitDelAdmin(this.unit.id, unitAdmin.id);\r\n        if (this.cur === unitAdmin) this.cur = undefined;\r\n        this.removeUnitAdmin(unitAdmin);\r\n    }\r\n}\r\n","import { CUqBase } from \"UqApp\";\r\nimport { VPage, Page, List } from \"tonva\";\r\nimport { observer } from 'mobx-react';\r\nimport { store } from 'store';\r\nimport { UnitSpan } from 'tools';\r\nimport { UnitAdmin } from 'model';\r\n\r\nexport class CPickUnit extends CUqBase {\r\n    unitItems: UnitAdmin[];\r\n    \r\n    async internalStart() {\r\n    }\r\n\r\n    async pick(): Promise<number> {\r\n        this.unitItems = store.accUnits;\r\n        return await this.vCall(VPickUnit);\r\n    }\r\n}\r\n\r\nclass VPickUnit extends VPage<CPickUnit> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderUnit = (unitAdmin:UnitAdmin, index:number):JSX.Element => {\r\n        return <div className=\"px-3 py-2\"><UnitSpan id={unitAdmin.id} /></div>;\r\n    }\r\n\r\n    private clickUnit = (unitAdmin:UnitAdmin) => {\r\n        this.closePage();\r\n        this.returnCall(unitAdmin.id);\r\n\t}\r\n\t\r\n\tprivate onClickNullServer = () => {\r\n        this.closePage();\r\n        this.returnCall(null);\r\n\t}\r\n\r\n    private page = observer(():JSX.Element => {\r\n        return <Page header=\"选择小号($unit)\">\r\n            <List items={this.controller.unitItems}\r\n                item={{render:this.renderUnit, onClick:this.clickUnit}} />\r\n        </Page>;\r\n    });\r\n}\r\n","import _ from 'lodash';\r\nimport { observable } from 'mobx';\r\nimport { nav } from 'tonva';\r\nimport { Unit, DevUQ, DevService } from '../../model';\r\nimport { UqUpload, UqDeploy } from './uqUpload';\r\nimport { devApi } from 'api';\r\nimport { NewServicePage } from './newServicePage';\r\nimport { ServicePage } from './servicePage';\r\nimport { UQPage } from './uqPage';\r\nimport { ListPage } from './listPage';\r\nimport { VUqDevsAdmin } from './VUqDevsAdmin';\r\nimport { CUqBase } from 'UqApp';\r\nimport { CPickServer } from './CPickServer';\r\nimport { Admins } from 'store/admins';\r\nimport { CPickUnit } from './CPickUnit';\r\n\r\nexport class CUq extends CUqBase {\r\n    private unit: Unit;\r\n    uq: DevUQ;\r\n    access: string;\r\n    entities: string;\r\n    admins: Admins;\r\n    @observable uqDevs: any[];\r\n    @observable uqList: DevUQ[];\r\n    @observable services: DevService[];\r\n    protected async internalStart(unit:Unit) {\r\n        this.unit = unit;\r\n        this.uqList = await devApi.uqs(this.unit.id, 200);\r\n        this.openVPage(ListPage);\r\n    }\r\n\r\n    listRowClick = async (item:DevUQ) => {\r\n        this.uq = item;\r\n        await this.loadUqEntities(item.id);\r\n        this.openVPage(UQPage);\r\n    }\r\n\r\n    private async loadUqEntities(uqId: number) {\r\n        let ret = await devApi.uqGetEntities(this.unit.id, uqId);\r\n        let r0 = ret[0][0];\r\n        this.access = r0.access;\r\n        this.entities = r0.entities;\r\n        this.services = ret[1];\r\n        this.uqDevs = ret[4];\r\n    }\r\n\r\n    async loadAdmins() {\r\n        this.admins = new Admins(this.unit);\r\n        await this.admins.load();\r\n    }\r\n\r\n    async devChanged(admin:any, isSelected:boolean) {\r\n        let param = {\r\n            unit: this.unit.id,\r\n            type: 'uq',\r\n            dev: this.uq.id,\r\n            devUser: admin.id\r\n        };\r\n        if (isSelected === true) {\r\n            await devApi.adminDevAdd(param);\r\n            this.uqDevs.push({\r\n                userId: admin.id,\r\n                icon: admin.icon,\r\n                name: admin.name,\r\n                nick: admin.nick,\r\n                isOwner: 0,\r\n            });\r\n        }\r\n        else {\r\n            await devApi.adminDevDel(param);\r\n            let index = this.uqDevs.findIndex(v => v.userId === admin.id);\r\n            this.uqDevs.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    onUqDevsAdmin = () => {\r\n        this.openVPage(VUqDevsAdmin);\r\n    }\r\n\r\n    serviceClick = (service: DevService) => {\r\n        this.openVPage(ServicePage, service);\r\n    }\r\n\r\n    onUqUpload = async() => {\r\n        let onDispose = () => {}\r\n        nav.push(<UqUpload uq={this.uq} services={this.services} />, onDispose);\r\n    }\r\n\r\n    onUqTest = async() => {\r\n        let onDispose = () => {}\r\n        nav.push(<UqDeploy uq={this.uq} action=\"test\" services={this.services} />, onDispose);\r\n    }\r\n\r\n    onUqDeploy = async() => {\r\n        let onDispose = () => {}\r\n        nav.push(<UqDeploy uq={this.uq} action=\"deploy\" services={this.services} />, onDispose);\r\n    }\r\n\r\n    saveUq = async (values: DevUQ) => {\r\n        let uq: DevUQ;\r\n        if (this.uq === undefined) {\r\n            uq = _.clone(values);\r\n        }\r\n        else {\r\n            uq = _.clone(this.uq);\r\n            _.merge(uq, values);\r\n        }\r\n        uq.unit = this.unit.id;\r\n        let ret = await devApi.saveUq(uq);\r\n        uq.id = ret;\r\n        this.uqList.push(uq);\r\n    }\r\n\r\n    deleteUq = async () => {\r\n        await devApi.delUq(this.unit.id, this.uq.id);\r\n        let index = this.uqList.findIndex(v => v.id === this.uq.id);\r\n        if (index >= 0) this.uqList.splice(index);\r\n    }\r\n\r\n    async changeServiceProp(service: DevService, prop:string, value:any):Promise<any> {\r\n        return await devApi.changeServiceProp(this.unit.id, service.id, prop, value);\r\n    }\r\n\r\n    async saveService(service: DevService):Promise<number> {\r\n        let svc = _.clone(service);\r\n        svc.unit = this.unit.id;\r\n        if (!svc.urlTest) svc.urlTest = '-';\r\n        let ret = await devApi.saveService(svc);\r\n        svc.id = ret;\r\n        this.services.push(svc);\r\n        return ret;\r\n    }\r\n\r\n    async delService(service: DevService) {\r\n        await devApi.delService(this.unit.id, service.id);\r\n        let index = this.services.findIndex(v => v.id === service.id);\r\n        if (index >= 0) this.services.splice(index);\r\n    }\r\n\r\n    showNewServicePage = async () => {\r\n        await this.openVPage(NewServicePage);\r\n    }\r\n\r\n    pickServer = async () => {\r\n        let cPickServer = this.newC(CPickServer);\r\n        return await cPickServer.pick();\r\n    }\r\n\r\n    pickUnit = async () => {\r\n        let cPickUnit = this.newC(CPickUnit);\r\n        return await cPickUnit.pick();\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {EasyDate, Prop, PropGrid, LMR, Muted, FA} from 'tonva';\r\nimport {UnitSpan, IdDates} from '../tools';\r\nimport {store} from '../store';\r\nimport { ObjViewProps } from './ObjViewProps';\r\nimport { DevBus } from 'model';\r\n\r\nconst busIcon = 'cogs';\r\n\r\n@observer\r\nclass Info extends React.Component<DevBus> {\r\n    async componentDidMount() {\r\n        //await store.dev.buses.loadCurApis();\r\n    }\r\n    render() {\r\n        let {unit, owner, name, discription, mine, version, date_init, date_update} = this.props;\r\n        let disp = <small>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </small>;\r\n        let caption:any = owner + ' / ' + name;\r\n        if (mine === 1) {\r\n            caption = <b>{caption}</b>;\r\n        }\r\n        let rows:Prop[] = [\r\n            '',\r\n            {type: 'component', component: <LMR className=\"py-2\"\r\n                left={<FA className=\"pt-2 pr-1 text-primary\" name={busIcon} size=\"3x\" />}>\r\n                <div className=\"pl-3\">\r\n                    <div className=\"mb-2\">{caption}</div>\r\n                    {disp}\r\n                </div>\r\n            </LMR>},\r\n            '',\r\n            {type: 'component', label: '所有者', component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> },\r\n            {\r\n                type: 'component', \r\n                label: '版本号', \r\n                component: <LMR className=\"py-2 w-100\" right={<small className=\"text-muted\"><EasyDate date={date_update}/></small>} >{version}</LMR> },\r\n            '',\r\n            {\r\n                type: 'component', \r\n                label: '代码',\r\n                vAlign: 'stretch',\r\n                component: <SchemaView />,\r\n            },\r\n        ];\r\n        return <div>\r\n            <PropGrid rows={rows} values={this.props} />\r\n        </div>\r\n    }\r\n}\r\n\r\n@observer\r\nexport class SchemaView extends React.Component {\r\n    render() {\r\n        let bus = store.dev.buses.cur;\r\n        if (bus === null) return '...';\r\n        let content = bus.source;\r\n        return <div className=\"d-flex py-2 w-100 align-items-center\" style={{flex:1}}>\r\n            <pre>\r\n                {content}\r\n            </pre>\r\n        </div>;\r\n    }\r\n}\r\n\r\nconst busesProps:ObjViewProps<DevBus> = {\r\n    title: 'BUS',\r\n    formRows: [\r\n        {\r\n            label: '名称', \r\n            field: {name: 'name', type: 'string', maxLength: 100, required: true},\r\n        },\r\n        {\r\n            label: '描述',\r\n            field: {name: 'discription', type: 'string', maxLength: 250},\r\n            face: {type: 'textarea'}\r\n        },\r\n        {\r\n            label: '代码',\r\n            field: {name: 'source', type: 'string', maxLength: 25000},\r\n            face: {type: 'textarea', rows: 8}\r\n        },\r\n    ],\r\n    row: (item:DevBus):JSX.Element => {\r\n        let {owner, name, discription, mine} = item;\r\n        //let icon = appIcon;\r\n        let main = owner + ' / ' + name;\r\n        return <LMR className=\"py-2 px-3 align-items-stretch\"\r\n            left={<FA className=\"pt-2 pr-1 text-primary\" name='cogs' size=\"lg\" />}>\r\n            <div className=\"px-3\">\r\n                <div>{mine===1? <b>{main}</b> : main}</div>\r\n                <div><Muted>{discription}</Muted></div>\r\n            </div>\r\n        </LMR>;\r\n    },\r\n    items: ()=>store.dev.buses,\r\n    repeated: {\r\n        name: 'name',\r\n        err: '跟已有的名称重复',\r\n    },\r\n    info: Info,\r\n    canEdit: bus => bus.mine === 1,\r\n};\r\n\r\nexport default busesProps;\r\n","import * as React from 'react';\r\nimport { Prop, PropGrid, LMR, Muted, FA, EasyTime, EasyDate } from 'tonva';\r\nimport { UnitSpan } from '../tools';\r\nimport { store } from '../store';\r\nimport { ObjViewProps } from './ObjViewProps';\r\nimport { DevServer } from 'model';\r\n\r\nclass Info extends React.Component<DevServer> {\r\n    render() {\r\n        let { name, discription, unit, date_init, date_update } = this.props;\r\n        let disp = <div>\r\n            <div><b>{name}</b></div>\r\n            <div>{discription}</div>\r\n        </div>;\r\n        let right = <div className=\"text-end small text-muted align-self-end\">\r\n            更新:<EasyTime date={date_update} /><br />\r\n            创建:<EasyDate date={date_init} />\r\n        </div>;\r\n        let rows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component', component: <LMR className=\"w-100 py-2\"\r\n                    left={<FA name=\"server\" className=\"text-primary fa-2x me-3\" />}\r\n                    right={right}>\r\n                    {disp}\r\n                </LMR>\r\n            },\r\n            '',\r\n            { type: 'component', label: '开发号', component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div> },\r\n            { type: 'string', label: 'URL', name: 'url' },\r\n            { type: 'string', label: '云服务', name: 'cloud' },\r\n            { type: 'string', label: 'IP', name: 'ip' },\r\n        ];\r\n        return <div>\r\n            <PropGrid rows={rows} values={this.props} />\r\n        </div>;\r\n    }\r\n}\r\n\r\nconst serversProps: ObjViewProps<DevServer> = {\r\n    title: 'Server',\r\n    info: Info,\r\n    formRows: [\r\n        {\r\n            label: '名称',\r\n            field: { name: 'name', type: 'string', maxLength: 50, required: true },\r\n        },\r\n        {\r\n            label: 'URL',\r\n            field: { name: 'url', type: 'string', maxLength: 200, required: true },\r\n        },\r\n        {\r\n            label: 'IP地址',\r\n            field: { name: 'ip', type: 'string', maxLength: 20 },\r\n        },\r\n        {\r\n            label: '描述',\r\n            field: { name: 'discription', type: 'string', maxLength: 50, required: false },\r\n        },\r\n        {\r\n            label: '云服务商',\r\n            field: { name: 'cloud', type: 'string', maxLength: 20, required: false },\r\n        },\r\n    ],\r\n    row: (item: DevServer): JSX.Element => {\r\n        let { name, discription, cloud } = item;\r\n        return <LMR className=\"py-2 px-3 align-items-center\"\r\n            left={<FA name=\"server\" className=\"text-primary fa-lg\" />}>\r\n            <div className=\"px-3\">\r\n                <div><b className=\"me-3\">{name}</b><Muted>{cloud}</Muted></div>\r\n                <div className=\"small text-muted\">{discription}</div>\r\n            </div>\r\n        </LMR>;\r\n    },\r\n    items: () => store.dev.servers,\r\n    repeated: {\r\n        name: 'name',\r\n        err: '跟已有服务器名称重复',\r\n    },\r\n    canEdit: server => {\r\n        let { isOwner, isAdmin } = store.unit;\r\n        return isOwner > 0 || isAdmin > 0;\r\n    },\r\n};\r\n\r\nexport default serversProps;\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { nav, Page } from 'tonva';\r\nimport { TonvaForm, MultiStep, SubmitResult } from 'tonva-form';\r\nimport { DropdownActions, List, FA } from 'tonva';\r\nimport { store } from 'store';\r\nimport { ObjViewProps } from './ObjViewProps';\r\nimport { DevObjBase } from 'model';\r\n\r\n@observer\r\nexport class ObjView<T extends DevObjBase> extends React.Component<ObjViewProps<T>> {\r\n    async componentDidMount() {\r\n        await this.props.items().load();\r\n    }\r\n    //converter(item:T):ListItem {\r\n    //    return this.props.converter(item);\r\n    //}\r\n    newItem() {\r\n        this.props.items().cur = undefined;\r\n        nav.push(<New {...this.props} />);\r\n    }\r\n    itemClick = (item: T) => {\r\n        this.props.items().cur = observable(item);\r\n        nav.push(<Info {...this.props} />);\r\n    }\r\n    render() {\r\n        let { title, items } = this.props;\r\n        if (!store.unit) debugger;\r\n        let { isOwner } = store.unit;\r\n        let right = isOwner > 0 && <button className='btn btn-success btn-sm me-2'\r\n            onClick={() => this.newItem()}><FA name=\"plus\" /></button>;\r\n        return <Page header={title} right={right}>\r\n            <List items={items().items}\r\n                item={{ render: this.props.row, onClick: this.itemClick }}\r\n            />\r\n        </Page>;\r\n    }\r\n}\r\n\r\nclass New<T extends DevObjBase> extends React.Component<ObjViewProps<T>> {\r\n    private tonvaForm: TonvaForm;\r\n    constructor(props: ObjViewProps<T>) {\r\n        super(props);\r\n        this.onSubmit = this.onSubmit.bind(this);\r\n    }\r\n    async onSubmit(values: any): Promise<SubmitResult> {\r\n        values.owner = this.props\r\n        if (await this.props.items().check(values) === false) return;\r\n        let ret = await this.props.items().saveCur(values);\r\n        if (ret === true) {\r\n            nav.pop();\r\n        }\r\n        else {\r\n            let repeated = this.props.repeated;\r\n            this.tonvaForm.formView.setError(repeated.name, repeated.err);\r\n        }\r\n        return;\r\n    }\r\n    render() {\r\n        let content: any;\r\n        let { title, steps, stepHeader } = this.props;\r\n        let { formRows, items } = this.props;\r\n        if (steps !== undefined) {\r\n            content = <MultiStep className=\"mt-4\" header={stepHeader} steps={steps} first=\"step1\" onSubmit={this.onSubmit} />;\r\n        }\r\n        else if (formRows !== undefined) {\r\n            content = <TonvaForm ref={f => this.tonvaForm = f}\r\n                className=\"m-3\"\r\n                formRows={formRows}\r\n                onSubmit={this.onSubmit} initValues={items().cur} />;\r\n        }\r\n        else {\r\n            content = 'ObjViewProps: no steps and no formRows';\r\n        }\r\n        return <Page header={'新增' + title}>\r\n            {content}\r\n        </Page>\r\n    }\r\n}\r\n\r\n@observer\r\nclass Info<T extends DevObjBase> extends React.Component<ObjViewProps<T>> {\r\n    private menuItems = [\r\n        { caption: '修改' + this.props.title, action: this.editItem.bind(this), icon: 'edit' },\r\n        { caption: '删除', action: this.deleteItem.bind(this), icon: 'trash-o' }\r\n    ];\r\n    async deleteItem() {\r\n        if (window.confirm('真的要删除吗？系统删除时并不会检查相关引用，请谨慎') === true) {\r\n            await this.props.items().del();\r\n            nav.pop();\r\n        }\r\n    }\r\n    editItem() {\r\n        nav.push(<Edit {...this.props} />);\r\n    }\r\n    render() {\r\n        let item = this.props.items().cur;\r\n        let actions = [];\r\n        let ex = this.props.extraMenuActions;\r\n        if (ex !== undefined) actions.push(...ex);\r\n        actions.push(...this.menuItems);\r\n        let canEdit = this.props.canEdit;\r\n        let right: any;\r\n        if (canEdit && canEdit(item) === true) {\r\n            right = <DropdownActions actions={actions} className=\"btn-primary me-2\" />;\r\n        }\r\n        //<this.props.info {...item} />\r\n        return <Page header={this.props.title + ' - 详细资料'} right={right}>\r\n            {React.createElement(this.props.info, item)}\r\n        </Page>;\r\n    }\r\n}\r\n\r\nclass Edit<T extends DevObjBase> extends React.Component<ObjViewProps<T>> {\r\n    private actions = [\r\n        { caption: '删除', action: this.deleteItem.bind(this), icon: 'trash-o' }\r\n    ];\r\n    constructor(props: ObjViewProps<T>) {\r\n        super(props);\r\n        this.onSubmit = this.onSubmit.bind(this);\r\n    }\r\n    async onSubmit(values: any): Promise<SubmitResult> {\r\n        if (await this.props.items().check(values) === false) return;\r\n        await this.props.items().saveCur(values);\r\n        nav.pop();\r\n        return;\r\n    }\r\n    async deleteItem() {\r\n        if (window.confirm('真的要删除吗？系统删除时并不会检查相关引用，请谨慎') === true) {\r\n            await this.props.items().del();\r\n            nav.pop();\r\n        }\r\n    }\r\n    render() {\r\n        let right = <DropdownActions actions={this.actions} className=\"btn-primary me-2\" />\r\n        return <Page header={'修改 ' + this.props.title} right={right} back=\"close\">\r\n            <TonvaForm\r\n                className=\"m-3\"\r\n                formRows={this.props.formRows}\r\n                onSubmit={this.onSubmit} initValues={this.props.items().cur} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { VPage, Page, LMR, Image, Edit, Controller, List } from \"tonva\";\r\nimport { FA, nav, Badge, ItemSchema, ImageSchema, StringSchema, UiSchema, UiTextItem, UiImageItem } from 'tonva';\r\nimport { CHome } from \"./CHome\";\r\nimport { observer } from 'mobx-react';\r\nimport { store } from 'store';\r\nimport { UnitApp, Unit, unitCaption, DevObjBase } from 'model';\r\n//import { CUsers } from 'Users';\r\nimport { ObjViewProps } from 'Dev/ObjViewProps';\r\nimport AppsPage from 'Apps';\r\nimport { busesProps, serversProps, ObjView } from 'Dev';\r\nimport { NewApp } from 'Apps/new';\r\n//import { CAdmins } from 'Admins';\r\n\r\nconst defaultIconClass = 'text-info';\r\nconst devIconClass = 'text-success';\r\n\r\ninterface ActionBase {\r\n    title: string | JSX.Element;\r\n    icon: string | JSX.Element;\r\n    onClick?: () => void;\r\n    className?: string;\r\n    iconClassName?: string;\r\n    page?: new (props: any) => React.Component;\r\n}\r\n\r\ninterface ActionItem extends ActionBase {\r\n    right?: string | JSX.Element;\r\n    controller?: Controller;\r\n}\r\n\r\ninterface DevItem<T extends DevObjBase> extends ActionBase {\r\n    dev: true;\r\n    count: number;\r\n    objProps?: ObjViewProps<T>;\r\n}\r\n\r\ntype Item = ActionItem | DevItem<DevObjBase> | string;\r\n\r\nconst rArrow = <FA name=\"angle-right\" />;\r\n\r\nexport class VUnit extends VPage<CHome> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private appsAction: ActionItem = {\r\n        title: '启停App',\r\n        right: rArrow, //'增减',\r\n        icon: 'play-circle-o',\r\n        page: AppsPage,\r\n    };\r\n    /*\r\n    private usersAction:ActionItem = {\r\n        main: '用户角色',\r\n        right: rArrow,\r\n        icon: 'users',\r\n        page: Members,\r\n    };\r\n    */\r\n    private newUsersAction: ActionItem = {\r\n        title: 'App管理员',\r\n        right: <><small className=\"text-muted\">各App的管理员汇总</small> &nbsp; {rArrow}</>,\r\n        icon: 'user-o',\r\n        controller: this.controller.cUsers, // new UsersController(undefined),\r\n    };\r\n    /*\r\n    private devAction:Item = {\r\n        main: <DevActions />,\r\n        right: '程序开发相关管理',\r\n        icon: 'laptop',\r\n        //page: Dev,\r\n    };*/\r\n    private adminsAction: ActionItem = {\r\n        title: unitCaption(this.controller.unit) + '总管',\r\n        right: rArrow,\r\n        icon: 'universal-access',\r\n        //page: AdministorsPage,\r\n        controller: this.controller.cAdmins, // new CAdmins(undefined)\r\n    };\r\n    private uqRolesAction: ActionItem = {\r\n        title: 'UQ角色设置',\r\n        right: rArrow,\r\n        icon: 'universal-access',\r\n        //page: AdministorsPage,\r\n        controller: this.controller.cUqRoles,\r\n    };\r\n    /*\r\n    private appUserManagerAction: ActionItem = {\r\n        main: 'App用户管理员',\r\n        right: rArrow,\r\n        icon: 'vcard-o',\r\n        //page: Administors,\r\n        controller: new CAppUserManagers(undefined),\r\n    };\r\n    */\r\n    /*\r\n    private cOrganization = new COrganization;\r\n    private organizeAction:ActionItem = {\r\n        main: this.cOrganization.label,\r\n        right: rArrow,\r\n        icon: this.cOrganization.icon,\r\n        controller: this.cOrganization\r\n    };\r\n    */\r\n\r\n    private noneAction: ActionItem = {\r\n        title: '请耐心等待分配任务',\r\n        icon: 'hourglass-start',\r\n    };\r\n\r\n    private buildItems(): Item[] {\r\n        let { unit, dev } = store;\r\n        let { isAdmin, isOwner, isDev, type } = unit;\r\n        let items: Item[] = [];\r\n        if (isOwner === 1 || isAdmin === 1) {\r\n            items.push(this.uqRolesAction);\r\n            items.push(this.adminsAction);\r\n        }\r\n        if ((type & 2) !== 0) {\r\n            if (isAdmin === 1) {\r\n                items.push(this.newUsersAction);\r\n            }\r\n        }\r\n\r\n        // 开发号\r\n        if ((type & 1) !== 0) {\r\n            let { counts } = dev;\r\n\r\n            if (isAdmin === 1 || isDev === 1) {\r\n                items.push('开发号管理')\r\n            }\r\n\r\n            if (isAdmin === 1) {\r\n                let developersAction: ActionItem = {\r\n                    title: '开发者',\r\n                    right: rArrow,\r\n                    icon: 'user-o',\r\n                    onClick: async () => await this.controller.onShowDevelopers(),\r\n                    className: 'border-bottom',\r\n                    iconClassName: devIconClass,\r\n                };\r\n                items.push(developersAction);\r\n            }\r\n\r\n            if (isDev === 1) {\r\n                if (isOwner > 0) {\r\n                    /*\r\n                    let appAction: DevItem<DevObjBase> = {\r\n                        dev: true,\r\n                        title: 'APP',\r\n                        count: counts && counts.app,\r\n                        icon: 'tablet',\r\n                        onClick: () => this.controller.startApp(unit), // new AppController(undefined).start(unit.id),\r\n                    };\r\n                    items.push(appAction);\r\n                    */\r\n                }\r\n                let uqAction: DevItem<DevObjBase> = {\r\n                    dev: true,\r\n                    title: 'UQ',\r\n                    count: counts && counts.uq,\r\n                    icon: 'database',\r\n                    onClick: () => this.controller.startUq(unit), //new CUq(undefined).start(unit),\r\n                };\r\n                let busAction: DevItem<DevObjBase> = {\r\n                    dev: true,\r\n                    title: 'BUS',\r\n                    count: counts && counts.bus,\r\n                    icon: 'cogs',\r\n                    objProps: busesProps as any,\r\n                };\r\n                items.push(uqAction, busAction);\r\n                if (isOwner > 0) {\r\n                    let serverAction: DevItem<DevObjBase> = {\r\n                        dev: true,\r\n                        title: 'Server',\r\n                        count: counts && counts.server,\r\n                        icon: 'server',\r\n                        objProps: serversProps as any,\r\n                    };\r\n                    items.push(serverAction);\r\n                }\r\n            }\r\n        }\r\n        /*\r\n        // 小号\r\n        if ((type & 2) !== 0) {\r\n            if (isAdmin === 1) {\r\n                items.push(\r\n                    '小号管理（未来将会去掉）',\r\n                    this.appsAction, \r\n                    //this.usersAction, \r\n                    this.newUsersAction, \r\n                    //this.organizeAction\r\n                );\r\n            }\r\n        }\r\n        */\r\n        return items;\r\n    }\r\n    private row = (item: Item, index: number): JSX.Element => {\r\n        if (typeof item === 'string') {\r\n            return <div className=\"px-3 pt-3 pb-1 small text-muted cursor-default\" style={{ backgroundColor: '#f0f0f0' }}>{item}</div>;\r\n        }\r\n        let { iconClassName, className } = item;\r\n        if (iconClassName === undefined) iconClassName = defaultIconClass;\r\n        let { dev } = item as DevItem<DevObjBase>;\r\n        let left: any, mid: any, r: any;\r\n        if (dev === true) {\r\n            let { icon, title, count } = item as DevItem<DevObjBase>;\r\n            left = typeof icon === 'string' ?\r\n                <FA className={iconClassName} name={icon} fixWidth={true} size=\"lg\" />\r\n                :\r\n                icon;\r\n            mid = title;\r\n            r = count > 0 && <span>{count}</span>;\r\n        }\r\n        else {\r\n            let { right, title, icon } = item as ActionItem;\r\n            left = typeof icon === 'string' ?\r\n                <FA className={iconClassName} name={icon} fixWidth={true} size=\"lg\" /> :\r\n                item.icon;\r\n            mid = title;\r\n            r = <span>{right}</span>;\r\n        }\r\n        return <LMR className={classNames('px-3 py-2 align-items-center', className)} left={left} right={r}>\r\n            <div className=\"px-3\">{mid}</div>\r\n        </LMR>;\r\n    }\r\n    private rowClick = async (item: Item) => {\r\n        let { page: P, onClick } = item as ActionBase;\r\n        if (P !== undefined) {\r\n            nav.push(<P />);\r\n            return;\r\n        }\r\n        if (onClick) {\r\n            onClick();\r\n            return;\r\n        }\r\n        let { objProps } = item as DevItem<DevObjBase>;\r\n        if (objProps !== undefined) {\r\n            return nav.push(<ObjView {...objProps} />);\r\n        }\r\n        let { controller } = item as ActionItem;\r\n        if (controller) {\r\n            await controller.start(store.unit);\r\n            return;\r\n        }\r\n    }\r\n\r\n    private appItemRender(app: UnitApp, index: number) {\r\n        let { name, discription, icon, inUnit } = app;\r\n        let ban = (inUnit === 0) &&\r\n            <FA className=\"text-danger\" name='ban' />;\r\n        return <LMR className=\"px-3 py-2\"\r\n            left={<Badge><Image src={icon} /></Badge>}\r\n            right={ban}>\r\n            <div className=\"px-3\">\r\n                <div><b>{name}</b></div>\r\n                <small className=\"text-muted\">{discription}</small>\r\n            </div>\r\n        </LMR>;\r\n    }\r\n    private appClick = async (app: UnitApp) => {\r\n        await this.controller.showAppXAccount(app);\r\n        /*\r\n        nav.push(<Page header=\"App详细信息\">\r\n            <Info app={app} />\r\n        </Page>);\r\n        */\r\n    }\r\n    private newItem() {\r\n        nav.push(<NewApp />);\r\n    }\r\n    private appRender() {\r\n        let { apps } = store;\r\n        if (apps === undefined) return;\r\n        if (apps.length === 0) return;\r\n        let { isAdmin, isOwner } = store.unit;\r\n        let right = (isAdmin === 1 || isOwner === 1) && <button\r\n            className='btn btn-success btn-sm'\r\n            onClick={() => this.newItem()}><FA name=\"plus\" /></button>;\r\n        return <>\r\n            <LMR className=\"mt-4 mb-2 px-3 small text-muted align-items-end\" right={right}>\r\n                <div className=\"align-self-end\">App</div>\r\n            </LMR>\r\n            <List items={store.apps} item={{ render: this.appItemRender, onClick: this.appClick }} />\r\n        </>\r\n    }\r\n\r\n    private onClickUnitProps = () => {\r\n        this.openPageElement(<UnitProps />);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let unit: Unit = store.unit;\r\n        if (unit === undefined) {\r\n            //console.log(\"admin render without unit\");\r\n            return null;\r\n        }\r\n        //console.log(\"admin render with unit\");\r\n        let items = this.buildItems();\r\n        if (items === undefined) {\r\n            return <Page header=\"\" />;\r\n        }\r\n        let header: any, top: any;\r\n        if (unit !== undefined) {\r\n            let { name, nick, icon, discription } = unit;\r\n            let title: string, vice: any;\r\n            if (nick) {\r\n                title = nick;\r\n                vice = <h6><small className='text-secondary'>{name}</small></h6>;\r\n            }\r\n            else {\r\n                title = name;\r\n            }\r\n            let caption = unitCaption(this.controller.unit);\r\n            if (caption !== undefined) header = caption + ' - ' + title;\r\n            top = <LMR className='px-3 my-4 bg-white py-2 cursor-pointer' onClick={this.onClickUnitProps}\r\n                left={<div><Image className=\"w-3c h-3c\" src={icon} /></div>}>\r\n                <div className=\"px-3\">\r\n                    <LMR right={vice}><h6 className='text-dark font-weight-bold'>{title}</h6></LMR>\r\n                    <div className='text-info overflow-hidden h-max-3c'>{discription}</div>\r\n                </div>\r\n            </LMR>;\r\n        }\r\n        else {\r\n            header = '系统管理';\r\n        }\r\n\r\n        return <Page header={header} logout={this.controller.logout}>\r\n            {top}\r\n            {items.length > 0 && <List items={items} item={{ render: this.row, onClick: this.rowClick }} />}\r\n            {this.appRender()}\r\n        </Page>;\r\n    })\r\n}\r\n\r\n\r\nclass UnitProps extends React.Component {\r\n    private schema: ItemSchema[] = [\r\n        { name: 'icon', type: 'image' } as ImageSchema,\r\n        { name: 'nick', type: 'string' } as StringSchema,\r\n        { name: 'discription', type: 'string' } as StringSchema,\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            nick: { widget: 'text', label: '别名', placeholder: '好的别名更方便记忆' } as UiTextItem,\r\n            icon: { widget: 'image', label: '标志图' } as UiImageItem,\r\n            discription: { widget: 'text', label: '描述', placeholder: '简短清晰的描述' } as UiTextItem,\r\n        }\r\n    }\r\n    /*\r\n    async onNickChanged(value:any, orgValue:any):Promise<void> {\r\n        await store.unitChangeProp('nick', value);\r\n    }\r\n    async onDiscriptionChanged(value:any, orgValue:any):Promise<void> {\r\n        await store.unitChangeProp('discription', value);\r\n    }\r\n    */\r\n    private onItemChanged = async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\r\n        let { name } = itemSchema;\r\n        //await userApi.userSetProp(name, newValue);\r\n        await store.unitChangeProp(name, newValue);\r\n        //this.data[name] = newValue;\r\n        //nav.user[name] = newValue;\r\n        //nav.saveLocalUser();\r\n    }\r\n    //<PropGrid rows={this.rows} values={store.unit} alignValue=\"right\" />\r\n    render() {\r\n        let unit: Unit = store.unit;\r\n        let { isRoot, isOwner, readMe } = unit;\r\n        let caption = unitCaption(unit);\r\n\r\n        let divReadMe = readMe && <div className=\"p-3\"\r\n            dangerouslySetInnerHTML={{ __html: readMe }}></div>;\r\n\r\n        return <Page header={caption + '详情'}>\r\n            <Edit schema={this.schema} uiSchema={this.uiSchema}\r\n                data={store.unit}\r\n                onItemChanged={this.onItemChanged}\r\n                stopEdit={!(isRoot > 0 && isOwner > 0)} />\r\n            {divReadMe}\r\n        </Page>;\r\n    }\r\n}\r\n","import classNames from 'classnames';\r\nimport { VPage, Page, List, LMR, FA } from 'tonva';\r\nimport { CHome } from './CHome';\r\nimport { UnitAdmin } from 'model';\r\nimport { store } from 'store';\r\n\r\nexport class VHome extends VPage<CHome> {\r\n    async open() {\r\n        let { isProduction } = this.controller;\r\n        let s = store;\r\n        let { unitAdmins, unit } = s;\r\n        if (isProduction === false) {\r\n            switch (unitAdmins.length) {\r\n                default: this.openPage(this.selectUnitPage); return;\r\n                case 0: this.openPage(this.noUnitPage); return;\r\n                case 1: await this.controller.onShowUnit(unitAdmins[0]); return;\r\n            }\r\n        }\r\n\r\n        if (unit === undefined) {\r\n            this.openPage(this.noUnitPage);\r\n            return;\r\n        }\r\n        await this.controller.onShowUnit(unitAdmins[0]);\r\n    }\r\n\r\n    private onClickUnit = async (unitAdmin: UnitAdmin) => {\r\n        this.closePage();\r\n        await this.controller.onShowUnit(unitAdmin);\r\n    }\r\n\r\n    private selectUnitPage = () => {\r\n        let { logout } = this.controller;\r\n        let { accUnits, devUnits, bothUnits } = store;\r\n        let item = { render: this.renderUnitAdmin, onClick: this.onClickUnit };\r\n        let list = (items: UnitAdmin[], label: string) => {\r\n            return items.length > 0 &&\r\n                <div className=\"my-3\">\r\n                    <div className=\"px-3 py-1 small text-muted\">{label}</div>\r\n                    <List items={items} item={item} />\r\n                </div>\r\n        }\r\n        return <Page header=\"同花管理员\" logout={logout}>\r\n            {list(accUnits, '小号')}\r\n            {list(devUnits, '开发号')}\r\n            {list(bothUnits, '双号')}\r\n        </Page>;\r\n        //<List items={this.controller.unitAdmins} \r\n        //    item={{render: this.renderRow, onClick: this.onRowClick}} />\r\n    }\r\n\r\n    private noUnitPage = () => {\r\n        let { user, logout } = this.controller;\r\n        let { nick, name } = user;\r\n        return <Page header=\"没有小号\" logout={logout}>\r\n            <div className=\"p-3 small text-info\">\r\n                {nick || name}: 没有需要管理的小号\r\n            </div>\r\n        </Page>\r\n    }\r\n\r\n    protected get view(): any { return undefined }\r\n\r\n    private renderUnitAdmin = (item: UnitAdmin, index: number): JSX.Element => {\r\n        let { name, nick, type } = item;\r\n        let icon: string, color: string;\r\n        if (type & 1) {\r\n            icon = 'code';\r\n            color = 'text-success';\r\n        }\r\n        else if (type & 2) {\r\n            icon = 'flag';\r\n            color = 'text-primary';\r\n        }\r\n        else {\r\n            icon = 'start';\r\n            color = 'text-danger';\r\n        }\r\n        return <LMR className=\"px-3 py-2\" right={<span className=\"small text-muted\">id: {item.id}</span>}>\r\n            <div>\r\n                <FA name={icon} fixWidth={true} className={classNames('me-3', color)} />\r\n                {nick || name}\r\n            </div>\r\n        </LMR>;\r\n    }\r\n    /*\r\n    private onUnitClick = async (item: UnitAdmin) => {\r\n        appInFrame.unit = item.id; // 25;\r\n        store.init();\r\n        await store.loadUnit();\r\n        this.closePage();\r\n        this.openPageElement(<AdminPage />);\r\n    }*/\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount, Coll } from './CAppXAccount';\r\nimport { VPage, Page, PropGrid, Media, Prop, FA, LMR } from 'tonva';\r\nimport { IdDates } from 'tools';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VApp extends VPage<CAppXAccount> {\r\n    async open() {\r\n        this.openPage(this.page)\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { appXAccount, showDetail, users, showUserList, calcUserColl } = this.controller;\r\n        let coll = calcUserColl();\r\n        let { name, discription, icon, date_init, date_update } = appXAccount;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        let right = <button className=\"btn btn-success btn-sm me-2 align-self-center\"\r\n            onClick={showDetail}><FA name=\"ellipsis-h\" fixWidth={true} /></button>;\r\n        let rows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <Media icon={icon} main={name} discription={disp} />\r\n            },\r\n            '',\r\n        ];\r\n        return <Page header={\"App - \" + name} right={right}>\r\n            <PropGrid rows={rows} values={{}} />\r\n            {this.renderAdmins(coll)}\r\n            {this.renderRoles(coll)}\r\n            {this.renderUsers(coll)}\r\n            <div className=\"h-1c\" />\r\n            {this.row('全部用户', users.length, showUserList, 'text-info', 'list')}\r\n        </Page>;\r\n    })\r\n\r\n    private row(content: JSX.Element | string, count: number, onClick: () => void, color: string, icon?: string): JSX.Element {\r\n        let left = <FA className={\"me-3 \" + color} fixWidth={true} name={icon || \"user\"} size=\"lg\" />;\r\n        let right = <>{count} &nbsp; &nbsp; <FA className=\"align-self-center\" name=\"angle-right\" /></>;\r\n        return <LMR className=\"my-2 px-3 py-2 bg-white align-items-center\"\r\n            onClick={onClick} left={left} right={right}>{content}</LMR>;\r\n    }\r\n\r\n    private renderAdmins(coll: Coll): JSX.Element {\r\n        let { showAdmins, unit } = this.controller;\r\n        if (unit.isAdmin === 1) {\r\n            return this.row('管理员', coll.admins.length, showAdmins, 'text-danger');\r\n        }\r\n    }\r\n\r\n    private renderRoles(coll: Coll): JSX.Element {\r\n        let { showRoles, roleUserCount } = this.controller;\r\n        let { roleUsers } = coll;\r\n        if (!roleUsers) return;\r\n        return this.row('角色用户', roleUserCount, showRoles, 'text-success');\r\n    }\r\n\r\n    private renderUsers(coll: Coll): JSX.Element {\r\n        let { showUsers } = this.controller;\r\n        return this.row('普通用户', coll.users.length, showUsers, 'text-info');\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport {Media, List, LMR, Prop, PropGrid, FA, VPage, Page} from 'tonva';\r\nimport { CAppXAccount } from './CAppXAccount';\r\nimport { IdDates, UnitSpan } from 'tools';\r\n\r\nexport class VDetail extends VPage<CAppXAccount> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderUqRow = (uqAccess:any, index:number):JSX.Element => {\r\n        let {name, owner, discription} = uqAccess;\r\n        return <LMR className=\"py-2\" right={<small className=\"text-muted\">{discription}</small>}>\r\n            {owner} / {name}\r\n        </LMR>;\r\n    }\r\n\r\n    private onTurnOnOff = async () => {\r\n        if (await this.controller.appTurnOnOff() === true) {\r\n            this.closePage();\r\n            // after action;\r\n            //let {id, inUnit} = this.props.app;\r\n            //appActed?.(id, inUnit);\r\n        }\r\n    }\r\n\r\n    private status = ():JSX.Element => {\r\n        let {inUnit} = this.controller.appXAccount;\r\n        let text:string, right:any;\r\n        if (inUnit === 1) {\r\n            right = <button className=\"btn btn-danger\" onClick={this.onTurnOnOff}>\r\n                <FA name=\"ban\" /> 停用APP\r\n            </button>;\r\n            text = '运行中';\r\n        }\r\n        else if (inUnit === 0) {\r\n            right = <button className=\"btn btn-success\" onClick={this.onTurnOnOff}>\r\n                <FA name=\"refresh\" size=\"lg\" /> 恢复APP\r\n            </button>;\r\n            text = '停运中';\r\n        }\r\n        else {\r\n            right = <button className=\"btn btn-primary\" onClick={this.onTurnOnOff}>\r\n                <FA name=\"plus\" size=\"lg\" /> 新建\r\n            </button>;\r\n            text = '启用APP';\r\n        }\r\n        return <LMR className=\"w-100 align-items-center my-1\" right={right}>{text}</LMR>;\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {appXAccount, uqAccesses} = this.controller;\r\n        let {unit, name, discription, icon, date_init, date_update} = appXAccount;\r\n        let disp = <div>\r\n            <div>{discription}</div>\r\n            <IdDates date_update={date_update} date_init={date_init} />\r\n        </div>;\r\n        let rows:Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component', \r\n                component: <Media icon={icon} main={name} discription={disp} />\r\n            },\r\n            '',\r\n            {\r\n                type: 'component', \r\n                label: '开发号', \r\n                component: <div className=\"py-2\"><UnitSpan id={unit} isLink={true} /></div>\r\n            },\r\n            {\r\n                type: 'component', \r\n                label: '关联UQ', \r\n                component: <List className=\"w-100\" items={uqAccesses}\r\n                    item={{render: this.renderUqRow}} />\r\n            },\r\n            '',\r\n            {\r\n                type: 'component', \r\n                label: '状态',\r\n                component: this.status()\r\n            },\r\n        ];\r\n        return <Page header={\"App详情 - \" + name}>\r\n            <PropGrid rows={rows} values={{}} labelFixLeft={true} />\r\n        </Page>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount, User } from \"./CAppXAccount\";\r\nimport { View, LMR, Image, FA } from \"tonva\";\r\nimport { caches } from 'store';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VUser extends View<CAppXAccount> {\r\n    render(user: User): JSX.Element {\r\n        //return <this.row user={user} />;\r\n        return React.createElement(this.row, { user });\r\n    }\r\n\r\n    private row = observer((props: { user: User }) => {\r\n        let { user } = props;\r\n        let u = caches.users.get(user.id);\r\n        if (u === null) return;\r\n        let { name, nick, icon } = u;\r\n        let { assigned, isAdmin, roleBins } = user;\r\n        if (assigned !== undefined) nick = assigned;\r\n        if (name !== undefined) {\r\n            let { uqRoles, showEditUserPage, user: _user } = this.controller;\r\n            let left = <Image className=\"w-3c h-3c me-3\" src={icon} />;\r\n            let isMe = user.id === _user.id;\r\n            let caption: any = isMe === true ?\r\n                <div>\r\n                    {nick ? <><b>{nick}</b> {name}</> : <><b>{name}</b></>}\r\n                    &nbsp; <small className=\"text-muted\">[自己]</small>\r\n                </div>\r\n                :\r\n                <div>{nick ? <>{nick} <small>{name}</small></> : <>{name}</>}</div>;\r\n            let divRoles: any[] = [];\r\n            if (uqRoles !== undefined) {\r\n                let len = uqRoles.length;\r\n                for (let i = 0; i < len; i++) {\r\n                    if ((roleBins & (1 << i)) === 0) continue;\r\n                    divRoles.push(this.box(uqRoles[i], 'px-2 text-primary border-primary bg-white'));\r\n                }\r\n            }\r\n\r\n            return <LMR className=\"px-3 py-3 cursor-pointer\" left={left} onClick={() => showEditUserPage(user)}>\r\n                {caption}\r\n                <div className=\"d-flex flex-wrap mt-1\">\r\n                    {isAdmin === true && this.box('管理员', 'px-2 text-success border-success bg-light')}\r\n                    {divRoles}\r\n                </div>\r\n            </LMR>;\r\n        }\r\n    });\r\n\r\n    private box = (text: string, cn: string) => {\r\n        return <div className={'me-3 py-0 small border rounded ' + cn} key={text}>{text}</div>;\r\n    }\r\n}\r\n\r\nexport class VAddUser extends View<CAppXAccount> {\r\n    render(roleNum: number): JSX.Element {\r\n        return <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            onClick={() => this.controller.showAddUserPage(roleNum)}>\r\n            <FA name=\"plus\" />\r\n        </button>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount } from './CAppXAccount';\r\nimport { VPage, Page, List } from 'tonva';\r\nimport { VAddUser } from './VUser';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VAdmins extends VPage<CAppXAccount> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {appXAccount, renderUser} = this.controller;\r\n        let {name} = appXAccount;\r\n        let coll = this.controller.calcUserColl();\r\n        return <Page header={'管理员 - ' + name} right={this.renderVm(VAddUser, -1)}>\r\n            <List items={coll.admins} item={{render: renderUser}} />\r\n        </Page>;\r\n    })\r\n\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount, User } from './CAppXAccount';\r\nimport { VPage, Page, List, LMR } from 'tonva';\r\nimport { VAddUser } from './VUser';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VRoleUsers extends VPage<CAppXAccount> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {appXAccount} = this.controller;\r\n        let {name} = appXAccount;\r\n        let coll = this.controller.calcUserColl();\r\n        let {roleUsers} = coll;\r\n        return <Page header={'角色用户 - ' + name}>\r\n            <div className=\"py-0\">\r\n                {roleUsers && roleUsers.map((v, index) => {\r\n                    return this.renderRole(v, index);\r\n                })}\r\n            </div>\r\n        </Page>;\r\n    })\r\n\r\n    private renderRole = (users:User[], index:number) => {\r\n        let {uqRoles, renderUser} = this.controller;\r\n        let role = uqRoles[index];\r\n        if (!role) return;\r\n        return <div key={index} className=\"my-3\">\r\n            <LMR className=\"pl-3 pb-1 align-items-end\" right={this.renderVm(VAddUser, index+1)}>{uqRoles[index]}</LMR>\r\n            <List items={users} item={{render: renderUser}} none={()=><small className=\"text-muted\">[无]</small>} />\r\n        </div>;\r\n    }\r\n\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount } from './CAppXAccount';\r\nimport { VPage, Page, List } from 'tonva';\r\nimport { VAddUser } from './VUser';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VNoRoleUsers extends VPage<CAppXAccount> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {appXAccount, renderUser} = this.controller;\r\n        let {name} = appXAccount;\r\n        let coll = this.controller.calcUserColl();\r\n        return <Page header={'普通用户 - ' + name} right={this.renderVm(VAddUser, -2)}>\r\n            <List items={coll.users} item={{render: renderUser}} />\r\n        </Page>;\r\n    })\r\n\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount } from \"./CAppXAccount\";\r\nimport { VPage, Page, Form, Schema, StringSchema, ButtonSchema, UiSchema, UiButton, UiTextItem, Context } from \"tonva\";\r\n\r\nexport class VAddUserPage extends VPage<CAppXAccount> {\r\n    private roleNum:number;\r\n    private schema:Schema = [\r\n        {name: 'user', type: 'string', required: true} as StringSchema,\r\n        {name: 'submit', type: 'submit'} as ButtonSchema,\r\n    ];\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            'user': {widget: 'text', label: '用户', placeholder: '请输入用户账号'} as UiTextItem,\r\n            'submit': {widget: 'button', label: '提交', className: 'btn btn-primary'} as UiButton,\r\n        }\r\n    }\r\n    async open(roleNum:number) {\r\n        this.roleNum = roleNum;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onSubmit = async (name:string, context:Context) => {\r\n        let ret = await this.controller.addUser(this.roleNum, context.data.user);\r\n        if (ret === undefined) {\r\n            this.closePage();\r\n            return;\r\n        }\r\n        context.setError('user', ret);\r\n    }\r\n\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'user') {\r\n            await this.onSubmit('login', context);\r\n            return;\r\n        }\r\n    }\r\n\r\n    private page = () => {\r\n        let roleCaption = this.controller.getRoleCaption(this.roleNum);\r\n        return <Page header={'新增 - ' + roleCaption} back=\"close\">\r\n            <div className=\"m-5 px-5 py-3 bg-white border rounded\">\r\n                <Form schema={this.schema} uiSchema={this.uiSchema}\r\n                    onEnter={this.onEnter}\r\n                    onButtonClick={this.onSubmit}/>\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { CAppXAccount } from './CAppXAccount';\r\nimport { VPage, Page, List } from 'tonva';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VUserList extends VPage<CAppXAccount> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {appXAccount, users, renderUser} = this.controller;\r\n        let {name} = appXAccount;\r\n        return <Page header={'用户列表 - ' + name}>\r\n            <List items={users} item={{render: renderUser}} />\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, Media, PropGrid} from 'tonva';\r\nimport {nav, Page}  from 'tonva';\r\nimport {caches} from 'store';\r\nimport {span} from './span';\r\n\r\nexport interface UserLinkProps {\r\n    className?: string;\r\n    id: number;\r\n    assigned?: string;\r\n    isLink?: boolean;\r\n}\r\n\r\n@observer\r\nexport class UserSpan extends React.Component<UserLinkProps> {\r\n    onClick = (evt) => {\r\n        evt.preventDefault();\r\n        nav.push(<UserInfo id={this.props.id} />);\r\n        return false;\r\n    }\r\n    render() {\r\n        let {id, className, assigned, isLink} = this.props;\r\n        let api = caches.users.get(id);\r\n        let content:any;\r\n        if (api === null) {\r\n            content = id;\r\n        }\r\n        else {\r\n            let {name, nick} = api;\r\n            if (assigned !== undefined) nick = assigned;\r\n            if (name !== undefined) {\r\n                content = nick? <><b>{nick}</b> {name}</> : <><b>{name}</b></>;\r\n            }\r\n            else {\r\n                content = id;\r\n            }\r\n        }\r\n        return span(isLink, className, this.onClick, content);\r\n    }\r\n}\r\n\r\n@observer\r\nclass UserInfo extends React.Component<UserLinkProps> {\r\n    private rows:Prop[];\r\n    render() {\r\n        let uq = caches.users.get(this.props.id);\r\n        let {name, nick, icon} = uq;\r\n        this.rows = [\r\n            '',\r\n            {type: 'component', component: <Media icon={icon} main={nick} discription={name} />},\r\n            '',\r\n        ];\r\n        return <Page header={'用户 - 详细资料'}>\r\n            <PropGrid rows={this.rows} values={this.props} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { CAppXAccount, User } from \"./CAppXAccount\";\r\nimport { VPage, Page, FA } from \"tonva\";\r\nimport { UserSpan } from 'tools/userSpan';\r\n\r\nexport class VEditUserPage extends VPage<CAppXAccount> {\r\n    private user: User;\r\n    async open(user: User) {\r\n        this.user = user;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private row = (caption: string, cn: string,\r\n        isChecked: boolean,\r\n        isMeAdmin: boolean,\r\n        onChange: (event: React.ChangeEvent<HTMLInputElement>) => Promise<void>) => {\r\n        if (!caption) return;\r\n        return <label className={classNames(\r\n            \"px-3 py-2 m-0 d-flex bg-white mb-1 w-100 align-items-center\",\r\n            { \"cursor-pointer\": !isMeAdmin })}>\r\n            <input type=\"checkbox\" className=\"me-4\" defaultChecked={isChecked}\r\n                disabled={isMeAdmin}\r\n                onChange={onChange} />\r\n            <span className={cn}>{caption}</span>\r\n        </label>\r\n    }\r\n\r\n    private onAdminChanged = async (value: boolean) => {\r\n        let ret = await this.controller.setAppAdmin(this.user, value);\r\n        if (ret === undefined) this.closePage();\r\n        else alert(ret);\r\n    }\r\n\r\n    private onRoleChanged = async (value: boolean, roleNum: number) => {\r\n        let ret = await this.controller.setAppRole(this.user, roleNum, value);\r\n        // if (ret === undefined) this.closePage();\r\n        // else alert(ret);\r\n        if (ret !== undefined) alert(ret);\r\n    }\r\n\r\n    private onDelUer = async () => {\r\n        let ret = await this.controller.delUser(this.user);\r\n        if (ret === undefined) this.closePage();\r\n        else alert(ret);\r\n    }\r\n\r\n    private page = () => {\r\n        let { isAdmin, roleBins } = this.user;\r\n        let header = <>用户 -&nbsp;<UserSpan id={this.user.id} /></>;\r\n        let btnDel = this.user.id !== this.controller.user.id\r\n            && <div className=\"text-end m-3\"><button onClick={this.onDelUer}\r\n                className=\"btn btn-sm btn-outline-primary\"\r\n            ><FA name=\"trash\" /> 从App中移除</button>\r\n            </div>;\r\n        let isMeAdmin = this.user.id === this.controller.user.id;\r\n        let onAdminChange = async (event: React.ChangeEvent<HTMLInputElement>) => {\r\n            await this.onAdminChanged(event.target.checked);\r\n        }\r\n        return <Page header={header}>\r\n            <div className=\"my-3\">\r\n                {this.row('App管理员', 'text-success font-weight-bold', isAdmin, isMeAdmin, onAdminChange)}\r\n                <div className=\"h-1c\" />\r\n                {this.controller.uqRoles.map((v, index) => {\r\n                    let onRoleChange = async (event: React.ChangeEvent<HTMLInputElement>) => {\r\n                        await this.onRoleChanged(event.target.checked, index);\r\n                    }\r\n                    let isChecked = (roleBins & (1 << index)) !== 0;\r\n                    return this.row(v, 'text-primary', isChecked, false, onRoleChange);\r\n                })}\r\n                {btnDel}\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n","import _ from 'lodash';\r\nimport { CUqBase } from \"UqApp\";\r\nimport { UnitApp, Unit, DevApp } from \"model\";\r\nimport { VApp } from \"./VApp\";\r\nimport { VDetail } from \"./VDetail\";\r\nimport { devApi, mainApi } from \"api\";\r\nimport { store } from \"store\";\r\nimport { observable } from 'mobx';\r\nimport { VAdmins } from './VAdmins';\r\nimport { VRoleUsers } from './VRoleUsers';\r\nimport { VNoRoleUsers } from './VNoRoleUsers';\r\nimport { VAddUserPage } from './VAddUserPage';\r\nimport { VUser } from './VUser';\r\nimport { VUserList } from './VUserList';\r\nimport { VEditUserPage } from './VEditUserPage';\r\n\r\nexport interface User {\r\n    id: number;\r\n    assigned: string;\r\n    isAdmin: boolean;\r\n    roleBins:number;\r\n}\r\n\r\nexport interface Coll {\r\n    admins: User[];\r\n    users: User[];\r\n    roleUsers: User[][];\r\n}\r\n\r\nexport class CAppXAccount extends CUqBase {\r\n    unit: Unit;\r\n    appXAccount:DevApp;\r\n    uqAccesses: any[];\r\n    uqMain: number;\r\n    uqRoles: string[];\r\n    //userColl: {[id:number]: User};\r\n    @observable users: User[];\r\n    @observable unitOnly: boolean;\r\n    @observable roleUserCount: number;\r\n\r\n    async internalStart(unit:Unit, appXAccount:DevApp) {\r\n        this.unit = unit;\r\n        this.appXAccount = appXAccount;\r\n        this.unitOnly = appXAccount.unitOnly === 1;\r\n        await this.loadAppAdmins();\r\n        this.openVPage(VApp);\r\n    }\r\n\r\n    private async loadAppAdmins() {\r\n        let ret:any[][] = await mainApi.unitAppAdmins(this.unit.id, this.appXAccount.id);\r\n        let {uq_main, roles} = ret[0][0];\r\n        this.uqMain = uq_main;\r\n        if (roles) {\r\n            this.uqRoles = (roles as string).split('\\t');\r\n        }\r\n        this.users = [];\r\n        for (let admin of ret[1]) {\r\n            let {user:id} = admin;\r\n            let i = this.insertUser(id);\r\n            if (i>=0) this.users[i].isAdmin = true;\r\n        }\r\n        let roleUserCount = 0;\r\n        for (let userRoles of ret[2]) {\r\n            let {user:id, roles} = userRoles;\r\n            let i = this.insertUser(id);\r\n            if (i>=0) {\r\n                //let rolesArr = this.toRolesArr(roles);\r\n                this.users[i].roleBins = roles; // rolesArr;\r\n                //if (rolesArr !== undefined && rolesArr.length > 0) roleUserCount++;\r\n                if (!roles) roleUserCount++;\r\n            }\r\n        }\r\n        for (let item of ret[3]) {\r\n            let {user:id, assigned} = item;\r\n            let i = this.insertUser(id);\r\n            if (i>=0) this.users[i].assigned = assigned;\r\n        }\r\n        this.roleUserCount = roleUserCount;\r\n    }\r\n\r\n    private insertUser(id:number):number {\r\n        let len = this.users.length;\r\n        let i:number;\r\n        for (i=0; i<len; i++) {\r\n            let u = this.users[i];\r\n            let uid = u.id;\r\n            if (id === uid) return i;\r\n            if (id < uid) break;\r\n        }\r\n        this.users.splice(i, 0, {id:id} as User);\r\n        return i;\r\n    }\r\n\r\n    private toRolesArr(n: number):number[] {\r\n        if (this.uqRoles === undefined) return undefined;\r\n        let ret:number[] = [];\r\n        let len = this.uqRoles.length;\r\n        let mask = 1;\r\n        for (let i=0;i<len; i++, mask<<=1) {\r\n            if ((n & mask) === mask) ret.push(i);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    calcUserColl = (): Coll => {\r\n        let admins:User[] = [];\r\n        let users:User[] = [];\r\n        let roleUsers:User[][];\r\n        let roleUserCount = 0;\r\n        let len = 0;\r\n        if (this.uqRoles) {\r\n            len = this.uqRoles.length;\r\n            roleUsers = [];\r\n            for (let i=0; i<len; i++) roleUsers.push([]);\r\n        }\r\n        for (let user of this.users) {\r\n            let {isAdmin, roleBins} = user;\r\n            let isUser = true, isRole = false;\r\n            if (isAdmin === true) {\r\n                admins.push(user);\r\n                isUser = false;\r\n            }\r\n\r\n            let mask = 1;\r\n            for (let i=0; i<len; i++, mask<<=1) {\r\n                if ((roleBins & mask) !== 0) {\r\n                    let rus = roleUsers[i];\r\n                    if (this.user.id === user.id) \r\n                        rus.unshift(user);\r\n                    else\r\n                        rus.push(user);\r\n                    isUser = false;\r\n                    isRole = true;\r\n                }\r\n            }\r\n            if (isRole === true) {\r\n                ++roleUserCount;\r\n            }\r\n            if (isUser === true) {\r\n                users.push(user);\r\n            }\r\n        }\r\n        this.roleUserCount = roleUserCount;\r\n        return {\r\n            admins: admins,\r\n            users: users,\r\n            roleUsers: roleUsers,\r\n        };\r\n    }\r\n\r\n    showDetail = async () => {\r\n        this.uqAccesses = await devApi.loadAppUqs(this.appXAccount.id);\r\n        this.openVPage(VDetail);\r\n    }\r\n\r\n    appTurnOnOff = async ():Promise<boolean> => {\r\n        let {id, inUnit, name} = this.appXAccount;\r\n        //let newInUnit:number = 1;\r\n        if (inUnit === 0) {\r\n            let ret = await store.restoreUnitApp(id);\r\n            if (ret <= 0) {\r\n                alert('app 或者 uq 没有定义 service');\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n\r\n        if (inUnit === 1) {\r\n            let ret = await this.confirm({\r\n                caption: '停运 - ' + name,\r\n                message: 'App停运之后，任何人都无法访问。请确认',\r\n                ok: '确认',\r\n            });\r\n            if (ret !== 'ok') return false;\r\n            await store.stopUnitApp(id);\r\n            //newInUnit = 0;\r\n            return true;\r\n        }\r\n\r\n        let newApp:UnitApp = _.clone(this.appXAccount);\r\n        newApp.id = id;\r\n        newApp.inUnit = 1;\r\n        let ret = await store.addUnitApp(newApp);\r\n        if (ret <= 0) {\r\n            alert('app 或者 uq 没有定义 service');\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    showAdmins = async () => {\r\n        this.openVPage(VAdmins);\r\n    }\r\n\r\n    showRoles = async () => {\r\n        this.openVPage(VRoleUsers);\r\n    }\r\n\r\n    showUsers = async () => {\r\n        this.openVPage(VNoRoleUsers);\r\n    }\r\n\r\n    showUserList = async () => {\r\n        this.openVPage(VUserList);\r\n    }\r\n\r\n    showAddUserPage = (roleNum:number) => {\r\n        this.openVPage(VAddUserPage, roleNum);\r\n    }\r\n\r\n    showEditUserPage = (user: User) => {\r\n        this.openVPage(VEditUserPage, user);\r\n    }\r\n\r\n    getRoleCaption(roleNum:number):string {\r\n        switch(roleNum) {\r\n            case -1: return '[App管理员]';\r\n            case -2: return '[普通用户]';\r\n            default: return this.uqRoles[roleNum];\r\n        }\r\n    }\r\n\r\n    async addUser(roleNum:number, userName:string):Promise<string> {\r\n        let roleBit:number = roleNum<=0? roleNum : 1<<(roleNum-1);\r\n        let ret = await mainApi.setAppRoles(this.unit.id, this.appXAccount.id, undefined, userName, roleBit);\r\n        if (ret === undefined) return 'unauthorized';\r\n        let {r, id} = ret;\r\n        if (r !== undefined) return r;\r\n\r\n        let i = this.insertUser(id);\r\n        //let isAdmin:boolean = false; \r\n        let user = this.users[i];\r\n        if (roleNum > 0) {\r\n            user.roleBins |= (1<<roleNum-1);\r\n        }\r\n        else if (roleNum === -1) {\r\n            // 管理员\r\n            user.isAdmin = true;\r\n        }\r\n        else if (roleNum === 0) {\r\n            // 普通用户\r\n        }\r\n        //this.users[i] = {id, isAdmin, roles, assigned:undefined};\r\n    }\r\n\r\n    renderUser = (user:User, index:number) => {\r\n        return this.renderView(VUser, user);\r\n    }\r\n\r\n    async setAppAdmin(user:User, on:boolean):Promise<string> {\r\n        let {id, isAdmin, roleBins, assigned} = user;\r\n        isAdmin = on;\r\n        let ret = await mainApi.setAppAdmin(\r\n            this.unit.id, this.appXAccount.id, \r\n            id, undefined, isAdmin===true? 1:0);\r\n        if (ret === undefined) {\r\n            return 'unauthorized';\r\n        }\r\n        let {r} = ret;\r\n        if (r !== undefined) return r;\r\n\r\n        this.renewUser(user, isAdmin, roleBins, assigned);\r\n    }\r\n\r\n    async setAppRole(user:User, roleNum:number, on:boolean):Promise<string> {\r\n        let {id, isAdmin, assigned} = user;\r\n        if (on === true) {\r\n            user.roleBins |= 1<<roleNum;\r\n        }\r\n        else {\r\n            user.roleBins &= ~(1<<roleNum);\r\n        }\r\n        let roleBins = user.roleBins;\r\n        let ret = await mainApi.setAppRoles(\r\n            this.unit.id, this.appXAccount.id, \r\n            id, undefined, roleBins);\r\n        if (ret === undefined) return 'unauthorized';\r\n        let {r} = ret;\r\n        if (r !== undefined) return r;\r\n        this.renewUser(user, isAdmin, roleBins, assigned);\r\n    }\r\n\r\n    private renewUser(user:User, isAdmin:boolean, roleBins:number, assigned:string) {\r\n        let {id} = user;\r\n        let index = this.users.findIndex(v => v.id === id);\r\n        this.users[index] = {id, isAdmin, roleBins, assigned};\r\n    }\r\n\r\n    delUser = async (user:User):Promise<string> => {\r\n        let ret = await mainApi.setAppRoles(this.unit.id, this.appXAccount.id, user.id, undefined, 0);\r\n        if (ret === undefined) return 'unauthorized';\r\n        let {id, r} = ret;\r\n        if (r !== undefined) return r;\r\n        let index = this.users.findIndex(v => v.id === id);\r\n        this.users.splice(index, 1);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { CDevelopers } from \"./CDevelopers\";\r\nimport { Page, VPage, List, LMR, Image, FA } from \"tonva\";\r\nimport { UserUqsBuses } from 'store/adminDevs';\r\nimport { observer } from 'mobx-react';\r\nimport { caches } from 'store';\r\n\r\nexport class VDevelopers extends VPage<CDevelopers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderUserUqsBuses = (user: number, index: number) => {\r\n        let userUqsBuses: UserUqsBuses = this.controller.adminDevs.getUserUqsBuses(user);\r\n        let { uqs, buses } = userUqsBuses;\r\n        let userObj = caches.users.get(user);\r\n        let content: any;\r\n        if (userObj !== null) {\r\n            let { name, nick, icon } = userObj;\r\n            content = <LMR className=\"w-100\"\r\n                left={<Image className=\"w-3c h-3c me-4\" src={icon} />}\r\n                right={<div className=\"text-end\">uq: {uqs.length}<br />bus: {buses.length}</div>}>\r\n                <div>{nick ? <><b>{nick}</b><br /><small className=\"text-muted\">{name}</small></> : <><b>{name}</b></>}</div>\r\n            </LMR>\r\n        }\r\n        return <div className=\"px-3 py-2\">{content}</div>;\r\n    }\r\n\r\n    private onClickUserUqsBuses = (user: number) => {\r\n        this.controller.showUserUqsBuses(user);\r\n    }\r\n\r\n    private onAddUser = () => {\r\n        this.controller.showAddDeveloper();\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { adminDevs } = this.controller;\r\n        let { unit, users } = adminDevs;\r\n        let right = <button className=\"btn btn-sm btn-success align-self-center me-3\" onClick={this.onAddUser}><FA name=\"plus\" /></button>\r\n        return <Page header={\"开发者 - \" + unit.name} right={right}>\r\n            <List className=\"my-3\" items={users}\r\n                item={{ render: this.renderUserUqsBuses, onClick: this.onClickUserUqsBuses }} />\r\n        </Page>\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport { CDevelopers } from \"./CDevelopers\";\r\nimport { VPage, Page, List, LMR, FA } from 'tonva';\r\nimport { UserSpan } from 'tools/userSpan';\r\nimport { BusSpan, UqSpan } from 'tools';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VUqsBuses extends VPage<CDevelopers> {\r\n    private user: number;\r\n    async open(user: number) {\r\n        this.user = user;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderUq = (uq: number, index: number) => {\r\n        return <div className=\"px-3 py-2 align-items-center\">\r\n            <FA className=\"text-primary\" size=\"lg\" name=\"database\" fixWidth={true} />\r\n            <div className=\"mx-3\"><UqSpan id={uq} /></div>\r\n        </div>;\r\n    }\r\n\r\n    private onChangeUq = () => {\r\n        this.controller.showUserUqs(this.user);\r\n    }\r\n\r\n    private renderBus = (bus: number, index: number) => {\r\n        return <div className=\"px-3 py-2 align-items-center\">\r\n            <FA className=\"text-primary\" size=\"lg\" name=\"cogs\" fixWidth={true} />\r\n            <div className=\"mx-3\"><BusSpan id={bus} /></div>\r\n        </div>;\r\n    }\r\n\r\n    private onChangeBus = () => {\r\n        this.controller.showUserBuses(this.user);\r\n    }\r\n\r\n    private onDelDev = async () => {\r\n        if (await this.controller.confirm({\r\n            message: '真的要取消开发者资格吗？',\r\n            ok: '确认'\r\n        }) === 'ok') {\r\n            await this.controller.delDev(this.user);\r\n            this.closePage();\r\n        }\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { user, uqs, buses } = this.controller.adminDevs.getUserUqsBuses(this.user);\r\n        let btnUqAdd = <button className=\"btn btn-success btn-sm\" onClick={this.onChangeUq}><FA name=\"pencil\" /></button>;\r\n        let uqHeader = <LMR className=\"px-3 pb-1 align-items-end\" right={btnUqAdd}>UQ</LMR>;\r\n        let btnBusAdd = <button className=\"btn btn-success btn-sm\" onClick={this.onChangeBus}><FA name=\"pencil\" /></button>;\r\n        let busHeader = <LMR className=\"px-3 pb-1 align-items-end\" right={btnBusAdd}>BUS</LMR>;\r\n        let right = <button className=\"btn btn-outline-info btn-sm align-self-center me-3\" onClick={this.onDelDev}><FA name=\"minus\" /></button>;\r\n\r\n        return <Page header=\"开发者 - UQ BUS\" right={right}>\r\n            <div className=\"px-3 py-2\"><UserSpan id={user} /></div>\r\n            <div className=\"h-1c\" />\r\n\r\n            {uqHeader}\r\n            <List className=\"mb-3\" items={uqs}\r\n                item={{ render: this.renderUq, onClick: undefined/*this.onClickUq*/ }} />\r\n            <div className=\"h-1c\" />\r\n            {busHeader}\r\n            <List className=\"mb-3\" items={buses}\r\n                item={{ render: this.renderBus, onClick: undefined/*this.onClickBus*/ }} />\r\n        </Page>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport { CDevelopers } from \"./CDevelopers\";\r\nimport { VPage, Page, List, FA } from 'tonva';\r\nimport { UserSpan } from 'tools/userSpan';\r\nimport { UqSpan } from 'tools';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VUqs extends VPage<CDevelopers> {\r\n    private user: number;\r\n    async open(user: number) {\r\n        this.user = user;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onCheckChanged = async (evt: React.ChangeEvent<HTMLInputElement>, dev: number) => {\r\n        await this.controller.changeUserDev(evt.target.checked, 'uq', this.user, dev);\r\n    }\r\n\r\n    private renderUqItem = (item: { dev: number, selected: boolean }, index: number) => {\r\n        let { dev, selected } = item;\r\n        return <label className=\"ms-0 px-3 py-2 align-items-center\">\r\n            <input className=\"me-4\" type=\"checkbox\" defaultChecked={selected}\r\n                onChange={async evt => await this.onCheckChanged(evt, dev)} />\r\n            <FA className=\"text-primary\" size=\"lg\" name=\"database\" fixWidth={true} />\r\n            <div className=\"mx-3\"><UqSpan id={dev} /></div>\r\n        </label>;\r\n    }\r\n\r\n    private onClickUq = (uq: number) => {\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { adminDevs } = this.controller;\r\n        let { uqDevs } = adminDevs;\r\n        let { user, uqs } = adminDevs.getUserUqsBuses(this.user);\r\n        let uqItems: { dev: number, selected: boolean }[] = uqDevs.map(uq => {\r\n            return {\r\n                dev: uq,\r\n                selected: uqs.findIndex(v => v === uq) >= 0\r\n            }\r\n        });\r\n        return <Page header=\"增减 - UQ\">\r\n            <div className=\"px-3 py-2\"><UserSpan id={user} /></div>\r\n            <div className=\"h-1c\" />\r\n\r\n            <List className=\"mb-3\" items={uqItems}\r\n                item={{ render: this.renderUqItem, onClick: this.onClickUq }} />\r\n            <div className=\"h-1c\" />\r\n        </Page>;\r\n    });\r\n}","import * as React from 'react';\r\nimport { CDevelopers } from \"./CDevelopers\";\r\nimport { VPage, Page, List, FA } from 'tonva';\r\nimport { UserSpan } from 'tools/userSpan';\r\nimport { BusSpan } from 'tools';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VBuses extends VPage<CDevelopers> {\r\n    private user: number;\r\n    async open(user: number) {\r\n        this.user = user;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onCheckChanged = async (evt: React.ChangeEvent<HTMLInputElement>, dev: number) => {\r\n        await this.controller.changeUserDev(evt.target.checked, 'bus', this.user, dev);\r\n    }\r\n\r\n    private renderBusItem = (item: { dev: number, selected: boolean }, index: number) => {\r\n        let { dev, selected } = item;\r\n        return <label className=\"ms-0 px-3 py-2 align-items-center\">\r\n            <input className=\"me-4\" type=\"checkbox\" defaultChecked={selected}\r\n                onChange={async evt => await this.onCheckChanged(evt, dev)} />\r\n            <FA className=\"text-primary\" size=\"lg\" name=\"database\" fixWidth={true} />\r\n            <div className=\"mx-3\"><BusSpan id={dev} /></div>\r\n        </label>;\r\n    }\r\n\r\n    private onClickBusItem = (bus: number) => {\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { adminDevs } = this.controller;\r\n        let { buses } = adminDevs;\r\n        let { user, buses: userBuses } = adminDevs.getUserUqsBuses(this.user);\r\n        let items: { dev: number, selected: boolean }[] = buses.map(dev => {\r\n            return {\r\n                dev: dev,\r\n                selected: userBuses.findIndex(v => v === dev) >= 0\r\n            }\r\n        });\r\n        return <Page header=\"增减 - UQ\">\r\n            <div className=\"px-3 py-2\"><UserSpan id={user} /></div>\r\n            <div className=\"h-1c\" />\r\n\r\n            <List className=\"mb-3\" items={items}\r\n                item={{ render: this.renderBusItem, onClick: this.onClickBusItem }} />\r\n            <div className=\"h-1c\" />\r\n        </Page>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport { CDevelopers } from \"./CDevelopers\";\r\nimport { VPage, Page, Form, ItemSchema, StringSchema, UiSchema, \r\n    ButtonSchema, UiTextItem, UiButton, Context } from 'tonva';\r\n\r\nexport class VAddDeveloper extends VPage<CDevelopers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onSubmitClick = async (name:string, context:Context) => {\r\n        let ret = await this.controller.addDev(context.data.user);\r\n        let {r} = ret;\r\n        if (r === 'success') {\r\n            this.closePage();\r\n            return;\r\n        }\r\n        let error: string;\r\n        switch (r) {\r\n            case 'is-root': error = '是创建人，不需要设为开发者'; break;\r\n            case 'is-owner': error = '是所有者，不需要设为开发者'; break;\r\n            case 'is-admin': error = '是管理员，不需要设为开发者'; break;\r\n            case 'is-dev': error = '已经是开发者了'; break;\r\n        }\r\n        context.setError('user', error);\r\n    }\r\n\r\n    private page = () => {\r\n        let schema: ItemSchema[] = [\r\n            {name: 'user', type: 'string', maxLength: 50, required: true} as StringSchema,\r\n            {name: 'submit', type: 'submit' } as ButtonSchema,\r\n        ];\r\n        let uiSchema: UiSchema = {\r\n            items: {\r\n                user: {widget: 'text', label: '用户名', placeholder: '请输入开发者的账号'} as UiTextItem,\r\n                submit: {widget: 'button', label: '提交', className:'btn btn-success'} as UiButton\r\n            }\r\n        };\r\n        return <Page header=\"新增开发者\">\r\n            <Form className=\"m-5\" schema={schema} uiSchema={uiSchema} \r\n                onEnter={this.onSubmitClick}\r\n                onButtonClick={this.onSubmitClick} />\r\n        </Page>;\r\n    }\r\n}","import { CUqBase } from \"UqApp\";\r\nimport { VDevelopers } from \"./VDevelopers\";\r\nimport { AdminDevs } from \"store/adminDevs\";\r\nimport { VUqsBuses } from \"./VUqsBuses\";\r\nimport { VUqs } from \"./VUqs\";\r\nimport { VBuses } from \"./VBuses\";\r\nimport { devApi, mainApi } from \"api\";\r\nimport { VAddDeveloper } from \"./VAddDeveloper\";\r\n\r\nexport class CDevelopers extends CUqBase {\r\n    adminDevs: AdminDevs;\r\n\r\n    protected async internalStart(adminDevs: AdminDevs) {\r\n        this.adminDevs = adminDevs;\r\n        this.openVPage(VDevelopers);\r\n    }\r\n\r\n    showUserUqsBuses(user: number) {\r\n        this.openVPage(VUqsBuses, user);\r\n    }\r\n\r\n    showUserUqs(user: number) {\r\n        this.openVPage(VUqs, user);\r\n    }\r\n    \r\n    showUserBuses(user: number) {\r\n        this.openVPage(VBuses, user);\r\n    }\r\n\r\n    async changeUserDev(isSelected:boolean, type:'uq'|'bus', user:number, dev:number) {\r\n        if (isSelected === true) {\r\n            await devApi.adminDevAdd({unit: this.adminDevs.unit.id, type: type, dev: dev, devUser: user});\r\n            this.adminDevs.devs.push({\r\n                type: type,\r\n                user: user,\r\n                dev: dev\r\n            });\r\n        }\r\n        else {\r\n            await devApi.adminDevDel({unit: this.adminDevs.unit.id, type: type, dev: dev, devUser: user});\r\n            let index = this.adminDevs.devs.findIndex(v => v.dev===dev && v.type===type && v.user===user);\r\n            if (index >= 0) this.adminDevs.devs.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    showAddDeveloper() {\r\n        this.openVPage(VAddDeveloper);\r\n    }\r\n\r\n    async addDev(dev:string): Promise<any> {\r\n        let {users, unit} = this.adminDevs;\r\n        let ret = await mainApi.addDev(unit.id, dev);\r\n        if (ret === undefined) {\r\n            throw new Error('unauthorized!');\r\n        }\r\n        let {r, id} = ret;\r\n        if (r === 'success') {\r\n            users.push(id);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    async delDev(user: number): Promise<void> {\r\n        let {users, unit} = this.adminDevs;\r\n        await mainApi.delDev(unit.id, user);\r\n        let index = users.findIndex(v => v === user);\r\n        if (index >= 0) users.splice(index, 1);\r\n    }\r\n}\r\n","import { observable } from \"mobx\";\r\nimport { mainApi } from \"api\";\r\nimport { Unit } from \"model\";\r\n\r\nexport interface AdminDev {\r\n    type: string;\r\n    dev: number;\r\n    user: number;\r\n}\r\n\r\nexport interface UserUqsBuses {\r\n    user: number;\r\n    uqs: number[];\r\n    buses: number[];\r\n}\r\n\r\nexport interface UqUsers {\r\n    uq: number;\r\n    users: number[];\r\n}\r\n\r\nexport interface BusUsers {\r\n    bus: number;\r\n    users: number[];\r\n}\r\n\r\nexport class AdminDevs {\r\n    private loaded:boolean = false;\r\n    unit: Unit;\r\n    @observable users: number[];\r\n    @observable uqDevs: number[];\r\n    @observable buses: number[];\r\n    @observable devs: AdminDev[];\r\n\r\n    constructor(unit: Unit) {\r\n        this.unit = unit;\r\n    }\r\n\r\n    async load() {\r\n        if (this.loaded === true) return;\r\n        let ret = await mainApi.adminDevs(this.unit.id);\r\n        this.loaded = true;\r\n        this.users = ret[0].map(v => v.user);\r\n        this.devs = ret[1];\r\n        this.uqDevs = ret[2].map(v => v.id);\r\n        this.buses = ret[3].map(v => v.id);\r\n    }\r\n\r\n    getUserUqsBuses(user: number):UserUqsBuses {\r\n        //let ret:UserUqsBuses[] = [];\r\n        //for (let user of this.users) {\r\n            let uqs: number[] = [];\r\n            let buses: number[] = [];\r\n            let ret = {\r\n                user: user,\r\n                uqs: uqs,\r\n                buses: buses\r\n            };\r\n            for (let dev of this.devs) {\r\n                if (dev.user === user) {\r\n                    switch (dev.type) {\r\n                        case 'uq': uqs.push(dev.dev); break;\r\n                        case 'bus': buses.push(dev.dev); break;\r\n                    }\r\n                }\r\n            }\r\n        //}\r\n        return ret;\r\n    }\r\n\r\n    getUqUsers(): UqUsers[] {\r\n        let ret:UqUsers[] = [];\r\n        for (let uq of this.uqDevs) {\r\n            let users: number[] = [];\r\n            ret.push({\r\n                uq: uq,\r\n                users: users,\r\n            });\r\n            for (let dev of this.devs) {\r\n                if (dev.type === 'uq' && dev.dev === uq) {\r\n                    users.push(dev.user);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    getBusUsers(): BusUsers[] {\r\n        let ret:BusUsers[] = [];\r\n        for (let bus of this.buses) {\r\n            let users: number[] = [];\r\n            ret.push({\r\n                bus: bus,\r\n                users: users,\r\n            });\r\n            for (let dev of this.devs) {\r\n                if (dev.type === 'bus' && dev.dev === bus) {\r\n                    users.push(dev.user);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n","import { DevUQ } from \"model\";\r\nimport { FA, List, VPage } from \"tonva\";\r\nimport { CUqRoles } from \"./CUqRoles\";\r\n\r\nexport class VUqRoles extends VPage<CUqRoles> {\r\n\theader() { return 'UQ角色设置' }\r\n\tcontent() {\r\n\t\tlet { devUQs, onDevUQ } = this.controller;\r\n\t\treturn <div>\r\n\t\t\t<List items={devUQs} item={{ render: this.renderDevUQ, onClick: onDevUQ }} />\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate renderDevUQ = (item: DevUQ & { roles: string[] }, index: number) => {\r\n\t\tlet { name, discription, roles } = item;\r\n\t\treturn <div className=\"px-3 py-2\">\r\n\t\t\t<FA name=\"database\" className=\"text-info my-2 mx-1\" size=\"lg\" />\r\n\t\t\t<div className=\"ms-3\">\r\n\t\t\t\t<div>{name}</div>\r\n\t\t\t\t<div className=\"small text-muted\">{discription}</div>\r\n\t\t\t\t<div className=\"mt-3\">\r\n\t\t\t\t\t<small className=\"text-muted me-1\">角色:</small>\r\n\t\t\t\t\t{roles?.map((v, index) => <span key={index} className=\"mx-2\">{v}</span>)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n}\r\n","import { Form, ItemSchema, VPage, StringSchema, ButtonSchema, UiButton, UiTextItem, Context } from \"tonva\";\r\nimport { CUqRoles } from \"./CUqRoles\";\r\n\r\nexport class VAddUser extends VPage<CUqRoles> {\r\n\theader() {return '新增角色用户'}\r\n\tcontent() {\r\n\t\tlet schema:ItemSchema[] = [\r\n\t\t\t{ name: 'userName', required: true, type: 'string', maxLength: 60 } as StringSchema,\r\n\t\t\t{ name: 'ok', type: 'submit' } as ButtonSchema,\r\n\t\t];\r\n\t\tlet uiSchema = {\r\n\t\t\titems: {\r\n\t\t\t\tuserName: { widget: 'text', label:'用户账号', placeholder: '请输入用户的账号' } as UiTextItem,\r\n\t\t\t\tok: { widget: 'button', className: 'btn btn-primary', label: '提交' } as UiButton,\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t<Form schema={schema} uiSchema={uiSchema} onButtonClick={this.onClick} onEnter={this.onEnter} />\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate onClick = async (name:string, context: Context) => {\r\n\t\tlet error = await this.controller.newUser(context.data['userName']);\r\n\t\tif (error) {\r\n\t\t\tcontext.setError('userName', error);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.closePage();\r\n\t}\r\n\r\n\tprivate onEnter = async (name:string, context: Context) => {\r\n\t\tawait this.onClick(name, context);\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport { FA, LMR, VPage } from \"tonva\";\r\nimport { CUqRoles, UserRole } from \"./CUqRoles\";\r\nimport { VAddUser } from \"./VAddUser\";\r\n\r\nexport class VRoleAdmin extends VPage<CUqRoles> {\r\n\theader() { return '设置用户角色' }\r\n\tcontent() {\r\n\t\tlet { userRoles } = this.controller;\r\n\t\tlet VItem = observer((v: { userRole: UserRole; isMe: boolean }) => this.renderItem(v.userRole, v.isMe));\r\n\t\tlet VUserRoles = observer(() => <>{\r\n\t\t\tuserRoles.map(v => {\r\n\t\t\t\treturn <VItem key={v.user} userRole={v} isMe={false} />;\r\n\t\t\t})\r\n\t\t}</>);\r\n\t\tlet MeItem = observer(() => <VItem userRole={this.controller.meRoles} isMe={true} />);\r\n\t\treturn <div>\r\n\t\t\t<div className=\"mx-3 mt-3 mb-1 d-flex align-items-end\">\r\n\t\t\t\t<div className=\"me-auto\">用户角色</div>\r\n\t\t\t\t<button className=\"btn btn-sm btn-outline-primary\" onClick={() => this.openVPage(VAddUser)}><FA name=\"plus\" /> 增加</button>\r\n\t\t\t</div>\r\n\t\t\t{\r\n\t\t\t\tuserRoles.length > 0 ? <>\r\n\t\t\t\t\t<MeItem />\r\n\t\t\t\t\t<VUserRoles />\r\n\t\t\t\t</>\r\n\t\t\t\t\t:\r\n\t\t\t\t\t<div className=\"small text-muted p-3\">[无角色用户]</div>\r\n\t\t\t}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderItem = (userRole: UserRole, isMe: boolean) => {\r\n\t\tif (!userRole) return null;\r\n\t\tlet { user, roles, isDeleted } = userRole;\r\n\t\tlet { allRoles } = this.controller;\r\n\t\tlet onUndo = () => this.controller.restoreUser(userRole);\r\n\t\tlet onDelete = () => this.controller.deleteUser(userRole);\r\n\t\tlet onRightClick: () => void;\r\n\t\tlet rightIcon: string;\r\n\t\tlet vUser = this.renderUser(user);\r\n\t\tlet cn = 'bg-white border-top ';\r\n\t\tif (isMe === true) {\r\n\t\t\tcn += 'mb-1';\r\n\t\t\tvUser = <>{vUser}<small className=\"ms-1 text-success\">[自己]</small></>;\r\n\t\t}\r\n\t\tif (isDeleted === true) {\r\n\t\t\tonRightClick = onUndo;\r\n\t\t\trightIcon = 'undo';\r\n\t\t\tvUser = <del>{vUser}</del>\r\n\t\t}\r\n\t\telse {\r\n\t\t\tonRightClick = onDelete;\r\n\t\t\trightIcon = 'times';\r\n\t\t}\r\n\t\tlet right = <div className=\"p-3 cursor-pointer text-info\" onClick={onRightClick}><FA name={rightIcon} /></div>;\r\n\t\treturn <LMR key={user}\r\n\t\t\tclassName={cn}\r\n\t\t\tleft={<div className=\"p-3 w-12c\">{vUser}</div>}\r\n\t\t\tright={right}\r\n\t\t>\r\n\t\t\t<div className=\"d-flex flex-wrap\">\r\n\t\t\t\t{roles.map((v, i) => {\r\n\t\t\t\t\tlet vCap: any = allRoles[i];\r\n\t\t\t\t\tif (isDeleted === true) vCap = <del>{vCap}</del>\r\n\t\t\t\t\treturn <label className=\"m-3\" key={i}>\r\n\t\t\t\t\t\t<input className=\"me-2\" type='checkbox'\r\n\t\t\t\t\t\t\tdisabled={isDeleted} defaultChecked={v}\r\n\t\t\t\t\t\t\tonChange={e => this.onRoleChange(e, i, userRole)} />\r\n\t\t\t\t\t\t{vCap}\r\n\t\t\t\t\t</label>;\r\n\t\t\t\t})}\r\n\t\t\t</div>\r\n\t\t</LMR>;\r\n\t}\r\n\r\n\tprivate async onRoleChange(event: React.ChangeEvent<HTMLInputElement>, iRole: number, userRole: UserRole) {\r\n\t\tlet { target } = event;\r\n\t\ttarget.disabled = true;\r\n\t\tawait this.controller.setUserRole(target.checked, iRole, userRole);\r\n\t\ttarget.disabled = false;\r\n\t}\r\n}\r\n","import { centerApi, UqApi } from 'tonva';\r\nimport { devApi } from \"../api\";\r\nimport { DevUQ, Unit } from \"../model\";\r\nimport { CUqBase } from \"UqApp\";\r\nimport { VUqRoles } from \"./VUqRoles\";\r\nimport { observable, runInAction } from 'mobx';\r\nimport { VRoleAdmin } from './VRoleAdmin';\r\n\r\nexport interface UserRole {\r\n\tuser:number; \r\n\troles:boolean[];\r\n\tisDeleted?: boolean;\r\n}\r\n\r\nexport class CUqRoles extends CUqBase {\r\n\tprivate unit: Unit;\r\n\tprivate uqApi: UqApi;\r\n\tprivate myRolesChanged:(roles:string[])=>void;\r\n\r\n\tdevUQs: (DevUQ&{roles:string[]})[];\r\n\tallRoles: string[];\r\n\t//roleCaptions: string[];\r\n\t@observable meRoles: UserRole = null;\r\n\t@observable userRoles: UserRole[] = null;\r\n\r\n\tprotected async internalStart(unit: Unit) {\r\n\t\tthis.unit = unit;\r\n\t\tawait this.loadUQs();\r\n\t\tthis.openVPage(VUqRoles);\r\n\t}\r\n\r\n\tasync loadUQs() {\r\n\t\tlet ret = await devApi.unitUQs(this.unit.id, 1000);\r\n\t\tthis.devUQs = ret.map(v => {\r\n\t\t\tlet roles: string[];\r\n\t\t\ttry {\r\n\t\t\t\troles = JSON.parse(v.roles);\r\n\t\t\t}\r\n\t\t\tcatch {\r\n\t\t\t\ttry {\r\n\t\t\t\t\troles = v.roles.split('\\t');\r\n\t\t\t\t}\r\n\t\t\t\tcatch {\r\n\t\t\t\t\troles = [];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!roles) return v;\r\n\t\t\troles = roles.filter(v => v);\r\n\t\t\treturn {\r\n\t\t\t\t...v,\r\n\t\t\t\troles,\r\n\t\t\t};\r\n\t\t});\r\n\t}\r\n\r\n\tonDevUQ = async (item: DevUQ & {roles: string[]}) => {\r\n\t\tlet basePath:string = 'tv/';\r\n\t\tlet appOwner:string = undefined;\r\n\t\tlet appName:string = undefined;\r\n\t\tlet uqOwner = item.owner;\r\n\t\tlet uqName = item.name;\r\n\t\tlet access:string[] = undefined;\r\n\t\tlet showWaiting = false;\r\n\t\tthis.uqApi = new UqApi(basePath, appOwner, appName, uqOwner, uqName, access, showWaiting);\r\n\t\tawait this.uqApi.init();\r\n\r\n\t\tthis.allRoles = item.roles;\r\n\t\tlet allUserRoles = await this.uqApi.getAllRoleUsers();\r\n\t\trunInAction(() => {\r\n\t\t\tlet r0 = allUserRoles.shift();\r\n\t\t\tlet {roles} = r0;\r\n\t\t\tif (roles) {\r\n\t\t\t\t//this.ixOfUsers = roles.split('|');\r\n\t\t\t}\r\n\t\t\tlet arr:string[] = this.allRoles.map(v => `|${v}|`);\r\n\t\t\tfunction rolesBool(t:string): boolean[] {\r\n\t\t\t\tif (!t) return arr.map(v => false);\r\n\t\t\t\treturn arr.map(v => t.indexOf(v) >= 0);\r\n\t\t\t}\r\n\t\t\tthis.userRoles = [];\r\n\t\t\tlet meId = this.user.id;\r\n\t\t\tfor (let ur of allUserRoles) {\r\n\t\t\t\tlet {user, roles} = ur;\r\n\t\t\t\tlet item:UserRole = ur as any;\r\n\t\t\t\titem.roles = rolesBool(roles);\r\n\t\t\t\tif (user === meId)\r\n\t\t\t\t\tthis.meRoles = item;\r\n\t\t\t\telse\r\n\t\t\t\t\tthis.userRoles.push(item);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.openVPage(VRoleAdmin);\r\n\t}\r\n\t\r\n\tasync setUserRole(checked:boolean, iRole:number, userRole:UserRole) {\r\n\t\tlet {roles} = userRole;\r\n\t\tlet len = roles.length;\r\n\t\tlet text:string = '';\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet yes = i===iRole? checked : roles[i];\r\n\t\t\tif (yes === true) text += '|' + this.allRoles[i];\r\n\t\t}\r\n\t\ttext += '|';\r\n\t\tawait this.uqApi.setUserRoles(userRole.user, text);\r\n\t\troles[iRole] = checked;\r\n\t\tthis.fireMyRolesChanged(userRole);\r\n\t}\r\n\r\n\tprivate fireMyRolesChanged(userRole: UserRole, newRoles?:boolean[]) {\r\n\t\tif (!this.myRolesChanged) return;\r\n\t\tif (userRole !== this.meRoles) return;\r\n\t\tlet {roles} = userRole;\r\n\t\tif (newRoles) roles = newRoles;\r\n\t\tlet roleNames:string[] = ['$'];\r\n\t\tfor (let i=0; i<roles.length; i++) {\r\n\t\t\tif (roles[i] === true) roleNames.push(this.allRoles[i]);\r\n\t\t}\r\n\t\tthis.myRolesChanged(roleNames);\r\n\t}\r\n\r\n\tprivate buildRolesText(userRole:UserRole) {\r\n\t\tlet ret = userRole.roles.map((v, index) => v===true? this.allRoles[index]:'').join('|');\r\n\t\treturn `|${ret}|`;\r\n\t}\r\n\r\n\tasync newUser(userName: string): Promise<string> {\r\n\t\tlet ret = await centerApi.userFromKey(userName);\r\n\t\tif (!ret) {\r\n\t\t\treturn '这个用户名没有注册';\r\n\t\t}\r\n\t\tlet user = ret.id;\r\n\t\tlet roles: string;\r\n\t\tif (this.isMe(user) === true) {\r\n\t\t\tif (this.meRoles) {\r\n\t\t\t\tthis.meRoles.isDeleted = false;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.meRoles = {\r\n\t\t\t\t\tuser,\r\n\t\t\t\t\troles:  this.allRoles.map(v => false)\r\n\t\t\t\t};\t\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet userRole = this.userRoles.find(v => v.user === user);\r\n\t\t\tif (userRole) {\r\n\t\t\t\tif (userRole.isDeleted === true) {\r\n\t\t\t\t\tuserRole.isDeleted = false;\r\n\t\t\t\t\troles = this.buildRolesText(userRole);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturn '这个用户已经是角色用户了';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tuserRole = {\r\n\t\t\t\t\tuser,\r\n\t\t\t\t\troles: this.allRoles.map(v => false),\r\n\t\t\t\t};\r\n\t\t\t\tthis.userRoles.push(userRole);\r\n\t\t\t\troles = '';\r\n\t\t\t}\r\n\t\t}\r\n\t\tawait this.uqApi.setUserRoles(user, roles);\r\n\t\tif (this.isMe(user) === true) {\r\n\t\t\tthis.fireMyRolesChanged(this.meRoles);\r\n\t\t}\r\n\t}\r\n\r\n\tasync deleteUser(userRole: UserRole) {\r\n\t\tlet {user} = userRole;\r\n\t\tuserRole.isDeleted = true; \r\n\t\tawait this.uqApi.deleteUserRoles(user);\r\n\t\tthis.fireMyRolesChanged(userRole, this.allRoles.map(v => false));\r\n\t}\r\n\r\n\tasync restoreUser(userRole: UserRole) {\r\n\t\tlet {user} = userRole;\r\n\t\tuserRole.isDeleted = false;\r\n\t\tlet roles = this.buildRolesText(userRole)\r\n\t\tawait this.uqApi.setUserRoles(user, roles);\r\n\t\tthis.fireMyRolesChanged(userRole);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { Page, ItemSchema, UiCheckItem, UiButton, ButtonSchema, Form, Context, Image, VPage } from 'tonva';\r\nimport { UnitAdmin } from '../model/index';\r\nimport { CAdmins } from './CAdmins';\r\n\r\nexport class VEditAdmin extends VPage<CAdmins> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onSubmit = async (name: string, context: Context) => {\r\n        let { isOwner, isAdmin } = context.form.data;\r\n        await this.controller.setAdmin(isOwner, isAdmin);\r\n        this.closePage();\r\n    }\r\n    private page = observer(() => {\r\n        let { unit, admins } = this.controller;\r\n        let { isRoot, isOwner } = unit;\r\n        let unitAdmin = admins.cur;\r\n        let owner: ItemSchema = { name: 'isOwner', type: 'boolean' };\r\n        let admin: ItemSchema = { name: 'isAdmin', type: 'boolean' };\r\n        let submit: ButtonSchema = { name: 'submit', type: 'submit' };\r\n        let schema: ItemSchema[];\r\n        if (isRoot === 1) schema = [owner, admin, submit];\r\n        else if (isOwner === 1) schema = [admin, submit];\r\n        let data = {\r\n            isOwner: unitAdmin.isOwner,\r\n            isAdmin: unitAdmin.isAdmin,\r\n        };\r\n\r\n        let uiSchema = {\r\n            items: {\r\n                'isOwner': { widget: 'checkbox', label: '高管', trueValue: 1, falseValue: 0 } as UiCheckItem,\r\n                'isAdmin': { widget: 'checkbox', label: '管理员', trueValue: 1, falseValue: 0 } as UiCheckItem,\r\n                'submit': { widget: 'button', label: '提交', className: 'btn btn-primary' } as UiButton,\r\n            }\r\n        };\r\n\r\n        return <Page header='权限'>\r\n            <div className=\"px-3\">\r\n                <Fellow {...admins.cur} />\r\n                <Form schema={schema} uiSchema={uiSchema} formData={data} onButtonClick={this.onSubmit} />\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n\r\nconst Fellow = (props: UnitAdmin) => {\r\n    let { name, nick, icon } = props;\r\n    //<img className='w-75' src={icon || process.env.REACT_APP_DEFAULT_ICON} />\r\n    return <div>\r\n        <div className='d-flex my-4'>\r\n            <Image className=\"w-3c h-3c me-3\" src={icon} />\r\n            <div className=\"\">\r\n                <h4 className='text-dark'>{name}</h4>\r\n                {nick && <h6><small className='text-secondary'>{nick}</small></h6>}\r\n            </div>\r\n        </div>\r\n        <hr className='mb-4' />\r\n    </div>;\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, Form, Schema, StringSchema, ButtonSchema, UiSchema, UiButton, UiTextItem, Context } from \"tonva\";\r\nimport { CAdmins } from './CAdmins';\r\nimport { unitCaption } from 'model';\r\n\r\nexport class VAddAdmin extends VPage<CAdmins> {\r\n    private roleNum:number;\r\n    private schema:Schema = [\r\n        {name: 'user', type: 'string', required: true} as StringSchema,\r\n        {name: 'submit', type: 'submit'} as ButtonSchema,\r\n    ];\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            'user': {widget: 'text', label: '用户', placeholder: '请输入用户账号'} as UiTextItem,\r\n            'submit': {widget: 'button', label: '提交', className: 'btn btn-primary'} as UiButton,\r\n        }\r\n    }\r\n    async open(roleNum:number) {\r\n        this.roleNum = roleNum;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onSubmit = async (name:string, context:Context) => {\r\n        let ret = await this.controller.addAdmin(context.data.user);\r\n        if (ret === undefined) {\r\n            this.closePage();\r\n            return;\r\n        }\r\n        let err:string;\r\n        switch (ret) {\r\n            default: err = '未知错误'; break;\r\n            case 'no-exist': err = '用户不存在'; break;\r\n            case 'me': err = '你自己已经是管理员'; break;\r\n            case 'admin': err = '已经是管理员'; break;\r\n        }\r\n        context.setError('user', err);\r\n    }\r\n\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'user') {\r\n            await this.onSubmit('login', context);\r\n            return;\r\n        }\r\n    }\r\n\r\n    private page = () => {\r\n        //let roleCaption = this.controller.getRoleCaption(this.roleNum);\r\n        return <Page header={'新增 - ' + unitCaption(this.controller.unit) + '管理员'} back=\"close\">\r\n            <div className=\"m-5 px-5 py-3 bg-white border rounded\">\r\n                <Form schema={this.schema} uiSchema={this.uiSchema}\r\n                    onEnter={this.onEnter}\r\n                    onButtonClick={this.onSubmit}/>\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { CAdmins } from \"./CAdmins\";\r\nimport { VPage, List, Page, Image, LMR, FA } from \"tonva\";\r\nimport { UnitAdmin } from 'model';\r\nimport { VEditAdmin } from './VEditAdmin';\r\nimport { VAddAdmin } from './VAddAdmin';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\n\r\nexport class VAdmins extends VPage<CAdmins> {\r\n    private list: List;\r\n    @observable allSelectVisible: boolean = true;\r\n    @observable allUnSelectVisible: boolean = false;\r\n    @observable disableDel: boolean = true;\r\n\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onNewFellow = () => {\r\n        //nav.push(<NewFellow />);\r\n    }\r\n    private onItemClick = (ua: UnitAdmin) => {\r\n        //store.admins.cur = ua;\r\n        this.controller.admins.cur = ua;\r\n        this.openVPage(VEditAdmin);\r\n        //nav.push(<EditAdmin />);\r\n    }\r\n    private onItemSelect = (ua: UnitAdmin, isSelected: boolean, anySelected: boolean) => {\r\n        this.disableDel = !anySelected;\r\n    }\r\n\r\n    private onSelectAll = () => {\r\n        this.list.selectAll();\r\n    }\r\n\r\n    private onClearAll = () => {\r\n        this.list.unselectAll();\r\n    }\r\n\r\n    private onDel = async () => {\r\n        await this.controller.delAdmins(this.list.selectedItems);\r\n    }\r\n\r\n    private row = ({ icon, name, nick }: UnitAdmin) => {\r\n        let content = nick ?\r\n            <><b>{nick}</b> &nbsp; <small className=\"text-muted\">{name}</small></>\r\n            :\r\n            <b>{name}</b>;\r\n        let left = <Image className=\"w-2-5c h-2-5c\" src={icon} />;\r\n        return <LMR className=\"py-2 px-3 align-items-stretch\" left={left}>\r\n            <div className=\"px-3\">{content}</div>\r\n        </LMR>;\r\n    }\r\n\r\n    onAddAdmin = () => {\r\n        this.openVPage(VAddAdmin);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { admins } = this.controller;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success me-2 align-self-center\"\r\n            onClick={this.onAddAdmin}><FA name=\"plus\" /></button>;\r\n        /*\r\n        let showOwners = false, showAdmins = false;\r\n        let ownersView:any, adminsView:any;\r\n        if (unit.isRoot === 1) {\r\n            showOwners = true;\r\n            showAdmins = true;\r\n        }\r\n        if (unit.isOwner === 1) showAdmins = true;\r\n        if (showOwners === true) {\r\n            let header = <LMR \r\n                className=\"px-3 py-1 small\"\r\n                left=\"高管\" \r\n                right={<a href='/' onClick={this.onNewOwner}>新增</a>} />;\r\n            ownersView = <List \r\n                className=\"my-4\"\r\n                header={header} items={owners}\r\n                none=\"[无]\"\r\n                item={{onClick: this.onItemClick, render: this.row}}\r\n            />;\r\n        }\r\n        if (showAdmins === true) {\r\n            let header = <LMR \r\n                className=\"px-3 py-1 small\"\r\n                left=\"管理员\" \r\n                right={<a href='/' onClick={this.onNewAdmin}>新增</a>} />;\r\n            adminsView = <List \r\n                className='my-4' \r\n                header={header} items={admins} \r\n                none='[无]'\r\n                item={{onClick: this.onItemClick, render: this.row}}\r\n            />;\r\n        }\r\n        */\r\n        let adminsView = <List ref={(list) => this.list = list}\r\n            className=\"my-1\" items={admins.admins}\r\n            none='[无]'\r\n            item={{ render: this.row, onSelect: this.onItemSelect }}\r\n        />;\r\n        let cnBtn = 'btn btn-sm btn-outline-info me-1';\r\n        let buttons = admins.admins.length > 0 && <div className=\"pl-3\">\r\n            <button className={cnBtn} onClick={this.onSelectAll}>全选</button>\r\n            <button className={cnBtn} onClick={this.onClearAll}>全清</button>\r\n            <button className={cnBtn} disabled={this.disableDel} onClick={this.onDel}>移除</button>\r\n        </div>;\r\n\r\n        return <Page header=\"管理员\" right={right}>\r\n            <div className='my-3'>\r\n                {buttons}\r\n                {adminsView}\r\n                {buttons}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import { CUqBase } from \"UqApp\";\r\nimport { Unit, UnitAdmin } from \"model\";\r\nimport { Admins } from \"store/admins\";\r\nimport { VAdmins } from \"./VAdmins\";\r\n\r\nexport class CAdmins extends CUqBase {\r\n    unit: Unit;\r\n    admins: Admins;\r\n    protected async internalStart(unit: Unit) {\r\n        this.unit = unit;\r\n        this.admins = new Admins(unit);\r\n        await this.admins.load();\r\n\r\n        this.openVPage(VAdmins);\r\n    }\r\n\r\n    setAdmin = async (isOwner:number, isAdmin:number) => {\r\n        await this.admins.unitSetAdmin(isOwner, isAdmin, 0);\r\n    }\r\n\r\n    addAdmin = async (user:string):Promise<string> => {\r\n        let ret = await this.admins.unitAddAdmin(user, 0, 1, 0);\r\n        if (typeof ret === 'object') return;\r\n        return ret;\r\n    }\r\n\r\n    delAdmins = async (unitAdmins: UnitAdmin[]) => {\r\n        if (await this.confirm({\r\n            caption: '确认移除',\r\n            message: '真的要移除这些管理员吗？' + unitAdmins.map(v => v.name).join(','),\r\n            ok: '确认'\r\n        }) === 'ok') {\r\n            let promises:Promise<any>[] = unitAdmins.map(v => this.admins.unitDelAdmin(v));\r\n            await Promise.all(promises);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page } from 'tonva';\r\nimport { List, SearchBox, LMR, FA } from 'tonva';\r\nimport { CUsers, AppUsers } from './CUsers';\r\n\r\nexport class VApps extends VPage<CUsers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderRow = (appUsers: AppUsers, index: number): JSX.Element => {\r\n        let { app, more, users } = appUsers;\r\n        let { name, discription } = app;\r\n        let right = <small className=\"text-muted\">{discription}</small>;\r\n        return <div className=\"d-block px-3 py-2\">\r\n            <LMR className=\"mb-2\" right={right}>\r\n                <FA name=\"address-card-o\" className=\"text-primary me-3\" />\r\n                <b>{name}</b>\r\n            </LMR>\r\n            <div>\r\n                <small className=\"text-muted\">用户: </small>\r\n                {users.length === 0 ?\r\n                    '[无]' :\r\n                    users.map(u => u.assigned || u.nick || u.name).join(', ') + (more === true ? ' ...' : '')}\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { appUsersList, searchApp, onAppsClick } = this.controller;\r\n        let searchBox = <SearchBox className=\"w-100 pr-1\"\r\n            onSearch={searchApp}\r\n            placeholder=\"搜索App\"\r\n            allowEmptySearch={true} />;\r\n        return <Page header={searchBox}>\r\n            <List items={appUsersList}\r\n                item={{ render: this.renderRow, onClick: onAppsClick, key: (item => item.app.id) }} />\r\n        </Page>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page, LMR } from 'tonva';\r\nimport { List, SearchBox, FA } from 'tonva';\r\nimport { CUsers, UserApps } from './CUsers';\r\n\r\nexport class VUsers extends VPage<CUsers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderRow = (userApps: UserApps, index: number): JSX.Element => {\r\n        let { user, apps } = userApps;\r\n        let { name, nick, assigned } = user;\r\n        let left = <FA name=\"user-o\" size=\"lg\" className=\"text-info mx-3 mt-2\" fixWidth={true} />;\r\n        return <LMR className=\"py-2\" left={left}>\r\n            <div className=\"mb-2\">\r\n                <b>{assigned || nick || name}</b>\r\n            </div>\r\n            <div className=\"d-flex flex-wrap mt-1\">\r\n                {apps.length === 0 ?\r\n                    <small className=\"text-muted\">[无]</small>\r\n                    :\r\n                    apps.map(a => this.box(a.name, 'px-2 text-info border-muted bg-white'))\r\n                }\r\n            </div>\r\n        </LMR>;\r\n    }\r\n\r\n    private box = (text: string, cn: string) => {\r\n        return <div className={'me-3 mb-1 py-1 small border rounded ' + cn} key={text}>{text}</div>;\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { userAppsList, searchUser, onUsersClick } = this.controller;\r\n        let searchBox = <SearchBox className=\"w-100 pr-1\" label=\"App管理员 &nbsp; \"\r\n            onSearch={searchUser}\r\n            placeholder=\"搜索管理员\"\r\n            allowEmptySearch={true} />;\r\n        return <Page header={searchBox}>\r\n            <List items={userAppsList}\r\n                item={{ render: this.renderRow, onClick: onUsersClick, key: (item => item.user.id) }} />\r\n        </Page>;\r\n    });\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page } from 'tonva';\r\nimport { List } from 'tonva';\r\nimport { CUsers, User } from './CUsers';\r\n\r\nexport class VApp extends VPage<CUsers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {curApp, curAppUsers, onAppEditUsers} = this.controller;\r\n        let right = <button className=\"btn btn-sm btn-success\" onClick={()=>onAppEditUsers()}>增减用户</button>;\r\n        return <Page header={'App - ' + (curApp.name)} right={right}>\r\n            <List items={curAppUsers} item={{render:this.renderApp}} />\r\n        </Page>\r\n    })\r\n\r\n    private renderApp = (user: User, index:number):JSX.Element => {\r\n        let {name, nick, assigned} = user;\r\n        let content:any;\r\n        if (assigned)\r\n            content = <span>{assigned} &nbsp; <small className=\"text-muted\">{name}</small></span>;\r\n        else if (nick)\r\n            content = <span>{nick} &nbsp; <small className=\"text-muted\">{name}</small></span>;\r\n        else\r\n            content = <>{name}</>\r\n        return <div className=\"px-3 py-2\">{content}</div>\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page, LMR, FA } from 'tonva';\r\nimport { List } from 'tonva';\r\nimport { CUsers, App } from './CUsers';\r\n\r\nexport class VUser extends VPage<CUsers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { curUser, curUserApps, onUserEditApps } = this.controller;\r\n        let right = <button className=\"btn btn-sm btn-success align-self-center me-2\" onClick={() => onUserEditApps()}>增减App</button>;\r\n        return <Page header={'用户 - ' + (curUser.assigned || curUser.nick || curUser.name)}\r\n            right={right}>\r\n            <List items={curUserApps} item={{ render: this.renderApp }} />\r\n        </Page>\r\n    })\r\n\r\n    private renderApp = (app: App, index: number): JSX.Element => {\r\n        let { name, discription } = app;\r\n        let left = <FA name=\"caret-square-o-right\" size=\"lg\" className=\"me-3 mt-1 text-info\" />;\r\n        let right = <small className=\"text-muted\">{discription}</small>\r\n        return <LMR className=\"px-3 py-2\" left={left} right={right}><b>{name}</b></LMR>\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page } from 'tonva';\r\nimport { List, LMR, Muted } from 'tonva';\r\nimport { CUsers, EditUser } from './CUsers';\r\n\r\nexport class VAppEditUsers extends VPage<CUsers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {curApp, appEditUsers} = this.controller;\r\n        return <Page header={curApp.name + ' - 增减用户'} >\r\n            <List items={appEditUsers} item={{render:this.renderUserItem}} />\r\n        </Page>\r\n    })\r\n\r\n    private renderUserItem = (editUser: EditUser, index:number):JSX.Element => {\r\n        let {name, nick, assigned, bind} = editUser;\r\n        let content:any;\r\n        if (assigned)\r\n            content = <>{assigned} <Muted>{name}</Muted></>;\r\n        else if (nick)\r\n            content = <>{nick} <Muted>{name}</Muted></>;\r\n        else\r\n            content = <>{name}</>\r\n        let right = <input type=\"checkbox\" defaultChecked={bind===1} \r\n            onChange={(evt)=>this.onUserChanged(editUser, evt.target.checked)} />;\r\n        return <LMR className=\"px-3 py-2 align-items-center\" right={right}>\r\n            {content}\r\n        </LMR>\r\n    }\r\n\r\n    private onUserChanged = async (editUser: EditUser, checked:boolean) => {\r\n        await this.controller.bindAppUser(editUser, checked);\r\n        editUser.bind = checked===true? 1: 0;\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page } from 'tonva';\r\nimport { List, LMR } from 'tonva';\r\nimport { CUsers, EditApp } from './CUsers';\r\n\r\nexport class VUserEditApps extends VPage<CUsers> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let {curUser, userEditApps} = this.controller;\r\n        return <Page header={'增减App - ' + (curUser.assigned || curUser.nick || curUser.name)}>\r\n            <List items={userEditApps} item={{render:this.renderApp}} />\r\n        </Page>\r\n    })\r\n\r\n    private renderApp = (editApp: EditApp, index:number):JSX.Element => {\r\n        let {name, discription, bind} = editApp;\r\n        let right = <input type=\"checkbox\" defaultChecked={bind===1} \r\n            onChange={(evt)=>this.onAppChanged(editApp, evt.target.checked)} />;\r\n        return <LMR className=\"px-3 py-2\" right={right}>\r\n            {name} {discription}\r\n        </LMR>\r\n    }\r\n\r\n    private onAppChanged = async (editApp: EditApp, checked:boolean) => {\r\n        await this.controller.bindUserApp(editApp, checked);\r\n        editApp.bind = checked===true? 1: 0;\r\n    }\r\n}","import * as React from 'react';\r\nimport { VPage, Page, Image } from 'tonva';\r\nimport { CUsers, User } from './CUsers';\r\nimport { SearchBox } from 'tonva';\r\nimport { mainApi } from 'api';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VAddUser extends VPage<CUsers> {\r\n    @observable private user: User = null;\r\n    //@observable private addedUser: User;\r\n    private searchBox: SearchBox;\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = observer((): JSX.Element => {\r\n        let searchBox = <SearchBox ref={v => this.searchBox = v}\r\n            className=\"w-100\"\r\n            onSearch={this.onSearch}\r\n            onFocus={this.onSearchFocus}\r\n            placeholder=\"用户全名/手机号/邮箱\"\r\n        />;\r\n        let content: any;\r\n        if (this.user === null) {\r\n        }\r\n        else if (this.user === undefined) {\r\n            content = <div className=\"text-info p-3\">没有找到用户</div>;\r\n        }\r\n        else {\r\n            let { name, nick, icon } = this.user;\r\n            let divUser: any;\r\n            if (nick) {\r\n                divUser = <><div><b>{nick}</b></div><div>{name}</div></>;\r\n            }\r\n            else {\r\n                divUser = <div><b>{name}</b></div>;\r\n            }\r\n            content = <div>\r\n                <div className=\"m-3 p-3 d-flex bg-white\">\r\n                    <Image src={icon} />\r\n                    <div className=\"ms-3\">{divUser}</div>\r\n                </div>\r\n                <div className=\"d-flex justify-content-center\">\r\n                    <button className=\"btn btn-success text-center\" onClick={this.onAddUser}>增加用户</button>\r\n                </div>\r\n            </div>;\r\n        }\r\n        /*\r\n        let divUserAdded:any;\r\n        if (this.addedUser) {\r\n            divUserAdded = <div className=\"p-3\">\r\n                <div>\r\n                    新增用户: {this.addedUser.name} &nbsp; &nbsp; \r\n                    <button className=\"btn btn-success\" \r\n                        onClick={()=>this.controller.onUserEditApps()}>\r\n                        为用户添加App\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        }\r\n        */\r\n        return <Page header={searchBox}>\r\n            {content}\r\n        </Page>;\r\n    })\r\n    //{divUserAdded}\r\n\r\n    private onSearch = async (key: string) => {\r\n        this.user = await mainApi.userFromKey(key);\r\n    }\r\n\r\n    private onAddUser = async () => {\r\n        await this.controller.addUser(this.user.id);\r\n        this.controller.curUser = this.user;\r\n        this.user = null;\r\n        this.searchBox.clear();\r\n        this.replacePage(this.addedPage);\r\n    }\r\n\r\n    private onSearchFocus = () => {\r\n        this.user = null;\r\n        //this.addedUser = null;\r\n        if (this.searchBox) this.searchBox.clear();\r\n    }\r\n\r\n    private onAddApps = () => {\r\n        this.closePage();\r\n        this.controller.onUserEditApps();\r\n    }\r\n\r\n    private onContinueAddUser = () => {\r\n        this.closePage();\r\n        this.controller.onAddUser();\r\n    }\r\n\r\n    private addedPage = () => {\r\n        return <Page header=\"添加成功\">\r\n            <div className=\"p-3 text-center\">\r\n                <div>\r\n                    新增用户: {this.controller.curUser.name}\r\n                </div>\r\n                <div className=\"mt-3\">\r\n                    <button className=\"btn btn-success me-3\"\r\n                        onClick={this.onAddApps}>\r\n                        为用户添加App\r\n                    </button>\r\n                    <button className=\"btn btn-outline-primary\"\r\n                        onClick={this.onContinueAddUser}>\r\n                        继续添加新用户\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n","import { observable } from 'mobx';\r\nimport { Controller } from 'tonva';\r\nimport { mainApi } from 'api';\r\nimport { VApps } from './VApps';\r\nimport { VUsers } from './VUsers';\r\nimport { VApp } from './VApp';\r\nimport { VUser } from './VUser';\r\nimport { VAppEditUsers } from './VAppEditUsers';\r\nimport { VUserEditApps } from './VUserEditApps';\r\nimport { VAddUser } from './VAddUser';\r\nimport { Unit } from 'model';\r\n\r\nexport interface User {\r\n    id: number;\r\n    name: string;\r\n    nick: string;\r\n    icon: string;\r\n    assigned: string;\r\n}\r\nexport interface App {\r\n    id: number;\r\n    name: string;\r\n    discription: string;\r\n}\r\nexport interface UserApps {\r\n    user: User;\r\n    apps: App[];\r\n}\r\nexport interface AppUsers {\r\n    app: App;\r\n    users: User[];\r\n    more: boolean;\r\n}\r\nexport interface EditApp extends App {\r\n    bind: number;   // 0: not bind, 1: bind\r\n}\r\nexport interface EditUser extends User {\r\n    bind: number;  // 0: not bind, 1: bind\r\n}\r\n\r\nexport class CUsers extends Controller {\r\n    private unit: Unit;\r\n    @observable userAppsList: UserApps[];\r\n    @observable appUsersList: AppUsers[];\r\n    curUser: User;\r\n    @observable curUserApps: App[];\r\n    @observable userEditApps: EditApp[];\r\n    curApp: App;\r\n    @observable curAppUsers: User[];\r\n    @observable appEditUsers: EditUser[];\r\n\r\n    protected async internalStart(unit:Unit) {\r\n        this.unit = unit;\r\n        //await this.loadAppUsers(undefined);\r\n        await this.loadUserApps(undefined);\r\n        //this.openVPage(VApps);\r\n        this.openVPage(VUsers);\r\n    }\r\n\r\n    private onAppUsers = async () => {\r\n        await this.loadAppUsers(undefined);\r\n        this.openVPage(VApps);\r\n    }\r\n\r\n    private onUserApps = async () => {\r\n        await this.loadUserApps(undefined);\r\n        this.openVPage(VUsers);\r\n    }\r\n\r\n    private async loadAppUsers(key:string) {\r\n        let list:AppUsers[] = [];\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        let ret = await mainApi.unitAppUsers(this.unit.id, key, pageStart, pageSize);\r\n\t\tlet apps = ret[0];\r\n        let users = ret[1];\r\n        let coll: {[id:number]:AppUsers} = {}\r\n        for (let a of apps) {\r\n            let app:App = {\r\n                id: a.id,\r\n                name: a.name,\r\n                discription: a.discription,\r\n            };\r\n            list.push(coll[a.id] = {app:app, more:false, users:[]});\r\n        }\r\n        for (let u of users) {\r\n            let user:User = {\r\n                id: u.user,\r\n                name: u.name,\r\n                nick: u.nick,\r\n                icon: u.icon,\r\n                assigned: u.assigned\r\n            }\r\n            let item = coll[u.app];\r\n            let {users} = item;\r\n            if (users.length >= 5) {\r\n                item.more = true;\r\n            }\r\n            else {\r\n                users.push(user);\r\n            }\r\n        }\r\n        this.appUsersList = list;\r\n    }\r\n\r\n    private async loadUserApps(key:string) {\r\n        let list:UserApps[] = [];\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        let ret = await mainApi.unitUsers(this.unit.id, key, pageStart, pageSize);\r\n        let users = ret[0];\r\n        let apps = ret[1];\r\n        let coll: {[id:number]:UserApps} = {}\r\n        for (let u of users) {\r\n            let user:User = {\r\n                id: u.id,\r\n                name: u.name,\r\n                nick: u.nick,\r\n                icon: u.icon,\r\n                assigned: u.assigned\r\n            };\r\n            list.push(coll[u.id] = {user:user, apps:[]});\r\n        }\r\n        for (let a of apps) {\r\n            let app:App = {\r\n                id: a.app,\r\n                name: a.name,\r\n                discription: a.discription,\r\n            }\r\n            coll[a.user].apps.push(app);\r\n        }\r\n        this.userAppsList = list;\r\n    }\r\n\r\n    searchUser = async(key:string) => {\r\n        await this.loadUserApps(key);\r\n    }\r\n\r\n    searchApp = async(key:string) => {\r\n        await this.loadAppUsers(key);\r\n    }\r\n\r\n    onAppsClick = async (appUsers: AppUsers) => {\r\n        this.curApp = appUsers.app;\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        this.curAppUsers = await mainApi.unitOneAppUsers(this.unit.id, this.curApp.id, pageStart, pageSize);\r\n        this.openVPage(VApp);\r\n    }\r\n\r\n    onUsersClick = async (userApps: UserApps) => {\r\n        this.curUser = userApps.user;\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        this.curUserApps = await mainApi.unitOneUserApps(this.unit.id, this.curUser.id, pageStart, pageSize);\r\n        this.openVPage(VUser);\r\n    }\r\n\r\n    onAppEditUsers = async (key?:string) => {\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        this.appEditUsers = await mainApi.unitAppEditUsers(this.unit.id, this.curApp.id, key, pageStart, pageSize);\r\n        this.openVPage(VAppEditUsers);\r\n    }\r\n\r\n    onAddUser = () => {\r\n        this.openVPage(VAddUser);\r\n    }\r\n\r\n    onUserEditApps = async (key?:string) => {\r\n        let pageStart = 0;\r\n        let pageSize = 100;\r\n        this.userEditApps = await mainApi.unitUserEditApps(this.unit.id, this.curUser.id, key, pageStart, pageSize);\r\n        this.openVPage(VUserEditApps);\r\n    }\r\n\r\n    bindAppUser = async(user:User, checked:boolean) => {\r\n        await mainApi.bindAppUser(this.unit.id, this.curApp.id, user.id, checked===true? 1:0);\r\n        let appUsers = this.appUsersList.find(v => v.app.id === this.curApp.id);\r\n        if (checked === true) {\r\n            this.curAppUsers.push(user);\r\n            if (appUsers) appUsers.users.push(user);\r\n        }\r\n        else {\r\n            let index = this.curAppUsers.findIndex(v => v.id === user.id);\r\n            if (index>=0) this.curAppUsers.splice(index, 1);\r\n            if (appUsers) {\r\n                index = appUsers.users.findIndex(v => v.id === user.id);\r\n                if (index>=0) appUsers.users.splice(index, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    bindUserApp = async(app:App, checked:boolean) => {\r\n        await mainApi.bindAppUser(this.unit.id, app.id, this.curUser.id, checked===true? 1:0);\r\n        if (this.userAppsList === undefined) return;\r\n        let userApps = this.userAppsList.find(v => v.user.id === this.curUser.id);\r\n        if (checked === true) {\r\n            this.curUserApps.push(app);\r\n            if (userApps) userApps.apps.push(app);\r\n        }\r\n        else {\r\n            let index = this.curUserApps.findIndex(v => v.id === app.id);\r\n            if (index>=0) this.curUserApps.splice(index, 1);\r\n            if (userApps) {\r\n                index = userApps.apps.findIndex(v => v.id === app.id);\r\n                if (index>=0) userApps.apps.splice(index, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    addUser = async (userId: number) => {\r\n        await mainApi.unitAddUser(this.unit.id, userId);\r\n    }\r\n}\r\n","import { appInFrame } from 'tonva';\r\nimport { UnitAdmin, Unit, DevApp } from '../model';\r\nimport { store } from '../store';\r\nimport { CUqBase } from 'UqApp';\r\nimport { VUnit } from './VUnit';\r\nimport { VHome } from './VHome';\r\nimport { CAppXAccount } from 'XAccount';\r\nimport { CDevelopers } from 'Dev/developers';\r\nimport { AdminDevs } from 'store/adminDevs';\r\nimport { CUqRoles } from '../UqRoles';\r\nimport { CAdmins } from 'Admins';\r\nimport { CUsers } from 'Users';\r\nimport { AppController, CUq } from 'Dev';\r\n\r\nexport class CHome extends CUqBase {\r\n    unit: Unit;\r\n    isProduction: boolean;\r\n    adminDevs: AdminDevs;\r\n    cAdmins: CAdmins;\r\n    cUsers: CUsers;\r\n    cUqRoles: CUqRoles;\r\n\r\n    protected async internalStart(param?: any): Promise<void> {\r\n        this.cAdmins = this.newC(CAdmins);\r\n        this.cUsers = new CUsers(this.res);\r\n        store.init();\r\n\r\n        this.isProduction = document.location.hash.startsWith('#tv');\r\n        console.log('admins isProduction %s', this.isProduction);\r\n\r\n        if (this.isProduction === false) {\r\n            await store.loadAdminUnits();\r\n        }\r\n        else {\r\n            await store.loadUnit();\r\n        }\r\n        this.openVPage(VHome);\r\n    }\r\n\r\n    startUq = (unit: Unit) => {\r\n        let cUq = this.newC(CUq);\r\n        cUq.start(unit);\r\n    }\r\n\r\n    startApp = (unit: Unit) => {\r\n        let appController = new AppController(this.res);\r\n        appController.start(unit.id);\r\n    }\r\n\r\n    onShowUnit = async (item: UnitAdmin) => {\r\n        appInFrame.unit = item.id; // 25;\r\n        store.init();\r\n        await store.loadUnit();\r\n\r\n        let { unit } = store;\r\n        this.adminDevs = new AdminDevs(unit);\r\n\r\n        let { isDev, type } = unit;\r\n        if (isDev === 1) {\r\n            // 开发号管理员\r\n            if ((type & 1) !== 0) {\r\n                await store.dev.loadCounts();\r\n            }\r\n\r\n            // 小号管理员\r\n            if ((type & 2) !== 0) {\r\n                await store.loadApps();\r\n            }\r\n        }\r\n        this.unit = unit;\r\n        this.cUqRoles = this.newC(CUqRoles, this.unit.id)\r\n        this.openVPage(VUnit);\r\n    }\r\n\r\n    logout = async () => {\r\n        store.logout();\r\n    }\r\n\r\n    showAppXAccount = async (appXAccount: DevApp) => {\r\n        let cAppXAccount = this.newC(CAppXAccount);\r\n        await cAppXAccount.start(this.unit, appXAccount);\r\n    }\r\n\r\n    async onShowDevelopers() {\r\n        await this.adminDevs.load();\r\n        let c = this.newC(CDevelopers);\r\n        c.start(this.adminDevs);\r\n    }\r\n}\r\n\r\n","import { CAppBase, IConstructor } from \"tonva\";\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\nimport { CUqBase } from \"./CBase\";\r\n//import { VMain } from './tonvaApp/main';\r\n//import { CMe } from \"me/CMe\";\r\nimport { CHome } from \"Home\";\r\n\r\nexport class CApp extends CAppBase {\r\n    cHome: CHome;\r\n\r\n    protected newC<T extends CUqBase>(type: IConstructor<T>): T {\r\n        return new type(this);\r\n    }\r\n\r\n    protected async internalStart() {\r\n        this.cHome = this.newC(CHome);\r\n        this.cHome.start();\r\n    }\r\n}\r\n","import { nav, NavView, start } from 'tonva';\r\nimport './App.css';\r\nimport { CApp } from 'UqApp/CApp';\r\n\r\n/*\r\nfunction App() {\r\n  return (\r\n    <div className=\"App\">\r\n      <header className=\"App-header\">\r\n        <img src={logo} className=\"App-logo\" alt=\"logo\" />\r\n        <p>\r\n          Edit <code>src/App.tsx</code> and save to reload.\r\n        </p>\r\n        <a\r\n          className=\"App-link\"\r\n          href=\"https://reactjs.org\"\r\n          target=\"_blank\"\r\n          rel=\"noopener noreferrer\"\r\n        >\r\n          Learn React\r\n        </a>\r\n      </header>\r\n    </div>\r\n  );\r\n}\r\n*/\r\n\r\nfunction App() {\r\n  let onLogined = async () => {\r\n    nav.clear();\r\n    await start(CApp, undefined);\r\n    //let cAdmin = new CHome({});\r\n    //await cAdmin.start();\r\n  }\r\n  return (<NavView onLogined={onLogined} />);\r\n}\r\n\r\nexport default App;\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\nimport './index.css';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}